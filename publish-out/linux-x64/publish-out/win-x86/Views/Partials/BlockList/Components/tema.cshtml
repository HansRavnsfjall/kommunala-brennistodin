@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<BlockListItem>
@using System.Globalization
@using Umbraco.Cms.Core.Models
@using Umbraco.Cms.Core.Models.PublishedContent
@using Umbraco.Cms.Core.Strings
@using Umbraco.Extensions

@{
    var culture = CultureInfo.CurrentUICulture?.Name;
    var el = Model?.Content;

    // Picked tema page
    var temaPage = el?.Value<IPublishedContent>("temaPicker", culture: culture, fallback: Fallback.ToLanguage);
    if (temaPage is null) { return; }

    var url   = temaPage.Url(culture);
    var title = temaPage.Name(culture) ?? temaPage.Name ?? string.Empty;

    IHtmlEncodedString? ingress = temaPage.Value<IHtmlEncodedString?>("inngangstekstur", culture: culture, fallback: Fallback.ToLanguage);

    MediaWithCrops? heroImage = temaPage.Value<MediaWithCrops?>("mynd", culture: culture, fallback: Fallback.ToLanguage);
    var imgUrl = heroImage?.GetCropUrl() ?? heroImage?.MediaUrl();
    var imgAlt = heroImage?.Value<string>("altText")
             ?? heroImage?.Value<string>("umbracoAltText")
             ?? title;

    // --- Dropdown "radfylgja": "Mynd til vinstru" (default) / "Mynd til høgru" ---
    var sideRaw = (el.Value<string>("radfylgja", culture: culture, fallback: Fallback.ToLanguage) ?? "Mynd til vinstru").Trim();
    var imageLeft = !sideRaw.StartsWith("Mynd til høgru", StringComparison.OrdinalIgnoreCase); // default to left unless explicitly "høgru"

    // Mobile-first stacking: image first, text second.
    var imgColOrder = imageLeft ? "order-1 order-md-1" : "order-1 order-md-2";
    var txtColOrder = imageLeft ? "order-2 order-md-2" : "order-2 order-md-1";
}

<!-- ===== Theme block ===== -->
<section class="py-4 py-lg-5">
  <div class="container">
    <div class="theme-wrap row g-0">
      <!-- IMAGE: col-12 on mobile, col-md-6 on desktop; always first on mobile -->
      <div class="theme-img col-12 col-md-6 @imgColOrder">
        @if (!string.IsNullOrWhiteSpace(imgUrl))
        {
          <a href="@url" aria-label="@title">
            <img src="@imgUrl" alt="@imgAlt" />
          </a>
        }
      </div>

      <!-- TEXT: col-12 on mobile, col-md-6 on desktop; second on mobile -->
      <div class="theme-panel col-12 col-md-6 @txtColOrder">
        <small>TEMA</small>
        <h3>@title</h3>

        @if (ingress is not null)
        {
          <div class="fw-700 text-muted-600">@ingress</div>
        }

        <a class="link-more stretched-link" href="@url">
          Les meira
          <svg class="arr" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 12h14M13 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>
