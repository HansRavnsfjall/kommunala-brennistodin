{"version":3,"file":"configuration-editor-workspace-modal.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/configuration-editor/configuration-editor-workspace-modal.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\n// Copyright Â© 2024 Lee Kelleher\n\nimport type {\n\tContentmentConfigurationEditorModel,\n\tContentmentConfigurationEditorModelField,\n\tContentmentConfigurationEditorValue,\n} from '../types.js';\nimport {\n\tcss,\n\tcustomElement,\n\thtml,\n\tifDefined,\n\tnothing,\n\trepeat,\n\tstate,\n\twhen,\n} from '@umbraco-cms/backoffice/external/lit';\nimport { UmbModalBaseElement, UmbModalToken } from '@umbraco-cms/backoffice/modal';\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\nimport type { UmbPropertyDatasetElement } from '@umbraco-cms/backoffice/property';\nimport type { UmbPropertyValueData } from '@umbraco-cms/backoffice/property';\nimport { parseBoolean, parseInt } from '../../utils/index.js';\n\ninterface ContentmentConfigurationEditorWorkspaceModalData {\n\titem: ContentmentConfigurationEditorValue;\n\tmodel: ContentmentConfigurationEditorModel;\n}\n\nexport const CONTENTMENT_CONFIGURATION_EDITOR_WORKSPACE_MODAL = new UmbModalToken<\n\tContentmentConfigurationEditorWorkspaceModalData,\n\tContentmentConfigurationEditorValue\n>('Umb.Contentment.Modal.ConfigurationEditor.Workspace', {\n\tmodal: {\n\t\ttype: 'sidebar',\n\t\tsize: 'medium',\n\t},\n});\n\n@customElement('contentment-property-editor-ui-configuration-editor-workspace-modal')\nexport class ContentmentPropertyEditorUIConfigurationEditorWorkspaceModalElement extends UmbModalBaseElement<\n\tContentmentConfigurationEditorWorkspaceModalData,\n\tContentmentConfigurationEditorValue\n> {\n\t// In v13, some boolean values were stored as numeric strings (\"0\" or \"1\") instead of booleans.\n\t// or numeric values were stored as strings. These may be unsupported by the new property-editors,\n\t// this is a workaround to convert those values to the correct object-type. [LK]\n\t#legacyValueConverters: Record<string, (x: unknown) => unknown> = {\n\t\t'Umb.PropertyEditorUi.Integer': (x) => parseInt(x),\n\t\t'Umb.PropertyEditorUi.Toggle': (x) => parseBoolean(x),\n\t\t'Umb.Contentment.PropertyEditorUi.NumberInput': (x) => parseInt(x),\n\t};\n\n\t@state()\n\tprivate _item?: ContentmentConfigurationEditorModel;\n\n\t@state()\n\tprivate _values?: Array<UmbPropertyValueData>;\n\n\toverride connectedCallback() {\n\t\tsuper.connectedCallback();\n\n\t\tif (!this.data) return;\n\n\t\tthis._item = this.data.model;\n\n\t\tconst values = { ...this.data.item.value };\n\t\t(this._item.fields ?? []).forEach((field) => {\n\t\t\tif (!field.key) return;\n\t\t\tconst value = values[field.key];\n\t\t\tif (!field.propertyEditorUiAlias) return;\n\t\t\tconst converter = this.#legacyValueConverters[field.propertyEditorUiAlias];\n\t\t\tif (converter) {\n\t\t\t\tvalues[field.key] = converter(value);\n\t\t\t}\n\t\t});\n\n\t\tthis._values = Object.entries(values).map(([alias, value]) => ({ alias, value }));\n\t}\n\n\t#onChange(event: Event & { target: UmbPropertyDatasetElement }) {\n\t\tthis._values = event.target.value;\n\t}\n\n\t#onSubmit(item?: ContentmentConfigurationEditorModel) {\n\t\tthis.value = { key: item!.key, value: Object.fromEntries(this._values?.map((x) => [x.alias, x.value]) ?? []) };\n\t\tthis._submitModal();\n\t}\n\n\toverride render() {\n\t\tif (!this._item) return nothing;\n\t\tconst fields = this._item.fields ?? [];\n\t\tif (!this._values) this._values = [];\n\t\treturn html`\n\t\t\t<umb-body-layout headline=\"Configure ${this._item.name}\">\n\t\t\t\t<uui-box>\n\t\t\t\t\t${when(\n\t\t\t\t\t\tfields.length,\n\t\t\t\t\t\t() => html`\n\t\t\t\t\t\t\t<umb-property-dataset .value=${this._values!} @change=${this.#onChange}>\n\t\t\t\t\t\t\t\t${repeat(\n\t\t\t\t\t\t\t\t\tfields,\n\t\t\t\t\t\t\t\t\t(field) => field.key,\n\t\t\t\t\t\t\t\t\t(field) => this.#renderField(field)\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</umb-property-dataset>\n\t\t\t\t\t\t`,\n\t\t\t\t\t\t() => html`<p>There are no fields for this item.</p>`\n\t\t\t\t\t)}\n\t\t\t\t</uui-box>\n\t\t\t\t<div slot=\"actions\">\n\t\t\t\t\t<uui-button label=${this.localize.term('general_cancel')} @click=${this._rejectModal}></uui-button>\n\t\t\t\t\t<uui-button\n\t\t\t\t\t\tcolor=\"positive\"\n\t\t\t\t\t\tlook=\"primary\"\n\t\t\t\t\t\tlabel=${this.localize.term('bulk_done')}\n\t\t\t\t\t\t@click=${() => this.#onSubmit(this._item)}></uui-button>\n\t\t\t\t</div>\n\t\t\t</umb-body-layout>\n\t\t`;\n\t}\n\t#renderField(field: ContentmentConfigurationEditorModelField) {\n\t\tif (!field.key) return nothing;\n\t\tif (!field.propertyEditorUiAlias) return nothing;\n\t\treturn html`\n\t\t\t<umb-property\n\t\t\t\talias=${field.key}\n\t\t\t\tlabel=${field.name ?? field.key}\n\t\t\t\tdescription=${ifDefined(field.description ?? undefined)}\n\t\t\t\t.propertyEditorUiAlias=${field.propertyEditorUiAlias}\n\t\t\t\t.config=${field.config ? Object.entries(field.config).map(([alias, value]) => ({ alias, value })) : []}>\n\t\t\t</umb-property>\n\t\t`;\n\t}\n\n\tstatic override styles = [\n\t\tUmbTextStyles,\n\t\tcss`\n\t\t\tumb-property {\n\t\t\t\tfont-size: 14px;\n\t\t\t}\n\t\t`,\n\t];\n}\n\nexport { ContentmentPropertyEditorUIConfigurationEditorWorkspaceModalElement as element };\n\ndeclare global {\n\tinterface HTMLElementTagNameMap {\n\t\t'contentment-property-editor-ui-configuration-editor-workspace-modal': ContentmentPropertyEditorUIConfigurationEditorWorkspaceModalElement;\n\t}\n}\n"],"names":["_legacyValueConverters","_ContentmentPropertyEditorUIConfigurationEditorWorkspaceModalElement_instances","onChange_fn","onSubmit_fn","renderField_fn","CONTENTMENT_CONFIGURATION_EDITOR_WORKSPACE_MODAL","UmbModalToken","ContentmentPropertyEditorUIConfigurationEditorWorkspaceModalElement","UmbModalBaseElement","__privateAdd","x","parseInt","parseBoolean","values","field","value","converter","__privateGet","alias","nothing","fields","html","when","__privateMethod","repeat","event","item","_a","ifDefined","UmbTextStyles","css","__decorateClass","state","customElement"],"mappings":"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"}