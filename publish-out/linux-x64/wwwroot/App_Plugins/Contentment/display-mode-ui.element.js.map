{"version":3,"file":"display-mode-ui.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/extensions/display-mode/display-mode.context.ts","../../../../Umbraco.Community.Contentment.Client/src/extensions/display-mode/display-mode-ui.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright © 2025 Lee Kelleher\r\n\r\nimport { UmbArrayState, UmbBooleanState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { ContentmentListItem } from '../../property-editor-ui/types.js';\r\nimport type { UmbPropertyEditorConfigCollection } from '@umbraco-cms/backoffice/property-editor';\r\n\r\nexport class ContentmentDisplayModeContext extends UmbContextBase {\r\n\t#canEdit?: (item: ContentmentListItem, index: number) => boolean;\r\n\r\n\t#config?: UmbPropertyEditorConfigCollection;\r\n\r\n\t#allowAdd = new UmbBooleanState(false);\r\n\tallowAdd = this.#allowAdd.asObservable();\r\n\r\n\t#allowEdit = new UmbBooleanState(false);\r\n\tallowEdit = this.#allowEdit.asObservable();\r\n\r\n\t#allowRemove = new UmbBooleanState(false);\r\n\tallowRemove = this.#allowRemove.asObservable();\r\n\r\n\t#allowSort = new UmbBooleanState(false);\r\n\tallowSort = this.#allowSort.asObservable();\r\n\r\n\t#items = new UmbArrayState<ContentmentListItem>([], (x) => x.value);\r\n\titems = this.#items.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, 'ContentmentDisplayModeContext');\r\n\t}\r\n\r\n\treadonly canEdit = (item: ContentmentListItem, index: number): boolean =>\r\n\t\tthis.#canEdit?.(item, index) ?? this.#allowEdit.getValue();\r\n\r\n\tgetConfigByAlias<T>(alias: string): T | undefined {\r\n\t\treturn this.#config?.getValueByAlias<T>(alias);\r\n\t}\r\n\r\n\treadonly getItems = () => this.#items.getValue();\r\n\r\n\treadonly setAllowAdd = (value: boolean) => this.#allowAdd.setValue(value);\r\n\r\n\treadonly setAllowEdit = (value: boolean) => this.#allowEdit.setValue(value);\r\n\r\n\treadonly setAllowRemove = (value: boolean) => this.#allowRemove.setValue(value);\r\n\r\n\treadonly setAllowSort = (value: boolean) => this.#allowSort.setValue(value);\r\n\r\n\treadonly setCanEdit = (callback: (item: ContentmentListItem, index: number) => boolean) => (this.#canEdit = callback);\r\n\r\n\treadonly setConfig = (config?: UmbPropertyEditorConfigCollection) => (this.#config = config);\r\n\r\n\treadonly setItems = (items?: Array<ContentmentListItem>) => this.#items.setValue(items ?? []);\r\n}\r\n","// SPDX-License-Identifier: MPL-2.0\r\n// Copyright © 2025 Lee Kelleher\r\n\r\nimport { ContentmentDisplayModeContext } from './display-mode.context.js';\r\nimport { createExtensionElement } from '@umbraco-cms/backoffice/extension-api';\r\nimport { customElement, html, nothing, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { ContentmentDisplayModeExtentionManifestType } from './display-mode.extension.js';\r\nimport type { ContentmentListItem } from '../../property-editor-ui/types.js';\r\nimport type { UmbPropertyEditorConfigCollection } from '@umbraco-cms/backoffice/property-editor';\r\n\r\n@customElement('contentment-display-mode-ui')\r\nexport default class ContentmentDisplayModeUIElement extends UmbLitElement {\r\n\t#context = new ContentmentDisplayModeContext(this);\r\n\r\n\t@property()\r\n\taddButtonLabelKey: string = 'general_add';\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic set allowAdd(value: boolean) {\r\n\t\tthis.#context.setAllowAdd(value);\r\n\t}\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic set allowEdit(value: boolean) {\r\n\t\tthis.#context.setAllowEdit(value);\r\n\t}\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic set allowRemove(value: boolean) {\r\n\t\tthis.#context.setAllowRemove(value);\r\n\t}\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic set allowSort(value: boolean) {\r\n\t\tthis.#context.setAllowSort(value);\r\n\t}\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set canEdit(callback: (item: ContentmentListItem, index: number) => boolean) {\r\n\t\tthis.#context.setCanEdit(callback);\r\n\t}\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tpublic set config(value: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tthis.#context.setConfig(value);\r\n\t}\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tpublic set items(value: Array<ContentmentListItem> | undefined) {\r\n\t\tthis.#context.setItems(value);\r\n\t}\r\n\r\n\t@property({ attribute: 'ui-alias' })\r\n\tpublic set uiAlias(value: string | undefined) {\r\n\t\tthis.#uiAlias = value;\r\n\t\tthis.#observePropertyEditorUI();\r\n\t}\r\n\tpublic get uiAlias(): string | undefined {\r\n\t\treturn this.#uiAlias;\r\n\t}\r\n\t#uiAlias?: string | undefined;\r\n\r\n\t@state()\r\n\tprivate _element?: ContentmentDisplayModeExtentionManifestType['ELEMENT_TYPE'];\r\n\r\n\t@state()\r\n\tprivate _undefined: boolean = false;\r\n\r\n\t#observePropertyEditorUI() {\r\n\t\tif (this.#uiAlias) {\r\n\t\t\tthis.observe(\r\n\t\t\t\tumbExtensionsRegistry.byTypeAndAlias('contentmentDisplayMode', this.#uiAlias),\r\n\t\t\t\t(manifest) => {\r\n\t\t\t\t\tif (manifest) {\r\n\t\t\t\t\t\tthis.#getDisplayModeUI(manifest);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.error(`Failed to find manifest for display mode UI alias: ${this.#uiAlias}`);\r\n\t\t\t\t\t\tthis._undefined = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'_observePropertyEditorUI'\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #getDisplayModeUI(manifest?: ContentmentDisplayModeExtentionManifestType | null) {\r\n\t\tif (!manifest) return;\r\n\r\n\t\tconst element = await createExtensionElement(manifest, 'lee-was-here');\r\n\r\n\t\tif (!element) {\r\n\t\t\tconsole.error(`Failed to create extension element for manifest: ${manifest}`);\r\n\t\t\tthis._undefined = true;\r\n\t\t}\r\n\r\n\t\tconst oldElement = this._element;\r\n\t\tthis._element = element;\r\n\r\n\t\tif (this._element) {\r\n\t\t\tthis._element.addButtonLabelKey = this.addButtonLabelKey;\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent(new CustomEvent('loaded'));\r\n\r\n\t\tthis.requestUpdate('_element', oldElement);\r\n\t}\r\n\r\n\t// Disable the Shadow DOM for this element; as event propagation needs to pass-through.\r\n\toverride createRenderRoot() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._element) return this._element;\r\n\t\tif (this._undefined) return html`<lee-was-here></lee-was-here>`;\r\n\t\treturn nothing;\r\n\t}\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-display-mode-ui': ContentmentDisplayModeUIElement;\r\n\t}\r\n}\r\n"],"names":["ContentmentDisplayModeContext","UmbContextBase","host","__privateAdd","_canEdit","_config","_allowAdd","_allowEdit","_allowRemove","_allowSort","_items","__privateSet","UmbBooleanState","__privateGet","UmbArrayState","x","item","index","_a","value","callback","config","items","alias","_context","_uiAlias","_ContentmentDisplayModeUIElement_instances","observePropertyEditorUI_fn","getDisplayModeUI_fn","ContentmentDisplayModeUIElement","UmbLitElement","__privateMethod","html","nothing","umbExtensionsRegistry","manifest","element","createExtensionElement","oldElement","__decorateClass","property","state","customElement"],"mappings":"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"}