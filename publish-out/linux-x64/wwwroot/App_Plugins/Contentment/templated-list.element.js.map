{"version":3,"file":"templated-list.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/templated-list/templated-list.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\n// Copyright Â© 2024 Lee Kelleher\n\nimport type { ContentmentListItem, ContentmentDataListOption } from '../types.js';\nimport {\n\tclassMap,\n\tcss,\n\tcustomElement,\n\thtml,\n\tifDefined,\n\tnothing,\n\tproperty,\n\trepeat,\n\tstate,\n\tunsafeHTML,\n\tuntil,\n} from '@umbraco-cms/backoffice/external/lit';\nimport { parseBoolean } from '../../utils/parse-boolean.function.js';\nimport { Liquid } from '../../external/liquidjs/index.js';\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\nimport type { Template } from '../../external/liquidjs/index.js';\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\n\n@customElement('contentment-property-editor-ui-templated-list')\nexport class ContentmentPropertyEditorUITemplatedListElement\n\textends UmbLitElement\n\timplements UmbPropertyEditorUiElement\n{\n\t#engine = new Liquid({ cache: true });\n\n\t#template?: Array<Template>;\n\n\t@state()\n\tprivate _enableMultiple = false;\n\n\t@state()\n\tprivate _flexDirection: 'row' | 'column' = 'column';\n\n\t@state()\n\tprivate _items: Array<ContentmentDataListOption> = [];\n\n\t@state()\n\tprivate _listStyles?: string;\n\n\t@state()\n\tprivate _listItemStyles?: string;\n\n\t@property({ type: Array })\n\tpublic set value(value: Array<string> | undefined) {\n\t\tthis.#value = value ?? [];\n\t}\n\tpublic get value(): Array<string> | undefined {\n\t\treturn this.#value;\n\t}\n\t#value?: Array<string> = [];\n\n\tpublic set config(config: UmbPropertyEditorUiElement['config']) {\n\t\tif (!config) return;\n\n\t\tconst defaultValue = config.getValueByAlias('defaultValue') ?? [];\n\t\tthis._enableMultiple = parseBoolean(config.getValueByAlias('enableMultiple'));\n\n\t\tconst template = config.getValueByAlias<string>('template') ?? '{{ item.name }}';\n\t\tthis.#template = this.#engine.parse(template);\n\n\t\tthis._flexDirection = config.getValueByAlias('orientation') === 'horizontal' ? 'row' : 'column';\n\n\t\tthis._listStyles = config.getValueByAlias('listStyles');\n\t\tthis._listItemStyles = config.getValueByAlias('listItemStyles');\n\n\t\tconst items = config.getValueByAlias<Array<ContentmentListItem>>('items') ?? [];\n\t\tthis._items = items.map((item) => ({ ...item, selected: this.value?.includes(item.value) ?? false }));\n\n\t\tif (!this.value) {\n\t\t\tthis.value = this._enableMultiple && Array.isArray(defaultValue) ? defaultValue : [defaultValue];\n\t\t}\n\t}\n\n\t#onClick(option: ContentmentDataListOption) {\n\t\toption.selected = !option.selected;\n\n\t\tconst values: Array<string> = [];\n\n\t\tthis._items.forEach((item) => {\n\t\t\tif (!this._enableMultiple) {\n\t\t\t\titem.selected = option.selected && item.value === option.value;\n\t\t\t}\n\n\t\t\tif (item.selected) {\n\t\t\t\tvalues?.push(item.value);\n\t\t\t}\n\t\t});\n\n\t\tthis.value = values;\n\n\t\tthis.dispatchEvent(new UmbChangeEvent());\n\t}\n\n\toverride render() {\n\t\tif (!this._items?.length) {\n\t\t\treturn html`\n\t\t\t\t<contentment-info-box\n\t\t\t\t\tcompact\n\t\t\t\t\ttype=\"warning\"\n\t\t\t\t\ticon=\"icon-alert\"\n\t\t\t\t\theading=\"There are no items to display\"></contentment-info-box>\n\t\t\t`;\n\t\t}\n\n\t\treturn html`\n\t\t\t<ul class=${this._flexDirection} style=${ifDefined(this._listStyles)}>\n\t\t\t\t${repeat(\n\t\t\t\t\tthis._items,\n\t\t\t\t\t(item) => item.value,\n\t\t\t\t\t(item) => this.#renderItem(item)\n\t\t\t\t)}\n\t\t\t</ul>\n\t\t`;\n\t}\n\n\t#renderItem(item: ContentmentDataListOption) {\n\t\tif (!item) return nothing;\n\t\treturn html`\n\t\t\t<li class=${classMap({ selected: item.selected })} style=${ifDefined(this._listItemStyles)}>\n\t\t\t\t<button\n\t\t\t\t\tclass=${classMap({ selected: item.selected })}\n\t\t\t\t\t?disabled=${item.disabled}\n\t\t\t\t\t@click=${() => this.#onClick(item)}>\n\t\t\t\t\t${until(this.#renderTemplate(item))}\n\t\t\t\t</button>\n\t\t\t</li>\n\t\t`;\n\t}\n\n\tasync #renderTemplate(item: ContentmentDataListOption) {\n\t\tif (!this.#engine || !this.#template) return null;\n\t\tconst markup = await this.#engine.render(this.#template, { item });\n\t\treturn markup ? unsafeHTML(markup) : nothing;\n\t}\n\n\tstatic override styles = [\n\t\tcss`\n\t\t\tul {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tflex-wrap: wrap;\n\t\t\t\tgap: var(--uui-size-3);\n\n\t\t\t\tlist-style: none;\n\t\t\t\tpadding: 0;\n\t\t\t\tmargin: 0;\n\n\t\t\t\t&.row {\n\t\t\t\t\tflex-direction: row;\n\t\t\t\t}\n\n\t\t\t\t> li {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tborder-radius: calc(var(--uui-border-radius) * 2);\n\n\t\t\t\t\t&.selected {\n\t\t\t\t\t\toutline: var(--uui-size-1) solid var(--uui-color-selected);\n\t\t\t\t\t}\n\n\t\t\t\t\t> button {\n\t\t\t\t\t\tall: initial;\n\t\t\t\t\t\tfont: inherit;\n\t\t\t\t\t\tcolor: inherit;\n\n\t\t\t\t\t\tborder-radius: calc(var(--uui-border-radius) * 2);\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\twidth: 100%;\n\n\t\t\t\t\t\t> * {\n\t\t\t\t\t\t\tflex: 1;\n\t\t\t\t\t\t\tpointer-events: none;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t&[disabled] {\n\t\t\t\t\t\t\tcursor: not-allowed !important;\n\t\t\t\t\t\t\topacity: 0.5;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t&:focus-visible {\n\t\t\t\t\t\t\toutline: 2px solid var(--uui-color-focus);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t`,\n\t];\n}\n\nexport { ContentmentPropertyEditorUITemplatedListElement as element };\n\ndeclare global {\n\tinterface HTMLElementTagNameMap {\n\t\t'contentment-property-editor-ui-templated-list': ContentmentPropertyEditorUITemplatedListElement;\n\t}\n}\n"],"names":["_engine","_template","_value","_ContentmentPropertyEditorUITemplatedListElement_instances","onClick_fn","renderItem_fn","renderTemplate_fn","ContentmentPropertyEditorUITemplatedListElement","UmbLitElement","__privateAdd","Liquid","value","__privateSet","__privateGet","config","defaultValue","parseBoolean","template","items","item","_a","html","ifDefined","repeat","__privateMethod","option","values","UmbChangeEvent","classMap","until","nothing","markup","unsafeHTML","css","__decorateClass","state","property","customElement"],"mappings":"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"}