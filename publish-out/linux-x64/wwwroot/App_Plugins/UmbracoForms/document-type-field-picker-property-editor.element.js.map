{"version":3,"file":"document-type-field-picker-property-editor.element.js","sources":["../../../../src/property-editor/document-type-field-picker/document-type-field-picker-property-editor.element.ts"],"sourcesContent":["import { FORMS_FORM_WORKSPACE_CONTEXT } from \"../../section/forms/workspace/form-workspace.context-token.js\";\nimport { FORMS_DATASOURCE_WORKSPACE_CONTEXT } from \"../../section/datasources/workspace/datasource-workspace.context-token.js\";\nimport { FORMS_PREVALUESOURCE_WORKSPACE_CONTEXT } from \"../../section/prevaluesources/workspace/prevaluesource-workspace.context-token.js\";\nimport {\n  html,\n  customElement,\n  property,\n  state,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport type {\n  UmbPropertyEditorUiElement,\n  UmbPropertyEditorConfigCollection,\n} from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\n\nimport type { UmbWorkspaceContext } from \"@umbraco-cms/backoffice/workspace\";\nimport { tryExecute } from \"@umbraco-cms/backoffice/resources\";\nimport type { PickerItem } from \"@umbraco-forms/generated\";\nimport { PickerService } from \"@umbraco-forms/generated\";\nimport type { UUISelectEvent } from \"@umbraco-cms/backoffice/external/uui\";\n\nconst elementName = \"forms-document-type-field-picker-property-editor\";\n\n@customElement(elementName)\nexport class FormsDocumentTypeFieldPickerPropertyUiElement\n  extends UmbLitElement\n  implements UmbPropertyEditorUiElement\n{\n  @property()\n  value = \"\";\n\n  @state()\n  private _settingProvidingDocTypeAlias: string = \"\";\n\n  @state()\n  private _properties: Array<PickerItem> = [];\n\n  public set config(config: UmbPropertyEditorConfigCollection | undefined) {\n    this._settingProvidingDocTypeAlias =\n      config?.getValueByAlias(\"settingProvidingDocTypeAlias\") || \"\";\n  }\n\n  constructor() {\n    super();\n\n    this.#observeSettingsFromContext();\n  }\n\n  #observeSettingsFromContext() {\n    // This property editor is used in settings, which could be part of a field, workflow, data source or prevalue source.\n    // As such we'll be in one of the forms, data source or prevalue source contexts, but we don't know which.\n    // So just try them all, one will succeed and we'll be able to access the settings from that.\n    this.consumeContext(FORMS_FORM_WORKSPACE_CONTEXT, (context) => {\n      if (!context) return;\n      this.#observeSettings(context);\n    });\n    this.consumeContext(FORMS_DATASOURCE_WORKSPACE_CONTEXT, (context) => {\n      if (!context) return;\n      this.#observeSettings(context);\n    });\n    this.consumeContext(FORMS_PREVALUESOURCE_WORKSPACE_CONTEXT, (context) => {\n      if (!context) return;\n      this.#observeSettings(context);\n    });\n  }\n\n  #observeSettings(context: UmbWorkspaceContext) {\n    this.observe(context[\"data\"], async (data) => {\n      if (this._settingProvidingDocTypeAlias.length === 0) return;\n      const settingValue = data?.settings[this._settingProvidingDocTypeAlias];\n      if (settingValue) {\n        await this.#populatePropertyTypeAliases(settingValue);\n      }\n    });\n  }\n\n  async #populatePropertyTypeAliases(docTypeAlias: string) {\n    const { data } = await tryExecute(\n      this,\n      PickerService.getPickerDocumentTypeByAliasProperties({\n        path: { alias: docTypeAlias },\n      }),\n    );\n    if (data) {\n      this._properties = data;\n    }\n  }\n\n  #onChange(e: UUISelectEvent) {\n    const newValue = e.target.value.toString();\n    if (newValue === this.value) return;\n    this.value = newValue;\n    this.dispatchEvent(new CustomEvent(\"property-value-change\"));\n  }\n\n  render() {\n    return html`\n      <uui-select\n        id=\"field\"\n        @change=${this.#onChange}\n        .options=${[\n          ...[\"Id\", \"Key\", \"Name\"].map((p) => ({\n            name: p,\n            value: p,\n            group: this.localize.term(\"formPropertyEditors_standardFields\"),\n            selected: this.value === p || (!this.value && p === \"Name\"),\n          })),\n          ...this._properties.map((p) => ({\n            name: p.value,\n            value: p.id,\n            group: this.localize.term(\"formPropertyEditors_customFields\"),\n            selected: this.value === p.id,\n          })),\n        ]}\n      >\n      </uui-select>\n    `;\n  }\n}\n\nexport default FormsDocumentTypeFieldPickerPropertyUiElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsDocumentTypeFieldPickerPropertyUiElement;\n  }\n}\n"],"names":["_FormsDocumentTypeFieldPickerPropertyUiElement_instances","observeSettingsFromContext_fn","observeSettings_fn","populatePropertyTypeAliases_fn","onChange_fn","elementName","FormsDocumentTypeFieldPickerPropertyUiElement","UmbLitElement","__privateAdd","__privateMethod","config","html","p","FORMS_FORM_WORKSPACE_CONTEXT","context","FORMS_DATASOURCE_WORKSPACE_CONTEXT","FORMS_PREVALUESOURCE_WORKSPACE_CONTEXT","data","settingValue","docTypeAlias","tryExecute","PickerService","newValue","__decorateClass","property","state","customElement","FormsDocumentTypeFieldPickerPropertyUiElement$1"],"mappings":";;;;;;;;;;;8OAAAA,GAAAC,GAAAC,GAAAC,GAAAC;AAqBA,MAAMC,IAAc;AAGb,IAAMC,IAAN,cACGC,EAEV;AAAA,EAeE,cAAc;AACZ,UAAA,GAnBGC,EAAA,MAAAR,CAAA,GAKL,KAAA,QAAQ,IAGR,KAAQ,gCAAwC,IAGhD,KAAQ,cAAiC,CAAA,GAUvCS,EAAA,MAAKT,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,EAAA;AAAA,EARF,IAAW,OAAOS,GAAuD;AACvE,SAAK,iCACHA,KAAA,gBAAAA,EAAQ,gBAAgB,oCAAmC;AAAA,EAAA;AAAA,EAwD/D,SAAS;AACP,WAAOC;AAAA;AAAA;AAAA,kBAGOF,QAAKT,GAAAI,CAAA,CAAS;AAAA,mBACb;AAAA,MACT,GAAG,CAAC,MAAM,OAAO,MAAM,EAAE,IAAI,CAACQ,OAAO;AAAA,QACnC,MAAMA;AAAA,QACN,OAAOA;AAAA,QACP,OAAO,KAAK,SAAS,KAAK,oCAAoC;AAAA,QAC9D,UAAU,KAAK,UAAUA,KAAM,CAAC,KAAK,SAASA,MAAM;AAAA,MAAA,EACpD;AAAA,MACF,GAAG,KAAK,YAAY,IAAI,CAACA,OAAO;AAAA,QAC9B,MAAMA,EAAE;AAAA,QACR,OAAOA,EAAE;AAAA,QACT,OAAO,KAAK,SAAS,KAAK,kCAAkC;AAAA,QAC5D,UAAU,KAAK,UAAUA,EAAE;AAAA,MAAA,EAC3B;AAAA,IAAA,CACH;AAAA;AAAA;AAAA;AAAA,EAAA;AAKT;AA9FOZ,IAAA,oBAAA,QAAA;AAwBLC,IAA2B,WAAG;AAI5B,OAAK,eAAeY,GAA8B,CAACC,MAAY;AAC7D,IAAKA,KACLL,EAAA,MAAKT,MAAL,KAAA,MAAsBc,CAAA;AAAA,EAAA,CACvB,GACD,KAAK,eAAeC,GAAoC,CAACD,MAAY;AACnE,IAAKA,KACLL,EAAA,MAAKT,MAAL,KAAA,MAAsBc,CAAA;AAAA,EAAA,CACvB,GACD,KAAK,eAAeE,GAAwC,CAACF,MAAY;AACvE,IAAKA,KACLL,EAAA,MAAKT,MAAL,KAAA,MAAsBc,CAAA;AAAA,EAAA,CACvB;AACH;AAEAZ,IAAgB,SAACY,GAA8B;AAC7C,OAAK,QAAQA,EAAQ,MAAS,OAAOG,MAAS;AAC5C,QAAI,KAAK,8BAA8B,WAAW,EAAG;AACrD,UAAMC,IAAeD,KAAA,gBAAAA,EAAM,SAAS,KAAK;AACzC,IAAIC,KACF,MAAMT,EAAA,MAAKT,MAAL,KAAA,MAAkCkB,CAAA;AAAA,EAC1C,CACD;AACH;AAEMf,IAA4B,eAACgB,GAAsB;AACvD,QAAM,EAAE,MAAAF,EAAA,IAAS,MAAMG;AAAA,IACrB;AAAA,IACAC,EAAc,uCAAuC;AAAA,MACnD,MAAM,EAAE,OAAOF,EAAA;AAAA,IAAa,CAC7B;AAAA,EAAA;AAEH,EAAIF,MACF,KAAK,cAAcA;AAEvB;AAEAb,IAAS,SAAC,GAAmB;AAC3B,QAAMkB,IAAW,EAAE,OAAO,MAAM,SAAA;AAChC,EAAIA,MAAa,KAAK,UACtB,KAAK,QAAQA,GACb,KAAK,cAAc,IAAI,YAAY,uBAAuB,CAAC;AAC7D;AAhEAC,EAAA;AAAA,EADCC,EAAA;AAAS,GAJClB,EAKX,WAAA,SAAA,CAAA;AAGQiB,EAAA;AAAA,EADPE,EAAA;AAAM,GAPInB,EAQH,WAAA,iCAAA,CAAA;AAGAiB,EAAA;AAAA,EADPE,EAAA;AAAM,GAVInB,EAWH,WAAA,eAAA,CAAA;AAXGA,IAANiB,EAAA;AAAA,EADNG,EAAcrB,CAAW;AAAA,GACbC,CAAA;AAgGb,MAAAqB,IAAerB;"}