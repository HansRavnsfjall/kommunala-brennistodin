{"version":3,"file":"entry-render-helper.class.js","sources":["../../../../src/section/forms/entries/entry-render-helper.class.ts"],"sourcesContent":["import type { FieldPrevalueDetail } from \"../types.js\";\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\nimport { UmbLocalizationController } from \"@umbraco-cms/backoffice/localization-api\";\nimport { DateOptions, DateTimeOptions } from \"@umbraco-forms/entities\";\nimport type { FieldData } from \"@umbraco-forms/generated\";\n\nexport class EntryRenderHelper {\n  #host: UmbControllerHost;\n  #localize: UmbLocalizationController;\n  #fieldPrevalues: Array<FieldPrevalueDetail> = [];\n\n  constructor(\n    host: UmbControllerHost,\n    fieldPrevalues: Array<FieldPrevalueDetail>,\n  ) {\n    this.#host = host;\n    this.#localize = new UmbLocalizationController(this.#host);\n    this.#fieldPrevalues = fieldPrevalues;\n  }\n\n  getRenderValue(field: FieldData, view: string) {\n    switch (view) {\n      case \"date\":\n        return this.#getDateValue(field, DateOptions);\n      case \"datetime\":\n        return this.#getDateValue(field, DateTimeOptions);\n      case \"number\":\n        return field.value;\n      case \"file\":\n        return this.#getFileValue(field);\n      default:\n        return this.#getTextValue(field);\n    }\n  }\n\n  #getDateValue(field: FieldData, options: Intl.DateTimeFormatOptions) {\n    try {\n      return field.value && field.value.toString().length > 0\n        ? this.#localize.date(field.value.toString(), options)\n        : \"\";\n    } catch {\n      return field.value;\n    }\n  }\n\n  #getFileValue(field: FieldData) {\n    if (!field.value) {\n      return \"\";\n    }\n\n    const fileNames = field.value\n      .toString()\n      .split(\", \")\n      .map((f) => f.replace(/^.*[\\\\/]/, \"\"));\n    return fileNames.join(\", \");\n  }\n\n  #getTextValue(field: FieldData) {\n    // If we have prevalues with captions, display those instead of the stored value.\n    if (!field.value || field.value.toString().length === 0) {\n      return \"\";\n    }\n\n    const prevalues = this.#getPrevaluesForField(field.fieldId);\n    if (prevalues.length === 0) {\n      return field.value.toString();\n    }\n\n    // If we find an exact match, use the caption where available.\n    const matchedPrevalue = prevalues.find((x) => x.value === field.value);\n    if (matchedPrevalue) {\n      return matchedPrevalue.caption && matchedPrevalue.caption.length > 0\n        ? matchedPrevalue.caption\n        : field.value;\n    }\n\n    // Also check the parts of the value separated by commas, as we could have a multiple value field.\n    const fieldValueParts = Array.isArray(field.value)\n      ? field.value\n      : field.value.toString().split(\", \");\n    let replacedValue = \"\";\n    for (let i = 0; i < fieldValueParts.length; i++) {\n      if (i > 0) {\n        replacedValue += \", \";\n      }\n\n      const fieldValuePart = fieldValueParts[i].trim();\n      const matchedPrevalue = prevalues.find((x) => x.value === fieldValuePart);\n      if (matchedPrevalue?.caption && matchedPrevalue.caption.length > 0) {\n        replacedValue += matchedPrevalue.caption;\n      } else {\n        replacedValue += fieldValuePart;\n      }\n    }\n\n    return replacedValue;\n  }\n\n  #getPrevaluesForField(fieldId: string) {\n    const matchedFieldPrevalueData = this.#fieldPrevalues.find(\n      (f) => f.id === fieldId,\n    );\n    if (matchedFieldPrevalueData) {\n      return matchedFieldPrevalueData.prevalues;\n    }\n\n    return [];\n  }\n}\n"],"names":["EntryRenderHelper","host","fieldPrevalues","__privateAdd","_EntryRenderHelper_instances","_host","_localize","_fieldPrevalues","__privateSet","UmbLocalizationController","__privateGet","field","view","__privateMethod","getDateValue_fn","DateOptions","DateTimeOptions","getFileValue_fn","getTextValue_fn","options","f","prevalues","getPrevaluesForField_fn","matchedPrevalue","x","fieldValueParts","replacedValue","i","fieldValuePart","fieldId","matchedFieldPrevalueData"],"mappings":";;;;;;;;AAMO,MAAMA,EAAkB;AAAA,EAK7B,YACEC,GACAC,GACA;AARG,IAAAC,EAAA,MAAAC;AACL,IAAAD,EAAA,MAAAE;AACA,IAAAF,EAAA,MAAAG;AACA,IAAAH,EAAA,MAAAI,GAA8C,CAAA;AAM5C,IAAAC,EAAA,MAAKH,GAAQJ,IACbO,EAAA,MAAKF,GAAY,IAAIG,EAA0BC,EAAA,MAAKL,EAAK,IACzDG,EAAA,MAAKD,GAAkBL;AAAA,EAAA;AAAA,EAGzB,eAAeS,GAAkBC,GAAc;AAC7C,YAAQA,GAAA;AAAA,MACN,KAAK;AACH,eAAOC,EAAA,MAAKT,GAAAU,GAAL,WAAmBH,GAAOI;AAAA,MACnC,KAAK;AACH,eAAOF,EAAA,MAAKT,GAAAU,GAAL,WAAmBH,GAAOK;AAAA,MACnC,KAAK;AACH,eAAOL,EAAM;AAAA,MACf,KAAK;AACH,eAAOE,EAAA,MAAKT,GAAAa,GAAL,WAAmBN;AAAA,MAC5B;AACE,eAAOE,EAAA,MAAKT,GAAAc,GAAL,WAAmBP;AAAA,IAAK;AAAA,EACnC;AA4EJ;AArGEN,IAAA,eACAC,IAAA,eACAC,IAAA,eAHKH,IAAA,eA6BLU,IAAA,SAAcH,GAAkBQ,GAAqC;AACnE,MAAI;AACF,WAAOR,EAAM,SAASA,EAAM,MAAM,SAAA,EAAW,SAAS,IAClDD,EAAA,MAAKJ,GAAU,KAAKK,EAAM,MAAM,SAAA,GAAYQ,CAAO,IACnD;AAAA,EAAA,QACE;AACN,WAAOR,EAAM;AAAA,EAAA;AACf,GAGFM,aAAcN,GAAkB;AAC9B,SAAKA,EAAM,QAIOA,EAAM,MACrB,SAAA,EACA,MAAM,IAAI,EACV,IAAI,CAACS,MAAMA,EAAE,QAAQ,YAAY,EAAE,CAAC,EACtB,KAAK,IAAI,IAPjB;AAOiB,GAG5BF,aAAcP,GAAkB;AAE9B,MAAI,CAACA,EAAM,SAASA,EAAM,MAAM,SAAA,EAAW,WAAW;AACpD,WAAO;AAGT,QAAMU,IAAYR,EAAA,MAAKT,GAAAkB,GAAL,WAA2BX,EAAM;AACnD,MAAIU,EAAU,WAAW;AACvB,WAAOV,EAAM,MAAM,SAAA;AAIrB,QAAMY,IAAkBF,EAAU,KAAK,CAACG,MAAMA,EAAE,UAAUb,EAAM,KAAK;AACrE,MAAIY;AACF,WAAOA,EAAgB,WAAWA,EAAgB,QAAQ,SAAS,IAC/DA,EAAgB,UAChBZ,EAAM;AAIZ,QAAMc,IAAkB,MAAM,QAAQd,EAAM,KAAK,IAC7CA,EAAM,QACNA,EAAM,MAAM,SAAA,EAAW,MAAM,IAAI;AACrC,MAAIe,IAAgB;AACpB,WAASC,IAAI,GAAGA,IAAIF,EAAgB,QAAQE,KAAK;AAC/C,IAAIA,IAAI,MACND,KAAiB;AAGnB,UAAME,IAAiBH,EAAgBE,CAAC,EAAE,KAAA,GACpCJ,IAAkBF,EAAU,KAAK,CAACG,MAAMA,EAAE,UAAUI,CAAc;AACxE,IAAIL,KAAAA,QAAAA,EAAiB,WAAWA,EAAgB,QAAQ,SAAS,IAC/DG,KAAiBH,EAAgB,UAEjCG,KAAiBE;AAAA,EACnB;AAGF,SAAOF;AAAA,GAGTJ,aAAsBO,GAAiB;AACrC,QAAMC,IAA2BpB,EAAA,MAAKH,GAAgB;AAAA,IACpD,CAACa,MAAMA,EAAE,OAAOS;AAAA,EAAA;AAElB,SAAIC,IACKA,EAAyB,YAG3B,CAAA;AAAC;"}