{"version":3,"file":"folder-move-options-modal.element.js","sources":["../../../../src/section/forms/entity-actions/move-folder/modal/folder-move-options-modal.element.ts"],"sourcesContent":["import { FormsFormFolderDetailRepository } from \"../../../repository/index.js\";\nimport { FORMS_FORM_TREE_ALIAS } from \"../../../tree/manifests.js\";\nimport {\n  FORMS_FORM_FOLDER_ENTITY_TYPE,\n  FORMS_FORM_ROOT_ENTITY_TYPE,\n} from \"../../../entities.js\";\nimport type { FormsFolderMoveOptionsModalData } from \"./index.js\";\nimport {\n  html,\n  customElement,\n  state,\n  unsafeHTML,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport type {\n  UmbFolderModel,\n  UmbTreeElement,\n  UmbTreeItemModelBase,\n} from \"@umbraco-cms/backoffice/tree\";\nimport type { UmbEntityUnique } from \"@umbraco-cms/backoffice/entity\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\n\n@customElement(\"forms-folder-move-options-modal\")\nexport class FormsFolderMoveOptionsModalElement extends UmbModalBaseElement<FormsFolderMoveOptionsModalData> {\n  #folderDetailRepository = new FormsFormFolderDetailRepository(this);\n\n  @state()\n  private _folderToMove?: UmbFolderModel | null;\n\n  @state()\n  private _canSubmit = false;\n\n  async connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.data?.unique) return;\n    const folderToMoveResponse =\n      await this.#folderDetailRepository.requestByUnique(this.data.unique);\n    this._folderToMove = folderToMoveResponse.data;\n  }\n\n  #onMoveToFolderSelectionChange() {\n    const moveToFolderSelection = this.#getMoveToFolderSelection();\n    this._canSubmit = moveToFolderSelection !== undefined;\n  }\n\n  #getMoveToFolderSelection() {\n    const moveToFolderElement = this.shadowRoot?.getElementById(\n      \"MoveToFolder\",\n    ) as UmbTreeElement;\n    return moveToFolderElement.getSelection()[0];\n  }\n\n  async #onSubmit(event: SubmitEvent) {\n    event.preventDefault();\n    if (!this.#folderDetailRepository)\n      throw new Error(\"Repository is not available\");\n    if (!this.data?.unique)\n      throw new Error(\"Unique identifier is not available\");\n\n    const form = event.target as HTMLFormElement;\n    if (!form) return;\n\n    const isValid = form.checkValidity();\n    if (!isValid) return;\n\n    const moveToFolder = this.#getMoveToFolderSelection();\n\n    const { error } = await this.#folderDetailRepository.moveFolder(\n      this.data.unique,\n      moveToFolder,\n    );\n\n    if (!error) {\n      // TODO: Review this - parentUnique isn't defined on UmbFolderModel but we do have it in the data.\n      const folderMovedFrom = this._folderToMove![\n        \"parentUnique\"\n      ] as unknown as UmbEntityUnique;\n      await this.#reloadFolder(folderMovedFrom);\n      await this.#reloadFolder(moveToFolder);\n\n      this._submitModal();\n    } else {\n      this._rejectModal();\n    }\n  }\n\n  async #reloadFolder(folderId: UmbEntityUnique) {\n    const reloadEvent = new UmbRequestReloadChildrenOfEntityEvent({\n      entityType: folderId\n        ? FORMS_FORM_FOLDER_ENTITY_TYPE\n        : FORMS_FORM_ROOT_ENTITY_TYPE,\n      unique: folderId || null,\n    });\n\n    const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n    eventContext?.dispatchEvent(reloadEvent);\n  }\n\n  render() {\n    return html`\n      <umb-body-layout\n        headline=${this.localize.term(\"formMove_folderMoveModalHeadline\")}\n      >\n        <uui-box>\n          <p>\n            ${unsafeHTML(\n              this.localize.term(\"formMove_title\", this._folderToMove?.name),\n            )}\n          </p>\n          <uui-form>\n            <form id=\"MoveFolder\" @submit=${this.#onSubmit}>\n              <uui-form-layout-item>\n                <umb-tree\n                  id=\"MoveToFolder\"\n                  alias=${FORMS_FORM_TREE_ALIAS}\n                  .props=${{\n                    hideTreeRoot: false,\n                    selectionConfiguration: {\n                      multiple: false,\n                    },\n                    selectableFilter: (item: UmbTreeItemModelBase) =>\n                      item.isFolder,\n                  }}\n                  @selection-change=${this.#onMoveToFolderSelectionChange}\n                ></umb-tree>\n              </uui-form-layout-item>\n            </form>\n          </uui-form>\n        </uui-box>\n        <uui-button\n          slot=\"actions\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=${this._rejectModal}\n          >${this.localize.term(\"general_cancel\")}</uui-button\n        >\n        <uui-button\n          form=\"MoveFolder\"\n          ?disabled=${!this._canSubmit}\n          slot=\"actions\"\n          type=\"submit\"\n          label=\"Move\"\n          look=\"primary\"\n          color=\"positive\"\n        ></uui-button>\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsFolderMoveOptionsModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"forms-folder-move-options-modal\": FormsFolderMoveOptionsModalElement;\n  }\n}\n"],"names":["_folderDetailRepository","_FormsFolderMoveOptionsModalElement_instances","onMoveToFolderSelectionChange_fn","getMoveToFolderSelection_fn","onSubmit_fn","reloadFolder_fn","FormsFolderMoveOptionsModalElement","UmbModalBaseElement","__privateAdd","FormsFormFolderDetailRepository","_a","folderToMoveResponse","__privateGet","html","unsafeHTML","__privateMethod","FORMS_FORM_TREE_ALIAS","item","moveToFolderSelection","event","form","moveToFolder","error","folderMovedFrom","folderId","reloadEvent","UmbRequestReloadChildrenOfEntityEvent","FORMS_FORM_FOLDER_ENTITY_TYPE","FORMS_FORM_ROOT_ENTITY_TYPE","eventContext","UMB_ACTION_EVENT_CONTEXT","__decorateClass","state","customElement","FormsFolderMoveOptionsModalElement$1"],"mappings":"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"}