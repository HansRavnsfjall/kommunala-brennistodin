{"version":3,"file":"form-create-options-modal.element.js","sources":["../../../../src/section/forms/entity-actions/create/modal/form-create-options-modal.element.ts"],"sourcesContent":["import {\n  FORMS_FORM_FOLDER_DETAIL_REPOSITORY_ALIAS,\n  FormsFormDetailRepository,\n} from \"../../../repository/index.js\";\nimport {\n  FORMS_FORM_ENTITY_TYPE,\n  FORMS_FORM_FOLDER_ENTITY_TYPE,\n  FORMS_FORM_ROOT_ENTITY_TYPE,\n} from \"../../../entities.js\";\nimport type { FormsFormCreateOptionsModalData } from \"./index.js\";\nimport {\n  html,\n  customElement,\n  state,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport {\n  UmbModalBaseElement,\n  UMB_MODAL_MANAGER_CONTEXT,\n} from \"@umbraco-cms/backoffice/modal\";\nimport { UMB_FOLDER_CREATE_MODAL } from \"@umbraco-cms/backoffice/tree\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport type { FormTemplateBase } from \"@umbraco-forms/generated\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\n\n@customElement(\"forms-form-create-options-modal\")\nexport class FormsFormCreateOptionsModalElement extends UmbModalBaseElement<FormsFormCreateOptionsModalData> {\n  #formDetailRepository = new FormsFormDetailRepository(this);\n\n  @state()\n  private _templates: Array<FormTemplateBase> = [];\n\n  async connectedCallback() {\n    super.connectedCallback();\n\n    const { data } = await this.#formDetailRepository.requestTemplates();\n    if (data) {\n      this._templates = data;\n    }\n  }\n\n  async #createFolder(event: PointerEvent) {\n    event.stopPropagation();\n    if (!this.data?.parent)\n      throw new Error(\"A parent is required to create a form\");\n\n    const modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\n    if (!modalManager) throw new Error(\"Modal manager not found\");\n\n    const folderModalHandler = modalManager.open(\n      this,\n      UMB_FOLDER_CREATE_MODAL,\n      {\n        data: {\n          folderRepositoryAlias: FORMS_FORM_FOLDER_DETAIL_REPOSITORY_ALIAS,\n          parent: this.data.parent,\n        },\n      },\n    );\n\n    const parent = this.data.parent;\n    folderModalHandler\n      ?.onSubmit()\n      .then(async () => {\n        this._submitModal();\n\n        const reloadEvent = new UmbRequestReloadChildrenOfEntityEvent({\n          entityType: parent.unique\n            ? FORMS_FORM_FOLDER_ENTITY_TYPE\n            : FORMS_FORM_ROOT_ENTITY_TYPE,\n          unique: parent.unique,\n        });\n\n        const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n        eventContext?.dispatchEvent(reloadEvent);\n      })\n      .catch(() => undefined);\n  }\n\n  #getCreateHref(template?: FormTemplateBase) {\n    let href = `section/forms/workspace/${FORMS_FORM_ENTITY_TYPE}/create/parent/${this.data?.parent.entityType}/${this.data?.parent.unique || \"null\"}`;\n    if (template) {\n      href =\n        href.replace(\"/create/\", \"/createFromTemplate/\") + \"/\" + template.alias;\n    }\n\n    return href;\n  }\n\n  render() {\n    return html`\n      <umb-body-layout headline=${this.localize.term(\"formCreate_title\")}>\n        <uui-box>\n          <uui-menu-item\n            href=${this.#getCreateHref()}\n            label=${this.localize.term(\"formCreate_newFormMenu\")}\n            @click=${this._submitModal}\n          >\n            <uui-icon slot=\"icon\" name=\"icon-autofill\"></uui-icon>\n          </uui-menu-item>\n          ${this._templates.map(\n            (template) =>\n              html`<uui-menu-item\n                href=${this.#getCreateHref(template)}\n                label=\"New ${template.name}...\"\n                @click=${this._submitModal}\n              >\n                <uui-icon slot=\"icon\" name=\"icon-autofill\"></uui-icon>\n              </uui-menu-item>`,\n          )}\n          <uui-menu-item\n            @click=${this.#createFolder}\n            label=${this.localize.term(\"formCreate_newFolderMenu\")}\n          >\n            <uui-icon slot=\"icon\" name=\"icon-folder\"></uui-icon>\n          </uui-menu-item>\n        </uui-box>\n        <uui-button\n          slot=\"actions\"\n          id=\"cancel\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=\"${this._rejectModal}\"\n          >${this.localize.term(\"general_cancel\")}</uui-button\n        >\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsFormCreateOptionsModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"forms-form-create-options-modal\": FormsFormCreateOptionsModalElement;\n  }\n}\n"],"names":["_formDetailRepository","_FormsFormCreateOptionsModalElement_instances","createFolder_fn","getCreateHref_fn","FormsFormCreateOptionsModalElement","UmbModalBaseElement","__privateAdd","FormsFormDetailRepository","data","__privateGet","html","__privateMethod","template","event","_a","modalManager","UMB_MODAL_MANAGER_CONTEXT","folderModalHandler","UMB_FOLDER_CREATE_MODAL","FORMS_FORM_FOLDER_DETAIL_REPOSITORY_ALIAS","parent","reloadEvent","UmbRequestReloadChildrenOfEntityEvent","FORMS_FORM_FOLDER_ENTITY_TYPE","FORMS_FORM_ROOT_ENTITY_TYPE","eventContext","UMB_ACTION_EVENT_CONTEXT","href","FORMS_FORM_ENTITY_TYPE","_b","__decorateClass","state","customElement","FormsFormCreateOptionsModalElement$1"],"mappings":";;;;;;;;;;;;;;;+TAAAA,GAAAC,GAAAC,GAAAC;AAyBO,IAAMC,IAAN,cAAiDC,EAAqD;AAAA,EAAtG,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,EAAA,MAAAL,CAAA,GACLK,EAAA,MAAAN,GAAwB,IAAIO,EAA0B,IAAI,CAAA,GAG1D,KAAQ,aAAsC,CAAA;AAAA,EAAC;AAAA,EAE/C,MAAM,oBAAoB;AACxB,UAAM,kBAAA;AAEN,UAAM,EAAE,MAAAC,EAAA,IAAS,MAAMC,EAAA,MAAKT,GAAsB,iBAAA;AAClD,IAAIQ,MACF,KAAK,aAAaA;AAAA,EACpB;AAAA,EAmDF,SAAS;AACP,WAAOE;AAAA,kCACuB,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA;AAAA;AAAA,mBAGrDC,EAAA,MAAKV,MAAL,KAAA,IAAA,CAAqB;AAAA,oBACpB,KAAK,SAAS,KAAK,wBAAwB,CAAC;AAAA,qBAC3C,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA,YAI1B,KAAK,WAAW;AAAA,MAChB,CAACW,MACCF;AAAA,uBACSC,EAAA,MAAKV,GAAAE,CAAA,EAAL,KAAA,MAAoBS,CAAA,CAAS;AAAA,6BACvBA,EAAS,IAAI;AAAA,yBACjB,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA,IAAA,CAI/B;AAAA;AAAA,qBAEUD,QAAKV,GAAAC,CAAA,CAAa;AAAA,oBACnB,KAAK,SAAS,KAAK,0BAA0B,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAQhD,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,oBAClC,KAAK,YAAY;AAAA,aACxB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA;AAAA,EAAA;AAKjD;AApGEF,IAAA,oBAAA,QAAA;AADKC,IAAA,oBAAA,QAAA;AAeCC,IAAa,eAACW,GAAqB;;AAEvC,MADAA,EAAM,gBAAA,GACF,GAACC,IAAA,KAAK,SAAL,QAAAA,EAAW;AACd,UAAM,IAAI,MAAM,uCAAuC;AAEzD,QAAMC,IAAe,MAAM,KAAK,WAAWC,CAAyB;AACpE,MAAI,CAACD,EAAc,OAAM,IAAI,MAAM,yBAAyB;AAE5D,QAAME,IAAqBF,EAAa;AAAA,IACtC;AAAA,IACAG;AAAA,IACA;AAAA,MACE,MAAM;AAAA,QACJ,uBAAuBC;AAAA,QACvB,QAAQ,KAAK,KAAK;AAAA,MAAA;AAAA,IACpB;AAAA,EACF,GAGIC,IAAS,KAAK,KAAK;AACzB,EAAAH,KAAA,QAAAA,EACI,WACD,KAAK,YAAY;AAChB,SAAK,aAAA;AAEL,UAAMI,IAAc,IAAIC,EAAsC;AAAA,MAC5D,YAAYF,EAAO,SACfG,IACAC;AAAA,MACJ,QAAQJ,EAAO;AAAA,IAAA,CAChB,GAEKK,IAAe,MAAM,KAAK,WAAWC,CAAwB;AACnE,IAAAD,KAAA,QAAAA,EAAc,cAAcJ;AAAA,EAAW,GAExC,MAAM,MAAA;AAAA;AACX;AAEAlB,IAAc,SAACS,GAA6B;;AAC1C,MAAIe,IAAO,2BAA2BC,CAAsB,mBAAkBd,IAAA,KAAK,SAAL,gBAAAA,EAAW,OAAO,UAAU,MAAIe,IAAA,KAAK,SAAL,gBAAAA,EAAW,OAAO,WAAU,MAAM;AAChJ,SAAIjB,MACFe,IACEA,EAAK,QAAQ,YAAY,sBAAsB,IAAI,MAAMf,EAAS,QAG/De;AACT;AAzDQG,EAAA;AAAA,EADPC,EAAA;AAAM,GAHI3B,EAIH,WAAA,cAAA,CAAA;AAJGA,IAAN0B,EAAA;AAAA,EADNE,EAAc,iCAAiC;AAAA,GACnC5B,CAAA;AAuGb,MAAA6B,IAAe7B;"}