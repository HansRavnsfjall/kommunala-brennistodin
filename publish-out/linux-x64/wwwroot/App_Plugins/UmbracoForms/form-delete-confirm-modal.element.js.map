{"version":3,"file":"form-delete-confirm-modal.element.js","sources":["../../../../src/section/forms/entity-actions/delete/modal/form-delete-confirm-modal.element.ts"],"sourcesContent":["import {\n  FORMS_FORM_FOLDER_ENTITY_TYPE,\n  FORMS_FORM_ROOT_ENTITY_TYPE,\n} from \"../../../entities.js\";\nimport { FormsFormDetailRepository } from \"../../../repository/index.js\";\nimport type { FormsFormDeleteConfirmModalData } from \"./index.js\";\nimport { html, customElement } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport type {\n  EntrySearchResultMetadata,\n  FormDesign,\n} from \"@umbraco-forms/generated\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\n\n@customElement(\"forms-form-delete-confirm-modal\")\nexport class FormsFormDeleteConfirmModalElement extends UmbModalBaseElement<FormsFormDeleteConfirmModalData> {\n  #formToDelete?: FormDesign | null;\n  #formRecordsMetadata?: EntrySearchResultMetadata | null;\n  #formHasRelations?: boolean | null;\n\n  #formDetailRepository = new FormsFormDetailRepository(this);\n\n  async connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.data?.unique) return;\n\n    const formToDeleteResponse =\n      await this.#formDetailRepository.requestByUnique(this.data.unique);\n    this.#formToDelete = formToDeleteResponse.data;\n\n    const formRecordsMetadataResponse =\n      await this.#formDetailRepository.requestRecordsMetaData(this.data.unique);\n    this.#formRecordsMetadata = formRecordsMetadataResponse.data;\n\n    const formHasRelationsResponse =\n      await this.#formDetailRepository.requestHasRelations(this.data.unique);\n    this.#formHasRelations = formHasRelationsResponse.data;\n\n    this.requestUpdate();\n  }\n\n  async #deleteForm(event: PointerEvent) {\n    event.stopPropagation();\n\n    if (this.data?.unique) {\n      const { data } = await this.#formDetailRepository.requestByUnique(\n        this.data.unique,\n      );\n      if (!data) throw new Error(\"Item not found.\");\n\n      await this.#formDetailRepository.delete(this.data.unique);\n\n      const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n      const eventArgs = {\n        entityType: data.parentUnique\n          ? FORMS_FORM_FOLDER_ENTITY_TYPE\n          : FORMS_FORM_ROOT_ENTITY_TYPE,\n        unique: data.parentUnique || null,\n      };\n      const reloadEvent = new UmbRequestReloadChildrenOfEntityEvent(eventArgs);\n      eventContext?.dispatchEvent(reloadEvent);\n    }\n    this._submitModal();\n  }\n\n  render() {\n    return html`\n      <umb-body-layout\n        headline=${this.localize.term(\"formDelete_modalHeadline\")}\n      >\n        <uui-box>\n          <p>\n            ${this.localize.term(\"formDelete_title\", this.#formToDelete?.name)}\n          </p>\n          <p><i>${this.localize.term(\"formDelete_timingNote\")}</i></p>\n          <p>${this.localize.term(\"formDelete_recordDeleteNote\")}</p>\n          <p>\n            ${this.#formRecordsMetadata?.count == 0\n              ? html`${this.localize.term(\"formDelete_noRecordDetail\")}`\n              : html`${this.localize.term(\n                  \"formDelete_recordDetail\",\n                  this.#formRecordsMetadata?.count,\n                  this.#formRecordsMetadata?.lastSubmittedDate,\n                )}`}\n          </p>\n          <p>\n            ${this.#formHasRelations\n              ? html`${this.localize.term(\"formDelete_deleteWarning\")}`\n              : html`${this.localize.term(\"formDelete_noReferencedMessage\")}`}\n          </p>\n        </uui-box>\n        <uui-button\n          slot=\"actions\"\n          id=\"cancel\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=\"${this._rejectModal}\"\n          >${this.localize.term(\"general_cancel\")}</uui-button\n        >\n        <uui-button\n          slot=\"actions\"\n          type=\"button\"\n          label=${this.localize.term(\"general_delete\")}\n          look=\"primary\"\n          color=\"danger\"\n          @click=${this.#deleteForm}\n        ></uui-button>\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsFormDeleteConfirmModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"forms-form-delete-confirm-modal\": FormsFormDeleteConfirmModalElement;\n  }\n}\n"],"names":["_formToDelete","_formRecordsMetadata","_formHasRelations","_formDetailRepository","_FormsFormDeleteConfirmModalElement_instances","deleteForm_fn","FormsFormDeleteConfirmModalElement","UmbModalBaseElement","__privateAdd","FormsFormDetailRepository","_a","formToDeleteResponse","__privateGet","__privateSet","formRecordsMetadataResponse","formHasRelationsResponse","html","_b","_c","_d","__privateMethod","event","data","eventContext","UMB_ACTION_EVENT_CONTEXT","eventArgs","FORMS_FORM_FOLDER_ENTITY_TYPE","FORMS_FORM_ROOT_ENTITY_TYPE","reloadEvent","UmbRequestReloadChildrenOfEntityEvent","__decorateClass","customElement","FormsFormDeleteConfirmModalElement$1"],"mappings":"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"}