{"version":3,"file":"form-import-modal.element.js","sources":["../../../../src/section/forms/entity-actions/import/modal/form-import-modal.element.ts"],"sourcesContent":["import { FORMS_FORM_ENTITY_TYPE } from \"../../../entities.js\";\nimport type { FormsFormImportModalData } from \"./index.js\";\nimport {\n  html,\n  customElement,\n  state,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport { UmbTemporaryFileRepository } from \"@umbraco-cms/backoffice/temporary-file\";\nimport { FormService } from \"@umbraco-forms/generated\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport { tryExecute } from \"@umbraco-cms/backoffice/resources\";\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\nimport type { UmbInputUploadFieldElement } from \"@umbraco-cms/backoffice/media\";\n\n// TODO => sync tree after import. It was working briefly, then stopped. Shrugs.\n\nconst elementName = \"forms-form-import-modal\";\n\n@customElement(elementName)\nexport class FormsFormImportModalElement extends UmbModalBaseElement<FormsFormImportModalData> {\n  #temporaryFileRepository = new UmbTemporaryFileRepository(this);\n\n  @state()\n  private _temporaryFileKey?: string | null | undefined;\n\n  async #import() {\n    if (!this._temporaryFileKey) throw new Error(\"file key is missing\");\n\n    const { data, error } = await tryExecute(\n      this,\n      FormService.postFormImport({\n        body: {\n          fileKey: this._temporaryFileKey,\n          folderId: this.data?.unique,\n        },\n      }),\n      {\n        disableNotifications: true,\n      },\n    );\n\n    if (error) {\n      const notificationContext = await this.getContext(\n        UMB_NOTIFICATION_CONTEXT,\n      );\n      notificationContext?.peek(\"danger\", {\n        data: { message: \"Unable to import form.\" },\n      });\n\n      this._rejectModal();\n    }\n\n    const event = new UmbRequestReloadChildrenOfEntityEvent({\n      entityType: FORMS_FORM_ENTITY_TYPE,\n      unique: null,\n    });\n\n    const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n    eventContext?.dispatchEvent(event);\n\n    history.pushState(\n      {},\n      \"\",\n      `/umbraco/section/forms/workspace/${FORMS_FORM_ENTITY_TYPE}/edit/${data}`,\n    );\n\n    this._submitModal();\n  }\n\n  async #handleFileSelection(\n    event: CustomEvent & { target: UmbInputUploadFieldElement },\n  ) {\n    const temporaryFileKey = event.target.value.temporaryFileId;\n\n    // delete previous if no value - file was removed\n    if (!temporaryFileKey && this._temporaryFileKey) {\n      await this.#temporaryFileRepository.delete(this._temporaryFileKey);\n    }\n\n    this._temporaryFileKey = temporaryFileKey;\n  }\n\n  render() {\n    return html`\n      <umb-body-layout .headline=${this.localize.term(\"general_import\")}>\n        <uui-box\n          ><p>${this.localize.term(\"formImport_importInstruction1\")}</p>\n          <umb-input-upload-field\n            @change=${this.#handleFileSelection}\n            ?multiple=${false}\n            .fileExtensions=${[\"json\"]}\n            .keys=${this._temporaryFileKey ? [this._temporaryFileKey] : []}\n          ></umb-input-upload-field>\n          <p>${this.localize.term(\"formImport_importInstruction2\")}</p></uui-box\n        >\n        <uui-button\n          slot=\"actions\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=\"${this._rejectModal}\"\n        ></uui-button>\n        <uui-button\n          slot=\"actions\"\n          label=${this.localize.term(\"general_import\")}\n          look=\"primary\"\n          color=\"positive\"\n          @click=${this.#import}\n        ></uui-button>\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsFormImportModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsFormImportModalElement;\n  }\n}\n"],"names":["_temporaryFileRepository","_FormsFormImportModalElement_instances","import_fn","handleFileSelection_fn","elementName","FormsFormImportModalElement","UmbModalBaseElement","__privateAdd","UmbTemporaryFileRepository","html","__privateMethod","data","error","tryExecute","FormService","_a","notificationContext","UMB_NOTIFICATION_CONTEXT","event","UmbRequestReloadChildrenOfEntityEvent","FORMS_FORM_ENTITY_TYPE","eventContext","UMB_ACTION_EVENT_CONTEXT","temporaryFileKey","__privateGet","__decorateClass","state","customElement","FormsFormImportModalElement$1"],"mappings":";;;;;;;;;;;;;;+TAAAA,GAAAC,GAAAC,GAAAC;AAkBA,MAAMC,IAAc;AAGb,IAAMC,IAAN,cAA0CC,EAA8C;AAAA,EAAxF,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,EAAA,MAAAN,CAAA,GACLM,EAAA,MAAAP,GAA2B,IAAIQ,EAA2B,IAAI,CAAA;AAAA,EAAA;AAAA,EA8D9D,SAAS;AACP,WAAOC;AAAA,mCACwB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA,gBAEvD,KAAK,SAAS,KAAK,+BAA+B,CAAC;AAAA;AAAA,sBAE7CC,QAAKT,GAAAE,CAAA,CAAoB;AAAA,wBACvB,EAAK;AAAA,8BACC,CAAC,MAAM,CAAC;AAAA,oBAClB,KAAK,oBAAoB,CAAC,KAAK,iBAAiB,IAAI,CAAA,CAAE;AAAA;AAAA,eAE3D,KAAK,SAAS,KAAK,+BAA+B,CAAC;AAAA;AAAA;AAAA;AAAA,kBAIhD,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,oBAClC,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA,kBAInB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,mBAGnCO,QAAKT,GAAAC,CAAA,CAAO;AAAA;AAAA;AAAA;AAAA,EAAA;AAK/B;AA1FEF,IAAA,oBAAA,QAAA;AADKC,IAAA,oBAAA,QAAA;AAMCC,IAAO,iBAAG;;AACd,MAAI,CAAC,KAAK,kBAAmB,OAAM,IAAI,MAAM,qBAAqB;AAElE,QAAM,EAAE,MAAAS,GAAM,OAAAC,EAAA,IAAU,MAAMC;AAAA,IAC5B;AAAA,IACAC,EAAY,eAAe;AAAA,MACzB,MAAM;AAAA,QACJ,SAAS,KAAK;AAAA,QACd,WAAUC,IAAA,KAAK,SAAL,gBAAAA,EAAW;AAAA,MAAA;AAAA,IACvB,CACD;AAAA,IACD;AAAA,MACE,sBAAsB;AAAA,IAAA;AAAA,EACxB;AAGF,MAAIH,GAAO;AACT,UAAMI,IAAsB,MAAM,KAAK;AAAA,MACrCC;AAAA,IAAA;AAEF,IAAAD,KAAA,QAAAA,EAAqB,KAAK,UAAU;AAAA,MAClC,MAAM,EAAE,SAAS,yBAAA;AAAA,IAAyB,IAG5C,KAAK,aAAA;AAAA,EAAa;AAGpB,QAAME,IAAQ,IAAIC,EAAsC;AAAA,IACtD,YAAYC;AAAA,IACZ,QAAQ;AAAA,EAAA,CACT,GAEKC,IAAe,MAAM,KAAK,WAAWC,CAAwB;AACnE,EAAAD,KAAA,QAAAA,EAAc,cAAcH,IAE5B,QAAQ;AAAA,IACN,CAAA;AAAA,IACA;AAAA,IACA,oCAAoCE,CAAsB,SAAST,CAAI;AAAA,EAAA,GAGzE,KAAK,aAAA;AACP;AAEMR,IAAoB,eACxBe,GACA;AACA,QAAMK,IAAmBL,EAAM,OAAO,MAAM;AAG5C,EAAI,CAACK,KAAoB,KAAK,qBAC5B,MAAMC,EAAA,MAAKxB,CAAA,EAAyB,OAAO,KAAK,iBAAiB,GAGnE,KAAK,oBAAoBuB;AAC3B;AAzDQE,EAAA;AAAA,EADPC,EAAA;AAAM,GAHIrB,EAIH,WAAA,qBAAA,CAAA;AAJGA,IAANoB,EAAA;AAAA,EADNE,EAAcvB,CAAW;AAAA,GACbC,CAAA;AA6Fb,MAAAuB,IAAevB;"}