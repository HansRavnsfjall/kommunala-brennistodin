{"version":3,"file":"form-move-options-modal.element.js","sources":["../../../../src/section/forms/entity-actions/move/modal/form-move-options-modal.element.ts"],"sourcesContent":["import { FormsFormDetailRepository } from \"../../../repository/index.js\";\nimport { FORMS_FORM_TREE_ALIAS } from \"../../../tree/manifests.js\";\nimport {\n  FORMS_FORM_FOLDER_ENTITY_TYPE,\n  FORMS_FORM_ROOT_ENTITY_TYPE,\n} from \"../../../entities.js\";\nimport type { FormsFormMoveOptionsModalData } from \"./index.js\";\nimport {\n  html,\n  customElement,\n  state,\n  unsafeHTML,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport type { FormDesign } from \"@umbraco-forms/generated\";\nimport type {\n  UmbTreeElement,\n  UmbTreeItemModelBase,\n} from \"@umbraco-cms/backoffice/tree\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport type { UmbEntityUnique } from \"@umbraco-cms/backoffice/entity\";\n\n@customElement(\"forms-form-move-options-modal\")\nexport class FormsFormMoveOptionsModalElement extends UmbModalBaseElement<FormsFormMoveOptionsModalData> {\n  #formDetailRepository = new FormsFormDetailRepository(this);\n\n  @state()\n  private _formToMove?: FormDesign | null;\n\n  @state()\n  private _canSubmit = false;\n\n  async connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.data?.unique) return;\n    const { data } = await this.#formDetailRepository.requestByUnique(\n      this.data.unique,\n    );\n    this._formToMove = data;\n  }\n\n  #onMoveToFolderSelectionChange() {\n    const moveToFolderSelection = this.#getMoveToFolderSelection();\n    this._canSubmit = moveToFolderSelection !== undefined;\n  }\n\n  #getMoveToFolderSelection() {\n    const moveToFolderElement = this.shadowRoot?.getElementById(\n      \"MoveToFolder\",\n    ) as UmbTreeElement;\n    return moveToFolderElement.getSelection()[0];\n  }\n\n  async #onSubmit(event: SubmitEvent) {\n    event.preventDefault();\n    if (!this.#formDetailRepository)\n      throw new Error(\"Repository is not available\");\n    if (!this.data?.unique)\n      throw new Error(\"Unique identifier is not available\");\n\n    const form = event.target as HTMLFormElement;\n    if (!form) return;\n\n    const isValid = form.checkValidity();\n    if (!isValid) return;\n\n    const moveToFolder = this.#getMoveToFolderSelection();\n\n    const { error } = await this.#formDetailRepository.moveForm(\n      this.data.unique,\n      moveToFolder,\n    );\n\n    if (!error) {\n      await this.#reloadFolder(\n        this._formToMove?.parentUnique as UmbEntityUnique,\n      );\n      await this.#reloadFolder(moveToFolder);\n\n      this._submitModal();\n    } else {\n      this._rejectModal();\n    }\n  }\n\n  async #reloadFolder(folderId: UmbEntityUnique) {\n    const reloadEvent = new UmbRequestReloadChildrenOfEntityEvent({\n      entityType: folderId\n        ? FORMS_FORM_FOLDER_ENTITY_TYPE\n        : FORMS_FORM_ROOT_ENTITY_TYPE,\n      unique: folderId,\n    });\n\n    const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n    eventContext?.dispatchEvent(reloadEvent);\n  }\n\n  render() {\n    return html`\n      <umb-body-layout\n        headline=${this.localize.term(\"formMove_formMoveModalHeadline\")}\n      >\n        <uui-box>\n          <p>\n            ${unsafeHTML(\n              this.localize.term(\"formMove_title\", this._formToMove?.name),\n            )}\n          </p>\n          <uui-form>\n            <form id=\"MoveForm\" @submit=\"${this.#onSubmit}\">\n              <uui-form-layout-item>\n                <umb-tree\n                  id=\"MoveToFolder\"\n                  alias=\"${FORMS_FORM_TREE_ALIAS}\"\n                  .props=${{\n                    hideTreeRoot: false,\n                    selectionConfiguration: {\n                      multiple: false,\n                    },\n                    selectableFilter: (item: UmbTreeItemModelBase) =>\n                      item.isFolder,\n                  }}\n                  @selection-change=${this.#onMoveToFolderSelectionChange}\n                ></umb-tree>\n              </uui-form-layout-item>\n            </form>\n          </uui-form>\n        </uui-box>\n        <uui-button\n          slot=\"actions\"\n          id=\"cancel\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=\"${this._rejectModal}\"\n          >${this.localize.term(\"general_cancel\")}</uui-button\n        >\n        <uui-button\n          form=\"MoveForm\"\n          ?disabled=${!this._canSubmit}\n          slot=\"actions\"\n          type=\"submit\"\n          label=${this.localize.term(\"formMove_moveButtonLabel\")}\n          look=\"primary\"\n          color=\"positive\"\n        ></uui-button>\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsFormMoveOptionsModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"forms-form-move-options-modal\": FormsFormMoveOptionsModalElement;\n  }\n}\n"],"names":["_formDetailRepository","_FormsFormMoveOptionsModalElement_instances","onMoveToFolderSelectionChange_fn","getMoveToFolderSelection_fn","onSubmit_fn","reloadFolder_fn","FormsFormMoveOptionsModalElement","UmbModalBaseElement","__privateAdd","FormsFormDetailRepository","_a","data","__privateGet","html","unsafeHTML","__privateMethod","FORMS_FORM_TREE_ALIAS","item","moveToFolderSelection","event","form","moveToFolder","error","_b","folderId","reloadEvent","UmbRequestReloadChildrenOfEntityEvent","FORMS_FORM_FOLDER_ENTITY_TYPE","FORMS_FORM_ROOT_ENTITY_TYPE","eventContext","UMB_ACTION_EVENT_CONTEXT","__decorateClass","state","customElement","FormsFormMoveOptionsModalElement$1"],"mappings":"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"}