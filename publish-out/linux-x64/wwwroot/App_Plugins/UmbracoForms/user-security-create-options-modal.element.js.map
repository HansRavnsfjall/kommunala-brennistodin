{"version":3,"file":"user-security-create-options-modal.element.js","sources":["../../../../src/section/security/entity-actions/create/modal/user-security-create-options-modal.element.ts"],"sourcesContent":["import {\n  FORMS_SECURITY_USER_ENTITY_TYPE,\n  FORMS_SECURITY_USER_FOLDER_ENTITY_TYPE,\n} from \"../../../entities.js\";\nimport { FormsSecurityUserDetailRepository } from \"../../../repository/index.js\";\nimport {\n  html,\n  customElement,\n  when,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport type { UserItemResponseModel } from \"@umbraco-cms/backoffice/external/backend-api\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport type { UUISelectElement } from \"@umbraco-cms/backoffice/external/uui\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\n\nconst elementName = \"forms-user-security-create-options-modal\";\n\n@customElement(elementName)\nexport class FormsUserSecurityCreateOptionsModalElement extends UmbModalBaseElement {\n  #users: Array<UserItemResponseModel> = [];\n  #repository = new FormsSecurityUserDetailRepository(this);\n\n  constructor() {\n    super();\n\n    this.#initialize();\n  }\n\n  async #initialize() {\n    const { data } = await this.#repository.requestUsersToAssign();\n    this.#users = data;\n\n    this.requestUpdate();\n  }\n\n  async #onCreateClick() {\n    const selectedUserId = this.#getSelectedUserId();\n    await this.#createUser(selectedUserId);\n\n    this.#reloadTree();\n    this._submitModal();\n\n    // Redirect to created user screen.\n    history.pushState(\n      {},\n      \"\",\n      `/umbraco/section/forms/workspace/${FORMS_SECURITY_USER_ENTITY_TYPE}/edit/${selectedUserId}/view/permissions`,\n    );\n  }\n\n  #getSelectedUserId() {\n    const selectElement = this.shadowRoot?.getElementById(\n      \"users\",\n    ) as UUISelectElement;\n    return selectElement.value.toString();\n  }\n\n  async #createUser(userId: string) {\n    const { data } = await this.#repository.createScaffold({ unique: userId });\n    if (data) {\n      await this.#repository.create(data, null);\n    }\n  }\n\n  async #reloadTree() {\n    const reloadEvent = new UmbRequestReloadChildrenOfEntityEvent({\n      entityType: FORMS_SECURITY_USER_FOLDER_ENTITY_TYPE,\n      unique: \"207c2294-970b-4e1f-82fd-ae8996ef171d\", // Matches Umbraco.Forms.Web.Controllers.ManagementApi.Security.Tree.SecurityTreeControllerBase.UsersFolderId\n    });\n\n    const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n    eventContext?.dispatchEvent(reloadEvent);\n  }\n\n  render() {\n    return html`\n      <umb-body-layout\n        headline=${this.localize.term(\"formSecurity_createTitle\")}\n      >\n        <uui-box>\n          <p>${this.localize.term(\"formSecurity_createUserRecordNote\")}</p>\n          ${when(\n            this.#users.length === 0,\n            () =>\n              html`<p>\n                ${this.localize.term(\"formSecurity_allUsersHaveRecords\")}\n              </p>`,\n          )}\n          ${when(\n            this.#users.length > 0,\n            () => html`\n              <uui-select\n                id=\"users\"\n                label=\"User\"\n                .options=${this.#users.map((u) => ({\n                  name: u.name,\n                  value: u.id,\n                }))}\n              ></uui-select>\n            `,\n          )}\n        </uui-box>\n        <uui-button\n          slot=\"actions\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=${this._rejectModal}\n        ></uui-button>\n        ${when(\n          this.#users.length > 0,\n          () => html`\n            <uui-button\n              slot=\"actions\"\n              label=${this.localize.term(\"general_create\")}\n              look=\"primary\"\n              color=\"positive\"\n              @click=${this.#onCreateClick}\n            ></uui-button>\n          `,\n        )}\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsUserSecurityCreateOptionsModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsUserSecurityCreateOptionsModalElement;\n  }\n}\n"],"names":["_users","_repository","_FormsUserSecurityCreateOptionsModalElement_instances","initialize_fn","onCreateClick_fn","getSelectedUserId_fn","createUser_fn","reloadTree_fn","elementName","FormsUserSecurityCreateOptionsModalElement","UmbModalBaseElement","__privateAdd","FormsSecurityUserDetailRepository","__privateMethod","html","when","__privateGet","u","data","__privateSet","selectedUserId","FORMS_SECURITY_USER_ENTITY_TYPE","_a","userId","reloadEvent","UmbRequestReloadChildrenOfEntityEvent","FORMS_SECURITY_USER_FOLDER_ENTITY_TYPE","eventContext","UMB_ACTION_EVENT_CONTEXT","__decorateClass","customElement","FormsUserSecurityCreateOptionsModalElement$1"],"mappings":"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"}