{"version":3,"file":"save.action-B9_Aackz.js","sources":["../../../src/packages/documents/documents/workspace/actions/save.action.ts"],"sourcesContent":["import { UMB_DOCUMENT_WORKSPACE_CONTEXT } from '../document-workspace.context-token.js';\r\nimport type UmbDocumentWorkspaceContext from '../document-workspace.context.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport {\r\n\tUmbSaveWorkspaceAction,\r\n\ttype MetaWorkspaceAction,\r\n\ttype UmbSaveWorkspaceActionArgs,\r\n\ttype UmbWorkspaceActionDefaultKind,\r\n} from '@umbraco-cms/backoffice/workspace';\r\n\r\nexport class UmbDocumentSaveWorkspaceAction\r\n\textends UmbSaveWorkspaceAction<MetaWorkspaceAction, UmbDocumentWorkspaceContext>\r\n\timplements UmbWorkspaceActionDefaultKind<MetaWorkspaceAction>\r\n{\r\n\tconstructor(\r\n\t\thost: UmbControllerHost,\r\n\t\targs: UmbSaveWorkspaceActionArgs<MetaWorkspaceAction, UmbDocumentWorkspaceContext>,\r\n\t) {\r\n\t\tsuper(host, { workspaceContextToken: UMB_DOCUMENT_WORKSPACE_CONTEXT, ...args });\r\n\t}\r\n\r\n\tasync hasAdditionalOptions() {\r\n\t\tawait this._retrieveWorkspaceContext;\r\n\t\tconst variantOptions = await this.observe(this._workspaceContext!.variantOptions)\r\n\t\t\t.asPromise()\r\n\t\t\t.catch(() => undefined);\r\n\t\tconst cultureVariantOptions = variantOptions?.filter((option) => option.culture);\r\n\t\treturn cultureVariantOptions ? cultureVariantOptions?.length > 1 : false;\r\n\t}\r\n\r\n\toverride _gotWorkspaceContext() {\r\n\t\tsuper._gotWorkspaceContext();\r\n\t\tthis.#observeVariants();\r\n\t}\r\n\r\n\t#observeVariants() {\r\n\t\tthis.observe(\r\n\t\t\tthis._workspaceContext?.variants,\r\n\t\t\t(variants) => {\r\n\t\t\t\tconst allVariantsAreReadOnly =\r\n\t\t\t\t\tvariants?.filter((variant) =>\r\n\t\t\t\t\t\tthis._workspaceContext!.readOnlyGuard.getIsPermittedForVariant(UmbVariantId.Create(variant)),\r\n\t\t\t\t\t).length === variants?.length;\r\n\t\t\t\tif (allVariantsAreReadOnly) {\r\n\t\t\t\t\tthis.disable();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.enable();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'saveWorkspaceActionVariantsObserver',\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentSaveWorkspaceAction as api };\r\n"],"names":["UmbDocumentSaveWorkspaceAction","UmbSaveWorkspaceAction","host","args","UMB_DOCUMENT_WORKSPACE_CONTEXT","cultureVariantOptions","option","#observeVariants","variants","variant","UmbVariantId"],"mappings":";;;AAWO,MAAMA,UACJC,EAET;AAAA,EACC,YACCC,GACAC,GACC;AACD,UAAMD,GAAM,EAAE,uBAAuBE,GAAgC,GAAGD,GAAM;AAAA,EAAA;AAAA,EAG/E,MAAM,uBAAuB;AAC5B,UAAM,KAAK;AAIX,UAAME,KAHiB,MAAM,KAAK,QAAQ,KAAK,kBAAmB,cAAc,EAC9E,UAAU,EACV,MAAM,MAAM;AAAA,KAAS,IACuB,OAAO,CAACC,MAAWA,EAAO,OAAO;AACxE,WAAAD,IAAwBA,GAAuB,SAAS,IAAI;AAAA,EAAA;AAAA,EAG3D,uBAAuB;AAC/B,UAAM,qBAAqB,GAC3B,KAAKE,GAAiB;AAAA,EAAA;AAAA,EAGvBA,KAAmB;AACb,SAAA;AAAA,MACJ,KAAK,mBAAmB;AAAA,MACxB,CAACC,MAAa;AAKb,QAHCA,GAAU;AAAA,UAAO,CAACC,MACjB,KAAK,kBAAmB,cAAc,yBAAyBC,EAAa,OAAOD,CAAO,CAAC;AAAA,QAAA,EAC1F,WAAWD,GAAU,SAEvB,KAAK,QAAQ,IAEb,KAAK,OAAO;AAAA,MAEd;AAAA,MACA;AAAA,IACD;AAAA,EAAA;AAEF;"}