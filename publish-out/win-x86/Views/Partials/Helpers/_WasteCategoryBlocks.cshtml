@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@using Umbraco.Cms.Core.Models
@using Umbraco.Cms.Core.Models.PublishedContent
@using Umbraco.Cms.Core.Strings
@using Umbraco.Extensions

@{
    // Always read from this specific node (GUID)
    var sourceRoot = Umbraco.Content(new Guid("d3114123-500a-4654-b7cd-d72bf854695d"));

    var items = sourceRoot?
        .ChildrenOfType("bolkurSkiljivegleiding")
        .Where(x => x.IsVisible())
        .ToList()
        ?? new List<IPublishedContent>();
}

@if (items.Any())
{
    <style>
        /* --- Responsive grid --- */
        .bolkur-grid .bolkur-item {
            display: flex;
            align-items: stretch;
            height: 100%;
            text-decoration: none;
            color: inherit;
            transition: transform .12s ease, box-shadow .12s ease;
        }
        .bolkur-grid .bolkur-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 .25rem .75rem rgba(0,0,0,.06);
        }

        /* Left pictogram square */
        .bolkur-icon {
            width: 8rem;
            min-width: 8rem;
            aspect-ratio: 1/1;
            display: grid;
            place-items: center;
            background: #ffffff; /* neutral background for SVGs */
        }
        .bolkur-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Right text panel */
        .bolkur-panel {
            background-color: #f5ede5; /* beige */
            padding: 1rem 1.25rem;
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .bolkur-panel h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: .25rem;
        }
        .bolkur-panel p {
            margin: 0;
            color: #2b2b2b;
            opacity: .85;
        }

        /* Responsive sizing */
        @@media (max-width: 575.98px) {
            .bolkur-icon {
                width: 6.5rem;
                min-width: 6.5rem;
            }
            .bolkur-panel {
                padding: .875rem 1rem;
            }
        }
    </style>

    <div class="container my-4 bolkur-grid">
      <div class="row">
        <div class="col-12">
          <h2 class="bolkar_head">
            Bólkar
          </h2>
        </div>
      </div>

      <div class="row g-4 row-cols-1 row-cols-md-2 row-cols-lg-3">
        @foreach (var child in items)
        {
            var title = child.Name;

            // Prefer HasValue + IHtmlEncodedString for RTE
            var hasDesc = child.HasValue("lysing", fallback: Fallback.ToLanguage);
            IHtmlEncodedString? desc = hasDesc
                ? child.Value<IHtmlEncodedString>("lysing", fallback: Fallback.ToLanguage)
                : null;

            var media = child.Value<MediaWithCrops>("piktogram");
            var imgUrl = media?.GetCropUrl(width: 300, height: 300, preferFocalPoint: true) ?? media?.Url();
            var alt    = (media?.Value<string>("altText"))?.Trim();
            if (string.IsNullOrWhiteSpace(alt)) alt = media?.Name ?? title;

            <div class="col">
                <a href="@child.Url()" class="bolkur-item">
                    <!-- Left pictogram -->
                    <div class="bolkur-icon">
                        @if (!string.IsNullOrWhiteSpace(imgUrl))
                        {
                            <img src="@imgUrl" alt="@alt" loading="lazy" />
                        }
                    </div>

                    <!-- Right panel -->
                    <div class="bolkur-panel">
                        <h3>@title</h3>
                        @if (hasDesc && desc != null)
                        {
                            @desc  <!-- Renders RTE HTML as-is; don't wrap in <p> -->
                        }
                    </div>
                </a>
            </div>
        }
      </div>
    </div>
}
else
{
    <div class="container my-4">
        <div class="alert alert-info mb-0">
            Einki innihald er at vísa enn.
        </div>
    </div>
}
