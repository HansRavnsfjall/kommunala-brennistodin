@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@using System.Globalization
@using Umbraco.Cms.Core.Models.Blocks
@using Umbraco.Cms.Core.Models.PublishedContent
@using Kob.ViewModels

@{
    Layout = "master.cshtml";
    ViewBag.Title = Model?.Name;
}

@{
    var culture = CultureInfo.CurrentUICulture?.Name;

    var blocks = Model.Value<BlockListModel>(
        "modul",
        culture: culture,
        fallback: Fallback.ToLanguage
    );

    if (blocks == null || !blocks.Any())
    {
        blocks = Model.Value<BlockListModel>(
            "modul",
            culture: culture,
            fallback: Fallback.ToAncestors
        );
    }
}
<div class="container">
<div class="row">
<h1 class="emphead">Starvsfólk</h1>
</div>
@if (blocks != null && blocks.Any())
{
    @await Html.PartialAsync(
        "~/Views/Partials/Helpers/RenderBlockList.cshtml",
        new Kob.ViewModels.BlockListRenderModel
        {
            Blocks = blocks,
            Scope = Model.ContentType.Alias,
            FallbackView = "~/Views/Partials/BlockList/Default.cshtml"
        }
    )
}
</div>
      
<style>
  :root {
    --sf-accent: #476b2e;         /* green color from your mock */
    --sf-border: rgba(0,0,0,.25); /* subtle border */
  }

  .sf-hidden {
    display: none !important;
  }

  /* Filter wrapper placed above the first section */
  .sf-filter-wrap {
    position: relative; /* keep normal DOM flow before the first section */
    margin-bottom: 2rem;
  }

  /* “DEILD” label styling */
  .sf-filter-label {
    display: block;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--sf-accent);
    letter-spacing: .02em;
    margin-bottom: .5rem;
  }

  /* Select shell for custom arrow */
  .sf-select-shell {
    position: relative;
    display: inline-block;
    width: 100%;
   }

  .sf-select-shell::after {
    content: "▾";
    position: absolute;
    right: 1.25rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 20px;
    color: var(--sf-accent);
    pointer-events: none;
  }

  /* Dropdown style (matches your screenshot) */
  .sf-filter {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    display: block;
    width: 100%;
    height: 70px;
    border: 1px solid var(--sf-border);
    background: #fff;
    font-size: 22px;
    color: #111;
    padding: 0 3rem 0 1.5rem;
    line-height: 70px;
    border-radius: 0;
  }

  .sf-filter:focus {
    outline: none;
    border-color: var(--sf-accent);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--sf-accent) 20%, transparent);
  }

  /* Position adjustment: 100px above first section */
  .sf-filter-container {
    position: relative;
    top: -100px;
    display: flex;
    justify-content: flex-end; /* align to the right */
  }
  
  .sf-filter-wrap{
    width: 100%;
  max-width: 636px;

  }
</style>

<script>
(function () {
  // Helper: normalize text
  const norm = s =>
    (s || "")
      .trim()
      .toLocaleLowerCase("fo-FO")
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");

  const sections = Array.from(document.querySelectorAll(".starvsfolkadeild"));
  if (!sections.length) return;

  const items = sections.map(sec => {
    const h2 = sec.querySelector("h2");
    const title = (h2 ? h2.textContent : "").trim();
    sec.dataset.sfTitle = norm(title);
    return { section: sec, title, key: norm(title) };
  });

  const seen = new Set();
  const options = items.filter(it => {
    if (!it.title || seen.has(it.key)) return false;
    seen.add(it.key);
    return true;
  });

  // Build the filter UI
  const container = document.createElement("div");
  container.className = "sf-filter-container";

  const wrap = document.createElement("div");
  wrap.className = "sf-filter-wrap";

  const label = document.createElement("div");
  label.className = "sf-filter-label";
  label.textContent = "DEILD";

  const shell = document.createElement("div");
  shell.className = "sf-select-shell";

  const select = document.createElement("select");
  select.className = "sf-filter";
  select.id = "sf-filter-select";
  select.setAttribute("aria-label", "Vel deild");

  const optAll = document.createElement("option");
  optAll.value = "";
  optAll.textContent = "Vís øll";
  select.appendChild(optAll);

  options.forEach(it => {
    const o = document.createElement("option");
    o.value = it.key;
    o.textContent = it.title;
    select.appendChild(o);
  });

  shell.appendChild(select);
  wrap.appendChild(label);
  wrap.appendChild(shell);
  container.appendChild(wrap);

  // Insert BEFORE the first section, not inside it
  const first = sections[0];
  first.parentNode.insertBefore(container, first);

  // Filtering logic
  const showAll = () => sections.forEach(s => s.classList.remove("sf-hidden"));
  const showOnlyKey = (key) =>
    sections.forEach(s =>
      s.dataset.sfTitle === key
        ? s.classList.remove("sf-hidden")
        : s.classList.add("sf-hidden")
    );

  select.addEventListener("change", () => {
    const val = select.value;
    if (!val) showAll();
    else showOnlyKey(val);
  });
})();
</script>

