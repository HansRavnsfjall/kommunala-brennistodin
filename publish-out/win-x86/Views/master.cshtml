@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage

@using System
@using System.Linq
@using Umbraco.Extensions
@using Umbraco.Cms.Core.Models
@using Umbraco.Cms.Core.Models.Blocks

@{
    Layout = null;

    // Get siteSettings by GUID
    var siteSettings = Umbraco.Content(new Guid("15c5e518-a70b-4279-a0e9-8148eaac356c"));

    var datuverndLink = siteSettings?.Value<Link>("datuverndLeinki");

    // Richtext "bustadur"
    var bustadur = siteSettings?.Value("bustadur");

    // Block list "leinki"
    var footerLinks = siteSettings?.Value<BlockListModel>("leinki") ?? BlockListModel.Empty;
}
<!doctype html>
<html lang="fo">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <title>@(ViewBag.Title ?? Model?.Name ?? "Kommunala Brennistøðin – Endurnýtsla")</title>

<link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
<link rel="shortcut icon" href="/favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="KOB" />
<link rel="manifest" href="/favicon/site.webmanifest" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="~/css/custom.css" asp-append-version="true" />


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@100..900&display=swap&family=Indie+Flower&display=swap" rel="stylesheet">
  @RenderSection("Head", required: false)
</head>
<body>

  <!-- ===== Thin topbar (right side) ===== -->
  <div class="topbar">
    <div class="container">
      <div class="d-flex justify-content-end topbar-right">
        <a class="lang-pill" href="#">EN</a>
        <a href="#" aria-label="Search">
          <svg class="nav-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.2-4.2"/></svg>
        </a>
        <a href="#" aria-label="Login">
          <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5z"/><path d="M3 22a9 9 0 0 1 18 0"/></svg>
        </a>
      </div>
    </div>
  </div>
@await Html.PartialAsync("~/Views/Partials/Shared/_MainNav.cshtml")


  <!-- ===== Page content goes here ===== -->
  <main id="main">
    @RenderBody()
  </main>

 <!-- ===== Footer ===== -->
  <footer>
    <div class="container">
      <div class="row logo-row">
        <div class="foot-brand col-12">
          <img src="~/assets/footer-logo.svg" alt="" />
        </div>
      </div>
      <div class="row gy-4">
        <div class="col-md-4">
        @bustadur
        </div>
        <div class="col-6 col-md-4">
           @if (footerLinks.Any())
    {
        foreach (var block in footerLinks)
        {
            var content = block.Content;

            // Try single Link type first
            var link = content.Value<Link>("leinkiElement");

            if (link != null && !string.IsNullOrWhiteSpace(link.Url))
            {
                <a class="foot-link d-block"
                   href="@link.Url"
                   target="@(link.Target ?? "_self")">
                    @(link.Name ?? link.Url)
                </a>
            }
            }
            }
        </div>
        <div class="col-md-4 ms-auto">
          <div class="fw-800 mb-2">Fylg okkum</div>
          <div class="social social-icons d-flex gap-2">
            <a href="https://www.facebook.com/brennistodin" target="_blank" aria-label="Facebook">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a4 4 0 0 0-4 4v3H8v4h3v9h4v-9h3l1-4h-4V6a1 1 0 0 1 1-1h3z"/></svg>
            </a>
            <a href="https://www.instagram.com/kommunala_brennistodin/" target="_blank" aria-label="Instagram">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="5"/><circle cx="12" cy="12" r="3"/><path d="M17.5 6.5h.01"/></svg>
            </a>
            
          </div>
        </div>
      </div>
      <div class="row gy-4 bottom-row align-items-center">
        <div class="col-md-4"><img src="~/assets/tk-logo.svg" alt="" /></div>
        <div class="col-md-4">  @if (datuverndLink != null && !string.IsNullOrWhiteSpace(datuverndLink.Url))
    {
        <a class="foot-link" href="@datuverndLink.Url" target="@(datuverndLink.Target ?? "_self")">
            @(datuverndLink.Name ?? "Dátuverndarkunning")
        </a>
    }</div>
        <div class="col-md-4"><div class="copyright">© @DateTime.Now.Year Kommunala Brennistøðin</div></div>
      </div>
      <div class="row kolofon-row">
                        <div class="col-12">
                             <div class="kolofon mt-auto">
    <a target="_blank" href="https://www.virka.fo">
    <svg width="188" height="35" viewBox="0 0 188 35" xmlns="http://www.w3.org/2000/svg" style="color:#1b1b1b">
  <g fill="currentColor">
    <path d="M0.348267 18.6899H1.91951V31.0099H0.348267V18.6899ZM1.56241 29.5458H6.70466V31.0099H1.56241V29.5458Z"></path>
    <path d="M12.5455 31.2242C11.6408 31.2242 10.8195 31.0159 10.0815 30.5993C9.34348 30.1826 8.76022 29.6113 8.3317 28.8852C7.91508 28.1591 7.70677 27.3496 7.70677 26.4569C7.70677 25.5641 7.91508 24.7547 8.3317 24.0286C8.76022 23.3025 9.34348 22.7311 10.0815 22.3145C10.8195 21.8979 11.6408 21.6896 12.5455 21.6896C13.4501 21.6896 14.2715 21.8979 15.0095 22.3145C15.7475 22.7311 16.3248 23.3025 16.7414 24.0286C17.1699 24.7547 17.3842 25.5641 17.3842 26.4569C17.3842 27.3496 17.1699 28.1591 16.7414 28.8852C16.3248 29.6113 15.7475 30.1826 15.0095 30.5993C14.2715 31.0159 13.4501 31.2242 12.5455 31.2242ZM12.5455 29.7958C13.1764 29.7958 13.7418 29.6529 14.2417 29.3673C14.7536 29.0697 15.1523 28.6709 15.438 28.171C15.7237 27.6591 15.8665 27.0878 15.8665 26.4569C15.8665 25.8379 15.7177 25.2725 15.4201 24.7607C15.1345 24.2488 14.7417 23.8501 14.2417 23.5644C13.7418 23.2668 13.1764 23.118 12.5455 23.118C11.9265 23.118 11.3611 23.2668 10.8493 23.5644C10.3493 23.8501 9.95056 24.2488 9.65297 24.7607C9.36729 25.2606 9.22445 25.826 9.22445 26.4569C9.22445 27.0759 9.36729 27.6413 9.65297 28.1531C9.95056 28.665 10.3493 29.0697 10.8493 29.3673C11.3611 29.6529 11.9265 29.7958 12.5455 29.7958Z"></path>
    <path d="M19.0934 33.0454H21.3074L20.7361 33.4561L22.0038 30.6885V31.2599L17.8793 21.9039H19.5576L22.9144 29.8136H22.4502L25.8069 21.9039H27.4674L21.9502 34.4024H19.0934V33.0454Z"></path>
    <path d="M31.265 31.2242C30.6936 31.2242 30.1758 31.0992 29.7116 30.8492C29.2473 30.5993 28.8783 30.266 28.6046 29.8493C28.3427 29.4208 28.2117 28.9447 28.2117 28.4209H29.7294C29.7294 28.8376 29.8782 29.1887 30.1758 29.4744C30.4734 29.7601 30.8424 29.9029 31.2828 29.9029C31.6994 29.9029 32.0506 29.7839 32.3363 29.5458C32.6338 29.2958 32.7826 28.9864 32.7826 28.6173C32.7826 28.2245 32.6279 27.9031 32.3184 27.6532C32.0089 27.3913 31.5566 27.183 30.9614 27.0283C30.152 26.8259 29.5092 26.5105 29.0331 26.0819C28.5689 25.6534 28.3367 25.0582 28.3367 24.2964C28.3367 23.7727 28.4617 23.3144 28.7117 22.9216C28.9736 22.5288 29.3247 22.2252 29.7651 22.011C30.2175 21.7967 30.7115 21.6896 31.2471 21.6896C31.8066 21.6896 32.3065 21.8086 32.7469 22.0467C33.1993 22.2848 33.5504 22.6121 33.8004 23.0287C34.0623 23.4334 34.1932 23.8798 34.1932 24.3679H32.6755C32.6755 23.9869 32.5386 23.6656 32.2648 23.4037C31.9911 23.1418 31.6518 23.0109 31.2471 23.0109C30.8543 23.0109 30.521 23.1299 30.2472 23.368C29.9853 23.5941 29.8544 23.8798 29.8544 24.225C29.8544 24.6059 30.0092 24.9214 30.3186 25.1713C30.64 25.4213 31.0924 25.6237 31.6756 25.7784C32.5089 25.9927 33.1576 26.32 33.6218 26.7604C34.0861 27.2008 34.3182 27.7782 34.3182 28.4924C34.3182 29.0399 34.1813 29.522 33.9075 29.9386C33.6456 30.3433 33.2826 30.6588 32.8183 30.8849C32.3541 31.1111 31.8363 31.2242 31.265 31.2242Z"></path>
    <path d="M43.3863 25.8498C43.3863 25.0285 43.1363 24.3679 42.6364 23.8679C42.1483 23.368 41.4937 23.118 40.6723 23.118C40.101 23.118 39.5951 23.2311 39.1547 23.4572C38.7261 23.6834 38.3928 24.0107 38.1548 24.4393C37.9286 24.8559 37.8155 25.338 37.8155 25.8855L37.1192 25.5998C37.1906 24.7904 37.3989 24.0941 37.7441 23.5108C38.1012 22.9275 38.5654 22.4812 39.1368 22.1717C39.7201 21.8503 40.3867 21.6896 41.1366 21.6896C41.8627 21.6896 42.5054 21.8443 43.0649 22.1538C43.6363 22.4514 44.0767 22.8859 44.3862 23.4572C44.6957 24.0167 44.8504 24.6654 44.8504 25.4034V31.0099H43.3863V25.8498ZM36.3514 21.9039H37.8155V31.0099H36.3514V21.9039Z"></path>
    <path d="M52.7644 18.1543H56.7996V19.5113H53.5679L54.2285 18.8506V31.0099H52.7644V18.1543ZM51.1039 21.9039H56.7996V23.243H51.1039V21.9039Z"></path>
    <path d="M58.7225 21.9039H60.1866V31.0099H58.7225V21.9039ZM59.4903 25.9748C59.5736 25.1416 59.776 24.4036 60.0974 23.7608C60.4306 23.118 60.8592 22.624 61.3829 22.2788C61.9186 21.9336 62.5256 21.761 63.2041 21.761V23.2787C62.5852 23.2787 62.0436 23.4096 61.5793 23.6715C61.127 23.9334 60.7818 24.3024 60.5437 24.7785C60.3057 25.2427 60.1866 25.7903 60.1866 26.4212L59.4903 25.9748Z"></path>
    <path d="M70.4646 29.3851L70.3217 29.0994V23.0466L70.6074 23.3144H64.8938V21.9039H71.7859V29.9386L71.5537 29.6708H73V31.0099H70.4646V29.3851ZM67.5721 31.2242C66.9531 31.2242 66.3936 31.0932 65.8937 30.8314C65.4056 30.5576 65.0128 30.1945 64.7153 29.7422C64.4296 29.2899 64.2867 28.778 64.2867 28.2067C64.2867 27.6353 64.4296 27.1235 64.7153 26.6711C65.0009 26.2069 65.3937 25.8439 65.8937 25.582C66.3936 25.3201 66.9531 25.1892 67.5721 25.1892H70.5181V26.5105H67.7328C67.3757 26.5105 67.0483 26.5878 66.7507 26.7426C66.4531 26.8854 66.221 27.0878 66.0544 27.3496C65.8877 27.5996 65.8044 27.8853 65.8044 28.2067C65.8044 28.5162 65.8877 28.8019 66.0544 29.0637C66.221 29.3256 66.4531 29.5339 66.7507 29.6887C67.0483 29.8315 67.3757 29.9029 67.7328 29.9029C68.2446 29.9029 68.691 29.8255 69.0719 29.6708C69.4647 29.5041 69.7682 29.2839 69.9825 29.0102C70.2087 28.7245 70.3217 28.3971 70.3217 28.0281L70.9645 28.171C70.9645 28.7423 70.8157 29.2661 70.5181 29.7422C70.2206 30.2064 69.8099 30.5695 69.2861 30.8314C68.7743 31.0932 68.2029 31.2242 67.5721 31.2242ZM69.304 18.4043H71.1966L69.0183 20.6897H67.4471L69.304 18.4043Z"></path>
    <path d="M127.636 19.346H130.155C133.505 19.346 134.73 17.3769 134.73 13.7914V6.21235C134.73 2.88983 133.852 0.591331 130.022 0.591331H115.418L118.15 4.3193H128.849C130.698 4.3193 131.08 4.96277 131.08 6.90425V13.1023C131.08 15.1227 130.72 15.6195 129.039 15.6195H120.618L132.29 31.5H136.54L127.637 19.3474L127.636 19.346Z"></path>
    <path d="M111.193 0.5H107.512V31.4308H111.193V0.5Z"></path>
    <path d="M90.0047 25.7849L82.0253 0.51107H78L87.7247 31.4516H92.2451L102.005 0.51107H98.2796L90.0047 25.7849Z"></path>
    <path d="M144.428 0.5H140.748V31.4308H144.428V0.5Z"></path>
    <path d="M157.154 0.508303L145.466 15.643L157.153 31.4709H161.355L149.789 15.6513L161.519 0.556736L157.154 0.508303Z"></path>
    <path d="M178.274 0.51107H173.754L163.993 31.4516H167.718L175.993 6.17637L183.916 31.2648L183.973 31.4516H188L178.274 0.51107Z"></path>
  </g>
</svg>
</a>
</div>
                        </div>
                    </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  @RenderSection("Scripts", required: false)



  <!-- skiljileiting -->
  <script src="/js/skiljisearch.js"></script>


<script>
(function () {
  // ---- CONFIG ----
  const ENDPOINT = "/umbraco/api/sortsearch/site?term=";
  const DEBOUNCE_MS = 180;
  const DEBUG = true; // set false to silence logs

  const log = (...a) => DEBUG && console.log("[overlay-search]", ...a);
  const warn = (...a) => DEBUG && console.warn("[overlay-search]", ...a);

  // Wait for DOM just in case this runs in <head>
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", init);
  } else {
    init();
  }

  function init() {
    log("init");
    const navbar  = document.querySelector(".navbar-main");
    const trigger = document.querySelector(".search-trigger");
    const overlay = document.getElementById("siteSearchOverlay");
    const input   = document.getElementById("siteSearchField");
    const closeBtn= overlay?.querySelector(".site-search-close");
    const clearBtn= overlay?.querySelector(".clear-btn");

    const lists = {
      news:   document.getElementById("newsList"),
      guides: document.getElementById("guidesList"),
      topics: document.getElementById("topicsList")
    };

    const groups = {
      news: {
        block: overlay?.querySelector('.group[data-group="news"]'),
        titleLink: overlay?.querySelector('[data-group-link="news"]'),
        countEl: overlay?.querySelector('.group[data-group="news"] .count')
      },
      guides: {
        block: overlay?.querySelector('.group[data-group="guides"]'),
        titleLink: overlay?.querySelector('[data-group-link="guides"]'),
        countEl: overlay?.querySelector('.group[data-group="guides"] .count')
      },
      topics: {
        block: overlay?.querySelector('.group[data-group="topics"]'),
        titleLink: overlay?.querySelector('[data-group-link="topics"]'),
        countEl: overlay?.querySelector('.group[data-group="topics"] .count')
      }
    };

    // bail early if header or overlay missing
    if (!navbar || !trigger || !overlay) {
      warn("Missing required elements", { navbar: !!navbar, trigger: !!trigger, overlay: !!overlay });
      return;
    }

    // ensure a no-results element exists
    let noResultsEl = overlay.querySelector(".site-search-noresults");
    if (!noResultsEl) {
      const holder = overlay.querySelector(".site-search-groups") || overlay;
      noResultsEl = document.createElement("div");
      noResultsEl.className = "site-search-noresults";
      noResultsEl.textContent = "Onki úrslit";
      holder.appendChild(noResultsEl);
    }

    // helpers
    const debounce = (fn, ms) => { let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; };
    const esc = s => (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
    const placeOverlay = () => {
      const r = navbar.getBoundingClientRect();
      overlay.style.top = (r.bottom + window.scrollY) + "px";
    };
    const setHidden = (el, hidden) => { if (el) el.hidden = hidden; };

    // CSS-based visibility (hide by default)
    function hideAllGroups() {
      Object.values(groups).forEach(g => {
        if (!g.block) return;
        g.block.classList.remove("show");
        if (g.countEl) g.countEl.textContent = "(0)";
      });
    }
    function showGroup(key, show) {
      const g = groups[key];
      if (!g || !g.block) return;
      if (show) g.block.classList.add("show"); else g.block.classList.remove("show");
    }
    function showNoResults(show) {
      noResultsEl.classList.toggle("show", !!show);
    }
    function resetUIInitial() {
      hideAllGroups();
      showNoResults(false);
      Object.values(lists).forEach(ul => { if (ul) ul.innerHTML = ""; });
    }

    function openOverlay(){
      log("openOverlay");
      placeOverlay();
      setHidden(overlay, false);
      overlay.classList.add("is-open");
      overlay.setAttribute("aria-hidden","false");
      document.documentElement.classList.add("overflow-hidden");
      resetUIInitial();
      setTimeout(()=>{ input?.focus(); if (input?.value?.trim().length >= 2) triggerSearchNow(input.value); }, 0);
    }
    function closeOverlay(){
      log("closeOverlay");
      overlay.classList.remove("is-open");
      overlay.setAttribute("aria-hidden","true");
      document.documentElement.classList.remove("overflow-hidden");
      setHidden(overlay, true);
      clearResults();
      if (input) { input.value = ""; onInput(); }
    }
    function clearResults(){
      Object.values(lists).forEach(ul=>{ if (ul) ul.innerHTML=""; });
      hideAllGroups();
      showNoResults(false);
      updateTitleLinks(""); // reset hrefs
    }

    function renderList(ul, items){
      if (!ul) return;
      ul.innerHTML = (items || [])
        .map(it => `<li><a href="${esc(it.url)}">${esc(it.title)}</a></li>`)
        .join("");
    }

    function updateTitleLinks(query){
      const groupParam = { news: "news", guides: "guides", topics: "others" };
      Object.entries(groups).forEach(([key, g])=>{
        if (!g.titleLink) return;
        const q = encodeURIComponent(query || "");
        const gp = encodeURIComponent(groupParam[key]);
        g.titleLink.href = `/leiting?q=${q}&group=${gp}`;
      });
    }

    async function doSearch(term){
      log("doSearch", term);
      const res = await fetch(ENDPOINT + encodeURIComponent(term), { headers: { "Accept":"application/json" }});
      if (!res.ok) {
        warn("fetch failed", res.status, res.statusText);
        throw new Error("fetch failed");
      }
      const data = await res.json();
      log("response", data);
      return {
        news:   data.news   || { total: 0, items: [] },
        guides: data.guides || { total: 0, items: [] },
        topics: data.topics || { total: 0, items: [] }
      };
    }

    const debouncedSearch = debounce(triggerSearchNow, DEBOUNCE_MS);

    async function triggerSearchNow(q){
      const term = (q || "").trim();
      log("triggerSearchNow", term);
      if (term.length < 2){ clearResults(); return; }
      try {
        const { news, guides, topics } = await doSearch(term);

        renderList(lists.news,   news.items);
        renderList(lists.guides, guides.items);
        renderList(lists.topics, topics.items);

        if (groups.news.countEl)   groups.news.countEl.textContent   = `(${news.total})`;
        if (groups.guides.countEl) groups.guides.countEl.textContent = `(${guides.total})`;
        if (groups.topics.countEl) groups.topics.countEl.textContent = `(${topics.total})`;

        showGroup("news",   news.total   > 0);
        showGroup("guides", guides.total > 0);
        showGroup("topics", topics.total > 0);

        const anyResults = (news.total + guides.total + topics.total) > 0;
        showNoResults(!anyResults);

        updateTitleLinks(term);
      } catch (e) {
        warn("search error", e);
        clearResults();
      }
    }

    function onInput(){
      if (!input) return;
      const val = input.value;
      input.parentElement.classList.toggle("has-value", !!val);
      log("onInput", val);
      debouncedSearch(val);
    }

    // --- Wire up (log each binding) ---
    trigger.addEventListener("click", (e)=>{ log("click trigger"); e.preventDefault(); e.stopPropagation(); openOverlay(); });
    closeBtn?.addEventListener("click", ()=>{ log("click close"); closeOverlay(); });
    clearBtn?.addEventListener("click", ()=>{ log("click clear"); if (!input) return; input.value=""; onInput(); input.focus(); });
    input?.addEventListener("input", ()=>{ log("event input"); onInput(); });
    input?.addEventListener("keyup",  (e)=>{ log("event keyup", e.key); onInput(); }); // fallback
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape"){ log("escape"); closeOverlay(); }});
    overlay.addEventListener("click", (e)=>{ if(e.target===overlay){ log("click backdrop"); closeOverlay(); }});
    window.addEventListener("resize", ()=>{ log("resize"); placeOverlay(); });
    window.addEventListener("scroll", ()=>{ /*log("scroll");*/ placeOverlay(); });

    // Initial hidden state
    resetUIInitial();

    log("wired OK", { navbar: !!navbar, trigger: !!trigger, overlay: !!overlay, input: !!input });
  }
})();
</script>


    <script>
document.addEventListener("DOMContentLoaded", function () {
    const trigger = document.querySelector(".search-trigger");
    const desktopContainer = document.querySelector(".searchcontainer-desktop");
    const mobileContainer = document.querySelector(".searchcontainer-mobile");

    function moveTrigger() {
        if (!trigger || !desktopContainer || !mobileContainer) return;

        if (window.innerWidth >= 992) {
            // Move to desktop
            if (trigger.parentElement !== desktopContainer) {
                desktopContainer.appendChild(trigger);
            }
        } else {
            // Move to mobile
            if (trigger.parentElement !== mobileContainer) {
                mobileContainer.appendChild(trigger);
            }
        }
    }

    // Initial placement
    moveTrigger();

    // Move on resize
    window.addEventListener("resize", moveTrigger);
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const MOBILE_MAX = 991.98;

  function isMobile() {
    return window.innerWidth <= MOBILE_MAX;
  }

  function closeAllMegas(except) {
    document.querySelectorAll('.mega.mega-open').forEach(function (mega) {
      if (mega !== except) {
        mega.classList.remove('mega-open');
      }
    });
  }

  // Click handler on the actual .is-mega links
  document.querySelectorAll('.nav-item.dropdown .is-mega').forEach(function (link) {
    link.addEventListener('click', function (e) {
      if (!isMobile()) {
        // Desktop: let Bootstrap behave normally
        return;
      }

      // Stop Bootstrap dropdown from interfering
      e.preventDefault();
      e.stopPropagation();

      // .mega is the next sibling after .is-mega
      var mega = link.nextElementSibling;
      if (!mega || !mega.classList.contains('mega')) {
        return;
      }

      var isOpen = mega.classList.contains('mega-open');

      if (isOpen) {
        mega.classList.remove('mega-open');
      } else {
        closeAllMegas(mega);
        mega.classList.add('mega-open');
      }
    });
  });

  // On resize to desktop, reset all
  window.addEventListener('resize', function () {
    if (!isMobile()) {
      document.querySelectorAll('.mega.mega-open').forEach(function (mega) {
        mega.classList.remove('mega-open');
      });
    }
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var navCollapse = document.getElementById('mainNav');
  if (!navCollapse) return;

  // Create a single global level-3 overlay
  function createMegaOverlay() {
    var existing = document.querySelector('.mega-l3-overlay');
    if (existing) return existing;

    var overlay = document.createElement('div');
    overlay.className = 'mega-l3-overlay';

    overlay.innerHTML = `
      <div class="mega-l3-inner">
        <button type="button" class="mega-l3-back">Aftur</button>
        <h6 class="mega-l3-heading"></h6>
        <div class="mega-l3-links"></div>
      </div>
    `;

    document.body.appendChild(overlay);
    return overlay;
  }

  var overlay        = createMegaOverlay();
  var backBtn        = overlay.querySelector('.mega-l3-back');
  var headingEl      = overlay.querySelector('.mega-l3-heading');
  var linksContainer = overlay.querySelector('.mega-l3-links');

  // Back button: close level 3, slide menu back
  backBtn.addEventListener('click', function () {
    document.body.classList.remove('mega-l3-open');
    headingEl.textContent = '';
    linksContainer.innerHTML = '';
  });

  // Attach click handlers to all level-2 headings (h6) inside .mega
  function bindLevel2Handlers() {
    var level2Headings = navCollapse.querySelectorAll('.mega h6');
    level2Headings.forEach(function (h6) {
      if (h6.dataset.megaL3Bound === '1') return;
      h6.dataset.megaL3Bound = '1';

      h6.addEventListener('click', function (e) {
        // Only intercept on mobile
        if (window.innerWidth >= 992) return;

        e.preventDefault();

        // Find column containing this h6
        var col = h6.closest('.col-6, .col-lg-3') || h6.parentElement;
        if (!col) return;

        var links = col.querySelectorAll('a[href]');
        if (!links.length) return;

        // Fill overlay
        headingEl.textContent = h6.textContent.trim();
        linksContainer.innerHTML = '';

        links.forEach(function (link) {
          var a = document.createElement('a');
          a.href = link.href;
          a.textContent = link.textContent.trim();
          linksContainer.appendChild(a);
        });

        // Open overlay: slide menu left, overlay in
        document.body.classList.add('mega-l3-open');
      });
    });
  }

  bindLevel2Handlers();

  // Re-bind on resize in case markup changes visibility (optional, but safe)
  window.addEventListener('resize', function () {
    // No need to recreate overlay; just ensure handlers exist
    bindLevel2Handlers();
    // If moved to desktop while overlay open, close it
    if (window.innerWidth >= 992) {
      document.body.classList.remove('mega-l3-open');
      headingEl.textContent = '';
      linksContainer.innerHTML = '';
    }
  });
});
</script>

<script>

    document.addEventListener('DOMContentLoaded', function () {
    const input = document.querySelector('.sort-search');
    if (!input) return;

    input.addEventListener('focus', function () {
        const rect = input.getBoundingClientRect();
        const scrollY = window.scrollY + rect.top - 20; // 20px from top
        window.scrollTo({
            top: scrollY,
            behavior: 'smooth'
        });
    });
});

</script>







<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
