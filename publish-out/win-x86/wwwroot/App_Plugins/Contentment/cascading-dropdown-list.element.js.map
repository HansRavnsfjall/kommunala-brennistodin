{"version":3,"file":"cascading-dropdown-list.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/cascading-dropdown-list/cascading-dropdown-list.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright Â© 2024 Lee Kelleher\r\n\r\nimport { parseInt } from '../../utils/parse-int.function.js';\r\nimport type { ContentmentListItem } from '../types.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tproperty,\r\n\trepeat,\r\n\tstate,\r\n\tunsafeHTML,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { ContentmentDataListRepository } from '../data-list/data-list.repository.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\nimport type { UUIComboboxElement, UUIComboboxEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n@customElement('contentment-property-editor-ui-cascading-dropdown-list')\r\nexport class ContentmentPropertyEditorUICascadingDropdownListElement\r\n\textends UmbLitElement\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#repository = new ContentmentDataListRepository(this);\r\n\r\n\t@state()\r\n\tprivate _apis: Array<string> = [];\r\n\r\n\t@state()\r\n\tprivate _loading = true;\r\n\r\n\t@state()\r\n\tprivate _options: Array<Array<ContentmentListItem>> = [];\r\n\r\n\t@state()\r\n\tprivate _promises: Array<Promise<Array<ContentmentListItem>>> = [];\r\n\r\n\t@property({ type: Array })\r\n\tpublic value?: Array<string>;\r\n\r\n\tpublic set config(config: UmbPropertyEditorUiElement['config']) {\r\n\t\tif (!config) return;\r\n\r\n\t\tthis._apis = config.getValueByAlias<Array<string>>('apis') ?? [];\r\n\r\n\t\tif (!this.value?.length) {\r\n\t\t\tthis.value = [''];\r\n\t\t}\r\n\r\n\t\tif (this.value?.length && this._apis?.length) {\r\n\t\t\tfor (var i = 0; i < this.value.length; i++) {\r\n\t\t\t\tvar url = this._apis[i];\r\n\r\n\t\t\t\tfor (var j = 0; j < i; j++) {\r\n\t\t\t\t\turl = url.replace(`{${j}}`, this.value[j]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._promises.push(this.#repository.getItemsByUrl(url));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onChange(event: UUIComboboxEvent & { target: UUIComboboxElement }) {\r\n\t\tif (event.target.nodeName !== 'UUI-COMBOBOX') return;\r\n\r\n\t\tconst index = parseInt(event.target.dataset.index) || 0;\r\n\t\tconst next = index + 1;\r\n\t\tconst value = event.target.value as string;\r\n\r\n\t\tconst currentValue = this.value ? this.value.slice(0, next) : [];\r\n\t\tcurrentValue[index] = value;\r\n\t\tthis.value = currentValue;\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\r\n\t\tif (this._apis.length > next) {\r\n\t\t\tthis._loading = true;\r\n\r\n\t\t\tvar url = this._apis[next].replace(/{(\\d+)}/g, function (match, digit) {\r\n\t\t\t\treturn typeof currentValue[digit] != 'undefined' ? currentValue[digit] : match;\r\n\t\t\t});\r\n\r\n\t\t\tif (typeof value !== 'number' && value) {\r\n\t\t\t\tthis._options[next] = await this.#repository.getItemsByUrl(url);\r\n\t\t\t} else {\r\n\t\t\t\tthis._options = this._options.splice(0, next);\r\n\t\t\t}\r\n\r\n\t\t\tthis._loading = false;\r\n\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\t(this.shadowRoot?.querySelector(`uui-combobox:nth-child(${next + 1})`) as HTMLElement)?.focus();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tthis._options = await Promise.all(this._promises);\r\n\t\tthis._loading = false;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) return html`<uui-loader></uui-loader>`;\r\n\t\treturn html`${repeat(\r\n\t\t\tthis._options,\r\n\t\t\t(options, index) => html`\r\n\t\t\t\t<uui-combobox data-index=${index} required value=${ifDefined(this.value?.[index])} @change=${this.#onChange}>\r\n\t\t\t\t\t<uui-combobox-list>\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\toptions,\r\n\t\t\t\t\t\t\t(option) => option.value,\r\n\t\t\t\t\t\t\t(option) => this.#renderItem(option)\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</uui-combobox-list>\r\n\t\t\t\t</uui-combobox>\r\n\t\t\t`\r\n\t\t)}`;\r\n\t}\r\n\r\n\t#renderItem(item: ContentmentListItem) {\r\n\t\treturn html`\r\n\t\t\t<uui-combobox-list-option display-value=${item.name} value=${item.value} ?disabled=${item.disabled}>\r\n\t\t\t\t<div class=\"outer\">\r\n\t\t\t\t\t${when(item.icon, (icon) => html`<umb-icon name=${icon}></umb-icon>`)}\r\n\t\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t\t<span slot=\"label\">${this.localize.string(item.name)}</span>\r\n\t\t\t\t\t\t${when(item.description, () => html`<span slot=\"description\">${unsafeHTML(item.description)}</span>`)}\r\n\t\t\t\t\t</uui-form-layout-item>\r\n\t\t\t\t</div>\r\n\t\t\t</uui-combobox-list-option>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\t.outer {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: row;\r\n\t\t\t\tgap: 0.5rem;\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t}\r\n\r\n\t\t\tuui-combobox-list-option {\r\n\t\t\t\tpadding-top: 5px;\r\n\t\t\t}\r\n\r\n\t\t\tuui-form-layout-item {\r\n\t\t\t\tmargin-top: 3px;\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\r\n\t\t\tumb-icon {\r\n\t\t\t\tfont-size: 1.2rem;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { ContentmentPropertyEditorUICascadingDropdownListElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-property-editor-ui-cascading-dropdown-list': ContentmentPropertyEditorUICascadingDropdownListElement;\r\n\t}\r\n}\r\n"],"names":["_repository","_ContentmentPropertyEditorUICascadingDropdownListElement_instances","onChange_fn","renderItem_fn","ContentmentPropertyEditorUICascadingDropdownListElement","UmbLitElement","__privateAdd","ContentmentDataListRepository","config","_a","_b","_c","i","url","j","__privateGet","html","repeat","options","index","ifDefined","__privateMethod","option","event","parseInt","next","value","currentValue","UmbChangeEvent","match","digit","item","when","icon","unsafeHTML","css","__decorateClass","state","property","customElement"],"mappings":"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"}