{"version":3,"file":"configuration-editor-selection-modal.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/configuration-editor/configuration-editor-selection-modal.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright Â© 2024 Lee Kelleher\r\n\r\nimport { CONTENTMENT_CONFIGURATION_EDITOR_WORKSPACE_MODAL } from './configuration-editor-workspace-modal.element.js';\r\nimport type { ContentmentConfigurationEditorModel, ContentmentConfigurationEditorValue } from '../types.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tnothing,\r\n\trepeat,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { debounce } from '@umbraco-cms/backoffice/utils';\r\nimport { umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalBaseElement, UmbModalToken, UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\ninterface ContentmentConfigurationEditorSelectionModalData {\r\n\titems: Array<ContentmentConfigurationEditorModel>;\r\n}\r\n\r\nexport const CONTENTMENT_CONFIGURATION_EDITOR_SELECTION_MODAL = new UmbModalToken<\r\n\tContentmentConfigurationEditorSelectionModalData,\r\n\tContentmentConfigurationEditorValue\r\n>('Umb.Contentment.Modal.ConfigurationEditor.Selection', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'medium',\r\n\t},\r\n});\r\n\r\n@customElement('contentment-property-editor-ui-configuration-editor-selection-modal')\r\nexport class ContentmentPropertyEditorUIConfigurationEditorSelectionModalElement extends UmbModalBaseElement<\r\n\tContentmentConfigurationEditorSelectionModalData,\r\n\tContentmentConfigurationEditorValue\r\n> {\r\n\t#emptyGroup = (Math.random() + 1).toString(36).substring(7);\r\n\r\n\t@state()\r\n\tprivate _grouped?: Array<{ alias: string; items: Array<ContentmentConfigurationEditorModel> }>;\r\n\r\n\t@state()\r\n\tprivate _hideFilter = false;\r\n\r\n\t#modalManager?: typeof UMB_MODAL_MANAGER_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (modalManager) => {\r\n\t\t\tthis.#modalManager = modalManager;\r\n\t\t});\r\n\t}\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#groupItems(this.data?.items);\r\n\t\tthis._hideFilter = (this.data?.items.length ?? 0) <= 7;\r\n\t}\r\n\r\n\t#debouncedFilter = debounce((query: string) => {\r\n\t\tif (!this.data) return;\r\n\t\tconst items = query ? this.data.items.filter((item) => item.name.toLowerCase().includes(query)) : this.data.items;\r\n\t\tthis.#groupItems(items);\r\n\t}, 500);\r\n\r\n\t#groupItems(items: Array<ContentmentConfigurationEditorModel> | null | undefined) {\r\n\t\tif (!items) return;\r\n\r\n\t\t// @ts-expect-error\r\n\t\tconst grouped = Object.groupBy(\r\n\t\t\titems,\r\n\t\t\t(item: ContentmentConfigurationEditorModel) => item.group ?? this.#emptyGroup\r\n\t\t);\r\n\t\tconst entries = Object.entries(grouped) as Array<[string, Array<ContentmentConfigurationEditorModel>]>;\r\n\t\tthis._grouped = entries.map(([alias, items]) => ({ alias, items }));\r\n\t}\r\n\r\n\tasync #onChoose(model: ContentmentConfigurationEditorModel) {\r\n\t\tif (!model.fields?.length) {\r\n\t\t\tthis.value = { key: model.key, value: {} };\r\n\t\t\tthis._submitModal();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.#modalManager) return;\r\n\r\n\t\tconst item = {\r\n\t\t\tkey: model.key,\r\n\t\t\tvalue: model.defaultValues ?? {},\r\n\t\t};\r\n\r\n\t\tconst modal = this.#modalManager.open(this, CONTENTMENT_CONFIGURATION_EDITOR_WORKSPACE_MODAL, {\r\n\t\t\tdata: { item, model },\r\n\t\t});\r\n\r\n\t\tconst data = await modal.onSubmit().catch(() => undefined);\r\n\r\n\t\tif (!data) return;\r\n\r\n\t\tthis.value = data;\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#onInput(event: UUIInputEvent) {\r\n\t\tconst query = (event.target.value as string) || '';\r\n\t\tthis.#debouncedFilter(query.toLowerCase());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('general_choose')}>\r\n\t\t\t\t${this.#renderFilter()} ${this.#renderGroups()}\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_cancel')} @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFilter() {\r\n\t\tif (this._hideFilter) return nothing;\r\n\t\tconst label = this.localize.term('placeholders_filter');\r\n\t\treturn html`\r\n\t\t\t<uui-input type=\"search\" id=\"filter\" label=${label} placeholder=${label} @input=${this.#onInput} ${umbFocus()}>\r\n\t\t\t\t<uui-icon name=\"search\" slot=\"prepend\" id=\"filter-icon\"></uui-icon>\r\n\t\t\t</uui-input>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderGroups() {\r\n\t\tif (!this._grouped?.length) return html`<uui-box><p>No items found</p></uui-box>`;\r\n\t\treturn html`\r\n\t\t\t<uui-box>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._grouped,\r\n\t\t\t\t\t(group) => group.alias,\r\n\t\t\t\t\t(group) => html`\r\n\t\t\t\t\t\t${when(group.alias !== this.#emptyGroup, () => html`<h4>${group.alias}</h4>`)}\r\n\t\t\t\t\t\t<uui-ref-list>\r\n\t\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\t\tgroup.items,\r\n\t\t\t\t\t\t\t\t(item) => item.key,\r\n\t\t\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t\t\t<umb-ref-item\r\n\t\t\t\t\t\t\t\t\t\tname=${item.name}\r\n\t\t\t\t\t\t\t\t\t\tdetail=${ifDefined(item.description ?? undefined)}\r\n\t\t\t\t\t\t\t\t\t\ticon=${ifDefined(item.icon ?? undefined)}\r\n\t\t\t\t\t\t\t\t\t\t@open=${() => this.#onChoose(item)}>\r\n\t\t\t\t\t\t\t\t\t</umb-ref-item>\r\n\t\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</uui-ref-list>\r\n\t\t\t\t\t`\r\n\t\t\t\t)}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\th4 {\r\n\t\t\t\tmargin-top: 0.5rem;\r\n\t\t\t\tmargin-bottom: 0.5rem;\r\n\t\t\t}\r\n\r\n\t\t\t#filter {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t#filter-icon {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tcolor: var(--uui-color-border);\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-space-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { ContentmentPropertyEditorUIConfigurationEditorSelectionModalElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-property-editor-ui-configuration-editor-selection-modal': ContentmentPropertyEditorUIConfigurationEditorSelectionModalElement;\r\n\t}\r\n}\r\n"],"names":["_emptyGroup","_modalManager","_debouncedFilter","_ContentmentPropertyEditorUIConfigurationEditorSelectionModalElement_instances","groupItems_fn","onChoose_fn","onInput_fn","renderFilter_fn","renderGroups_fn","CONTENTMENT_CONFIGURATION_EDITOR_SELECTION_MODAL","UmbModalToken","ContentmentPropertyEditorUIConfigurationEditorSelectionModalElement","UmbModalBaseElement","__privateAdd","debounce","query","items","item","__privateMethod","UMB_MODAL_MANAGER_CONTEXT","modalManager","__privateSet","_a","_b","html","grouped","__privateGet","entries","alias","model","data","CONTENTMENT_CONFIGURATION_EDITOR_WORKSPACE_MODAL","event","nothing","label","umbFocus","repeat","group","when","ifDefined","css","__decorateClass","state","customElement"],"mappings":"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"}