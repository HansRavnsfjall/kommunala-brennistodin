{"version":3,"file":"data-list-preview.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/data-list/data-list-preview.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright Â© 2024 Lee Kelleher\r\n\r\nimport { ContentmentDataListRepository } from './data-list.repository.js';\r\nimport { css, customElement, html, property, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { ContentmentConfigurationEditorValue, ContentmentDataListEditor } from '../types.js';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\ntype ContentmentDataListPreviewTab = {\r\n\talias: 'dataSource' | 'listEditor' | 'rawJson';\r\n\tlabel: string;\r\n\tactive?: boolean;\r\n};\r\n\r\n@customElement('contentment-property-editor-ui-data-list-preview')\r\nexport class ContentmentPropertyEditorUIDataListPreviewElement\r\n\textends UmbLitElement\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#items: Array<any> = [];\r\n\r\n\t#listEditor?: ContentmentDataListEditor;\r\n\r\n\t#repository = new ContentmentDataListRepository(this);\r\n\r\n\t#tabs: Array<ContentmentDataListPreviewTab> = [\r\n\t\t{ alias: 'listEditor', label: 'Editor preview' },\r\n\t\t{ alias: 'dataSource', label: 'Data source items' },\r\n\t\t{ alias: 'rawJson', label: 'JSON' },\r\n\t];\r\n\r\n\t@state()\r\n\tprivate _activeTab: ContentmentDataListPreviewTab['alias'] = 'listEditor';\r\n\r\n\t@state()\r\n\tprivate _dataSource?: Array<ContentmentConfigurationEditorValue>;\r\n\r\n\t@state()\r\n\tprivate _listEditor?: Array<ContentmentConfigurationEditorValue>;\r\n\r\n\t@state()\r\n\tprivate _state: 'init' | 'loading' | 'loaded' | 'dataSourceConfigured' | 'listEditorConfigured' | 'noItems' = 'init';\r\n\r\n\t@property()\r\n\tpublic value?: string | string[];\r\n\r\n\tpublic set config(config: UmbPropertyEditorUiElement['config']) {\r\n\t\tif (!config) return;\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, async (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tawait context?.propertyValueByAlias<Array<ContentmentConfigurationEditorValue>>('dataSource'),\r\n\t\t\t\t(dataSource) => {\r\n\t\t\t\t\tthis._dataSource = dataSource;\r\n\t\t\t\t\tthis.#fetch();\r\n\t\t\t\t},\r\n\t\t\t\t'_observeDataSource'\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tawait context?.propertyValueByAlias<Array<ContentmentConfigurationEditorValue>>('listEditor'),\r\n\t\t\t\t(listEditor) => {\r\n\t\t\t\t\tthis._listEditor = listEditor;\r\n\t\t\t\t\tthis.#fetch();\r\n\t\t\t\t},\r\n\t\t\t\t'_observeListEditor'\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\toverride firstUpdated() {\r\n\t\tthis.#onTabChange(this.#tabs[0]);\r\n\t}\r\n\r\n\tasync #fetch() {\r\n\t\tthis._state = 'loading';\r\n\r\n\t\tif (this._dataSource && this._listEditor) {\r\n\t\t\tthis.#listEditor = await this.#repository.getEditor(this._dataSource[0], this._listEditor[0]);\r\n\r\n\t\t\tthis.#items = this.#listEditor?.config?.getValueByAlias<any[]>('items') ?? [];\r\n\r\n\t\t\tthis._state = this.#items.length > 0 ? 'loaded' : 'noItems';\r\n\r\n\t\t\t// HACK: Replaces data sources label to include the item count. There could be a nicer way of doing this. [LK]\r\n\t\t\tthis.#tabs[1].label = 'Data source items (' + this.#items.length + ')';\r\n\t\t} else if (this._dataSource) {\r\n\t\t\tthis._state = 'dataSourceConfigured';\r\n\t\t} else if (this._listEditor) {\r\n\t\t\tthis._state = 'listEditorConfigured';\r\n\t\t} else {\r\n\t\t\tthis._state = 'init';\r\n\t\t}\r\n\t}\r\n\r\n\t#onTabChange(tab: any) {\r\n\t\tthis.#tabs.forEach((tab) => (tab.active = false));\r\n\t\tthis._activeTab = tab.alias;\r\n\t\ttab.active = true;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tswitch (this._state) {\r\n\t\t\tcase 'dataSourceConfigured':\r\n\t\t\t\treturn html`<p>Please select and configure a list editor.</p>`;\r\n\r\n\t\t\tcase 'listEditorConfigured':\r\n\t\t\t\treturn html`<p>Please select and configure a data source.</p>`;\r\n\r\n\t\t\tcase 'loading':\r\n\t\t\t\treturn html`<uui-loader></uui-loader>`;\r\n\r\n\t\t\tcase 'loaded':\r\n\t\t\t\treturn this.#renderPanel();\r\n\r\n\t\t\tcase 'noItems':\r\n\t\t\t\treturn html`<p>The data source returned no items to preview.</p>`;\r\n\r\n\t\t\tcase 'init':\r\n\t\t\tdefault:\r\n\t\t\t\treturn html`<p>Please select and configure a data source and list editor.</p>`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderPanel() {\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis.#items.length > 30,\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<contentment-info-box type=${this.#items.length >= 50 ? 'danger' : 'warning'}>\r\n\t\t\t\t\t\t<details>\r\n\t\t\t\t\t\t\t<summary>There are <strong>${this.#items.length}</strong> items avaliable in this data source.</summary>\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\tTo avoid an unpleasant editor experience or lagging browser performance, please consider trying the\r\n\t\t\t\t\t\t\t\t<strong>Data Picker</strong> property editor, as it has been designed with improved performance in mind,\r\n\t\t\t\t\t\t\t\twith support for search querying and pagination.\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</details>\r\n\t\t\t\t\t</contentment-info-box>\r\n\t\t\t\t`\r\n\t\t\t)}\r\n\r\n\t\t\t<uui-tab-group>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis.#tabs,\r\n\t\t\t\t\t(tab) => tab.alias,\r\n\t\t\t\t\t(tab) =>\r\n\t\t\t\t\t\thtml`<uui-tab label=${tab.label} ?active=${tab.active} @click=${() => this.#onTabChange(tab)}></uui-tab>`\r\n\t\t\t\t)}\r\n\t\t\t</uui-tab-group>\r\n\r\n\t\t\t${when(\r\n\t\t\t\tthis._activeTab === 'listEditor' && this.#listEditor,\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<contentment-property-editor-ui\r\n\t\t\t\t\t\t.config=${this.#listEditor!.config}\r\n\t\t\t\t\t\t.propertyEditorUiAlias=${this.#listEditor!.propertyEditorUiAlias!}>\r\n\t\t\t\t\t</contentment-property-editor-ui>\r\n\t\t\t\t`\r\n\t\t\t)}\r\n\t\t\t${when(\r\n\t\t\t\tthis._activeTab === 'dataSource',\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<uui-table>\r\n\t\t\t\t\t\t<uui-table-head>\r\n\t\t\t\t\t\t\t<uui-table-head-cell></uui-table-head-cell>\r\n\t\t\t\t\t\t\t<uui-table-head-cell>Name</uui-table-head-cell>\r\n\t\t\t\t\t\t\t<uui-table-head-cell>Value</uui-table-head-cell>\r\n\t\t\t\t\t\t\t<uui-table-head-cell>Description</uui-table-head-cell>\r\n\t\t\t\t\t\t\t<uui-table-head-cell>Enabled</uui-table-head-cell>\r\n\t\t\t\t\t\t</uui-table-head>\r\n\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis.#items,\r\n\t\t\t\t\t\t\t(item) => item.value,\r\n\t\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t\t<uui-table-row>\r\n\t\t\t\t\t\t\t\t\t<uui-table-cell><umb-icon .name=${item.icon}></umb-icon></uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-table-cell>${item.name}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-table-cell>${item.value}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-table-cell>${item.description}</uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<uui-table-cell><uui-icon name=${item.disabled ? 'remove' : 'check'}></uui-icon></uui-table-cell>\r\n\t\t\t\t\t\t\t\t</uui-table-row>\r\n\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</uui-table>\r\n\t\t\t\t`\r\n\t\t\t)}\r\n\t\t\t${when(\r\n\t\t\t\tthis._activeTab === 'rawJson',\r\n\t\t\t\t() => html` <umb-code-block language=\"JSON\" copy>${JSON.stringify(this.#items, null, 2)}</umb-code-block> `\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tcontentment-info-box > details > summary {\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tab-group {\r\n\t\t\t\tmargin-bottom: 1rem;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { ContentmentPropertyEditorUIDataListPreviewElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-property-editor-ui-data-list-preview': ContentmentPropertyEditorUIDataListPreviewElement;\r\n\t}\r\n}\r\n"],"names":["_items","_listEditor","_repository","_tabs","_ContentmentPropertyEditorUIDataListPreviewElement_instances","fetch_fn","onTabChange_fn","renderPanel_fn","ContentmentPropertyEditorUIDataListPreviewElement","UmbLitElement","__privateAdd","ContentmentDataListRepository","UMB_PROPERTY_DATASET_CONTEXT","context","dataSource","__privateMethod","listEditor","config","__privateGet","html","__privateSet","_b","_a","tab","when","repeat","item","css","__decorateClass","state","property","customElement"],"mappings":"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"}