{"version":3,"file":"data-list.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/data-list/data-list.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright Â© 2024 Lee Kelleher\r\n\r\nimport { ContentmentDataListRepository } from './data-list.repository.js';\r\nimport { customElement, html, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbFormControlMixin, UMB_VALIDATION_EMPTY_LOCALIZATION_KEY } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { ContentmentConfigurationEditorValue, ContentmentDataListEditor } from '../types.js';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\n@customElement('contentment-property-editor-ui-data-list')\r\nexport class ContentmentPropertyEditorUIDataListElement\r\n\textends UmbFormControlMixin<Array<string> | string | undefined, typeof UmbLitElement, undefined>(UmbLitElement)\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#addedFormControl = false;\r\n\r\n\t#listEditor?: ContentmentDataListEditor;\r\n\r\n\t#propertyContext?: typeof UMB_PROPERTY_CONTEXT.TYPE;\r\n\r\n\t#repository = new ContentmentDataListRepository(this);\r\n\r\n\t@state()\r\n\tprivate _entityUnique?: string | null;\r\n\r\n\t@state()\r\n\tprivate _propertyAlias?: string;\r\n\r\n\t@state()\r\n\tprivate _variantId?: string;\r\n\r\n\t@state()\r\n\tprivate _initialized = false;\r\n\r\n\t@state()\r\n\tprivate _dataSource?: ContentmentConfigurationEditorValue;\r\n\r\n\t@state()\r\n\tprivate _listEditor?: ContentmentConfigurationEditorValue;\r\n\r\n\t@property({ type: Boolean })\r\n\tmandatory = false;\r\n\r\n\t@property({ type: String })\r\n\tmandatoryMessage = UMB_VALIDATION_EMPTY_LOCALIZATION_KEY;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\treadonly = false;\r\n\r\n\tpublic set config(config: UmbPropertyEditorUiElement['config']) {\r\n\t\tif (!config) return;\r\n\t\tthis.#config = config;\r\n\t\tthis._dataSource = config.getValueByAlias<Array<ContentmentConfigurationEditorValue>>('dataSource')?.[0];\r\n\t\tthis._listEditor = config.getValueByAlias<Array<ContentmentConfigurationEditorValue>>('listEditor')?.[0];\r\n\t}\r\n\tpublic get config() {\r\n\t\treturn this.#config;\r\n\t}\r\n\t#config: UmbPropertyEditorUiElement['config'];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (contentWorkspaceContext) => {\r\n\t\t\tthis.observe(contentWorkspaceContext?.unique, (unique) => (this._entityUnique = unique));\r\n\t\t}).passContextAliasMatches();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (propertyContext) => {\r\n\t\t\tthis.#propertyContext = propertyContext;\r\n\t\t\tthis.observe(propertyContext?.alias, (alias) => (this._propertyAlias = alias));\r\n\t\t\tthis.observe(propertyContext?.variantId, (variantId) => (this._variantId = variantId?.toString() || 'invariant'));\r\n\t\t});\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'valueMissing',\r\n\t\t\t() => this.mandatoryMessage ?? UMB_VALIDATION_EMPTY_LOCALIZATION_KEY,\r\n\t\t\t() => !this.readonly && !!this.mandatory && (this.value === undefined || this.value === null || this.value === '')\r\n\t\t);\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tawait Promise.all([await this.#init().catch(() => undefined)]);\r\n\t\tthis._initialized = true;\r\n\t}\r\n\r\n\tprotected override updated() {\r\n\t\tif (this._initialized && !this.#addedFormControl) {\r\n\t\t\tconst formControl = this.shadowRoot?.querySelector('contentment-property-editor-ui');\r\n\t\t\tif (formControl) {\r\n\t\t\t\tthis.addFormControlElement(formControl);\r\n\t\t\t\tthis.#addedFormControl = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #init() {\r\n\t\tif (!this._dataSource || !this._listEditor) return;\r\n\t\tthis.#listEditor = await this.#repository.getEditor(\r\n\t\t\tthis._dataSource,\r\n\t\t\tthis._listEditor,\r\n\t\t\tthis._entityUnique,\r\n\t\t\tthis._propertyAlias,\r\n\t\t\tthis._variantId\r\n\t\t);\r\n\r\n\t\tconst combinedConfig = [...(this.#listEditor?.config ?? []), ...(this.config ?? [])];\r\n\t\tthis.#propertyContext?.setConfig(combinedConfig);\r\n\t}\r\n\r\n\t#onChange(event: UmbChangeEvent & { target: UmbPropertyEditorUiElement }) {\r\n\t\tvar element = event.target;\r\n\t\tif (!element || element.value === this.value) return;\r\n\t\tthis.value = element.value as any;\r\n\t\tthis.checkValidity();\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._initialized || !this.#listEditor) return html`<uui-loader></uui-loader>`;\r\n\t\tif (!this.#listEditor.propertyEditorUiAlias) return html`<lee-was-here></lee-was-here>`;\r\n\t\treturn html`\r\n\t\t\t<contentment-property-editor-ui\r\n\t\t\t\t.config=${this.#listEditor.config}\r\n\t\t\t\t.mandatoryMessage=${this.mandatoryMessage}\r\n\t\t\t\t.propertyEditorUiAlias=${this.#listEditor.propertyEditorUiAlias}\r\n\t\t\t\t.value=${this.value}\r\n\t\t\t\t?mandatory=${this.mandatory}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t@change=${this.#onChange}>\r\n\t\t\t</contentment-property-editor-ui>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport { ContentmentPropertyEditorUIDataListElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-property-editor-ui-data-list': ContentmentPropertyEditorUIDataListElement;\r\n\t}\r\n}\r\n"],"names":["_addedFormControl","_listEditor","_propertyContext","_repository","_config","_ContentmentPropertyEditorUIDataListElement_instances","init_fn","onChange_fn","ContentmentPropertyEditorUIDataListElement","UmbFormControlMixin","UmbLitElement","__privateAdd","ContentmentDataListRepository","UMB_VALIDATION_EMPTY_LOCALIZATION_KEY","UMB_CONTENT_WORKSPACE_CONTEXT","contentWorkspaceContext","unique","UMB_PROPERTY_CONTEXT","propertyContext","__privateSet","alias","variantId","config","_a","_b","__privateGet","__privateMethod","formControl","html","combinedConfig","event","element","UmbChangeEvent","__decorateClass","state","property","customElement"],"mappings":"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"}