{"version":3,"file":"item-picker-modal.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/item-picker/item-picker-modal.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright Â© 2024 Lee Kelleher\r\n\r\nimport type { ContentmentListItem } from '../types.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tnothing,\r\n\trepeat,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { debounce } from '@umbraco-cms/backoffice/utils';\r\nimport { umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalBaseElement, UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport type { UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\ninterface ContentmentItemPickerModalData {\r\n\tdefaultIcon?: string;\r\n\tenableFilter: boolean;\r\n\tenableMultiple: boolean;\r\n\titems: Array<ContentmentListItem>;\r\n\tlistType: string;\r\n\tmaxItems: number;\r\n}\r\n\r\ninterface ContentmentItemPickerModalValue {\r\n\tselection: Array<string>;\r\n}\r\n\r\nexport const CONTENTMENT_ITEM_PICKER_MODAL = new UmbModalToken<\r\n\tContentmentItemPickerModalData,\r\n\tContentmentItemPickerModalValue\r\n>('Umb.Contentment.Modal.ItemPicker', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n\r\n@customElement('contentment-property-editor-ui-item-picker-modal')\r\nexport class ContentmentPropertyEditorUIItemPickerModalElement extends UmbModalBaseElement<\r\n\tContentmentItemPickerModalData,\r\n\tContentmentItemPickerModalValue\r\n> {\r\n\t@state()\r\n\tprivate _allowSubmit = false;\r\n\r\n\t@state()\r\n\tprivate _itemCount = 0;\r\n\r\n\t@state()\r\n\tprivate _items: Array<ContentmentListItem> = [];\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis._items = this.data?.items ? this.data.items : [];\r\n\t}\r\n\r\n\t#debouncedFilter = debounce((query: string) => {\r\n\t\tif (!this.data) return;\r\n\t\tquery = (query || '').toLocaleLowerCase();\r\n\t\tthis._items = query ? this.data.items.filter((item) => this.#predicate(query, item)) : this.data.items;\r\n\t}, 100);\r\n\r\n\t#predicate = (query: string, item: ContentmentListItem) =>\r\n\t\titem.name.toLocaleLowerCase().includes(query) ||\r\n\t\titem.value.toLocaleLowerCase().includes(query) ||\r\n\t\titem.description?.toLocaleLowerCase().includes(query);\r\n\r\n\t#onSelect(item: ContentmentListItem) {\r\n\t\tif (item.disabled) return;\r\n\r\n\t\tif (this.data?.enableMultiple) {\r\n\t\t\titem.selected = !item.selected;\r\n\t\t\tthis._itemCount = this._items.filter((x) => x.selected === true).length;\r\n\t\t\tthis._allowSubmit = this._itemCount > 0 && (this.data?.maxItems === 0 || this._itemCount <= this.data?.maxItems);\r\n\t\t} else {\r\n\t\t\tthis.value = { selection: [item.value] };\r\n\t\t\tthis._submitModal();\r\n\t\t}\r\n\t}\r\n\r\n\t#onSubmit() {\r\n\t\tconst selection: Array<string> = [];\r\n\r\n\t\tthis._items.forEach((item) => {\r\n\t\t\tif (item.selected) {\r\n\t\t\t\tdelete item.selected;\r\n\t\t\t\tselection.push(item.value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.value = { selection };\r\n\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#onInput(event: UUIInputEvent) {\r\n\t\tthis.#debouncedFilter(event.target.value);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('general_choose')}>\r\n\t\t\t\t${this.#renderFilter()} ${this.#renderInfo()} ${this.#renderItems()}\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_cancel')} @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis.data?.enableMultiple,\r\n\t\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\tlabel=${this.localize.term('buttons_select')}\r\n\t\t\t\t\t\t\t\t?disabled=${!this._allowSubmit}\r\n\t\t\t\t\t\t\t\t@click=${this.#onSubmit}></uui-button>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFilter() {\r\n\t\tif (!this.data?.enableFilter) return nothing;\r\n\t\tconst label = this.localize.term('placeholders_filter');\r\n\t\treturn html`\r\n\t\t\t<uui-input\r\n\t\t\t\ttype=\"search\"\r\n\t\t\t\tid=\"filter\"\r\n\t\t\t\tautocomplete=\"off\"\r\n\t\t\t\tlabel=${label}\r\n\t\t\t\tplaceholder=${label}\r\n\t\t\t\t@input=${this.#onInput}\r\n\t\t\t\t${umbFocus()}>\r\n\t\t\t\t<uui-icon name=\"search\" slot=\"prepend\" id=\"filter-icon\"></uui-icon>\r\n\t\t\t</uui-input>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInfo() {\r\n\t\tif (\r\n\t\t\t!this.data?.enableMultiple ||\r\n\t\t\tthis._itemCount === 0 ||\r\n\t\t\tthis.data?.maxItems === 0 ||\r\n\t\t\tthis._itemCount <= this.data?.maxItems\r\n\t\t) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<contentment-info-box type=\"danger\">\r\n\t\t\t\t<span>\r\n\t\t\t\t\tToo many items selected, please unselect\r\n\t\t\t\t\t<strong>${this._itemCount - (this.data?.maxItems ?? 0)}</strong>\r\n\t\t\t\t\t${this._itemCount - (this.data?.maxItems ?? 0) === 1 ? 'item' : 'items'}.\r\n\t\t\t\t</span>\r\n\t\t\t</contentment-info-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items?.length) return html`<uui-box><p>No items found</p></uui-box>`;\r\n\t\treturn html`\r\n\t\t\t<uui-box>\r\n\t\t\t\t<uui-ref-list>\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._items,\r\n\t\t\t\t\t\t(item) => item.value,\r\n\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t<umb-ref-item\r\n\t\t\t\t\t\t\t\tname=${item.name}\r\n\t\t\t\t\t\t\t\tdetail=${ifDefined(item.description ?? undefined)}\r\n\t\t\t\t\t\t\t\ticon=${ifDefined(item.icon ?? this.data?.defaultIcon ?? 'icon-document')}\r\n\t\t\t\t\t\t\t\tselect-only\r\n\t\t\t\t\t\t\t\tselectable\r\n\t\t\t\t\t\t\t\t@selected=${() => this.#onSelect(item)}\r\n\t\t\t\t\t\t\t\t@deselected=${() => this.#onSelect(item)}>\r\n\t\t\t\t\t\t\t</umb-ref-item>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-ref-list>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#filter {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t#filter-icon {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tcolor: var(--uui-color-border);\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\tcontentment-info-box {\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { ContentmentPropertyEditorUIItemPickerModalElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-property-editor-ui-item-picker-modal': ContentmentPropertyEditorUIItemPickerModalElement;\r\n\t}\r\n}\r\n"],"names":["_debouncedFilter","_predicate","_ContentmentPropertyEditorUIItemPickerModalElement_instances","onSelect_fn","onSubmit_fn","onInput_fn","renderFilter_fn","renderInfo_fn","renderItems_fn","CONTENTMENT_ITEM_PICKER_MODAL","UmbModalToken","ContentmentPropertyEditorUIItemPickerModalElement","UmbModalBaseElement","__privateAdd","debounce","query","item","__privateGet","_a","html","__privateMethod","when","x","_b","_c","selection","event","nothing","label","umbFocus","_d","_e","repeat","ifDefined","css","__decorateClass","state","customElement"],"mappings":"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"}