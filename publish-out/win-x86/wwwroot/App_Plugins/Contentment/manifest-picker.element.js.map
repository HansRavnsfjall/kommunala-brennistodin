{"version":3,"file":"manifest-picker.element.js","sources":["../../../../Umbraco.Community.Contentment.Client/src/property-editor-ui/manifest-picker/manifest-picker.element.ts"],"sourcesContent":["// SPDX-License-Identifier: MPL-2.0\r\n// Copyright Â© 2024 Lee Kelleher\r\n\r\nimport { parseInt } from '../../utils/index.js';\r\nimport { css, customElement, html, nothing, property, repeat, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UMB_ITEM_PICKER_MODAL, UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\n@customElement('contentment-property-editor-ui-manifest-picker')\r\nexport class ContentmentPropertyEditorUIManifestPickerElement\r\n\textends UmbLitElement\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#extensions: Array<typeof umbExtensionsRegistry.MANIFEST_TYPES> = [];\r\n\r\n\t#extensionType?: string;\r\n\r\n\t#maxItems = Infinity;\r\n\r\n\t@property({ type: Array })\r\n\tpublic set value(value: Array<string> | string | undefined) {\r\n\t\tthis.#value = Array.isArray(value) ? value : value ? [value] : [];\r\n\t}\r\n\tpublic get value(): Array<string> | undefined {\r\n\t\treturn this.#value;\r\n\t}\r\n\t#value?: Array<string> = [];\r\n\r\n\tpublic set config(config: UmbPropertyEditorUiElement['config']) {\r\n\t\tif (!config) return;\r\n\r\n\t\tthis.#extensionType = config.getValueByAlias('extensionType');\r\n\t\tthis.#maxItems = parseInt(config.getValueByAlias('maxItems')) || Infinity;\r\n\r\n\t\tthis.#observeExtensions();\r\n\t}\r\n\r\n\t#observeExtensions() {\r\n\t\tif (!this.#extensionType) return;\r\n\t\tthis.observe(umbExtensionsRegistry.byType(this.#extensionType), (extensions) => {\r\n\t\t\tthis.#extensions = extensions.sort((a, b) => a.type.localeCompare(b.type) || a.alias.localeCompare(b.alias));\r\n\t\t});\r\n\t}\r\n\r\n\tasync #onClick() {\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modalContext = modalManager?.open(this, UMB_ITEM_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\theadline: `${this.localize.term('general_choose')}...`,\r\n\t\t\t\titems: this.#extensions\r\n\t\t\t\t\t.filter((ext) => ext.type === this.#extensionType)\r\n\t\t\t\t\t.map((ext) => ({\r\n\t\t\t\t\t\tlabel: (ext as any).meta?.label ?? ext.name,\r\n\t\t\t\t\t\tvalue: ext.alias,\r\n\t\t\t\t\t\tdescription: (ext as any).meta?.description,\r\n\t\t\t\t\t\ticon: (ext as any).meta?.icon,\r\n\t\t\t\t\t})),\r\n\t\t\t},\r\n\t\t\tmodal: { size: 'medium' },\r\n\t\t});\r\n\r\n\t\tconst modalValue = await modalContext?.onSubmit();\r\n\r\n\t\tif (!modalValue) return;\r\n\r\n\t\tthis.#setValue([modalValue.value], this.value?.length ?? 0);\r\n\t}\r\n\r\n\tasync #removeItem(item: string, index: number) {\r\n\t\tif (!item || !this.value || index == -1) return;\r\n\r\n\t\tconst tmp = [...this.value];\r\n\t\ttmp.splice(index, 1);\r\n\t\tthis.value = tmp;\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#setValue(value: Array<string> | undefined, index: number) {\r\n\t\tif (!value || index === -1) return;\r\n\r\n\t\tif (!this.value) {\r\n\t\t\tthis.value = [];\r\n\t\t}\r\n\r\n\t\tconst tmp = [...this.value];\r\n\t\ttmp.splice(index, 0, ...value);\r\n\t\tthis.value = tmp;\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this.#extensionType) return html`<pre><code>Missing configuration for the extension type.</code></pre>`;\r\n\t\treturn html`${this.#renderItems()} ${this.#renderAddButton()}`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\tif (!this.#extensionType || (this.value && this.value.length >= this.#maxItems)) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tcolor=\"default\"\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\tlabel=${this.localize.term('general_choose')}\r\n\t\t\t\t@click=${this.#onClick}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this.#extensionType || !this.value) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis.value,\r\n\t\t\t\t\t(alias) => alias,\r\n\t\t\t\t\t(alias, index) => this.#renderItem(alias, index)\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItem(alias: string, index: number) {\r\n\t\tconst ext = this.#extensions.find((ext) => ext.alias === alias) as any;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-node\r\n\t\t\t\tname=${ext.meta?.label ?? ext.name}\r\n\t\t\t\tdetail=${ext.meta?.description}\r\n\t\t\t\t?standalone=${this.#maxItems === 1}>\r\n\t\t\t\t${when(ext.meta?.icon, (_icon) => html`<umb-icon slot=\"icon\" name=${_icon}></umb-icon>`)}\r\n\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}\r\n\t\t\t\t\t\t@click=${() => this.#removeItem(alias, index)}></uui-button>\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</uui-ref-node>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { ContentmentPropertyEditorUIManifestPickerElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'contentment-property-editor-ui-manifest-picker': ContentmentPropertyEditorUIManifestPickerElement;\r\n\t}\r\n}\r\n"],"names":["_extensions","_extensionType","_maxItems","_value","_ContentmentPropertyEditorUIManifestPickerElement_instances","observeExtensions_fn","onClick_fn","removeItem_fn","setValue_fn","renderAddButton_fn","renderItems_fn","renderItem_fn","ContentmentPropertyEditorUIManifestPickerElement","UmbLitElement","__privateAdd","value","__privateSet","__privateGet","config","parseInt","__privateMethod","html","umbExtensionsRegistry","extensions","a","b","modalManager","UMB_MODAL_MANAGER_CONTEXT","modalContext","UMB_ITEM_PICKER_MODAL","ext","_a","_b","_c","modalValue","item","index","tmp","UmbChangeEvent","nothing","repeat","alias","when","_icon","css","__decorateClass","property","customElement"],"mappings":"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"}