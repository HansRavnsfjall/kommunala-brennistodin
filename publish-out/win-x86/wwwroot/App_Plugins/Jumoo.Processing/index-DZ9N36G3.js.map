{"version":3,"file":"index-DZ9N36G3.js","sources":["../../../jumoo-processing-assets/src/pipeline/steps/models.ts","../../../jumoo-processing-assets/src/pipeline/components/progress.element.ts","../../../jumoo-processing-assets/src/pipeline/components/background.element.ts","../../../jumoo-processing-assets/src/pipeline/components/progress.step.element.ts","../../../jumoo-processing-assets/src/pipeline/components/process-error.element.ts","../../../jumoo-processing-assets/src/pipeline/components/pipeline-table.element.ts","../../../jumoo-processing-assets/src/pipeline/workspace/types.ts","../../../jumoo-processing-assets/src/pipeline/components/pipeline-list.element.ts","../../../jumoo-processing-assets/src/pipeline/modal/pipeline-modal.token.ts","../../../jumoo-processing-assets/src/pipeline/modal/errors/error-modal.token.ts","../../../jumoo-processing-assets/src/pipeline/pipeline.element.ts","../../../jumoo-processing-assets/src/pipeline/pipeline.context.ts","../../../jumoo-processing-assets/src/pipeline/pipeline.repository.ts","../../../jumoo-processing-assets/src/pipeline/pipeline.source.ts","../../../jumoo-processing-assets/src/pipeline/pipelines.context.ts","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/Errors.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/HttpClient.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/ILogger.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/Loggers.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/Utils.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/FetchHttpClient.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/XhrHttpClient.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/DefaultHttpClient.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/TextMessageFormat.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/HandshakeProtocol.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/IHubProtocol.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/Subject.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/MessageBuffer.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/HubConnection.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/DefaultReconnectPolicy.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/HeaderNames.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/AccessTokenHttpClient.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/ITransport.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/AbortController.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/LongPollingTransport.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/ServerSentEventsTransport.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/WebSocketTransport.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/HttpConnection.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/JsonHubProtocol.js","../../../jumoo-processing-assets/node_modules/@microsoft/signalr/dist/esm/HubConnectionBuilder.js","../../../jumoo-processing-assets/src/signalr/signalr.context.ts","../../../jumoo-processing-assets/src/api/types.gen.ts","../../../jumoo-processing-assets/node_modules/@hey-api/client-fetch/dist/index.js","../../../jumoo-processing-assets/src/api/client.gen.ts","../../../jumoo-processing-assets/src/api/sdk.gen.ts","../../../jumoo-processing-assets/src/pipeline/modal/errors/manifest.ts","../../../jumoo-processing-assets/src/pipeline/modal/manifest.ts","../../../jumoo-processing-assets/src/pipeline/workspace/manifest.ts","../../../jumoo-processing-assets/src/lang/manifest.ts","../../../jumoo-processing-assets/src/constants.ts","../../../jumoo-processing-assets/src/queue/queue.repository.ts","../../../jumoo-processing-assets/src/queue/queue.context.ts","../../../jumoo-processing-assets/src/queue/components/queue-table.element.ts","../../../jumoo-processing-assets/src/queue/components/queue-list.element.ts","../../../jumoo-processing-assets/src/index.ts"],"sourcesContent":["import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { PipelineState, ProcessingOptions, ProcessingResults } from '@jumoo/processing';\r\n\r\nexport class ProcessStepElement extends HTMLElement {\r\n\tpipelineId: string | null | undefined;\r\n\tstate: PipelineState | null | undefined;\r\n\toptions: ProcessingOptions | null | undefined;\r\n\tresults: ProcessingResults | null | undefined;\r\n}\r\n\r\nexport class ProcessStepElementBase extends UmbLitElement {\r\n\t@property({ type: String })\r\n\tpipelineId: string | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tstate: PipelineState | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\toptions: ProcessingOptions | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tresults: ProcessingResults | null | undefined;\r\n}\r\n","import {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tproperty,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\nimport { ProcessingMessage, ProgressInformation, StepStatus } from '@jumoo/processing';\r\n\r\n@customElement('jumoo-pipeline-progress')\r\nexport class JumooPipelineProgressElement extends UmbLitElement {\r\n\t@property({ type: Object })\r\n\tpublic progress: ProgressInformation | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tpublic message: ProcessingMessage | undefined;\r\n\r\n\tpublic render() {\r\n\t\tif (!this.progress) return nothing;\r\n\r\n\t\tconst steps = this.progress.steps.map((step) => {\r\n\t\t\tconst className =\r\n\t\t\t\tstep.status === StepStatus.COMPLETE\r\n\t\t\t\t\t? 'complete'\r\n\t\t\t\t\t: step.status === StepStatus.RUNNING\r\n\t\t\t\t\t\t? 'running'\r\n\t\t\t\t\t\t: 'pending';\r\n\r\n\t\t\tconst icon = step.icon ?? 'icon-checkmark';\r\n\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"step ${className}\">\r\n\t\t\t\t\t<uui-icon .name=${icon}></uui-icon>\r\n\t\t\t\t\t<div class=\"step-name\">${step.name}</div>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t});\r\n\r\n\t\treturn html`<div class=\"step-progress\">\r\n\t\t\t<div class=\"steps\">${steps}</div>\r\n\t\t\t${this.renderMessages()}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tprivate renderMessages() {\r\n\t\treturn html`<div class=\"message\">\r\n\t\t\t<div class=\"content\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<h4>${this.message?.title}</h4>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<small>${this.message?.message}</small>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"progress\">\r\n\t\t\t\t<uui-progress-bar .progress=${this.message?.progress ?? 0}></uui-progress-bar>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t:host {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tflex-direction: column;\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\r\n\t\t.progress {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tjustify-content: center;\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\r\n\t\tuui-progress-bar {\r\n\t\t\theight: 10px;\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0;\r\n\t\t\tborder-radius: 0;\r\n\t\t}\r\n\r\n\t\t.message {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t\tjustify-content: center;\r\n\t\t\twidth: 100%;\r\n\t\t}\r\n\r\n\t\t.content {\r\n\t\t\twidth: 100%;\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t\talign-content: center;\r\n\t\t\tjustify-content: center;\r\n\t\t}\r\n\r\n\t\t.content > div {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tjustify-content: center;\r\n\t\t\theight: 3rem;\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0;\r\n\t\t}\r\n\r\n\t\t.content > div > * {\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0;\r\n\t\t\tdisplay: block;\r\n\t\t\toverflow: hidden;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\r\n\t\t.step-progress {\r\n\t\t\twidth: 100%;\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\r\n\t\t.steps {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: row;\r\n\t\t\tflex-flow: row wrap;\r\n\t\t\tjustify-content: center;\r\n\t\t\twidth: 100%;\r\n\t\t\tmargin-bottom: var(--uui-size-space-3);\r\n\t\t\tgap: 5px;\r\n\t\t}\r\n\r\n\t\t.step {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-grow: 1;\r\n\t\t\tmargin: 0 16px;\r\n\t\t\tmax-width: 75px;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t\talign-content: center;\r\n\t\t}\r\n\r\n\t\t.step uui-icon {\r\n\t\t\tfont-size: 30pt;\r\n\t\t\tmargin: 5px 0;\r\n\t\t}\r\n\r\n\t\t.step-name {\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-weight: 900;\r\n\t\t}\r\n\r\n\t\t.step.complete uui-icon {\r\n\t\t\tcolor: green;\r\n\t\t}\r\n\t\t.step.running uui-icon {\r\n\t\t\tcolor: blue;\r\n\t\t}\r\n\t\t.step.pending uui-icon {\r\n\t\t\tcolor: gray;\r\n\t\t}\r\n\r\n\t\t.progress {\r\n\t\t\twidth: 100%;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default JumooPipelineProgressElement;\r\n","import { css, customElement, html, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { ProcessingMessage } from '../../signalr';\r\nimport {\r\n\tPipelineBackgroundState,\r\n\tPipelineState,\r\n\tPipelineStatus,\r\n\tProcessingOptions,\r\n} from '@jumoo/processing';\r\nimport { ManifestProcessStep } from '@jumoo/processing';\r\n\r\n@customElement('jumoo-pipeline-background')\r\nexport class JumooPipelineBackgroundElement extends UmbLitElement {\r\n\t@property({ type: String })\r\n\tpipelineId: string | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tmessage: ProcessingMessage | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tstate: PipelineState | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tbackground: PipelineBackgroundState | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\t_options: ProcessingOptions | undefined;\r\n\r\n\tpublic render() {\r\n\t\tswitch (this.state?.status) {\r\n\t\t\tcase PipelineStatus.COMPLETED:\r\n\t\t\t\treturn this.renderComplete();\r\n\t\t\tcase PipelineStatus.FAILED:\r\n\t\t\t\treturn this.renderError();\r\n\t\t\tdefault:\r\n\t\t\t\treturn html`${this.renderBackgroundBanner()} ${this.renderProgress()}`;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderBackgroundBanner() {\r\n\t\treturn html`<uui-box class=\"banner\">\r\n\t\t\t<umb-localize key=\"jumooProcBackground_running\"></umb-localize>\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\tprivate renderProgress() {\r\n\t\treturn html`<jumoo-pipeline-progress\r\n\t\t\t.progress=${this.state?.progress}\r\n\t\t\t.message=${this.message}></jumoo-pipeline-progress>`;\r\n\t}\r\n\r\n\tprivate renderComplete() {\r\n\t\treturn !this.background?.completedElement\r\n\t\t\t? html`<uui-box\r\n\t\t\t\t\t\t><umb-localize key=\"jumooProcBackground_completed\"></umb-localize\r\n\t\t\t\t\t></uui-box>\r\n\t\t\t\t\t<pre>${JSON.stringify(this.state, null, 1)}</pre>`\r\n\t\t\t: html`${this.renderElement(this.background.completedElement)}`;\r\n\t}\r\n\r\n\tprivate renderError() {\r\n\t\treturn !this.background?.failedElement\r\n\t\t\t? html`<uui-box\r\n\t\t\t\t\t\t><umb-localize key=\"jumooProcBackground_error\"></umb-localize\r\n\t\t\t\t\t></uui-box>\r\n\t\t\t\t\t<pre>${JSON.stringify(this.state, null, 1)}</pre>`\r\n\t\t\t: html`${this.renderElement(this.background.failedElement)}`;\r\n\t}\r\n\r\n\tprivate renderElement(element: string | null | undefined) {\r\n\t\treturn html`<umb-extension-slot\r\n\t\t\ttype=\"jumoo-process-step\"\r\n\t\t\t.filter=${(ext: ManifestProcessStep) => ext.elementName === element}\r\n\t\t\t.props=${{\r\n\t\t\t\tpipelineId: this.pipelineId,\r\n\t\t\t\tstate: this.state,\r\n\t\t\t\toptions: this._options,\r\n\t\t\t}}></umb-extension-slot>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t:host {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\r\n\t\t.banner {\r\n\t\t\tbackground-color: var(--uui-color-current);\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default JumooPipelineBackgroundElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-pipeline-background': JumooPipelineBackgroundElement;\r\n\t}\r\n}\r\n","import { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport {\r\n\tcustomElement,\r\n\thtml,\r\n\tLitElement,\r\n\tnothing,\r\n\tproperty,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport {\r\n\tManifestProcessStep,\r\n\tPipelineState,\r\n\tProcessingOptions,\r\n\tProcessingResults,\r\n} from '@jumoo/processing';\r\n\r\n/**\r\n * renders the step in the pipeline, from the custom elements.\r\n */\r\n@customElement('jumoo-process-step')\r\nexport class JumooProcessStepElement extends UmbElementMixin(LitElement) {\r\n\t@property({ type: String })\r\n\tpublic pipelineId: string | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tpublic state?: PipelineState | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tpublic options?: ProcessingOptions | null | undefined;\r\n\r\n\t@property({ type: Object })\r\n\tpublic resutls?: ProcessingResults | null | undefined;\r\n\r\n\trender() {\r\n\t\treturn this.state?.currentRequest?.action?.element === null\r\n\t\t\t? nothing\r\n\t\t\t: this.renderStepElement();\r\n\t}\r\n\r\n\tprivate renderStepElement() {\r\n\t\treturn html`\r\n\t\t\t<umb-extension-slot\r\n\t\t\t\ttype=\"jumoo-process-step\"\r\n\t\t\t\t.filter=${(ext: ManifestProcessStep) =>\r\n\t\t\t\t\text.elementName === this.state?.elementName}\r\n\t\t\t\t.props=${{\r\n\t\t\t\t\tpipelineId: this.pipelineId,\r\n\t\t\t\t\tstate: this.state,\r\n\t\t\t\t\toptions: this.options,\r\n\t\t\t\t\tresutls: this.resutls,\r\n\t\t\t\t}}></umb-extension-slot>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport default JumooProcessStepElement;\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { JUMOO_PROCESSING_ERROR_MODAL, ProcessingErrorDetails } from '@jumoo/processing';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tproperty,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\n\r\n@customElement('jumoo-processing-error')\r\nexport class JumooProcessingErrorElement extends UmbLitElement {\r\n\t@property({ type: Object })\r\n\terror: ProcessingErrorDetails | undefined | null;\r\n\r\n\tasync #openErrorModal() {\r\n\t\tif (!this.error) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalManager) return;\r\n\r\n\t\tconst errorModal = modalManager.open(this, JUMOO_PROCESSING_ERROR_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\terror: this.error,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst result = await errorModal.onSubmit().catch(() => {\r\n\t\t\t// ignore\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn !this.error ? nothing : this.renderError(this.error);\r\n\t}\r\n\r\n\trenderError(error: ProcessingErrorDetails) {\r\n\t\treturn html`<div class=\"error\">\r\n\t\t\t<div class=\"header\">\r\n\t\t\t\t<uui-icon name=\"icon-wrong\"></uui-icon>\r\n\t\t\t\t<h3>${error.message}</h3>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"more\">\r\n\t\t\t\t<uui-button @click=${this.#openErrorModal} look=\"primary\" color=\"danger\"\r\n\t\t\t\t\t><umb-localize key=\"jumooProcError_details\"></umb-localize\r\n\t\t\t\t></uui-button>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t.error {\r\n\t\t\tpadding: 0;\r\n\t\t\tbackground-color: var(--uui-color-danger);\r\n\t\t\tcolor: var(--uui-color-default-contrast);\r\n\t\t}\r\n\r\n\t\t.error .header {\r\n\t\t\tdisplay: flex;\r\n\t\t\tgap: 5px;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 5px;\r\n\t\t\tborder-bottom: 1px solid var(--uui-color-default-contrast);\r\n\t\t}\r\n\r\n\t\th3 {\r\n\t\t\tpadding: 0;\r\n\t\t\tmargin: 0;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\tuui-icon {\r\n\t\t\tfont-size: 32px;\r\n\t\t}\r\n\r\n\t\t.error .more {\r\n\t\t\tpadding: 8px;\r\n\t\t\ttext-align: right;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default JumooProcessingErrorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-processing-error': JumooProcessingErrorElement;\r\n\t}\r\n}\r\n","import { Pipeline, ProcessingTimeOptions } from '@jumoo/processing';\r\nimport { UmbTableColumn, UmbTableConfig } from '@umbraco-cms/backoffice/components';\r\nimport {\r\n\tcustomElement,\r\n\thtml,\r\n\tproperty,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('jumoo-pipelines-table')\r\nexport class JumooPipelinesTableElement extends UmbLitElement {\r\n\t@property({ type: Array })\r\n\tpipelines: Pipeline[] = [];\r\n\r\n\t@property({ type: Boolean })\r\n\thideDelete: boolean = false;\r\n\r\n\t@state()\r\n\t_tableConfig: UmbTableConfig = {\r\n\t\tallowSelection: false,\r\n\t\thideIcon: false,\r\n\t};\r\n\r\n\t@property({ type: Array })\r\n\ttableColumns: UmbTableColumn[] = [\r\n\t\t{ name: 'Alias', alias: 'alias' },\r\n\t\t{ name: 'Strategy', alias: 'strategy' },\r\n\t\t{ name: 'State', alias: 'state' },\r\n\t\t{ name: 'Action', alias: 'action' },\r\n\t\t{ name: 'Background', alias: 'background' },\r\n\t\t{ name: 'Scheduled', alias: 'scheduled' },\r\n\t\t{ name: 'Actions', alias: 'actions' },\r\n\t];\r\n\r\n\t@state()\r\n\tfilter: any;\r\n\r\n\t#onViewPipeline(e: Event) {\r\n\t\tconst element = e.target as HTMLElement;\r\n\t\tif (!element) return;\r\n\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('view-pipeline', {\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tpiplineId: element.id,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\t#onDeletePipeline(id: string) {\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('delete-pipeline', {\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tpiplineId: id,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst items = this.pipelines\r\n\t\t\t.map((pipeline) => {\r\n\t\t\t\tif (!pipeline) return undefined;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: pipeline.id,\r\n\t\t\t\t\ticon: 'icon-layers',\r\n\t\t\t\t\tdata: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'alias',\r\n\t\t\t\t\t\t\tvalue: pipeline.alias,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'strategy',\r\n\t\t\t\t\t\t\tvalue: pipeline.strategy,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'state',\r\n\t\t\t\t\t\t\tvalue: pipeline.state.status,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'action',\r\n\t\t\t\t\t\t\tvalue: pipeline.state.currentRequest?.action?.alias ?? 'no action',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'background',\r\n\t\t\t\t\t\t\tvalue: html`<umb-icon\r\n\t\t\t\t\t\t\t\t.name=${when(\r\n\t\t\t\t\t\t\t\t\t(pipeline.state.backgroundState?.isBackgroundRequest ?? false) == true,\r\n\t\t\t\t\t\t\t\t\t() => 'icon-check',\r\n\t\t\t\t\t\t\t\t\t() => 'icon-close',\r\n\t\t\t\t\t\t\t\t)}></umb-icon>`,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'scheduled',\r\n\t\t\t\t\t\t\tvalue: !pipeline.state.schedule\r\n\t\t\t\t\t\t\t\t? ''\r\n\t\t\t\t\t\t\t\t: this.localize.date(pipeline.state.schedule, ProcessingTimeOptions),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'actions',\r\n\t\t\t\t\t\t\tvalue: html`${this.renderActions(pipeline)}`,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.filter((item) => item !== undefined);\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-table\r\n\t\t\t\t.config=${this._tableConfig}\r\n\t\t\t\t.columns=${this.tableColumns}\r\n\t\t\t\t.items=${items}\r\n\t\t\t\t.filter=${this.filter}></umb-table>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderActions(pipeline: Pipeline) {\r\n\t\treturn html`<uui-button-group\r\n\t\t\t><uui-button\r\n\t\t\t\t.id=${pipeline.id}\r\n\t\t\t\tlabel=\"View\"\r\n\t\t\t\tcolor=\"positive\"\r\n\t\t\t\tlook=\"outline\"\r\n\t\t\t\t@click=${this.#onViewPipeline}\r\n\t\t\t\t>View</uui-button\r\n\t\t\t>\r\n\t\t\t${this.hideDelete\r\n\t\t\t\t? ''\r\n\t\t\t\t: html`<uui-button\r\n\t\t\t\t\t\tlabel=\"Delete\"\r\n\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\t@click=${() => this.#onDeletePipeline(pipeline.id)}\r\n\t\t\t\t\t\t>Delete</uui-button\r\n\t\t\t\t\t>`}</uui-button-group\r\n\t\t>`;\r\n\t}\r\n}\r\n\r\nexport default JumooPipelinesTableElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-pipelines-table': JumooPipelinesTableElement;\r\n\t}\r\n}\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport {\r\n\tUmbWorkspaceModalData,\r\n\tUmbWorkspaceModalValue,\r\n} from '@umbraco-cms/backoffice/workspace';\r\n\r\nexport const JUMOO_PROCESSING_PIPELINE_WORKSPACE_ALIAS =\r\n\t'jumoo-processing-pipeline-workspace';\r\nexport const JUMOO_PROCESSING_PIPELINE_WORKSPACE_CONTEXT_ALIAS =\r\n\t'jumoo-processing-pipeline-workspace-context';\r\n\r\nexport const JUMOO_PROCESSING_PIPELINE_ENTITY_TYPE = 'processing-pipeline';\r\n\r\nexport const JUMOO_PIPELINE_WORKSPACE_MODAL = new UmbModalToken<\r\n\tUmbWorkspaceModalData,\r\n\tUmbWorkspaceModalValue\r\n>('Umb.Modal.Workspace', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'medium',\r\n\t},\r\n});\r\n","import {\r\n\tJUMOO_PIPELINES_CONTEXT,\r\n\tPipeline,\r\n\tPipelinesContext,\r\n\tPipelineStatus,\r\n} from '@jumoo/processing';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tproperty,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport {\r\n\tJUMOO_PIPELINE_WORKSPACE_MODAL,\r\n\tJUMOO_PROCESSING_PIPELINE_ENTITY_TYPE,\r\n} from '../workspace/types';\r\n\r\n@customElement('jumoo-pipeline-list')\r\nexport class JumooProcessingPipelineList extends UmbLitElement {\r\n\t#pipelinesContext: PipelinesContext | undefined;\r\n\t#modalController!: UmbModalRouteRegistrationController;\r\n\r\n\t@property({ type: String })\r\n\theadline: string = 'Processing Pipelines';\r\n\r\n\t@property({ type: Boolean })\r\n\thideDelete: boolean = false;\r\n\r\n\t@property({ type: String })\r\n\tdefaultStatus: PipelineStatus = PipelineStatus.WAITING;\r\n\r\n\t@property({ type: Array })\r\n\tstatuses: PipelineStatus[] = [\r\n\t\tPipelineStatus.WAITING,\r\n\t\tPipelineStatus.RUNNING,\r\n\t\tPipelineStatus.COMPLETED,\r\n\t\tPipelineStatus.FAILED,\r\n\t];\r\n\r\n\t@state()\r\n\t_modalPath: string = '';\r\n\r\n\t@state()\r\n\tstatus: PipelineStatus | undefined = PipelineStatus.WAITING;\r\n\r\n\t@state()\r\n\tpipelines?: Pipeline[];\r\n\r\n\t@state()\r\n\tloading: boolean = true;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(JUMOO_PIPELINES_CONTEXT, (context) => {\r\n\t\t\tthis.#pipelinesContext = context;\r\n\t\t});\r\n\r\n\t\tthis._setupModalController();\r\n\t}\r\n\r\n\tconnectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.status = this.defaultStatus;\r\n\t\tthis.getPipelines();\r\n\t}\r\n\r\n\t_setupModalController() {\r\n\t\tthis.#modalController = new UmbModalRouteRegistrationController(\r\n\t\t\tthis,\r\n\t\t\tJUMOO_PIPELINE_WORKSPACE_MODAL,\r\n\t\t)\r\n\t\t\t.addAdditionalPath(JUMOO_PROCESSING_PIPELINE_ENTITY_TYPE)\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tentityType: JUMOO_PROCESSING_PIPELINE_ENTITY_TYPE,\r\n\t\t\t\t\t\tpreset: {},\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.onSubmit(async () => {\r\n\t\t\t\tawait this.getPipelines();\r\n\t\t\t})\r\n\t\t\t.onReject(async () => {\r\n\t\t\t\tawait this.getPipelines();\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._modalPath = routeBuilder({});\r\n\t\t\t});\r\n\t}\r\n\r\n\tasync getPipelines() {\r\n\t\tthis.loading = true;\r\n\t\tthis.pipelines = await this.#pipelinesContext?.listPipelines(\r\n\t\t\tthis.status ?? PipelineStatus.WAITING,\r\n\t\t);\r\n\t\tthis.loading = false;\r\n\t}\r\n\r\n\tonViewPipeline(e: CustomEvent) {\r\n\t\tthis.#modalController.open(\r\n\t\t\t{ alias: e.detail.piplineId },\r\n\t\t\t'edit/' + e.detail.piplineId,\r\n\t\t);\r\n\t}\r\n\r\n\tasync onDeletePipeline(e: CustomEvent) {\r\n\t\tawait this.#pipelinesContext?.clear(e.detail.piplineId);\r\n\t\tthis.getPipelines();\r\n\t}\r\n\r\n\tasync onStatusChange(e: Event) {\r\n\t\tconst element = e.target as HTMLSelectElement;\r\n\t\tif (!element) return;\r\n\r\n\t\tthis.status = element.value as PipelineStatus;\r\n\r\n\t\tawait this.getPipelines();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`<uui-box style=\"--uui-box-default-padding: 0;\" .headline=${this.headline}>\r\n\t\t\t<div slot=\"header-actions\">\r\n\t\t\t\tStatus: ${this.renderDropdown()} ${this.renderRefresh()}\r\n\t\t\t</div>\r\n\t\t\t${when(\r\n\t\t\t\tthis.loading,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-loader-bar\r\n\t\t\t\t\t\tanimationDuration=\"1.5\"\r\n\t\t\t\t\t\tstyle=\"color: black\"></uui-loader-bar>`,\r\n\t\t\t\t() => this.renderListPipelines(),\r\n\t\t\t)}\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderRefresh() {\r\n\t\treturn html`<uui-button @click=${this.getPipelines} label=\"refresh\" compact\r\n\t\t\t><uui-icon name=\"icon-refresh\"></uui-icon\r\n\t\t></uui-button>`;\r\n\t}\r\n\r\n\trenderDropdown() {\r\n\t\tconst options: Array<Option> = this.statuses.map((status) => {\r\n\t\t\treturn {\r\n\t\t\t\tname: status,\r\n\t\t\t\tvalue: status,\r\n\t\t\t\tselected: status === this.status,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn options.length <= 1\r\n\t\t\t? html`${this.status}`\r\n\t\t\t: html`\r\n\t\t\t\t\t<uui-select\r\n\t\t\t\t\t\t.options=${options}\r\n\t\t\t\t\t\t@change=${this.onStatusChange}\r\n\t\t\t\t\t\tlabel=\"status\"></uui-select>\r\n\t\t\t\t`;\r\n\t}\r\n\r\n\trenderListPipelines() {\r\n\t\treturn !this.pipelines || this.pipelines.length === 0\r\n\t\t\t? html`<div class=\"emtpy\">Nothing with status ${this.status}</div>`\r\n\t\t\t: html`<jumoo-pipelines-table\r\n\t\t\t\t\t.pipelines=${this.pipelines}\r\n\t\t\t\t\t.hideDelete=${this.hideDelete}\r\n\t\t\t\t\t@view-pipeline=${this.onViewPipeline}\r\n\t\t\t\t\t@delete-pipeline=${this.onDeletePipeline}></jumoo-pipelines-table>`;\r\n\t}\r\n\r\n\trenderPipeline(pipeline: Pipeline) {\r\n\t\treturn html`\r\n\t\t\t<div>${pipeline.alias}</div>\r\n\t\t\t<div>${pipeline.state.status}</div>\r\n\t\t\t<div>${pipeline.state.currentRequest?.action?.alias}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t.emtpy {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\tpadding: 20px;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default JumooProcessingPipelineList;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-pipeline-list': JumooProcessingPipelineList;\r\n\t}\r\n}\r\n","import { ProcessingOptions } from '@jumoo/processing';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport type JumooProcessingModalData = {\r\n\theadline: string;\r\n\tdescription?: string;\r\n\tprogressLabel?: string;\r\n\tcloseLabel?: string;\r\n\tprocessor: string;\r\n\tstrategy: string;\r\n\toptions: ProcessingOptions;\r\n\tdebug?: boolean;\r\n\twidth?: number;\r\n\theight?: number;\r\n};\r\n\r\nexport type JumooProcessingModalResult = {\r\n\tsuccess: boolean;\r\n};\r\n\r\nexport type JumooProcessingModalInfo = {\r\n\theadline: string;\r\n\tprogressLabel?: string;\r\n\tcloseLabel?: string;\r\n};\r\n\r\nexport const JUMOO_PROCESSING_MODAL_ALIAS = 'jumoo-processing-modal';\r\n\r\n/**\r\n * @description simple process modal open as a dialog\r\n */\r\nexport const JUMOO_PROCESSING_DIALOG_MODAL = new UmbModalToken<\r\n\tJumooProcessingModalData,\r\n\tJumooProcessingModalResult\r\n>(JUMOO_PROCESSING_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\tsize: 'small',\r\n\t\ttype: 'dialog',\r\n\t},\r\n});\r\n\r\n/**\r\n * @description simple process modal open as a sidebar\r\n */\r\nexport const JUMOO_PROCESSING_SIDEBAR_MODAL = new UmbModalToken<\r\n\tJumooProcessingModalData,\r\n\tJumooProcessingModalResult\r\n>(JUMOO_PROCESSING_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\tsize: 'small',\r\n\t\ttype: 'sidebar',\r\n\t},\r\n});\r\n\r\n/**\r\n * @description simple process modal open as a sidebar\r\n */\r\nexport const JUMOO_PROCESSING_SIDEBAR_MEDIUM_MODAL = new UmbModalToken<\r\n\tJumooProcessingModalData,\r\n\tJumooProcessingModalResult\r\n>(JUMOO_PROCESSING_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\tsize: 'medium',\r\n\t\ttype: 'sidebar',\r\n\t},\r\n});\r\n\r\n/**\r\n * @description simple process modal open as a sidebar\r\n */\r\nexport const JUMOO_PROCESSING_SIDEBAR_LARGE_MODAL = new UmbModalToken<\r\n\tJumooProcessingModalData,\r\n\tJumooProcessingModalResult\r\n>(JUMOO_PROCESSING_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\tsize: 'large',\r\n\t\ttype: 'sidebar',\r\n\t},\r\n});\r\n","import { ProcessingErrorDetails } from '@jumoo/processing';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport type JumooProcessingErrorModalData = {\r\n\terror: ProcessingErrorDetails;\r\n};\r\n\r\nexport type JumooProcessingErrorModalResult = {\r\n\tsuccess: boolean;\r\n};\r\n\r\nexport const JUMOO_PROCESSING_ERROR_MODAL_ALIAS = 'jumoo-processing-error-modal';\r\n\r\nexport const JUMOO_PROCESSING_ERROR_MODAL = new UmbModalToken<\r\n\tJumooProcessingErrorModalData,\r\n\tJumooProcessingErrorModalResult\r\n>(JUMOO_PROCESSING_ERROR_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\tsize: 'large',\r\n\t\ttype: 'sidebar',\r\n\t},\r\n});\r\n","import {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tproperty,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport {\r\n\tPipelineContext,\r\n\tPipeline,\r\n\tPipelineState,\r\n\tPipelineStatus,\r\n\tProcessingMessage,\r\n\tManifestProcessStep,\r\n\tProcessingOptions,\r\n\tProcessingResults,\r\n\tJUMOO_PROCESSING_CONTEXT,\r\n} from '@jumoo/processing';\r\n\r\n/**\r\n * @property {string} processor - the processor to use for the pipeline\r\n * @property {string} strategy - the strategy to use for the pipeline\r\n * @property {ProcessingOptions} options - the options to see the pipeline with\r\n *\r\n * @fires pipeline-complete - when the pipeline is complete\r\n * @fires pipeline-waiting - when the pipeline is waiting for user input\r\n * @fires pipeline-last-action - when the pipeline is on the last action\r\n * @fires pipeline-status - the current status of the pipeline.\r\n */\r\n@customElement('jumoo-pipeline')\r\nexport class JumooPipelineElement extends UmbLitElement {\r\n\tprivate context?: PipelineContext;\r\n\r\n\t/**\r\n\t * @description The processor to use for the pipeline\r\n\t */\r\n\t@property({ type: String })\r\n\tprocessor?: string;\r\n\r\n\t/**\r\n\t * @description The strategy to use for the pipeline\r\n\t */\r\n\t@property({ type: String })\r\n\tstrategy?: string;\r\n\r\n\t/**\r\n\t * @description The setup options for the pipeline\r\n\t */\r\n\t@property({ type: Object })\r\n\tsetup: ProcessingOptions | undefined;\r\n\r\n\t@property({ type: String })\r\n\tpipelineId: string | undefined;\r\n\r\n\t/**\r\n\t * @description - show debug information\r\n\t */\r\n\t@property({ type: Boolean })\r\n\tdebug: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _pipelineId: string | undefined;\r\n\r\n\t@state()\r\n\tprivate options: ProcessingOptions | undefined;\r\n\r\n\t@state()\r\n\tprivate state: PipelineState | undefined;\r\n\r\n\t@state()\r\n\tprivate results: ProcessingResults | undefined;\r\n\r\n\t@state()\r\n\tprivate message: ProcessingMessage | undefined;\r\n\r\n\t@state()\r\n\tprivate backgroundState: PipelineState | undefined;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(JUMOO_PROCESSING_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\r\n\t\t\tthis.context = context;\r\n\r\n\t\t\tthis.observe(this.context.trigger, async (trigger) => {\r\n\t\t\t\tif (trigger === true) {\r\n\t\t\t\t\tawait this.process();\r\n\t\t\t\t\tthis.context?.clearNext();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context.close, async (close) => {\r\n\t\t\t\tif (close === true) {\r\n\t\t\t\t\tthis.context?.triggerFinalized();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context.pipeline, (pipeline) => {\r\n\t\t\t\tthis._pipelineId = pipeline;\r\n\r\n\t\t\t\tif (this._pipelineId) {\r\n\t\t\t\t\tthis.context?.getPipeline(this._pipelineId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context.state, (state) => {\r\n\t\t\t\tthis.state = state;\r\n\r\n\t\t\t\tif (this.state) {\r\n\t\t\t\t\tthis.dispatchEvent(\r\n\t\t\t\t\t\tnew CustomEvent('pipeline-status', {\r\n\t\t\t\t\t\t\tbubbles: true,\r\n\t\t\t\t\t\t\tcomposed: true,\r\n\t\t\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\t\t\tstatus: this.state?.status,\r\n\t\t\t\t\t\t\t\tisLastAction: this.state?.progress.isLastAction,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.state?.progress.isLastAction === true) {\r\n\t\t\t\t\tthis.onLastAction();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context?.backgroundState, (backgroundState) => {\r\n\t\t\t\tthis.backgroundState = backgroundState;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context.options, (options) => {\r\n\t\t\t\tthis.options = options;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context.message, (message) => {\r\n\t\t\t\tthis.message = message;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.context.results, (results) => {\r\n\t\t\t\tthis.results = results;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tconnectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tif (this.pipelineId) {\r\n\t\t\tthis.context?.loadPipeline(this.pipelineId);\r\n\t\t} else if (this.strategy && this.processor) {\r\n\t\t\tthis.options = this.setup;\r\n\t\t\tthis.context?.createPipeline(this.processor, this.strategy, this.setup);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async process() {\r\n\t\tlet result: Pipeline | undefined;\r\n\r\n\t\tdo {\r\n\t\t\tresult = await this.context?.process();\r\n\t\t} while (result?.state.status == PipelineStatus.RUNNING);\r\n\r\n\t\t// either complete, or waiting for user.\r\n\t\tswitch (result?.state.status) {\r\n\t\t\tcase PipelineStatus.COMPLETED:\r\n\t\t\t\tthis.onComplete();\r\n\t\t\t\tbreak;\r\n\t\t\tcase PipelineStatus.BACKGROUND:\r\n\t\t\t\tthis.onBackground();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis.onWaiting();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @description dispatches a named custom event, with the pipelineId and state,\r\n\t * @param name name of event to file\r\n\t */\r\n\tprivate fireEvent(name: string) {\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent(name, {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tpielineId: this._pipelineId,\r\n\t\t\t\t\tstate: this.state,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tprivate onBackground() {\r\n\t\tthis.fireEvent('pipeline-background');\r\n\t}\r\n\r\n\t/**\r\n\t * @description when the pipeline is complete\r\n\t */\r\n\tprivate onComplete() {\r\n\t\tthis.fireEvent('pipeline-complete');\r\n\t}\r\n\r\n\t/**\r\n\t * @description when the pipeline is waiting for user input (via an element.)\r\n\t */\r\n\tprivate onWaiting() {\r\n\t\tthis.fireEvent('pipeline-waiting');\r\n\t}\r\n\r\n\t/**\r\n\t * @description when the pipeline is on its last action\r\n\t */\r\n\tprivate onLastAction() {\r\n\t\tthis.fireEvent('pipeline-last-action');\r\n\t}\r\n\r\n\tpublic render() {\r\n\t\treturn html`${this.renderStatus()}${this.renderDebug()}`;\r\n\t}\r\n\r\n\tprivate renderDebug() {\r\n\t\treturn this.debug\r\n\t\t\t? html`<div><pre>${JSON.stringify(this.state, null, 1)}</pre></div>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\tprivate renderStatus() {\r\n\t\tswitch (this.state?.status) {\r\n\t\t\tcase PipelineStatus.COMPLETED:\r\n\t\t\t\treturn this.renderComplete();\r\n\t\t\tcase PipelineStatus.WAITING:\r\n\t\t\t\treturn this.renderElement(this.state?.elementName);\r\n\t\t\tcase PipelineStatus.RUNNING:\r\n\t\t\t\treturn this.renderSteps();\r\n\t\t\tcase PipelineStatus.FAILED:\r\n\t\t\t\treturn this.renderFail();\r\n\t\t\tcase PipelineStatus.BACKGROUND:\r\n\t\t\t\treturn this.renderBackground();\r\n\t\t\tdefault:\r\n\t\t\t\treturn nothing;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderBackground() {\r\n\t\treturn !this.state?.backgroundState?.backgroundElement\r\n\t\t\t? html`<jumoo-pipeline-background\r\n\t\t\t\t\t.message=${this.message}\r\n\t\t\t\t\t.state=${this.backgroundState ?? this.state}\r\n\t\t\t\t\t.pipelineId=${this._pipelineId}\r\n\t\t\t\t\t.background=${this.state?.backgroundState}\r\n\t\t\t\t\t.options=${this.options}></jumoo-pipeline-background>`\r\n\t\t\t: this.renderElement(this.state?.backgroundState?.backgroundElement);\r\n\t}\r\n\r\n\tprivate renderComplete() {\r\n\t\treturn !this.state?.backgroundState?.completedElement\r\n\t\t\t? !this.state?.currentRequest?.action?.element\r\n\t\t\t\t? html`<div>complete</div>`\r\n\t\t\t\t: this.renderElement(this.state?.currentRequest?.action?.element)\r\n\t\t\t: html`<jumoo-pipeline-background\r\n\t\t\t\t\t.message=${this.message}\r\n\t\t\t\t\t.state=${this.backgroundState ?? this.state}\r\n\t\t\t\t\t.pipelineId=${this._pipelineId}\r\n\t\t\t\t\t.background=${this.state?.backgroundState}\r\n\t\t\t\t\t.options=${this.options}></jumoo-pipeline-background>`;\r\n\t}\r\n\r\n\tprivate renderSteps() {\r\n\t\tif (!this.state?.progress) return nothing;\r\n\t\treturn html`<jumoo-pipeline-progress\r\n\t\t\t.progress=${this.state?.progress}\r\n\t\t\t.message=${this.message}></jumoo-pipeline-progress>`;\r\n\t}\r\n\r\n\tprivate renderElement(element: string | null | undefined) {\r\n\t\treturn !element\r\n\t\t\t? nothing\r\n\t\t\t: html`\r\n\t\t\t\t\t<div class=\"wrapper\">\r\n\t\t\t\t\t\t<umb-extension-slot\r\n\t\t\t\t\t\t\ttype=\"jumoo-process-step\"\r\n\t\t\t\t\t\t\t.filter=${(ext: ManifestProcessStep) => ext.elementName === element}\r\n\t\t\t\t\t\t\t.props=${{\r\n\t\t\t\t\t\t\t\tpipelineId: this._pipelineId,\r\n\t\t\t\t\t\t\t\tstate: this.state,\r\n\t\t\t\t\t\t\t\toptions: this.options,\r\n\t\t\t\t\t\t\t\tresults: this.results,\r\n\t\t\t\t\t\t\t}}></umb-extension-slot>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\t}\r\n\r\n\tprivate renderFail() {\r\n\t\treturn html`\r\n\t\t\t<jumoo-processing-error .error=${this.results?.error}></jumoo-processing-error>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t.wrapper,\r\n\t\tumb-extension-slot {\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default JumooPipelineElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-pipeline': JumooPipelineElement;\r\n\t}\r\n}\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { UmbBooleanState, UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport {\r\n\tPipelineState,\r\n\tPipelineRepository,\r\n\tProcessingMessage,\r\n\tProcessingSignalRContext,\r\n\tProcessingOptions,\r\n\tProcessingResults,\r\n} from '@jumoo/processing';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\n/**\r\n * @description context for keeping pipeline status and progress as we do things.\r\n */\r\nexport class PipelineContext extends UmbControllerBase {\r\n\treadonly #repository: PipelineRepository;\r\n\treadonly #hubContext: ProcessingSignalRContext;\r\n\r\n\t#pipeline = new UmbObjectState<string | undefined>(undefined);\r\n\tpublic readonly pipeline = this.#pipeline.asObservable();\r\n\r\n\t#state = new UmbObjectState<PipelineState | undefined>(undefined);\r\n\tpublic readonly state = this.#state.asObservable();\r\n\r\n\t#options = new UmbObjectState<ProcessingOptions | undefined>(undefined);\r\n\tpublic readonly options = this.#options.asObservable();\r\n\r\n\t#results = new UmbObjectState<ProcessingResults | undefined>(undefined);\r\n\tpublic readonly results = this.#results.asObservable();\r\n\r\n\t#message = new UmbObjectState<ProcessingMessage | undefined>(undefined);\r\n\tpublic readonly message = this.#message.asObservable();\r\n\r\n\t#backgroundState = new UmbObjectState<PipelineState | undefined>(undefined);\r\n\tpublic readonly backgroundState = this.#backgroundState.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#repository = new PipelineRepository(this);\r\n\r\n\t\tthis.provideContext(JUMOO_PROCESSING_CONTEXT, this);\r\n\t\tthis.#hubContext = new ProcessingSignalRContext(this);\r\n\r\n\t\tthis.consumeContext(UMB_AUTH_CONTEXT, async (auth) => {\r\n\t\t\tif (!auth) return;\r\n\t\t\tconst authConfig = auth?.getOpenApiConfiguration();\r\n\t\t\tif (authConfig) {\r\n\t\t\t\tconst token = await auth.getLatestToken();\r\n\t\t\t\tthis.#hubContext.startHub(token, ['message', 'state']);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#hubContext.messagesOf('message'), (message) => {\r\n\t\t\tif (!message?.message) return;\r\n\r\n\t\t\tif (this.isMessage(message.message)) {\r\n\t\t\t\tthis.#message.setValue(message.message);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#hubContext.messagesOf('state'), (state) => {\r\n\t\t\tif (!state?.message) return;\r\n\r\n\t\t\tif (this.isState(state.message)) {\r\n\t\t\t\tthis.#backgroundState.setValue(state.message);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate isMessage(\r\n\t\tmessage: ProcessingMessage | PipelineState,\r\n\t): message is ProcessingMessage {\r\n\t\treturn message !== undefined;\r\n\t}\r\n\r\n\tprivate isState(message: ProcessingMessage | PipelineState): message is PipelineState {\r\n\t\treturn message !== undefined;\r\n\t}\r\n\r\n\tpublic async createPipeline(\r\n\t\tprocessor: string,\r\n\t\tstrategy: string,\r\n\t\toptions: ProcessingOptions | undefined,\r\n\t) {\r\n\t\tconst pipeline = await this.#repository.create(processor, strategy, options);\r\n\t\tthis.#pipeline.setValue(pipeline);\r\n\t}\r\n\r\n\tpublic async loadPipeline(id: string) {\r\n\t\tconst pipeline = await this.#repository.Get(id);\r\n\t\tif (!pipeline) return;\r\n\t\tthis.#pipeline.setValue(pipeline.id);\r\n\t}\r\n\r\n\tpublic async getPipeline(id: string) {\r\n\t\tconst pipeline = await this.#repository.Get(id);\r\n\t\tif (pipeline?.state) this.#state.setValue(pipeline.state);\r\n\r\n\t\tif (pipeline?.options) this.#options.setValue(pipeline.options);\r\n\r\n\t\tif (pipeline?.results) this.#results.setValue(pipeline.results);\r\n\r\n\t\treturn pipeline;\r\n\t}\r\n\r\n\tpublic async fetchPipeline(id: string) {\r\n\t\tconst pipeline = await this.#repository.Get(id);\r\n\t\treturn pipeline;\r\n\t}\r\n\r\n\tpublic async process() {\r\n\t\tif (!this.#pipeline.value) return;\r\n\r\n\t\tconst clientId = this.#hubContext?.getClientId() ?? null;\r\n\t\tconst response = await this.#repository.process(this.#pipeline.value, clientId);\r\n\r\n\t\tif (response?.state) {\r\n\t\t\tthis.#state.setValue(response.state);\r\n\t\t}\r\n\r\n\t\tif (response?.options) {\r\n\t\t\tthis.#options.setValue(response.options);\r\n\t\t}\r\n\r\n\t\tif (response?.results) {\r\n\t\t\tthis.#results.setValue(response.results);\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\tpublic async updateOptions(options: ProcessingOptions) {\r\n\t\tif (!this.#pipeline.value) return;\r\n\t\tconst response = await this.#repository.update(this.#pipeline.value, options);\r\n\r\n\t\tif (response?.options) {\r\n\t\t\tconsole.debug('update: pipeline.options', response);\r\n\t\t\tthis.#options.setValue(response.options);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async setOption(value: Record<string, unknown>) {\r\n\t\tthis.#options.update(value);\r\n\t}\r\n\r\n\tpublic async saveOptions() {\r\n\t\tif (!this.#pipeline.value) return;\r\n\t\tconst response = await this.#repository.update(\r\n\t\t\tthis.#pipeline.value,\r\n\t\t\tthis.#options.value,\r\n\t\t);\r\n\r\n\t\tif (response?.options) {\r\n\t\t\tconsole.debug('save:pipeline.options', response);\r\n\t\t\tthis.#options.setValue(response.options);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async UpdateAndSaveOptions(options: ProcessingOptions) {\r\n\t\tawait this.updateOptions(options);\r\n\t\tawait this.saveOptions();\r\n\t}\r\n\r\n\tpublic async clearPipeline() {\r\n\t\tif (!this.#pipeline.value) return;\r\n\r\n\t\tawait this.#repository.clear(this.#pipeline.value);\r\n\t\tthis.#pipeline.setValue(undefined);\r\n\t\tthis.#state.setValue(undefined);\r\n\t\tthis.#options.setValue(undefined);\r\n\t}\r\n\r\n\tpublic async completePipeline() {\r\n\t\tif (!this.#pipeline.value) return;\r\n\r\n\t\t// this.#repository.clear(this.#pipeline.value);\r\n\t\t// this.#repository.complete(this.#pipeline.value);\r\n\t}\r\n\r\n\tpublic async getResults() {\r\n\t\tif (!this.#pipeline.value) return;\r\n\t\tconst results = await this.#repository.getResults(this.#pipeline.value);\r\n\t\tif (results) this.#results.setValue(results);\r\n\r\n\t\treturn results;\r\n\t}\r\n\r\n\t// if trigger is fired, then the element moves to the next thing.\r\n\t#trigger = new UmbBooleanState(false);\r\n\tpublic readonly trigger = this.#trigger.asObservable();\r\n\r\n\t#close = new UmbBooleanState(false);\r\n\tpublic readonly close = this.#close.asObservable();\r\n\r\n\t#finalized = new UmbBooleanState(false);\r\n\tpublic readonly finalized = this.#finalized.asObservable();\r\n\r\n\t#valid = new UmbBooleanState(true);\r\n\tpublic readonly valid = this.#valid.asObservable();\r\n\r\n\t/**\r\n\t * sets the validity of the state used to turn on next buttons etc.\r\n\t * @param valid is the current state valid\r\n\t */\r\n\tpublic setValid(valid: boolean) {\r\n\t\tthis.#valid.setValue(valid);\r\n\t}\r\n\r\n\t/**\r\n\t * trigger the next action in the pipeline\r\n\t */\r\n\tpublic async triggerNext() {\r\n\t\tconst pending = this.#pending.getValue();\r\n\t\tif (pending) {\r\n\t\t\tawait this.UpdateAndSaveOptions(pending);\r\n\t\t}\r\n\r\n\t\tthis.clearPending();\r\n\r\n\t\tthis.#trigger.setValue(true);\r\n\t}\r\n\r\n\tpublic clearNext() {\r\n\t\tthis.#trigger.setValue(false);\r\n\t}\r\n\r\n\tpublic async triggerClose() {\r\n\t\tif (\r\n\t\t\tthis.#state.value?.progress.isLastAction === true ||\r\n\t\t\tthis.#state.value?.backgroundState?.isBackgroundRequest !== true\r\n\t\t) {\r\n\t\t\tawait this.clearPipeline();\r\n\t\t}\r\n\r\n\t\tthis.#close.setValue(true);\r\n\t}\r\n\r\n\tpublic triggerFinalized() {\r\n\t\tthis.#finalized.setValue(true);\r\n\t}\r\n\r\n\t/**\r\n\t * pending changes, these can be set here, but not updated until\r\n\t * trigger next is fired. that way we can stop the refresh of things.\r\n\t */\r\n\t#pending = new UmbObjectState<ProcessingOptions | undefined>(undefined);\r\n\tpublic readonly pending = this.#pending.asObservable();\r\n\r\n\tpublic async setPending(value: Record<string, unknown>) {\r\n\t\tconst pending = this.#pending.getValue();\r\n\t\tif (!pending) {\r\n\t\t\tthis.primePending();\r\n\t\t}\r\n\r\n\t\tthis.#pending.update(value);\r\n\t}\r\n\r\n\tprivate async clearPending() {\r\n\t\tthis.#pending.setValue(undefined);\r\n\t}\r\n\r\n\tpublic async primePending() {\r\n\t\tthis.#pending.setValue(this.#options.value);\r\n\t}\r\n}\r\n\r\nexport default PipelineContext;\r\n\r\nexport const JUMOO_PROCESSING_CONTEXT = new UmbContextToken<PipelineContext>(\r\n\t'JumooPipelineContext',\r\n);\r\n","import { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { PipelineSource, PipelineStatus, ProcessingOptions } from '@jumoo/processing';\r\n\r\n/**\r\n * @description repository for the pipeline\r\n */\r\nexport class PipelineRepository extends UmbControllerBase {\r\n\tprivate readonly source: PipelineSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.source = new PipelineSource(host);\r\n\t}\r\n\r\n\tpublic async clear(id: string) {\r\n\t\treturn (await this.source.clear(id)).data;\r\n\t}\r\n\r\n\tpublic async process(id: string, clientId: string | null) {\r\n\t\treturn (await this.source.process(id, clientId)).data;\r\n\t}\r\n\r\n\tpublic async update(id: string, body: any) {\r\n\t\treturn (await this.source.update(id, body)).data;\r\n\t}\r\n\r\n\tpublic async getProcessors() {\r\n\t\treturn (await this.source.getProcessors()).data;\r\n\t}\r\n\r\n\tpublic async Get(id: string) {\r\n\t\treturn (await this.source.Get(id)).data;\r\n\t}\r\n\r\n\tpublic async create(\r\n\t\tprocessor: string,\r\n\t\tstrategy: string,\r\n\t\toptions: ProcessingOptions | undefined,\r\n\t) {\r\n\t\treturn (await this.source.create(processor, strategy, options)).data;\r\n\t}\r\n\r\n\tpublic async complete(id: string) {\r\n\t\tconsole.debug('complete', id);\r\n\t}\r\n\r\n\tpublic async getResults(id: string) {\r\n\t\treturn (await this.source.getResults(id)).data;\r\n\t}\r\n\r\n\tpublic async listPipelines(status: PipelineStatus) {\r\n\t\treturn (await this.source.listPiplelines(status)).data;\r\n\t}\r\n}\r\n","import { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { PipelinesService, PipelineStatus } from '@jumoo/processing';\r\n\r\nexport class PipelineSource {\r\n\tprivate readonly host: UmbControllerHost;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.host = host;\r\n\t}\r\n\r\n\tasync process(id: string, clientId: string | null) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.processPipeline({\r\n\t\t\t\tpath: { id: id },\r\n\t\t\t\tquery: { clientId: clientId ?? undefined },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tasync update(id: string, body: any) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.updatePipeline({\r\n\t\t\t\tpath: { id: id },\r\n\t\t\t\tbody: body,\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tasync getProcessors() {\r\n\t\treturn await tryExecute(this.host, PipelinesService.getProcessors());\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param id guid id of the pipeline to retrieve\r\n\t * @returns pipeline\r\n\t */\r\n\tasync Get(id: string) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.getPipeline({ path: { id: id } }),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param strategy alias of the strategy to use for the pipeline\r\n\t * @returns\r\n\t */\r\n\tasync create(processor: string, strategy: string, options: any) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.createPipeline({\r\n\t\t\t\tbody: {\r\n\t\t\t\t\talias: processor,\r\n\t\t\t\t\tstrategy: strategy,\r\n\t\t\t\t\toptions: options,\r\n\t\t\t\t\tclientId: null,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param id guid id of the pipeline to remove\r\n\t * @returns nothing.\r\n\t */\r\n\tasync clear(id: string) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.clearPipeline({ path: { id: id } }),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * @param id guid id of the pipeline to retrieve results for\r\n\t * @returns results (if there are any) for the pipeline\r\n\t */\r\n\tasync getResults(id: string) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.getResults({\r\n\t\t\t\tpath: { id: id },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tasync listPiplelines(status: PipelineStatus) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.host,\r\n\t\t\tPipelinesService.listPipelines({ path: { status: status } }),\r\n\t\t);\r\n\t}\r\n}\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { PipelineRepository } from './pipeline.repository';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { PipelineStatus } from '../api';\r\n\r\nexport class PipelinesContext extends UmbControllerBase {\r\n\treadonly #repository: PipelineRepository;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#repository = new PipelineRepository(host);\r\n\r\n\t\tthis.provideContext(JUMOO_PIPELINES_CONTEXT, this);\r\n\t}\r\n\r\n\tpublic async listPipelines(status: PipelineStatus) {\r\n\t\tconst pipelines = await this.#repository.listPipelines(status);\r\n\t\treturn pipelines;\r\n\t}\r\n\r\n\tpublic async clear(id: string) {\r\n\t\treturn await this.#repository.clear(id);\r\n\t}\r\n}\r\n\r\nexport default PipelinesContext;\r\n\r\nexport const JUMOO_PIPELINES_CONTEXT = new UmbContextToken<PipelinesContext>(\r\n\t'JUMOO_PIPELINES_CONTEXT',\r\n);\r\n","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** Error thrown when an HTTP request fails. */\r\nexport class HttpError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    constructor(errorMessage, statusCode) {\r\n        const trueProto = new.target.prototype;\r\n        super(`${errorMessage}: Status code '${statusCode}'`);\r\n        this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when a timeout elapses. */\r\nexport class TimeoutError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    constructor(errorMessage = \"A timeout occurred.\") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when an action is aborted. */\r\nexport class AbortError extends Error {\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    constructor(errorMessage = \"An abort occurred.\") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the selected transport is unsupported by the browser. */\r\n/** @private */\r\nexport class UnsupportedTransportError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.UnsupportedTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message, transport) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'UnsupportedTransportError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the selected transport is disabled by the browser. */\r\n/** @private */\r\nexport class DisabledTransportError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.DisabledTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message, transport) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'DisabledTransportError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the selected transport cannot be started. */\r\n/** @private */\r\nexport class FailedToStartTransportError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.FailedToStartTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message, transport) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'FailedToStartTransportError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the negotiation with the server failed to complete. */\r\n/** @private */\r\nexport class FailedToNegotiateWithServerError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.FailedToNegotiateWithServerError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     */\r\n    constructor(message) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.errorType = 'FailedToNegotiateWithServerError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when multiple errors have occurred. */\r\n/** @private */\r\nexport class AggregateErrors extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.AggregateErrors}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {Error[]} innerErrors The collection of errors this error is aggregating.\r\n     */\r\n    constructor(message, innerErrors) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.innerErrors = innerErrors;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n//# sourceMappingURL=Errors.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** Represents an HTTP response. */\r\nexport class HttpResponse {\r\n    constructor(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n}\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nexport class HttpClient {\r\n    get(url, options) {\r\n        return this.send({\r\n            ...options,\r\n            method: \"GET\",\r\n            url,\r\n        });\r\n    }\r\n    post(url, options) {\r\n        return this.send({\r\n            ...options,\r\n            method: \"POST\",\r\n            url,\r\n        });\r\n    }\r\n    delete(url, options) {\r\n        return this.send({\r\n            ...options,\r\n            method: \"DELETE\",\r\n            url,\r\n        });\r\n    }\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    getCookieString(url) {\r\n        return \"\";\r\n    }\r\n}\r\n//# sourceMappingURL=HttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport var LogLevel;\r\n(function (LogLevel) {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\r\n    /** Log level for low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\r\n    /** Log level for informational diagnostic messages. */\r\n    LogLevel[LogLevel[\"Information\"] = 2] = \"Information\";\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    LogLevel[LogLevel[\"Warning\"] = 3] = \"Warning\";\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    LogLevel[LogLevel[\"Error\"] = 4] = \"Error\";\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    LogLevel[LogLevel[\"Critical\"] = 5] = \"Critical\";\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    LogLevel[LogLevel[\"None\"] = 6] = \"None\";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** A logger that does nothing when log messages are sent to it. */\r\nexport class NullLogger {\r\n    constructor() { }\r\n    /** @inheritDoc */\r\n    // eslint-disable-next-line\r\n    log(_logLevel, _message) {\r\n    }\r\n}\r\n/** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\nNullLogger.instance = new NullLogger();\r\n//# sourceMappingURL=Loggers.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\nexport const VERSION = \"8.0.7\";\r\n/** @private */\r\nexport class Arg {\r\n    static isRequired(val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(`The '${name}' argument is required.`);\r\n        }\r\n    }\r\n    static isNotEmpty(val, name) {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(`The '${name}' argument should not be empty.`);\r\n        }\r\n    }\r\n    static isIn(val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(`Unknown ${name} value: ${val}.`);\r\n        }\r\n    }\r\n}\r\n/** @private */\r\nexport class Platform {\r\n    // react-native has a window but no document so we should check both\r\n    static get isBrowser() {\r\n        return !Platform.isNode && typeof window === \"object\" && typeof window.document === \"object\";\r\n    }\r\n    // WebWorkers don't have a window object so the isBrowser check would fail\r\n    static get isWebWorker() {\r\n        return !Platform.isNode && typeof self === \"object\" && \"importScripts\" in self;\r\n    }\r\n    // react-native has a window but no document\r\n    static get isReactNative() {\r\n        return !Platform.isNode && typeof window === \"object\" && typeof window.document === \"undefined\";\r\n    }\r\n    // Node apps shouldn't have a window object, but WebWorkers don't either\r\n    // so we need to check for both WebWorker and window\r\n    static get isNode() {\r\n        return typeof process !== \"undefined\" && process.release && process.release.name === \"node\";\r\n    }\r\n}\r\n/** @private */\r\nexport function getDataDetail(data, includeContent) {\r\n    let detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = `Binary data of length ${data.byteLength}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${formatArrayBuffer(data)}'`;\r\n        }\r\n    }\r\n    else if (typeof data === \"string\") {\r\n        detail = `String data of length ${data.length}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${data}'`;\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n/** @private */\r\nexport function formatArrayBuffer(data) {\r\n    const view = new Uint8Array(data);\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    let str = \"\";\r\n    view.forEach((num) => {\r\n        const pad = num < 16 ? \"0\" : \"\";\r\n        str += `0x${pad}${num.toString(16)} `;\r\n    });\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val) {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n/** @private */\r\nexport async function sendMessage(logger, transportName, httpClient, url, content, options) {\r\n    const headers = {};\r\n    const [name, value] = getUserAgentHeader();\r\n    headers[name] = value;\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) sending data. ${getDataDetail(content, options.logMessageContent)}.`);\r\n    const responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n    const response = await httpClient.post(url, {\r\n        content,\r\n        headers: { ...headers, ...options.headers },\r\n        responseType,\r\n        timeout: options.timeout,\r\n        withCredentials: options.withCredentials,\r\n    });\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) request complete. Response status: ${response.statusCode}.`);\r\n}\r\n/** @private */\r\nexport function createLogger(logger) {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n    if (logger.log !== undefined) {\r\n        return logger;\r\n    }\r\n    return new ConsoleLogger(logger);\r\n}\r\n/** @private */\r\nexport class SubjectSubscription {\r\n    constructor(subject, observer) {\r\n        this._subject = subject;\r\n        this._observer = observer;\r\n    }\r\n    dispose() {\r\n        const index = this._subject.observers.indexOf(this._observer);\r\n        if (index > -1) {\r\n            this._subject.observers.splice(index, 1);\r\n        }\r\n        if (this._subject.observers.length === 0 && this._subject.cancelCallback) {\r\n            this._subject.cancelCallback().catch((_) => { });\r\n        }\r\n    }\r\n}\r\n/** @private */\r\nexport class ConsoleLogger {\r\n    constructor(minimumLogLevel) {\r\n        this._minLevel = minimumLogLevel;\r\n        this.out = console;\r\n    }\r\n    log(logLevel, message) {\r\n        if (logLevel >= this._minLevel) {\r\n            const msg = `[${new Date().toISOString()}] ${LogLevel[logLevel]}: ${message}`;\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.out.error(msg);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.out.warn(msg);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.out.info(msg);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.out.log(msg);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n/** @private */\r\nexport function getUserAgentHeader() {\r\n    let userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\r\n}\r\n/** @private */\r\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    let userAgent = \"Microsoft SignalR/\";\r\n    const majorAndMinor = version.split(\".\");\r\n    userAgent += `${majorAndMinor[0]}.${majorAndMinor[1]}`;\r\n    userAgent += ` (${version}; `;\r\n    if (os && os !== \"\") {\r\n        userAgent += `${os}; `;\r\n    }\r\n    else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n    userAgent += `${runtime}`;\r\n    if (runtimeVersion) {\r\n        userAgent += `; ${runtimeVersion}`;\r\n    }\r\n    else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getOsName() {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getRuntimeVersion() {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\nfunction getRuntime() {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    }\r\n    else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n/** @private */\r\nexport function getErrorString(e) {\r\n    if (e.stack) {\r\n        return e.stack;\r\n    }\r\n    else if (e.message) {\r\n        return e.message;\r\n    }\r\n    return `${e}`;\r\n}\r\n/** @private */\r\nexport function getGlobalThis() {\r\n    // globalThis is semi-new and not available in Node until v12\r\n    if (typeof globalThis !== \"undefined\") {\r\n        return globalThis;\r\n    }\r\n    if (typeof self !== \"undefined\") {\r\n        return self;\r\n    }\r\n    if (typeof window !== \"undefined\") {\r\n        return window;\r\n    }\r\n    if (typeof global !== \"undefined\") {\r\n        return global;\r\n    }\r\n    throw new Error(\"could not find global\");\r\n}\r\n//# sourceMappingURL=Utils.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Platform, getGlobalThis, isArrayBuffer } from \"./Utils\";\r\nexport class FetchHttpClient extends HttpClient {\r\n    constructor(logger) {\r\n        super();\r\n        this._logger = logger;\r\n        // Node added a fetch implementation to the global scope starting in v18.\r\n        // We need to add a cookie jar in node to be able to share cookies with WebSocket\r\n        if (typeof fetch === \"undefined\" || Platform.isNode) {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            this._jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n            if (typeof fetch === \"undefined\") {\r\n                this._fetchType = requireFunc(\"node-fetch\");\r\n            }\r\n            else {\r\n                // Use fetch from Node if available\r\n                this._fetchType = fetch;\r\n            }\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            this._fetchType = requireFunc(\"fetch-cookie\")(this._fetchType, this._jar);\r\n        }\r\n        else {\r\n            this._fetchType = fetch.bind(getGlobalThis());\r\n        }\r\n        if (typeof AbortController === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            this._abortControllerType = requireFunc(\"abort-controller\");\r\n        }\r\n        else {\r\n            this._abortControllerType = AbortController;\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    async send(request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            throw new AbortError();\r\n        }\r\n        if (!request.method) {\r\n            throw new Error(\"No method defined.\");\r\n        }\r\n        if (!request.url) {\r\n            throw new Error(\"No url defined.\");\r\n        }\r\n        const abortController = new this._abortControllerType();\r\n        let error;\r\n        // Hook our abortSignal into the abort controller\r\n        if (request.abortSignal) {\r\n            request.abortSignal.onabort = () => {\r\n                abortController.abort();\r\n                error = new AbortError();\r\n            };\r\n        }\r\n        // If a timeout has been passed in, setup a timeout to call abort\r\n        // Type needs to be any to fit window.setTimeout and NodeJS.setTimeout\r\n        let timeoutId = null;\r\n        if (request.timeout) {\r\n            const msTimeout = request.timeout;\r\n            timeoutId = setTimeout(() => {\r\n                abortController.abort();\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                error = new TimeoutError();\r\n            }, msTimeout);\r\n        }\r\n        if (request.content === \"\") {\r\n            request.content = undefined;\r\n        }\r\n        if (request.content) {\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            request.headers = request.headers || {};\r\n            if (isArrayBuffer(request.content)) {\r\n                request.headers[\"Content-Type\"] = \"application/octet-stream\";\r\n            }\r\n            else {\r\n                request.headers[\"Content-Type\"] = \"text/plain;charset=UTF-8\";\r\n            }\r\n        }\r\n        let response;\r\n        try {\r\n            response = await this._fetchType(request.url, {\r\n                body: request.content,\r\n                cache: \"no-cache\",\r\n                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                headers: {\r\n                    \"X-Requested-With\": \"XMLHttpRequest\",\r\n                    ...request.headers,\r\n                },\r\n                method: request.method,\r\n                mode: \"cors\",\r\n                redirect: \"follow\",\r\n                signal: abortController.signal,\r\n            });\r\n        }\r\n        catch (e) {\r\n            if (error) {\r\n                throw error;\r\n            }\r\n            this._logger.log(LogLevel.Warning, `Error from HTTP request. ${e}.`);\r\n            throw e;\r\n        }\r\n        finally {\r\n            if (timeoutId) {\r\n                clearTimeout(timeoutId);\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = null;\r\n            }\r\n        }\r\n        if (!response.ok) {\r\n            const errorMessage = await deserializeContent(response, \"text\");\r\n            throw new HttpError(errorMessage || response.statusText, response.status);\r\n        }\r\n        const content = deserializeContent(response, request.responseType);\r\n        const payload = await content;\r\n        return new HttpResponse(response.status, response.statusText, payload);\r\n    }\r\n    getCookieString(url) {\r\n        let cookies = \"\";\r\n        if (Platform.isNode && this._jar) {\r\n            // @ts-ignore: unused variable\r\n            this._jar.getCookies(url, (e, c) => cookies = c.join(\"; \"));\r\n        }\r\n        return cookies;\r\n    }\r\n}\r\nfunction deserializeContent(response, responseType) {\r\n    let content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(`${responseType} is not supported.`);\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n    return content;\r\n}\r\n//# sourceMappingURL=FetchHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\nexport class XhrHttpClient extends HttpClient {\r\n    constructor(logger) {\r\n        super();\r\n        this._logger = logger;\r\n    }\r\n    /** @inheritDoc */\r\n    send(request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            if (request.content === \"\") {\r\n                request.content = undefined;\r\n            }\r\n            if (request.content) {\r\n                // Explicitly setting the Content-Type header for React Native on Android platform.\r\n                if (isArrayBuffer(request.content)) {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\r\n                }\r\n                else {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n                }\r\n            }\r\n            const headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach((header) => {\r\n                    xhr.setRequestHeader(header, headers[header]);\r\n                });\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = () => {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = () => {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new HttpError(xhr.response || xhr.responseText || xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = () => {\r\n                this._logger.log(LogLevel.Warning, `Error from HTTP request. ${xhr.status}: ${xhr.statusText}.`);\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = () => {\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                reject(new TimeoutError());\r\n            };\r\n            xhr.send(request.content);\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=XhrHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nexport class DefaultHttpClient extends HttpClient {\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    constructor(logger) {\r\n        super();\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            this._httpClient = new FetchHttpClient(logger);\r\n        }\r\n        else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            this._httpClient = new XhrHttpClient(logger);\r\n        }\r\n        else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    send(request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return this._httpClient.send(request);\r\n    }\r\n    getCookieString(url) {\r\n        return this._httpClient.getCookieString(url);\r\n    }\r\n}\r\n//# sourceMappingURL=DefaultHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// Not exported from index\r\n/** @private */\r\nexport class TextMessageFormat {\r\n    static write(output) {\r\n        return `${output}${TextMessageFormat.RecordSeparator}`;\r\n    }\r\n    static parse(input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n        const messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    }\r\n}\r\nTextMessageFormat.RecordSeparatorCode = 0x1e;\r\nTextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n//# sourceMappingURL=TextMessageFormat.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nexport class HandshakeProtocol {\r\n    // Handshake request is always JSON\r\n    writeHandshakeRequest(handshakeRequest) {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    }\r\n    parseHandshakeResponse(data) {\r\n        let messageData;\r\n        let remainingData;\r\n        if (isArrayBuffer(data)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            const binaryData = new Uint8Array(data);\r\n            const separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, Array.prototype.slice.call(binaryData.slice(0, responseLength)));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        }\r\n        else {\r\n            const textData = data;\r\n            const separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n        // At this point we should have just the single handshake message\r\n        const messages = TextMessageFormat.parse(messageData);\r\n        const response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        const responseMessage = response;\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    }\r\n}\r\n//# sourceMappingURL=HandshakeProtocol.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** Defines the type of a Hub Message. */\r\nexport var MessageType;\r\n(function (MessageType) {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    MessageType[MessageType[\"Invocation\"] = 1] = \"Invocation\";\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    MessageType[MessageType[\"StreamItem\"] = 2] = \"StreamItem\";\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    MessageType[MessageType[\"Completion\"] = 3] = \"Completion\";\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    MessageType[MessageType[\"StreamInvocation\"] = 4] = \"StreamInvocation\";\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    MessageType[MessageType[\"CancelInvocation\"] = 5] = \"CancelInvocation\";\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    MessageType[MessageType[\"Ping\"] = 6] = \"Ping\";\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    MessageType[MessageType[\"Close\"] = 7] = \"Close\";\r\n    MessageType[MessageType[\"Ack\"] = 8] = \"Ack\";\r\n    MessageType[MessageType[\"Sequence\"] = 9] = \"Sequence\";\r\n})(MessageType || (MessageType = {}));\r\n//# sourceMappingURL=IHubProtocol.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { SubjectSubscription } from \"./Utils\";\r\n/** Stream implementation to stream items to the server. */\r\nexport class Subject {\r\n    constructor() {\r\n        this.observers = [];\r\n    }\r\n    next(item) {\r\n        for (const observer of this.observers) {\r\n            observer.next(item);\r\n        }\r\n    }\r\n    error(err) {\r\n        for (const observer of this.observers) {\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    }\r\n    complete() {\r\n        for (const observer of this.observers) {\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    }\r\n    subscribe(observer) {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    }\r\n}\r\n//# sourceMappingURL=Subject.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nexport class MessageBuffer {\r\n    constructor(protocol, connection, bufferSize) {\r\n        this._bufferSize = 100000;\r\n        this._messages = [];\r\n        this._totalMessageCount = 0;\r\n        this._waitForSequenceMessage = false;\r\n        // Message IDs start at 1 and always increment by 1\r\n        this._nextReceivingSequenceId = 1;\r\n        this._latestReceivedSequenceId = 0;\r\n        this._bufferedByteCount = 0;\r\n        this._reconnectInProgress = false;\r\n        this._protocol = protocol;\r\n        this._connection = connection;\r\n        this._bufferSize = bufferSize;\r\n    }\r\n    async _send(message) {\r\n        const serializedMessage = this._protocol.writeMessage(message);\r\n        let backpressurePromise = Promise.resolve();\r\n        // Only count invocation messages. Acks, pings, etc. don't need to be resent on reconnect\r\n        if (this._isInvocationMessage(message)) {\r\n            this._totalMessageCount++;\r\n            let backpressurePromiseResolver = () => { };\r\n            let backpressurePromiseRejector = () => { };\r\n            if (isArrayBuffer(serializedMessage)) {\r\n                this._bufferedByteCount += serializedMessage.byteLength;\r\n            }\r\n            else {\r\n                this._bufferedByteCount += serializedMessage.length;\r\n            }\r\n            if (this._bufferedByteCount >= this._bufferSize) {\r\n                backpressurePromise = new Promise((resolve, reject) => {\r\n                    backpressurePromiseResolver = resolve;\r\n                    backpressurePromiseRejector = reject;\r\n                });\r\n            }\r\n            this._messages.push(new BufferedItem(serializedMessage, this._totalMessageCount, backpressurePromiseResolver, backpressurePromiseRejector));\r\n        }\r\n        try {\r\n            // If this is set it means we are reconnecting or resending\r\n            // We don't want to send on a disconnected connection\r\n            // And we don't want to send if resend is running since that would mean sending\r\n            // this message twice\r\n            if (!this._reconnectInProgress) {\r\n                await this._connection.send(serializedMessage);\r\n            }\r\n        }\r\n        catch {\r\n            this._disconnected();\r\n        }\r\n        await backpressurePromise;\r\n    }\r\n    _ack(ackMessage) {\r\n        let newestAckedMessage = -1;\r\n        // Find index of newest message being acked\r\n        for (let index = 0; index < this._messages.length; index++) {\r\n            const element = this._messages[index];\r\n            if (element._id <= ackMessage.sequenceId) {\r\n                newestAckedMessage = index;\r\n                if (isArrayBuffer(element._message)) {\r\n                    this._bufferedByteCount -= element._message.byteLength;\r\n                }\r\n                else {\r\n                    this._bufferedByteCount -= element._message.length;\r\n                }\r\n                // resolve items that have already been sent and acked\r\n                element._resolver();\r\n            }\r\n            else if (this._bufferedByteCount < this._bufferSize) {\r\n                // resolve items that now fall under the buffer limit but haven't been acked\r\n                element._resolver();\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        if (newestAckedMessage !== -1) {\r\n            // We're removing everything including the message pointed to, so add 1\r\n            this._messages = this._messages.slice(newestAckedMessage + 1);\r\n        }\r\n    }\r\n    _shouldProcessMessage(message) {\r\n        if (this._waitForSequenceMessage) {\r\n            if (message.type !== MessageType.Sequence) {\r\n                return false;\r\n            }\r\n            else {\r\n                this._waitForSequenceMessage = false;\r\n                return true;\r\n            }\r\n        }\r\n        // No special processing for acks, pings, etc.\r\n        if (!this._isInvocationMessage(message)) {\r\n            return true;\r\n        }\r\n        const currentId = this._nextReceivingSequenceId;\r\n        this._nextReceivingSequenceId++;\r\n        if (currentId <= this._latestReceivedSequenceId) {\r\n            if (currentId === this._latestReceivedSequenceId) {\r\n                // Should only hit this if we just reconnected and the server is sending\r\n                // Messages it has buffered, which would mean it hasn't seen an Ack for these messages\r\n                this._ackTimer();\r\n            }\r\n            // Ignore, this is a duplicate message\r\n            return false;\r\n        }\r\n        this._latestReceivedSequenceId = currentId;\r\n        // Only start the timer for sending an Ack message when we have a message to ack. This also conveniently solves\r\n        // timer throttling by not having a recursive timer, and by starting the timer via a network call (recv)\r\n        this._ackTimer();\r\n        return true;\r\n    }\r\n    _resetSequence(message) {\r\n        if (message.sequenceId > this._nextReceivingSequenceId) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._connection.stop(new Error(\"Sequence ID greater than amount of messages we've received.\"));\r\n            return;\r\n        }\r\n        this._nextReceivingSequenceId = message.sequenceId;\r\n    }\r\n    _disconnected() {\r\n        this._reconnectInProgress = true;\r\n        this._waitForSequenceMessage = true;\r\n    }\r\n    async _resend() {\r\n        const sequenceId = this._messages.length !== 0\r\n            ? this._messages[0]._id\r\n            : this._totalMessageCount + 1;\r\n        await this._connection.send(this._protocol.writeMessage({ type: MessageType.Sequence, sequenceId }));\r\n        // Get a local variable to the _messages, just in case messages are acked while resending\r\n        // Which would slice the _messages array (which creates a new copy)\r\n        const messages = this._messages;\r\n        for (const element of messages) {\r\n            await this._connection.send(element._message);\r\n        }\r\n        this._reconnectInProgress = false;\r\n    }\r\n    _dispose(error) {\r\n        error !== null && error !== void 0 ? error : (error = new Error(\"Unable to reconnect to server.\"));\r\n        // Unblock backpressure if any\r\n        for (const element of this._messages) {\r\n            element._rejector(error);\r\n        }\r\n    }\r\n    _isInvocationMessage(message) {\r\n        // There is no way to check if something implements an interface.\r\n        // So we individually check the messages in a switch statement.\r\n        // To make sure we don't miss any message types we rely on the compiler\r\n        // seeing the function returns a value and it will do the\r\n        // exhaustive check for us on the switch statement, since we don't use 'case default'\r\n        switch (message.type) {\r\n            case MessageType.Invocation:\r\n            case MessageType.StreamItem:\r\n            case MessageType.Completion:\r\n            case MessageType.StreamInvocation:\r\n            case MessageType.CancelInvocation:\r\n                return true;\r\n            case MessageType.Close:\r\n            case MessageType.Sequence:\r\n            case MessageType.Ping:\r\n            case MessageType.Ack:\r\n                return false;\r\n        }\r\n    }\r\n    _ackTimer() {\r\n        if (this._ackTimerHandle === undefined) {\r\n            this._ackTimerHandle = setTimeout(async () => {\r\n                try {\r\n                    if (!this._reconnectInProgress) {\r\n                        await this._connection.send(this._protocol.writeMessage({ type: MessageType.Ack, sequenceId: this._latestReceivedSequenceId }));\r\n                    }\r\n                    // Ignore errors, that means the connection is closed and we don't care about the Ack message anymore.\r\n                }\r\n                catch { }\r\n                clearTimeout(this._ackTimerHandle);\r\n                this._ackTimerHandle = undefined;\r\n                // 1 second delay so we don't spam Ack messages if there are many messages being received at once.\r\n            }, 1000);\r\n        }\r\n    }\r\n}\r\nclass BufferedItem {\r\n    constructor(message, id, resolver, rejector) {\r\n        this._message = message;\r\n        this._id = id;\r\n        this._resolver = resolver;\r\n        this._rejector = rejector;\r\n    }\r\n}\r\n//# sourceMappingURL=MessageBuffer.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { HandshakeProtocol } from \"./HandshakeProtocol\";\r\nimport { AbortError } from \"./Errors\";\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg, getErrorString, Platform } from \"./Utils\";\r\nimport { MessageBuffer } from \"./MessageBuffer\";\r\nconst DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nconst DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;\r\nconst DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE = 100000;\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport var HubConnectionState;\r\n(function (HubConnectionState) {\r\n    /** The hub connection is disconnected. */\r\n    HubConnectionState[\"Disconnected\"] = \"Disconnected\";\r\n    /** The hub connection is connecting. */\r\n    HubConnectionState[\"Connecting\"] = \"Connecting\";\r\n    /** The hub connection is connected. */\r\n    HubConnectionState[\"Connected\"] = \"Connected\";\r\n    /** The hub connection is disconnecting. */\r\n    HubConnectionState[\"Disconnecting\"] = \"Disconnecting\";\r\n    /** The hub connection is reconnecting. */\r\n    HubConnectionState[\"Reconnecting\"] = \"Reconnecting\";\r\n})(HubConnectionState || (HubConnectionState = {}));\r\n/** Represents a connection to a SignalR Hub. */\r\nexport class HubConnection {\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    static create(connection, logger, protocol, reconnectPolicy, serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize) {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy, serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize);\r\n    }\r\n    constructor(connection, logger, protocol, reconnectPolicy, serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize) {\r\n        this._nextKeepAlive = 0;\r\n        this._freezeEventListener = () => {\r\n            this._logger.log(LogLevel.Warning, \"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep\");\r\n        };\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.serverTimeoutInMilliseconds = serverTimeoutInMilliseconds !== null && serverTimeoutInMilliseconds !== void 0 ? serverTimeoutInMilliseconds : DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = keepAliveIntervalInMilliseconds !== null && keepAliveIntervalInMilliseconds !== void 0 ? keepAliveIntervalInMilliseconds : DEFAULT_PING_INTERVAL_IN_MS;\r\n        this._statefulReconnectBufferSize = statefulReconnectBufferSize !== null && statefulReconnectBufferSize !== void 0 ? statefulReconnectBufferSize : DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE;\r\n        this._logger = logger;\r\n        this._protocol = protocol;\r\n        this.connection = connection;\r\n        this._reconnectPolicy = reconnectPolicy;\r\n        this._handshakeProtocol = new HandshakeProtocol();\r\n        this.connection.onreceive = (data) => this._processIncomingData(data);\r\n        this.connection.onclose = (error) => this._connectionClosed(error);\r\n        this._callbacks = {};\r\n        this._methods = {};\r\n        this._closedCallbacks = [];\r\n        this._reconnectingCallbacks = [];\r\n        this._reconnectedCallbacks = [];\r\n        this._invocationId = 0;\r\n        this._receivedHandshakeResponse = false;\r\n        this._connectionState = HubConnectionState.Disconnected;\r\n        this._connectionStarted = false;\r\n        this._cachedPingMessage = this._protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n    /** Indicates the state of the {@link HubConnection} to the server. */\r\n    get state() {\r\n        return this._connectionState;\r\n    }\r\n    /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n     *  in the disconnected state or if the negotiation step was skipped.\r\n     */\r\n    get connectionId() {\r\n        return this.connection ? (this.connection.connectionId || null) : null;\r\n    }\r\n    /** Indicates the url of the {@link HubConnection} to the server. */\r\n    get baseUrl() {\r\n        return this.connection.baseUrl || \"\";\r\n    }\r\n    /**\r\n     * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n     * Reconnecting states.\r\n     * @param {string} url The url to connect to.\r\n     */\r\n    set baseUrl(url) {\r\n        if (this._connectionState !== HubConnectionState.Disconnected && this._connectionState !== HubConnectionState.Reconnecting) {\r\n            throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n        }\r\n        if (!url) {\r\n            throw new Error(\"The HubConnection url must be a valid url.\");\r\n        }\r\n        this.connection.baseUrl = url;\r\n    }\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    start() {\r\n        this._startPromise = this._startWithStateTransitions();\r\n        return this._startPromise;\r\n    }\r\n    async _startWithStateTransitions() {\r\n        if (this._connectionState !== HubConnectionState.Disconnected) {\r\n            return Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"));\r\n        }\r\n        this._connectionState = HubConnectionState.Connecting;\r\n        this._logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n        try {\r\n            await this._startInternal();\r\n            if (Platform.isBrowser) {\r\n                // Log when the browser freezes the tab so users know why their connection unexpectedly stopped working\r\n                window.document.addEventListener(\"freeze\", this._freezeEventListener);\r\n            }\r\n            this._connectionState = HubConnectionState.Connected;\r\n            this._connectionStarted = true;\r\n            this._logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n        }\r\n        catch (e) {\r\n            this._connectionState = HubConnectionState.Disconnected;\r\n            this._logger.log(LogLevel.Debug, `HubConnection failed to start successfully because of error '${e}'.`);\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    async _startInternal() {\r\n        this._stopDuringStartError = undefined;\r\n        this._receivedHandshakeResponse = false;\r\n        // Set up the promise before any connection is (re)started otherwise it could race with received messages\r\n        const handshakePromise = new Promise((resolve, reject) => {\r\n            this._handshakeResolver = resolve;\r\n            this._handshakeRejecter = reject;\r\n        });\r\n        await this.connection.start(this._protocol.transferFormat);\r\n        try {\r\n            let version = this._protocol.version;\r\n            if (!this.connection.features.reconnect) {\r\n                // Stateful Reconnect starts with HubProtocol version 2, newer clients connecting to older servers will fail to connect due to\r\n                // the handshake only supporting version 1, so we will try to send version 1 during the handshake to keep old servers working.\r\n                version = 1;\r\n            }\r\n            const handshakeRequest = {\r\n                protocol: this._protocol.name,\r\n                version,\r\n            };\r\n            this._logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n            await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(handshakeRequest));\r\n            this._logger.log(LogLevel.Information, `Using HubProtocol '${this._protocol.name}'.`);\r\n            // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n            this._cleanupTimeout();\r\n            this._resetTimeoutPeriod();\r\n            this._resetKeepAliveInterval();\r\n            await handshakePromise;\r\n            // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n            // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n            // and the connection was closed.\r\n            if (this._stopDuringStartError) {\r\n                // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                // will cause the calling continuation to get scheduled to run later.\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw this._stopDuringStartError;\r\n            }\r\n            const useStatefulReconnect = this.connection.features.reconnect || false;\r\n            if (useStatefulReconnect) {\r\n                this._messageBuffer = new MessageBuffer(this._protocol, this.connection, this._statefulReconnectBufferSize);\r\n                this.connection.features.disconnected = this._messageBuffer._disconnected.bind(this._messageBuffer);\r\n                this.connection.features.resend = () => {\r\n                    if (this._messageBuffer) {\r\n                        return this._messageBuffer._resend();\r\n                    }\r\n                };\r\n            }\r\n            if (!this.connection.features.inherentKeepAlive) {\r\n                await this._sendMessage(this._cachedPingMessage);\r\n            }\r\n        }\r\n        catch (e) {\r\n            this._logger.log(LogLevel.Debug, `Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`);\r\n            this._cleanupTimeout();\r\n            this._cleanupPingTimer();\r\n            // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n            // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n            await this.connection.stop(e);\r\n            throw e;\r\n        }\r\n    }\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    async stop() {\r\n        // Capture the start promise before the connection might be restarted in an onclose callback.\r\n        const startPromise = this._startPromise;\r\n        this.connection.features.reconnect = false;\r\n        this._stopPromise = this._stopInternal();\r\n        await this._stopPromise;\r\n        try {\r\n            // Awaiting undefined continues immediately\r\n            await startPromise;\r\n        }\r\n        catch (e) {\r\n            // This exception is returned to the user as a rejected Promise from the start method.\r\n        }\r\n    }\r\n    _stopInternal(error) {\r\n        if (this._connectionState === HubConnectionState.Disconnected) {\r\n            this._logger.log(LogLevel.Debug, `Call to HubConnection.stop(${error}) ignored because it is already in the disconnected state.`);\r\n            return Promise.resolve();\r\n        }\r\n        if (this._connectionState === HubConnectionState.Disconnecting) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`);\r\n            return this._stopPromise;\r\n        }\r\n        const state = this._connectionState;\r\n        this._connectionState = HubConnectionState.Disconnecting;\r\n        this._logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n        if (this._reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this._logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n            clearTimeout(this._reconnectDelayHandle);\r\n            this._reconnectDelayHandle = undefined;\r\n            this._completeClose();\r\n            return Promise.resolve();\r\n        }\r\n        if (state === HubConnectionState.Connected) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._sendCloseMessage();\r\n        }\r\n        this._cleanupTimeout();\r\n        this._cleanupPingTimer();\r\n        this._stopDuringStartError = error || new AbortError(\"The connection was stopped before the hub handshake could complete.\");\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    }\r\n    async _sendCloseMessage() {\r\n        try {\r\n            await this._sendWithProtocol(this._createCloseMessage());\r\n        }\r\n        catch {\r\n            // Ignore, this is a best effort attempt to let the server know the client closed gracefully.\r\n        }\r\n    }\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    stream(methodName, ...args) {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const invocationDescriptor = this._createStreamInvocation(methodName, args, streamIds);\r\n        // eslint-disable-next-line prefer-const\r\n        let promiseQueue;\r\n        const subject = new Subject();\r\n        subject.cancelCallback = () => {\r\n            const cancelInvocation = this._createCancelInvocation(invocationDescriptor.invocationId);\r\n            delete this._callbacks[invocationDescriptor.invocationId];\r\n            return promiseQueue.then(() => {\r\n                return this._sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n        this._callbacks[invocationDescriptor.invocationId] = (invocationEvent, error) => {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    }\r\n                    else {\r\n                        subject.complete();\r\n                    }\r\n                }\r\n                else {\r\n                    subject.next((invocationEvent.item));\r\n                }\r\n            }\r\n        };\r\n        promiseQueue = this._sendWithProtocol(invocationDescriptor)\r\n            .catch((e) => {\r\n            subject.error(e);\r\n            delete this._callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        this._launchStreams(streams, promiseQueue);\r\n        return subject;\r\n    }\r\n    _sendMessage(message) {\r\n        this._resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    }\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    _sendWithProtocol(message) {\r\n        if (this._messageBuffer) {\r\n            return this._messageBuffer._send(message);\r\n        }\r\n        else {\r\n            return this._sendMessage(this._protocol.writeMessage(message));\r\n        }\r\n    }\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    send(methodName, ...args) {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const sendPromise = this._sendWithProtocol(this._createInvocation(methodName, args, true, streamIds));\r\n        this._launchStreams(streams, sendPromise);\r\n        return sendPromise;\r\n    }\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    invoke(methodName, ...args) {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const invocationDescriptor = this._createInvocation(methodName, args, false, streamIds);\r\n        const p = new Promise((resolve, reject) => {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            this._callbacks[invocationDescriptor.invocationId] = (invocationEvent, error) => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        }\r\n                        else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(new Error(`Unexpected message type: ${invocationEvent.type}`));\r\n                    }\r\n                }\r\n            };\r\n            const promiseQueue = this._sendWithProtocol(invocationDescriptor)\r\n                .catch((e) => {\r\n                reject(e);\r\n                // invocationId will always have a value for a non-blocking invocation\r\n                delete this._callbacks[invocationDescriptor.invocationId];\r\n            });\r\n            this._launchStreams(streams, promiseQueue);\r\n        });\r\n        return p;\r\n    }\r\n    on(methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this._methods[methodName]) {\r\n            this._methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this._methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this._methods[methodName].push(newMethod);\r\n    }\r\n    off(methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        const handlers = this._methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            const removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this._methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this._methods[methodName];\r\n        }\r\n    }\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    onclose(callback) {\r\n        if (callback) {\r\n            this._closedCallbacks.push(callback);\r\n        }\r\n    }\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    onreconnecting(callback) {\r\n        if (callback) {\r\n            this._reconnectingCallbacks.push(callback);\r\n        }\r\n    }\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    onreconnected(callback) {\r\n        if (callback) {\r\n            this._reconnectedCallbacks.push(callback);\r\n        }\r\n    }\r\n    _processIncomingData(data) {\r\n        this._cleanupTimeout();\r\n        if (!this._receivedHandshakeResponse) {\r\n            data = this._processHandshakeResponse(data);\r\n            this._receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            const messages = this._protocol.parseMessages(data, this._logger);\r\n            for (const message of messages) {\r\n                if (this._messageBuffer && !this._messageBuffer._shouldProcessMessage(message)) {\r\n                    // Don't process the message, we are either waiting for a SequenceMessage or received a duplicate message\r\n                    continue;\r\n                }\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this._invokeClientMethod(message)\r\n                            .catch((e) => {\r\n                            this._logger.log(LogLevel.Error, `Invoke client method threw error: ${getErrorString(e)}`);\r\n                        });\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion: {\r\n                        const callback = this._callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this._callbacks[message.invocationId];\r\n                            }\r\n                            try {\r\n                                callback(message);\r\n                            }\r\n                            catch (e) {\r\n                                this._logger.log(LogLevel.Error, `Stream callback threw error: ${getErrorString(e)}`);\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close: {\r\n                        this._logger.log(LogLevel.Information, \"Close message received from server.\");\r\n                        const error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n                            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                            this.connection.stop(error);\r\n                        }\r\n                        else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this._stopPromise = this._stopInternal(error);\r\n                        }\r\n                        break;\r\n                    }\r\n                    case MessageType.Ack:\r\n                        if (this._messageBuffer) {\r\n                            this._messageBuffer._ack(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Sequence:\r\n                        if (this._messageBuffer) {\r\n                            this._messageBuffer._resetSequence(message);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this._logger.log(LogLevel.Warning, `Invalid message type: ${message.type}.`);\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this._resetTimeoutPeriod();\r\n    }\r\n    _processHandshakeResponse(data) {\r\n        let responseMessage;\r\n        let remainingData;\r\n        try {\r\n            [remainingData, responseMessage] = this._handshakeProtocol.parseHandshakeResponse(data);\r\n        }\r\n        catch (e) {\r\n            const message = \"Error parsing handshake response: \" + e;\r\n            this._logger.log(LogLevel.Error, message);\r\n            const error = new Error(message);\r\n            this._handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            const message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this._logger.log(LogLevel.Error, message);\r\n            const error = new Error(message);\r\n            this._handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n        this._handshakeResolver();\r\n        return remainingData;\r\n    }\r\n    _resetKeepAliveInterval() {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this._nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n        this._cleanupPingTimer();\r\n    }\r\n    _resetTimeoutPeriod() {\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this._timeoutHandle = setTimeout(() => this.serverTimeout(), this.serverTimeoutInMilliseconds);\r\n            // Set keepAlive timer if there isn't one\r\n            if (this._pingServerHandle === undefined) {\r\n                let nextPing = this._nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this._pingServerHandle = setTimeout(async () => {\r\n                    if (this._connectionState === HubConnectionState.Connected) {\r\n                        try {\r\n                            await this._sendMessage(this._cachedPingMessage);\r\n                        }\r\n                        catch {\r\n                            // We don't care about the error. It should be seen elsewhere in the client.\r\n                            // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                            this._cleanupPingTimer();\r\n                        }\r\n                    }\r\n                }, nextPing);\r\n            }\r\n        }\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    serverTimeout() {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    }\r\n    async _invokeClientMethod(invocationMessage) {\r\n        const methodName = invocationMessage.target.toLowerCase();\r\n        const methods = this._methods[methodName];\r\n        if (!methods) {\r\n            this._logger.log(LogLevel.Warning, `No client method with the name '${methodName}' found.`);\r\n            // No handlers provided by client but the server is expecting a response still, so we send an error\r\n            if (invocationMessage.invocationId) {\r\n                this._logger.log(LogLevel.Warning, `No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`);\r\n                await this._sendWithProtocol(this._createCompletionMessage(invocationMessage.invocationId, \"Client didn't provide a result.\", null));\r\n            }\r\n            return;\r\n        }\r\n        // Avoid issues with handlers removing themselves thus modifying the list while iterating through it\r\n        const methodsCopy = methods.slice();\r\n        // Server expects a response\r\n        const expectsResponse = invocationMessage.invocationId ? true : false;\r\n        // We preserve the last result or exception but still call all handlers\r\n        let res;\r\n        let exception;\r\n        let completionMessage;\r\n        for (const m of methodsCopy) {\r\n            try {\r\n                const prevRes = res;\r\n                res = await m.apply(this, invocationMessage.arguments);\r\n                if (expectsResponse && res && prevRes) {\r\n                    this._logger.log(LogLevel.Error, `Multiple results provided for '${methodName}'. Sending error to server.`);\r\n                    completionMessage = this._createCompletionMessage(invocationMessage.invocationId, `Client provided multiple results.`, null);\r\n                }\r\n                // Ignore exception if we got a result after, the exception will be logged\r\n                exception = undefined;\r\n            }\r\n            catch (e) {\r\n                exception = e;\r\n                this._logger.log(LogLevel.Error, `A callback for the method '${methodName}' threw error '${e}'.`);\r\n            }\r\n        }\r\n        if (completionMessage) {\r\n            await this._sendWithProtocol(completionMessage);\r\n        }\r\n        else if (expectsResponse) {\r\n            // If there is an exception that means either no result was given or a handler after a result threw\r\n            if (exception) {\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId, `${exception}`, null);\r\n            }\r\n            else if (res !== undefined) {\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId, null, res);\r\n            }\r\n            else {\r\n                this._logger.log(LogLevel.Warning, `No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`);\r\n                // Client didn't provide a result or throw from a handler, server expects a response so we send an error\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId, \"Client didn't provide a result.\", null);\r\n            }\r\n            await this._sendWithProtocol(completionMessage);\r\n        }\r\n        else {\r\n            if (res) {\r\n                this._logger.log(LogLevel.Error, `Result given for '${methodName}' method but server is not expecting a result.`);\r\n            }\r\n        }\r\n    }\r\n    _connectionClosed(error) {\r\n        this._logger.log(LogLevel.Debug, `HubConnection.connectionClosed(${error}) called while in state ${this._connectionState}.`);\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this._stopDuringStartError = this._stopDuringStartError || error || new AbortError(\"The underlying connection was closed before the hub handshake could complete.\");\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this._handshakeResolver) {\r\n            this._handshakeResolver();\r\n        }\r\n        this._cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n        this._cleanupTimeout();\r\n        this._cleanupPingTimer();\r\n        if (this._connectionState === HubConnectionState.Disconnecting) {\r\n            this._completeClose(error);\r\n        }\r\n        else if (this._connectionState === HubConnectionState.Connected && this._reconnectPolicy) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._reconnect(error);\r\n        }\r\n        else if (this._connectionState === HubConnectionState.Connected) {\r\n            this._completeClose(error);\r\n        }\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    }\r\n    _completeClose(error) {\r\n        if (this._connectionStarted) {\r\n            this._connectionState = HubConnectionState.Disconnected;\r\n            this._connectionStarted = false;\r\n            if (this._messageBuffer) {\r\n                this._messageBuffer._dispose(error !== null && error !== void 0 ? error : new Error(\"Connection closed.\"));\r\n                this._messageBuffer = undefined;\r\n            }\r\n            if (Platform.isBrowser) {\r\n                window.document.removeEventListener(\"freeze\", this._freezeEventListener);\r\n            }\r\n            try {\r\n                this._closedCallbacks.forEach((c) => c.apply(this, [error]));\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `An onclose callback called with error '${error}' threw error '${e}'.`);\r\n            }\r\n        }\r\n    }\r\n    async _reconnect(error) {\r\n        const reconnectStartTime = Date.now();\r\n        let previousReconnectAttempts = 0;\r\n        let retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n        let nextRetryDelay = this._getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n        if (nextRetryDelay === null) {\r\n            this._logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n            this._completeClose(error);\r\n            return;\r\n        }\r\n        this._connectionState = HubConnectionState.Reconnecting;\r\n        if (error) {\r\n            this._logger.log(LogLevel.Information, `Connection reconnecting because of error '${error}'.`);\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n        }\r\n        if (this._reconnectingCallbacks.length !== 0) {\r\n            try {\r\n                this._reconnectingCallbacks.forEach((c) => c.apply(this, [error]));\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `An onreconnecting callback called with error '${error}' threw error '${e}'.`);\r\n            }\r\n            // Exit early if an onreconnecting callback called connection.stop().\r\n            if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                this._logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                return;\r\n            }\r\n        }\r\n        while (nextRetryDelay !== null) {\r\n            this._logger.log(LogLevel.Information, `Reconnect attempt number ${previousReconnectAttempts} will start in ${nextRetryDelay} ms.`);\r\n            await new Promise((resolve) => {\r\n                this._reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);\r\n            });\r\n            this._reconnectDelayHandle = undefined;\r\n            if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                this._logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                return;\r\n            }\r\n            try {\r\n                await this._startInternal();\r\n                this._connectionState = HubConnectionState.Connected;\r\n                this._logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n                if (this._reconnectedCallbacks.length !== 0) {\r\n                    try {\r\n                        this._reconnectedCallbacks.forEach((c) => c.apply(this, [this.connection.connectionId]));\r\n                    }\r\n                    catch (e) {\r\n                        this._logger.log(LogLevel.Error, `An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`);\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Information, `Reconnect attempt failed because of error '${e}'.`);\r\n                if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                    this._logger.log(LogLevel.Debug, `Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`);\r\n                    // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                    if (this._connectionState === HubConnectionState.Disconnecting) {\r\n                        this._completeClose();\r\n                    }\r\n                    return;\r\n                }\r\n                retryError = e instanceof Error ? e : new Error(e.toString());\r\n                nextRetryDelay = this._getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n            }\r\n        }\r\n        this._logger.log(LogLevel.Information, `Reconnect retries have been exhausted after ${Date.now() - reconnectStartTime} ms and ${previousReconnectAttempts} failed attempts. Connection disconnecting.`);\r\n        this._completeClose();\r\n    }\r\n    _getNextRetryDelay(previousRetryCount, elapsedMilliseconds, retryReason) {\r\n        try {\r\n            return this._reconnectPolicy.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds,\r\n                previousRetryCount,\r\n                retryReason,\r\n            });\r\n        }\r\n        catch (e) {\r\n            this._logger.log(LogLevel.Error, `IRetryPolicy.nextRetryDelayInMilliseconds(${previousRetryCount}, ${elapsedMilliseconds}) threw error '${e}'.`);\r\n            return null;\r\n        }\r\n    }\r\n    _cancelCallbacksWithError(error) {\r\n        const callbacks = this._callbacks;\r\n        this._callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach((key) => {\r\n            const callback = callbacks[key];\r\n            try {\r\n                callback(null, error);\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `Stream 'error' callback called with '${error}' threw error: ${getErrorString(e)}`);\r\n            }\r\n        });\r\n    }\r\n    _cleanupPingTimer() {\r\n        if (this._pingServerHandle) {\r\n            clearTimeout(this._pingServerHandle);\r\n            this._pingServerHandle = undefined;\r\n        }\r\n    }\r\n    _cleanupTimeout() {\r\n        if (this._timeoutHandle) {\r\n            clearTimeout(this._timeoutHandle);\r\n        }\r\n    }\r\n    _createInvocation(methodName, args, nonblocking, streamIds) {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            const invocationId = this._invocationId;\r\n            this._invocationId++;\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds,\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    target: methodName,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    }\r\n    _launchStreams(streams, promiseQueue) {\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const streamId in streams) {\r\n            streams[streamId].subscribe({\r\n                complete: () => {\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createCompletionMessage(streamId)));\r\n                },\r\n                error: (err) => {\r\n                    let message;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    }\r\n                    else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    }\r\n                    else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createCompletionMessage(streamId, message)));\r\n                },\r\n                next: (item) => {\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createStreamItemMessage(streamId, item)));\r\n                },\r\n            });\r\n        }\r\n    }\r\n    _replaceStreamingParams(args) {\r\n        const streams = [];\r\n        const streamIds = [];\r\n        for (let i = 0; i < args.length; i++) {\r\n            const argument = args[i];\r\n            if (this._isObservable(argument)) {\r\n                const streamId = this._invocationId;\r\n                this._invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n        return [streams, streamIds];\r\n    }\r\n    _isObservable(arg) {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    }\r\n    _createStreamInvocation(methodName, args, streamIds) {\r\n        const invocationId = this._invocationId;\r\n        this._invocationId++;\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds,\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                target: methodName,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    }\r\n    _createCancelInvocation(id) {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    }\r\n    _createStreamItemMessage(id, item) {\r\n        return {\r\n            invocationId: id,\r\n            item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    }\r\n    _createCompletionMessage(id, error, result) {\r\n        if (error) {\r\n            return {\r\n                error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n        return {\r\n            invocationId: id,\r\n            result,\r\n            type: MessageType.Completion,\r\n        };\r\n    }\r\n    _createCloseMessage() {\r\n        return { type: MessageType.Close };\r\n    }\r\n}\r\n//# sourceMappingURL=HubConnection.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nconst DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n/** @private */\r\nexport class DefaultReconnectPolicy {\r\n    constructor(retryDelays) {\r\n        this._retryDelays = retryDelays !== undefined ? [...retryDelays, null] : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n    nextRetryDelayInMilliseconds(retryContext) {\r\n        return this._retryDelays[retryContext.previousRetryCount];\r\n    }\r\n}\r\n//# sourceMappingURL=DefaultReconnectPolicy.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nexport class HeaderNames {\r\n}\r\nHeaderNames.Authorization = \"Authorization\";\r\nHeaderNames.Cookie = \"Cookie\";\r\n//# sourceMappingURL=HeaderNames.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport { HttpClient } from \"./HttpClient\";\r\n/** @private */\r\nexport class AccessTokenHttpClient extends HttpClient {\r\n    constructor(innerClient, accessTokenFactory) {\r\n        super();\r\n        this._innerClient = innerClient;\r\n        this._accessTokenFactory = accessTokenFactory;\r\n    }\r\n    async send(request) {\r\n        let allowRetry = true;\r\n        if (this._accessTokenFactory && (!this._accessToken || (request.url && request.url.indexOf(\"/negotiate?\") > 0))) {\r\n            // don't retry if the request is a negotiate or if we just got a potentially new token from the access token factory\r\n            allowRetry = false;\r\n            this._accessToken = await this._accessTokenFactory();\r\n        }\r\n        this._setAuthorizationHeader(request);\r\n        const response = await this._innerClient.send(request);\r\n        if (allowRetry && response.statusCode === 401 && this._accessTokenFactory) {\r\n            this._accessToken = await this._accessTokenFactory();\r\n            this._setAuthorizationHeader(request);\r\n            return await this._innerClient.send(request);\r\n        }\r\n        return response;\r\n    }\r\n    _setAuthorizationHeader(request) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (this._accessToken) {\r\n            request.headers[HeaderNames.Authorization] = `Bearer ${this._accessToken}`;\r\n        }\r\n        // don't remove the header if there isn't an access token factory, the user manually added the header in this case\r\n        else if (this._accessTokenFactory) {\r\n            if (request.headers[HeaderNames.Authorization]) {\r\n                delete request.headers[HeaderNames.Authorization];\r\n            }\r\n        }\r\n    }\r\n    getCookieString(url) {\r\n        return this._innerClient.getCookieString(url);\r\n    }\r\n}\r\n//# sourceMappingURL=AccessTokenHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport var HttpTransportType;\r\n(function (HttpTransportType) {\r\n    /** Specifies no transport preference. */\r\n    HttpTransportType[HttpTransportType[\"None\"] = 0] = \"None\";\r\n    /** Specifies the WebSockets transport. */\r\n    HttpTransportType[HttpTransportType[\"WebSockets\"] = 1] = \"WebSockets\";\r\n    /** Specifies the Server-Sent Events transport. */\r\n    HttpTransportType[HttpTransportType[\"ServerSentEvents\"] = 2] = \"ServerSentEvents\";\r\n    /** Specifies the Long Polling transport. */\r\n    HttpTransportType[HttpTransportType[\"LongPolling\"] = 4] = \"LongPolling\";\r\n})(HttpTransportType || (HttpTransportType = {}));\r\n/** Specifies the transfer format for a connection. */\r\nexport var TransferFormat;\r\n(function (TransferFormat) {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Text\"] = 1] = \"Text\";\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Binary\"] = 2] = \"Binary\";\r\n})(TransferFormat || (TransferFormat = {}));\r\n//# sourceMappingURL=ITransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n// Not exported from index.\r\n/** @private */\r\nexport class AbortController {\r\n    constructor() {\r\n        this._isAborted = false;\r\n        this.onabort = null;\r\n    }\r\n    abort() {\r\n        if (!this._isAborted) {\r\n            this._isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    }\r\n    get signal() {\r\n        return this;\r\n    }\r\n    get aborted() {\r\n        return this._isAborted;\r\n    }\r\n}\r\n//# sourceMappingURL=AbortController.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nexport class LongPollingTransport {\r\n    // This is an internal type, not exported from 'index' so this is really just internal.\r\n    get pollAborted() {\r\n        return this._pollAbort.aborted;\r\n    }\r\n    constructor(httpClient, logger, options) {\r\n        this._httpClient = httpClient;\r\n        this._logger = logger;\r\n        this._pollAbort = new AbortController();\r\n        this._options = options;\r\n        this._running = false;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    async connect(url, transferFormat) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._url = url;\r\n        this._logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n        if (transferFormat === TransferFormat.Binary &&\r\n            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n        }\r\n        const [name, value] = getUserAgentHeader();\r\n        const headers = { [name]: value, ...this._options.headers };\r\n        const pollOptions = {\r\n            abortSignal: this._pollAbort.signal,\r\n            headers,\r\n            timeout: 100000,\r\n            withCredentials: this._options.withCredentials,\r\n        };\r\n        if (transferFormat === TransferFormat.Binary) {\r\n            pollOptions.responseType = \"arraybuffer\";\r\n        }\r\n        // Make initial long polling request\r\n        // Server uses first long polling request to finish initializing connection and it returns without data\r\n        const pollUrl = `${url}&_=${Date.now()}`;\r\n        this._logger.log(LogLevel.Trace, `(LongPolling transport) polling: ${pollUrl}.`);\r\n        const response = await this._httpClient.get(pollUrl, pollOptions);\r\n        if (response.statusCode !== 200) {\r\n            this._logger.log(LogLevel.Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}.`);\r\n            // Mark running as false so that the poll immediately ends and runs the close logic\r\n            this._closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n            this._running = false;\r\n        }\r\n        else {\r\n            this._running = true;\r\n        }\r\n        this._receiving = this._poll(this._url, pollOptions);\r\n    }\r\n    async _poll(url, pollOptions) {\r\n        try {\r\n            while (this._running) {\r\n                try {\r\n                    const pollUrl = `${url}&_=${Date.now()}`;\r\n                    this._logger.log(LogLevel.Trace, `(LongPolling transport) polling: ${pollUrl}.`);\r\n                    const response = await this._httpClient.get(pollUrl, pollOptions);\r\n                    if (response.statusCode === 204) {\r\n                        this._logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n                        this._running = false;\r\n                    }\r\n                    else if (response.statusCode !== 200) {\r\n                        this._logger.log(LogLevel.Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}.`);\r\n                        // Unexpected status code\r\n                        this._closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                        this._running = false;\r\n                    }\r\n                    else {\r\n                        // Process the response\r\n                        if (response.content) {\r\n                            this._logger.log(LogLevel.Trace, `(LongPolling transport) data received. ${getDataDetail(response.content, this._options.logMessageContent)}.`);\r\n                            if (this.onreceive) {\r\n                                this.onreceive(response.content);\r\n                            }\r\n                        }\r\n                        else {\r\n                            // This is another way timeout manifest.\r\n                            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                        }\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    if (!this._running) {\r\n                        // Log but disregard errors that occur after stopping\r\n                        this._logger.log(LogLevel.Trace, `(LongPolling transport) Poll errored after shutdown: ${e.message}`);\r\n                    }\r\n                    else {\r\n                        if (e instanceof TimeoutError) {\r\n                            // Ignore timeouts and reissue the poll.\r\n                            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                        }\r\n                        else {\r\n                            // Close the connection with the error as the result.\r\n                            this._closeError = e;\r\n                            this._running = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        finally {\r\n            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n            // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n            // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n            if (!this.pollAborted) {\r\n                this._raiseOnClose();\r\n            }\r\n        }\r\n    }\r\n    async send(data) {\r\n        if (!this._running) {\r\n            return Promise.reject(new Error(\"Cannot send until the transport is connected\"));\r\n        }\r\n        return sendMessage(this._logger, \"LongPolling\", this._httpClient, this._url, data, this._options);\r\n    }\r\n    async stop() {\r\n        this._logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n        this._running = false;\r\n        this._pollAbort.abort();\r\n        try {\r\n            await this._receiving;\r\n            // Send DELETE to clean up long polling on the server\r\n            this._logger.log(LogLevel.Trace, `(LongPolling transport) sending DELETE request to ${this._url}.`);\r\n            const headers = {};\r\n            const [name, value] = getUserAgentHeader();\r\n            headers[name] = value;\r\n            const deleteOptions = {\r\n                headers: { ...headers, ...this._options.headers },\r\n                timeout: this._options.timeout,\r\n                withCredentials: this._options.withCredentials,\r\n            };\r\n            let error;\r\n            try {\r\n                await this._httpClient.delete(this._url, deleteOptions);\r\n            }\r\n            catch (err) {\r\n                error = err;\r\n            }\r\n            if (error) {\r\n                if (error instanceof HttpError) {\r\n                    if (error.statusCode === 404) {\r\n                        this._logger.log(LogLevel.Trace, \"(LongPolling transport) A 404 response was returned from sending a DELETE request.\");\r\n                    }\r\n                    else {\r\n                        this._logger.log(LogLevel.Trace, `(LongPolling transport) Error sending a DELETE request: ${error}`);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this._logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request accepted.\");\r\n            }\r\n        }\r\n        finally {\r\n            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n            // Raise close event here instead of in polling\r\n            // It needs to happen after the DELETE request is sent\r\n            this._raiseOnClose();\r\n        }\r\n    }\r\n    _raiseOnClose() {\r\n        if (this.onclose) {\r\n            let logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this._closeError) {\r\n                logMessage += \" Error: \" + this._closeError;\r\n            }\r\n            this._logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this._closeError);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=LongPollingTransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\n/** @private */\r\nexport class ServerSentEventsTransport {\r\n    constructor(httpClient, accessToken, logger, options) {\r\n        this._httpClient = httpClient;\r\n        this._accessToken = accessToken;\r\n        this._logger = logger;\r\n        this._options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    async connect(url, transferFormat) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n        // set url before accessTokenFactory because this._url is only for send and we set the auth header instead of the query string for send\r\n        this._url = url;\r\n        if (this._accessToken) {\r\n            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + `access_token=${encodeURIComponent(this._accessToken)}`;\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            let opened = false;\r\n            if (transferFormat !== TransferFormat.Text) {\r\n                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                return;\r\n            }\r\n            let eventSource;\r\n            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                eventSource = new this._options.EventSource(url, { withCredentials: this._options.withCredentials });\r\n            }\r\n            else {\r\n                // Non-browser passes cookies via the dictionary\r\n                const cookies = this._httpClient.getCookieString(url);\r\n                const headers = {};\r\n                headers.Cookie = cookies;\r\n                const [name, value] = getUserAgentHeader();\r\n                headers[name] = value;\r\n                eventSource = new this._options.EventSource(url, { withCredentials: this._options.withCredentials, headers: { ...headers, ...this._options.headers } });\r\n            }\r\n            try {\r\n                eventSource.onmessage = (e) => {\r\n                    if (this.onreceive) {\r\n                        try {\r\n                            this._logger.log(LogLevel.Trace, `(SSE transport) data received. ${getDataDetail(e.data, this._options.logMessageContent)}.`);\r\n                            this.onreceive(e.data);\r\n                        }\r\n                        catch (error) {\r\n                            this._close(error);\r\n                            return;\r\n                        }\r\n                    }\r\n                };\r\n                // @ts-ignore: not using event on purpose\r\n                eventSource.onerror = (e) => {\r\n                    // EventSource doesn't give any useful information about server side closes.\r\n                    if (opened) {\r\n                        this._close();\r\n                    }\r\n                    else {\r\n                        reject(new Error(\"EventSource failed to connect. The connection could not be found on the server,\"\r\n                            + \" either the connection ID is not present on the server, or a proxy is refusing/buffering the connection.\"\r\n                            + \" If you have multiple servers check that sticky sessions are enabled.\"));\r\n                    }\r\n                };\r\n                eventSource.onopen = () => {\r\n                    this._logger.log(LogLevel.Information, `SSE connected to ${this._url}`);\r\n                    this._eventSource = eventSource;\r\n                    opened = true;\r\n                    resolve();\r\n                };\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n                return;\r\n            }\r\n        });\r\n    }\r\n    async send(data) {\r\n        if (!this._eventSource) {\r\n            return Promise.reject(new Error(\"Cannot send until the transport is connected\"));\r\n        }\r\n        return sendMessage(this._logger, \"SSE\", this._httpClient, this._url, data, this._options);\r\n    }\r\n    stop() {\r\n        this._close();\r\n        return Promise.resolve();\r\n    }\r\n    _close(e) {\r\n        if (this._eventSource) {\r\n            this._eventSource.close();\r\n            this._eventSource = undefined;\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=ServerSentEventsTransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n/** @private */\r\nexport class WebSocketTransport {\r\n    constructor(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {\r\n        this._logger = logger;\r\n        this._accessTokenFactory = accessTokenFactory;\r\n        this._logMessageContent = logMessageContent;\r\n        this._webSocketConstructor = webSocketConstructor;\r\n        this._httpClient = httpClient;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this._headers = headers;\r\n    }\r\n    async connect(url, transferFormat) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n        let token;\r\n        if (this._accessTokenFactory) {\r\n            token = await this._accessTokenFactory();\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            url = url.replace(/^http/, \"ws\");\r\n            let webSocket;\r\n            const cookies = this._httpClient.getCookieString(url);\r\n            let opened = false;\r\n            if (Platform.isNode || Platform.isReactNative) {\r\n                const headers = {};\r\n                const [name, value] = getUserAgentHeader();\r\n                headers[name] = value;\r\n                if (token) {\r\n                    headers[HeaderNames.Authorization] = `Bearer ${token}`;\r\n                }\r\n                if (cookies) {\r\n                    headers[HeaderNames.Cookie] = cookies;\r\n                }\r\n                // Only pass headers when in non-browser environments\r\n                webSocket = new this._webSocketConstructor(url, undefined, {\r\n                    headers: { ...headers, ...this._headers },\r\n                });\r\n            }\r\n            else {\r\n                if (token) {\r\n                    url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + `access_token=${encodeURIComponent(token)}`;\r\n                }\r\n            }\r\n            if (!webSocket) {\r\n                // Chrome is not happy with passing 'undefined' as protocol\r\n                webSocket = new this._webSocketConstructor(url);\r\n            }\r\n            if (transferFormat === TransferFormat.Binary) {\r\n                webSocket.binaryType = \"arraybuffer\";\r\n            }\r\n            webSocket.onopen = (_event) => {\r\n                this._logger.log(LogLevel.Information, `WebSocket connected to ${url}.`);\r\n                this._webSocket = webSocket;\r\n                opened = true;\r\n                resolve();\r\n            };\r\n            webSocket.onerror = (event) => {\r\n                let error = null;\r\n                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                    error = event.error;\r\n                }\r\n                else {\r\n                    error = \"There was an error with the transport\";\r\n                }\r\n                this._logger.log(LogLevel.Information, `(WebSockets transport) ${error}.`);\r\n            };\r\n            webSocket.onmessage = (message) => {\r\n                this._logger.log(LogLevel.Trace, `(WebSockets transport) data received. ${getDataDetail(message.data, this._logMessageContent)}.`);\r\n                if (this.onreceive) {\r\n                    try {\r\n                        this.onreceive(message.data);\r\n                    }\r\n                    catch (error) {\r\n                        this._close(error);\r\n                        return;\r\n                    }\r\n                }\r\n            };\r\n            webSocket.onclose = (event) => {\r\n                // Don't call close handler if connection was never established\r\n                // We'll reject the connect call instead\r\n                if (opened) {\r\n                    this._close(event);\r\n                }\r\n                else {\r\n                    let error = null;\r\n                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                        error = event.error;\r\n                    }\r\n                    else {\r\n                        error = \"WebSocket failed to connect. The connection could not be found on the server,\"\r\n                            + \" either the endpoint may not be a SignalR endpoint,\"\r\n                            + \" the connection ID is not present on the server, or there is a proxy blocking WebSockets.\"\r\n                            + \" If you have multiple servers check that sticky sessions are enabled.\";\r\n                    }\r\n                    reject(new Error(error));\r\n                }\r\n            };\r\n        });\r\n    }\r\n    send(data) {\r\n        if (this._webSocket && this._webSocket.readyState === this._webSocketConstructor.OPEN) {\r\n            this._logger.log(LogLevel.Trace, `(WebSockets transport) sending data. ${getDataDetail(data, this._logMessageContent)}.`);\r\n            this._webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    }\r\n    stop() {\r\n        if (this._webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this._close(undefined);\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    _close(event) {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this._webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this._webSocket.onclose = () => { };\r\n            this._webSocket.onmessage = () => { };\r\n            this._webSocket.onerror = () => { };\r\n            this._webSocket.close();\r\n            this._webSocket = undefined;\r\n        }\r\n        this._logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n        if (this.onclose) {\r\n            if (this._isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(`WebSocket closed with status code: ${event.code} (${event.reason || \"no reason given\"}).`));\r\n            }\r\n            else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            }\r\n            else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    }\r\n    _isCloseEvent(event) {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    }\r\n}\r\n//# sourceMappingURL=WebSocketTransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AccessTokenHttpClient } from \"./AccessTokenHttpClient\";\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { AggregateErrors, DisabledTransportError, FailedToNegotiateWithServerError, FailedToStartTransportError, HttpError, UnsupportedTransportError, AbortError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nconst MAX_REDIRECTS = 100;\r\n/** @private */\r\nexport class HttpConnection {\r\n    constructor(url, options = {}) {\r\n        this._stopPromiseResolver = () => { };\r\n        this.features = {};\r\n        this._negotiateVersion = 1;\r\n        Arg.isRequired(url, \"url\");\r\n        this._logger = createLogger(options.logger);\r\n        this.baseUrl = this._resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        }\r\n        else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        options.timeout = options.timeout === undefined ? 100 * 1000 : options.timeout;\r\n        let webSocketModule = null;\r\n        let eventSourceModule = null;\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n        this._httpClient = new AccessTokenHttpClient(options.httpClient || new DefaultHttpClient(this._logger), options.accessTokenFactory);\r\n        this._connectionState = \"Disconnected\" /* ConnectionState.Disconnected */;\r\n        this._connectionStarted = false;\r\n        this._options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    async start(transferFormat) {\r\n        transferFormat = transferFormat || TransferFormat.Binary;\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Debug, `Starting connection with transfer format '${TransferFormat[transferFormat]}'.`);\r\n        if (this._connectionState !== \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n            return Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"));\r\n        }\r\n        this._connectionState = \"Connecting\" /* ConnectionState.Connecting */;\r\n        this._startInternalPromise = this._startInternal(transferFormat);\r\n        await this._startInternalPromise;\r\n        // The TypeScript compiler thinks that connectionState must be Connecting here. The TypeScript compiler is wrong.\r\n        if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */) {\r\n            // stop() was called and transitioned the client into the Disconnecting state.\r\n            const message = \"Failed to start the HttpConnection before stop() was called.\";\r\n            this._logger.log(LogLevel.Error, message);\r\n            // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n            await this._stopPromise;\r\n            return Promise.reject(new AbortError(message));\r\n        }\r\n        else if (this._connectionState !== \"Connected\" /* ConnectionState.Connected */) {\r\n            // stop() was called and transitioned the client into the Disconnecting state.\r\n            const message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n            this._logger.log(LogLevel.Error, message);\r\n            return Promise.reject(new AbortError(message));\r\n        }\r\n        this._connectionStarted = true;\r\n    }\r\n    send(data) {\r\n        if (this._connectionState !== \"Connected\" /* ConnectionState.Connected */) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n        if (!this._sendQueue) {\r\n            this._sendQueue = new TransportSendQueue(this.transport);\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this._sendQueue.send(data);\r\n    }\r\n    async stop(error) {\r\n        if (this._connectionState === \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnected state.`);\r\n            return Promise.resolve();\r\n        }\r\n        if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`);\r\n            return this._stopPromise;\r\n        }\r\n        this._connectionState = \"Disconnecting\" /* ConnectionState.Disconnecting */;\r\n        this._stopPromise = new Promise((resolve) => {\r\n            // Don't complete stop() until stopConnection() completes.\r\n            this._stopPromiseResolver = resolve;\r\n        });\r\n        // stopInternal should never throw so just observe it.\r\n        await this._stopInternal(error);\r\n        await this._stopPromise;\r\n    }\r\n    async _stopInternal(error) {\r\n        // Set error as soon as possible otherwise there is a race between\r\n        // the transport closing and providing an error and the error from a close message\r\n        // We would prefer the close message error.\r\n        this._stopError = error;\r\n        try {\r\n            await this._startInternalPromise;\r\n        }\r\n        catch (e) {\r\n            // This exception is returned to the user as a rejected Promise from the start method.\r\n        }\r\n        // The transport's onclose will trigger stopConnection which will run our onclose event.\r\n        // The transport should always be set if currently connected. If it wasn't set, it's likely because\r\n        // stop was called during start() and start() failed.\r\n        if (this.transport) {\r\n            try {\r\n                await this.transport.stop();\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `HttpConnection.transport.stop() threw error '${e}'.`);\r\n                this._stopConnection();\r\n            }\r\n            this.transport = undefined;\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n        }\r\n    }\r\n    async _startInternal(transferFormat) {\r\n        // Store the original base url and the access token factory since they may change\r\n        // as part of negotiating\r\n        let url = this.baseUrl;\r\n        this._accessTokenFactory = this._options.accessTokenFactory;\r\n        this._httpClient._accessTokenFactory = this._accessTokenFactory;\r\n        try {\r\n            if (this._options.skipNegotiation) {\r\n                if (this._options.transport === HttpTransportType.WebSockets) {\r\n                    // No need to add a connection ID in this case\r\n                    this.transport = this._constructTransport(HttpTransportType.WebSockets);\r\n                    // We should just call connect directly in this case.\r\n                    // No fallback or negotiate in this case.\r\n                    await this._startTransport(url, transferFormat);\r\n                }\r\n                else {\r\n                    throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                }\r\n            }\r\n            else {\r\n                let negotiateResponse = null;\r\n                let redirects = 0;\r\n                do {\r\n                    negotiateResponse = await this._getNegotiationResponse(url);\r\n                    // the user tries to stop the connection when it is being started\r\n                    if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */ || this._connectionState === \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n                        throw new AbortError(\"The connection was stopped during negotiation.\");\r\n                    }\r\n                    if (negotiateResponse.error) {\r\n                        throw new Error(negotiateResponse.error);\r\n                    }\r\n                    if (negotiateResponse.ProtocolVersion) {\r\n                        throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                    }\r\n                    if (negotiateResponse.url) {\r\n                        url = negotiateResponse.url;\r\n                    }\r\n                    if (negotiateResponse.accessToken) {\r\n                        // Replace the current access token factory with one that uses\r\n                        // the returned access token\r\n                        const accessToken = negotiateResponse.accessToken;\r\n                        this._accessTokenFactory = () => accessToken;\r\n                        // set the factory to undefined so the AccessTokenHttpClient won't retry with the same token, since we know it won't change until a connection restart\r\n                        this._httpClient._accessToken = accessToken;\r\n                        this._httpClient._accessTokenFactory = undefined;\r\n                    }\r\n                    redirects++;\r\n                } while (negotiateResponse.url && redirects < MAX_REDIRECTS);\r\n                if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                    throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                }\r\n                await this._createTransport(url, this._options.transport, negotiateResponse, transferFormat);\r\n            }\r\n            if (this.transport instanceof LongPollingTransport) {\r\n                this.features.inherentKeepAlive = true;\r\n            }\r\n            if (this._connectionState === \"Connecting\" /* ConnectionState.Connecting */) {\r\n                // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                this._logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                this._connectionState = \"Connected\" /* ConnectionState.Connected */;\r\n            }\r\n            // stop() is waiting on us via this.startInternalPromise so keep this.transport around so it can clean up.\r\n            // This is the only case startInternal can exit in neither the connected nor disconnected state because stopConnection()\r\n            // will transition to the disconnected state. start() will wait for the transition using the stopPromise.\r\n        }\r\n        catch (e) {\r\n            this._logger.log(LogLevel.Error, \"Failed to start the connection: \" + e);\r\n            this._connectionState = \"Disconnected\" /* ConnectionState.Disconnected */;\r\n            this.transport = undefined;\r\n            // if start fails, any active calls to stop assume that start will complete the stop promise\r\n            this._stopPromiseResolver();\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    async _getNegotiationResponse(url) {\r\n        const headers = {};\r\n        const [name, value] = getUserAgentHeader();\r\n        headers[name] = value;\r\n        const negotiateUrl = this._resolveNegotiateUrl(url);\r\n        this._logger.log(LogLevel.Debug, `Sending negotiation request: ${negotiateUrl}.`);\r\n        try {\r\n            const response = await this._httpClient.post(negotiateUrl, {\r\n                content: \"\",\r\n                headers: { ...headers, ...this._options.headers },\r\n                timeout: this._options.timeout,\r\n                withCredentials: this._options.withCredentials,\r\n            });\r\n            if (response.statusCode !== 200) {\r\n                return Promise.reject(new Error(`Unexpected status code returned from negotiate '${response.statusCode}'`));\r\n            }\r\n            const negotiateResponse = JSON.parse(response.content);\r\n            if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                // Negotiate version 0 doesn't use connectionToken\r\n                // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n            }\r\n            if (negotiateResponse.useStatefulReconnect && this._options._useStatefulReconnect !== true) {\r\n                return Promise.reject(new FailedToNegotiateWithServerError(\"Client didn't negotiate Stateful Reconnect but the server did.\"));\r\n            }\r\n            return negotiateResponse;\r\n        }\r\n        catch (e) {\r\n            let errorMessage = \"Failed to complete negotiation with the server: \" + e;\r\n            if (e instanceof HttpError) {\r\n                if (e.statusCode === 404) {\r\n                    errorMessage = errorMessage + \" Either this is not a SignalR endpoint or there is a proxy blocking the connection.\";\r\n                }\r\n            }\r\n            this._logger.log(LogLevel.Error, errorMessage);\r\n            return Promise.reject(new FailedToNegotiateWithServerError(errorMessage));\r\n        }\r\n    }\r\n    _createConnectUrl(url, connectionToken) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + `id=${connectionToken}`;\r\n    }\r\n    async _createTransport(url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        let connectUrl = this._createConnectUrl(url, negotiateResponse.connectionToken);\r\n        if (this._isITransport(requestedTransport)) {\r\n            this._logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n            this.transport = requestedTransport;\r\n            await this._startTransport(connectUrl, requestedTransferFormat);\r\n            this.connectionId = negotiateResponse.connectionId;\r\n            return;\r\n        }\r\n        const transportExceptions = [];\r\n        const transports = negotiateResponse.availableTransports || [];\r\n        let negotiate = negotiateResponse;\r\n        for (const endpoint of transports) {\r\n            const transportOrError = this._resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat, (negotiate === null || negotiate === void 0 ? void 0 : negotiate.useStatefulReconnect) === true);\r\n            if (transportOrError instanceof Error) {\r\n                // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                transportExceptions.push(`${endpoint.transport} failed:`);\r\n                transportExceptions.push(transportOrError);\r\n            }\r\n            else if (this._isITransport(transportOrError)) {\r\n                this.transport = transportOrError;\r\n                if (!negotiate) {\r\n                    try {\r\n                        negotiate = await this._getNegotiationResponse(url);\r\n                    }\r\n                    catch (ex) {\r\n                        return Promise.reject(ex);\r\n                    }\r\n                    connectUrl = this._createConnectUrl(url, negotiate.connectionToken);\r\n                }\r\n                try {\r\n                    await this._startTransport(connectUrl, requestedTransferFormat);\r\n                    this.connectionId = negotiate.connectionId;\r\n                    return;\r\n                }\r\n                catch (ex) {\r\n                    this._logger.log(LogLevel.Error, `Failed to start the transport '${endpoint.transport}': ${ex}`);\r\n                    negotiate = undefined;\r\n                    transportExceptions.push(new FailedToStartTransportError(`${endpoint.transport} failed: ${ex}`, HttpTransportType[endpoint.transport]));\r\n                    if (this._connectionState !== \"Connecting\" /* ConnectionState.Connecting */) {\r\n                        const message = \"Failed to select transport before stop() was called.\";\r\n                        this._logger.log(LogLevel.Debug, message);\r\n                        return Promise.reject(new AbortError(message));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (transportExceptions.length > 0) {\r\n            return Promise.reject(new AggregateErrors(`Unable to connect to the server with any of the available transports. ${transportExceptions.join(\" \")}`, transportExceptions));\r\n        }\r\n        return Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"));\r\n    }\r\n    _constructTransport(transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this._options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this._httpClient, this._accessTokenFactory, this._logger, this._options.logMessageContent, this._options.WebSocket, this._options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this._options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this._httpClient, this._httpClient._accessToken, this._logger, this._options);\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this._httpClient, this._logger, this._options);\r\n            default:\r\n                throw new Error(`Unknown transport: ${transport}.`);\r\n        }\r\n    }\r\n    _startTransport(url, transferFormat) {\r\n        this.transport.onreceive = this.onreceive;\r\n        if (this.features.reconnect) {\r\n            this.transport.onclose = async (e) => {\r\n                let callStop = false;\r\n                if (this.features.reconnect) {\r\n                    try {\r\n                        this.features.disconnected();\r\n                        await this.transport.connect(url, transferFormat);\r\n                        await this.features.resend();\r\n                    }\r\n                    catch {\r\n                        callStop = true;\r\n                    }\r\n                }\r\n                else {\r\n                    this._stopConnection(e);\r\n                    return;\r\n                }\r\n                if (callStop) {\r\n                    this._stopConnection(e);\r\n                }\r\n            };\r\n        }\r\n        else {\r\n            this.transport.onclose = (e) => this._stopConnection(e);\r\n        }\r\n        return this.transport.connect(url, transferFormat);\r\n    }\r\n    _resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat, useStatefulReconnect) {\r\n        const transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this._logger.log(LogLevel.Debug, `Skipping transport '${endpoint.transport}' because it is not supported by this client.`);\r\n            return new Error(`Skipping transport '${endpoint.transport}' because it is not supported by this client.`);\r\n        }\r\n        else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                const transferFormats = endpoint.transferFormats.map((s) => TransferFormat[s]);\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this._options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this._options.EventSource)) {\r\n                        this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it is not supported in your environment.'`);\r\n                        return new UnsupportedTransportError(`'${HttpTransportType[transport]}' is not supported in your environment.`, transport);\r\n                    }\r\n                    else {\r\n                        this._logger.log(LogLevel.Debug, `Selecting transport '${HttpTransportType[transport]}'.`);\r\n                        try {\r\n                            this.features.reconnect = transport === HttpTransportType.WebSockets ? useStatefulReconnect : undefined;\r\n                            return this._constructTransport(transport);\r\n                        }\r\n                        catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it does not support the requested transfer format '${TransferFormat[requestedTransferFormat]}'.`);\r\n                    return new Error(`'${HttpTransportType[transport]}' does not support ${TransferFormat[requestedTransferFormat]}.`);\r\n                }\r\n            }\r\n            else {\r\n                this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it was disabled by the client.`);\r\n                return new DisabledTransportError(`'${HttpTransportType[transport]}' is disabled by the client.`, transport);\r\n            }\r\n        }\r\n    }\r\n    _isITransport(transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    }\r\n    _stopConnection(error) {\r\n        this._logger.log(LogLevel.Debug, `HttpConnection.stopConnection(${error}) called while in state ${this._connectionState}.`);\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this._stopError || error;\r\n        this._stopError = undefined;\r\n        if (this._connectionState === \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stopConnection(${error}) was ignored because the connection is already in the disconnected state.`);\r\n            return;\r\n        }\r\n        if (this._connectionState === \"Connecting\" /* ConnectionState.Connecting */) {\r\n            this._logger.log(LogLevel.Warning, `Call to HttpConnection.stopConnection(${error}) was ignored because the connection is still in the connecting state.`);\r\n            throw new Error(`HttpConnection.stopConnection(${error}) was called while the connection is still in the connecting state.`);\r\n        }\r\n        if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this._stopPromiseResolver();\r\n        }\r\n        if (error) {\r\n            this._logger.log(LogLevel.Error, `Connection disconnected with error '${error}'.`);\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        if (this._sendQueue) {\r\n            this._sendQueue.stop().catch((e) => {\r\n                this._logger.log(LogLevel.Error, `TransportSendQueue.stop() threw error '${e}'.`);\r\n            });\r\n            this._sendQueue = undefined;\r\n        }\r\n        this.connectionId = undefined;\r\n        this._connectionState = \"Disconnected\" /* ConnectionState.Disconnected */;\r\n        if (this._connectionStarted) {\r\n            this._connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `HttpConnection.onclose(${error}) threw error '${e}'.`);\r\n            }\r\n        }\r\n    }\r\n    _resolveUrl(url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (!Platform.isBrowser) {\r\n            throw new Error(`Cannot resolve '${url}'.`);\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        const aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this._logger.log(LogLevel.Information, `Normalizing '${url}' to '${aTag.href}'.`);\r\n        return aTag.href;\r\n    }\r\n    _resolveNegotiateUrl(url) {\r\n        const negotiateUrl = new URL(url);\r\n        if (negotiateUrl.pathname.endsWith('/')) {\r\n            negotiateUrl.pathname += \"negotiate\";\r\n        }\r\n        else {\r\n            negotiateUrl.pathname += \"/negotiate\";\r\n        }\r\n        const searchParams = new URLSearchParams(negotiateUrl.searchParams);\r\n        if (!searchParams.has(\"negotiateVersion\")) {\r\n            searchParams.append(\"negotiateVersion\", this._negotiateVersion.toString());\r\n        }\r\n        if (searchParams.has(\"useStatefulReconnect\")) {\r\n            if (searchParams.get(\"useStatefulReconnect\") === \"true\") {\r\n                this._options._useStatefulReconnect = true;\r\n            }\r\n        }\r\n        else if (this._options._useStatefulReconnect === true) {\r\n            searchParams.append(\"useStatefulReconnect\", \"true\");\r\n        }\r\n        negotiateUrl.search = searchParams.toString();\r\n        return negotiateUrl.toString();\r\n    }\r\n}\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n/** @private */\r\nexport class TransportSendQueue {\r\n    constructor(_transport) {\r\n        this._transport = _transport;\r\n        this._buffer = [];\r\n        this._executing = true;\r\n        this._sendBufferedData = new PromiseSource();\r\n        this._transportResult = new PromiseSource();\r\n        this._sendLoopPromise = this._sendLoop();\r\n    }\r\n    send(data) {\r\n        this._bufferData(data);\r\n        if (!this._transportResult) {\r\n            this._transportResult = new PromiseSource();\r\n        }\r\n        return this._transportResult.promise;\r\n    }\r\n    stop() {\r\n        this._executing = false;\r\n        this._sendBufferedData.resolve();\r\n        return this._sendLoopPromise;\r\n    }\r\n    _bufferData(data) {\r\n        if (this._buffer.length && typeof (this._buffer[0]) !== typeof (data)) {\r\n            throw new Error(`Expected data to be of type ${typeof (this._buffer)} but was of type ${typeof (data)}`);\r\n        }\r\n        this._buffer.push(data);\r\n        this._sendBufferedData.resolve();\r\n    }\r\n    async _sendLoop() {\r\n        while (true) {\r\n            await this._sendBufferedData.promise;\r\n            if (!this._executing) {\r\n                if (this._transportResult) {\r\n                    this._transportResult.reject(\"Connection stopped.\");\r\n                }\r\n                break;\r\n            }\r\n            this._sendBufferedData = new PromiseSource();\r\n            const transportResult = this._transportResult;\r\n            this._transportResult = undefined;\r\n            const data = typeof (this._buffer[0]) === \"string\" ?\r\n                this._buffer.join(\"\") :\r\n                TransportSendQueue._concatBuffers(this._buffer);\r\n            this._buffer.length = 0;\r\n            try {\r\n                await this._transport.send(data);\r\n                transportResult.resolve();\r\n            }\r\n            catch (error) {\r\n                transportResult.reject(error);\r\n            }\r\n        }\r\n    }\r\n    static _concatBuffers(arrayBuffers) {\r\n        const totalLength = arrayBuffers.map((b) => b.byteLength).reduce((a, b) => a + b);\r\n        const result = new Uint8Array(totalLength);\r\n        let offset = 0;\r\n        for (const item of arrayBuffers) {\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n        return result.buffer;\r\n    }\r\n}\r\nclass PromiseSource {\r\n    constructor() {\r\n        this.promise = new Promise((resolve, reject) => [this._resolver, this._rejecter] = [resolve, reject]);\r\n    }\r\n    resolve() {\r\n        this._resolver();\r\n    }\r\n    reject(reason) {\r\n        this._rejecter(reason);\r\n    }\r\n}\r\n//# sourceMappingURL=HttpConnection.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nconst JSON_HUB_PROTOCOL_NAME = \"json\";\r\n/** Implements the JSON Hub Protocol. */\r\nexport class JsonHubProtocol {\r\n    constructor() {\r\n        /** @inheritDoc */\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        /** @inheritDoc */\r\n        this.version = 2;\r\n        /** @inheritDoc */\r\n        this.transferFormat = TransferFormat.Text;\r\n    }\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    parseMessages(input, logger) {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n        // Parse the messages\r\n        const messages = TextMessageFormat.parse(input);\r\n        const hubMessages = [];\r\n        for (const message of messages) {\r\n            const parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this._isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this._isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this._isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                case MessageType.Ack:\r\n                    this._isAckMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Sequence:\r\n                    this._isSequenceMessage(parsedMessage);\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    }\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    writeMessage(message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    }\r\n    _isInvocationMessage(message) {\r\n        this._assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n        if (message.invocationId !== undefined) {\r\n            this._assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    }\r\n    _isStreamItemMessage(message) {\r\n        this._assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    }\r\n    _isCompletionMessage(message) {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this._assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n        this._assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    }\r\n    _isAckMessage(message) {\r\n        if (typeof message.sequenceId !== 'number') {\r\n            throw new Error(\"Invalid SequenceId for Ack message.\");\r\n        }\r\n    }\r\n    _isSequenceMessage(message) {\r\n        if (typeof message.sequenceId !== 'number') {\r\n            throw new Error(\"Invalid SequenceId for Sequence message.\");\r\n        }\r\n    }\r\n    _assertNotEmptyString(value, errorMessage) {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=JsonHubProtocol.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\nconst LogLevelNameMapping = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\nfunction parseLogLevel(name) {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    const mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    }\r\n    else {\r\n        throw new Error(`Unknown log level: ${name}`);\r\n    }\r\n}\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nexport class HubConnectionBuilder {\r\n    configureLogging(logging) {\r\n        Arg.isRequired(logging, \"logging\");\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        }\r\n        else if (typeof logging === \"string\") {\r\n            const logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        }\r\n        else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n        return this;\r\n    }\r\n    withUrl(url, transportTypeOrOptions) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n        this.url = url;\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = { ...this.httpConnectionOptions, ...transportTypeOrOptions };\r\n        }\r\n        else {\r\n            this.httpConnectionOptions = {\r\n                ...this.httpConnectionOptions,\r\n                transport: transportTypeOrOptions,\r\n            };\r\n        }\r\n        return this;\r\n    }\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    withHubProtocol(protocol) {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.protocol = protocol;\r\n        return this;\r\n    }\r\n    withAutomaticReconnect(retryDelaysOrReconnectPolicy) {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        }\r\n        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        }\r\n        else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n        return this;\r\n    }\r\n    /** Configures {@link @microsoft/signalr.HubConnection.serverTimeoutInMilliseconds} for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    withServerTimeout(milliseconds) {\r\n        Arg.isRequired(milliseconds, \"milliseconds\");\r\n        this._serverTimeoutInMilliseconds = milliseconds;\r\n        return this;\r\n    }\r\n    /** Configures {@link @microsoft/signalr.HubConnection.keepAliveIntervalInMilliseconds} for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    withKeepAliveInterval(milliseconds) {\r\n        Arg.isRequired(milliseconds, \"milliseconds\");\r\n        this._keepAliveIntervalInMilliseconds = milliseconds;\r\n        return this;\r\n    }\r\n    /** Enables and configures options for the Stateful Reconnect feature.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    withStatefulReconnect(options) {\r\n        if (this.httpConnectionOptions === undefined) {\r\n            this.httpConnectionOptions = {};\r\n        }\r\n        this.httpConnectionOptions._useStatefulReconnect = true;\r\n        this._statefulReconnectBufferSize = options === null || options === void 0 ? void 0 : options.bufferSize;\r\n        return this;\r\n    }\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    build() {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        const httpConnectionOptions = this.httpConnectionOptions || {};\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        const connection = new HttpConnection(this.url, httpConnectionOptions);\r\n        return HubConnection.create(connection, this.logger || NullLogger.instance, this.protocol || new JsonHubProtocol(), this.reconnectPolicy, this._serverTimeoutInMilliseconds, this._keepAliveIntervalInMilliseconds, this._statefulReconnectBufferSize);\r\n    }\r\n}\r\nfunction isLogger(logger) {\r\n    return logger.log !== undefined;\r\n}\r\n//# sourceMappingURL=HubConnectionBuilder.js.map","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbArrayState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nimport { ProcessingHubMessage, ProcessingMessage } from '@jumoo/processing';\r\nimport * as signalR from '@jumoo/processing/external/signalr';\r\n\r\nconst JUMOO_PROCESSING_HUB_PATH = '/umbraco/processinghub';\r\n\r\nexport class ProcessingSignalRContext extends UmbControllerBase {\r\n\t#connection?: signalR.HubConnection;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.provideContext(JUMOO_PROCESSING_SIGNALR_CONTEXT, this);\r\n\t}\r\n\r\n\t#messages = new UmbArrayState<ProcessingHubMessage>([], (x) => x.method);\r\n\tpublic readonly message = this.#messages.asObservable();\r\n\r\n\tstartHub(token: string, methods: string[]) {\r\n\t\tthis.#setupConnection(JUMOO_PROCESSING_HUB_PATH, token, methods);\r\n\t}\r\n\r\n\thostConnected(): void {\r\n\t\tsuper.hostConnected();\r\n\t}\r\n\r\n\thostDisconnected(): void {\r\n\t\tsuper.hostDisconnected();\r\n\t\tthis.#connection?.stop().then(() => {\r\n\t\t\tconsole.debug('signalr connection stopped');\r\n\t\t});\r\n\t}\r\n\r\n\tmessagesOf(method: string) {\r\n\t\treturn this.#messages.asObservablePart((message) =>\r\n\t\t\tmessage.find((x) => x.method === method),\r\n\t\t);\r\n\t}\r\n\r\n\tgetClientId(): string | null {\r\n\t\treturn this.#connection?.connectionId ?? null;\r\n\t}\r\n\r\n\t#setupConnection(url: string, token: string, methods: string[]) {\r\n\t\tthis.#connection = new signalR.HubConnectionBuilder()\r\n\t\t\t.withUrl(url, { accessTokenFactory: () => token })\r\n\t\t\t.configureLogging(signalR.LogLevel.None)\r\n\t\t\t.build();\r\n\r\n\t\tfor (let i = 0; i < methods.length; i++) {\r\n\t\t\tthis.#connection.on(methods[i], (message: ProcessingMessage) => {\r\n\t\t\t\tconsole.debug('message received:', methods[i], message);\r\n\r\n\t\t\t\tthis.#messages.appendOne({\r\n\t\t\t\t\tmethod: methods[i],\r\n\t\t\t\t\tmessage: message,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.#connection.start().then(() => {\r\n\t\t\tconsole.debug('signalr connection started');\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default ProcessingSignalRContext;\r\n\r\nexport const JUMOO_PROCESSING_SIGNALR_CONTEXT =\r\n\tnew UmbContextToken<ProcessingSignalRContext>('JumooProcessingSignalRContext');\r\n","// This file is auto-generated by @hey-api/openapi-ts\n\nexport enum EventMessageTypeModel {\n    DEFAULT = 'Default',\n    INFO = 'Info',\n    ERROR = 'Error',\n    SUCCESS = 'Success',\n    WARNING = 'Warning'\n}\n\nexport type NotificationHeaderModel = {\n    message: string;\n    category: string;\n    type: EventMessageTypeModel;\n};\n\nexport type PagedModelQueuedItemModel = {\n    items: Array<QueuedItem>;\n    total: number;\n};\n\nexport type Pipeline = {\n    id: string;\n    alias: string;\n    strategy: string;\n    state: PipelineState;\n    options: ProcessingOptions;\n    results?: ProcessingResults | null;\n};\n\nexport type PipelineBackgroundState = {\n    isBackgroundRequest: boolean;\n    backgroundElement?: string | null;\n    completedElement?: string | null;\n    failedElement?: string | null;\n};\n\nexport type PipelineCreateRequest = {\n    alias: string;\n    strategy: string;\n    options?: ProcessingOptions | null;\n    clientId?: string | null;\n};\n\nexport type PipelineState = {\n    status: PipelineStatus;\n    childPipeline?: string | null;\n    elementName?: string | null;\n    currentRequest?: ProcessingRequest | null;\n    progress: ProgressInformation;\n    schedule?: string | null;\n    backgroundState?: PipelineBackgroundState | null;\n    isChildPipeline: boolean;\n};\n\nexport enum PipelineStatus {\n    NOT_STARTED = 'NotStarted',\n    RUNNING = 'Running',\n    BACKGROUND = 'Background',\n    WAITING = 'Waiting',\n    SCHEDULED = 'Scheduled',\n    COMPLETED = 'Completed',\n    FAILED = 'Failed'\n}\n\nexport type ProblemDetails = {\n    type?: string | null;\n    title?: string | null;\n    status?: number | null;\n    detail?: string | null;\n    instance?: string | null;\n    [key: string]: unknown | (string | null) | (string | null) | (number | null) | (string | null) | (string | null) | undefined;\n};\n\nexport type ProcessingChildRequestAction = {\n    alias: string;\n    stepAlias?: string | null;\n    page: number;\n    pageSize: number;\n    subStep?: string | null;\n    element?: string | null;\n    waitOnAction: boolean;\n    strategy: string;\n    processor: string;\n    options?: ProcessingOptions | null;\n};\n\nexport type ProcessingErrorDetails = {\n    source: string;\n    strategy: string;\n    message: string;\n    action: string;\n    step?: string | null;\n    page: number;\n    subStep?: string | null;\n    key: string;\n    className?: string | null;\n    methodName?: string | null;\n    stackTrace?: string | null;\n};\n\nexport type ProcessingOptions = {\n    [key: string]: unknown;\n};\n\nexport type ProcessingOptionsResults = {\n    options?: ProcessingOptions | null;\n};\n\nexport type ProcessingRequest = {\n    id: string;\n    clientId?: string | null;\n    isBackgroundRequest: boolean;\n    strategy: string;\n    action?: ProcessingChildRequestAction | ProcessingRequestAction | null;\n    user?: string | null;\n    title?: string | null;\n    source?: string | null;\n    options: {\n        [key: string]: unknown;\n    };\n};\n\nexport type ProcessingRequestAction = {\n    alias: string;\n    stepAlias?: string | null;\n    page: number;\n    pageSize: number;\n    subStep?: string | null;\n    element?: string | null;\n    waitOnAction: boolean;\n};\n\nexport type ProcessingResults = {\n    results: {\n        [key: string]: unknown;\n    };\n    error?: ProcessingErrorDetails | null;\n};\n\nexport type ProgressInformation = {\n    isLastAction: boolean;\n    steps: Array<StepInfo>;\n    progress: number;\n};\n\nexport type QueuedItem = {\n    id: number;\n    key: string;\n    immediate: boolean;\n    processor: string;\n    strategy: string;\n    submitted: string;\n    scheduled: string;\n    priority: number;\n    data?: string | null;\n    attempts: number;\n    userKey?: string | null;\n    userName?: string | null;\n    clientId?: string | null;\n    note?: string | null;\n};\n\nexport type StepInfo = {\n    icon: string;\n    name: string;\n    status: StepStatus;\n};\n\nexport enum StepStatus {\n    NONE = 'None',\n    RUNNING = 'Running',\n    COMPLETE = 'Complete',\n    ERROR = 'Error'\n}\n\nexport type ClearPipelineData = {\n    body?: never;\n    path: {\n        id: string;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/ClearPipeline/{id}';\n};\n\nexport type ClearPipelineErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n};\n\nexport type ClearPipelineError = ClearPipelineErrors[keyof ClearPipelineErrors];\n\nexport type ClearPipelineResponses = {\n    /**\n     * OK\n     */\n    200: unknown;\n};\n\nexport type CreatePipelineData = {\n    body?: PipelineCreateRequest;\n    path?: never;\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/CreatePipeline';\n};\n\nexport type CreatePipelineErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type CreatePipelineError = CreatePipelineErrors[keyof CreatePipelineErrors];\n\nexport type CreatePipelineResponses = {\n    /**\n     * OK\n     */\n    200: string;\n};\n\nexport type CreatePipelineResponse = CreatePipelineResponses[keyof CreatePipelineResponses];\n\nexport type GetPipelineData = {\n    body?: never;\n    path: {\n        id: string;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/GetPipeline/{id}';\n};\n\nexport type GetPipelineErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type GetPipelineError = GetPipelineErrors[keyof GetPipelineErrors];\n\nexport type GetPipelineResponses = {\n    /**\n     * OK\n     */\n    200: Pipeline;\n};\n\nexport type GetPipelineResponse = GetPipelineResponses[keyof GetPipelineResponses];\n\nexport type GetProcessorsData = {\n    body?: never;\n    path?: never;\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/GetProcessors';\n};\n\nexport type GetProcessorsErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n};\n\nexport type GetProcessorsError = GetProcessorsErrors[keyof GetProcessorsErrors];\n\nexport type GetProcessorsResponses = {\n    /**\n     * OK\n     */\n    200: Array<string>;\n};\n\nexport type GetProcessorsResponse = GetProcessorsResponses[keyof GetProcessorsResponses];\n\nexport type GetResultsData = {\n    body?: never;\n    path: {\n        id: string;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/GetResults/{id}';\n};\n\nexport type GetResultsErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n};\n\nexport type GetResultsError = GetResultsErrors[keyof GetResultsErrors];\n\nexport type GetResultsResponses = {\n    /**\n     * OK\n     */\n    200: ProcessingResults;\n};\n\nexport type GetResultsResponse = GetResultsResponses[keyof GetResultsResponses];\n\nexport type ListPipelinesData = {\n    body?: never;\n    path: {\n        status: PipelineStatus;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/ListPipelines/{status}';\n};\n\nexport type ListPipelinesErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type ListPipelinesError = ListPipelinesErrors[keyof ListPipelinesErrors];\n\nexport type ListPipelinesResponses = {\n    /**\n     * OK\n     */\n    200: Array<Pipeline>;\n};\n\nexport type ListPipelinesResponse = ListPipelinesResponses[keyof ListPipelinesResponses];\n\nexport type ListPipelinesByStrategyData = {\n    body?: never;\n    path: {\n        strategy: string;\n        status: PipelineStatus;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/ListPipelinesByStrategy/{strategy}/{status}';\n};\n\nexport type ListPipelinesByStrategyErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type ListPipelinesByStrategyError = ListPipelinesByStrategyErrors[keyof ListPipelinesByStrategyErrors];\n\nexport type ListPipelinesByStrategyResponses = {\n    /**\n     * OK\n     */\n    200: Array<Pipeline>;\n};\n\nexport type ListPipelinesByStrategyResponse = ListPipelinesByStrategyResponses[keyof ListPipelinesByStrategyResponses];\n\nexport type ProcessPipelineData = {\n    body?: never;\n    path: {\n        id: string;\n    };\n    query?: {\n        clientId?: string;\n    };\n    url: '/umbraco/jumoo/api/v1/processing/ProcessPipeline/{id}';\n};\n\nexport type ProcessPipelineErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n};\n\nexport type ProcessPipelineError = ProcessPipelineErrors[keyof ProcessPipelineErrors];\n\nexport type ProcessPipelineResponses = {\n    /**\n     * OK\n     */\n    200: Pipeline;\n};\n\nexport type ProcessPipelineResponse = ProcessPipelineResponses[keyof ProcessPipelineResponses];\n\nexport type UpdatePipelineData = {\n    body?: ProcessingOptions;\n    path: {\n        id: string;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/UpdatePipeline/{id}';\n};\n\nexport type UpdatePipelineErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n};\n\nexport type UpdatePipelineError = UpdatePipelineErrors[keyof UpdatePipelineErrors];\n\nexport type UpdatePipelineResponses = {\n    /**\n     * OK\n     */\n    200: ProcessingOptionsResults;\n};\n\nexport type UpdatePipelineResponse = UpdatePipelineResponses[keyof UpdatePipelineResponses];\n\nexport type DeleteData = {\n    body?: never;\n    path: {\n        key: string;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/DeleteQueue/{key}';\n};\n\nexport type DeleteErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type DeleteError = DeleteErrors[keyof DeleteErrors];\n\nexport type DeleteResponses = {\n    /**\n     * OK\n     */\n    200: unknown;\n};\n\nexport type ListQueueData = {\n    body?: never;\n    path?: never;\n    query?: {\n        page?: number;\n    };\n    url: '/umbraco/jumoo/api/v1/processing/ListQueue';\n};\n\nexport type ListQueueErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type ListQueueError = ListQueueErrors[keyof ListQueueErrors];\n\nexport type ListQueueResponses = {\n    /**\n     * OK\n     */\n    200: PagedModelQueuedItemModel;\n};\n\nexport type ListQueueResponse = ListQueueResponses[keyof ListQueueResponses];\n\nexport type PeekItemData = {\n    body?: never;\n    path?: never;\n    query?: {\n        key?: string;\n    };\n    url: '/umbraco/jumoo/api/v1/processing/PeekItem';\n};\n\nexport type PeekItemErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type PeekItemError = PeekItemErrors[keyof PeekItemErrors];\n\nexport type PeekItemResponses = {\n    /**\n     * OK\n     */\n    200: PagedModelQueuedItemModel;\n};\n\nexport type PeekItemResponse = PeekItemResponses[keyof PeekItemResponses];\n\nexport type ProcessData = {\n    body?: never;\n    path: {\n        key: string;\n    };\n    query?: never;\n    url: '/umbraco/jumoo/api/v1/processing/ProcessQueue/{key}';\n};\n\nexport type ProcessErrors = {\n    /**\n     * Bad Request\n     */\n    400: ProblemDetails;\n    /**\n     * Not Found\n     */\n    404: unknown;\n};\n\nexport type ProcessError = ProcessErrors[keyof ProcessErrors];\n\nexport type ProcessResponses = {\n    /**\n     * OK\n     */\n    200: QueuedItem;\n};\n\nexport type ProcessResponse = ProcessResponses[keyof ProcessResponses];\n\nexport type ClientOptions = {\n    baseUrl: 'http://localhost:63435' | (string & {});\n};","var A=async(t,r)=>{let e=typeof r==\"function\"?await r(t):r;if(e)return t.scheme===\"bearer\"?`Bearer ${e}`:t.scheme===\"basic\"?`Basic ${btoa(e)}`:e},z=(t,r,e)=>{typeof e==\"string\"||e instanceof Blob?t.append(r,e):t.append(r,JSON.stringify(e));},j=(t,r,e)=>{typeof e==\"string\"?t.append(r,e):t.append(r,JSON.stringify(e));},v={bodySerializer:t=>{let r=new FormData;return Object.entries(t).forEach(([e,a])=>{a!=null&&(Array.isArray(a)?a.forEach(i=>z(r,e,i)):z(r,e,a));}),r}},R={bodySerializer:t=>JSON.stringify(t,(r,e)=>typeof e==\"bigint\"?e.toString():e)},$={bodySerializer:t=>{let r=new URLSearchParams;return Object.entries(t).forEach(([e,a])=>{a!=null&&(Array.isArray(a)?a.forEach(i=>j(r,e,i)):j(r,e,a));}),r.toString()}},U=t=>{switch(t){case \"label\":return \".\";case \"matrix\":return \";\";case \"simple\":return \",\";default:return \"&\"}},_=t=>{switch(t){case \"form\":return \",\";case \"pipeDelimited\":return \"|\";case \"spaceDelimited\":return \"%20\";default:return \",\"}},D=t=>{switch(t){case \"label\":return \".\";case \"matrix\":return \";\";case \"simple\":return \",\";default:return \"&\"}},O=({allowReserved:t,explode:r,name:e,style:a,value:i})=>{if(!r){let s=(t?i:i.map(l=>encodeURIComponent(l))).join(_(a));switch(a){case \"label\":return `.${s}`;case \"matrix\":return `;${e}=${s}`;case \"simple\":return s;default:return `${e}=${s}`}}let o=U(a),n=i.map(s=>a===\"label\"||a===\"simple\"?t?s:encodeURIComponent(s):y({allowReserved:t,name:e,value:s})).join(o);return a===\"label\"||a===\"matrix\"?o+n:n},y=({allowReserved:t,name:r,value:e})=>{if(e==null)return \"\";if(typeof e==\"object\")throw new Error(\"Deeply-nested arrays/objects aren\\u2019t supported. Provide your own `querySerializer()` to handle these.\");return `${r}=${t?e:encodeURIComponent(e)}`},q=({allowReserved:t,explode:r,name:e,style:a,value:i})=>{if(i instanceof Date)return `${e}=${i.toISOString()}`;if(a!==\"deepObject\"&&!r){let s=[];Object.entries(i).forEach(([f,u])=>{s=[...s,f,t?u:encodeURIComponent(u)];});let l=s.join(\",\");switch(a){case \"form\":return `${e}=${l}`;case \"label\":return `.${l}`;case \"matrix\":return `;${e}=${l}`;default:return l}}let o=D(a),n=Object.entries(i).map(([s,l])=>y({allowReserved:t,name:a===\"deepObject\"?`${e}[${s}]`:s,value:l})).join(o);return a===\"label\"||a===\"matrix\"?o+n:n};var H=/\\{[^{}]+\\}/g,B=({path:t,url:r})=>{let e=r,a=r.match(H);if(a)for(let i of a){let o=false,n=i.substring(1,i.length-1),s=\"simple\";n.endsWith(\"*\")&&(o=true,n=n.substring(0,n.length-1)),n.startsWith(\".\")?(n=n.substring(1),s=\"label\"):n.startsWith(\";\")&&(n=n.substring(1),s=\"matrix\");let l=t[n];if(l==null)continue;if(Array.isArray(l)){e=e.replace(i,O({explode:o,name:n,style:s,value:l}));continue}if(typeof l==\"object\"){e=e.replace(i,q({explode:o,name:n,style:s,value:l}));continue}if(s===\"matrix\"){e=e.replace(i,`;${y({name:n,value:l})}`);continue}let f=encodeURIComponent(s===\"label\"?`.${l}`:l);e=e.replace(i,f);}return e},E=({allowReserved:t,array:r,object:e}={})=>i=>{let o=[];if(i&&typeof i==\"object\")for(let n in i){let s=i[n];if(s!=null){if(Array.isArray(s)){o=[...o,O({allowReserved:t,explode:true,name:n,style:\"form\",value:s,...r})];continue}if(typeof s==\"object\"){o=[...o,q({allowReserved:t,explode:true,name:n,style:\"deepObject\",value:s,...e})];continue}o=[...o,y({allowReserved:t,name:n,value:s})];}}return o.join(\"&\")},P=t=>{if(!t)return \"stream\";let r=t.split(\";\")[0]?.trim();if(r){if(r.startsWith(\"application/json\")||r.endsWith(\"+json\"))return \"json\";if(r===\"multipart/form-data\")return \"formData\";if([\"application/\",\"audio/\",\"image/\",\"video/\"].some(e=>r.startsWith(e)))return \"blob\";if(r.startsWith(\"text/\"))return \"text\"}},I=async({security:t,...r})=>{for(let e of t){let a=await A(e,r.auth);if(!a)continue;let i=e.name??\"Authorization\";switch(e.in){case \"query\":r.query||(r.query={}),r.query[i]=a;break;case \"cookie\":r.headers.append(\"Cookie\",`${i}=${a}`);break;case \"header\":default:r.headers.set(i,a);break}return}},S=t=>W({baseUrl:t.baseUrl,path:t.path,query:t.query,querySerializer:typeof t.querySerializer==\"function\"?t.querySerializer:E(t.querySerializer),url:t.url}),W=({baseUrl:t,path:r,query:e,querySerializer:a,url:i})=>{let o=i.startsWith(\"/\")?i:`/${i}`,n=(t??\"\")+o;r&&(n=B({path:r,url:n}));let s=e?a(e):\"\";return s.startsWith(\"?\")&&(s=s.substring(1)),s&&(n+=`?${s}`),n},C=(t,r)=>{let e={...t,...r};return e.baseUrl?.endsWith(\"/\")&&(e.baseUrl=e.baseUrl.substring(0,e.baseUrl.length-1)),e.headers=x(t.headers,r.headers),e},x=(...t)=>{let r=new Headers;for(let e of t){if(!e||typeof e!=\"object\")continue;let a=e instanceof Headers?e.entries():Object.entries(e);for(let[i,o]of a)if(o===null)r.delete(i);else if(Array.isArray(o))for(let n of o)r.append(i,n);else o!==undefined&&r.set(i,typeof o==\"object\"?JSON.stringify(o):o);}return r},h=class{_fns;constructor(){this._fns=[];}clear(){this._fns=[];}exists(r){return this._fns.indexOf(r)!==-1}eject(r){let e=this._fns.indexOf(r);e!==-1&&(this._fns=[...this._fns.slice(0,e),...this._fns.slice(e+1)]);}use(r){this._fns=[...this._fns,r];}},T=()=>({error:new h,request:new h,response:new h}),N=E({allowReserved:false,array:{explode:true,style:\"form\"},object:{explode:true,style:\"deepObject\"}}),Q={\"Content-Type\":\"application/json\"},w=(t={})=>({...R,headers:Q,parseAs:\"auto\",querySerializer:N,...t});var J=(t={})=>{let r=C(w(),t),e=()=>({...r}),a=n=>(r=C(r,n),e()),i=T(),o=async n=>{let s={...r,...n,fetch:n.fetch??r.fetch??globalThis.fetch,headers:x(r.headers,n.headers)};s.security&&await I({...s,security:s.security}),s.body&&s.bodySerializer&&(s.body=s.bodySerializer(s.body)),(s.body===undefined||s.body===\"\")&&s.headers.delete(\"Content-Type\");let l=S(s),f={redirect:\"follow\",...s},u=new Request(l,f);for(let p of i.request._fns)u=await p(u,s);let k=s.fetch,c=await k(u);for(let p of i.response._fns)c=await p(c,u,s);let m={request:u,response:c};if(c.ok){if(c.status===204||c.headers.get(\"Content-Length\")===\"0\")return {data:{},...m};let p=(s.parseAs===\"auto\"?P(c.headers.get(\"Content-Type\")):s.parseAs)??\"json\";if(p===\"stream\")return {data:c.body,...m};let b=await c[p]();return p===\"json\"&&(s.responseValidator&&await s.responseValidator(b),s.responseTransformer&&(b=await s.responseTransformer(b))),{data:b,...m}}let g=await c.text();try{g=JSON.parse(g);}catch{}let d=g;for(let p of i.error._fns)d=await p(g,c,u,s);if(d=d||{},s.throwOnError)throw d;return {error:d,...m}};return {buildUrl:S,connect:n=>o({...n,method:\"CONNECT\"}),delete:n=>o({...n,method:\"DELETE\"}),get:n=>o({...n,method:\"GET\"}),getConfig:e,head:n=>o({...n,method:\"HEAD\"}),interceptors:i,options:n=>o({...n,method:\"OPTIONS\"}),patch:n=>o({...n,method:\"PATCH\"}),post:n=>o({...n,method:\"POST\"}),put:n=>o({...n,method:\"PUT\"}),request:o,setConfig:a,trace:n=>o({...n,method:\"TRACE\"})}};export{J as createClient,w as createConfig,v as formDataBodySerializer,R as jsonBodySerializer,$ as urlSearchParamsBodySerializer};//# sourceMappingURL=index.js.map\n//# sourceMappingURL=index.js.map","// This file is auto-generated by @hey-api/openapi-ts\n\nimport type { ClientOptions } from './types.gen';\nimport { type Config, type ClientOptions as DefaultClientOptions, createClient, createConfig } from '@hey-api/client-fetch';\n\n/**\n * The `createClientConfig()` function will be called on client initialization\n * and the returned object will become the client's initial configuration.\n *\n * You may want to initialize your client this way instead of calling\n * `setConfig()`. This is useful for example if you're using Next.js\n * to ensure your client always has the correct values.\n */\nexport type CreateClientConfig<T extends DefaultClientOptions = ClientOptions> = (override?: Config<DefaultClientOptions & T>) => Config<Required<DefaultClientOptions> & T>;\n\nexport const client = createClient(createConfig<ClientOptions>({\n    baseUrl: 'http://localhost:63435'\n}));","// This file is auto-generated by @hey-api/openapi-ts\n\nimport type { Options as ClientOptions, TDataShape, Client } from '@hey-api/client-fetch';\nimport type { ClearPipelineData, ClearPipelineError, CreatePipelineData, CreatePipelineResponse, CreatePipelineError, GetPipelineData, GetPipelineResponse, GetPipelineError, GetProcessorsData, GetProcessorsResponse, GetProcessorsError, GetResultsData, GetResultsResponse, GetResultsError, ListPipelinesData, ListPipelinesResponse, ListPipelinesError, ListPipelinesByStrategyData, ListPipelinesByStrategyResponse, ListPipelinesByStrategyError, ProcessPipelineData, ProcessPipelineResponse, ProcessPipelineError, UpdatePipelineData, UpdatePipelineResponse, UpdatePipelineError, DeleteData, DeleteError, ListQueueData, ListQueueResponse, ListQueueError, PeekItemData, PeekItemResponse, PeekItemError, ProcessData, ProcessResponse, ProcessError } from './types.gen';\nimport { client as _heyApiClient } from './client.gen';\n\nexport type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n    /**\n     * You can provide a client instance returned by `createClient()` instead of\n     * individual options. This might be also useful if you want to implement a\n     * custom client.\n     */\n    client?: Client;\n    /**\n     * You can pass arbitrary values through the `meta` object. This can be\n     * used to access values that aren't defined as part of the SDK function.\n     */\n    meta?: Record<string, unknown>;\n};\n\nexport class PipelinesService {\n    public static clearPipeline<ThrowOnError extends boolean = false>(options: Options<ClearPipelineData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).post<unknown, ClearPipelineError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/ClearPipeline/{id}',\n            ...options\n        });\n    }\n    \n    public static createPipeline<ThrowOnError extends boolean = false>(options?: Options<CreatePipelineData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).post<CreatePipelineResponse, CreatePipelineError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/CreatePipeline',\n            ...options,\n            headers: {\n                'Content-Type': 'application/json',\n                ...options?.headers\n            }\n        });\n    }\n    \n    public static getPipeline<ThrowOnError extends boolean = false>(options: Options<GetPipelineData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).get<GetPipelineResponse, GetPipelineError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/GetPipeline/{id}',\n            ...options\n        });\n    }\n    \n    public static getProcessors<ThrowOnError extends boolean = false>(options?: Options<GetProcessorsData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<GetProcessorsResponse, GetProcessorsError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/GetProcessors',\n            ...options\n        });\n    }\n    \n    public static getResults<ThrowOnError extends boolean = false>(options: Options<GetResultsData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).get<GetResultsResponse, GetResultsError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/GetResults/{id}',\n            ...options\n        });\n    }\n    \n    public static listPipelines<ThrowOnError extends boolean = false>(options: Options<ListPipelinesData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).get<ListPipelinesResponse, ListPipelinesError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/ListPipelines/{status}',\n            ...options\n        });\n    }\n    \n    public static listPipelinesByStrategy<ThrowOnError extends boolean = false>(options: Options<ListPipelinesByStrategyData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).get<ListPipelinesByStrategyResponse, ListPipelinesByStrategyError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/ListPipelinesByStrategy/{strategy}/{status}',\n            ...options\n        });\n    }\n    \n    public static processPipeline<ThrowOnError extends boolean = false>(options: Options<ProcessPipelineData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).post<ProcessPipelineResponse, ProcessPipelineError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/ProcessPipeline/{id}',\n            ...options\n        });\n    }\n    \n    public static updatePipeline<ThrowOnError extends boolean = false>(options: Options<UpdatePipelineData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).post<UpdatePipelineResponse, UpdatePipelineError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/UpdatePipeline/{id}',\n            ...options,\n            headers: {\n                'Content-Type': 'application/json',\n                ...options?.headers\n            }\n        });\n    }\n    \n}\n\nexport class QueuesService {\n    public static delete<ThrowOnError extends boolean = false>(options: Options<DeleteData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).delete<unknown, DeleteError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/DeleteQueue/{key}',\n            ...options\n        });\n    }\n    \n    public static listQueue<ThrowOnError extends boolean = false>(options?: Options<ListQueueData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<ListQueueResponse, ListQueueError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/ListQueue',\n            ...options\n        });\n    }\n    \n    /**\n     * Peek an item from the queue\n     */\n    public static peekItem<ThrowOnError extends boolean = false>(options?: Options<PeekItemData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<PeekItemResponse, PeekItemError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/PeekItem',\n            ...options\n        });\n    }\n    \n    /**\n     * Takes an item off the queue, removes the schedule date and puts it back\n     */\n    public static process<ThrowOnError extends boolean = false>(options: Options<ProcessData, ThrowOnError>) {\n        return (options.client ?? _heyApiClient).post<ProcessResponse, ProcessError, ThrowOnError>({\n            url: '/umbraco/jumoo/api/v1/processing/ProcessQueue/{key}',\n            ...options\n        });\n    }\n    \n}","const errorModal: UmbExtensionManifest = {\r\n\ttype: 'modal',\r\n\talias: 'jumoo-processing-error-modal',\r\n\tname: 'processing-error-modal',\r\n\tjs: () => import('./error-modal.element.js'),\r\n};\r\n\r\nexport const manifests = [errorModal];\r\n","import { manifests as errorModals } from './errors/manifest.js';\r\n\r\nconst processingModal: UmbExtensionManifest = {\r\n\ttype: 'modal',\r\n\talias: 'jumoo-processing-modal',\r\n\tname: 'processing-modal',\r\n\tjs: () => import('./pipeline-modal.element.js'),\r\n};\r\n\r\nexport const manifests = [processingModal, ...errorModals];\r\n","import {\r\n\tJUMOO_PROCESSING_PIPELINE_ENTITY_TYPE,\r\n\tJUMOO_PROCESSING_PIPELINE_WORKSPACE_ALIAS,\r\n} from './types.js';\r\n\r\nconst workspace: UmbExtensionManifest = {\r\n\ttype: 'workspace',\r\n\tkind: 'routable',\r\n\talias: JUMOO_PROCESSING_PIPELINE_WORKSPACE_ALIAS,\r\n\tname: 'Processing pipeline workspace',\r\n\tapi: () => import('./pipeline-workspace.context.js'),\r\n\tmeta: {\r\n\t\tentityType: JUMOO_PROCESSING_PIPELINE_ENTITY_TYPE,\r\n\t},\r\n};\r\n\r\nconst viewConditions = [\r\n\t{\r\n\t\talias: 'Umb.Condition.WorkspaceAlias',\r\n\t\tmatch: JUMOO_PROCESSING_PIPELINE_WORKSPACE_ALIAS,\r\n\t},\r\n];\r\n\r\nconst views: UmbExtensionManifest[] = [\r\n\t{\r\n\t\ttype: 'workspaceView',\r\n\t\talias: 'jumoo-processing-pipeline-workspace-default-view',\r\n\t\tname: 'Processing pipeline workspace default view',\r\n\t\tjs: () => import('./views/default-pipeline-view.js'),\r\n\t\tweight: 300,\r\n\t\tmeta: {\r\n\t\t\tlabel: 'Pipeline',\r\n\t\t\tpathname: 'pipeline',\r\n\t\t\ticon: 'icon-stack',\r\n\t\t},\r\n\t\tconditions: viewConditions,\r\n\t},\r\n];\r\n\r\nexport const manifests = [workspace, ...views];\r\n","const localizations: UmbExtensionManifest[] = [\r\n\t{\r\n\t\ttype: 'localization',\r\n\t\talias: 'jumoo.pipeline.localization.en',\r\n\t\tname: 'Pipeline translations(en)',\r\n\t\tweight: 0,\r\n\t\tmeta: { culture: 'en' },\r\n\t\tjs: () => import('./files/en.js'),\r\n\t},\r\n];\r\n\r\nexport const manifests: UmbExtensionManifest[] = [...localizations];\r\n","export const ProcessingTimeOptions: Intl.DateTimeFormatOptions = {\r\n\tyear: 'numeric',\r\n\tmonth: 'short',\r\n\tday: 'numeric',\r\n\thour: 'numeric',\r\n\tminute: 'numeric',\r\n\tsecond: 'numeric',\r\n};\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { QueuesService } from '../api';\r\n\r\nexport class QueueRepository extends UmbControllerBase {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t}\r\n\r\n\tpublic async list() {\r\n\t\treturn (await QueuesService.listQueue()).data;\r\n\t}\r\n\r\n\tpublic async peek(key: string) {\r\n\t\treturn (\r\n\t\t\tawait QueuesService.peekItem({\r\n\t\t\t\tquery: {\r\n\t\t\t\t\tkey: key,\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t).data;\r\n\t}\r\n\r\n\tpublic async delete(key: string) {\r\n\t\treturn (\r\n\t\t\tawait QueuesService.delete({\r\n\t\t\t\tpath: {\r\n\t\t\t\t\tkey: key,\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t).data;\r\n\t}\r\n\r\n\tpublic async process(key: string) {\r\n\t\treturn (\r\n\t\t\tawait QueuesService.process({\r\n\t\t\t\tpath: {\r\n\t\t\t\t\tkey: key,\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t).data;\r\n\t}\r\n}\r\n\r\nexport default QueueRepository;\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport QueueRepository from './queue.repository';\r\nimport { UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { PagedModelQueuedItemModel } from '../api';\r\n\r\nexport class QueueContext extends UmbControllerBase {\r\n\treadonly #repository: QueueRepository;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#repository = new QueueRepository(host);\r\n\t}\r\n\r\n\t#queue = new UmbObjectState<PagedModelQueuedItemModel | undefined>(undefined);\r\n\tpublic readonly queue = this.#queue.asObservable();\r\n\r\n\tpublic async loadQueue() {\r\n\t\tvar queue = await this.#repository.list();\r\n\t\tthis.#queue.setValue(queue);\r\n\t\treturn queue;\r\n\t}\r\n\r\n\tpublic async process(key: string) {\r\n\t\tawait this.#repository.process(key);\r\n\t\tawait this.loadQueue();\r\n\t}\r\n}\r\n\r\nexport default QueueContext;\r\n\r\nexport const JUMOO_QUEUE_CONTEXT = new UmbContextToken<QueueContext>(\r\n\t'JUMOO_QUEUE_CONTEXT',\r\n);\r\n","import {\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tproperty,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { QueuedItem } from '../../api';\r\nimport { UmbTableConfig } from '@umbraco-cms/backoffice/components';\r\nimport { ProcessingTimeOptions } from '../../constants';\r\n\r\n@customElement('jumoo-queue-table')\r\nexport class JumooQueueTableElement extends UmbLitElement {\r\n\t@property({ type: Array })\r\n\titems?: QueuedItem[];\r\n\r\n\t@property({ type: Boolean })\r\n\tshowViewDetails: boolean = true;\r\n\r\n\t@property({ type: Boolean })\r\n\thideProcess: boolean = false;\r\n\r\n\t@property({ type: Object })\r\n\ttableConfig: UmbTableConfig = {\r\n\t\tallowSelection: false,\r\n\t\thideIcon: false,\r\n\t};\r\n\r\n\t@property({ type: Array })\r\n\ttableColumns = [\r\n\t\t// { name: 'Key', alias: 'key' },\r\n\t\t{ name: 'Note', alias: 'note' },\r\n\t\t{ name: 'Processor', alias: 'processor' },\r\n\t\t{ name: 'Strategy', alias: 'strategy' },\r\n\t\t{ name: 'User', alias: 'user' },\r\n\t\t{ name: 'Submitted', alias: 'submitted' },\r\n\t\t{ name: 'Scheduled', alias: 'scheduled' },\r\n\t\t{ name: 'Attempts', alias: 'attempts' },\r\n\t\t{ name: 'Priority', alias: 'priority' },\r\n\t\t{ name: 'Actions', alias: 'actions' },\r\n\t];\r\n\r\n\t@state()\r\n\tfilter: any;\r\n\r\n\trender() {\r\n\t\tif (!this.items) return nothing;\r\n\r\n\t\tconst items = this.items\r\n\t\t\t.map((item: QueuedItem) => {\r\n\t\t\t\tif (!item) return undefined;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: item.key,\r\n\t\t\t\t\ticon: 'icon-layers',\r\n\t\t\t\t\tdata: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'key',\r\n\t\t\t\t\t\t\tvalue: item.key,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'priority',\r\n\t\t\t\t\t\t\tvalue: item.priority,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'processor',\r\n\t\t\t\t\t\t\tvalue: item.processor,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'strategy',\r\n\t\t\t\t\t\t\tvalue: item.strategy,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'submitted',\r\n\t\t\t\t\t\t\tvalue: this.localize.date(item.submitted, ProcessingTimeOptions),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'scheduled',\r\n\t\t\t\t\t\t\tvalue: !item.scheduled\r\n\t\t\t\t\t\t\t\t? ''\r\n\t\t\t\t\t\t\t\t: this.localize.date(item.scheduled, ProcessingTimeOptions),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'attempts',\r\n\t\t\t\t\t\t\tvalue: item.attempts,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'actions',\r\n\t\t\t\t\t\t\tvalue: html`${this.renderActions(item)}`,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'user',\r\n\t\t\t\t\t\t\tvalue: item.userName ?? '',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcolumnAlias: 'note',\r\n\t\t\t\t\t\t\tvalue: item.note,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.filter((item) => item !== undefined);\r\n\r\n\t\treturn html` <umb-table\r\n\t\t\t.items=${items}\r\n\t\t\t.config=${this.tableConfig}\r\n\t\t\t.columns=${this.tableColumns}\r\n\t\t\t.filter=${this.filter}></umb-table>`;\r\n\t}\r\n\r\n\trenderActions(item: QueuedItem) {\r\n\t\treturn html` <uui-button-group>\r\n\t\t\t${when(\r\n\t\t\t\tthis.showViewDetails,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml` <uui-button\r\n\t\t\t\t\t\tlabel=\"Details\"\r\n\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t@click=${() => this.#onViewDetails(item)}></uui-button>`,\r\n\t\t\t)}\r\n\t\t\t${when(\r\n\t\t\t\t!this.hideProcess,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml` <uui-button\r\n\t\t\t\t\t\tlabel=\"Process\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\t@click=${() => this.#onProcess(item)}></uui-button>`,\r\n\t\t\t)}\r\n\t\t</uui-button-group>`;\r\n\t}\r\n\r\n\t#onProcess(item: QueuedItem) {\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('process-queue-item', {\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tkey: item.key,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\t#onViewDetails(item: QueuedItem) {\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('view-queue-item', {\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tkey: item.key,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default JumooQueueTableElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-queue-table': JumooQueueTableElement;\r\n\t}\r\n}\r\n","import { PagedModelQueuedItemModel, QueueContext } from '@jumoo/processing';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tproperty,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('jumoo-queue-list')\r\nexport class JumooQueueListElement extends UmbLitElement {\r\n\tprotected readonly _queueContext: QueueContext;\r\n\r\n\t@property({ type: String })\r\n\theadline: string = 'Processing Queue';\r\n\r\n\t@state()\r\n\tqueue: PagedModelQueuedItemModel | undefined;\r\n\r\n\t@state()\r\n\tloading: boolean = true;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._queueContext = new QueueContext(this);\r\n\r\n\t\tthis.observe(this._queueContext.queue, (queue) => {\r\n\t\t\tthis.queue = queue;\r\n\t\t});\r\n\t}\r\n\r\n\tasync connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tawait this.onRefresh();\r\n\t}\r\n\r\n\tasync onRefresh() {\r\n\t\tthis.loading = true;\r\n\t\tawait this._queueContext.loadQueue();\r\n\t\tthis.loading = false;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`<uui-box style=\"--uui-box-default-padding: 0;\" .headline=${this.headline}>\r\n\t\t\t<div slot=\"header-actions\">\r\n\t\t\t\t<uui-button label=\"refresh\" @click=${this.onRefresh} compact\r\n\t\t\t\t\t><uui-icon name=\"icon-refresh\"></uui-icon\r\n\t\t\t\t></uui-button>\r\n\t\t\t</div>\r\n\t\t\t${when(\r\n\t\t\t\tthis.loading,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-loader-bar\r\n\t\t\t\t\t\tanimationDuration=\"1.5\"\r\n\t\t\t\t\t\tstyle=\"color: black\"></uui-loader-bar>`,\r\n\t\t\t\t() => this.renderTable(),\r\n\t\t\t)}\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderTable() {\r\n\t\treturn !this.queue || !this.queue.items.length\r\n\t\t\t? html`<div class=\"emtpy\">Nothing in the queue</div>`\r\n\t\t\t: html`<jumoo-queue-table\r\n\t\t\t\t\t.items=${this.queue.items}\r\n\t\t\t\t\t@process-queue-item=${this._onProcessQueueItem}></jumoo-queue-table>`;\r\n\t}\r\n\r\n\tprotected async _onProcessQueueItem(e: CustomEvent) {\r\n\t\tawait this._queueContext.process(e.detail.key);\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t.emtpy {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\tpadding: 20px;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default JumooQueueListElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'jumoo-queue-list': JumooQueueListElement;\r\n\t}\r\n}\r\n","import { UmbEntryPointOnInit } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\nimport './pipeline/index.js';\r\nimport './signalr/index.js';\r\nimport './pipeline/components/index.js';\r\nimport './external/signalr/index.js';\r\nimport './api/index.js';\r\n\r\nimport { manifests as modals } from './pipeline/modal/manifest.js';\r\nimport { manifests as pipelines } from './pipeline/workspace/manifest.js';\r\nimport { manifests as localizations } from './lang/manifest.js';\r\n\r\nimport { client } from './api/client.gen.js';\r\n\r\nexport * from './exports.js';\r\n\r\nexport const onInit: UmbEntryPointOnInit = (_host, extensions) => {\r\n\textensions.registerMany([...modals, ...pipelines, ...localizations]);\r\n\r\n\t_host.consumeContext(UMB_AUTH_CONTEXT, (_auth) => {\r\n\t\tif (!_auth) return;\r\n\r\n\t\tvar config = _auth.getOpenApiConfiguration();\r\n\r\n\t\tclient.setConfig({\r\n\t\t\tauth: config.token,\r\n\t\t\tbaseUrl: config.base,\r\n\t\t\tcredentials: config.credentials,\r\n\t\t});\r\n\r\n\t\tclient.interceptors.request.use(async (request, _options) => {\r\n\t\t\tconst token = await _auth.getLatestToken();\r\n\t\t\trequest.headers.set('Authorization', `Bearer ${token}`);\r\n\t\t\treturn request;\r\n\t\t});\r\n\t});\r\n};\r\n"],"names":["ProcessStepElement","ProcessStepElementBase","UmbLitElement","__decorateClass","property","JumooPipelineProgressElement","nothing","steps","step","className","StepStatus","icon","html","css","customElement","JumooPipelineBackgroundElement","PipelineStatus","element","ext","JumooProcessStepElement","UmbElementMixin","LitElement","_JumooProcessingErrorElement_instances","openErrorModal_fn","JumooProcessingErrorElement","__privateAdd","error","__privateMethod","modalManager","UMB_MODAL_MANAGER_CONTEXT","JUMOO_PROCESSING_ERROR_MODAL","_JumooPipelinesTableElement_instances","onViewPipeline_fn","onDeletePipeline_fn","JumooPipelinesTableElement","items","pipeline","when","ProcessingTimeOptions","item","e","id","state","JUMOO_PROCESSING_PIPELINE_WORKSPACE_ALIAS","JUMOO_PROCESSING_PIPELINE_ENTITY_TYPE","JUMOO_PIPELINE_WORKSPACE_MODAL","UmbModalToken","_pipelinesContext","_modalController","JumooProcessingPipelineList","JUMOO_PIPELINES_CONTEXT","context","__privateSet","UmbModalRouteRegistrationController","routeBuilder","__privateGet","options","status","JUMOO_PROCESSING_MODAL_ALIAS","JUMOO_PROCESSING_DIALOG_MODAL","JUMOO_PROCESSING_SIDEBAR_MODAL","JUMOO_PROCESSING_SIDEBAR_MEDIUM_MODAL","JUMOO_PROCESSING_SIDEBAR_LARGE_MODAL","JUMOO_PROCESSING_ERROR_MODAL_ALIAS","JumooPipelineElement","JUMOO_PROCESSING_CONTEXT","trigger","close","backgroundState","message","results","result","name","PipelineContext","UmbControllerBase","host","#pipeline","UmbObjectState","#state","#options","#results","#message","#backgroundState","#trigger","UmbBooleanState","#close","#finalized","#valid","#pending","#repository","PipelineRepository","#hubContext","ProcessingSignalRContext","UMB_AUTH_CONTEXT","auth","token","processor","strategy","clientId","response","value","valid","pending","UmbContextToken","PipelineSource","body","tryExecute","PipelinesService","PipelinesContext","HttpError","errorMessage","statusCode","trueProto","TimeoutError","AbortError","UnsupportedTransportError","transport","DisabledTransportError","FailedToStartTransportError","FailedToNegotiateWithServerError","AggregateErrors","innerErrors","HttpResponse","statusText","content","HttpClient","url","LogLevel","NullLogger","_logLevel","_message","VERSION","Arg","val","values","Platform","getDataDetail","data","includeContent","detail","isArrayBuffer","formatArrayBuffer","view","str","num","pad","sendMessage","logger","transportName","httpClient","headers","getUserAgentHeader","responseType","createLogger","ConsoleLogger","SubjectSubscription","subject","observer","index","_","minimumLogLevel","logLevel","msg","userAgentHeaderName","constructUserAgent","getOsName","getRuntime","getRuntimeVersion","version","os","runtime","runtimeVersion","userAgent","majorAndMinor","getErrorString","getGlobalThis","FetchHttpClient","requireFunc","request","abortController","timeoutId","msTimeout","deserializeContent","payload","cookies","c","XhrHttpClient","resolve","reject","xhr","header","DefaultHttpClient","TextMessageFormat","output","input","messages","HandshakeProtocol","handshakeRequest","messageData","remainingData","binaryData","separatorIndex","responseLength","textData","MessageType","Subject","err","MessageBuffer","protocol","connection","bufferSize","serializedMessage","backpressurePromise","backpressurePromiseResolver","backpressurePromiseRejector","BufferedItem","ackMessage","newestAckedMessage","currentId","sequenceId","resolver","rejector","DEFAULT_TIMEOUT_IN_MS","DEFAULT_PING_INTERVAL_IN_MS","DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE","HubConnectionState","HubConnection","reconnectPolicy","serverTimeoutInMilliseconds","keepAliveIntervalInMilliseconds","statefulReconnectBufferSize","handshakePromise","startPromise","methodName","args","streams","streamIds","invocationDescriptor","promiseQueue","cancelInvocation","invocationEvent","sendPromise","newMethod","method","handlers","removeIdx","callback","responseMessage","nextPing","invocationMessage","methods","methodsCopy","expectsResponse","res","exception","completionMessage","m","prevRes","reconnectStartTime","previousReconnectAttempts","retryError","nextRetryDelay","previousRetryCount","elapsedMilliseconds","retryReason","callbacks","key","nonblocking","invocationId","streamId","i","argument","arg","DEFAULT_RETRY_DELAYS_IN_MILLISECONDS","DefaultReconnectPolicy","retryDelays","retryContext","HeaderNames","AccessTokenHttpClient","innerClient","accessTokenFactory","allowRetry","HttpTransportType","TransferFormat","AbortController$1","LongPollingTransport","AbortController","transferFormat","pollOptions","pollUrl","deleteOptions","logMessage","ServerSentEventsTransport","accessToken","opened","eventSource","WebSocketTransport","logMessageContent","webSocketConstructor","webSocket","_event","event","MAX_REDIRECTS","HttpConnection","webSocketModule","eventSourceModule","TransportSendQueue","negotiateResponse","redirects","negotiateUrl","connectionToken","requestedTransport","requestedTransferFormat","connectUrl","transportExceptions","transports","negotiate","endpoint","transportOrError","ex","callStop","useStatefulReconnect","transportMatches","s","aTag","searchParams","actualTransport","_transport","PromiseSource","transportResult","arrayBuffers","totalLength","b","a","offset","reason","JSON_HUB_PROTOCOL_NAME","JsonHubProtocol","hubMessages","parsedMessage","LogLevelNameMapping","parseLogLevel","mapping","HubConnectionBuilder","logging","isLogger","transportTypeOrOptions","retryDelaysOrReconnectPolicy","milliseconds","httpConnectionOptions","JUMOO_PROCESSING_HUB_PATH","#messages","UmbArrayState","x","JUMOO_PROCESSING_SIGNALR_CONTEXT","#connection","#setupConnection","signalR.HubConnectionBuilder","signalR.LogLevel","EventMessageTypeModel","A","t","r","R","U","D","O","o","n","y","q","f","H","B","E","P","I","S","W","C","h","T","N","Q","w","J","p","k","g","d","client","createClient","createConfig","_heyApiClient","QueuesService","errorModal","manifests","processingModal","errorModals","workspace","viewConditions","views","localizations","QueueRepository","QueueContext","#queue","queue","JUMOO_QUEUE_CONTEXT","_JumooQueueTableElement_instances","onProcess_fn","onViewDetails_fn","JumooQueueTableElement","JumooQueueListElement","onInit","_host","extensions","modals","pipelines","_auth","config","_options"],"mappings":"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","x_google_ignoreList":[15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,42]}