(function(c,e){typeof define=="function"&&define.amd?define(e):typeof exports=="object"?module.exports=e():c.jsonLogic=e()})(this,function(){"use strict";Array.isArray||(Array.isArray=function(r){return Object.prototype.toString.call(r)==="[object Array]"});function c(r){for(var n=[],u=0,t=r.length;u<t;u++)n.indexOf(r[u])===-1&&n.push(r[u]);return n}var e={},s={"==":function(r,n){return r==n},"===":function(r,n){return r===n},"!=":function(r,n){return r!=n},"!==":function(r,n){return r!==n},">":function(r,n){return r>n},">=":function(r,n){return r>=n},"<":function(r,n,u){return u===void 0?r<n:r<n&&n<u},"<=":function(r,n,u){return u===void 0?r<=n:r<=n&&n<=u},"!!":function(r){return e.truthy(r)},"!":function(r){return!e.truthy(r)},"%":function(r,n){return r%n},log:function(r){return console.log(r),r},in:function(r,n){return!n||typeof n.indexOf>"u"?!1:n.indexOf(r)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(r,n,u){if(u<0){var t=String(r).substr(n);return t.substr(0,t.length+u)}return String(r).substr(n,u)},"+":function(){return Array.prototype.reduce.call(arguments,function(r,n){return parseFloat(r,10)+parseFloat(n,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(r,n){return parseFloat(r,10)*parseFloat(n,10)})},"-":function(r,n){return n===void 0?-r:r-n},"/":function(r,n){return r/n},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(r,n){return r.concat(n)},[])},var:function(r,n){var u=n===void 0?null:n,t=this;if(typeof r>"u"||r===""||r===null)return t;for(var i=String(r).split("."),o=0;o<i.length;o++)if(t==null||(t=t[i[o]],t===void 0))return u;return t},missing:function(){for(var r=[],n=Array.isArray(arguments[0])?arguments[0]:arguments,u=0;u<n.length;u++){var t=n[u],i=e.apply({var:t},this);(i===null||i==="")&&r.push(t)}return r},missing_some:function(r,n){var u=e.apply({missing:n},this);return n.length-u.length>=r?[]:u}};return e.is_logic=function(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Object.keys(r).length===1},e.truthy=function(r){return Array.isArray(r)&&r.length===0?!1:!!r},e.get_operator=function(r){return Object.keys(r)[0]},e.get_values=function(r){return r[e.get_operator(r)]},e.apply=function(r,n){if(Array.isArray(r))return r.map(function(l){return e.apply(l,n)});if(!e.is_logic(r))return r;var u=e.get_operator(r),t=r[u],i,o,a,f,g;if(Array.isArray(t)||(t=[t]),u==="if"||u=="?:"){for(i=0;i<t.length-1;i+=2)if(e.truthy(e.apply(t[i],n)))return e.apply(t[i+1],n);return t.length===i+1?e.apply(t[i],n):null}else if(u==="and"){for(i=0;i<t.length;i+=1)if(o=e.apply(t[i],n),!e.truthy(o))return o;return o}else if(u==="or"){for(i=0;i<t.length;i+=1)if(o=e.apply(t[i],n),e.truthy(o))return o;return o}else{if(u==="filter")return f=e.apply(t[0],n),a=t[1],Array.isArray(f)?f.filter(function(l){return e.truthy(e.apply(a,l))}):[];if(u==="map")return f=e.apply(t[0],n),a=t[1],Array.isArray(f)?f.map(function(l){return e.apply(a,l)}):[];if(u==="reduce")return f=e.apply(t[0],n),a=t[1],g=typeof t[2]<"u"?e.apply(t[2],n):null,Array.isArray(f)?f.reduce(function(l,h){return e.apply(a,{current:h,accumulator:l})},g):g;if(u==="all"){if(f=e.apply(t[0],n),a=t[1],!Array.isArray(f)||!f.length)return!1;for(i=0;i<f.length;i+=1)if(!e.truthy(e.apply(a,f[i])))return!1;return!0}else if(u==="none"){if(f=e.apply(t[0],n),a=t[1],!Array.isArray(f)||!f.length)return!0;for(i=0;i<f.length;i+=1)if(e.truthy(e.apply(a,f[i])))return!1;return!0}else if(u==="some"){if(f=e.apply(t[0],n),a=t[1],!Array.isArray(f)||!f.length)return!1;for(i=0;i<f.length;i+=1)if(e.truthy(e.apply(a,f[i])))return!0;return!1}}if(t=t.map(function(l){return e.apply(l,n)}),s.hasOwnProperty(u)&&typeof s[u]=="function")return s[u].apply(n,t);if(u.indexOf(".")>0){var y=String(u).split("."),p=s;for(i=0;i<y.length;i++){if(!p.hasOwnProperty(y[i]))throw new Error("Unrecognized operation "+u+" (failed at "+y.slice(0,i+1).join(".")+")");p=p[y[i]]}return p.apply(n,t)}throw new Error("Unrecognized operation "+u)},e.uses_data=function(r){var n=[];if(e.is_logic(r)){var u=e.get_operator(r),t=r[u];Array.isArray(t)||(t=[t]),u==="var"?n.push(t[0]):t.forEach(function(i){n.push.apply(n,e.uses_data(i))})}return c(n)},e.add_operation=function(r,n){s[r]=n},e.rm_operation=function(r){delete s[r]},e.rule_like=function(r,n){if(n===r||n==="@")return!0;if(n==="number")return typeof r=="number";if(n==="string")return typeof r=="string";if(n==="array")return Array.isArray(r)&&!e.is_logic(r);if(e.is_logic(n)){if(e.is_logic(r)){var u=e.get_operator(n),t=e.get_operator(r);if(u==="@"||u===t)return e.rule_like(e.get_values(r,!1),e.get_values(n,!1))}return!1}if(Array.isArray(n))if(Array.isArray(r)){if(n.length!==r.length)return!1;for(var i=0;i<n.length;i+=1)if(!e.rule_like(r[i],n[i]))return!1;return!0}else return!1;return!1},e});
