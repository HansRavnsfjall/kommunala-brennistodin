{"version":3,"file":"email-template-tree.repository.js","sources":["../src/section/email-templates/tree/email-template-tree.server.data-source.ts","../src/section/email-templates/tree/email-template-tree.repository.ts"],"sourcesContent":["import {\n  FORMS_EMAIL_TEMPLATE_ENTITY_TYPE,\n  FORMS_EMAIL_TEMPLATE_FOLDER_ENTITY_TYPE,\n  FORMS_EMAIL_TEMPLATE_ROOT_ENTITY_TYPE,\n} from \"../entity.js\";\nimport type { FormsEmailTemplateTreeItemModel } from \"./types.js\";\nimport { UmbServerFilePathUniqueSerializer } from \"@umbraco-cms/backoffice/server-file-system\";\nimport type { UmbTreeChildrenOfRequestArgs } from \"@umbraco-cms/backoffice/tree\";\nimport { UmbTreeServerDataSourceBase } from \"@umbraco-cms/backoffice/tree\";\nimport type { FileSystemTreeItemPresentationModel } from \"@umbraco-cms/backoffice/external/backend-api\";\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\nimport { EmailTemplateService } from \"@umbraco-forms/generated\";\n\nexport class FormsEmailTemplateTreeServerDataSource extends UmbTreeServerDataSourceBase<\n  FileSystemTreeItemPresentationModel,\n  FormsEmailTemplateTreeItemModel\n> {\n  constructor(host: UmbControllerHost) {\n    super(host, {\n      getRootItems,\n      getChildrenOf,\n      getAncestorsOf,\n      mapper,\n    });\n  }\n}\n\nconst getRootItems = () =>\n  // eslint-disable-next-line local-rules/no-direct-api-import\n  EmailTemplateService.getTreeEmailTemplateRoot();\n\nconst getChildrenOf = (args: UmbTreeChildrenOfRequestArgs) => {\n  const parentPath = new UmbServerFilePathUniqueSerializer().toServerPath(\n    args.parent.unique,\n  );\n\n  return parentPath === null\n    ? getRootItems()\n    : // eslint-disable-next-line local-rules/no-direct-api-import\n      EmailTemplateService.getTreeEmailTemplateChildrenByParentPath({\n        path: { parentPath },\n      });\n};\n\nconst getAncestorsOf = () => {\n  throw new Error(\"Ancestors is not available.\");\n};\n\nconst mapper = (\n  item: FileSystemTreeItemPresentationModel,\n): FormsEmailTemplateTreeItemModel => {\n  const serializer = new UmbServerFilePathUniqueSerializer();\n\n  return {\n    unique: serializer.toUnique(item.path),\n    parent: {\n      unique: item.parent ? serializer.toUnique(item.parent.path) : null,\n      entityType: item.parent\n        ? FORMS_EMAIL_TEMPLATE_FOLDER_ENTITY_TYPE\n        : FORMS_EMAIL_TEMPLATE_ROOT_ENTITY_TYPE,\n    },\n    entityType: item.isFolder\n      ? FORMS_EMAIL_TEMPLATE_FOLDER_ENTITY_TYPE\n      : FORMS_EMAIL_TEMPLATE_ENTITY_TYPE,\n    name: item.name,\n    isFolder: item.isFolder,\n    hasChildren: item.hasChildren,\n    icon: item.isFolder ? undefined : \"icon-notepad\",\n  };\n};\n","import { FORMS_EMAIL_TEMPLATE_ROOT_ENTITY_TYPE } from \"../entity.js\";\nimport { FormsEmailTemplateTreeServerDataSource } from \"./email-template-tree.server.data-source.js\";\nimport type {\n  FormsEmailTemplateTreeItemModel,\n  FormsEmailTemplateTreeRootModel,\n} from \"./types.js\";\nimport { FORMS_EMAIL_TEMPLATE_TREE_STORE_CONTEXT } from \"./email-template-tree.store.js\";\nimport type { UmbApi } from \"@umbraco-cms/backoffice/extension-api\";\nimport type { UmbControllerHost } from \"@umbraco-cms/backoffice/controller-api\";\nimport { UmbTreeRepositoryBase } from \"@umbraco-cms/backoffice/tree\";\n\nexport class FormsEmailTemplateTreeRepository\n  extends UmbTreeRepositoryBase<\n    FormsEmailTemplateTreeItemModel,\n    FormsEmailTemplateTreeRootModel\n  >\n  implements UmbApi\n{\n  constructor(host: UmbControllerHost) {\n    super(\n      host,\n      FormsEmailTemplateTreeServerDataSource,\n      FORMS_EMAIL_TEMPLATE_TREE_STORE_CONTEXT,\n    );\n  }\n\n  async requestTreeRoot() {\n    const { data: treeRootData } = await this._treeSource.getRootItems({\n      skip: 0,\n      take: 0,\n    });\n    const hasChildren = treeRootData ? treeRootData.total > 0 : false;\n\n    const data: FormsEmailTemplateTreeRootModel = {\n      unique: null,\n      entityType: FORMS_EMAIL_TEMPLATE_ROOT_ENTITY_TYPE,\n      name: \"Email Templates\",\n      hasChildren,\n      isFolder: true,\n    };\n\n    return { data };\n  }\n}\n\nexport default FormsEmailTemplateTreeRepository;\n"],"names":["FormsEmailTemplateTreeServerDataSource","UmbTreeServerDataSourceBase","host","getRootItems","getChildrenOf","getAncestorsOf","mapper","EmailTemplateService","args","parentPath","UmbServerFilePathUniqueSerializer","item","serializer","FORMS_EMAIL_TEMPLATE_FOLDER_ENTITY_TYPE","FORMS_EMAIL_TEMPLATE_ROOT_ENTITY_TYPE","FORMS_EMAIL_TEMPLATE_ENTITY_TYPE","FormsEmailTemplateTreeRepository","UmbTreeRepositoryBase","FORMS_EMAIL_TEMPLATE_TREE_STORE_CONTEXT","treeRootData","hasChildren"],"mappings":";;;;AAaO,MAAMA,UAA+CC,EAG1D;AAAA,EACA,YAAYC,GAAyB;AACnC,UAAMA,GAAM;AAAA,MACV,cAAAC;AAAA,MACA,eAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,QAAAC;AAAA,IAAA,CACD;AAAA,EAAA;AAEL;AAEA,MAAMH,IAAe;AAAA;AAAA,EAEnBI,EAAqB,yBAAA;AAAA,GAEjBH,IAAgB,CAACI,MAAuC;AAC5D,QAAMC,IAAa,IAAIC,EAAA,EAAoC;AAAA,IACzDF,EAAK,OAAO;AAAA,EAAA;AAGd,SAAOC,MAAe,OAClBN,EAAA;AAAA;AAAA,IAEAI,EAAqB,yCAAyC;AAAA,MAC5D,MAAM,EAAE,YAAAE,EAAA;AAAA,IAAW,CACpB;AAAA;AACP,GAEMJ,IAAiB,MAAM;AAC3B,QAAM,IAAI,MAAM,6BAA6B;AAC/C,GAEMC,IAAS,CACbK,MACoC;AACpC,QAAMC,IAAa,IAAIF,EAAA;AAEvB,SAAO;AAAA,IACL,QAAQE,EAAW,SAASD,EAAK,IAAI;AAAA,IACrC,QAAQ;AAAA,MACN,QAAQA,EAAK,SAASC,EAAW,SAASD,EAAK,OAAO,IAAI,IAAI;AAAA,MAC9D,YAAYA,EAAK,SACbE,IACAC;AAAA,IAAA;AAAA,IAEN,YAAYH,EAAK,WACbE,IACAE;AAAA,IACJ,MAAMJ,EAAK;AAAA,IACX,UAAUA,EAAK;AAAA,IACf,aAAaA,EAAK;AAAA,IAClB,MAAMA,EAAK,WAAW,SAAY;AAAA,EAAA;AAEtC;AC1DO,MAAMK,UACHC,EAKV;AAAA,EACE,YAAYf,GAAyB;AACnC;AAAA,MACEA;AAAA,MACAF;AAAA,MACAkB;AAAA,IAAA;AAAA,EACF;AAAA,EAGF,MAAM,kBAAkB;AACtB,UAAM,EAAE,MAAMC,EAAA,IAAiB,MAAM,KAAK,YAAY,aAAa;AAAA,MACjE,MAAM;AAAA,MACN,MAAM;AAAA,IAAA,CACP,GACKC,IAAcD,IAAeA,EAAa,QAAQ,IAAI;AAU5D,WAAO,EAAE,MARqC;AAAA,MAC5C,QAAQ;AAAA,MACR,YAAYL;AAAA,MACZ,MAAM;AAAA,MACN,aAAAM;AAAA,MACA,UAAU;AAAA,IAAA,EAGH;AAAA,EAAK;AAElB;"}