{"version":3,"file":"field-mapper-property-editor.element.js","sources":["../src/property-editor/field-mapper/field-mapper-property-editor.element.ts"],"sourcesContent":["import { FORMS_FORM_WORKSPACE_CONTEXT } from \"../../section/forms/workspace/form-workspace.context-token.js\";\nimport {\n  html,\n  customElement,\n  property,\n  css,\n  when,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport type { UmbPropertyEditorUiElement } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\nimport type { UUIInputEvent } from \"@umbraco-ui/uui-input\";\nimport type { Field } from \"@umbraco-forms/generated\";\nimport type { UUISelectEvent } from \"@umbraco-ui/uui\";\n\nconst elementName = \"forms-field-mapper-property-editor\";\n\nexport type FieldMapping = {\n  alias: string;\n  value: string;\n  staticValue: string;\n};\n\n@customElement(elementName)\nexport class FormsFieldMapperPropertyUiElement\n  extends UmbLitElement\n  implements UmbPropertyEditorUiElement\n{\n  #workspaceContext?: typeof FORMS_FORM_WORKSPACE_CONTEXT.TYPE;\n\n  #value: string = \"\";\n\n  @property({ type: String })\n  get value() {\n    return this.#value;\n  }\n  set value(value: string) {\n    const oldVal = this.#value;\n    this.#value = value;\n    this.requestUpdate(\"value\", oldVal);\n\n    this.#initializeMappings(value);\n  }\n\n  #mappings: Array<FieldMapping> = [];\n\n  #fieldSelectOptions: Array<Option> = [];\n\n  constructor() {\n    super();\n\n    this.consumeContext(FORMS_FORM_WORKSPACE_CONTEXT, (instance) => {\n      this.#workspaceContext = instance;\n      this.#initializeFieldSelectOptions();\n    });\n  }\n\n  #initializeMappings(value?: string) {\n    if (value && value.length > 0) {\n      this.#mappings = JSON.parse(value);\n    }\n  }\n\n  #initializeFieldSelectOptions() {\n    const allFields = this.#workspaceContext!.getAllFields();\n    const options = allFields.map((f: Field) => {\n      return { name: f.caption, value: f.id };\n    });\n    options.unshift({ name: \"Map a field\", value: \"\" }); // Can't use the uui-select placeholder here, as we want to be able to deselect.\n    this.#fieldSelectOptions = options;\n  }\n\n  #getFieldSelectOptionsWithSelectedValue(value: string) {\n    return this.#fieldSelectOptions.map((o: Option) => {\n      return {\n        ...o,\n        selected: o.value === value ? true : undefined,\n      };\n    });\n  }\n\n  #onAliasChange(e: UUIInputEvent, idx: number) {\n    const value = e.target.value.toString();\n    this.#mappings[idx].alias = value;\n    this.#refreshValue();\n  }\n\n  #onFieldSelectChange(e: UUISelectEvent, idx: number) {\n    const value = e.target.value.toString();\n    this.#mappings[idx].value = value;\n    this.#refreshValue();\n  }\n\n  #onStaticValueChange(e: UUIInputEvent, idx: number) {\n    const value = e.target.value.toString();\n    this.#mappings[idx].staticValue = value;\n    this.#refreshValue();\n  }\n\n  #onDeleteClick(index: number) {\n    this.#mappings.splice(index, 1);\n    this.#refreshValue();\n  }\n\n  #onAddClick() {\n    this.#mappings.push({ alias: \"\", value: \"\", staticValue: \"\" });\n    this.#refreshValue();\n  }\n\n  #refreshValue() {\n    this.value = JSON.stringify(this.#mappings);\n    this.dispatchEvent(new CustomEvent(\"property-value-change\"));\n  }\n\n  async connectedCallback() {\n    super.connectedCallback();\n  }\n\n  render() {\n    return html`\n      ${when(\n        this.#mappings.length > 0,\n        () =>\n          html` <div class=\"umb-forms-mappings\">\n            <div class=\"umb-forms-mapping-header\">\n              <div class=\"umb-forms-mapping-field -no-margin-left\">Alias</div>\n              <div class=\"umb-forms-mapping-field\">Form value</div>\n              <div class=\"umb-forms-mapping-field\">Static value</div>\n              <div class=\"umb-forms-mapping-remove -no-margin-right\"></div>\n            </div>\n\n            ${this.#mappings.map(\n              (mapping, idx) => html`\n                <div class=\"umb-forms-mapping\">\n                  <div class=\"umb-forms-mapping-field -no-margin-left\">\n                    <uui-input\n                      type=\"text\"\n                      label=\"Alias\"\n                      placeholder=\"Alias\"\n                      .value=${mapping.alias}\n                      @change=${(e: UUIInputEvent) =>\n                        this.#onAliasChange(e, idx)}\n                    ></uui-input>\n                  </div>\n\n                  <div class=\"umb-forms-mapping-field\">\n                    <uui-select\n                      .options=${this.#getFieldSelectOptionsWithSelectedValue(\n                        mapping.value,\n                      )}\n                      placeholder=\"Map a field\"\n                      @change=${(e: UUISelectEvent) =>\n                        this.#onFieldSelectChange(e, idx)}\n                    >\n                    </uui-select>\n                  </div>\n\n                  <div class=\"umb-forms-mapping-field\">\n                    <uui-input\n                      type=\"text\"\n                      label=\"Static value\"\n                      placeholder=\"Static value\"\n                      .value=${mapping.staticValue}\n                      @change=${(e: UUIInputEvent) =>\n                        this.#onStaticValueChange(e, idx)}\n                    ></uui-input>\n                  </div>\n\n                  <div class=\"umb-forms-mapping-remove -no-margin-right\">\n                    <uui-button\n                      label=${this.localize.term(\"general_delete\")}\n                      look=\"secondary\"\n                      color=\"default\"\n                      @click=${() => this.#onDeleteClick(idx)}\n                    >\n                      <uui-icon name=\"icon-delete\"></uui-icon>\n                    </uui-button>\n                  </div>\n                </div>\n              `,\n            )}\n          </div>`,\n      )}\n\n      <uui-button\n        label=\"add\"\n        look=\"secondary\"\n        color=\"default\"\n        @click=${this.#onAddClick}\n      >\n        <uui-icon name=\"icon-add\"></uui-icon>\n      </uui-button>\n    `;\n  }\n\n  static styles = [\n    css`\n      .umb-forms-mappings {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .umb-forms-mapping-header {\n        display: flex;\n        flex-direction: row;\n        font-weight: bold;\n      }\n\n      .umb-forms-mapping {\n        display: flex;\n        flex-direction: row;\n        margin-bottom: 5px;\n        align-items: center;\n      }\n\n      .umb-forms-mapping-field {\n        flex: 1 1 33%;\n        margin: 5px;\n      }\n\n      .umb-forms-mapping-field input,\n      .umb-forms-mapping-field select {\n        margin-bottom: 0;\n      }\n\n      .umb-forms-mapping-field.-no-margin-left {\n        margin-left: 0;\n      }\n\n      .umb-forms-mapping-remove {\n        flex: 1 1 20px;\n        margin: 5px;\n      }\n\n      .umb-forms-mapping-remove.-no-margin-right {\n        margin-right: 0;\n      }\n    `,\n  ];\n}\n\nexport default FormsFieldMapperPropertyUiElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsFieldMapperPropertyUiElement;\n  }\n}\n"],"names":["_workspaceContext","_value","_mappings","_fieldSelectOptions","_FormsFieldMapperPropertyUiElement_instances","initializeMappings_fn","initializeFieldSelectOptions_fn","getFieldSelectOptionsWithSelectedValue_fn","onAliasChange_fn","onFieldSelectChange_fn","onStaticValueChange_fn","onDeleteClick_fn","onAddClick_fn","refreshValue_fn","elementName","FormsFieldMapperPropertyUiElement","UmbLitElement","__privateAdd","FORMS_FORM_WORKSPACE_CONTEXT","instance","__privateSet","__privateMethod","__privateGet","value","oldVal","html","when","mapping","idx","e","options","f","o","index","css","__decorateClass","property","customElement","FormsFieldMapperPropertyUiElement$1"],"mappings":"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"}