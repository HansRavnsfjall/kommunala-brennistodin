{"version":3,"file":"form-copy-options-modal.element.js","sources":["../src/section/forms/entity-actions/copy/modal/form-copy-options-modal.element.ts"],"sourcesContent":["import { FormsFormDetailRepository } from \"../../../repository/index.js\";\nimport { FORMS_FORM_TREE_ALIAS } from \"../../../tree/manifests.js\";\nimport {\n  FORMS_FORM_FOLDER_ENTITY_TYPE,\n  FORMS_FORM_ROOT_ENTITY_TYPE,\n} from \"../../../entities.js\";\nimport type { FormsFormCopyOptionsModalData } from \"./index.js\";\nimport { html, customElement } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbModalBaseElement } from \"@umbraco-cms/backoffice/modal\";\nimport type { FormDesign } from \"@umbraco-forms/generated\";\nimport type {\n  UmbTreeElement,\n  UmbTreeItemModelBase,\n} from \"@umbraco-cms/backoffice/tree\";\nimport { UmbRequestReloadChildrenOfEntityEvent } from \"@umbraco-cms/backoffice/entity-action\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\n\n@customElement(\"forms-form-copy-options-modal\")\nexport class FormsFormCopyOptionsModalElement extends UmbModalBaseElement<FormsFormCopyOptionsModalData> {\n  #formToCopy?: FormDesign | null;\n\n  #formDetailRepository = new FormsFormDetailRepository(this);\n\n  #notificationContext?: typeof UMB_NOTIFICATION_CONTEXT.TYPE;\n\n  constructor() {\n    super();\n\n    this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\n      this.#notificationContext = instance;\n    });\n  }\n\n  async connectedCallback() {\n    super.connectedCallback();\n\n    if (!this.data?.unique) return;\n    const { data } = await this.#formDetailRepository.requestByUnique(\n      this.data.unique,\n    );\n    this.#formToCopy = data;\n    this.requestUpdate();\n  }\n\n  async #onSubmit(event: SubmitEvent) {\n    event.preventDefault();\n    if (!this.#formDetailRepository)\n      throw new Error(\"Repository is not available\");\n    if (!this.data?.unique)\n      throw new Error(\"Unique identifier is not available\");\n\n    const form = event.target as HTMLFormElement;\n    if (!form) return;\n\n    const isValid = form.checkValidity();\n    if (!isValid) return;\n\n    const formData = new FormData(form);\n    const name = formData.get(\"NewName\") as string;\n    const copyWorkflows = formData.get(\"CopyWorkflows\") === \"on\";\n    const copyToFolderElement = this.shadowRoot?.getElementById(\n      \"CopyToFolder\",\n    ) as UmbTreeElement;\n    const copyToFolderSelection = copyToFolderElement.getSelection()[0];\n    const copyToFolder =\n      copyToFolderSelection === undefined\n        ? null // Nothing selected, so we keep the existing folder.\n        : copyToFolderSelection === null\n          ? \"-1\" // Root selected.\n          : copyToFolderSelection; // Specific folder selected.\n\n    const { error } = await this.#formDetailRepository.copyForm(\n      this.data.unique,\n      copyWorkflows,\n      name,\n      copyToFolder,\n    );\n\n    if (!error) {\n      const reloadEvent = new UmbRequestReloadChildrenOfEntityEvent({\n        entityType: (copyToFolder === \"-1\" ? null : copyToFolder || null)\n          ? FORMS_FORM_FOLDER_ENTITY_TYPE\n          : FORMS_FORM_ROOT_ENTITY_TYPE,\n        unique: copyToFolder === \"-1\" ? null : copyToFolder || null,\n      });\n\n      const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n      eventContext?.dispatchEvent(reloadEvent);\n\n      this.#notificationContext?.peek(\"positive\", {\n        data: { message: this.localize.term(\"formCopy_copySuccess\") },\n      });\n\n      this._submitModal();\n    } else {\n      this.#notificationContext?.peek(\"danger\", {\n        data: { message: this.localize.term(\"formCopy_copyError\") },\n      });\n      this._rejectModal();\n    }\n  }\n\n  render() {\n    return html`\n      <umb-body-layout headline=${this.localize.term(\"formCopy_modalHeadline\")}>\n        <uui-box>\n          <p>Copying form <b>${this.#formToCopy?.name}</b></p>\n          <uui-form>\n            <form id=\"CopyForm\" @submit=\"${this.#onSubmit}\">\n              <uui-form-layout-item>\n                <uui-label id=\"NewNameLabel\" for=\"NewName\" slot=\"label\"\n                  >${this.localize.term(\"formCopy_enterName\")}</uui-label\n                >\n                <uui-input\n                  type=\"text\"\n                  id=\"NewName\"\n                  name=\"NewName\"\n                  placeholder=${this.localize.term(\"formCopy_enterNewName\")}\n                ></uui-input>\n              </uui-form-layout-item>\n              <uui-form-layout-item>\n                <uui-checkbox\n                  name=\"CopyWorkflows\"\n                  label=${this.localize.term(\"formCopy_alsoCopyWorkflows\")}\n                  >${this.localize.term(\n                    \"formCopy_alsoCopyWorkflows\",\n                  )}</uui-checkbox\n                >\n                <div>\n                  <small\n                    >${this.localize.term(\n                      \"formCopy_mandatoryWorkflowsCopied\",\n                    )}</small\n                  >\n                </div>\n              </uui-form-layout-item>\n              <uui-form-layout-item>\n                <umb-tree\n                  id=\"CopyToFolder\"\n                  alias=\"${FORMS_FORM_TREE_ALIAS}\"\n                  .props=${{\n                    hideTreeRoot: false,\n                    selectionConfiguration: {\n                      multiple: false,\n                    },\n                    selectableFilter: (item: UmbTreeItemModelBase) =>\n                      item.isFolder,\n                  }}\n                ></umb-tree>\n              </uui-form-layout-item>\n            </form>\n          </uui-form>\n        </uui-box>\n        <uui-button\n          slot=\"actions\"\n          id=\"cancel\"\n          label=${this.localize.term(\"general_cancel\")}\n          @click=\"${this._rejectModal}\"\n          >${this.localize.term(\"general_cancel\")}</uui-button\n        >\n        <uui-button\n          form=\"CopyForm\"\n          slot=\"actions\"\n          type=\"submit\"\n          label=${this.localize.term(\"general_copy\")}\n          look=\"primary\"\n          color=\"positive\"\n        ></uui-button>\n      </umb-body-layout>\n    `;\n  }\n}\n\nexport default FormsFormCopyOptionsModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"forms-form-copy-options-modal\": FormsFormCopyOptionsModalElement;\n  }\n}\n"],"names":["_formToCopy","_formDetailRepository","_notificationContext","_FormsFormCopyOptionsModalElement_instances","onSubmit_fn","FormsFormCopyOptionsModalElement","UmbModalBaseElement","__privateAdd","FormsFormDetailRepository","UMB_NOTIFICATION_CONTEXT","instance","__privateSet","_a","data","__privateGet","html","__privateMethod","FORMS_FORM_TREE_ALIAS","item","event","form","formData","name","copyWorkflows","copyToFolderSelection","_b","copyToFolder","error","_d","reloadEvent","UmbRequestReloadChildrenOfEntityEvent","FORMS_FORM_FOLDER_ENTITY_TYPE","FORMS_FORM_ROOT_ENTITY_TYPE","eventContext","UMB_ACTION_EVENT_CONTEXT","_c","__decorateClass","customElement","FormsFormCopyOptionsModalElement$1"],"mappings":"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"}