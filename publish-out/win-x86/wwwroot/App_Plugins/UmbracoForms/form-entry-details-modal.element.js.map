{"version":3,"file":"form-entry-details-modal.element.js","sources":["../src/modal/elements/form-entry-details-modal.element.ts"],"sourcesContent":["import type {\n  FormsEntryDetailsModalData,\n  FormsEntryDetailsModalValue,\n} from \"../token/form-entry-details-modal.token.js\";\nimport type {\n  FormEntryRecordAuditCollectionModel,\n  FormEntryWorkflowAuditCollectionModel,\n} from \"../../section/forms/entries/types.js\";\nimport { FORMS_FORM_WORKSPACE_CONTEXT } from \"../../section/forms/workspace/form-workspace.context-token.js\";\nimport { FORMS_CONTEXT } from \"../../context/forms.context-token.js\";\nimport {\n  FormsFormEntryRecordAuditCollectionRepository,\n  FormsFormEntryWorkflowAuditCollectionRepository,\n} from \"../../section/forms/entries/collection/repository/index.js\";\nimport { EntryRenderHelper } from \"../../section/forms/entries/entry-render-helper.class.js\";\nimport {\n  css,\n  customElement,\n  html,\n  repeat,\n  state,\n  unsafeHTML,\n  when,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport {\n  UmbModalBaseElement,\n  umbConfirmModal,\n} from \"@umbraco-cms/backoffice/modal\";\nimport {\n  RecordService,\n  type FormSecurityForUser,\n  type FieldData,\n  type UpdateRecordField,\n} from \"@umbraco-forms/generated\";\nimport type {\n  UmbPropertyDatasetElement,\n  UmbPropertyValueData,\n} from \"@umbraco-cms/backoffice/property\";\nimport type { UmbPropertyEditorConfig } from \"@umbraco-cms/backoffice/property-editor\";\nimport { tryExecute } from \"@umbraco-cms/backoffice/resources\";\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\n\nconst elementName = \"form-entry-details-modal\";\n\n@customElement(elementName)\nexport class FormsEntryDetailsModalElement extends UmbModalBaseElement<\n  FormsEntryDetailsModalData,\n  FormsEntryDetailsModalValue\n> {\n  #workspaceContext?: typeof FORMS_FORM_WORKSPACE_CONTEXT.TYPE;\n\n  #workflowAudit: Array<FormEntryWorkflowAuditCollectionModel> = [];\n  #recordAudit: Array<FormEntryRecordAuditCollectionModel> = [];\n\n  @state()\n  private _editModeActive: boolean = false;\n\n  #currentFieldValues: Array<FieldData> = [];\n  #currentValidationErrors: Record<string, Array<string>> = {};\n\n  #userSecurity?: FormSecurityForUser;\n\n  constructor() {\n    super();\n\n    this.consumeContext(FORMS_FORM_WORKSPACE_CONTEXT, (instance) => {\n      this.#workspaceContext = instance;\n    });\n\n    this.consumeContext(FORMS_CONTEXT, (context) => {\n      if (!context) return;\n      this.observe(context.userSecurity, (userSecurity) => {\n        this.#userSecurity = userSecurity;\n      });\n    });\n  }\n\n  async connectedCallback(): Promise<void> {\n    super.connectedCallback();\n\n    await this.#refreshWorkflowAudit();\n    await this.#refreshRecordAudit();\n  }\n\n  #getSubmissionFields() {\n    return this.value.fields.filter((field) => !this.#isSystemField(field));\n  }\n\n  #getSubmissionFieldValues(): Array<UmbPropertyValueData> {\n    const values = this.#getSubmissionFields().map((f) => {\n      return {\n        alias: f.fieldId,\n        value: this._editModeActive\n          ? this.#getSubmissionFieldValueForEditor(f)\n          : this.#getSubmissionFieldValueForDisplay(f),\n      };\n    });\n    return values;\n  }\n\n  #getSubmissionFieldValueForDisplay(fieldData: FieldData) {\n    const schemaItem = this.#getSchemaItem(fieldData);\n    if (!schemaItem) {\n      return html`${fieldData.value}`;\n    }\n\n    const entryRenderHelper = new EntryRenderHelper(\n      this,\n      this.data?.fieldPrevalues || [],\n    );\n    if (schemaItem.view === \"file\") {\n      return unsafeHTML(this.#getFilePreview(fieldData));\n    } else {\n      const value = entryRenderHelper.getRenderValue(\n        fieldData,\n        schemaItem.view,\n      );\n      return html`${value}`;\n    }\n  }\n\n  #getFilePreview(fieldData: FieldData) {\n    const imageExtensions = [\"jpg\", \"jpeg\", \"png\", \"gif\", \"bmp\"];\n    if (!fieldData.value) {\n      return \"\";\n    }\n\n    const filePaths = fieldData.value.toString().split(\", \");\n    let previewHtml = \"\";\n    for (let index = 0; index < filePaths.length; index++) {\n      const filePath = filePaths[index];\n      const extension = filePath\n        .substring(filePath.lastIndexOf(\".\") + 1)\n        .toLowerCase();\n      previewHtml += \"<div>\";\n      if (imageExtensions.indexOf(extension) >= 0) {\n        previewHtml += `<a target=\"_blank\" href=\"${filePath}\"><img src=\"${filePath}\" width=\"200\" /></a>`;\n      } else {\n        const fileName = filePath.substring(filePath.lastIndexOf(\"/\") + 1);\n        previewHtml += `<a target=\"_blank\" href=\"${filePath}\">${fileName}</a>`;\n      }\n      previewHtml += \"</div>\";\n    }\n\n    return previewHtml;\n  }\n\n  #getSubmissionFieldValueForEditor(fieldData: FieldData) {\n    // Transform the string value into the type appropriate for the property editor.\n    const schemaItem = this.#getSchemaItem(fieldData);\n    if (!schemaItem) {\n      return null;\n    }\n\n    const value = fieldData.value?.toString() || \"\";\n\n    switch (schemaItem.editView) {\n      case \"Umb.PropertyEditorUi.Toggle\":\n        return value.toLowerCase() === \"true\";\n      case \"Umb.PropertyEditorUi.Dropdown\": {\n        const field = this.#getField(schemaItem.alias);\n        if (\n          field?.settings[\"AllowMultipleSelections\"]?.toLowerCase() === \"true\"\n        ) {\n          const values = this.#getSubmissionFieldValueForEditorWithPrevalues(\n            fieldData.fieldId,\n            value.split(\",\").map((v) => v.trim()),\n          );\n          return this._editModeActive ? values : values.join(\", \");\n        } else {\n          return this.#getSubmissionFieldValueForEditorWithPrevalues(\n            fieldData.fieldId,\n            [value],\n          );\n        }\n      }\n      case \"Umb.PropertyEditorUi.RadioButtonList\":\n        return this.#getSubmissionFieldValueForEditorWithPrevalues(\n          fieldData.fieldId,\n          [value],\n        )[0];\n      case \"Umb.PropertyEditorUi.CheckBoxList\": {\n        // In edit view we need an array of values, in display view a comma delimited string.\n        const values = this.#getSubmissionFieldValueForEditorWithPrevalues(\n          fieldData.fieldId,\n          value.split(\",\").map((v) => v.trim()),\n        );\n        return this._editModeActive ? values : values.join(\", \");\n      }\n      case \"Umb.PropertyEditorUi.DatePicker\":\n        return this._editModeActive\n          ? value.replace(\"T\", \" \")\n          : new Date(value).toLocaleDateString();\n      default:\n        return value;\n    }\n  }\n\n  #getSubmissionFieldValueForEditorWithPrevalues(\n    fieldId: string,\n    values: Array<string>,\n  ) {\n    const result: Array<string> = [];\n\n    for (let i = 0; i < values.length; i++) {\n      const value = values[i];\n\n      if (value.length === 0) {\n        continue;\n      }\n\n      // If we have prevalues with captions, display those instead of the stored value.\n      const prevalues = this.#getPrevaluesForField(fieldId);\n      const matchedPrevalue = prevalues.find((x) => x.value === value);\n      const valueForEditor =\n        matchedPrevalue?.caption && matchedPrevalue.caption.length > 0\n          ? matchedPrevalue?.caption\n          : value;\n      result.push(valueForEditor);\n    }\n\n    return result;\n  }\n\n  #getPrevaluesForField(fieldId: string) {\n    return (\n      this.data?.fieldPrevalues.find((f) => f.id === fieldId)?.prevalues || []\n    );\n  }\n\n  #isSystemField(field: FieldData) {\n    // Non-system fields are have GUIDs for Ids. Hat-tip: https://stackoverflow.com/a/68837405\n    const isHex = (c: string) => \"0123456789abcdef\".includes(c.toLowerCase());\n\n    const isGuid = (input: string) => {\n      input = input.replace(/-/g, \"\");\n      return input.length === 32 && [...input].every(isHex);\n    };\n\n    return !isGuid(field.fieldId);\n  }\n\n  #getFieldName(field: FieldData) {\n    const schemaItem = this.#getSchemaItem(field);\n    return schemaItem?.name;\n  }\n\n  #getFieldEditView(field: FieldData) {\n    const schemaItem = this.#getSchemaItem(field);\n    return schemaItem?.editView;\n  }\n\n  #getSubmissionFieldEditablePropertyConfig(\n    field: FieldData,\n  ): UmbPropertyEditorConfig {\n    const config: UmbPropertyEditorConfig = [];\n    if (!this._editModeActive) {\n      return config;\n    }\n\n    const schemaItem = this.#getSchemaItem(field);\n    if (!schemaItem) {\n      return config;\n    }\n\n    // TODO: Somehow we need to make this extensible by people defining their own field types with custom edit views.\n    switch (schemaItem.editView) {\n      case \"Umb.PropertyEditorUi.Dropdown\": {\n        const field = this.#getField(schemaItem.alias);\n        if (field) {\n          config.push(\n            {\n              alias: \"multiple\",\n              value:\n                field.settings[\"AllowMultipleSelections\"]?.toLowerCase() ===\n                \"true\",\n            },\n            {\n              alias: \"items\",\n              value: this.#getPrevaluesForField(field.id).map((pv) =>\n                pv.caption && pv.caption.length > 0 ? pv.caption : pv.value,\n              ),\n            },\n          );\n        }\n        break;\n      }\n      case \"Umb.PropertyEditorUi.RadioButtonList\":\n      case \"Umb.PropertyEditorUi.CheckBoxList\": {\n        const field = this.#getField(schemaItem.alias);\n        if (field) {\n          config.push({\n            alias: \"items\",\n            value: this.#getPrevaluesForField(field.id).map((pv) =>\n              pv.caption && pv.caption.length > 0 ? pv.caption : pv.value,\n            ),\n          });\n        }\n        break;\n      }\n    }\n\n    return config;\n  }\n\n  #getField(alias: string) {\n    const formFields = this.#workspaceContext?.getAllFields() || [];\n    return formFields.find((f) => f.alias === alias);\n  }\n\n  #getSchemaItem(field: FieldData) {\n    return this.#getSchemaItemByFieldId(field.fieldId);\n  }\n\n  #getSchemaItemByFieldId(fieldId: string) {\n    return this.data?.schema.find((s) => s.id === fieldId);\n  }\n\n  #toggleEditMode() {\n    this._editModeActive = !this._editModeActive;\n    if (this._editModeActive) {\n      // Save the current field values so we can compare to see what has changed on save.\n      this.#currentFieldValues = this.#getSubmissionFields();\n    } else {\n      this.#currentFieldValues = [];\n    }\n\n    this.#currentValidationErrors = {};\n  }\n\n  #hasValidationError(fieldId: string) {\n    return this.#currentValidationErrors[fieldId]?.length > 0;\n  }\n\n  #getValidationErrors(fieldId: string): Array<string> {\n    return this.#currentValidationErrors[fieldId];\n  }\n\n  async #saveUpdatedValues() {\n    const fieldValues: Array<UpdateRecordField> = [];\n\n    const currentFieldValues = this.#currentFieldValues;\n    const newFieldValues = this.#getFieldValuesFromElement();\n\n    for (let i = 0; i < currentFieldValues.length; i++) {\n      const currentValue = currentFieldValues[i];\n      const newValue = newFieldValues[i];\n      if (currentValue.value !== newValue.values.join(\",\")) {\n        fieldValues.push(newValue);\n      }\n    }\n\n    if (fieldValues.length === 0) {\n      this.#resetAfterSave();\n      return;\n    }\n\n    const request = {\n      path: {\n        recordId: this.value?.unique || \"\",\n        formId: this.#workspaceContext?.getUnique() || \"\",\n      },\n      body: fieldValues,\n    };\n\n    const { error } = await tryExecute(\n      this,\n      RecordService.putFormByFormIdRecordByRecordId(request),\n      {\n        disableNotifications: true,\n      },\n    );\n\n    if (error) {\n      // Had a problem, display validation errors.\n      this.#currentValidationErrors = error[\"body\"][\"errors\"];\n      this.requestUpdate();\n      return;\n    }\n\n    // All good, so switch back to view mode, display a notification and update the local model.\n    this.#resetAfterSave();\n\n    const notification = {\n      data: {\n        message: this.localize.term(\"formEntries_updateRecordSuccess\"),\n      },\n    };\n\n    const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\n    notificationContext?.peek(\"positive\", notification);\n\n    const fields = structuredClone(this.value?.fields);\n    for (let i = 0; i < fieldValues.length; i++) {\n      const fieldValue = fieldValues[i];\n      fields.find((f) => f.fieldId === fieldValue.fieldId)!.value =\n        fieldValue.values;\n    }\n\n    this.modalContext?.updateValue({ fields, updateCollection: true });\n  }\n\n  #resetAfterSave() {\n    this._editModeActive = false;\n    this.#currentValidationErrors = {};\n    this.#currentFieldValues = [];\n  }\n\n  #getFieldValuesFromElement() {\n    const formSubmissionFieldsElement = this.shadowRoot?.getElementById(\n      \"formSubmissionFields\",\n    ) as UmbPropertyDatasetElement;\n    if (!formSubmissionFieldsElement)\n      throw new Error(\"Could not find form submission fields element.\");\n\n    const values: Array<UpdateRecordField> = [];\n    for (let i = 0; i < formSubmissionFieldsElement.value.length; i++) {\n      const item = formSubmissionFieldsElement.value[i];\n      values.push({\n        fieldId: item.alias,\n        values: this.#getFieldValueForPersistence(item.alias, item),\n      });\n    }\n\n    return values;\n  }\n\n  #getFieldValueForPersistence(\n    fieldId: string,\n    valueData: UmbPropertyValueData,\n  ): Array<unknown> {\n    // Transform the editor value into an array of values for persistence.\n    const schemaItem = this.#getSchemaItemByFieldId(valueData.alias);\n    if (!schemaItem) {\n      return [];\n    }\n\n    switch (schemaItem.editView) {\n      case \"Umb.PropertyEditorUi.Dropdown\":\n      case \"Umb.PropertyEditorUi.RadioButtonList\":\n      case \"Umb.PropertyEditorUi.CheckBoxList\": {\n        // As these property editors only supports strings and not Options for it's items, we'll potentially have a caption\n        // here that we need to map back to the value.\n        const selectedValues = Array.isArray(valueData.value)\n          ? (valueData.value as Array<string>)\n          : [valueData.value];\n        if (selectedValues.length === 0) {\n          return [];\n        }\n\n        const prevalues = this.#getPrevaluesForField(fieldId);\n        return selectedValues.map((v) => {\n          const prevalueMatchedToCaption = prevalues.find(\n            (pv) => pv.caption === v,\n          );\n          return prevalueMatchedToCaption ? prevalueMatchedToCaption.value : v;\n        });\n      }\n      default:\n        return [valueData.value];\n    }\n  }\n\n  async #refreshWorkflowAudit(): Promise<void> {\n    const formId = this.#workspaceContext?.getUnique();\n    if (!formId) return;\n\n    const recordId = this.value.unique;\n\n    const repo = new FormsFormEntryWorkflowAuditCollectionRepository(this);\n    await this.#retrieveWorkflowAudit(repo, formId, recordId);\n  }\n\n  async #retrieveWorkflowAudit(\n    repo: FormsFormEntryWorkflowAuditCollectionRepository,\n    formId: string,\n    recordId: string,\n  ) {\n    const response = await repo.requestCollection({ formId, recordId });\n    this.#workflowAudit = response?.data?.items || [];\n    this.requestUpdate();\n  }\n\n  async #refreshRecordAudit(): Promise<void> {\n    const formId = this.#workspaceContext?.getUnique();\n    if (!formId) return;\n\n    const recordId = this.value.unique;\n\n    const repo = new FormsFormEntryRecordAuditCollectionRepository(this);\n    const response = await repo.requestCollection({ formId, recordId });\n    this.#recordAudit = response?.data?.items || [];\n    this.requestUpdate();\n  }\n\n  async #runWorkflow(workflowKey: string) {\n    const formId = this.#workspaceContext?.getUnique();\n    if (!formId) return;\n\n    const recordId = this.value.unique;\n\n    await umbConfirmModal(this, {\n      headline: this.localize.term(\n        \"formEntries_workflowAuditRetryConfirmTitle\",\n      ),\n      content: this.localize.term(\n        \"formEntries_workflowAuditRetryConfirmMessage\",\n      ),\n      confirmLabel: this.localize.term(\"general_yes\"),\n      color: \"positive\",\n    });\n\n    const repo = new FormsFormEntryWorkflowAuditCollectionRepository(this);\n    await repo.executeWorkflow(formId, recordId, workflowKey);\n    await this.#retrieveWorkflowAudit(repo, formId, recordId);\n  }\n\n  #goToDocument() {\n    history.pushState(\n      {},\n      \"\",\n      `/umbraco/section/content/workspace/document/edit/${this.value.documentUnique}`,\n    );\n    this._rejectModal();\n  }\n\n  #renderMember() {\n    if (!this.value.member?.unique) return null;\n\n    const goToMember = () => {\n      history.pushState(\n        {},\n        \"\",\n        `/umbraco/section/member-management/workspace/member/edit/${\n          this.value.member!.unique\n        }`,\n      );\n      this._rejectModal();\n    };\n\n    return html` <umb-property-layout\n      label=${this.localize.term(\"formEntries_member\")}\n    >\n      <uui-ref-node-member\n        slot=\"editor\"\n        name=${this.value.member.name}\n        group-name=${this.value.member.email}\n      >\n        <uui-action-bar slot=\"actions\">\n          <uui-button\n            label=${this.localize.term(\"general_edit\")}\n            @click=${goToMember}\n          ></uui-button>\n        </uui-action-bar>\n      </uui-ref-node-member>\n    </umb-property-layout>`;\n  }\n\n  #renderEditingControls() {\n    if (!this.#userSecurity?.userSecurity.editEntries) return null;\n\n    return html`<div id=\"edit\">\n      ${when(\n        this._editModeActive,\n        () =>\n          html` <uui-button\n              @click=${this.#toggleEditMode}\n              look=\"default\"\n              label=${this.localize.term(\"general_cancel\")}\n            ></uui-button>\n            <uui-button\n              @click=${this.#saveUpdatedValues}\n              look=\"primary\"\n              color=\"positive\"\n              label=${this.localize.term(\"buttons_save\")}\n            ></uui-button>`,\n        () =>\n          html`<uui-button\n            @click=${this.#toggleEditMode}\n            look=\"primary\"\n            label=${this.localize.term(\"general_edit\")}\n          ></uui-button>`,\n      )}\n    </div>`;\n  }\n\n  render() {\n    return html`<umb-body-layout\n      headline=${this.localize.term(\"formEntries_entryDetails\")}\n    >\n      <uui-box\n        headline=${this.localize.term(\"formEntries_formSubmissionHeadline\")}\n      >\n        <umb-property-dataset\n          id=\"formSubmissionFields\"\n          .value=${this.#getSubmissionFieldValues()}\n        >\n          ${repeat(\n            this.#getSubmissionFields(),\n            (field) => field.fieldId,\n            (field) =>\n              html`<umb-property\n                  .label=${this.#getFieldName(field) ?? \"\"}\n                  alias=${field.fieldId}\n                  .config=${this.#getSubmissionFieldEditablePropertyConfig(\n                    field,\n                  )}\n                  property-editor-ui-alias=\"${this._editModeActive\n                    ? (this.#getFieldEditView(field) ??\n                      \"Umb.PropertyEditorUi.Label\")\n                    : \"Umb.PropertyEditorUi.Label\"}\"\n                >\n                </umb-property>\n                ${when(\n                  this.#hasValidationError(field.fieldId),\n                  () =>\n                    html`<div class=\"validation-error\">\n                      ${this.#getValidationErrors(field.fieldId).map(\n                        (e) => html`<div>${e}</div>`,\n                      )}\n                    </div>`,\n                )} `,\n          )}\n        </umb-property-dataset>\n        ${this.#renderEditingControls()}\n      </uui-box>\n\n      <uui-box headline=${this.localize.term(\"general_general\")}>\n        <umb-property-layout\n          label=${this.localize.term(\"formEntries_submittedOn\")}\n        >\n          <div slot=\"editor\">${this.value.created.toLocaleString()}</div>\n        </umb-property-layout>\n        ${when(\n          this.value.updated !== this.value.created,\n          () =>\n            html`<umb-property-layout\n              label=${this.localize.term(\"formEntries_updatedOn\")}\n            >\n              <div slot=\"editor\">${this.value.updated.toLocaleString()}</div>\n            </umb-property-layout>`,\n        )}\n        ${when(\n          this.value.pageName && this.value.pageName.length > 0,\n          () =>\n            html`<umb-property-layout\n              label=${this.localize.term(\"formEntries_fromPage\")}\n            >\n              <div slot=\"editor\" id=\"document\">\n                <span>${this.value.pageName}</span>\n                <uui-button\n                  look=\"primary\"\n                  color=\"default\"\n                  @click=${this.#goToDocument}\n                  label=${this.localize.term(\"formEntries_goToDocument\")}\n                ></uui-button>\n              </div>\n            </umb-property-layout>`,\n        )}\n        ${this.#renderMember()}\n\n        <umb-property-layout label=${this.localize.term(\"formEntries_state\")}>\n          <div slot=\"editor\">${this.value.state}</div>\n        </umb-property-layout>\n        <umb-property-layout label=${this.localize.term(\"general_id\")}>\n          <div slot=\"editor\">${this.value.id}</div>\n        </umb-property-layout>\n        <umb-property-layout\n          label=${this.localize.term(\"formEntries_uniqueId\")}\n        >\n          <div slot=\"editor\">${this.value.unique}</div>\n        </umb-property-layout>\n      </uui-box>\n\n      ${when(\n        this.#workflowAudit.length > 0,\n        () =>\n          html`<uui-box\n            headline=${this.localize.term(\"formEntries_workflowAudit\")}\n          >\n            <uui-table>\n              <uui-table-head>\n                <uui-table-head-cell>\n                  ${this.localize.term(\"formEntries_workflowAuditName\")}\n                </uui-table-head-cell>\n                <uui-table-head-cell>\n                  ${this.localize.term(\"formEntries_workflowAuditType\")}\n                </uui-table-head-cell>\n                <uui-table-head-cell>\n                  ${this.localize.term(\"formEntries_workflowAuditExecutedOn\")}\n                </uui-table-head-cell>\n                <uui-table-head-cell>\n                  ${this.localize.term(\n                    \"formEntries_workflowAuditExecutionStage\",\n                  )}\n                </uui-table-head-cell>\n                <uui-table-head-cell>\n                  ${this.localize.term(\"formEntries_workflowAuditResult\")}\n                </uui-table-head-cell>\n                <uui-table-head-cell></uui-table-head-cell>\n              </uui-table-head>\n              ${this.#workflowAudit.map(\n                (record) =>\n                  html`<uui-table-row>\n                    <uui-table-cell>${record.name}</uui-table-cell>\n                    <uui-table-cell>${record.typeName}</uui-table-cell>\n                    <uui-table-cell\n                      >${record.executedOn.toLocaleString()}</uui-table-cell\n                    >\n                    <uui-table-cell>\n                      ${this.localize.term(\n                        \"formEntries_workflowExecutionStage\" +\n                          record.executionStage,\n                      )}\n                    </uui-table-cell>\n                    <uui-table-cell>${record.result}</uui-table-cell>\n                    <uui-table-cell>\n                      <uui-button\n                        label=${this.localize.term(\"formEntries_runWorkflow\")}\n                        @click=\"${() => this.#runWorkflow(record.workflowKey)}\"\n                      >\n                        ${this.localize.term(\n                          record.result === \"Completed\"\n                            ? \"formEntries_workflowAuditRunAgain\"\n                            : record.result === \"SkippedDueToConditions\"\n                              ? \"formEntries_workflowAuditRunAnyway\"\n                              : \"formEntries_workflowAuditRetry\",\n                        )}\n                      </uui-button>\n                    </uui-table-cell>\n                  </uui-table-row>`,\n              )}\n            </uui-table>\n          </uui-box>`,\n      )}\n      ${when(\n        this.#recordAudit.length > 0,\n        () =>\n          html`<uui-box\n            headline=${this.localize.term(\"formEntries_recordAudit\")}\n          >\n            <uui-table>\n              <uui-table-head>\n                <uui-table-head-cell\n                  >${this.localize.term(\n                    \"formEntries_updatedOn\",\n                  )}</uui-table-head-cell\n                >\n                <uui-table-head-cell\n                  >${this.localize.term(\n                    \"formEntries_updatedBy\",\n                  )}</uui-table-head-cell\n                >\n              </uui-table-head>\n              ${this.#recordAudit.map(\n                (record) =>\n                  html`<uui-table-row>\n                    <uui-table-cell\n                      >${record.updatedOn.toLocaleString()}</uui-table-cell\n                    >\n                    <uui-table-cell>${record.updatedBy}</uui-table-cell>\n                  </uui-table-row>`,\n              )}\n            </uui-table>\n          </uui-box>`,\n      )}\n      <!-- submitting is intentional to ensure result is returned to the callee, indicating whether\n      the collection should be updated (ie modal had saved changes) -->\n      <uui-button\n        slot=\"actions\"\n        label=${this.localize.term(\"general_close\")}\n        @click=${this._submitModal}\n      ></uui-button>\n    </umb-body-layout>`;\n  }\n\n  static styles = [\n    css`\n      uui-box {\n        display: block;\n      }\n      uui-box + uui-box {\n        margin-top: var(--uui-size-layout-1);\n      }\n\n      uui-table {\n        width: 100%;\n      }\n\n      .validation-error {\n        color: red;\n      }\n\n      #document {\n        display: flex;\n        justify-content: space-between;\n      }\n\n      #document uui-button {\n        margin-left: var(--uui-size-6);\n      }\n\n      #edit {\n        display: flex;\n        justify-content: end;\n        column-gap: var(--uui-size-3);\n      }\n    `,\n  ];\n}\n\nexport default FormsEntryDetailsModalElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsEntryDetailsModalElement;\n  }\n}\n"],"names":["_workspaceContext","_workflowAudit","_recordAudit","_currentFieldValues","_currentValidationErrors","_userSecurity","_FormsEntryDetailsModalElement_instances","getSubmissionFields_fn","getSubmissionFieldValues_fn","getSubmissionFieldValueForDisplay_fn","getFilePreview_fn","getSubmissionFieldValueForEditor_fn","getSubmissionFieldValueForEditorWithPrevalues_fn","getPrevaluesForField_fn","isSystemField_fn","getFieldName_fn","getFieldEditView_fn","getSubmissionFieldEditablePropertyConfig_fn","getField_fn","getSchemaItem_fn","getSchemaItemByFieldId_fn","toggleEditMode_fn","hasValidationError_fn","getValidationErrors_fn","saveUpdatedValues_fn","resetAfterSave_fn","getFieldValuesFromElement_fn","getFieldValueForPersistence_fn","refreshWorkflowAudit_fn","retrieveWorkflowAudit_fn","refreshRecordAudit_fn","runWorkflow_fn","goToDocument_fn","renderMember_fn","renderEditingControls_fn","elementName","FormsEntryDetailsModalElement","UmbModalBaseElement","__privateAdd","FORMS_FORM_WORKSPACE_CONTEXT","instance","__privateSet","FORMS_CONTEXT","context","userSecurity","__privateMethod","html","repeat","field","when","e","__privateGet","record","f","fieldData","schemaItem","entryRenderHelper","EntryRenderHelper","_a","unsafeHTML","value","imageExtensions","filePaths","previewHtml","index","filePath","extension","fileName","_b","values","v","fieldId","result","i","matchedPrevalue","x","valueForEditor","isHex","c","input","config","pv","alias","s","fieldValues","currentFieldValues","newFieldValues","currentValue","newValue","request","error","tryExecute","RecordService","notification","notificationContext","UMB_NOTIFICATION_CONTEXT","fields","_c","fieldValue","_d","formSubmissionFieldsElement","item","valueData","selectedValues","prevalues","prevalueMatchedToCaption","formId","recordId","repo","FormsFormEntryWorkflowAuditCollectionRepository","response","FormsFormEntryRecordAuditCollectionRepository","workflowKey","umbConfirmModal","goToMember","css","__decorateClass","state","customElement","FormsEntryDetailsModalElement$1"],"mappings":"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"}