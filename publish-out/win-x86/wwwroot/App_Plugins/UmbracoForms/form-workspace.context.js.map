{"version":3,"file":"form-workspace.context.js","sources":["../src/section/forms/workspace/form-workspace-editor.element.ts","../src/section/forms/workspace/form-workspace.context.ts"],"sourcesContent":["import { FORMS_FORM_WORKSPACE_CONTEXT } from \"./form-workspace.context-token.js\";\nimport { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\nimport {\n  LitElement,\n  css,\n  customElement,\n  html,\n  property,\n  state,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport type { UUIInputEvent } from \"@umbraco-cms/backoffice/external/uui\";\n\nconst elementName = \"forms-form-workspace-editor\";\n\n@customElement(elementName)\nexport class FormsFormWorkspaceEditorElement extends UmbElementMixin(\n  LitElement,\n) {\n  @state()\n  private _formName = \"\";\n\n  @property({ type: String, attribute: false })\n  workspaceAlias?: string;\n\n  #workspaceContext?: typeof FORMS_FORM_WORKSPACE_CONTEXT.TYPE;\n\n  constructor() {\n    super();\n\n    this.consumeContext(FORMS_FORM_WORKSPACE_CONTEXT, (context) => {\n      this.#workspaceContext = context;\n      this.#observeId();\n    });\n  }\n\n  #observeId() {\n    if (!this.#workspaceContext) return;\n    this.observe(\n      this.#workspaceContext.data,\n      (data) => (this._formName = data?.name ?? \"\"),\n    );\n  }\n\n  #onChangeName(e: UUIInputEvent) {\n    this.#workspaceContext?.setName(e.target.value.toString());\n  }\n\n  render() {\n    return html` <umb-workspace-editor alias=\"Forms.Workspace.Form\">\n      <uui-input\n        slot=\"header\"\n        id=\"nameInput\"\n        label=${this.localize.term(\"placeholders_entername\")}\n        placeholder=${this.localize.term(\"placeholders_entername\")}\n        required\n        .value=${this._formName}\n        @input=\"${this.#onChangeName}\"\n      ></uui-input>\n    </umb-workspace-editor>`;\n  }\n\n  static styles = [\n    css`\n      :host {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n\n      #nameInput {\n        flex: 1 1 auto;\n      }\n    `,\n  ];\n}\n\nexport default FormsFormWorkspaceEditorElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsFormWorkspaceEditorElement;\n  }\n}\n","import { FORMS_FORM_ENTITY_TYPE } from \"../entities.js\";\nimport { FormsFormDetailRepository } from \"../repository/index.js\";\nimport { FormsPrevalueSourceCollectionRepository } from \"../../prevaluesources/repository/index.js\";\nimport { FormsFieldTypeDetailRepository } from \"../../provider-types/field-types/repository/detail/index.js\";\nimport { FormsWorkflowTypeDetailRepository } from \"../../provider-types/workflow-types/repository/detail/index.js\";\nimport type {\n  FieldPrevalueDetail,\n  ActionType,\n  LogicType,\n  OperatorType,\n} from \"../types.js\";\nimport FormsWorkspaceEditorElement from \"./form-workspace-editor.element.js\";\nimport { FORM_WORKSPACE_ALIAS } from \"./manifests.js\";\nimport type {\n  UmbRoutableWorkspaceContext,\n  UmbSaveableWorkspaceContext,\n} from \"@umbraco-cms/backoffice/workspace\";\nimport { UmbSubmittableWorkspaceContextBase } from \"@umbraco-cms/backoffice/workspace\";\nimport type { UmbControllerHostElement } from \"@umbraco-cms/backoffice/controller-api\";\nimport { UmbObjectState } from \"@umbraco-cms/backoffice/observable-api\";\nimport { FieldTypeService } from \"@umbraco-forms/generated\";\nimport type {\n  Field,\n  FieldsetContainer,\n  FormDesign,\n  Page,\n} from \"@umbraco-forms/generated\";\nimport { UMB_ACTION_EVENT_CONTEXT } from \"@umbraco-cms/backoffice/action\";\nimport {\n  UmbRequestReloadChildrenOfEntityEvent,\n  UmbRequestReloadStructureForEntityEvent,\n} from \"@umbraco-cms/backoffice/entity-action\";\nimport { tryExecute } from \"@umbraco-cms/backoffice/resources\";\nimport { UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\nimport { GUID_EMPTY } from \"@umbraco-forms/entities\";\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\nimport { UmbLocalizationController } from \"@umbraco-cms/backoffice/localization-api\";\n\nexport class FormsFormWorkspaceContext\n  extends UmbSubmittableWorkspaceContextBase<FormDesign>\n  implements UmbSaveableWorkspaceContext, UmbRoutableWorkspaceContext\n{\n  public readonly formRepository = new FormsFormDetailRepository(this);\n  public readonly fieldTypeRepository = new FormsFieldTypeDetailRepository(\n    this,\n  );\n  public readonly workflowTypeRepository =\n    new FormsWorkflowTypeDetailRepository(this);\n  public readonly prevalueSourceCollectionRepository =\n    new FormsPrevalueSourceCollectionRepository(this);\n\n  #parent?: { entityType: string; unique: string | null };\n  #data = new UmbObjectState<FormDesign | undefined>(undefined);\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  #getDataPromise?: Promise<any>;\n\n  readonly data = this.#data.asObservable();\n  readonly unique = this.#data.asObservablePart((data) => data?.unique);\n  readonly name = this.#data.asObservablePart((data) => data?.name);\n  readonly id = this.#data.asObservablePart((data) => data?.unique);\n\n  constructor(host: UmbControllerHostElement) {\n    super(host, FORM_WORKSPACE_ALIAS);\n\n    this.routes.setRoutes([\n      {\n        path: \"create/parent/:parentEntityType/:parentUnique\",\n        component: FormsWorkspaceEditorElement,\n        setup: this.#createOnWorkspaceContext,\n      },\n      {\n        path: \"createFromTemplate/parent/:parentEntityType/:parentUnique/:template\",\n        component: FormsWorkspaceEditorElement,\n        setup: this.#createOnWorkspaceContext,\n      },\n      {\n        path: \"edit/:unique\",\n        component: FormsWorkspaceEditorElement,\n        setup: (_component, info) => {\n          const unique = info.match.params.unique;\n          this.load(unique);\n        },\n      },\n    ]);\n  }\n\n  #createOnWorkspaceContext = async (_component, info) => {\n    const parentEntityType = info.match.params.parentEntityType;\n    const parentUnique =\n      info.match.params.parentUnique === \"null\"\n        ? null\n        : info.match.params.parentUnique;\n    const template = info.match.params.template;\n\n    await this.create(\n      { entityType: parentEntityType, unique: parentUnique },\n      template,\n    );\n  };\n\n  async load(id: string) {\n    this.#getDataPromise = this.formRepository?.requestByUnique(id);\n    const { data } = await this.#getDataPromise;\n\n    if (data) {\n      this.setIsNew(false);\n      this.#data.update(data);\n    }\n  }\n\n  async create(\n    parent: { entityType: string; unique: string | null },\n    template: string | null,\n  ) {\n    this.#parent = parent;\n    const scaffold = await this.formRepository.requestFormScaffold(\n      template || \"\",\n    );\n\n    let data = scaffold.data;\n    if (!data) throw new Error(\"Form design data is missing\");\n\n    data.folderId = parent.unique;\n\n    if (this.modalContext) {\n      data = {\n        ...data,\n        ...this.modalContext.data.preset,\n      };\n    }\n\n    this.setIsNew(true);\n    this.#data.setValue(data);\n\n    return { data };\n  }\n\n  async requestSave() {\n    await this.submit();\n  }\n\n  async submit(): Promise<void> {\n    if (!this.#data.value) return;\n    if (!this.#data.value.unique) return;\n\n    if (this.#data.value.name.trim().length === 0) {\n      const notificationContext = await this.getContext(\n        UMB_NOTIFICATION_CONTEXT,\n      );\n      const localize = new UmbLocalizationController(this);\n      notificationContext?.peek(\"danger\", {\n        data: {\n          message: localize.term(\"formEdit_noNameForForm\"),\n        },\n      });\n\n      return Promise.reject();\n    }\n\n    const eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\n\n    if (this.getIsNew()) {\n      if (!this.#parent) throw new Error(\"Parent is not set\");\n\n      await this.formRepository?.create(this.#data.value, this.#parent.unique);\n\n      const event = new UmbRequestReloadChildrenOfEntityEvent({\n        entityType: this.#parent.entityType,\n        unique: this.#parent.unique,\n      });\n      eventContext?.dispatchEvent(event);\n\n      this.setIsNew(false);\n    } else {\n      await this.formRepository?.save(this.#data.value);\n\n      const event = new UmbRequestReloadStructureForEntityEvent({\n        unique: this.getUnique()!,\n        entityType: this.getEntityType(),\n      });\n      eventContext?.dispatchEvent(event);\n    }\n  }\n\n  async loadFieldType(id: string) {\n    const { data } = await this.fieldTypeRepository.requestByUnique(id);\n    return data;\n  }\n\n  async loadWorkflowType(id: string) {\n    const { data } = await this.workflowTypeRepository.requestByUnique(id);\n    return data;\n  }\n\n  async loadValidationPatterns() {\n    const { data } = await this.fieldTypeRepository.requestValidationPatterns();\n    return data;\n  }\n\n  async loadPrevalueSources() {\n    const { data } =\n      await this.prevalueSourceCollectionRepository.requestCollection({});\n    return data?.items;\n  }\n\n  getData() {\n    return this.#data.getValue();\n  }\n\n  getUnique() {\n    return this.getData()?.unique || \"\";\n  }\n\n  getEntityType(): string {\n    return FORMS_FORM_ENTITY_TYPE;\n  }\n\n  getName() {\n    return this.#data.getValue()?.name;\n  }\n\n  setName(name: string) {\n    this.#data.update({ name });\n  }\n\n  setFormProperty(alias: string, value: unknown) {\n    this.#data.update({ [alias]: value });\n  }\n\n  getFormProperty(alias: string) {\n    return this.getData()?.[alias];\n  }\n\n  setPageProperty(pageIndex: number, alias: string, value: unknown) {\n    const pages = this.#data.value?.pages.map((p, i) => ({\n      ...p,\n      ...(i === pageIndex && {\n        [alias]: value,\n      }),\n    }));\n    this.setFormProperty(\"pages\", pages);\n  }\n\n  setFieldsetProperty(\n    pageIndex: number,\n    fieldsetIndex: number,\n    alias: string,\n    value: unknown,\n  ) {\n    const fieldSetsForPage = this.#data.value?.pages[pageIndex].fieldSets.map(\n      (fs, i) => ({\n        ...fs,\n        ...(i === fieldsetIndex && {\n          [alias]: value,\n        }),\n      }),\n    );\n    this.setPageProperty(pageIndex, \"fieldSets\", fieldSetsForPage);\n  }\n\n  setContainerProperty(\n    pageIndex: number,\n    fieldsetIndex: number,\n    containerIndex: number,\n    alias: string,\n    value: unknown,\n  ) {\n    const containersForFieldSet = this.#data.value?.pages[pageIndex].fieldSets[\n      fieldsetIndex\n    ].containers.map((c, i) => ({\n      ...c,\n      ...(i === containerIndex && {\n        [alias]: value,\n      }),\n    }));\n    this.setFieldsetProperty(\n      pageIndex,\n      fieldsetIndex,\n      \"containers\",\n      containersForFieldSet,\n    );\n  }\n\n  setFieldProperty(\n    pageIndex: number,\n    fieldsetIndex: number,\n    containerIndex: number,\n    fieldIndex: number,\n    alias: string,\n    value: unknown,\n  ) {\n    const fieldsForContainer = this.#data.value?.pages[pageIndex].fieldSets[\n      fieldsetIndex\n    ].containers[containerIndex].fields.map((f, i) => ({\n      ...f,\n      ...(i === fieldIndex && {\n        [alias]: value,\n      }),\n    }));\n    this.setContainerProperty(\n      pageIndex,\n      fieldsetIndex,\n      containerIndex,\n      \"fields\",\n      fieldsForContainer,\n    );\n  }\n\n  setWorkflowProperty(\n    collectionName: string,\n    index: number,\n    alias: string,\n    value: unknown,\n  ) {\n    const formWorkflows = structuredClone(this.#data.value?.formWorkflows);\n    if (formWorkflows) {\n      formWorkflows[collectionName][index][alias] = value;\n      this.setFormProperty(\"formWorkflows\", formWorkflows);\n    }\n  }\n\n  moveFieldSet(\n    currentPageIndex: number,\n    currentFieldsetIndex: number,\n    newPageIndex: number,\n  ) {\n    if (newPageIndex === currentPageIndex) return;\n    const pages = structuredClone(this.#data.value?.pages);\n    if (pages) {\n      const currentPage = pages[currentPageIndex];\n      const fieldSet = currentPage.fieldSets.splice(currentFieldsetIndex, 1)[0];\n      const newPage = pages[newPageIndex];\n      newPage.fieldSets.push(fieldSet);\n      this.setFormProperty(\"pages\", pages);\n    }\n  }\n\n  moveField(fieldId: string, currentIndexPath: string, newIndexPath: string) {\n    if (currentIndexPath === newIndexPath) return;\n\n    const pages = structuredClone(this.#data.value?.pages);\n    if (pages) {\n      const currentContainer = this.#getContainerFromIndexPath(\n        pages,\n        currentIndexPath,\n      );\n      const newContainer = this.#getContainerFromIndexPath(pages, newIndexPath);\n\n      const fieldIndex = currentContainer.fields.findIndex(\n        (f) => f.id == fieldId,\n      );\n      const field = currentContainer.fields.splice(fieldIndex, 1)[0];\n      newContainer.fields.push(field);\n      this.setFormProperty(\"pages\", pages);\n    }\n  }\n\n  moveWorkflow(\n    workflowIndex: number,\n    fromCollectionName: string,\n    toCollectionName: string,\n  ) {\n    if (!this.#data.value) return;\n    const workflows = structuredClone(this.#data.value.formWorkflows);\n    const fromCollection = workflows[fromCollectionName];\n    const workflow = fromCollection.splice(workflowIndex, 1)[0];\n    const toCollection = workflows[toCollectionName];\n    toCollection.push(workflow);\n    this.setFormProperty(\"formWorkflows\", workflows);\n  }\n\n  #getContainerFromIndexPath(pages: Array<Page>, path: string) {\n    const pathParts = path.split(\"_\").map((s) => parseInt(s));\n    return pages[pathParts[0]].fieldSets[pathParts[1]].containers[pathParts[2]];\n  }\n\n  getAllPages() {\n    const form = this.getData();\n    if (!form) return [];\n\n    const pages: Array<Page> = [];\n    form.pages.forEach((p) => {\n      pages.push(p);\n    });\n\n    return pages;\n  }\n\n  getAllContainers() {\n    const form = this.getData();\n    if (!form) return [];\n\n    const containers: Array<FieldsetContainer> = [];\n    form.pages.forEach((p) => {\n      p.fieldSets.forEach((fs) => {\n        fs.containers.forEach((c) => {\n          containers.push(c);\n        });\n      });\n    });\n\n    return containers;\n  }\n\n  getAllFields() {\n    const containers = this.getAllContainers();\n\n    const fields: Array<Field> = [];\n    containers.forEach((c) => {\n      c.fields.forEach((f) => {\n        fields.push(f);\n      });\n    });\n\n    return fields;\n  }\n\n  getAllFieldAliases() {\n    return this.getAllFields().map((f) => f.alias);\n  }\n\n  getFieldsWithPrevalues(): Array<FieldPrevalueDetail> {\n    const allFields = this.getAllFields();\n    const fieldsWithPrevalues = allFields.filter(\n      (f) => f.preValues.length > 0 || f.prevalueSourceId !== GUID_EMPTY,\n    );\n    return fieldsWithPrevalues.map((f) => {\n      return {\n        id: f.id,\n        prevalues: f.preValues,\n        prevalueSourceId: f.prevalueSourceId,\n      };\n    });\n  }\n\n  getContainerIndexPathForField(id: string) {\n    const form = this.getData();\n    if (!form) return \"\";\n\n    for (let p = 0; p < form.pages.length; p++) {\n      const page = form.pages[p];\n      for (let fs = 0; fs < page.fieldSets.length; fs++) {\n        const fieldset = page.fieldSets[fs];\n        for (let c = 0; c < fieldset.containers.length; c++) {\n          const container = fieldset.containers[c];\n          for (let f = 0; f < container.fields.length; f++) {\n            const fieldSetField = container.fields[f];\n            if (fieldSetField.id === id) {\n              return p + \"_\" + fs + \"_\" + c;\n            }\n          }\n        }\n      }\n    }\n\n    return \"\";\n  }\n\n  getConditionActionTypes: Array<ActionType> = [\n    {\n      name: \"Show\",\n      value: \"Show\",\n    },\n    {\n      name: \"Hide\",\n      value: \"Hide\",\n    },\n  ];\n\n  getConditionLogicTypes: Array<LogicType> = [\n    {\n      name: \"all\",\n      value: \"All\",\n    },\n    {\n      name: \"any\",\n      value: \"Any\",\n    },\n  ];\n\n  getConditionOperators: Array<OperatorType> = [\n    {\n      name: \"is\",\n      value: \"Is\",\n    },\n    {\n      name: \"is not\",\n      value: \"IsNot\",\n    },\n    {\n      name: \"is greater than\",\n      value: \"GreaterThen\",\n    },\n    {\n      name: \"is less than\",\n      value: \"LessThen\",\n    },\n    {\n      name: \"contains (case-sensitive)\",\n      value: \"Contains\",\n    },\n    {\n      name: \"contains (case-insensitive)\",\n      value: \"ContainsIgnoreCase\",\n    },\n    {\n      name: \"starts with (case-sensitive)\",\n      value: \"StartsWith\",\n    },\n    {\n      name: \"starts with (case-insensitive)\",\n      value: \"StartsWithIgnoreCase\",\n    },\n    {\n      name: \"ends with\",\n      value: \"EndsWith\",\n    },\n    {\n      name: \"ends with (case-insensitive)\",\n      value: \"EndsWithIgnoreCase\",\n    },\n    {\n      name: \"does not contain (case-sensitive)\",\n      value: \"NotContains\",\n    },\n    {\n      name: \"does not contain (case-insensitive)\",\n      value: \"NotContainsIgnoreCase\",\n    },\n    {\n      name: \"does not start with (case-sensitive)\",\n      value: \"NotStartsWith\",\n    },\n    {\n      name: \"does not start with (case-insensitive)\",\n      value: \"NotStartsWithIgnoreCase\",\n    },\n    {\n      name: \"does not end with (case-sensitive)\",\n      value: \"NotEndsWith\",\n    },\n    {\n      name: \"does not end with (case-insensitive)\",\n      value: \"NotEndsWithIgnoreCase\",\n    },\n  ];\n\n  async getRichTextConfiguration() {\n    const config: UmbPropertyEditorConfigCollection =\n      new UmbPropertyEditorConfigCollection([]);\n\n    const { data, error } = await tryExecute(\n      this,\n      FieldTypeService.getFieldTypeRichtextDatatype()\n    );\n    if (!error) {\n      config.push({\n        alias: \"maxImageSize\",\n        value: data.configurationData.maxImageSize,\n      });\n      config.push({\n        alias: \"overlaySize\",\n        value: data.configurationData.overlaySize,\n      });\n      config.push({\n        alias: \"toolbar\",\n        value: data.configurationData.toolbar,\n      });\n      config.push({\n        alias: \"extensions\",\n        value: data.configurationData.extensions,\n      });\n      config.push({\n        alias: \"stylesheets\",\n        value: data.configurationData.stylesheets,\n      });\n    }\n\n    return config;\n  }\n\n  destroy() {\n    this.#data.destroy();\n\n    super.destroy();\n  }\n}\n\nexport const api = FormsFormWorkspaceContext;\n"],"names":["_workspaceContext","_FormsFormWorkspaceEditorElement_instances","observeId_fn","onChangeName_fn","elementName","FormsFormWorkspaceEditorElement","UmbElementMixin","LitElement","__privateAdd","FORMS_FORM_WORKSPACE_CONTEXT","context","__privateSet","__privateMethod","html","__privateGet","data","e","_a","css","__decorateClass","state","property","customElement","FormsFormWorkspaceContext","UmbSubmittableWorkspaceContextBase","host","FORM_WORKSPACE_ALIAS","_FormsFormWorkspaceContext_instances","_parent","_data","_getDataPromise","_createOnWorkspaceContext","FormsFormDetailRepository","FormsFieldTypeDetailRepository","FormsWorkflowTypeDetailRepository","FormsPrevalueSourceCollectionRepository","UmbObjectState","_component","info","parentEntityType","parentUnique","template","FormsWorkspaceEditorElement","unique","id","parent","notificationContext","UMB_NOTIFICATION_CONTEXT","localize","UmbLocalizationController","eventContext","UMB_ACTION_EVENT_CONTEXT","event","UmbRequestReloadChildrenOfEntityEvent","_b","UmbRequestReloadStructureForEntityEvent","FORMS_FORM_ENTITY_TYPE","name","alias","value","pageIndex","pages","p","i","fieldsetIndex","fieldSetsForPage","fs","containerIndex","containersForFieldSet","fieldIndex","fieldsForContainer","f","collectionName","index","formWorkflows","currentPageIndex","currentFieldsetIndex","newPageIndex","fieldSet","fieldId","currentIndexPath","newIndexPath","currentContainer","getContainerFromIndexPath_fn","newContainer","field","workflowIndex","fromCollectionName","toCollectionName","workflows","workflow","form","containers","c","fields","GUID_EMPTY","page","fieldset","container","config","UmbPropertyEditorConfigCollection","error","tryExecute","FieldTypeService","path","pathParts","s","api"],"mappings":"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"}