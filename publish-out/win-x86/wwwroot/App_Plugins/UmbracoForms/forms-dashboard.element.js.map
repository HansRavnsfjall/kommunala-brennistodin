{"version":3,"file":"forms-dashboard.element.js","sources":["../src/section/dashboards/forms-dashboard/forms-dashboard.element.ts"],"sourcesContent":["import { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\nimport {\n  LitElement,\n  customElement,\n  html,\n  css,\n  when,\n  state,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport { tryExecute } from \"@umbraco-cms/backoffice/resources\";\nimport type {\n  FormSecurityForUser,\n  FormsLicenseModel,\n  UserSecurity,\n} from \"@umbraco-forms/generated\";\nimport {\n  LicensingService,\n  SecurityService,\n  UpdatesService,\n} from \"@umbraco-forms/generated\";\n\nconst elementName = \"forms-dashboard\";\n\n@customElement(elementName)\nexport class FormsDashboardElement extends UmbElementMixin(LitElement) {\n  @state()\n  private _showOverlay = false;\n\n  @state()\n  private _userSecurity?: UserSecurity;\n\n  @state()\n  private _currentVersion?: string;\n\n  @state()\n  private _status?: FormsLicenseModel;\n\n  #create() {}\n\n  async connectedCallback() {\n    super.connectedCallback();\n\n    let security: FormSecurityForUser;\n    [\n      { data: this._status },\n      { data: this._currentVersion },\n      { data: security },\n    ] = await Promise.all([\n      tryExecute(this, LicensingService.getLicensingStatus()),\n      tryExecute(this, UpdatesService.getUpdatesVersion()),\n      tryExecute(\n        this,\n        SecurityService.getSecurityUserCurrentFormSecurity({\n          query: { includeFormFieldDetails: false },\n        }),\n      ),\n    ]);\n\n    this._userSecurity = security.userSecurity;\n  }\n\n  #hasUnrestrictedLicense() {\n    return (\n      this._status?.licenseLimitations.includes(\n        \"*not* associated with any ips or domains\",\n      ) ?? false\n    );\n  }\n\n  #displayLicensedDomains() {\n    if (!this._status?.validDomains) {\n      return null;\n    }\n\n    return html`<ul>\n      ${this._status.validDomains.map((d) => html`<li>${d}</li>`)}\n    </ul>`;\n  }\n\n  render() {\n    return html`\n      ${when(\n        this._showOverlay && this._userSecurity?.manageForms,\n        () =>\n          html` <div class=\"umb-forms-install-overlay\">\n            <uui-button\n              @click=${() => (this._showOverlay = false)}\n              .label=${this.localize.term(\"general_close\")}\n            ></uui-button>\n\n            <div>\n              <div class=\"succes\"></div>\n              <h2>\n                <strong\n                  >${this.localize.term(\n                    \"formsDashboard_installOverlayTitle\",\n                  )}</strong\n                >\n              </h2>\n              <p>\n                ${this.localize.term(\n                  \"formsDashboard_installOverlayDescription\",\n                )}\n              </p>\n\n              <div class=\"divider\"></div>\n\n              <uui-button\n                color=\"positive\"\n                look=\"default\"\n                @click=${this.#create}\n                label=${this.localize.term(\"formsDashboard_createAForm\")}\n              ></uui-button>\n            </div>\n          </div>`,\n      )}\n\n      <forms-licensing .status=${this._status}></forms-licensing>\n\n      ${when(\n        this._currentVersion,\n        () =>\n          html`<small\n            >${this.localize.term(\n              \"formsDashboard_currentVersion\",\n              this._currentVersion,\n            )}</small\n          >`,\n      )}\n\n      <form-grid .config=${this._userSecurity}></form-grid>\n\n      ${when(\n        !this._status?.isTrial &&\n          this._status?.isValid &&\n          !this.#hasUnrestrictedLicense(),\n        () =>\n          html`<small\n              >${this.localize.term(\"formsDashboard_licensedDomains\")}:</small\n            >\n            <small>${this.#displayLicensedDomains()}</small>`,\n      )}\n    `;\n  }\n\n  static styles = [\n    css`\n      :host {\n        display: block;\n        padding: var(--uui-size-layout-1);\n      }\n\n      @media (min-width: 1024px) {\n        uui-box {\n          display: block;\n          max-width: calc(100% - 300px);\n        }\n      }\n\n      form-grid {\n        display: block;\n        margin-bottom: 20px;\n      }\n    `,\n  ];\n}\n\nexport default FormsDashboardElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsDashboardElement;\n  }\n}\n"],"names":["_FormsDashboardElement_instances","create_fn","hasUnrestrictedLicense_fn","displayLicensedDomains_fn","elementName","FormsDashboardElement","UmbElementMixin","LitElement","__privateAdd","security","tryExecute","LicensingService","UpdatesService","SecurityService","html","when","_a","__privateMethod","_b","_c","d","css","__decorateClass","state","customElement","FormsDashboardElement$1"],"mappings":"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"}