{"version":3,"file":"standard-field-mapper-property-editor.element.js","sources":["../src/property-editor/standard-field-mapper/standard-field-mapper-property-editor.element.ts"],"sourcesContent":["import {\n  html,\n  customElement,\n  property,\n  css,\n} from \"@umbraco-cms/backoffice/external/lit\";\nimport type { UmbPropertyEditorUiElement } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\nimport type { UUIInputEvent } from \"@umbraco-ui/uui-input\";\n\nconst elementName = \"forms-standard-field-mapper-property-editor\";\n\nexport type StandardFieldMapping = {\n  field: string;\n  include: boolean;\n  keyName?: string;\n};\n\n@customElement(elementName)\nexport class FormsStandardFieldMapperPropertyUiElement\n  extends UmbLitElement\n  implements UmbPropertyEditorUiElement\n{\n  #value: string = \"\";\n\n  @property({ type: String })\n  get value() {\n    return this.#value;\n  }\n  set value(value: string) {\n    const oldVal = this.#value;\n    this.#value = value;\n    this.requestUpdate(\"value\", oldVal);\n\n    this.#initializeMappings(value);\n  }\n\n  #mappings: Array<StandardFieldMapping> = [];\n\n  #initializeMappings(value?: string) {\n    if (value && value.length > 0) {\n      this.#mappings = JSON.parse(value);\n      this.#cleanMappings();\n    }\n\n    // Add standard mappings. We could add more to these after the initial release, so will make sure to\n    // check each one to see if exists from the saved setting value.\n    // Should include all defined in Umbraco.Forms.Core.Providers.Models.StandardFieldMapping.\n    this.#ensureDefaultMapping(\"FormId\");\n    this.#ensureDefaultMapping(\"FormName\");\n    this.#ensureDefaultMapping(\"PageUrl\");\n    this.#ensureDefaultMapping(\"SubmissionDate\");\n  }\n\n  #cleanMappings() {\n    // Remove the tracking values added previously in angularjs.\n    for (let index = 0; index < this.#mappings.length; index++) {\n      const mapping = this.#mappings[index];\n      delete mapping[\"$$hashKey\"];\n    }\n  }\n\n  #ensureDefaultMapping(fieldName) {\n    if (!this.#hasMapping(fieldName)) {\n      this.#mappings.push({\n        field: fieldName,\n        include: false,\n      });\n    }\n  }\n\n  #hasMapping(fieldName) {\n    return this.#mappings.find((m) => m.field == fieldName) !== undefined;\n  }\n\n  #getFriendlyName(field) {\n    switch (field) {\n      case \"FormId\":\n        return \"Form ID\";\n      case \"FormName\":\n        return \"Form name\";\n      case \"PageUrl\":\n        return \"Page URL\";\n      case \"SubmissionDate\":\n        return \"Submission date/time\";\n      default:\n        return field;\n    }\n  }\n\n  #onIncludeToggle(idx: number) {\n    this.#mappings[idx].include = !this.#mappings[idx].include;\n    this.#refreshValue();\n  }\n\n  #onKeyNameChange(e: UUIInputEvent, idx: number) {\n    const value = e.target.value.toString();\n    if (value.length > 0) {\n      this.#mappings[idx].keyName = value;\n    } else {\n      this.#mappings[idx].keyName = undefined;\n    }\n\n    this.#refreshValue();\n  }\n\n  #refreshValue() {\n    this.value = JSON.stringify(this.#mappings);\n    this.dispatchEvent(new CustomEvent(\"property-value-change\"));\n  }\n\n  async connectedCallback() {\n    super.connectedCallback();\n  }\n\n  render() {\n    return html`<div class=\"umb-forms-mappings\">\n      <div class=\"umb-forms-mapping-header\">\n        <div class=\"umb-forms-mapping-field -no-margin-left\">Field</div>\n        <div class=\"umb-forms-mapping-field\">Include?</div>\n        <div class=\"umb-forms-mapping-field -no-margin-right\">Key</div>\n      </div>\n\n      ${this.#mappings.map(\n        (mapping, idx) =>\n          html` <div class=\"umb-forms-mapping\">\n            <div class=\"umb-forms-mapping-field -no-margin-left\">\n              <span>${this.#getFriendlyName(mapping.field)}</span>\n            </div>\n            <div\n              class=\"umb-forms-mapping-field\"\n              data-umb-standard-field-mapping-include=\"${mapping.field}\"\n            >\n              <uui-toggle\n                ?checked=${mapping.include}\n                @change=${() => this.#onIncludeToggle(idx)}\n              ></uui-toggle>\n            </div>\n            <div\n              class=\"umb-forms-mapping-field -no-margin-right\"\n              data-umb-standard-field-mapping-key-name=\"${mapping.field}\"\n            >\n              <uui-input\n                type=\"text\"\n                label=\"Key\"\n                placeholder=\"Key name\"\n                .value=${mapping.keyName || \"\"}\n                @change=${(e) => this.#onKeyNameChange(e, idx)}\n              ></uui-input>\n            </div>\n          </div>`,\n      )}\n    </div>`;\n  }\n\n  static styles = [\n    css`\n      .umb-forms-mappings {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .umb-forms-mapping-header {\n        display: flex;\n        flex-direction: row;\n        font-weight: bold;\n      }\n\n      .umb-forms-mapping {\n        display: flex;\n        flex-direction: row;\n        margin-bottom: 5px;\n        align-items: center;\n      }\n\n      .umb-forms-mapping-field {\n        flex: 1 1 33%;\n        margin: 5px;\n      }\n\n      .umb-forms-mapping-field input,\n      .umb-forms-mapping-field select {\n        margin-bottom: 0;\n      }\n\n      .umb-forms-mapping-field.-no-margin-left {\n        margin-left: 0;\n      }\n\n      .umb-forms-mapping-remove {\n        flex: 1 1 20px;\n        margin: 5px;\n      }\n\n      .umb-forms-mapping-remove.-no-margin-right {\n        margin-right: 0;\n      }\n    `,\n  ];\n}\n\nexport default FormsStandardFieldMapperPropertyUiElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    [elementName]: FormsStandardFieldMapperPropertyUiElement;\n  }\n}\n"],"names":["_value","_mappings","_FormsStandardFieldMapperPropertyUiElement_instances","initializeMappings_fn","cleanMappings_fn","ensureDefaultMapping_fn","hasMapping_fn","getFriendlyName_fn","onIncludeToggle_fn","onKeyNameChange_fn","refreshValue_fn","elementName","FormsStandardFieldMapperPropertyUiElement","UmbLitElement","__privateAdd","__privateGet","value","oldVal","__privateSet","__privateMethod","html","mapping","idx","e","index","fieldName","m","field","css","__decorateClass","property","customElement","FormsStandardFieldMapperPropertyUiElement$1"],"mappings":"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"}