{"version":3,"file":"default.element-D3PNVpMP.js","sources":["../../../usync-exporter-assets/src/workspace/views/default.element.ts"],"sourcesContent":["import {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport SyncExporterWorkspaceContext, {\r\n\tUSYNC_EXPORTER_WORKSPACE_CONTEXT,\r\n} from '../workspace.context';\r\nimport { ChangeType, DependencyFlags, ExportGroup } from '../../api';\r\nimport {\r\n\tUMB_MODAL_MANAGER_CONTEXT,\r\n\tUmbModalToken,\r\n\tUmbPickerModalValue,\r\n} from '@umbraco-cms/backoffice/modal';\r\nimport uSyncExporter from '../../constants';\r\nimport { SyncExportSelectedItem } from '../types';\r\nimport { JUMOO_PROCESSING_DIALOG_MODAL } from '@jumoo/processing';\r\n\r\n@customElement('usync-exporter-default-view-element')\r\nexport class uSyncExporterDefaultViewElement extends UmbLitElement {\r\n\t#context?: SyncExporterWorkspaceContext;\r\n\r\n\t@state()\r\n\texporters: ExportGroup[] = [];\r\n\r\n\t@state()\r\n\titemList: SyncExportSelectedItem[] = [];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(USYNC_EXPORTER_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\r\n\t\t\tthis.#context = context;\r\n\r\n\t\t\tthis.#context.GetSettings();\r\n\r\n\t\t\tthis.#context.GetExporters().then((exporters) => {\r\n\t\t\t\tthis.exporters = exporters ?? [];\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #openDialog(item: any) {\r\n\t\tconst modal = uSyncExporter.modals.find((m) => m.entityType == item.entityType);\r\n\t\tif (!modal) {\r\n\t\t\talert('No modal found for [' + item.entityType + ']');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalManager) return;\r\n\r\n\t\tconst modalContext = modalManager.open(this, modal.modal as UmbModalToken<any>, {\r\n\t\t\tdata: {\r\n\t\t\t\thideTreeRoot: true,\r\n\t\t\t\tmultiple: true,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst modalData = (await modalContext.onSubmit()) as UmbPickerModalValue;\r\n\t\tif (!modalData) return;\r\n\r\n\t\tconst selectionMapped = modalData.selection.map((selection) => {\r\n\t\t\treturn {\r\n\t\t\t\tentityType: item.entityType ?? '',\r\n\t\t\t\tid: selection ?? '',\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tthis.#context?.GetItemInfo(selectionMapped).then((info) => {\r\n\t\t\tif (!info) return;\r\n\r\n\t\t\tvar mapped: SyncExportSelectedItem[] = info.map((item) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tudi: item.udi,\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\ticon: item.icon,\r\n\t\t\t\t\tentityType: item.entityType,\r\n\t\t\t\t\tincludeChildren: true,\r\n\t\t\t\t\tincludeDependencies: true,\r\n\t\t\t\t\tincludeAncestors: true,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t// ensure we don't add duplicates to the list.\r\n\t\t\tthis.itemList = [...this.itemList, ...mapped].filter((item, index, self) => {\r\n\t\t\t\treturn index === self.findIndex((t) => t.udi === item.udi);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #openExportDialog() {\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalManager) return;\r\n\r\n\t\tconst exportModal = modalManager.open(this, JUMOO_PROCESSING_DIALOG_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: uSyncExporter.process.pipeline,\r\n\t\t\t\tstrategy: uSyncExporter.process.export,\r\n\t\t\t\tprogressLabel: 'Export',\r\n\t\t\t\toptions: {\r\n\t\t\t\t\t$type: 'ExporterSyncPackProcessingOptions',\r\n\t\t\t\t\titems: this.itemList.map((item) => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tudi: item.udi,\r\n\t\t\t\t\t\t\tname: item.name,\r\n\t\t\t\t\t\t\t// flags: DependencyFlags.INCLUDE_CHILDREN,\r\n\t\t\t\t\t\t\tflags: this.#GetFlags(item),\r\n\t\t\t\t\t\t\tchange: ChangeType.EXPORT,\r\n\t\t\t\t\t\t\tentityType: item.entityType,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tcreateRestorePoint: false,\r\n\t\t\t\t\tincludeFiles: false,\r\n\t\t\t\t\tincludeMediaFiles: false,\r\n\t\t\t\t},\r\n\t\t\t\theadline: 'Export Sync-Pack',\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t// const exportModal = modalManager.open(this, USYNC_EXPORTER_EXPORT_MODAL, {\r\n\t\t// \tdata: {\r\n\t\t// \t\tselection: this.itemList,\r\n\t\t// \t},\r\n\t\t// });\r\n\r\n\t\tconst data = await exportModal.onSubmit().catch((_rejected) => {\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tif (!data) return;\r\n\t}\r\n\r\n\t#GetFlags(item: SyncExportSelectedItem) {\r\n\t\tlet flags = [];\r\n\t\tflags.push(DependencyFlags.INCLUDE_MEDIA);\r\n\r\n\t\tif (item.includeChildren) flags.push(DependencyFlags.INCLUDE_CHILDREN);\r\n\t\tif (item.includeDependencies) flags.push(DependencyFlags.INCLUDE_DEPENDENCIES);\r\n\t\tif (item.includeAncestors) flags.push(DependencyFlags.INCLUDE_ANCESTORS);\r\n\t\tif (flags.length === 0) flags.push(DependencyFlags.NONE);\r\n\r\n\t\treturn flags.join(',');\r\n\t}\r\n\r\n\tasync #removeItem(e: CustomEvent) {\r\n\t\tconst item = e.detail as SyncExportSelectedItem;\r\n\t\tthis.itemList = this.itemList.filter((i) => i.udi !== item.udi);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst groups = this.exporters.map((group) => {\r\n\t\t\tconst items = group.exporters?.map((item) => {\r\n\t\t\t\treturn html`<div>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t.label=${item.name}\r\n\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t@click=${() => this.#openDialog(item)}>\r\n\t\t\t\t\t\t<div><umb-icon .name=${item.icon}></umb-icon> ${item.name}</div>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t</div>`;\r\n\t\t\t});\r\n\r\n\t\t\treturn html`<div class=\"export-group\">\r\n\t\t\t\t<h3>${group.group ?? 'group'}</h3>\r\n\t\t\t\t<div class=\"group\">${items}</div>\r\n\t\t\t</div>`;\r\n\t\t});\r\n\r\n\t\treturn html` <umb-body-layout>\r\n\t\t\t<usync-licence-notice></usync-licence-notice>${when(\r\n\t\t\t\tgroups.length > 0,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-box>\r\n\t\t\t\t\t\t<div slot=\"headline\" id=\"header\">\r\n\t\t\t\t\t\t\t<h3>Export</h3>\r\n\t\t\t\t\t\t\t<small>Choose the things you want to export</small>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t${groups}</uui-box\r\n\t\t\t\t\t>`,\r\n\t\t\t)}\r\n\t\t\t${this.itemList.length > 0\r\n\t\t\t\t? html`\r\n\t\t\t\t\t\t<uui-box headline=\"Contents\">\r\n\t\t\t\t\t\t\t<usync-exporter-selection\r\n\t\t\t\t\t\t\t\t.selection=${this.itemList}\r\n\t\t\t\t\t\t\t\t@remove=${this.#removeItem}>\r\n\t\t\t\t\t\t\t</usync-exporter-selection>\r\n\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlabel=\"Export\"\r\n\t\t\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t\t\t@click=${this.#openExportDialog}></uui-button>\r\n\t\t\t\t\t\t</uui-box>\r\n\t\t\t\t\t`\r\n\t\t\t\t: nothing}\r\n\t\t</umb-body-layout>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t#header h3 {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\tuui-box {\r\n\t\t\tmargin-bottom: 10px;\r\n\t\t}\r\n\r\n\t\t.export-group {\r\n\t\t\tmargin-bottom: 20px;\r\n\t\t}\r\n\r\n\t\t.export-group h3 {\r\n\t\t\tmargin: 0 -20px 15px;\r\n\t\t\tpadding: 0 20px 5px;\r\n\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t}\r\n\r\n\t\t.group {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-wrap: wrap;\r\n\t\t\tgap: 10px;\r\n\t\t}\r\n\r\n\t\tuui-button > div {\r\n\t\t\tdisplay: flex;\r\n\t\t\tgap: 10px;\r\n\t\t\tmin-width: 200px;\r\n\t\t\talign-items: center;\r\n\t\t\tfont-size: 12pt;\r\n\t\t\tpadding: 10px;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default uSyncExporterDefaultViewElement;\r\n"],"names":["_context","_uSyncExporterDefaultViewElement_instances","openDialog_fn","openExportDialog_fn","GetFlags_fn","removeItem_fn","uSyncExporterDefaultViewElement","UmbLitElement","__privateAdd","USYNC_EXPORTER_WORKSPACE_CONTEXT","context","__privateSet","__privateGet","exporters","groups","group","items","_a","item","html","__privateMethod","when","nothing","modal","uSyncExporter","m","modalManager","UMB_MODAL_MANAGER_CONTEXT","modalData","selectionMapped","selection","info","mapped","index","self","t","JUMOO_PROCESSING_DIALOG_MODAL","ChangeType","_rejected","flags","DependencyFlags","css","__decorateClass","state","customElement","uSyncExporterDefaultViewElement$1"],"mappings":"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"}