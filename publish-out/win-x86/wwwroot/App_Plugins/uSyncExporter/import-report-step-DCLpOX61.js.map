{"version":3,"file":"import-report-step-DCLpOX61.js","sources":["../../../usync-exporter-assets/src/processing/import/import-report-step.ts"],"sourcesContent":["import {\r\n\tJUMOO_PROCESSING_CONTEXT,\r\n\tPipelineContext,\r\n\tProcessStepElement,\r\n\tProcessStepElementBase,\r\n} from '@jumoo/processing';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { uSyncExporterSteps } from '../constants';\r\nimport { ChangeType, ExporterSyncPackProcessingOptions } from '../../api';\r\n\r\n@customElement(uSyncExporterSteps.import.report)\r\nexport class uSyncImportReportStep\r\n\textends ProcessStepElementBase\r\n\timplements ProcessStepElement\r\n{\r\n\t#pipelineContext?: PipelineContext;\r\n\r\n\t@state()\r\n\tpending?: ExporterSyncPackProcessingOptions;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(JUMOO_PROCESSING_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\r\n\t\t\tthis.#pipelineContext = context;\r\n\r\n\t\t\tthis.observe(context.pending, (_pending) => {\r\n\t\t\t\tif (!_pending) return;\r\n\t\t\t\tthis.pending = _pending as unknown as ExporterSyncPackProcessingOptions;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tconnectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tvar actions = this.results?.results['actions'] as any[];\r\n\t\tvar changes = this.#getChangeCount(actions);\r\n\r\n\t\tthis.#pipelineContext?.primePending();\r\n\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('pipeline-valid', {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tvalid: changes > 0,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\t#getChangeCount(results: any[]): number {\r\n\t\tlet changes = 0;\r\n\t\tresults?.forEach((r) => {\r\n\t\t\tif (r.change !== ChangeType.NO_CHANGE) {\r\n\t\t\t\tchanges++;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn changes;\r\n\t}\r\n\r\n\t#onCreateRestoreChange(e: Event) {\r\n\t\tif (!this.options) return;\r\n\r\n\t\tconst element = e.target as HTMLInputElement;\r\n\t\tif (!element) return;\r\n\r\n\t\tconsole.log('create restore point', element.checked);\r\n\r\n\t\tthis.#pipelineContext?.setPending({\r\n\t\t\tcreateRestorePoint: element.checked,\r\n\t\t});\r\n\t}\r\n\r\n\t#onChangePasswordConfig(e: Event) {\r\n\t\tif (!this.options) return;\r\n\r\n\t\tconst element = e.target as HTMLInputElement;\r\n\t\tif (!element) return;\r\n\r\n\t\tconsole.log('change password config', element.value);\r\n\r\n\t\tthis.#pipelineContext?.setPending({\r\n\t\t\tpasswordConfig: element.value,\r\n\t\t});\r\n\t}\r\n\r\n\t#hasUserChanges(actions: any[]) {\r\n\t\treturn actions.some(\r\n\t\t\t(a) =>\r\n\t\t\t\ta.change !== ChangeType.NO_CHANGE &&\r\n\t\t\t\t(a.itemType === 'IUser' || a.itemType === 'IMember'),\r\n\t\t);\r\n\t}\r\n\r\n\trender() {\r\n\t\tvar actions = this.results?.results['actions'] as any[];\r\n\t\tvar count = actions?.length;\r\n\t\tvar changes = this.#getChangeCount(actions);\r\n\r\n\t\treturn changes == 0\r\n\t\t\t? this.renderEmpty(changes, count, actions)\r\n\t\t\t: html`<div>\r\n\t\t\t\t\t${this.renderResults(changes, actions)} ${this.renderImportOptions()}\r\n\t\t\t\t\t${this.renderUserOptions()}\r\n\t\t\t\t</div>`;\r\n\t}\r\n\r\n\trenderEmpty(changes: number, count: number, actions: any[]) {\r\n\t\treturn html`<uui-box class=\"no-change\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<uui-icon name=\"icon-check\"></uui-icon>\r\n\t\t\t\t\t<h3>Imported Sync-pack contains no changes (${count} items)</h3>\r\n\t\t\t\t</div>\r\n\t\t\t</uui-box>\r\n\t\t\t${this.renderResults(changes, actions)}`;\r\n\t}\r\n\r\n\trenderResults(count: number, actions: any[]) {\r\n\t\treturn html`<uui-box>\r\n\t\t\t<div slot=\"header\">\r\n\t\t\t\t<em>Imported Sync-pack contains ${count} changes</em>\r\n\t\t\t</div>\r\n\t\t\t<usync-results .results=${actions}></usync-results>\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderImportOptions() {\r\n\t\tconst options = this.options as unknown as ExporterSyncPackProcessingOptions;\r\n\r\n\t\treturn html` <uui-box headline=\"Restore options\">\r\n\t\t\t<umb-localize key=\"uSyncImport_importReportOptions\">\r\n\t\t\t\t<umb-property-layout label=\"Create restore point\">\r\n\t\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t\t<uui-checkbox\r\n\t\t\t\t\t\t\tlabel=\"Create restore point\"\r\n\t\t\t\t\t\t\t.checked=${options.createRestorePoint}\r\n\t\t\t\t\t\t\t@change=${this.#onCreateRestoreChange}></uui-checkbox>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</umb-property-layout>\r\n\t\t\t</umb-localize>\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderUserOptions() {\r\n\t\tif (!this.pending) return nothing;\r\n\t\tif (!this.#hasUserChanges(this.results?.results['actions'] as any[])) return nothing;\r\n\r\n\t\tconst configs = [\r\n\t\t\t{ name: 'Default (current version setting)', value: '' },\r\n\t\t\t{ name: 'Umbraco 8', value: '{\"hashAlgorithm\":\"HMACSHA256\"}' },\r\n\t\t\t{ name: 'Umbraco 10+', value: '{\"hashAlgorithm\":\"PBKDF2.ASPNETCORE.V3\"}' },\r\n\t\t];\r\n\r\n\t\tconst selection = configs.map((config) => {\r\n\t\t\treturn {\r\n\t\t\t\tname: config.name,\r\n\t\t\t\tvalue: config.value,\r\n\t\t\t\tselected: this.pending?.passwordConfig == config.value,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn html` <uui-box headline=\"User options\">\r\n\t\t\t<umb-localize key=\"uSyncImport_importReportOptions\">\r\n\t\t\t\t<umb-property-layout\r\n\t\t\t\t\tlabel=\"Import algorithm\"\r\n\t\t\t\t\tdescription=\"Choose the default hashing algorithm for user passwords\">\r\n\t\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t\t<uui-select\r\n\t\t\t\t\t\t\t.options=${selection}\r\n\t\t\t\t\t\t\t.value=${this.pending.passwordConfig}\r\n\t\t\t\t\t\t\t@change=${this.#onChangePasswordConfig}></uui-select>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<em><small>${this.pending.passwordConfig}</small></em>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</umb-property-layout>\r\n\t\t\t</umb-localize>\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\tuui-box {\r\n\t\t\tmargin-bottom: 20px;\r\n\t\t}\r\n\r\n\t\t.no-change {\r\n\t\t\tbackground-color: var(--uui-color-positive-emphasis);\r\n\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t}\r\n\r\n\t\t.no-change > div {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tgap: 20px;\r\n\t\t}\r\n\r\n\t\t.no-change uui-icon {\r\n\t\t\tfont-size: 32px;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default uSyncImportReportStep;\r\n"],"names":["_pipelineContext","_uSyncImportReportStep_instances","getChangeCount_fn","onCreateRestoreChange_fn","onChangePasswordConfig_fn","hasUserChanges_fn","uSyncImportReportStep","ProcessStepElementBase","__privateAdd","JUMOO_PROCESSING_CONTEXT","context","__privateSet","_pending","actions","_a","changes","__privateMethod","_b","__privateGet","count","html","options","nothing","selection","config","results","ChangeType","element","a","css","__decorateClass","state","customElement","uSyncExporterSteps","uSyncImportReportStep$1"],"mappings":"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"}