{"version":3,"file":"import-upload-step-iNWPvjTi.js","sources":["../../../usync-exporter-assets/src/processing/import/import-upload-step.ts"],"sourcesContent":["import {\r\n\tJUMOO_PROCESSING_CONTEXT,\r\n\tPipelineContext,\r\n\tProcessingOptions,\r\n\tProcessStepElement,\r\n\tProcessStepElementBase,\r\n} from '@jumoo/processing';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tproperty,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { uSyncExporterSteps } from '../constants';\r\nimport {\r\n\tTemporaryFileStatus,\r\n\tUmbTemporaryFileManager,\r\n\tUmbTemporaryFileModel,\r\n} from '@umbraco-cms/backoffice/temporary-file';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\n\r\n@customElement(uSyncExporterSteps.import.upload)\r\nexport class uSyncExporterImportUploadStep\r\n\textends ProcessStepElementBase\r\n\timplements ProcessStepElement\r\n{\r\n\t#fileManager: UmbTemporaryFileManager;\r\n\r\n\t// @ts-ignore\r\n\t#pipelineContext?: PipelineContext;\r\n\r\n\t@property()\r\n\toptions: ProcessingOptions | null | undefined;\r\n\r\n\t@state()\r\n\tselected: File | undefined;\r\n\r\n\t@state()\r\n\tuploaded: boolean = false;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.#fileManager = new UmbTemporaryFileManager(this);\r\n\r\n\t\tthis.observe(this.#fileManager.queue, (value) => {\r\n\t\t\tvalue.forEach((file) => {\r\n\t\t\t\tif (file.status === TemporaryFileStatus.SUCCESS) {\r\n\t\t\t\t\tthis.#onUploadComplete(file.temporaryUnique, file.file);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(JUMOO_PROCESSING_CONTEXT, (context) => {\r\n\t\t\tthis.#pipelineContext = context;\r\n\t\t});\r\n\t}\r\n\r\n\tconnectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.setValid(false);\r\n\t}\r\n\r\n\t#onFileChange(e: CustomEvent) {\r\n\t\tthis.selected = e.detail.file;\r\n\t\tif (!this.selected) {\r\n\t\t\tthis.uploaded = false;\r\n\t\t\tthis.setValid(false);\r\n\t\t}\r\n\t}\r\n\r\n\t#onUpload() {\r\n\t\tif (!this.selected) return;\r\n\r\n\t\tconst file = this.selected;\r\n\r\n\t\tconst upload: UmbTemporaryFileModel = {\r\n\t\t\ttemporaryUnique: UmbId.new(),\r\n\t\t\tfile: file,\r\n\t\t\tstatus: TemporaryFileStatus.WAITING,\r\n\t\t};\r\n\r\n\t\tthis.#fileManager.upload([upload]);\r\n\t}\r\n\r\n\t#onUploadComplete(tempId: string, file: File) {\r\n\t\tthis.#pipelineContext?.setPending({\r\n\t\t\tname: tempId,\r\n\t\t\tproperties: {\r\n\t\t\t\tfileId: tempId,\r\n\t\t\t\tfile: {\r\n\t\t\t\t\tname: file.name,\r\n\t\t\t\t\tsize: file.size,\r\n\t\t\t\t\ttype: file.type,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.uploaded = true;\r\n\r\n\t\tthis.setValid(true);\r\n\t}\r\n\r\n\tsetValid(valid: boolean) {\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('pipeline-valid', {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcomposed: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tvalid: valid,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`<uui-box headline=\"Import Sync-Pack\">\r\n\t\t\t\t<div class=\"upload\">${this.renderUpload()} ${this.renderUploadButton()}</div>\r\n\t\t\t</uui-box>\r\n\t\t\t${this.renderReady()}`;\r\n\t}\r\n\r\n\trenderUpload() {\r\n\t\treturn html`<div>\r\n\t\t\t<usync-exporter-file-upload\r\n\t\t\t\tlabel=\"Select a SyncPack file\"\r\n\t\t\t\t@change=${this.#onFileChange}></usync-exporter-file-upload>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\trenderUploadButton() {\r\n\t\tif (!this.selected || this.uploaded == true) return nothing;\r\n\r\n\t\treturn html`<uui-button\r\n\t\t\ttype=\"button\"\r\n\t\t\t@click=${this.#onUpload}\r\n\t\t\tlook=\"primary\"\r\n\t\t\tlabel=\"Upload\"\r\n\t\t\t?disabled=${!this.selected}></uui-button> `;\r\n\t}\r\n\r\n\trenderReady() {\r\n\t\tif (!this.uploaded) return nothing;\r\n\t\treturn html`<div class=\"ready\">\r\n\t\t\t<umb-icon name=\"icon-circle-dotted-active\" color=\"green\"></umb-icon>\r\n\t\t\t<umb-localize key=\"uSyncExport_importReady\"></umb-localize>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\tuui-input-file {\r\n\t\t\twidth: auto;\r\n\t\t}\r\n\r\n\t\t.upload {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: row;\r\n\t\t\tgap: 1rem;\r\n\t\t}\r\n\r\n\t\t.ready {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t\tmargin-top: 5rem;\r\n\t\t\tcolor: var(--uui-color-positive);\r\n\t\t\tfont-weight: bold;\r\n\t\t\tfont-size: 24pt;\r\n\t\t\tgap: 10px;\r\n\t\t}\r\n\r\n\t\t.ready umb-icon {\r\n\t\t\tmargin: 20px;\r\n\t\t\tfont-size: 48pt;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default uSyncExporterImportUploadStep;\r\n"],"names":["_fileManager","_pipelineContext","_uSyncExporterImportUploadStep_instances","onFileChange_fn","onUpload_fn","onUploadComplete_fn","uSyncExporterImportUploadStep","ProcessStepElementBase","__privateAdd","__privateSet","UmbTemporaryFileManager","__privateGet","value","file","TemporaryFileStatus","__privateMethod","JUMOO_PROCESSING_CONTEXT","context","valid","html","nothing","upload","UmbId","tempId","_a","css","__decorateClass","property","state","customElement","uSyncExporterSteps","uSyncExporterImportUploadStep$1"],"mappings":"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"}