{"version":3,"file":"add-server.modal-element-Cf-C7S1s.js","sources":["../../../usync-publisher-assets/src/servers/modals/add-server.modal-element.ts"],"sourcesContent":["import { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport {\r\n\tSyncPublisherAddServerData,\r\n\tSyncPublisherAddServerValue,\r\n} from './add-server.modal-token';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport {\r\n\tSyncPublishServerView,\r\n\tSyncServerTemplateModel,\r\n\tUSyncPublishServerStatus,\r\n} from '../../api';\r\nimport { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport SyncPublisherServersContext, {\r\n\tUSYNC_PUBLISHER_SERVER_CONTEXT,\r\n} from '../servers.context';\r\nimport { uSyncPublisher } from '../../constants';\r\n\r\n@customElement('usync-publisher-add-server-modal')\r\nexport class uSyncPublisherAddServerModalElement extends UmbModalBaseElement<\r\n\tSyncPublisherAddServerData,\r\n\tSyncPublisherAddServerValue\r\n> {\r\n\t#context?: SyncPublisherServersContext;\r\n\r\n\t@state()\r\n\tserverName: string = '';\r\n\r\n\t@state()\r\n\tserverUrl: string = '';\r\n\r\n\t@state()\r\n\tserverValid: boolean = false;\r\n\r\n\t@state()\r\n\ttemplateValid: boolean = false;\r\n\r\n\t@state()\r\n\tready: boolean = false;\r\n\r\n\t@state()\r\n\tbuttonState?: UUIButtonState;\r\n\r\n\t@state()\r\n\tresult?: USyncPublishServerStatus;\r\n\r\n\t@state()\r\n\ttemplates?: Array<SyncServerTemplateModel>;\r\n\r\n\t@state()\r\n\tselectedTemplate?: SyncServerTemplateModel;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(USYNC_PUBLISHER_SERVER_CONTEXT, (_context) => {\r\n\t\t\tthis.#context = _context;\r\n\t\t});\r\n\t}\r\n\r\n\tconnectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.serverUrl = this.data?.serverUrl ?? 'blank';\r\n\t}\r\n\r\n\tasync #onConfirm() {\r\n\t\tconst server: SyncPublishServerView = {\r\n\t\t\tkey: uSyncPublisher.emptyGuid,\r\n\t\t\tid: '-1',\r\n\t\t\tname: this.serverName,\r\n\t\t\tsortOrder: 0,\r\n\t\t\tenabled: true,\r\n\t\t\tpullEnabled: true,\r\n\t\t\talias: this.serverName,\r\n\t\t\ticon: '__blank__',\r\n\t\t\tdescription: 'a new server',\r\n\t\t\turl: this.serverUrl,\r\n\t\t\tsendSettings: this.selectedTemplate?.flags,\r\n\t\t\tpublisherSettings: {},\r\n\t\t\tpublisher: this.selectedTemplate?.publisher ?? '',\r\n\t\t\tbaseUrl: '',\r\n\t\t\tallowedServers: [],\r\n\t\t\tpublisherConfig: '',\r\n\t\t\tuserGroups: [],\r\n\t\t};\r\n\r\n\t\t// actually create the server here....\r\n\t\tawait this.#context?.saveServer(server);\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#onCancel() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\t#updateName(e: Event) {\r\n\t\tconst value = (e.target as HTMLInputElement).value;\r\n\t\tthis.serverName = value;\r\n\t}\r\n\r\n\t#updateUrl(e: Event) {\r\n\t\tconst value = (e.target as HTMLInputElement).value;\r\n\t\tthis.serverUrl = value;\r\n\t}\r\n\r\n\t#selectTemplate(e: CustomEvent<SyncServerTemplateModel>) {\r\n\t\tthis.selectedTemplate = e.detail;\r\n\r\n\t\tif (this.selectedTemplate != undefined) {\r\n\t\t\tthis.templateValid = true;\r\n\t\t\tthis.ready = true;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #checkConnection() {\r\n\t\tthis.result = undefined;\r\n\t\tthis.buttonState = 'waiting';\r\n\t\tthis.serverValid = false;\r\n\t\tthis.ready = false;\r\n\r\n\t\tconst result = await this.#context?.checkServerUrl(this.serverUrl);\r\n\t\tthis.result = result;\r\n\r\n\t\tthis.buttonState = result?.enabled ? 'success' : 'failed';\r\n\r\n\t\tthis.serverValid = result?.enabled ?? false;\r\n\r\n\t\t// if (this.serverValid) {\r\n\t\tthis.templates = await this.#context?.getTemplates();\r\n\t\tthis.selectedTemplate = this.templates?.[0];\r\n\t\tthis.ready = true;\r\n\t\t// }\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Add server\">\r\n\t\t\t\t${this.renderServerBox()} ${this.renderResult()} ${this.renderTemplates()}\r\n\t\t\t\t<div slot=\"actions\">${this.renderActions()}</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderServerBox() {\r\n\t\treturn html` <uui-box headline=\"Add a new server\">\r\n\t\t\t<umb-property-layout\r\n\t\t\t\tlabel=\"Name\"\r\n\t\t\t\talias=\"name\"\r\n\t\t\t\torientation=\"vertical\"\r\n\t\t\t\tdescription=\"Name of the server\">\r\n\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tlabel=\"name\"\r\n\t\t\t\t\t\t.disabled=${this.buttonState == 'waiting'}\r\n\t\t\t\t\t\t.value=${this.serverName}\r\n\t\t\t\t\t\t@input=${this.#updateName}></uui-input>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-property-layout>\r\n\r\n\t\t\t<umb-property-layout\r\n\t\t\t\tlabel=\"URL\"\r\n\t\t\t\talias=\"url\"\r\n\t\t\t\torientation=\"vertical\"\r\n\t\t\t\tdescription=\"URL of the server to connect to.\">\r\n\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tlabel=\"url\"\r\n\t\t\t\t\t\t.disabled=${this.buttonState == 'waiting'}\r\n\t\t\t\t\t\t.value=${this.serverUrl}\r\n\t\t\t\t\t\t@input=${this.#updateUrl}></uui-input>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-property-layout>\r\n\r\n\t\t\t<div class=\"buttons\">\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tlabel=\"Check\"\r\n\t\t\t\t\t.state=${this.buttonState}\r\n\t\t\t\t\t.disabled=${this.serverUrl.length == 0 || this.serverName.length == 0}\r\n\t\t\t\t\t@click=${this.#checkConnection}></uui-button>\r\n\t\t\t</div>\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderResult() {\r\n\t\treturn this.result == undefined\r\n\t\t\t? nothing\r\n\t\t\t: html`\r\n\t\t\t\t\t<uui-box class=\"result_${this.result.enabled ? 'success' : 'fail'}\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<h4>${this.result.status}</h4>\r\n\t\t\t\t\t\t\t<small>${this.result.message}</small>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</uui-box>\r\n\t\t\t\t\t${this.renderContinue()}\r\n\t\t\t\t`;\r\n\t}\r\n\r\n\trenderContinue() {\r\n\t\treturn this.serverValid == true\r\n\t\t\t? nothing\r\n\t\t\t: html`<uui-box>\r\n\t\t\t\t\tYou can still set this server up, and resolve the connection issues later.\r\n\t\t\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderTemplates() {\r\n\t\treturn this.ready == false\r\n\t\t\t? nothing\r\n\t\t\t: html` <uui-box headline=\"Select a template\">\r\n\t\t\t\t\t<usync-publisher-template-list\r\n\t\t\t\t\t\t.templates=${this.templates}\r\n\t\t\t\t\t\t@template-selected=${this.#selectTemplate}></usync-publisher-template-list>\r\n\t\t\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderActions() {\r\n\t\treturn html` <uui-button id=\"cancel\" label=\"Cancel\" @click=\"${this.#onCancel}\"\r\n\t\t\t\t>Cancel</uui-button\r\n\t\t\t>\r\n\t\t\t<uui-button\r\n\t\t\t\tid=\"submit\"\r\n\t\t\t\tcolor=\"positive\"\r\n\t\t\t\tlook=\"primary\"\r\n\t\t\t\tlabel=\"Submit\"\r\n\t\t\t\t.disabled=${this.ready == false}\r\n\t\t\t\t@click=${this.#onConfirm}></uui-button>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\r\n        uui-box {\r\n            margin-bottom: 10px;\r\n        }\r\n\r\n        uui-box h4 { \r\n            margin: 0;\r\n        }\r\n\r\n        uui-box.result_success {\r\n            background-color: var(--uui-color-positive);\r\n            color: var(--uui-color-positive-contrast);\r\n        }\r\n\r\n        uui-box.result_fail{\r\n            background-color: var(--uui-color-danger);\r\n            color: var(--uui-color-danger-contrast);\r\n        }\r\n\r\n        uui-input { \r\n            width: 100%;\r\n        }\r\n\r\n        .buttons {\r\n            display: flex;\r\n            justify-content: center;\r\n        }\r\n\r\n        .\r\n    `;\r\n}\r\n\r\nexport default uSyncPublisherAddServerModalElement;\r\n"],"names":["_context","_uSyncPublisherAddServerModalElement_instances","onConfirm_fn","onCancel_fn","updateName_fn","updateUrl_fn","selectTemplate_fn","checkConnection_fn","uSyncPublisherAddServerModalElement","UmbModalBaseElement","__privateAdd","USYNC_PUBLISHER_SERVER_CONTEXT","__privateSet","_a","html","__privateMethod","nothing","server","uSyncPublisher","_b","_c","__privateGet","_d","value","result","css","__decorateClass","state","customElement","uSyncPublisherAddServerModalElement$1"],"mappings":"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"}