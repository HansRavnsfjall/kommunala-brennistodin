{"version":3,"file":"lang-step.element-h8p9VjoY.js","sources":["../../../usync-publisher-assets/src/strategies/common/lang-step.element.ts"],"sourcesContent":["import {\r\n\tJUMOO_PROCESSING_CONTEXT,\r\n\tPipelineContext,\r\n\tProcessStepElement,\r\n\tProcessStepElementBase,\r\n} from '@jumoo/processing';\r\nimport { SyncPublisherStratey } from '../constants';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport {\r\n\tContentService,\r\n\tPublisherProcessingOptions,\r\n\tSyncPublisherVariantsResult,\r\n\tUdiModel,\r\n} from '../../api';\r\n\r\n@customElement(SyncPublisherStratey.elements.language)\r\nexport class SyncPublishPushLangStepElement\r\n\textends ProcessStepElementBase\r\n\timplements ProcessStepElement\r\n{\r\n\t#pipelineContext?: PipelineContext;\r\n\r\n\t@state()\r\n\tcultures: string[] = [];\r\n\r\n\t@state()\r\n\tincludeUnpublished: boolean = false;\r\n\r\n\t@state()\r\n\tallSelected: boolean = false;\r\n\r\n\t@state()\r\n\tnonSelected: boolean = false;\r\n\r\n\t@state()\r\n\tprimaryItem?: UdiModel;\r\n\r\n\t@state()\r\n\tvariants?: SyncPublisherVariantsResult[];\r\n\r\n\t#variantsLoaded: boolean = false;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(JUMOO_PROCESSING_CONTEXT, (context) => {\r\n\t\t\tif (!context) return;\r\n\r\n\t\t\tthis.#pipelineContext = context;\r\n\r\n\t\t\tthis.observe(this.#pipelineContext.options, async (options) => {\r\n\t\t\t\tconst publisherOptions = options as PublisherProcessingOptions;\r\n\t\t\t\tthis.primaryItem = publisherOptions.items[0].udi;\r\n\r\n\t\t\t\tawait this.initializeVariants();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync initializeVariants() {\r\n\t\tif (this.#variantsLoaded) return;\r\n\r\n\t\tawait this._loadVariants();\r\n\t\tthis.#variantsLoaded = true;\r\n\r\n\t\tthis._setCultures();\r\n\t\tthis._calculateCultures();\r\n\t}\r\n\r\n\tasync _loadVariants() {\r\n\t\tthis.variants = (\r\n\t\t\tawait ContentService.getVariants({ query: { udiValue: this.primaryItem } })\r\n\t\t).data;\r\n\t}\r\n\r\n\t_setCultures() {\r\n\t\tif (!this.variants) return;\r\n\r\n\t\tthis.variants.forEach((variant) => {\r\n\t\t\tvariant.selected = variant.isPublished;\r\n\t\t});\r\n\t}\r\n\r\n\t_calculateCultures() {\r\n\t\tthis.cultures = [];\r\n\t\tif (!this.variants) return;\r\n\r\n\t\tthis.variants.forEach((variant) => {\r\n\t\t\tif (variant.selected) {\r\n\t\t\t\tthis.cultures.push(variant.name);\r\n\t\t\t\tif (variant.isPublished == false) {\r\n\t\t\t\t\tthis.includeUnpublished = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.allSelected = this.cultures.length == this.variants.length;\r\n\t\tthis.nonSelected = this.cultures.length == 0;\r\n\r\n\t\tif (this.allSelected) this.cultures = [];\r\n\r\n\t\tthis.#pipelineContext?.setPending({ cultures: this.cultures });\r\n\t}\r\n\r\n\t#onSelectLanguage(v: SyncPublisherVariantsResult) {\r\n\t\tv.selected = !v.selected;\r\n\t\tthis._calculateCultures();\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (!this.variants) return nothing;\r\n\r\n\t\tconst languages = this.variants.map((variant) => {\r\n\t\t\treturn html` <div\r\n\t\t\t\tclass=\"lang-item ${variant.isPublished ? 'published' : 'unpublished'}\">\r\n\t\t\t\t<uui-checkbox\r\n\t\t\t\t\tid=\"lang_item_${variant.name}\"\r\n\t\t\t\t\t.checked=${variant.selected}\r\n\t\t\t\t\t@change=${() => this.#onSelectLanguage(variant)}></uui-checkbox>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<label for=\"lang_item_${variant.name}\">${variant.displayName}</label>\r\n\t\t\t\t\t<div>${variant.isPublished ? 'published' : 'unpublished'}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`;\r\n\t\t});\r\n\r\n\t\treturn html`<uui-box>\r\n\t\t\t\t<div slot=\"header\" class=\"header\">\r\n\t\t\t\t\t<h3>Languages</h3>\r\n\t\t\t\t\t<div>Select what languages to syncronise</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t${languages}</uui-box\r\n\t\t\t>\r\n\t\t\t${this.renderPartialWarning()}`;\r\n\t}\r\n\r\n\trenderPartialWarning() {\r\n\t\tif (this.allSelected) return nothing;\r\n\t\treturn html`<uui-box class=\"info\">\r\n\t\t\t<umb-localize key=\"usyncpublish_partialLangWarning\"></umb-localize>\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t.lang-item {\r\n\t\t\tdisplay: flex;\r\n\t\t\tpadding: 10px;\r\n\t\t}\r\n\r\n\t\t.unpublished {\r\n\t\t\topacity: 0.5;\r\n\t\t}\r\n\r\n\t\tuui-box {\r\n\t\t\tmargin-bottom: 10px;\r\n\t\t}\r\n\r\n\t\tuui-box .header h3 {\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0;\r\n\t\t}\r\n\r\n\t\t.info {\r\n\t\t\tbackground-color: var(--uui-color-positive);\r\n\t\t\tcolor: var(--uui-color-positive-contrast);\r\n\t\t}\r\n\r\n\t\t.warn {\r\n\t\t\tbackground-color: var(--uui-color-warning);\r\n\t\t}\r\n\r\n\t\t.error {\r\n\t\t\tbackground-color: var(--uui-color-danger);\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default SyncPublishPushLangStepElement;\r\n"],"names":["_pipelineContext","_variantsLoaded","_SyncPublishPushLangStepElement_instances","onSelectLanguage_fn","SyncPublishPushLangStepElement","ProcessStepElementBase","__privateAdd","JUMOO_PROCESSING_CONTEXT","context","__privateSet","__privateGet","options","publisherOptions","ContentService","variant","_a","nothing","languages","html","__privateMethod","v","css","__decorateClass","state","customElement","SyncPublisherStratey","SyncPublishPushLangStepElement$1"],"mappings":"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"}