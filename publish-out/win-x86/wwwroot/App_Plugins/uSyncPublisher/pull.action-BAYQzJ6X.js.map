{"version":3,"file":"pull.action-BAYQzJ6X.js","sources":["../../../usync-publisher-assets/src/actions/pull.action.ts"],"sourcesContent":["import { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport {\r\n\tUmbEntityActionArgs,\r\n\tUmbEntityActionBase,\r\n\tUmbRequestReloadChildrenOfEntityEvent,\r\n} from '@umbraco-cms/backoffice/entity-action';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { PublishMode } from '../api';\r\nimport PublisherStrategyContext from '../strategies/strategy.context';\r\nimport { USYNC_PUBLISHER_PROCESS_MODAL } from '../strategies/modal/process-modal.token';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\n\r\nexport default class SyncPublisherPullEntityAction extends UmbEntityActionBase<never> {\r\n\t#strategyContext: PublisherStrategyContext;\r\n\r\n\t_mode = PublishMode.PULL;\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbEntityActionArgs<never>) {\r\n\t\tsuper(host, args);\r\n\t\tthis.#strategyContext = new PublisherStrategyContext(host);\r\n\t}\r\n\r\n\tasync execute(): Promise<void> {\r\n\t\tconst item = await this.#strategyContext?.getSyncItem(\r\n\t\t\tthis.args.entityType,\r\n\t\t\tthis.args.unique ?? '',\r\n\t\t);\r\n\t\tif (!item) return;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalManager) return;\r\n\r\n\t\tconst actionModalContext = modalManager.open(this, USYNC_PUBLISHER_PROCESS_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\taction: 'push',\r\n\t\t\t\titems: [item.udi],\r\n\t\t\t\tentityType: this.args.entityType,\r\n\t\t\t\tmode: this._mode,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tawait actionModalContext?.onSubmit().catch(() => {\r\n\t\t\treturn; // user pressed cancel.\r\n\t\t});\r\n\r\n\t\tif (this.args.unique) this.refreshTree(this.args.unique, this.args.entityType);\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tasync refreshTree(unique: string, entityType: string) {\r\n\t\tconst eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\r\n\t\teventContext?.dispatchEvent(\r\n\t\t\tnew UmbRequestReloadChildrenOfEntityEvent({\r\n\t\t\t\tunique: unique,\r\n\t\t\t\tentityType: entityType,\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n"],"names":["SyncPublisherPullEntityAction","UmbEntityActionBase","host","args","__privateAdd","_strategyContext","PublishMode","__privateSet","PublisherStrategyContext","item","_a","__privateGet","modalManager","UMB_MODAL_MANAGER_CONTEXT","actionModalContext","USYNC_PUBLISHER_PROCESS_MODAL","unique","entityType","eventContext","UMB_ACTION_EVENT_CONTEXT","UmbRequestReloadChildrenOfEntityEvent"],"mappings":";;;;;;;;;;;AAYA,MAAqBA,UAAsCC,EAA2B;AAAA,EAKrF,YAAYC,GAAyBC,GAAkC;AACtE,UAAMD,GAAMC,CAAI;AALjB,IAAAC,EAAA,MAAAC;AAEA,SAAA,QAAQC,EAAY,MAIdC,EAAA,MAAAF,GAAmB,IAAIG,EAAyBN,CAAI;AAAA,EAAA;AAAA,EAG1D,MAAM,UAAyB;;AACxB,UAAAO,IAAO,QAAMC,IAAAC,EAAA,MAAKN,OAAL,gBAAAK,EAAuB;AAAA,MACzC,KAAK,KAAK;AAAA,MACV,KAAK,KAAK,UAAU;AAAA;AAErB,QAAI,CAACD,EAAM;AAEX,UAAMG,IAAe,MAAM,KAAK,WAAWC,CAAyB;AACpE,QAAI,CAACD,EAAc;AAEnB,UAAME,IAAqBF,EAAa,KAAK,MAAMG,GAA+B;AAAA,MACjF,MAAM;AAAA,QACL,QAAQ;AAAA,QACR,OAAO,CAACN,EAAK,GAAG;AAAA,QAChB,YAAY,KAAK,KAAK;AAAA,QACtB,MAAM,KAAK;AAAA,MAAA;AAAA,IACZ,CACA;AAED,WAAMK,KAAA,gBAAAA,EAAoB,WAAW,MAAM,MAAM;AAAA,IAChD,KAGG,KAAK,KAAK,UAAa,KAAA,YAAY,KAAK,KAAK,QAAQ,KAAK,KAAK,UAAU;AAAA,EAE7E;AAAA,EAGD,MAAM,YAAYE,GAAgBC,GAAoB;AACrD,UAAMC,IAAe,MAAM,KAAK,WAAWC,CAAwB;AAErD,IAAAD,KAAA,QAAAA,EAAA;AAAA,MACb,IAAIE,EAAsC;AAAA,QACzC,QAAAJ;AAAA,QACA,YAAAC;AAAA,MACA,CAAA;AAAA;AAAA,EACF;AAEF;AA/CCZ,IAAA;"}