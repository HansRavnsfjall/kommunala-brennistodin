{"version":3,"file":"server-root-default.element-BvEUCQrp.js","sources":["../../../usync-publisher-assets/src/servers/modals/add-server.modal-token.ts","../../../usync-publisher-assets/src/servers/workspace/server-root/views/server-root-default.element.ts"],"sourcesContent":["import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport { USYNC_PUBLISHER_ADD_SERVER_MODAL_ALIAS } from '../_constants';\r\n\r\nexport type SyncPublisherAddServerData = {\r\n\tserverName: string;\r\n\tserverUrl: string;\r\n};\r\n\r\nexport type SyncPublisherAddServerValue = {\r\n\tserverAlias: string;\r\n};\r\n\r\nexport const USYNC_PUBLISHSER_ADD_SERVER_MODAL = new UmbModalToken<\r\n\tSyncPublisherAddServerData,\r\n\tSyncPublisherAddServerValue\r\n>(USYNC_PUBLISHER_ADD_SERVER_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import { css, customElement, html, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport {\r\n\tUMB_MODAL_MANAGER_CONTEXT,\r\n\tUmbModalManagerContext,\r\n} from '@umbraco-cms/backoffice/modal';\r\nimport { SyncPublishServerView, USyncPublishSettingsView } from '../../../../api';\r\nimport { USYNC_PUBLISHER_SETTINGS_CONTEXT } from '../../../../settings/settings.context';\r\nimport { USYNC_PUBLISHER_SERVER_CONTEXT } from '../../../servers.context';\r\nimport { USYNC_PUBLISHER_SERVER_ENTITY_TYPE } from '../../../server/entity';\r\nimport { USYNC_PUBLISHSER_ADD_SERVER_MODAL } from '../../../modals/add-server.modal-token';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport { USYNC_PUBLISHER_SERVER_SHARED_CONTEXT } from '../../server-workspace-shared.context';\r\nimport { uSyncPublisher } from '../../../../constants';\r\nimport { UMB_WORKSPACE_MODAL } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\n\r\n@customElement('usync-publisher-server-root-default')\r\nexport class uSyncPublisherServerRootDefault extends UmbLitElement {\r\n\t#modalContext: UmbModalManagerContext | undefined;\r\n\r\n\t@state()\r\n\tsettings: USyncPublishSettingsView | undefined;\r\n\r\n\t@state()\r\n\tservers: Array<SyncPublishServerView> | undefined;\r\n\r\n\t#serverModalController: UmbModalRouteRegistrationController;\r\n\r\n\t@state()\r\n\t_serverModalPath = '';\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(USYNC_PUBLISHER_SETTINGS_CONTEXT, (_context) => {\r\n\t\t\tif (!_context) return;\r\n\r\n\t\t\tthis.observe(_context.settings, (_settings) => {\r\n\t\t\t\tthis.settings = _settings;\r\n\t\t\t});\r\n\r\n\t\t\t_context.getSettings();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(USYNC_PUBLISHER_SERVER_CONTEXT, (_context) => {\r\n\t\t\tif (!_context) return;\r\n\r\n\t\t\tthis.observe(_context.allServers, (_servers) => {\r\n\t\t\t\tthis.servers = _servers;\r\n\t\t\t});\r\n\r\n\t\t\t_context.getAllServers();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (_modalManager) => {\r\n\t\t\tthis.#modalContext = _modalManager;\r\n\t\t});\r\n\r\n\t\tthis.#serverModalController = new UmbModalRouteRegistrationController(\r\n\t\t\tthis,\r\n\t\t\tUMB_WORKSPACE_MODAL,\r\n\t\t)\r\n\t\t\t.addAdditionalPath(USYNC_PUBLISHER_SERVER_ENTITY_TYPE)\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn { data: { entityType: USYNC_PUBLISHER_SERVER_ENTITY_TYPE, preset: {} } };\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._serverModalPath = routeBuilder({});\r\n\t\t\t});\r\n\t}\r\n\r\n\tasync #addThisServer() {\r\n\t\tawait this.#openAddServerModal(\r\n\t\t\tthis.settings?.serverName ?? '',\r\n\t\t\tthis.settings?.serverUrl ?? '',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #onAddServer() {\r\n\t\tawait this.#openAddServerModal('', '');\r\n\t}\r\n\r\n\tasync #onServerSelected(e: CustomEvent<SyncPublishServerView>) {\r\n\t\tthis.#serverModalController.open({ alias: e.detail.key }, 'edit/' + e.detail.key);\r\n\t}\r\n\r\n\tasync #openAddServerModal(name: string = '', url: string = '') {\r\n\t\tconst addServerModalContext = this.#modalContext?.open(\r\n\t\t\tthis,\r\n\t\t\tUSYNC_PUBLISHSER_ADD_SERVER_MODAL,\r\n\t\t\t{ data: { serverName: name, serverUrl: url } },\r\n\t\t);\r\n\r\n\t\tconst data = await addServerModalContext?.onSubmit().catch(() => {\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tconst sharedContext = await this.getContext(USYNC_PUBLISHER_SERVER_SHARED_CONTEXT);\r\n\t\tawait sharedContext?.load(uSyncPublisher.emptyGuid);\r\n\r\n\t\tif (!data) return;\r\n\t}\r\n\r\n\tasync #onCopyServerUrl(url: string | undefined) {\r\n\t\tif (!navigator.clipboard) return;\r\n\t\tawait navigator.clipboard.writeText(url ?? '');\r\n\r\n\t\tconst notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n\t\tif (!notificationContext) return;\r\n\r\n\t\tnotificationContext.peek('positive', {\r\n\t\t\tdata: { headline: 'Copied', message: `Server URL (${url}) Copied to clipboard` },\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout>\r\n\t\t\t\t<div class=\"container\">\r\n\t\t\t\t\t<usync-licence-notice></usync-licence-notice>${this.renderServerStatus()}\r\n\t\t\t\t\t${this.renderServerList()}\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderServerStatus() {\r\n\t\treturn html`\r\n\t\t\t<uui-box>\r\n\t\t\t\t<div class=\"current\">\r\n\t\t\t\t\t<div class=\"current-server\">\r\n\t\t\t\t\t\t<h4>Current server : ${this.settings?.serverName}</h4>\r\n\t\t\t\t\t\t<small>\r\n\t\t\t\t\t\t\t${this.settings?.serverUrl}\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlook=\"default\"\r\n\t\t\t\t\t\t\t\t.compact=${true}\r\n\t\t\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t\t\tlabel=\"copy\"\r\n\t\t\t\t\t\t\t\t@click=${() => this.#onCopyServerUrl(this.settings?.serverUrl)}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-documents\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlook=\"default\"\r\n\t\t\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t.compact=${true}\r\n\t\t\t\t\t\t\t\tlabel=\"Add this\"\r\n\t\t\t\t\t\t\t\t@click=${this.#addThisServer}\r\n\t\t\t\t\t\t\t\t>Add this server</uui-button\r\n\t\t\t\t\t\t\t></small\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"server-status\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t${this.renderOptionIcon(this.settings?.incomingEnabled)}\r\n\t\t\t\t\t\t\t<umb-localize key=\"usyncpublish_incoming\">Incoming</umb-localize>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t${this.renderOptionIcon(this.settings?.outgoingEnabled)}\r\n\t\t\t\t\t\t\t<umb-localize key=\"usyncpublish_outgoing\">Outgoing</umb-localize>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderOptionIcon(enabled: boolean | undefined) {\r\n\t\treturn enabled\r\n\t\t\t? html`<uui-icon name=\"icon-check\" color=\"positive\"></uui-icon>`\r\n\t\t\t: html`<uui-icon name=\"icon-wrong\" color=\"danger\"></uui-icon>`;\r\n\t}\r\n\r\n\trenderServerList() {\r\n\t\treturn html`\r\n\t\t\t<usync-publisher-server-list\r\n\t\t\t\t.servers=${this.servers}\r\n\t\t\t\t.selected=${this.settings?.serverName}\r\n\t\t\t\t.selectDisabled=${true}\r\n\t\t\t\t@add-server=${this.#onAddServer}\r\n\t\t\t\t@server-selected=${this.#onServerSelected}></usync-publisher-server-list>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\t.container {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\tmargin-top: calc(var(--uui-size-space-4) * -1);\r\n\t\t}\r\n\r\n\t\tusync-publisher-server-list {\r\n\t\t\tdisplay: block;\r\n\t\t}\r\n\r\n\t\t.current {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t}\r\n\r\n\t\t.current-server h4 {\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0;\r\n\t\t}\r\n\r\n\t\t.server-status,\r\n\t\t.server-status > div {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\r\n\t\t.server-status > div {\r\n\t\t\tpadding: 10px;\r\n\t\t}\r\n\r\n\t\t.server-status uui-icon {\r\n\t\t\tcolor: green;\r\n\t\t\tmargin: 0 10px;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default uSyncPublisherServerRootDefault;\r\n"],"names":["USYNC_PUBLISHSER_ADD_SERVER_MODAL","UmbModalToken","USYNC_PUBLISHER_ADD_SERVER_MODAL_ALIAS","_modalContext","_serverModalController","_uSyncPublisherServerRootDefault_instances","addThisServer_fn","onAddServer_fn","onServerSelected_fn","openAddServerModal_fn","onCopyServerUrl_fn","uSyncPublisherServerRootDefault","UmbLitElement","__privateAdd","USYNC_PUBLISHER_SETTINGS_CONTEXT","_context","_settings","USYNC_PUBLISHER_SERVER_CONTEXT","_servers","UMB_MODAL_MANAGER_CONTEXT","_modalManager","__privateSet","UmbModalRouteRegistrationController","UMB_WORKSPACE_MODAL","USYNC_PUBLISHER_SERVER_ENTITY_TYPE","routeBuilder","html","_a","_b","__privateMethod","_c","_d","enabled","__privateGet","name","url","addServerModalContext","data","sharedContext","USYNC_PUBLISHER_SERVER_SHARED_CONTEXT","uSyncPublisher","notificationContext","UMB_NOTIFICATION_CONTEXT","css","__decorateClass","state","customElement","uSyncPublisherServerRootDefault$1"],"mappings":"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"}