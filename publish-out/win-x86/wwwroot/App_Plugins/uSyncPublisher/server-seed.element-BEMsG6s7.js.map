{"version":3,"file":"server-seed.element-BEMsG6s7.js","sources":["../../../usync-publisher-assets/src/servers/workspace/server-root/views/server-seed.element.ts"],"sourcesContent":["import {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport {\r\n\tPublishMode,\r\n\tSeedService,\r\n\tServersService,\r\n\tSiteSeedStatus,\r\n\tSyncPublishServerView,\r\n} from '../../../../api';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { USYNC_PUBLISHER_PROCESS_MODAL } from '../../../../strategies/modal/process-modal.token';\r\nimport { UMB_DATA_TYPE_ENTITY_TYPE } from '@umbraco-cms/backoffice/data-type';\r\nimport { UMB_TEMPLATE_ENTITY_TYPE } from '@umbraco-cms/backoffice/template';\r\nimport { UMB_DOCUMENT_ENTITY_TYPE } from '@umbraco-cms/backoffice/document';\r\nimport { UMB_MEDIA_ENTITY_TYPE } from '@umbraco-cms/backoffice/media';\r\nimport { UMB_MEMBER_TYPE_ENTITY_TYPE } from '@umbraco-cms/backoffice/member-type';\r\nimport { UMB_MEDIA_TYPE_ENTITY_TYPE } from '@umbraco-cms/backoffice/media-type';\r\nimport { UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE } from '@umbraco-cms/backoffice/document-blueprint';\r\nimport { UMB_LANGUAGE_ENTITY_TYPE } from '@umbraco-cms/backoffice/language';\r\nimport { UMB_PARTIAL_VIEW_ENTITY_TYPE } from '@umbraco-cms/backoffice/partial-view';\r\nimport { UMB_SCRIPT_ENTITY_TYPE } from '@umbraco-cms/backoffice/script';\r\nimport { UMB_STYLESHEET_ENTITY_TYPE } from '@umbraco-cms/backoffice/stylesheet';\r\nimport { UMB_DOCUMENT_TYPE_ENTITY_TYPE } from '@umbraco-cms/backoffice/document-type';\r\nimport { uSyncPublisher } from '../../../../constants';\r\n\r\n@customElement('usync-publisher-server-seed')\r\nexport class uSyncPublisherServerSeed extends UmbLitElement {\r\n\t@state()\r\n\tloaded: boolean = false;\r\n\r\n\t@state()\r\n\tstatus?: SiteSeedStatus;\r\n\r\n\t@state()\r\n\t_selectedEntities: string[] = [\r\n\t\t`umb://${UMB_DOCUMENT_TYPE_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_DATA_TYPE_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_MEMBER_TYPE_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_MEDIA_TYPE_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_LANGUAGE_ENTITY_TYPE}/${uSyncPublisher.emptyString}`,\r\n\t\t`umb://dictionary-item/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_TEMPLATE_ENTITY_TYPE}/${uSyncPublisher.emptyString}`,\r\n\t\t`umb://${UMB_PARTIAL_VIEW_ENTITY_TYPE}/${uSyncPublisher.emptyString}`,\r\n\t\t`umb://${UMB_SCRIPT_ENTITY_TYPE}/${uSyncPublisher.emptyString}`,\r\n\t\t`umb://${UMB_STYLESHEET_ENTITY_TYPE}/${uSyncPublisher.emptyString}`,\r\n\t\t`umb://${UMB_DOCUMENT_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t\t`umb://${UMB_MEDIA_ENTITY_TYPE}/${uSyncPublisher.emptyGuid}`,\r\n\t];\r\n\r\n\t@state()\r\n\t_server?: SyncPublishServerView;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tasync connectedCallback() {\r\n\t\tawait super.connectedCallback();\r\n\t\tconst result = (await SeedService.getSiteStatus()).data;\r\n\t\tthis.status = result;\r\n\r\n\t\tif (this.status.seedServerUrl) {\r\n\t\t\tthis._server = (\r\n\t\t\t\tawait ServersService.getServerByUrl({\r\n\t\t\t\t\tquery: {\r\n\t\t\t\t\t\turl: this.status.seedServerUrl,\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t).data;\r\n\t\t\tthis.loaded = true;\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tif (!this.loaded) return nothing;\r\n\r\n\t\treturn html`<umb-body-layout>\r\n\t\t\t${this.status?.isEnabled === false\r\n\t\t\t\t? this.renderDisabled()\r\n\t\t\t\t: this.renderEnabled()}</umb-body-layout\r\n\t\t>`;\r\n\t}\r\n\r\n\trenderDisabled() {\r\n\t\treturn html`<uui-box\r\n\t\t\t><umb-localize key=\"usyncpublish_seedDisabled\"></umb-localize\r\n\t\t></uui-box>`;\r\n\t}\r\n\r\n\trenderEnabled() {\r\n\t\treturn html`<uui-box .headline=${this.localize.term('usyncpublish_seedHeading')}>\r\n\t\t\t\t<umb-localize key=\"usyncpublish_seedIntro\"></umb-localize>\r\n\t\t\t</uui-box>\r\n\t\t\t${this.renderContentStatus()}\r\n\t\t\t<div class=\"server\">\r\n\t\t\t\t<h4>Seed this site from ${this._server?.alias} ?</h4>\r\n\t\t\t\t<usync-publisher-server-button\r\n\t\t\t\t\t.server=${this._server}\r\n\t\t\t\t\t.performCheck=${true}\r\n\t\t\t\t\t.selectDisabled=${true}\r\n\t\t\t\t\t@server-selected=${() => this.#pullSeed()}></usync-publisher-server-button>\r\n\t\t\t</div> `;\r\n\t}\r\n\r\n\trenderContentStatus() {\r\n\t\treturn this.status?.hasContentOrMedia\r\n\t\t\t? html`<div class=\"alert alert-warning\">\r\n\t\t\t\t\t<umb-localize key=\"usyncpublish_seedIntroContent\"></umb-localize>\r\n\t\t\t\t</div>`\r\n\t\t\t: html`<div class=\"alert alert-info\">\r\n\t\t\t\t\t<umb-localize key=\"usyncpublish_seedIntroNoContent\"></umb-localize>\r\n\t\t\t\t</div>`;\r\n\t}\r\n\r\n\tasync #pullSeed() {\r\n\t\tconst modalContext = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalContext) return;\r\n\r\n\t\tconst entityType = this._selectedEntities[0].split('/')[2];\r\n\r\n\t\tconst settingsMode = PublishMode.SETTINGS_PULL;\r\n\r\n\t\tconst actionModalContext = await modalContext.open(\r\n\t\t\tthis,\r\n\t\t\tUSYNC_PUBLISHER_PROCESS_MODAL,\r\n\t\t\t{\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tserver: this._server,\r\n\t\t\t\t\taction: settingsMode,\r\n\t\t\t\t\t// @ts-expect-error - udis are strings in this instance its ok.\r\n\t\t\t\t\titems: this._selectedEntities,\r\n\t\t\t\t\tentityType: entityType,\r\n\t\t\t\t\tmode: settingsMode,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\tactionModalContext.onSubmit().catch(() => {\r\n\t\t\treturn; // user pressed cancel.\r\n\t\t});\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tstatic styles? = css`\r\n\t\t.alert {\r\n\t\t\tmargin: var(--uui-size-space-4) 0;\r\n\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\tborder: 1px solid transparent;\r\n\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t}\r\n\r\n\t\t.alert-warning {\r\n\t\t\tbackground-color: var(--uui-color-warning);\r\n\t\t\tcolor: var(--uui-color-warning-contrast);\r\n\t\t}\r\n\r\n\t\t.alert-info {\r\n\t\t\tbackground-color: var(--uui-color-border-standalone);\r\n\t\t}\r\n\r\n\t\t.server {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\tfont-size: var(--uui-size-space-5);\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default uSyncPublisherServerSeed;\r\n"],"names":["_uSyncPublisherServerSeed_instances","pullSeed_fn","uSyncPublisherServerSeed","UmbLitElement","__privateAdd","UMB_DOCUMENT_TYPE_ENTITY_TYPE","uSyncPublisher","UMB_DATA_TYPE_ENTITY_TYPE","UMB_MEMBER_TYPE_ENTITY_TYPE","UMB_MEDIA_TYPE_ENTITY_TYPE","UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE","UMB_LANGUAGE_ENTITY_TYPE","UMB_TEMPLATE_ENTITY_TYPE","UMB_PARTIAL_VIEW_ENTITY_TYPE","UMB_SCRIPT_ENTITY_TYPE","UMB_STYLESHEET_ENTITY_TYPE","UMB_DOCUMENT_ENTITY_TYPE","UMB_MEDIA_ENTITY_TYPE","result","SeedService","ServersService","html","_a","nothing","__privateMethod","modalContext","UMB_MODAL_MANAGER_CONTEXT","entityType","settingsMode","PublishMode","USYNC_PUBLISHER_PROCESS_MODAL","css","__decorateClass","state","customElement","uSyncPublisherServerSeed$1"],"mappings":"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"}