{"version":3,"file":"strategy.context-Nd7v-g-Q.js","sources":["../../../usync-publisher-assets/src/strategies/strategy.repository.ts","../../../usync-publisher-assets/src/strategies/strategy.context.ts"],"sourcesContent":["import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { PublishMode, StrategyService } from '../api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class PublisherStrategyRepository extends UmbControllerBase {\r\n\t#host: UmbControllerHost;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\tasync getSyncItem(entityType: string, unique: string) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tStrategyService.getSyncItem({ query: { entityType: entityType, id: unique } }),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tasync getSyncSendOptions(serverAlias: string, entityType: string) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tStrategyService.getSyncSendOptions({\r\n\t\t\t\tquery: { serverAlias: serverAlias, entityType: entityType },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tasync getSyncSendOptionsByMode(\r\n\t\tserverAlias: string,\r\n\t\tmode: PublishMode,\r\n\t\tentityType: string,\r\n\t) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tStrategyService.getSyncSendOptionsByMode({\r\n\t\t\t\tquery: { serverAlias: serverAlias, mode: mode, entityType: entityType },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tasync getServer(serverAlias: string) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tStrategyService.getServerByAlias({ query: { serverAlias: serverAlias } }),\r\n\t\t);\r\n\t}\r\n\r\n\tasync getStrategyByServer(server: string, mode: PublishMode) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tStrategyService.getStrategyByServer({ query: { server: server, mode: mode } }),\r\n\t\t);\r\n\t}\r\n\r\n\tasync getStrategyByPublisher(publisher: string, mode: PublishMode) {\r\n\t\treturn await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tStrategyService.getStrategyByPublisher({\r\n\t\t\t\tquery: { publisherAlias: publisher, mode: mode },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { PublisherStrategyRepository } from './strategy.repository';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { PublishMode, SyncPublisherOptions, SyncSendOptions } from '../api';\r\n\r\nexport class PublisherStrategyContext extends UmbControllerBase {\r\n\t#repository: PublisherStrategyRepository;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#repository = new PublisherStrategyRepository(host);\r\n\t\tthis.provideContext(USYNC_PUBLISHER_STRATEGY_CONTEXT, this);\r\n\t}\r\n\r\n\tasync getSyncItem(entityType: string, unique: string) {\r\n\t\treturn (await this.#repository.getSyncItem(entityType, unique)).data;\r\n\t}\r\n\r\n\tasync getServer(serverAlias: string) {\r\n\t\treturn (await this.#repository.getServer(serverAlias)).data;\r\n\t}\r\n\r\n\tasync getStrategyByServer(server: string, mode: PublishMode) {\r\n\t\treturn (await this.#repository.getStrategyByServer(server, mode)).data;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated\r\n\t */\r\n\tasync getSyncSendOptions(serverAlias: string, entityType: string) {\r\n\t\treturn (await this.#repository.getSyncSendOptions(serverAlias, entityType)).data;\r\n\t}\r\n\r\n\tasync getSyncSendOptionsByMode(\r\n\t\tserverAlias: string,\r\n\t\tmode: PublishMode,\r\n\t\tentityType: string,\r\n\t) {\r\n\t\treturn (\r\n\t\t\tawait this.#repository.getSyncSendOptionsByMode(serverAlias, mode, entityType)\r\n\t\t).data;\r\n\t}\r\n\r\n\tmergeToPublisherOptions(\r\n\t\tcurrent: SyncPublisherOptions,\r\n\t\toptions: SyncSendOptions,\r\n\t): SyncPublisherOptions {\r\n\t\tcurrent.includeChildren = options.includeChildren.value;\r\n\t\tcurrent.includeAncestors = options.includeAncestors.value;\r\n\t\tcurrent.includeFiles = options.includeFiles.value;\r\n\t\tcurrent.includeMedia = options.includeMedia.value;\r\n\t\tcurrent.includeLinked = options.includeLinked.value;\r\n\t\tcurrent.includeDependencies = options.includeDependencies.value;\r\n\t\tcurrent.includeMediaFiles = options.includeMediaFiles.value;\r\n\t\tcurrent.includeConfig = options.includeConfig.value;\r\n\t\tcurrent.removeOrphans = options.includeChildren.value\r\n\t\t\t? options.deleteMissing.value\r\n\t\t\t: false;\r\n\t\tcurrent.createRestorePoint = options.createRestorePoint.value;\r\n\t\treturn current;\r\n\t}\r\n}\r\n\r\nexport default PublisherStrategyContext;\r\n\r\nexport const USYNC_PUBLISHER_STRATEGY_CONTEXT =\r\n\tnew UmbContextToken<PublisherStrategyContext>('usync-publisher-strategy-context');\r\n"],"names":["PublisherStrategyRepository","UmbControllerBase","host","__privateAdd","_host","__privateSet","entityType","unique","tryExecute","__privateGet","StrategyService","serverAlias","mode","server","publisher","PublisherStrategyContext","_repository","USYNC_PUBLISHER_STRATEGY_CONTEXT","current","options","UmbContextToken"],"mappings":"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"}