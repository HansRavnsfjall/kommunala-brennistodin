{"version":3,"file":"snapshot-upload.modal-CNlo8dtM.js","sources":["../../../usync-snapshots-assets/src/workspace/modal/snapshot-upload.modal.ts"],"sourcesContent":["import { customElement, html, query, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport {\r\n\tTemporaryFileStatus,\r\n\tUmbTemporaryFileManager,\r\n\tUmbTemporaryFileModel,\r\n} from '@umbraco-cms/backoffice/temporary-file';\r\nimport uSyncSnapshotsWorkspaceContext, {\r\n\tUSYNC_SNAPSHOTS_CONTEXT,\r\n} from '../snapshots.context';\r\n\r\n@customElement('usync-snapshots-upload-modal')\r\nexport default class uSyncSnapshotsUploadModal extends UmbModalBaseElement<any, any> {\r\n\t#fileManager: UmbTemporaryFileManager;\r\n\t#context?: uSyncSnapshotsWorkspaceContext;\r\n\r\n\t@query('#uploadForm')\r\n\t_form!: HTMLFormElement;\r\n\r\n\t@state()\r\n\tfile?: File;\r\n\r\n\t@state()\r\n\ttempId?: string;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.#fileManager = new UmbTemporaryFileManager(this);\r\n\r\n\t\tthis.consumeContext(USYNC_SNAPSHOTS_CONTEXT, (_context) => {\r\n\t\t\tconsole.log('context', _context);\r\n\t\t\tthis.#context = _context;\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#fileManager.queue, (value) => {\r\n\t\t\tvalue.forEach((file) => {\r\n\t\t\t\tif (file.status === TemporaryFileStatus.SUCCESS) {\r\n\t\t\t\t\tthis.tempId = file.temporaryUnique;\r\n\t\t\t\t\tthis.#onUploadComplete(file.temporaryUnique, file.file);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #onUploadComplete(tempId: string, file: File) {\r\n\t\t// close probibly ?\r\n\t\tconsole.log('upload complete', tempId, file);\r\n\t\tawait this.#context?.upload(tempId);\r\n\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#onSubmitForm(e: Event) {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst formData = new FormData(this._form);\r\n\t\tconst file = formData.get('file') as File;\r\n\t\tif (!file) return;\r\n\r\n\t\tconst upload: UmbTemporaryFileModel = {\r\n\t\t\ttemporaryUnique: UmbId.new(),\r\n\t\t\tfile,\r\n\t\t\tstatus: TemporaryFileStatus.WAITING,\r\n\t\t};\r\n\r\n\t\tthis.#fileManager.upload([upload]);\r\n\t}\r\n\r\n\t#onFileChange() {\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis._form.requestSubmit();\r\n\t\t});\r\n\t}\r\n\r\n\t#onClose() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Upload Snapshot\">\r\n\t\t\t\t<umb-localize key=\"uSyncSnapshots_uploadWarning\"></umb-localize>\r\n\r\n\t\t\t\t${this.renderUpload()}\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=\"Close\"\r\n\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tsize=\"small\"\r\n\t\t\t\t\t\t@click=${this.#onClose}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderUpload() {\r\n\t\treturn html`<uui-form>\r\n\t\t\t<form id=\"uploadForm\" name=\"uploadForm\" @submit=${this.#onSubmitForm}>\r\n\t\t\t\t<uui-label for=\"file\" label=\"Upload Snapshot\"></uui-label>\r\n\t\t\t\t<uui-input-file\r\n\t\t\t\t\t.value=${this.file}\r\n\t\t\t\t\taccept=\".zip\"\r\n\t\t\t\t\tid=\"file\"\r\n\t\t\t\t\tname=\"file\"\r\n\t\t\t\t\t.multiple=${false}\r\n\t\t\t\t\t@input=${this.#onFileChange}></uui-input-file>\r\n\t\t\t</form>\r\n\t\t</uui-form>`;\r\n\t}\r\n}\r\n"],"names":["_fileManager","_context","_uSyncSnapshotsUploadModal_instances","onUploadComplete_fn","onSubmitForm_fn","onFileChange_fn","onClose_fn","uSyncSnapshotsUploadModal","UmbModalBaseElement","__privateAdd","__privateSet","UmbTemporaryFileManager","USYNC_SNAPSHOTS_CONTEXT","__privateGet","value","file","TemporaryFileStatus","__privateMethod","html","tempId","_a","_b","e","upload","UmbId","__decorateClass","query","state","customElement"],"mappings":";;;;;;;;;;;wYAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAaqB,IAAAC,IAArB,cAAuDC,EAA8B;AAAA,EAapF,cAAc;AACP,UAAA,GAdRC,EAAA,MAAAP,CAAA,GACCO,EAAA,MAAAT,CAAA,GACAS,EAAA,MAAAR,CAAA,GAcMS,EAAA,MAAAV,GAAe,IAAIW,EAAwB,IAAI,CAAA,GAE/C,KAAA,eAAeC,GAAyB,CAACX,MAAa;AAClD,cAAA,IAAI,WAAWA,CAAQ,GAC/BS,EAAA,MAAKT,GAAWA,CAAAA;AAAAA,IAAA,CAChB,GAED,KAAK,QAAQY,EAAA,MAAKb,CAAa,EAAA,OAAO,CAACc,MAAU;AAC1C,MAAAA,EAAA,QAAQ,CAACC,MAAS;AACnB,QAAAA,EAAK,WAAWC,EAAoB,YACvC,KAAK,SAASD,EAAK,iBACnBE,EAAA,MAAKf,GAALC,CAAA,EAAA,KAAA,MAAuBY,EAAK,iBAAiBA,EAAK,IAAA;AAAA,MACnD,CACA;AAAA,IAAA,CACD;AAAA,EAAA;AAAA,EAqCF,SAAS;AACD,WAAAG;AAAA;AAAA;AAAA;AAAA,MAIH,KAAK,aAAc,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAOVD,QAAKf,GAAQI,CAAA,CAAA;AAAA;AAAA;AAAA;AAAA,EAAA;AAAA,EAM3B,eAAe;AACP,WAAAY;AAAA,qDAC4CD,QAAKf,GAAaE,CAAA,CAAA;AAAA;AAAA;AAAA,cAGzD,KAAK,IAAI;AAAA;AAAA;AAAA;AAAA,iBAIN,EAAK;AAAA,cACRa,QAAKf,GAAaG,CAAA,CAAA;AAAA;AAAA;AAAA,EAAA;AAIhC;AAlGCL,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAFDC,IAAA,oBAAA,QAAA;AAiCOC,IAAiB,eAACgB,GAAgBJ,GAAY;;AAE3C,UAAA,IAAI,mBAAmBI,GAAQJ,CAAI,GACrC,QAAAK,IAAAP,EAAA,MAAKZ,CAAU,MAAf,gBAAAmB,EAAe,OAAOD,MAE5BE,IAAA,KAAK,iBAAL,QAAAA,EAAmB;AACpB;AAEAjB,IAAa,SAACkB,GAAU;AACvB,EAAAA,EAAE,eAAe;AAGX,QAAAP,IADW,IAAI,SAAS,KAAK,KAAK,EAClB,IAAI,MAAM;AAChC,MAAI,CAACA,EAAM;AAEX,QAAMQ,IAAgC;AAAA,IACrC,iBAAiBC,EAAM,IAAI;AAAA,IAC3B,MAAAT;AAAA,IACA,QAAQC,EAAoB;AAAA,EAC7B;AAEA,EAAAH,EAAA,MAAKb,CAAa,EAAA,OAAO,CAACuB,CAAM,CAAC;AAClC;AAEAlB,IAAa,WAAG;AACf,wBAAsB,MAAM;AAC3B,SAAK,MAAM,cAAc;AAAA,EAAA,CACzB;AACF;AAEAC,IAAQ,WAAG;;AACV,GAAAc,IAAA,KAAK,iBAAL,QAAAA,EAAmB;AACpB;AA5DAK,EAAA;AAAA,EADCC,EAAM,aAAa;AAAA,GAJAnB,EAKpB,WAAA,SAAA,CAAA;AAGAkB,EAAA;AAAA,EADCE,EAAM;AAAA,GAPapB,EAQpB,WAAA,QAAA,CAAA;AAGAkB,EAAA;AAAA,EADCE,EAAM;AAAA,GAVapB,EAWpB,WAAA,UAAA,CAAA;AAXoBA,IAArBkB,EAAA;AAAA,EADCG,EAAc,8BAA8B;AAAA,GACxBrB,CAAA;"}