{"version":3,"file":"snapshots.context-BX47u-Ps.js","sources":["../../../usync-snapshots-assets/src/api/sdk.gen.ts","../../../usync-snapshots-assets/src/workspace/snapshots.repository.ts","../../../usync-snapshots-assets/src/workspace/snapshots.context.ts"],"sourcesContent":["// This file is auto-generated by @hey-api/openapi-ts\n\nimport type { Options as ClientOptions, TDataShape, Client } from '@hey-api/client-fetch';\nimport type { EnabledData, EnabledResponse, GetSettingsData, GetSettingsResponse, IsLicencedData, IsLicencedResponse, DownloadAllData, DownloadAllResponse, DownloadSnapshotData, DownloadSnapshotResponse, GetSnapshotsData, GetSnapshotsResponse, RemoveData, RemoveResponse, UploadSnapshotData, UploadSnapshotResponse } from './types.gen';\nimport { client as _heyApiClient } from './client.gen';\n\nexport type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = ClientOptions<TData, ThrowOnError> & {\n    /**\n     * You can provide a client instance returned by `createClient()` instead of\n     * individual options. This might be also useful if you want to implement a\n     * custom client.\n     */\n    client?: Client;\n    /**\n     * You can pass arbitrary values through the `meta` object. This can be\n     * used to access values that aren't defined as part of the SDK function.\n     */\n    meta?: Record<string, unknown>;\n};\n\nexport class SettingsService {\n    public static enabled<ThrowOnError extends boolean = false>(options?: Options<EnabledData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<EnabledResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/Enabled',\n            ...options\n        });\n    }\n    \n    public static getSettings<ThrowOnError extends boolean = false>(options?: Options<GetSettingsData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<GetSettingsResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/GetSettings',\n            ...options\n        });\n    }\n    \n    public static isLicenced<ThrowOnError extends boolean = false>(options?: Options<IsLicencedData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<IsLicencedResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/IsLicenced',\n            ...options\n        });\n    }\n    \n}\n\nexport class SnapshotsService {\n    public static downloadAll<ThrowOnError extends boolean = false>(options?: Options<DownloadAllData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<DownloadAllResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/DownloadAll',\n            ...options\n        });\n    }\n    \n    public static downloadSnapshot<ThrowOnError extends boolean = false>(options?: Options<DownloadSnapshotData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).post<DownloadSnapshotResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/DownloadSnapshot',\n            ...options\n        });\n    }\n    \n    public static getSnapshots<ThrowOnError extends boolean = false>(options?: Options<GetSnapshotsData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).get<GetSnapshotsResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/GetSnapshots',\n            ...options\n        });\n    }\n    \n    public static remove<ThrowOnError extends boolean = false>(options?: Options<RemoveData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).delete<RemoveResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/Remove',\n            ...options\n        });\n    }\n    \n    public static uploadSnapshot<ThrowOnError extends boolean = false>(options?: Options<UploadSnapshotData, ThrowOnError>) {\n        return (options?.client ?? _heyApiClient).post<UploadSnapshotResponse, unknown, ThrowOnError>({\n            url: '/umbraco/usync/api/v1/Snapshots/UploadSnapshot',\n            ...options\n        });\n    }\n    \n}","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { SnapshotsService } from '../api';\r\n\r\nexport default class uSyncSnapshotsRepository extends UmbControllerBase {\r\n\t#host: UmbControllerHost;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\tasync list() {\r\n\t\treturn (await tryExecute(this.#host, SnapshotsService.getSnapshots()))?.data;\r\n\t}\r\n\r\n\tasync remove(alias: string) {\r\n\t\treturn tryExecute(this.#host, SnapshotsService.remove({ query: { alias } }));\r\n\t}\r\n\r\n\tasync downloadSnapshot(alias: string) {\r\n\t\treturn tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tSnapshotsService.downloadSnapshot({\r\n\t\t\t\tquery: {\r\n\t\t\t\t\talias: alias,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\tasync downloadAll() {\r\n\t\treturn tryExecute(this.#host, SnapshotsService.downloadAll());\r\n\t}\r\n\r\n\tasync upload(fileId: string) {\r\n\t\treturn tryExecute(this.#host, SnapshotsService.uploadSnapshot({ query: { fileId } }));\r\n\t}\r\n}\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport {\r\n\tUMB_WORKSPACE_CONTEXT,\r\n\tUmbWorkspaceContext,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport { uSyncSnapshots } from '../constants';\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport uSyncSnapshotsRepository from './snapshots.repository';\r\nimport { UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { SnapshotInfo } from '../api';\r\n\r\nexport class uSyncSnapshotsWorkspaceContext\r\n\textends UmbControllerBase\r\n\timplements UmbWorkspaceContext\r\n{\r\n\tpublic readonly workspaceAlias: string = uSyncSnapshots.workspace;\r\n\t#repository: uSyncSnapshotsRepository;\r\n\r\n\t#snapshots = new UmbObjectState<SnapshotInfo[] | undefined>(undefined);\r\n\tpublic readonly snapshots = this.#snapshots.asObservable();\r\n\r\n\tgetEntityType(): string {\r\n\t\treturn uSyncSnapshots.entity;\r\n\t}\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#repository = new uSyncSnapshotsRepository(host);\r\n\r\n\t\tthis.provideContext(USYNC_SNAPSHOTS_CONTEXT, this);\r\n\t\tthis.provideContext(UMB_WORKSPACE_CONTEXT, this);\r\n\t}\r\n\r\n\tasync getSnapshots() {\r\n\t\tconst snapshots = await this.#repository.list();\r\n\t\tif (snapshots) {\r\n\t\t\tthis.#snapshots.setValue(snapshots);\r\n\t\t}\r\n\t\treturn snapshots;\r\n\t}\r\n\r\n\tasync remove(alias: string) {\r\n\t\tawait this.#repository.remove(alias);\r\n\t\tawait this.getSnapshots();\r\n\t}\r\n\r\n\tasync downloadSnapshot(alias: string) {\r\n\t\tconst response = (await this.#repository.downloadSnapshot(alias)).data;\r\n\t\tif (!response) return;\r\n\t\tawait this.#downloadFile(alias, response);\r\n\t}\r\n\r\n\tasync downloadAll() {\r\n\t\tconst response = (await this.#repository.downloadAll()).data;\r\n\t\tif (!response) return;\r\n\r\n\t\tawait this.#downloadFile('usync-snapshots', response);\r\n\t}\r\n\r\n\tasync #downloadFile(alias: string, response: Blob | File) {\r\n\t\tif (!response) return;\r\n\t\tconst url = window.URL.createObjectURL(response);\r\n\t\tconst download = document.createElement('a');\r\n\t\tdownload.href = url;\r\n\t\tdownload.download = alias + '.zip';\r\n\t\tdocument.body.appendChild(download);\r\n\t\tdownload.dispatchEvent(new MouseEvent('click'));\r\n\t\tdownload.remove();\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t}\r\n\r\n\tasync upload(fileId: string) {\r\n\t\tawait this.#repository.upload(fileId);\r\n\t\tawait this.getSnapshots();\r\n\t}\r\n}\r\n\r\nexport default uSyncSnapshotsWorkspaceContext;\r\n\r\nexport const USYNC_SNAPSHOTS_CONTEXT =\r\n\tnew UmbContextToken<uSyncSnapshotsWorkspaceContext>('uSyncSnapshotsWorkspaceContext');\r\n"],"names":["SnapshotsService","options","_heyApiClient","uSyncSnapshotsRepository","UmbControllerBase","host","__privateAdd","_host","__privateSet","_a","tryExecute","__privateGet","alias","fileId","uSyncSnapshotsWorkspaceContext","_uSyncSnapshotsWorkspaceContext_instances","_repository","_snapshots","uSyncSnapshots","UmbObjectState","USYNC_SNAPSHOTS_CONTEXT","UMB_WORKSPACE_CONTEXT","snapshots","response","__privateMethod","downloadFile_fn","url","download","UmbContextToken"],"mappings":"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"}