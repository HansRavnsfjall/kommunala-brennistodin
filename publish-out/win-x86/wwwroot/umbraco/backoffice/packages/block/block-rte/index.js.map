{"version":3,"file":"index.js","sources":["../../../../src/packages/block/block-rte/context/block-rte-manager.context-token.ts","../../../../src/packages/block/block-rte/context/block-rte-entries.context-token.ts","../../../../src/packages/block/block-rte/context/block-rte-entry.context.ts","../../../../src/packages/block/block-rte/components/ref-rte-block/ref-rte-block.element.ts","../../../../src/packages/block/block-rte/components/block-rte-entry/block-rte-entry.element.ts","../../../../src/packages/block/block-rte/components/block-rte-entry/block-rte-entry-inline.element.ts","../../../../src/packages/block/block-rte/context/block-rte-entries.context.ts","../../../../src/packages/block/block-rte/context/block-rte-entry.context-token.ts","../../../../src/packages/block/block-rte/context/block-rte-manager.context.ts"],"sourcesContent":["import type { UmbBlockRteManagerContext } from './block-rte-manager.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\n// TODO: Make discriminator method for this:\r\nexport const UMB_BLOCK_RTE_MANAGER_CONTEXT = new UmbContextToken<UmbBlockRteManagerContext, UmbBlockRteManagerContext>(\r\n\t'UmbBlockManagerContext',\r\n);\r\n","import type { UmbBlockRteEntriesContext } from './block-rte-entries.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\n// TODO: Make discriminator method for this: (Aim to do this for v.17) [NL]\r\nexport const UMB_BLOCK_RTE_ENTRIES_CONTEXT = new UmbContextToken<UmbBlockRteEntriesContext>('UmbBlockEntriesContext');\r\n","import type { UmbBlockRteLayoutModel, UmbBlockRteTypeModel } from '../types.js';\r\nimport { UMB_BLOCK_RTE_MANAGER_CONTEXT } from './block-rte-manager.context-token.js';\r\nimport { UMB_BLOCK_RTE_ENTRIES_CONTEXT } from './block-rte-entries.context-token.js';\r\nimport { UmbBlockEntryContext } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { mergeObservables, observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\nexport class UmbBlockRteEntryContext extends UmbBlockEntryContext<\r\n\ttypeof UMB_BLOCK_RTE_MANAGER_CONTEXT,\r\n\ttypeof UMB_BLOCK_RTE_MANAGER_CONTEXT.TYPE,\r\n\ttypeof UMB_BLOCK_RTE_ENTRIES_CONTEXT,\r\n\ttypeof UMB_BLOCK_RTE_ENTRIES_CONTEXT.TYPE,\r\n\tUmbBlockRteTypeModel,\r\n\tUmbBlockRteLayoutModel\r\n> {\r\n\treadonly displayInline = this._layout.asObservablePart((x) => (x ? (x.displayInline ?? false) : undefined));\r\n\treadonly displayInlineConfig = this._blockType.asObservablePart((x) => (x ? (x.displayInline ?? false) : undefined));\r\n\r\n\treadonly forceHideContentEditorInOverlay = this._blockType.asObservablePart((x) =>\r\n\t\tx ? (x.forceHideContentEditorInOverlay ?? false) : undefined,\r\n\t);\r\n\r\n\treadonly showContentEdit = mergeObservables(\r\n\t\t[this._contentStructureHasProperties, this.forceHideContentEditorInOverlay],\r\n\t\t([a, b]): boolean => {\r\n\t\t\treturn a === true && b === false;\r\n\t\t},\r\n\t);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_BLOCK_RTE_MANAGER_CONTEXT, UMB_BLOCK_RTE_ENTRIES_CONTEXT);\r\n\t}\r\n\r\n\tprotected override _gotManager() {}\r\n\r\n\tprotected override _gotEntries() {\r\n\t\t// Secure displayInline fits configuration:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.displayInline, this.displayInlineConfig]),\r\n\t\t\t([displayInline, displayInlineConfig]) => {\r\n\t\t\t\tif (displayInlineConfig !== undefined && displayInline !== undefined && displayInlineConfig !== displayInline) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\tdisplayInline: displayInlineConfig,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'displayInlineCorrection',\r\n\t\t);\r\n\t}\r\n\r\n\tprotected override _gotContentType() {}\r\n}\r\n","import { css, customElement, html, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_BLOCK_ENTRY_CONTEXT } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockDataType } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockEditorCustomViewConfiguration } from '@umbraco-cms/backoffice/block-custom-view';\r\n\r\n/**\r\n * @element umb-ref-rte-block\r\n */\r\n@customElement('umb-ref-rte-block')\r\nexport class UmbRefRteBlockElement extends UmbLitElement {\r\n\t//\r\n\t@property({ type: String })\r\n\tlabel?: string;\r\n\r\n\t@property({ type: String })\r\n\ticon?: string;\r\n\r\n\t@property({ type: Number, attribute: false })\r\n\tindex?: number;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\tunpublished?: boolean;\r\n\r\n\t@property({ attribute: false })\r\n\tcontent?: UmbBlockDataType;\r\n\r\n\t@property({ attribute: false })\r\n\tsettings?: UmbBlockDataType;\r\n\r\n\t@state()\r\n\tprivate _workspaceEditPath?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tconfig?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_ENTRY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.workspaceEditContentPath,\r\n\t\t\t\t(workspaceEditPath) => {\r\n\t\t\t\t\tthis._workspaceEditPath = workspaceEditPath;\r\n\t\t\t\t},\r\n\t\t\t\t'observeWorkspaceEditPath',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tconst blockValue = { ...this.content, $settings: this.settings, $index: this.index };\r\n\t\treturn html`\r\n\t\t\t<uui-ref-node standalone href=${(this.config?.showContentEdit ? this._workspaceEditPath : undefined) ?? ''}>\r\n\t\t\t\t<div class=\"selection-background\" aria-hidden=\"true\">&emsp;</div>\r\n\t\t\t\t<umb-icon slot=\"icon\" .name=${this.icon}></umb-icon>\r\n\t\t\t\t<umb-ufm-render slot=\"name\" inline .markdown=${this.label} .value=${blockValue}></umb-ufm-render>\r\n\t\t\t</uui-ref-node>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t}\r\n\r\n\t\t\tuui-ref-node {\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) umb-icon,\r\n\t\t\t:host([unpublished]) umb-ufm-render {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\r\n\t\t\t/* HACK: Stretches a space character (&emsp;) to be full-width to make the RTE block appear text-selectable. [LK,NL] */\r\n\t\t\t.selection-background {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tfont-size: 100vw;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\tz-index: 0;\r\n\t\t\t}\r\n\r\n\t\t\tumb-icon,\r\n\t\t\tumb-ufm-render {\r\n\t\t\t\tz-index: 1;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbRefRteBlockElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-ref-rte-block': UmbRefRteBlockElement;\r\n\t}\r\n}\r\n","import type { UmbBlockRteLayoutModel } from '../../types.js';\r\nimport { UMB_BLOCK_RTE } from '../../constants.js';\r\nimport { UmbBlockRteEntryContext } from '../../context/block-rte-entry.context.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, css, property, state, customElement, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type {\r\n\tManifestBlockEditorCustomView,\r\n\tUmbBlockEditorCustomViewProperties,\r\n} from '@umbraco-cms/backoffice/block-custom-view';\r\nimport { stringOrStringArrayContains } from '@umbraco-cms/backoffice/utils';\r\n\r\nimport '../ref-rte-block/index.js';\r\nimport { UmbObserveValidationStateController } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbDataPathBlockElementDataQuery } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbExtensionElementInitializer } from '@umbraco-cms/backoffice/extension-api';\r\n\r\n/**\r\n * @class UmbBlockRteEntryElement\r\n */\r\n@customElement('umb-rte-block')\r\nexport class UmbBlockRteEntryElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t@property({ type: String, attribute: 'data-content-key', reflect: true })\r\n\tpublic set contentKey(value: string | undefined) {\r\n\t\tif (!value) return;\r\n\t\tthis._contentKey = value;\r\n\t\tthis.#context.setContentKey(value);\r\n\r\n\t\tnew UmbObserveValidationStateController(\r\n\t\t\tthis,\r\n\t\t\t`$.contentData[${UmbDataPathBlockElementDataQuery({ key: value })}]`,\r\n\t\t\t(hasMessages) => {\r\n\t\t\t\tthis._contentInvalid = hasMessages;\r\n\t\t\t\tthis._blockViewProps.contentInvalid = hasMessages;\r\n\t\t\t},\r\n\t\t\t'observeMessagesForContent',\r\n\t\t);\r\n\t}\r\n\tpublic get contentKey(): string | undefined {\r\n\t\treturn this._contentKey;\r\n\t}\r\n\tprivate _contentKey?: string | undefined;\r\n\r\n\t#context = new UmbBlockRteEntryContext(this);\r\n\r\n\t@state()\r\n\tprivate _showContentEdit = false;\r\n\r\n\t@state()\r\n\tprivate _hasSettings = false;\r\n\r\n\t@state()\r\n\tprivate _label = '';\r\n\r\n\t@state()\r\n\tprivate _icon?: string;\r\n\r\n\t@state()\r\n\tprivate _exposed?: boolean;\r\n\r\n\t@state()\r\n\tprivate _showActions?: boolean;\r\n\r\n\t@state()\r\n\tprivate _workspaceEditContentPath?: string;\r\n\r\n\t@state()\r\n\tprivate _workspaceEditSettingsPath?: string;\r\n\r\n\t@state()\r\n\tprivate _contentTypeAlias?: string;\r\n\r\n\t@state()\r\n\tprivate _contentTypeName?: string;\r\n\r\n\t@state()\r\n\tprivate _blockViewProps: UmbBlockEditorCustomViewProperties<UmbBlockRteLayoutModel> = {\r\n\t\tcontentKey: undefined!,\r\n\t\tconfig: { showContentEdit: false, showSettingsEdit: false },\r\n\t}; // Set to undefined cause it will be set before we render.\r\n\r\n\t// 'content-invalid' attribute is used for styling purpose.\r\n\t@property({ type: Boolean, attribute: 'content-invalid', reflect: true })\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_contentInvalid?: boolean;\r\n\r\n\t// 'settings-invalid' attribute is used for styling purpose.\r\n\t@property({ type: Boolean, attribute: 'settings-invalid', reflect: true })\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_settingsInvalid?: boolean;\r\n\r\n\t#updateBlockViewProps(incoming: Partial<UmbBlockEditorCustomViewProperties<UmbBlockRteLayoutModel>>) {\r\n\t\tthis._blockViewProps = { ...this._blockViewProps, ...incoming };\r\n\t\tthis.requestUpdate('_blockViewProps');\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t// We do not have index for RTE Blocks at the moment.\r\n\t\tthis.#context.setIndex(0);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.showContentEdit,\r\n\t\t\t(showContentEdit) => {\r\n\t\t\t\tthis._showContentEdit = showContentEdit;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, showContentEdit } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.settingsElementTypeKey,\r\n\t\t\t(key) => {\r\n\t\t\t\tthis._hasSettings = !!key;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, showSettingsEdit: !!key } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeAlias,\r\n\t\t\t(alias) => {\r\n\t\t\t\tthis._contentTypeAlias = alias;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeName,\r\n\t\t\t(contentElementTypeName) => {\r\n\t\t\t\tthis._contentTypeName = contentElementTypeName;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.blockType,\r\n\t\t\t(blockType) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ blockType });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(this.#context.index, (index) => this.#updateBlockViewProps({ index }), null);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.label,\r\n\t\t\t(label) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ label });\r\n\t\t\t\tthis._label = label;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeIcon,\r\n\t\t\t(icon) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ icon });\r\n\t\t\t\tthis._icon = icon;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.hasExpose,\r\n\t\t\t(exposed) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ unpublished: !exposed });\r\n\t\t\t\tthis._exposed = exposed;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.actionsVisibility,\r\n\t\t\t(showActions) => {\r\n\t\t\t\tthis._showActions = showActions;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\t// Data props:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.layout,\r\n\t\t\t(layout) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ layout });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.#observeData();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.settingsKey,\r\n\t\t\t(settingsKey) => {\r\n\t\t\t\tthis.removeUmbControllerByAlias('observeMessagesForSettings');\r\n\t\t\t\tif (settingsKey) {\r\n\t\t\t\t\t// Observe settings validation state:\r\n\t\t\t\t\tnew UmbObserveValidationStateController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\t`$.settingsData[${UmbDataPathBlockElementDataQuery({ key: settingsKey })}]`,\r\n\t\t\t\t\t\t(hasMessages) => {\r\n\t\t\t\t\t\t\tthis._settingsInvalid = hasMessages;\r\n\t\t\t\t\t\t\tthis._blockViewProps.settingsInvalid = hasMessages;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeMessagesForSettings',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.workspaceEditContentPath,\r\n\t\t\t(path) => {\r\n\t\t\t\tthis._workspaceEditContentPath = path;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, editContentPath: path } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.workspaceEditSettingsPath,\r\n\t\t\t(path) => {\r\n\t\t\t\tthis._workspaceEditSettingsPath = path;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, editSettingsPath: path } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\tasync #observeData() {\r\n\t\tthis.observe(\r\n\t\t\tawait this.#context.contentValues(),\r\n\t\t\t(content) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ content });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tawait this.#context.settingsValues(),\r\n\t\t\t(settings) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ settings });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.setAttribute('contenteditable', 'false');\r\n\t}\r\n\r\n\treadonly #filterBlockCustomViews = (manifest: ManifestBlockEditorCustomView) => {\r\n\t\tconst elementTypeAlias = this._contentTypeAlias ?? '';\r\n\t\tconst isForBlockEditor =\r\n\t\t\t!manifest.forBlockEditor || stringOrStringArrayContains(manifest.forBlockEditor, UMB_BLOCK_RTE);\r\n\t\tconst isForContentTypeAlias =\r\n\t\t\t!manifest.forContentTypeAlias || stringOrStringArrayContains(manifest.forContentTypeAlias, elementTypeAlias);\r\n\t\treturn isForBlockEditor && isForContentTypeAlias;\r\n\t};\r\n\r\n\t#expose = () => {\r\n\t\tthis.#context.expose();\r\n\t};\r\n\r\n\t#extensionSlotRenderMethod = (ext: UmbExtensionElementInitializer<ManifestBlockEditorCustomView>) => {\r\n\t\text.component?.setAttribute('part', 'component');\r\n\t\tif (this._exposed) {\r\n\t\t\treturn ext.component;\r\n\t\t} else {\r\n\t\t\treturn html`<div>\r\n\t\t\t\t${ext.component}\r\n\t\t\t\t<umb-block-overlay-expose-button\r\n\t\t\t\t\t.contentTypeName=${this._contentTypeName}\r\n\t\t\t\t\t@click=${this.#expose}></umb-block-overlay-expose-button>\r\n\t\t\t</div>`;\r\n\t\t}\r\n\t};\r\n\r\n\t#renderBlock() {\r\n\t\treturn this.contentKey && this._contentTypeAlias\r\n\t\t\t? html`\r\n\t\t\t\t\t<div class=\"uui-text uui-font\">\r\n\t\t\t\t\t\t<umb-extension-slot\r\n\t\t\t\t\t\t\ttype=\"blockEditorCustomView\"\r\n\t\t\t\t\t\t\tdefault-element=\"umb-ref-rte-block\"\r\n\t\t\t\t\t\t\t.renderMethod=${this.#extensionSlotRenderMethod}\r\n\t\t\t\t\t\t\t.fallbackRenderMethod=${this.#renderBuiltinBlockView}\r\n\t\t\t\t\t\t\t.props=${this._blockViewProps}\r\n\t\t\t\t\t\t\t.filter=${this.#filterBlockCustomViews}\r\n\t\t\t\t\t\t\tsingle></umb-extension-slot>\r\n\t\t\t\t\t\t${this.#renderActionBar()}\r\n\t\t\t\t\t\t${!this._showContentEdit && this._contentInvalid\r\n\t\t\t\t\t\t\t? html`<uui-badge attention color=\"invalid\" label=\"Invalid content\">!</uui-badge>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderActionBar() {\r\n\t\treturn this._showActions\r\n\t\t\t? html`<uui-action-bar>${this.#renderEditAction()}${this.#renderEditSettingsAction()}</uui-action-bar>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderBuiltinBlockView = () => {\r\n\t\t// TODO: Missing unsupported rendering [NL]\r\n\t\t/*if (this._unsupported) {\r\n\t\t\treturn this.#renderUnsupportedBlock();\r\n\t\t}*/\r\n\t\treturn this.#renderRefBlock();\r\n\t};\r\n\r\n\t#renderRefBlock() {\r\n\t\treturn html`<umb-ref-rte-block\r\n\t\t\t.label=${this._label}\r\n\t\t\t.icon=${this._icon}\r\n\t\t\t.index=${this._blockViewProps.index}\r\n\t\t\t.unpublished=${!this._exposed}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}\r\n\t\t\t.config=${this._blockViewProps.config}></umb-ref-rte-block>`;\r\n\t}\r\n\r\n\t#renderEditAction() {\r\n\t\treturn this._showContentEdit && this._workspaceEditContentPath\r\n\t\t\t? html`<uui-button\r\n\t\t\t\t\tlabel=\"edit\"\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tcolor=${this._contentInvalid ? 'invalid' : ''}\r\n\t\t\t\t\thref=${this._workspaceEditContentPath}>\r\n\t\t\t\t\t<uui-icon name=${this._exposed === false ? 'icon-add' : 'icon-edit'}></uui-icon>\r\n\t\t\t\t\t${this._contentInvalid\r\n\t\t\t\t\t\t? html`<uui-badge attention color=\"invalid\" label=\"Invalid content\">!</uui-badge>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</uui-button>`\r\n\t\t\t: this._showContentEdit === false && this._exposed === false\r\n\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\t@click=${this.#expose}\r\n\t\t\t\t\t\tlabel=${this.localize.term('blockEditor_createThisFor', this._contentTypeName)}\r\n\t\t\t\t\t\tlook=\"secondary\">\r\n\t\t\t\t\t\t<uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\t\t</uui-button>`\r\n\t\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderEditSettingsAction() {\r\n\t\treturn html`\r\n\t\t\t${this._hasSettings && this._workspaceEditSettingsPath\r\n\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\tlabel=\"Edit settings\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tcolor=${this._settingsInvalid ? 'invalid' : ''}\r\n\t\t\t\t\t\thref=${this._workspaceEditSettingsPath}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-settings\"></uui-icon>\r\n\t\t\t\t\t\t${this._settingsInvalid\r\n\t\t\t\t\t\t\t? html`<uui-badge attention color=\"invalid\" label=\"Invalid settings\">!</uui-badge>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</uui-button>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this.#renderBlock();\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tuser-select: all;\r\n\t\t\t\tuser-drag: auto;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t:host(.ProseMirror-selectednode) {\r\n\t\t\t\tumb-ref-rte-block {\r\n\t\t\t\t\t--uui-color-default-contrast: initial;\r\n\t\t\t\t\toutline: 3px solid var(--uui-color-focus);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tumb-extension-slot::part(component) {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tz-index: 0;\r\n\t\t\t}\r\n\r\n\t\t\tuui-action-bar {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: var(--uui-size-2);\r\n\t\t\t\tright: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder]) {\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockRteEntryElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-rte-block': UmbBlockRteEntryElement;\r\n\t}\r\n}\r\n","import { UmbBlockRteEntryElement } from './block-rte-entry.element.js';\r\nimport { css, customElement } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * Implementation for the inline component, inherited code from the umb-rte-block element.\r\n * @element umb-rte-block-inline\r\n */\r\n@customElement('umb-rte-block-inline')\r\nexport class UmbBlockRteEntryInlineElement extends UmbBlockRteEntryElement {\r\n\tstatic override styles = [\r\n\t\t...UmbBlockRteEntryElement.styles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockRteEntryInlineElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-rte-block-inline': UmbBlockRteEntryInlineElement;\r\n\t}\r\n}\r\n","import type { UmbBlockRteLayoutModel, UmbBlockRteTypeModel, UmbBlockRteValueModel } from '../types.js';\r\nimport {\r\n\tUMB_BLOCK_RTE_WORKSPACE_MODAL,\r\n\ttype UmbBlockRteWorkspaceOriginData,\r\n} from '../workspace/block-rte-workspace.modal-token.js';\r\nimport { UMB_BLOCK_RTE_MANAGER_CONTEXT } from './block-rte-manager.context-token.js';\r\nimport { UMB_BLOCK_CATALOGUE_MODAL, UmbBlockEntriesContext } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockDataModel } from '@umbraco-cms/backoffice/block';\r\nimport { UmbBooleanState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\n\r\n/**\r\n * Copied from the 'rte' package to avoid a circular dependency.\r\n * @internal\r\n */\r\nconst UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS = 'Umbraco.RichText';\r\n\r\nexport class UmbBlockRteEntriesContext extends UmbBlockEntriesContext<\r\n\ttypeof UMB_BLOCK_RTE_MANAGER_CONTEXT,\r\n\ttypeof UMB_BLOCK_RTE_MANAGER_CONTEXT.TYPE,\r\n\tUmbBlockRteTypeModel,\r\n\tUmbBlockRteLayoutModel,\r\n\tUmbBlockRteWorkspaceOriginData\r\n> {\r\n\t//\r\n\r\n\t// We will just say its always allowed for RTE for now: [NL]\r\n\tpublic readonly canCreate = new UmbBooleanState(true).asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_BLOCK_RTE_MANAGER_CONTEXT);\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_BLOCK_CATALOGUE_MODAL)\r\n\t\t\t.addAdditionalPath('_catalogue/:view')\r\n\t\t\t.onSetup((routingInfo) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tblocks: this._manager?.getBlockTypes() ?? [],\r\n\t\t\t\t\t\tblockGroups: [],\r\n\t\t\t\t\t\topenClipboard: routingInfo.view === 'clipboard',\r\n\t\t\t\t\t\toriginData: {},\r\n\t\t\t\t\t\tcreateBlockInWorkspace: true,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.onSubmit(async (value, data) => {\r\n\t\t\t\tif (value?.create && data) {\r\n\t\t\t\t\tconst created = await this.create(\r\n\t\t\t\t\t\tvalue.create.contentElementTypeKey,\r\n\t\t\t\t\t\t// We can parse an empty object, cause the rest will be filled in by others.\r\n\t\t\t\t\t\t{} as any,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (created) {\r\n\t\t\t\t\t\tthis.insert(\r\n\t\t\t\t\t\t\tcreated.layout,\r\n\t\t\t\t\t\t\tcreated.content,\r\n\t\t\t\t\t\t\tcreated.settings,\r\n\t\t\t\t\t\t\tdata.originData as UmbBlockRteWorkspaceOriginData,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('Failed to create block');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._catalogueRouteBuilderState.setValue(routeBuilder);\r\n\t\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_BLOCK_RTE_WORKSPACE_MODAL)\r\n\t\t\t.addAdditionalPath('block')\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn { data: { entityType: 'block', preset: {}, baseDataPath: this._dataPath }, modal: { size: 'medium' } };\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tconst newPath = routeBuilder({});\r\n\t\t\t\tthis._workspacePath.setValue(newPath);\r\n\t\t\t});\r\n\t}\r\n\r\n\tprotected _gotBlockManager() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis._manager.layouts,\r\n\t\t\t(layouts) => {\r\n\t\t\t\tthis._layoutEntries.setValue(layouts);\r\n\t\t\t},\r\n\t\t\t'observeParentLayouts',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.layoutEntries,\r\n\t\t\t(layouts) => {\r\n\t\t\t\tthis._manager?.setLayouts(layouts);\r\n\t\t\t},\r\n\t\t\t'observeThisLayouts',\r\n\t\t);\r\n\t}\r\n\r\n\tgetPathForCreateBlock() {\r\n\t\treturn this._catalogueRouteBuilderState.getValue()?.({ view: 'create' });\r\n\t}\r\n\r\n\tgetPathForClipboard() {\r\n\t\treturn this._catalogueRouteBuilderState.getValue()?.({ view: 'clipboard' });\r\n\t}\r\n\r\n\toverride async setLayouts(layouts: Array<UmbBlockRteLayoutModel>) {\r\n\t\tawait this._retrieveManager;\r\n\t\tthis._manager?.setLayouts(layouts);\r\n\t}\r\n\r\n\tasync create(\r\n\t\tcontentElementTypeKey: string,\r\n\t\tpartialLayoutEntry?: Omit<UmbBlockRteLayoutModel, 'contentKey'>,\r\n\t\toriginData?: UmbBlockRteWorkspaceOriginData,\r\n\t) {\r\n\t\tawait this._retrieveManager;\r\n\t\treturn await this._manager?.createWithPresets(contentElementTypeKey, partialLayoutEntry, originData);\r\n\t}\r\n\r\n\t// insert Block?\r\n\r\n\tasync insert(\r\n\t\tlayoutEntry: UmbBlockRteLayoutModel,\r\n\t\tcontent: UmbBlockDataModel,\r\n\t\tsettings: UmbBlockDataModel | undefined,\r\n\t\toriginData: UmbBlockRteWorkspaceOriginData,\r\n\t) {\r\n\t\tawait this._retrieveManager;\r\n\t\treturn this._manager?.insert(layoutEntry, content, settings, originData) ?? false;\r\n\t}\r\n\r\n\t// create Block?\r\n\toverride async delete(contentKey: string) {\r\n\t\tawait super.delete(contentKey);\r\n\t\tthis._manager?.deleteLayoutElement(contentKey);\r\n\t}\r\n\r\n\tprotected async _insertFromPropertyValue(value: UmbBlockRteValueModel, originData: UmbBlockRteWorkspaceOriginData) {\r\n\t\tconst layoutEntries = value.layout[UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS];\r\n\r\n\t\tif (!layoutEntries) {\r\n\t\t\tthrow new Error('No layout entries found');\r\n\t\t}\r\n\r\n\t\tawait Promise.all(\r\n\t\t\tlayoutEntries.map(async (layoutEntry) => {\r\n\t\t\t\tthis._insertBlockFromPropertyValue(layoutEntry, value, originData);\r\n\t\t\t\t// TODO: Missing some way to insert a Block HTML Element into the RTE at the current cursor point. (hopefully the responsibility can be avoided here, but there is some connection missing at this point) [NL]\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\treturn originData;\r\n\t}\r\n}\r\n","import type { UmbBlockRteEntryContext } from './block-rte-entry.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\n// TODO: Make discriminator method for this:\r\nexport const UMB_BLOCK_RTE_ENTRY_CONTEXT = new UmbContextToken<UmbBlockRteEntryContext>('UmbBlockEntryContext');\r\n","import type { UmbBlockRteWorkspaceOriginData } from '../workspace/block-rte-workspace.modal-token.js';\r\nimport type { UmbBlockRteLayoutModel, UmbBlockRteTypeModel } from '../types.js';\r\nimport type { UmbBlockDataModel } from '../../block/types.js';\r\nimport { UmbBlockManagerContext } from '@umbraco-cms/backoffice/block';\r\n\r\nimport '../components/block-rte-entry/index.js';\r\n\r\n/**\r\n * A implementation of the Block Manager specifically for the Rich Text Editor.\r\n */\r\nexport class UmbBlockRteManagerContext<\r\n\tBlockLayoutType extends UmbBlockRteLayoutModel = UmbBlockRteLayoutModel,\r\n> extends UmbBlockManagerContext<UmbBlockRteTypeModel, BlockLayoutType> {\r\n\tremoveOneLayout(contentKey: string) {\r\n\t\tthis._layouts.removeOne(contentKey);\r\n\t}\r\n\tremoveManyLayouts(contentKeys: Array<string>) {\r\n\t\tthis._layouts.remove(contentKeys);\r\n\t}\r\n\r\n\t/**\r\n\t * @param contentElementTypeKey\r\n\t * @param partialLayoutEntry\r\n\t * @param _originData\r\n\t * @deprecated Use createWithPresets instead. Will be removed in v.17.\r\n\t */\r\n\tcreate(\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tcontentElementTypeKey: string,\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tpartialLayoutEntry?: Omit<BlockLayoutType, 'contentKey'>,\r\n\t\t// This property is used by some implementations, but not used in this. Do not remove. [NL]\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t_originData?: UmbBlockRteWorkspaceOriginData,\r\n\t): never {\r\n\t\tthrow new Error('Method deparecated use createWithPresets');\r\n\t}\r\n\tasync createWithPresets(\r\n\t\tcontentElementTypeKey: string,\r\n\t\tpartialLayoutEntry?: Omit<BlockLayoutType, 'contentKey'>,\r\n\t\t// This property is used by some implementations, but not used in this, do not remove. [NL]\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t_originData?: UmbBlockRteWorkspaceOriginData,\r\n\t) {\r\n\t\tconst data = await super._createBlockData(contentElementTypeKey, partialLayoutEntry);\r\n\r\n\t\t// Find block type.\r\n\t\tconst blockType = this.getBlockTypes().find((x) => x.contentElementTypeKey === contentElementTypeKey);\r\n\t\tif (!blockType) {\r\n\t\t\tthrow new Error(`Cannot create block, missing block type for ${contentElementTypeKey}`);\r\n\t\t}\r\n\r\n\t\tif (blockType.displayInline) {\r\n\t\t\tdata.layout.displayInline = true;\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tinsert(\r\n\t\tlayoutEntry: BlockLayoutType,\r\n\t\tcontent: UmbBlockDataModel,\r\n\t\tsettings: UmbBlockDataModel | undefined,\r\n\t\toriginData: UmbBlockRteWorkspaceOriginData,\r\n\t) {\r\n\t\tthis._layouts.appendOne(layoutEntry);\r\n\r\n\t\tthis.insertBlockData(layoutEntry, content, settings, originData);\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param contentKey\r\n\t * @internal\r\n\t */\r\n\tpublic deleteLayoutElement(contentKey: string) {\r\n\t\tthis.removeBlockKey(contentKey);\r\n\t}\r\n}\r\n"],"names":["UMB_BLOCK_RTE_MANAGER_CONTEXT","UmbContextToken","UMB_BLOCK_RTE_ENTRIES_CONTEXT","UmbBlockRteEntryContext","UmbBlockEntryContext","host","x","mergeObservables","a","b","observeMultiple","displayInline","displayInlineConfig","layoutValue","UmbRefRteBlockElement","UmbLitElement","UMB_BLOCK_ENTRY_CONTEXT","context","workspaceEditPath","blockValue","html","css","__decorateClass","property","state","customElement","_context","_UmbBlockRteEntryElement_instances","updateBlockViewProps_fn","observeData_fn","_filterBlockCustomViews","_expose","_extensionSlotRenderMethod","renderBlock_fn","renderActionBar_fn","_renderBuiltinBlockView","renderRefBlock_fn","renderEditAction_fn","renderEditSettingsAction_fn","UmbBlockRteEntryElement","__privateAdd","manifest","elementTypeAlias","isForBlockEditor","stringOrStringArrayContains","UMB_BLOCK_RTE","isForContentTypeAlias","__privateGet","ext","__privateMethod","showContentEdit","key","alias","contentElementTypeName","blockType","index","label","icon","exposed","showActions","layout","settingsKey","UmbObserveValidationStateController","UmbDataPathBlockElementDataQuery","hasMessages","path","value","incoming","content","settings","nothing","UmbTextStyles","UmbBlockRteEntryInlineElement","UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS","UmbBlockRteEntriesContext","UmbBlockEntriesContext","UmbBooleanState","UmbModalRouteRegistrationController","UMB_BLOCK_CATALOGUE_MODAL","routingInfo","data","created","routeBuilder","UMB_BLOCK_RTE_WORKSPACE_MODAL","newPath","layouts","contentElementTypeKey","partialLayoutEntry","originData","layoutEntry","contentKey","layoutEntries","UMB_BLOCK_RTE_ENTRY_CONTEXT","UmbBlockRteManagerContext","UmbBlockManagerContext","contentKeys","_originData"],"mappings":";;;;;;;;;;;AAIO,MAAMA,IAAgC,IAAIC;AAAA,EAChD;AACD,GCFaC,KAAgC,IAAID,EAA2C,wBAAwB;ACE7G,MAAME,WAAgCC,EAO3C;AAAA,EAeD,YAAYC,GAAyB;AACpC,UAAMA,GAAML,GAA+BE,EAA6B,GAfzE,KAAS,gBAAgB,KAAK,QAAQ,iBAAiB,CAACI,MAAOA,IAAKA,EAAE,iBAAiB,KAAS,MAAU,GAC1G,KAAS,sBAAsB,KAAK,WAAW,iBAAiB,CAACA,MAAOA,IAAKA,EAAE,iBAAiB,KAAS,MAAU,GAEnH,KAAS,kCAAkC,KAAK,WAAW;AAAA,MAAiB,CAACA,MAC5EA,IAAKA,EAAE,mCAAmC,KAAS;AAAA,IAAA,GAGpD,KAAS,kBAAkBC;AAAA,MAC1B,CAAC,KAAK,gCAAgC,KAAK,+BAA+B;AAAA,MAC1E,CAAC,CAACC,GAAGC,CAAC,MACED,MAAM,MAAQC,MAAM;AAAA,IAC5B;AAAA,EAKD;AAAA,EAEmB,cAAc;AAAA,EAAC;AAAA,EAEf,cAAc;AAEhC,SAAK;AAAA,MACJC,EAAgB,CAAC,KAAK,eAAe,KAAK,mBAAmB,CAAC;AAAA,MAC9D,CAAC,CAACC,GAAeC,CAAmB,MAAM;AACzC,YAAIA,MAAwB,UAAaD,MAAkB,UAAaC,MAAwBD,GAAe;AAC9G,gBAAME,IAAc,KAAK,QAAQ,SAAA;AACjC,cAAI,CAACA,EAAa;AAClB,eAAK,QAAQ,SAAS;AAAA,YACrB,GAAGA;AAAA,YACH,eAAeD;AAAA,UAAA,CACf;AAAA,QACF;AAAA,MACD;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EAEmB,kBAAkB;AAAA,EAAC;AACvC;;;;;;AC3CO,IAAME,IAAN,cAAoCC,EAAc;AAAA,EA0BxD,cAAc;AACb,UAAA,GAEA,KAAK,eAAeC,GAAyB,CAACC,MAAY;AACzD,WAAK;AAAA,QACJA,GAAS;AAAA,QACT,CAACC,MAAsB;AACtB,eAAK,qBAAqBA;AAAA,QAC3B;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC;AAAA,EACF;AAAA,EAES,SAAS;AACjB,UAAMC,IAAa,EAAE,GAAG,KAAK,SAAS,WAAW,KAAK,UAAU,QAAQ,KAAK,MAAA;AAC7E,WAAOC;AAAA,oCAC2B,KAAK,QAAQ,kBAAkB,KAAK,qBAAqB,WAAc,EAAE;AAAA;AAAA,kCAE3E,KAAK,IAAI;AAAA,mDACQ,KAAK,KAAK,WAAWD,CAAU;AAAA;AAAA;AAAA,EAGjF;AAiCD;AAlFaL,EAmDa,SAAS;AAAA,EACjCO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BD;AA9EAC,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAA,CAAQ;AAAA,GAFdT,EAGZ,WAAA,SAAA,CAAA;AAGAQ,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAA,CAAQ;AAAA,GALdT,EAMZ,WAAA,QAAA,CAAA;AAGAQ,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,IAAO;AAAA,GARhCT,EASZ,WAAA,SAAA,CAAA;AAGAQ,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,SAAS,SAAS,IAAM;AAAA,GAX9BT,EAYZ,WAAA,eAAA,CAAA;AAGAQ,EAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAdlBT,EAeZ,WAAA,WAAA,CAAA;AAGAQ,EAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAjBlBT,EAkBZ,WAAA,YAAA,CAAA;AAGQQ,EAAA;AAAA,EADPE,EAAA;AAAM,GApBKV,EAqBJ,WAAA,sBAAA,CAAA;AAGRQ,EAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAvBlBT,EAwBZ,WAAA,UAAA,CAAA;AAxBYA,IAANQ,EAAA;AAAA,EADNG,EAAc,mBAAmB;AAAA,GACrBX,CAAA;;;;;;;+TCVbY,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAsBO,IAAMC,IAAN,cAAsCxB,EAAoD;AAAA,EA2EhG,cAAc;AACb,UAAA,GA5EKyB,EAAA,MAAAb,CAAA,GAsBNa,EAAA,MAAAd,GAAW,IAAIvB,GAAwB,IAAI,CAAA,GAG3C,KAAQ,mBAAmB,IAG3B,KAAQ,eAAe,IAGvB,KAAQ,SAAS,IAwBjB,KAAQ,kBAA8E;AAAA,MACrF,YAAY;AAAA,MACZ,QAAQ,EAAE,iBAAiB,IAAO,kBAAkB,GAAA;AAAA,IAAM,GAqK3DqC,EAAA,MAASV,GAA0B,CAACW,MAA4C;AAC/E,YAAMC,IAAmB,KAAK,qBAAqB,IAC7CC,IACL,CAACF,EAAS,kBAAkBG,EAA4BH,EAAS,gBAAgBI,CAAa,GACzFC,IACL,CAACL,EAAS,uBAAuBG,EAA4BH,EAAS,qBAAqBC,CAAgB;AAC5G,aAAOC,KAAoBG;AAAA,IAC5B,CAAA,GAEAN,EAAA,MAAAT,GAAU,MAAM;AACf,MAAAgB,EAAA,MAAKrB,GAAS,OAAA;AAAA,IACf,CAAA,GAEAc,EAAA,MAAAR,GAA6B,CAACgB,OAC7BA,EAAI,WAAW,aAAa,QAAQ,WAAW,GAC3C,KAAK,WACDA,EAAI,YAEJ5B;AAAA,MACJ4B,EAAI,SAAS;AAAA;AAAA,wBAEK,KAAK,gBAAgB;AAAA,cAC/BD,QAAKhB,CAAA,CAAO;AAAA,WAGzB,GA6BAS,EAAA,MAAAL,GAA0B,MAKlBc,QAAKtB,GAAAS,CAAA,EAAL,KAAA,IAAA,CACR,GA3MCW,EAAA,MAAKrB,CAAA,EAAS,SAAS,CAAC,GAExB,KAAK;AAAA,MACJqB,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACwB,MAAoB;AACpB,aAAK,mBAAmBA,GACxBD,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,iBAAAsB,EAAA,EAAgB,CAAE;AAAA,MAC3F;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJH,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACyB,MAAQ;AACR,aAAK,eAAe,CAAC,CAACA,GACtBF,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,kBAAkB,CAAC,CAACuB,KAAM;AAAA,MACnG;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJJ,QAAKrB,CAAA,EAAS;AAAA,MACd,CAAC0B,MAAU;AACV,aAAK,oBAAoBA;AAAA,MAC1B;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJL,QAAKrB,CAAA,EAAS;AAAA,MACd,CAAC2B,MAA2B;AAC3B,aAAK,mBAAmBA;AAAA,MACzB;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJN,QAAKrB,CAAA,EAAS;AAAA,MACd,CAAC4B,MAAc;AACd,QAAAL,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,WAAA0B,GAAU;AAAA,MACxC;AAAA,MACA;AAAA,IAAA,GAED,KAAK,QAAQP,EAAA,MAAKrB,CAAA,EAAS,OAAO,CAAC6B,MAAUN,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,OAAA2B,EAAA,CAAM,GAAI,IAAI,GACxF,KAAK;AAAA,MACJR,QAAKrB,CAAA,EAAS;AAAA,MACd,CAAC8B,MAAU;AACV,QAAAP,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,OAAA4B,GAAM,GACnC,KAAK,SAASA;AAAA,MACf;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJT,QAAKrB,CAAA,EAAS;AAAA,MACd,CAAC+B,MAAS;AACT,QAAAR,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,MAAA6B,GAAK,GAClC,KAAK,QAAQA;AAAA,MACd;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJV,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACgC,MAAY;AACZ,QAAAT,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,aAAa,CAAC8B,GAAQ,GACnD,KAAK,WAAWA;AAAA,MACjB;AAAA,MACA;AAAA,IAAA,GAGD,KAAK;AAAA,MACJX,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACiC,MAAgB;AAChB,aAAK,eAAeA;AAAA,MACrB;AAAA,MACA;AAAA,IAAA,GAGD,KAAK;AAAA,MACJZ,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACkC,MAAW;AACX,QAAAX,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAAgC,GAAO;AAAA,MACrC;AAAA,MACA;AAAA,IAAA,GAGDX,EAAA,MAAKtB,GAAAE,CAAA,EAAL,KAAA,IAAA,GAEA,KAAK;AAAA,MACJkB,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACmC,MAAgB;AAChB,aAAK,2BAA2B,4BAA4B,GACxDA,KAEH,IAAIC;AAAA,UACH;AAAA,UACA,kBAAkBC,EAAiC,EAAE,KAAKF,EAAA,CAAa,CAAC;AAAA,UACxE,CAACG,MAAgB;AAChB,iBAAK,mBAAmBA,GACxB,KAAK,gBAAgB,kBAAkBA;AAAA,UACxC;AAAA,UACA;AAAA,QAAA;AAAA,MAGH;AAAA,MACA;AAAA,IAAA,GAGD,KAAK;AAAA,MACJjB,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACuC,MAAS;AACT,aAAK,4BAA4BA,GACjChB,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,iBAAiBqC,EAAA,GAAO;AAAA,MACjG;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJlB,QAAKrB,CAAA,EAAS;AAAA,MACd,CAACuC,MAAS;AACT,aAAK,6BAA6BA,GAClChB,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,kBAAkBqC,EAAA,GAAO;AAAA,MAClG;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EApMA,IAAW,WAAWC,GAA2B;AAChD,IAAKA,MACL,KAAK,cAAcA,GACnBnB,EAAA,MAAKrB,CAAA,EAAS,cAAcwC,CAAK,GAEjC,IAAIJ;AAAA,MACH;AAAA,MACA,iBAAiBC,EAAiC,EAAE,KAAKG,EAAA,CAAO,CAAC;AAAA,MACjE,CAACF,MAAgB;AAChB,aAAK,kBAAkBA,GACvB,KAAK,gBAAgB,iBAAiBA;AAAA,MACvC;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EACA,IAAW,aAAiC;AAC3C,WAAO,KAAK;AAAA,EACb;AAAA,EAsMS,oBAAoB;AAC5B,UAAM,kBAAA,GACN,KAAK,aAAa,mBAAmB,OAAO;AAAA,EAC7C;AAAA,EAkHS,SAAS;AACjB,WAAOf,QAAKtB,GAAAM,CAAA,EAAL,KAAA,IAAA;AAAA,EACR;AAoCD;AA9VCP,IAAA,oBAAA,QAAA;AAtBMC,IAAA,oBAAA,QAAA;AAsENC,IAAqB,SAACuC,GAA+E;AACpG,OAAK,kBAAkB,EAAE,GAAG,KAAK,iBAAiB,GAAGA,EAAA,GACrD,KAAK,cAAc,iBAAiB;AACrC;AA+HMtC,IAAY,iBAAG;AACpB,OAAK;AAAA,IACJ,MAAMkB,EAAA,MAAKrB,CAAA,EAAS,cAAA;AAAA,IACpB,CAAC0C,MAAY;AACZ,MAAAnB,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,SAAAwC,GAAQ;AAAA,IACtC;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ,MAAMrB,EAAA,MAAKrB,CAAA,EAAS,eAAA;AAAA,IACpB,CAAC2C,MAAa;AACb,MAAApB,EAAA,MAAKtB,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,UAAAyC,GAAS;AAAA,IACvC;AAAA,IACA;AAAA,EAAA;AAEF;AAOSvC,IAAA,oBAAA,QAAA;AASTC,IAAA,oBAAA,QAAA;AAIAC,IAAA,oBAAA,QAAA;AAcAC,IAAY,WAAG;AACd,SAAO,KAAK,cAAc,KAAK,oBAC5Bb;AAAA;AAAA;AAAA;AAAA;AAAA,uBAKkB2B,QAAKf,CAAA,CAA0B;AAAA,+BACvBe,QAAKZ,CAAA,CAAuB;AAAA,gBAC3C,KAAK,eAAe;AAAA,iBACnBY,QAAKjB,CAAA,CAAuB;AAAA;AAAA,QAErCmB,EAAA,MAAKtB,MAAL,KAAA,IAAA,CAAuB;AAAA,QACvB,CAAC,KAAK,oBAAoB,KAAK,kBAC9BP,gFACAkD,CAAO;AAAA;AAAA,QAGXA;AACJ;AAEApC,IAAgB,WAAG;AAClB,SAAO,KAAK,eACTd,oBAAuB6B,EAAA,MAAKtB,GAAAU,CAAA,EAAL,UAAwB,GAAGY,EAAA,MAAKtB,GAAAW,CAAA,EAAL,KAAA,IAAA,CAAgC,sBAClFgC;AACJ;AAEAnC,IAAA,oBAAA,QAAA;AAQAC,IAAe,WAAG;AACjB,SAAOhB;AAAA,YACG,KAAK,MAAM;AAAA,WACZ,KAAK,KAAK;AAAA,YACT,KAAK,gBAAgB,KAAK;AAAA,kBACpB,CAAC,KAAK,QAAQ;AAAA,cAClB,KAAK,gBAAgB,OAAO;AAAA,eAC3B,KAAK,gBAAgB,QAAQ;AAAA,aAC/B,KAAK,gBAAgB,MAAM;AACvC;AAEAiB,IAAiB,WAAG;AACnB,SAAO,KAAK,oBAAoB,KAAK,4BAClCjB;AAAA;AAAA;AAAA,aAGQ,KAAK,kBAAkB,YAAY,EAAE;AAAA,YACtC,KAAK,yBAAyB;AAAA,sBACpB,KAAK,aAAa,KAAQ,aAAa,WAAW;AAAA,OACjE,KAAK,kBACJA,gFACAkD,CAAO;AAAA,qBAEV,KAAK,qBAAqB,MAAS,KAAK,aAAa,KACpDlD;AAAA,eACS2B,QAAKhB,CAAA,CAAO;AAAA,cACb,KAAK,SAAS,KAAK,6BAA6B,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,sBAI9EuC;AACL;AAEAhC,IAAyB,WAAG;AAC3B,SAAOlB;AAAA,KACJ,KAAK,gBAAgB,KAAK,6BACzBA;AAAA;AAAA;AAAA,cAGQ,KAAK,mBAAmB,YAAY,EAAE;AAAA,aACvC,KAAK,0BAA0B;AAAA;AAAA,QAEpC,KAAK,mBACJA,iFACAkD,CAAO;AAAA,sBAEVA,CAAO;AAAA;AAEZ;AA5UY/B,EAkVa,SAAS;AAAA,EACjCgC;AAAA,EACAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+BD;AAjXWC,EAAA;AAAA,EADVC,EAAS,EAAE,MAAM,QAAQ,WAAW,oBAAoB,SAAS,IAAM;AAAA,GAD5DgB,EAED,WAAA,cAAA,CAAA;AAuBHjB,EAAA;AAAA,EADPE,EAAA;AAAM,GAxBKe,EAyBJ,WAAA,oBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GA3BKe,EA4BJ,WAAA,gBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GA9BKe,EA+BJ,WAAA,UAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GAjCKe,EAkCJ,WAAA,SAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GApCKe,EAqCJ,WAAA,YAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GAvCKe,EAwCJ,WAAA,gBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GA1CKe,EA2CJ,WAAA,6BAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GA7CKe,EA8CJ,WAAA,8BAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GAhDKe,EAiDJ,WAAA,qBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GAnDKe,EAoDJ,WAAA,oBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPE,EAAA;AAAM,GAtDKe,EAuDJ,WAAA,mBAAA,CAAA;AAQRjB,EAAA;AAAA,EAFCC,EAAS,EAAE,MAAM,SAAS,WAAW,mBAAmB,SAAS,IAAM;AAAA,GA7D5DgB,EA+DZ,WAAA,mBAAA,CAAA;AAKAjB,EAAA;AAAA,EAFCC,EAAS,EAAE,MAAM,SAAS,WAAW,oBAAoB,SAAS,IAAM;AAAA,GAlE7DgB,EAoEZ,WAAA,oBAAA,CAAA;AApEYA,IAANjB,EAAA;AAAA,EADNG,EAAc,eAAe;AAAA,GACjBc,CAAA;;;;;;ACdN,IAAMiC,IAAN,cAA4CjC,EAAwB;AAS3E;AATaiC,EACI,SAAS;AAAA,EACxB,GAAGjC,EAAwB;AAAA,EAC3BlB;AAAA;AAAA;AAAA;AAAA;AAKD;AARYmD,IAANlD,GAAA;AAAA,EADNG,EAAc,sBAAsB;AAAA,GACxB+C,CAAA;ACQb,MAAMC,KAA6C;AAE5C,MAAMC,WAAkCC,EAM7C;AAAA,EAMD,YAAYtE,GAAyB;AACpC,UAAMA,GAAML,CAA6B,GAH1C,KAAgB,YAAY,IAAI4E,EAAgB,EAAI,EAAE,aAAA,GAKrD,IAAIC,EAAoC,MAAMC,CAAyB,EACrE,kBAAkB,kBAAkB,EACpC,QAAQ,CAACC,OACF;AAAA,MACN,MAAM;AAAA,QACL,QAAQ,KAAK,UAAU,cAAA,KAAmB,CAAA;AAAA,QAC1C,aAAa,CAAA;AAAA,QACb,eAAeA,EAAY,SAAS;AAAA,QACpC,YAAY,CAAA;AAAA,QACZ,wBAAwB;AAAA,MAAA;AAAA,IACzB,EAED,EACA,SAAS,OAAOb,GAAOc,MAAS;AAChC,UAAId,GAAO,UAAUc,GAAM;AAC1B,cAAMC,IAAU,MAAM,KAAK;AAAA,UAC1Bf,EAAM,OAAO;AAAA;AAAA,UAEb,CAAA;AAAA,QAAC;AAEF,YAAIe;AACH,eAAK;AAAA,YACJA,EAAQ;AAAA,YACRA,EAAQ;AAAA,YACRA,EAAQ;AAAA,YACRD,EAAK;AAAA,UAAA;AAAA;AAGN,gBAAM,IAAI,MAAM,wBAAwB;AAAA,MAE1C;AAAA,IACD,CAAC,EACA,oBAAoB,CAACE,MAAiB;AACtC,WAAK,4BAA4B,SAASA,CAAY;AAAA,IACvD,CAAC,GAEF,IAAIL,EAAoC,MAAMM,CAA6B,EACzE,kBAAkB,OAAO,EACzB,QAAQ,OACD,EAAE,MAAM,EAAE,YAAY,SAAS,QAAQ,CAAA,GAAI,cAAc,KAAK,aAAa,OAAO,EAAE,MAAM,WAAS,EAC1G,EACA,oBAAoB,CAACD,MAAiB;AACtC,YAAME,IAAUF,EAAa,EAAE;AAC/B,WAAK,eAAe,SAASE,CAAO;AAAA,IACrC,CAAC;AAAA,EACH;AAAA,EAEU,mBAAmB;AAC5B,IAAK,KAAK,aAEV,KAAK;AAAA,MACJ,KAAK,SAAS;AAAA,MACd,CAACC,MAAY;AACZ,aAAK,eAAe,SAASA,CAAO;AAAA,MACrC;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJ,KAAK;AAAA,MACL,CAACA,MAAY;AACZ,aAAK,UAAU,WAAWA,CAAO;AAAA,MAClC;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EAEA,wBAAwB;AACvB,WAAO,KAAK,4BAA4B,SAAA,IAAa,EAAE,MAAM,UAAU;AAAA,EACxE;AAAA,EAEA,sBAAsB;AACrB,WAAO,KAAK,4BAA4B,SAAA,IAAa,EAAE,MAAM,aAAa;AAAA,EAC3E;AAAA,EAEA,MAAe,WAAWA,GAAwC;AACjE,UAAM,KAAK,kBACX,KAAK,UAAU,WAAWA,CAAO;AAAA,EAClC;AAAA,EAEA,MAAM,OACLC,GACAC,GACAC,GACC;AACD,iBAAM,KAAK,kBACJ,MAAM,KAAK,UAAU,kBAAkBF,GAAuBC,GAAoBC,CAAU;AAAA,EACpG;AAAA;AAAA,EAIA,MAAM,OACLC,GACArB,GACAC,GACAmB,GACC;AACD,iBAAM,KAAK,kBACJ,KAAK,UAAU,OAAOC,GAAarB,GAASC,GAAUmB,CAAU,KAAK;AAAA,EAC7E;AAAA;AAAA,EAGA,MAAe,OAAOE,GAAoB;AACzC,UAAM,MAAM,OAAOA,CAAU,GAC7B,KAAK,UAAU,oBAAoBA,CAAU;AAAA,EAC9C;AAAA,EAEA,MAAgB,yBAAyBxB,GAA8BsB,GAA4C;AAClH,UAAMG,IAAgBzB,EAAM,OAAOO,EAA0C;AAE7E,QAAI,CAACkB;AACJ,YAAM,IAAI,MAAM,yBAAyB;AAG1C,iBAAM,QAAQ;AAAA,MACbA,EAAc,IAAI,OAAOF,MAAgB;AACxC,aAAK,8BAA8BA,GAAavB,GAAOsB,CAAU;AAAA,MAElE,CAAC;AAAA,IAAA,GAGKA;AAAA,EACR;AACD;ACvJO,MAAMI,KAA8B,IAAI3F,EAAyC,sBAAsB;ACMvG,MAAM4F,WAEHC,EAA8D;AAAA,EACvE,gBAAgBJ,GAAoB;AACnC,SAAK,SAAS,UAAUA,CAAU;AAAA,EACnC;AAAA,EACA,kBAAkBK,GAA4B;AAC7C,SAAK,SAAS,OAAOA,CAAW;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAECT,GAEAC,GAGAS,GACQ;AACR,UAAM,IAAI,MAAM,0CAA0C;AAAA,EAC3D;AAAA,EACA,MAAM,kBACLV,GACAC,GAGAS,GACC;AACD,UAAMhB,IAAO,MAAM,MAAM,iBAAiBM,GAAuBC,CAAkB,GAG7EjC,IAAY,KAAK,gBAAgB,KAAK,CAAChD,MAAMA,EAAE,0BAA0BgF,CAAqB;AACpG,QAAI,CAAChC;AACJ,YAAM,IAAI,MAAM,+CAA+CgC,CAAqB,EAAE;AAGvF,WAAIhC,EAAU,kBACb0B,EAAK,OAAO,gBAAgB,KAGtBA;AAAA,EACR;AAAA,EAEA,OACCS,GACArB,GACAC,GACAmB,GACC;AACD,gBAAK,SAAS,UAAUC,CAAW,GAEnC,KAAK,gBAAgBA,GAAarB,GAASC,GAAUmB,CAAU,GAExD;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,oBAAoBE,GAAoB;AAC9C,SAAK,eAAeA,CAAU;AAAA,EAC/B;AACD;"}