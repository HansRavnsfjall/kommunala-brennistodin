{"version":3,"file":"block-scale-handler.element-BKzGcvEu.js","sources":["../../../src/packages/block/block-grid/utils/index.ts","../../../src/packages/block/block-grid/context/block-grid-scale-manager/block-grid-scale-manager.controller.ts","../../../src/packages/block/block-grid/components/block-scale-handler/block-scale-handler.element.ts"],"sourcesContent":["import type { UmbBlockGridLayoutModel } from '../types.js';\r\n\r\n/**\r\n *\r\n * @param {number} target - The target number\r\n * @param {Array<number>} map - The map to search in\r\n * @param {number} max - The max value to return if no match is found\r\n * @returns {number | undefined} - The closest number in the map to the target\r\n */\r\nexport function closestColumnSpanOption(target: number, map: Array<number>, max: number): number | undefined {\r\n\tif (map.length > 0) {\r\n\t\tconst result = map.reduce((a, b) => {\r\n\t\t\tif (a > max) {\r\n\t\t\t\treturn b;\r\n\t\t\t}\r\n\t\t\tconst aDiff = Math.abs(a - target);\r\n\t\t\tconst bDiff = Math.abs(b - target);\r\n\r\n\t\t\tif (aDiff === bDiff) {\r\n\t\t\t\treturn a < b ? a : b;\r\n\t\t\t} else {\r\n\t\t\t\treturn bDiff < aDiff ? b : a;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn;\r\n}\r\n\r\n/**\r\n *\r\n * @param {UmbBlockGridLayoutModel} entry - The entry to iterate over\r\n * @param {(entry:UmbBlockGridLayoutModel) => void } callback - The callback to call for each entry\r\n */\r\nexport async function forEachBlockLayoutEntryOf(\r\n\tentry: UmbBlockGridLayoutModel,\r\n\tcallback: (entry: UmbBlockGridLayoutModel, parentUnique: string, areaKey: string) => PromiseLike<void>,\r\n): Promise<void> {\r\n\tif (entry.areas) {\r\n\t\tconst parentUnique = entry.contentKey;\r\n\t\tawait Promise.all(\r\n\t\t\tentry.areas.map(async (area) => {\r\n\t\t\t\tconst areaKey = area.key;\r\n\t\t\t\tawait Promise.all(\r\n\t\t\t\t\tarea.items.map(async (item) => {\r\n\t\t\t\t\t\tawait callback(item, parentUnique, areaKey);\r\n\t\t\t\t\t\tawait forEachBlockLayoutEntryOf(item, callback);\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n","import { closestColumnSpanOption } from '../../utils/index.js';\r\nimport { getAccumulatedValueOfIndex, getInterpolatedIndexOfPositionInWeightMap } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\n// This might be more generic than Block Grid, but this is where it belongs currently:\r\nexport interface UmbBlockGridScalableContext extends UmbControllerHost {\r\n\tsetColumnSpan: (columnSpan: number) => void;\r\n\tsetRowSpan: (rowSpan: number) => void;\r\n\tgetColumnSpan: () => number | undefined;\r\n\tgetRowSpan: () => number | undefined;\r\n\tgetMinMaxRowSpan: () => [number, number] | undefined;\r\n\tgetRelevantColumnSpanOptions: () => Array<number> | undefined;\r\n}\r\n\r\n// This might be more generic than Block Grid, but this is where it belongs currently:\r\nexport interface UmbBlockGridScalableContainerContext extends UmbControllerHost {\r\n\tgetLayoutColumns: () => number | undefined;\r\n\tgetLayoutContainerElement: () => HTMLElement | undefined;\r\n}\r\n\r\nexport class UmbBlockGridScaleManager extends UmbControllerBase {\r\n\t//\r\n\t#runtimeGridColumns: Array<number> = [];\r\n\t#runtimeGridRows: Array<number> = [];\r\n\t#lockedGridRows = 0;\r\n\t//\r\n\toverride _host: UmbBlockGridScalableContext;\r\n\tprotected _entries?: UmbBlockGridScalableContainerContext;\r\n\r\n\tconstructor(host: UmbBlockGridScalableContext) {\r\n\t\tsuper(host, 'blockGridScaleManager');\r\n\t\tthis._host = host;\r\n\t}\r\n\r\n\tsetEntriesContext(entriesContext: UmbBlockGridScalableContainerContext | undefined) {\r\n\t\tthis._entries = entriesContext;\r\n\t}\r\n\r\n\t// Scaling feature:\r\n\r\n\t#updateGridData(\r\n\t\tlayoutContainer: HTMLElement,\r\n\t\tlayoutContainerRect: DOMRect,\r\n\t\tlayoutItemRect: DOMRect,\r\n\t\tupdateRowTemplate: boolean,\r\n\t) {\r\n\t\tif (!this._entries) return;\r\n\t\tconst layoutColumns = this._entries.getLayoutColumns() ?? 0;\r\n\r\n\t\tconst computedStyles = window.getComputedStyle(layoutContainer);\r\n\r\n\t\tconst columnGap = Number(computedStyles.columnGap.split('px')[0]) || 0;\r\n\t\tconst rowGap = Number(computedStyles.rowGap.split('px')[0]) || 0;\r\n\r\n\t\tlet gridColumns = computedStyles.gridTemplateColumns\r\n\t\t\t.trim()\r\n\t\t\t.split('px')\r\n\t\t\t.map((x) => Number(x));\r\n\t\tlet gridRows = computedStyles.gridTemplateRows\r\n\t\t\t.trim()\r\n\t\t\t.split('px')\r\n\t\t\t.map((x) => Number(x));\r\n\r\n\t\t// remove empties:\r\n\t\tgridColumns = gridColumns.filter((n) => n > 0);\r\n\t\tgridRows = gridRows.filter((n) => n > 0);\r\n\r\n\t\t// We use this code to lock the templateRows, while scaling. otherwise scaling Rows is too crazy.\r\n\t\tif (updateRowTemplate || gridRows.length > this.#lockedGridRows) {\r\n\t\t\tthis.#lockedGridRows = gridRows.length;\r\n\t\t\tlayoutContainer.style.gridTemplateRows = computedStyles.gridTemplateRows;\r\n\t\t}\r\n\r\n\t\t// add gaps:\r\n\t\tconst gridColumnsLen = gridColumns.length;\r\n\t\tgridColumns = gridColumns.map((n, i) => (gridColumnsLen === i ? n : n + columnGap));\r\n\t\tconst gridRowsLen = gridRows.length;\r\n\t\tgridRows = gridRows.map((n, i) => (gridRowsLen === i ? n : n + rowGap));\r\n\r\n\t\t// ensure all columns are there.\r\n\t\t// This will also ensure handling non-css-grid mode,\r\n\t\t// use container width divided by amount of columns( or the item width divided by its amount of columnSpan)\r\n\t\tlet amountOfColumnsInWeightMap = gridColumns.length;\r\n\t\tconst amountOfUnknownColumns = layoutColumns - amountOfColumnsInWeightMap;\r\n\t\tif (amountOfUnknownColumns > 0) {\r\n\t\t\tconst accumulatedValue = getAccumulatedValueOfIndex(amountOfColumnsInWeightMap, gridColumns) || 0;\r\n\t\t\tconst missingColumnWidth = (layoutContainerRect.width - accumulatedValue) / amountOfUnknownColumns;\r\n\t\t\twhile (amountOfColumnsInWeightMap++ < layoutColumns) {\r\n\t\t\t\tgridColumns.push(missingColumnWidth);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Handle non css grid mode for Rows:\r\n\t\t// use item height divided by rowSpan to identify row heights.\r\n\t\tif (gridRows.length === 0) {\r\n\t\t\t// Push its own height twice, to give something to scale with.\r\n\t\t\tgridRows.push(layoutItemRect.top - layoutContainerRect.top);\r\n\r\n\t\t\tlet i = 0;\r\n\t\t\tconst itemSingleRowHeight = layoutItemRect.height;\r\n\t\t\twhile (i++ < (this._host.getRowSpan() ?? 0)) {\r\n\t\t\t\tgridRows.push(itemSingleRowHeight);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// add a few extra rows, so there is something to extend too.\r\n\t\t// Add extra options for the ability to extend beyond current content:\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\r\n\t\tthis.#runtimeGridColumns = gridColumns;\r\n\t\tthis.#runtimeGridRows = gridRows;\r\n\t}\r\n\r\n\t// TODO: Rename to calc something.\r\n\t#getNewSpans(startX: number, startY: number, endX: number, endY: number) {\r\n\t\tconst layoutColumns = this._entries?.getLayoutColumns();\r\n\t\tif (!layoutColumns) return;\r\n\r\n\t\tconst blockStartCol = Math.round(getInterpolatedIndexOfPositionInWeightMap(startX, this.#runtimeGridColumns));\r\n\t\tconst blockStartRow = Math.round(getInterpolatedIndexOfPositionInWeightMap(startY, this.#runtimeGridRows));\r\n\t\tconst blockEndCol = getInterpolatedIndexOfPositionInWeightMap(endX, this.#runtimeGridColumns);\r\n\t\tconst blockEndRow = getInterpolatedIndexOfPositionInWeightMap(endY, this.#runtimeGridRows);\r\n\r\n\t\tlet newColumnSpan = Math.max(blockEndCol - blockStartCol, 1);\r\n\r\n\t\tconst columnOptions = this._host.getRelevantColumnSpanOptions();\r\n\t\tif (!columnOptions) return;\r\n\r\n\t\t// Find nearest allowed Column:\r\n\t\tconst bestColumnSpanOption = closestColumnSpanOption(newColumnSpan, columnOptions, layoutColumns - blockStartCol);\r\n\t\tnewColumnSpan = bestColumnSpanOption ?? layoutColumns;\r\n\r\n\t\t// Find allowed row spans:\r\n\t\tconst minMaxRowSpan = this._host.getMinMaxRowSpan();\r\n\t\tif (!minMaxRowSpan) return;\r\n\t\tconst [rowMinSpan, rowMaxSpan] = minMaxRowSpan;\r\n\t\tlet newRowSpan = Math.round(Math.max(blockEndRow - blockStartRow, rowMinSpan));\r\n\t\tif (rowMaxSpan != null) {\r\n\t\t\tnewRowSpan = Math.min(newRowSpan, rowMaxSpan);\r\n\t\t}\r\n\r\n\t\treturn { columnSpan: newColumnSpan, rowSpan: newRowSpan, startCol: blockStartCol, startRow: blockStartRow };\r\n\t}\r\n\r\n\tpublic onScaleMouseDown(event: MouseEvent) {\r\n\t\tconst layoutContainer = this._entries?.getLayoutContainerElement();\r\n\t\tif (!layoutContainer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent.preventDefault();\r\n\r\n\t\t//this.#isScaleMode = true;\r\n\r\n\t\twindow.addEventListener('mousemove', this.onScaleMouseMove);\r\n\t\twindow.addEventListener('mouseup', this.onScaleMouseUp);\r\n\t\twindow.addEventListener('mouseleave', this.onScaleMouseUp);\r\n\r\n\t\tconst layoutItemRect = this.getHostElement().getBoundingClientRect();\r\n\t\tthis.#updateGridData(layoutContainer, layoutContainer.getBoundingClientRect(), layoutItemRect, true);\r\n\r\n\t\t/*\r\n\t\tscaleBoxBackdropEl = document.createElement('div');\r\n\t\tscaleBoxBackdropEl.className = 'umb-block-grid__scalebox-backdrop';\r\n\t\tlayoutContainer.appendChild(scaleBoxBackdropEl);\r\n\t\t*/\r\n\t}\r\n\r\n\t#updateLayoutRaf = 0;\r\n\tonScaleMouseMove = (e: MouseEvent) => {\r\n\t\tconst layoutContainer = this._entries?.getLayoutContainerElement();\r\n\t\tif (!layoutContainer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst layoutContainerRect = layoutContainer.getBoundingClientRect();\r\n\t\tconst layoutItemRect = this.getHostElement().getBoundingClientRect();\r\n\r\n\t\tconst startX = layoutItemRect.left - layoutContainerRect.left;\r\n\t\tconst startY = layoutItemRect.top - layoutContainerRect.top;\r\n\t\tconst endX = e.clientX - layoutContainerRect.left;\r\n\t\tconst endY = e.clientY - layoutContainerRect.top;\r\n\r\n\t\tconst newSpans = this.#getNewSpans(startX, startY, endX, endY);\r\n\t\tif (!newSpans) return;\r\n\r\n\t\tconst updateRowTemplate = this._host.getColumnSpan() !== newSpans.columnSpan;\r\n\t\tif (updateRowTemplate) {\r\n\t\t\t// If we like to update we need to first remove the lock, make the browser render onces and then update.\r\n\t\t\t(layoutContainer as HTMLElement).style.gridTemplateRows = '';\r\n\t\t}\r\n\t\tcancelAnimationFrame(this.#updateLayoutRaf);\r\n\t\tthis.#updateLayoutRaf = requestAnimationFrame(() => {\r\n\t\t\t// As mentioned above we need to wait until the browser has rendered DOM without the lock of gridTemplateRows.\r\n\t\t\tthis.#updateGridData(layoutContainer, layoutContainerRect, layoutItemRect, updateRowTemplate);\r\n\t\t});\r\n\r\n\t\t// update as we go:\r\n\t\tthis._host.setColumnSpan(newSpans.columnSpan);\r\n\t\tthis._host.setRowSpan(newSpans.rowSpan);\r\n\t};\r\n\r\n\tonScaleMouseUp = (e: MouseEvent) => {\r\n\t\tconst layoutContainer = this._entries?.getLayoutContainerElement();\r\n\t\tif (!layoutContainer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcancelAnimationFrame(this.#updateLayoutRaf);\r\n\r\n\t\t// Remove listeners:\r\n\t\twindow.removeEventListener('mousemove', this.onScaleMouseMove);\r\n\t\twindow.removeEventListener('mouseup', this.onScaleMouseUp);\r\n\t\twindow.removeEventListener('mouseleave', this.onScaleMouseUp);\r\n\r\n\t\tconst layoutContainerRect = layoutContainer.getBoundingClientRect();\r\n\t\tconst layoutItemRect = this.getHostElement().getBoundingClientRect();\r\n\r\n\t\tconst startX = layoutItemRect.left - layoutContainerRect.left;\r\n\t\tconst startY = layoutItemRect.top - layoutContainerRect.top;\r\n\t\tconst endX = e.clientX - layoutContainerRect.left;\r\n\t\tconst endY = e.clientY - layoutContainerRect.top;\r\n\t\tconst newSpans = this.#getNewSpans(startX, startY, endX, endY);\r\n\r\n\t\t// release the lock of gridTemplateRows:\r\n\t\t//layoutContainer.removeChild(scaleBoxBackdropEl);\r\n\t\t//this.scaleBoxBackdropEl = null;\r\n\t\tlayoutContainer.style.gridTemplateRows = '';\r\n\t\t//this.#isScaleMode = false;\r\n\r\n\t\t// Clean up variables:\r\n\t\t//this.layoutContainer = null;\r\n\t\t//this.gridColumns = [];\r\n\t\t//this.gridRows = [];\r\n\t\tthis.#lockedGridRows = 0;\r\n\r\n\t\tif (!newSpans) return;\r\n\t\t// Update block size:\r\n\t\tthis._host.setColumnSpan(newSpans.columnSpan);\r\n\t\tthis._host.setRowSpan(newSpans.rowSpan);\r\n\t};\r\n}\r\n\r\nexport default UmbBlockGridScaleManager;\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, css, customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\n/**\r\n * @element umb-block-scale-handler\r\n */\r\n@customElement('umb-block-scale-handler')\r\nexport class UmbBlockGridScaleHandlerElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t//\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.addEventListener('dragstart', (e: DragEvent) => {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t\tthis.addEventListener('dragstart', (e: DragEvent) => {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t}\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<button aria-label=\"TODO: Some introduction to keyboard scaling\" id=\"handler\"></button>\r\n\t\t\t<slot id=\"label\"></slot>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t}\r\n\t\t\t:host(:focus-within),\r\n\t\t\t:host(:hover) {\r\n\t\t\t\tborder: var(--uui-color-interactive) solid 1px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t#handler {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\t// TODO: Look at the feature I out-commented here, what was that suppose to do [NL]:\r\n\t\t\t\t//display: var(--umb-block-grid--block-ui-display, block);\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tz-index: 2;\r\n\r\n\t\t\t\tpointer-events: all;\r\n\t\t\t\tcursor: nwse-resize;\r\n\r\n\t\t\t\tbottom: -4px;\r\n\t\t\t\tright: -4px;\r\n\t\t\t\twidth: 7px;\r\n\t\t\t\theight: 7px;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\tborder: var(--uui-color-interactive) solid 1px;\r\n\t\t\t\tbox-shadow: 0 0 0 1px rgba(255, 255, 255, 0.7);\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 120ms;\r\n\t\t\t}\r\n\t\t\t#handler:hover,\r\n\t\t\t#handler:focus {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\t\t\t#handler:focus {\r\n\t\t\t\toutline: 2px solid var(--uui-color-selected);\r\n\t\t\t\toutline-offset: 1px;\r\n\t\t\t}\r\n\t\t\t#handler::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tinset: -10px;\r\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0);\r\n\t\t\t}\r\n\t\t\t#handler:focus + #label,\r\n\t\t\t#handler:hover + #label {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t#label {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\ttop: 100%;\r\n\t\t\t\tleft: 100%;\r\n\t\t\t\tmargin-left: 6px;\r\n\t\t\t\tmargin-top: 6px;\r\n\t\t\t\tz-index: 2;\r\n\r\n\t\t\t\tbackground-color: white;\r\n\t\t\t\tcolor: black;\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t\tpadding: 0px 6px;\r\n\t\t\t\tborder-radius: 3px;\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 120ms;\r\n\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t:host([scale-mode]) > #handler {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\t\t\t:host([scale-mode]) > #label {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridScaleHandlerElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-scale-handler': UmbBlockGridScaleHandlerElement;\r\n\t}\r\n}\r\n"],"names":["closestColumnSpanOption","target","map","max","result","a","b","aDiff","bDiff","forEachBlockLayoutEntryOf","entry","callback","parentUnique","area","areaKey","item","UmbBlockGridScaleManager","UmbControllerBase","host","#runtimeGridColumns","#runtimeGridRows","#lockedGridRows","#updateLayoutRaf","e","layoutContainer","layoutContainerRect","layoutItemRect","startX","startY","endX","endY","newSpans","#getNewSpans","updateRowTemplate","#updateGridData","entriesContext","layoutColumns","computedStyles","columnGap","rowGap","gridColumns","x","gridRows","n","gridColumnsLen","i","gridRowsLen","amountOfColumnsInWeightMap","amountOfUnknownColumns","accumulatedValue","getAccumulatedValueOfIndex","missingColumnWidth","itemSingleRowHeight","blockStartCol","getInterpolatedIndexOfPositionInWeightMap","blockStartRow","blockEndCol","blockEndRow","newColumnSpan","columnOptions","minMaxRowSpan","rowMinSpan","rowMaxSpan","newRowSpan","event","UmbBlockGridScaleHandlerElement","UmbLitElement","html","css","__decorateClass","customElement"],"mappings":"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"}