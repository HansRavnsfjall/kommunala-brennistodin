{"version":3,"file":"block-workspace-view-edit.element-h83-m4xf.js","sources":["../../../src/packages/block/block/workspace/views/edit/block-workspace-view-edit.element.ts"],"sourcesContent":["import type { UmbBlockWorkspaceElementManagerNames } from '../../block-workspace.context.js';\r\nimport { UMB_BLOCK_WORKSPACE_CONTEXT } from '../../block-workspace.context-token.js';\r\nimport type { UmbBlockWorkspaceViewEditTabElement } from './block-workspace-view-edit-tab.element.js';\r\nimport { css, html, customElement, state, repeat, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbContentTypeModel, UmbPropertyTypeContainerMergedModel } from '@umbraco-cms/backoffice/content-type';\r\nimport { UmbContentTypeContainerStructureHelper } from '@umbraco-cms/backoffice/content-type';\r\nimport type { UmbRoute, UmbRouterSlotChangeEvent, UmbRouterSlotInitEvent } from '@umbraco-cms/backoffice/router';\r\nimport { encodeFolderName } from '@umbraco-cms/backoffice/router';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { ManifestWorkspaceView, UmbWorkspaceViewElement } from '@umbraco-cms/backoffice/workspace';\r\n\r\n@customElement('umb-block-workspace-view-edit')\r\nexport class UmbBlockWorkspaceViewEditElement extends UmbLitElement implements UmbWorkspaceViewElement {\r\n\t@property({ attribute: false })\r\n\tpublic set manifest(value: ManifestWorkspaceView | undefined) {\r\n\t\tthis.#managerName = (value?.meta as any).blockElementManagerName ?? 'content';\r\n\t\tthis.#setStructureManager();\r\n\t}\r\n\tpublic get manifest(): ManifestWorkspaceView | undefined {\r\n\t\treturn;\r\n\t}\r\n\t#managerName?: UmbBlockWorkspaceElementManagerNames;\r\n\t#blockWorkspace?: typeof UMB_BLOCK_WORKSPACE_CONTEXT.TYPE;\r\n\t#tabsStructureHelper = new UmbContentTypeContainerStructureHelper<UmbContentTypeModel>(this);\r\n\r\n\t//@state()\r\n\t//private _hasRootProperties = false;\r\n\r\n\t@state()\r\n\tprivate _hasRootGroups = false;\r\n\r\n\t@state()\r\n\tprivate _routes: UmbRoute[] = [];\r\n\r\n\t@state()\r\n\tprivate _tabs?: Array<UmbPropertyTypeContainerMergedModel>;\r\n\r\n\t@state()\r\n\tprivate _routerPath?: string;\r\n\r\n\t@state()\r\n\tprivate _activePath = '';\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.#tabsStructureHelper.setIsRoot(true);\r\n\t\tthis.#tabsStructureHelper.setContainerChildType('Tab');\r\n\t\tthis.observe(\r\n\t\t\tthis.#tabsStructureHelper.childContainers,\r\n\t\t\t(tabs) => {\r\n\t\t\t\tthis._tabs = tabs;\r\n\t\t\t\tthis.#createRoutes();\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\t// _hasRootProperties can be gotten via _tabsStructureHelper.hasProperties. But we do not support root properties currently.\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.#blockWorkspace = workspaceContext;\r\n\t\t\tthis.#setStructureManager();\r\n\t\t});\r\n\t}\r\n\r\n\tasync #setStructureManager() {\r\n\t\tif (!this.#blockWorkspace || !this.#managerName) return;\r\n\t\tconst blockManager = this.#blockWorkspace[this.#managerName];\r\n\t\tthis.#tabsStructureHelper.setStructureManager(blockManager.structure);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#blockWorkspace.variantId,\r\n\t\t\t(variantId) => {\r\n\t\t\t\tif (variantId) {\r\n\t\t\t\t\t// Create Data Set & setup Validation Context:\r\n\t\t\t\t\tblockManager.setup(this, variantId);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeVariantId',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tawait this.#blockWorkspace![this.#managerName!].structure.hasRootContainers('Group'),\r\n\t\t\t(hasRootGroups) => {\r\n\t\t\t\tthis._hasRootGroups = hasRootGroups;\r\n\t\t\t\tthis.#createRoutes();\r\n\t\t\t},\r\n\t\t\t'observeGroups',\r\n\t\t);\r\n\t}\r\n\r\n\t#createRoutes() {\r\n\t\tif (!this._tabs || !this.#blockWorkspace) return;\r\n\t\tconst routes: UmbRoute[] = [];\r\n\r\n\t\tif (this._tabs.length > 0) {\r\n\t\t\tthis._tabs?.forEach((tab) => {\r\n\t\t\t\tconst tabName = tab.name ?? '';\r\n\t\t\t\troutes.push({\r\n\t\t\t\t\tpath: `tab/${encodeFolderName(tabName)}`,\r\n\t\t\t\t\tcomponent: () => import('./block-workspace-view-edit-tab.element.js'),\r\n\t\t\t\t\tsetup: (component) => {\r\n\t\t\t\t\t\t(component as UmbBlockWorkspaceViewEditTabElement).managerName = this.#managerName;\r\n\t\t\t\t\t\t(component as UmbBlockWorkspaceViewEditTabElement).containerId = tab.ids[0];\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this._hasRootGroups) {\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: '',\r\n\t\t\t\tcomponent: () => import('./block-workspace-view-edit-tab.element.js'),\r\n\t\t\t\tsetup: (component) => {\r\n\t\t\t\t\t(component as UmbBlockWorkspaceViewEditTabElement).managerName = this.#managerName;\r\n\t\t\t\t\t(component as UmbBlockWorkspaceViewEditTabElement).containerId = null;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (routes.length !== 0) {\r\n\t\t\tif (!this._hasRootGroups) {\r\n\t\t\t\troutes.push({\r\n\t\t\t\t\tpath: '',\r\n\t\t\t\t\tpathMatch: 'full',\r\n\t\t\t\t\tredirectTo: routes[0]?.path,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: `**`,\r\n\t\t\t\tcomponent: async () => (await import('@umbraco-cms/backoffice/router')).UmbRouteNotFoundElement,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._routes = routes;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._routes || !this._tabs) return;\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t${this._routerPath && (this._tabs.length > 1 || (this._tabs.length === 1 && this._hasRootGroups))\r\n\t\t\t\t\t? html` <uui-tab-group slot=\"header\">\r\n\t\t\t\t\t\t\t${this._hasRootGroups && this._tabs.length > 0\r\n\t\t\t\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t\t\t\t<uui-tab\r\n\t\t\t\t\t\t\t\t\t\t\tlabel=\"Content\"\r\n\t\t\t\t\t\t\t\t\t\t\t.active=${this._routerPath + '/' === this._activePath}\r\n\t\t\t\t\t\t\t\t\t\t\thref=${this._routerPath + '/'}>\r\n\t\t\t\t\t\t\t\t\t\t\t<umb-localize key=\"general_content\">Content</umb-localize>\r\n\t\t\t\t\t\t\t\t\t\t</uui-tab>\r\n\t\t\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\t\tthis._tabs,\r\n\t\t\t\t\t\t\t\t(tab) => tab.name,\r\n\t\t\t\t\t\t\t\t(tab) => {\r\n\t\t\t\t\t\t\t\t\tconst path = this._routerPath + '/tab/' + encodeFolderName(tab.name || '');\r\n\t\t\t\t\t\t\t\t\treturn html`<uui-tab\r\n\t\t\t\t\t\t\t\t\t\tlabel=${this.localize.string(tab.name ?? '#general_unknown')}\r\n\t\t\t\t\t\t\t\t\t\t.active=${path === this._activePath}\r\n\t\t\t\t\t\t\t\t\t\thref=${path}>\r\n\t\t\t\t\t\t\t\t\t\t${this.localize.string(tab.name)}\r\n\t\t\t\t\t\t\t\t\t</uui-tab>`;\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</uui-tab-group>`\r\n\t\t\t\t\t: ''}\r\n\r\n\t\t\t\t<umb-router-slot\r\n\t\t\t\t\t.routes=${this._routes}\r\n\t\t\t\t\t@init=${(event: UmbRouterSlotInitEvent) => {\r\n\t\t\t\t\t\tthis._routerPath = event.target.absoluteRouterPath;\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t@change=${(event: UmbRouterSlotChangeEvent) => {\r\n\t\t\t\t\t\tthis._activePath = event.target.absoluteActiveViewPath || '';\r\n\t\t\t\t\t}}>\r\n\t\t\t\t</umb-router-slot>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\t--uui-tab-background: var(--uui-color-surface);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockWorkspaceViewEditElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-workspace-view-edit': UmbBlockWorkspaceViewEditElement;\r\n\t}\r\n}\r\n"],"names":["_managerName","_blockWorkspace","_tabsStructureHelper","_UmbBlockWorkspaceViewEditElement_instances","setStructureManager_fn","createRoutes_fn","UmbBlockWorkspaceViewEditElement","UmbLitElement","__privateAdd","UmbContentTypeContainerStructureHelper","__privateGet","tabs","__privateMethod","UMB_BLOCK_WORKSPACE_CONTEXT","workspaceContext","__privateSet","value","html","repeat","tab","path","encodeFolderName","event","blockManager","variantId","hasRootGroups","routes","tabName","component","UmbTextStyles","css","__decorateClass","property","state","customElement","UmbBlockWorkspaceViewEditElement$1"],"mappings":"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"}