{"version":3,"file":"property-editor-ui-block-grid.element-E2GsijpN.js","sources":["../../../src/packages/block/block-grid/block-grid-manager/block-grid-manager.context.ts","../../../src/packages/block/block-grid/components/block-grid-areas-container/block-grid-areas-container.element.ts","../../../src/packages/block/block-grid/components/block-grid-block-inline/block-grid-block-inline.element.ts","../../../src/packages/block/block-grid/components/block-grid-block-unsupported/block-grid-block-unsupported.element.ts","../../../src/packages/block/block-grid/components/block-grid-block/block-grid-block.element.ts","../../../src/packages/block/block-grid/components/block-grid-entries/block-grid-entries.context.ts","../../../src/packages/block/block-grid/components/block-grid-entries/block-grid-entries.element.ts","../../../src/packages/block/block-grid/components/block-grid-entry/block-grid-entry.context.ts","../../../src/packages/block/block-grid/components/block-grid-entry/block-grid-entry.element.ts","../../../src/packages/block/block-grid/components/ref-grid-block/ref-grid-block.element.ts","../../../src/packages/block/block-grid/property-editors/block-grid-editor/property-editor-ui-block-grid.element.ts"],"sourcesContent":["import type { UmbBlockGridLayoutModel, UmbBlockGridTypeModel } from '../types.js';\r\nimport type { UmbBlockGridWorkspaceOriginData } from '../index.js';\r\nimport { UMB_BLOCK_GRID_DEFAULT_LAYOUT_STYLESHEET } from '../context/constants.js';\r\nimport {\r\n\tappendToFrozenArray,\r\n\tpushAtToUniqueArray,\r\n\tUmbArrayState,\r\n\tUmbBooleanState,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport { transformServerPathToClientPath } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbBlockManagerContext } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockDataModel } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockTypeGroup } from '@umbraco-cms/backoffice/block-type';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbNumberRangeValueType } from '@umbraco-cms/backoffice/models';\r\nimport type { UmbPropertyEditorConfigCollection } from '@umbraco-cms/backoffice/property-editor';\r\nimport { UMB_SERVER_CONTEXT } from '@umbraco-cms/backoffice/server';\r\n\r\n/**\r\n * A implementation of the Block Manager specifically for the Block Grid Editor.\r\n */\r\nexport class UmbBlockGridManagerContext<\r\n\tBlockLayoutType extends UmbBlockGridLayoutModel = UmbBlockGridLayoutModel,\r\n> extends UmbBlockManagerContext<UmbBlockGridTypeModel, UmbBlockGridLayoutModel, UmbBlockGridWorkspaceOriginData> {\r\n\t//\r\n\t#inlineEditingMode = new UmbBooleanState(undefined);\r\n\treadonly inlineEditingMode = this.#inlineEditingMode.asObservable();\r\n\r\n\tsetInlineEditingMode(inlineEditingMode: boolean | undefined) {\r\n\t\tthis.#inlineEditingMode.setValue(inlineEditingMode ?? false);\r\n\t}\r\n\tgetInlineEditingMode(): boolean | undefined {\r\n\t\treturn this.#inlineEditingMode.getValue();\r\n\t}\r\n\r\n\t#initAppUrl: Promise<unknown>;\r\n\r\n\t#serverUrl?: string;\r\n\r\n\t#blockGroups = new UmbArrayState(<Array<UmbBlockTypeGroup>>[], (x) => x.key);\r\n\tpublic readonly blockGroups = this.#blockGroups.asObservable();\r\n\r\n\tlayoutStylesheet = this._editorConfiguration.asObservablePart((x) => {\r\n\t\tif (!x) return undefined;\r\n\t\tconst layoutStylesheet = x.getValueByAlias<string>('layoutStylesheet');\r\n\t\tif (!layoutStylesheet) return UMB_BLOCK_GRID_DEFAULT_LAYOUT_STYLESHEET;\r\n\r\n\t\tif (layoutStylesheet) {\r\n\t\t\t// Cause we await initAppUrl in setting the _editorConfiguration, we can trust the appUrl begin here.\r\n\t\t\tconst url = new URL(transformServerPathToClientPath(layoutStylesheet), this.#serverUrl);\r\n\t\t\treturn url.href;\r\n\t\t}\r\n\t\treturn undefined;\r\n\t});\r\n\tgridColumns = this._editorConfiguration.asObservablePart((x) => {\r\n\t\tconst value = x?.getValueByAlias('gridColumns') as string | undefined;\r\n\t\treturn parseInt(value && value !== '' ? value : '12');\r\n\t});\r\n\r\n\tgetMinAllowed() {\r\n\t\treturn this._editorConfiguration.getValue()?.getValueByAlias<UmbNumberRangeValueType>('validationLimit')?.min ?? 0;\r\n\t}\r\n\r\n\tgetMaxAllowed() {\r\n\t\treturn (\r\n\t\t\tthis._editorConfiguration.getValue()?.getValueByAlias<UmbNumberRangeValueType>('validationLimit')?.max ?? Infinity\r\n\t\t);\r\n\t}\r\n\r\n\toverride setEditorConfiguration(configs: UmbPropertyEditorConfigCollection) {\r\n\t\tthis.#initAppUrl.then(() => {\r\n\t\t\t// we await initAppUrl, So the appUrl begin here is available when retrieving the layoutStylesheet.\r\n\t\t\tsuper.setEditorConfiguration(configs);\r\n\t\t});\r\n\t}\r\n\r\n\tsetBlockGroups(blockGroups: Array<UmbBlockTypeGroup>) {\r\n\t\tthis.#blockGroups.setValue(blockGroups);\r\n\t}\r\n\tgetBlockGroups() {\r\n\t\treturn this.#blockGroups.value;\r\n\t}\r\n\tgetBlockGroupName(unique: string) {\r\n\t\treturn this.#blockGroups.getValue().find((group) => group.key === unique)?.name;\r\n\t}\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#initAppUrl = this.consumeContext(UMB_SERVER_CONTEXT, (instance) => {\r\n\t\t\tthis.#serverUrl = instance?.getServerUrl();\r\n\t\t}).asPromise({ preventTimeout: true });\r\n\t}\r\n\t/**\r\n\t * @param contentElementTypeKey\r\n\t * @param partialLayoutEntry\r\n\t * @param _originData\r\n\t * @deprecated Use createWithPresets instead. Will be removed in v.17.\r\n\t */\r\n\tcreate(\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tcontentElementTypeKey: string,\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tpartialLayoutEntry?: Omit<BlockLayoutType, 'contentKey'>,\r\n\t\t// This property is used by some implementations, but not used in this. Do not remove. [NL]\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t_originData?: UmbBlockGridWorkspaceOriginData,\r\n\t): never {\r\n\t\tthrow new Error('Method deparecated use createWithPresets');\r\n\t}\r\n\r\n\tasync createWithPresets(\r\n\t\tcontentElementTypeKey: string,\r\n\t\tpartialLayoutEntry?: Omit<BlockLayoutType, 'contentKey'>,\r\n\t\t// This property is used by some implementations, but not used in this.\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\toriginData?: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\treturn await super._createBlockData(contentElementTypeKey, partialLayoutEntry);\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a layout entry into an area of a layout entry.\r\n\t * @param layoutEntry The layout entry to insert.\r\n\t * @param insert\r\n\t * @param entries The layout entries to search within.\r\n\t * @param parentUnique The parentUnique to search for.\r\n\t * @param parentId\r\n\t * @param areaKey The areaKey to insert the layout entry into.\r\n\t * @param index The index to insert the layout entry at.\r\n\t * @returns a updated layout entries array if the insert was successful.\r\n\t * @remarks\r\n\t * This method is recursive and will search for the parentUnique in the layout entries.\r\n\t * If the parentUnique is found, the layout entry will be inserted into the items of the area that matches the areaKey.\r\n\t * This returns a new array of layout entries with the updated layout entry inserted.\r\n\t * Because the layout entries are frozen, the affected parts is replaced with a new. Only updating/unfreezing the affected part of the structure.\r\n\t */\r\n\t#appendLayoutEntryToArea(\r\n\t\tinsert: UmbBlockGridLayoutModel,\r\n\t\tentries: Array<UmbBlockGridLayoutModel>,\r\n\t\tparentId: string,\r\n\t\tareaKey: string,\r\n\t\tindex: number,\r\n\t): Array<UmbBlockGridLayoutModel> | undefined {\r\n\t\t// I'm sorry, this code is not easy to read or maintain [NL]\r\n\t\tlet i: number = entries.length;\r\n\t\twhile (i--) {\r\n\t\t\tconst currentEntry = entries[i];\r\n\t\t\t// Lets check if we found the right parent layout entry:\r\n\t\t\tif (currentEntry.contentKey === parentId) {\r\n\t\t\t\t// Append the layout entry to be inserted and unfreeze the rest of the data:\r\n\t\t\t\tconst areas =\r\n\t\t\t\t\tcurrentEntry.areas?.map((x) =>\r\n\t\t\t\t\t\tx.key === areaKey\r\n\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\t...x,\r\n\t\t\t\t\t\t\t\t\titems: pushAtToUniqueArray([...x.items], insert, (x) => x.contentKey === insert.contentKey, index),\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: x,\r\n\t\t\t\t\t) ?? [];\r\n\t\t\t\treturn appendToFrozenArray(\r\n\t\t\t\t\tentries,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t...currentEntry,\r\n\t\t\t\t\t\tareas,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t(x) => x.contentKey === currentEntry.contentKey,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t// Otherwise check if any items of the areas are the parent layout entry we are looking for. We do so based on parentId, recursively:\r\n\t\t\tif (currentEntry.areas) {\r\n\t\t\t\tlet y: number = currentEntry.areas.length;\r\n\t\t\t\twhile (y--) {\r\n\t\t\t\t\t// Recursively ask the items of this area to insert the layout entry, if something returns there was a match in this branch. [NL]\r\n\t\t\t\t\tconst correctedAreaItems = this.#appendLayoutEntryToArea(\r\n\t\t\t\t\t\tinsert,\r\n\t\t\t\t\t\tcurrentEntry.areas[y].items,\r\n\t\t\t\t\t\tparentId,\r\n\t\t\t\t\t\tareaKey,\r\n\t\t\t\t\t\tindex,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (correctedAreaItems) {\r\n\t\t\t\t\t\t// This area got a corrected set of items, lets append those to the area and unfreeze the surrounding data:\r\n\t\t\t\t\t\tconst area = currentEntry.areas[y];\r\n\t\t\t\t\t\treturn appendToFrozenArray(\r\n\t\t\t\t\t\t\tentries,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t...currentEntry,\r\n\t\t\t\t\t\t\t\tareas: appendToFrozenArray(\r\n\t\t\t\t\t\t\t\t\tcurrentEntry.areas,\r\n\t\t\t\t\t\t\t\t\t{ ...area, items: correctedAreaItems },\r\n\t\t\t\t\t\t\t\t\t(z) => z.key === area.key,\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t(x) => x.contentKey === currentEntry.contentKey,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tinsert(\r\n\t\tlayoutEntry: BlockLayoutType,\r\n\t\tcontent: UmbBlockDataModel,\r\n\t\tsettings: UmbBlockDataModel | undefined,\r\n\t\toriginData: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tthis.setOneLayout(layoutEntry, originData);\r\n\t\tthis.insertBlockData(layoutEntry, content, settings, originData);\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\toverride setOneLayout(layoutEntry: BlockLayoutType, originData?: UmbBlockGridWorkspaceOriginData) {\r\n\t\tconst index = originData?.index ?? -1;\r\n\r\n\t\tif (originData?.parentUnique && originData?.areaKey) {\r\n\t\t\t// Find layout entry based on parentUnique, recursively, as it needs to check layout of areas as well:\r\n\t\t\tconst layoutEntries = this.#appendLayoutEntryToArea(\r\n\t\t\t\tlayoutEntry,\r\n\t\t\t\tthis._layouts.getValue(),\r\n\t\t\t\toriginData?.parentUnique,\r\n\t\t\t\toriginData?.areaKey,\r\n\t\t\t\tindex,\r\n\t\t\t);\r\n\r\n\t\t\t// If this appending was successful, we got a new set of layout entries which we can set as the new value: [NL]\r\n\t\t\tif (layoutEntries) {\r\n\t\t\t\tthis._layouts.setValue(layoutEntries);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._layouts.appendOneAt(layoutEntry, index);\r\n\t\t}\r\n\t}\r\n\r\n\tonDragStart() {\r\n\t\t(this.getHostElement() as HTMLElement).style.setProperty('--umb-block-grid--is-dragging', ' ');\r\n\t}\r\n\r\n\tonDragEnd() {\r\n\t\t(this.getHostElement() as HTMLElement).style.removeProperty('--umb-block-grid--is-dragging');\r\n\t}\r\n}\r\n","import type { UmbBlockGridTypeAreaType } from '../../types.js';\r\nimport { UMB_BLOCK_GRID_ENTRY_CONTEXT } from '../block-grid-entry/constants.js';\r\nimport { UMB_BLOCK_GRID_MANAGER_CONTEXT } from '../../block-grid-manager/constants.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * @description\r\n * This element is used to render the block grid areas.\r\n */\r\n@customElement('umb-block-grid-areas-container')\r\nexport class UmbBlockGridAreasContainerElement extends UmbLitElement {\r\n\t//\r\n\t@state()\r\n\tprivate _styleElement?: HTMLLinkElement;\r\n\r\n\t@state()\r\n\tprivate _areas?: Array<UmbBlockGridTypeAreaType> = [];\r\n\r\n\t@state()\r\n\tprivate _areaGridColumns?: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.areas,\r\n\t\t\t\t(areas) => {\r\n\t\t\t\t\tthis._areas = areas;\r\n\t\t\t\t},\r\n\t\t\t\t'observeAreas',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.areaGridColumns,\r\n\t\t\t\t(areaGridColumns) => {\r\n\t\t\t\t\tthis._areaGridColumns = areaGridColumns;\r\n\t\t\t\t\t//this.requestUpdate('_areaGridColumns');\r\n\t\t\t\t},\r\n\t\t\t\t'observeAreaGridColumns',\r\n\t\t\t);\r\n\t\t});\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_MANAGER_CONTEXT, (manager) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager?.layoutStylesheet,\r\n\t\t\t\t(stylesheet) => {\r\n\t\t\t\t\t// Do not re-render stylesheet if its the same href.\r\n\t\t\t\t\tif (!stylesheet || this._styleElement?.href === stylesheet) return;\r\n\t\t\t\t\tthis._styleElement = document.createElement('link');\r\n\t\t\t\t\tthis._styleElement.rel = 'stylesheet';\r\n\t\t\t\t\tthis._styleElement.href = stylesheet;\r\n\t\t\t\t},\r\n\t\t\t\t'observeStylesheet',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._areas && this._areas.length > 0\r\n\t\t\t? html` ${this._styleElement}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"umb-block-grid__area-container\"\r\n\t\t\t\t\t\tpart=\"area-container\"\r\n\t\t\t\t\t\tstyle=\"--umb-block-grid--area-grid-columns: ${this._areaGridColumns}\">\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis._areas,\r\n\t\t\t\t\t\t\t(area) => area.key,\r\n\t\t\t\t\t\t\t(area) =>\r\n\t\t\t\t\t\t\t\thtml`<umb-block-grid-entries\r\n\t\t\t\t\t\t\t\t\tpart=\"area\"\r\n\t\t\t\t\t\t\t\t\tclass=\"umb-block-grid__area\"\r\n\t\t\t\t\t\t\t\t\t.areaKey=${area.key}\r\n\t\t\t\t\t\t\t\t\t.layoutColumns=${area.columnSpan}></umb-block-grid-entries>`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>`\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridAreasContainerElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-areas-container': UmbBlockGridAreasContainerElement;\r\n\t}\r\n}\r\n","import { UMB_BLOCK_GRID_ENTRY_CONTEXT } from '../block-grid-entry/constants.js';\r\nimport type { UmbBlockGridWorkspaceOriginData } from '../../workspace/block-grid-workspace.modal-token.js';\r\nimport { UMB_BLOCK_GRID_ENTRIES_CONTEXT } from '../block-grid-entries/constants.js';\r\nimport { css, customElement, html, property, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbDataPathPropertyValueQuery } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbExtensionApiInitializer, UmbExtensionsApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbLanguageItemRepository } from '@umbraco-cms/backoffice/language';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_BLOCK_WORKSPACE_ALIAS } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbApiConstructorArgumentsMethodType } from '@umbraco-cms/backoffice/extension-api';\r\nimport type { UmbBlockEditorCustomViewConfiguration } from '@umbraco-cms/backoffice/block-custom-view';\r\nimport type { UmbPropertyTypeModel } from '@umbraco-cms/backoffice/content-type';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UMB_BLOCK_WORKSPACE_CONTEXT, UmbBlockDataType } from '@umbraco-cms/backoffice/block';\r\n\r\nconst apiArgsCreator: UmbApiConstructorArgumentsMethodType<unknown> = (manifest: unknown) => {\r\n\treturn [{ manifest }];\r\n};\r\n\r\n@customElement('umb-block-grid-block-inline')\r\nexport class UmbBlockGridBlockInlineElement extends UmbLitElement {\r\n\t//\r\n\t#blockContext?: typeof UMB_BLOCK_GRID_ENTRY_CONTEXT.TYPE;\r\n\t#workspaceContext?: typeof UMB_BLOCK_WORKSPACE_CONTEXT.TYPE;\r\n\t#variantId: UmbVariantId | undefined;\r\n\t#contentKey?: string;\r\n\t#parentUnique?: string | null;\r\n\t#areaKey?: string | null;\r\n\r\n\t@property({ attribute: false })\r\n\tconfig?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\tlabel?: string;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\ticon?: string;\r\n\r\n\t@property({ type: Number, attribute: false })\r\n\tindex?: number;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\tunpublished?: boolean;\r\n\r\n\t@property({ attribute: false })\r\n\tcontent?: UmbBlockDataType;\r\n\r\n\t@property({ attribute: false })\r\n\tsettings?: UmbBlockDataType;\r\n\r\n\t@state()\r\n\tprivate _inlineProperty?: UmbPropertyTypeModel;\r\n\r\n\t@state()\r\n\tprivate _inlinePropertyDataPath?: string;\r\n\r\n\t@state()\r\n\tprivate _ownerContentTypeName?: string;\r\n\r\n\t@state()\r\n\tprivate _variantName?: string;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (blockContext) => {\r\n\t\t\tthis.#blockContext = blockContext;\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#blockContext?.unique,\r\n\t\t\t\t(contentKey) => {\r\n\t\t\t\t\tthis.#contentKey = contentKey;\r\n\t\t\t\t\tthis.#load();\r\n\t\t\t\t},\r\n\t\t\t\t'observeContentKey',\r\n\t\t\t);\r\n\t\t});\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRIES_CONTEXT, (entriesContext) => {\r\n\t\t\tthis.#parentUnique = entriesContext?.getParentUnique();\r\n\t\t\tthis.#areaKey = entriesContext?.getAreaKey();\r\n\t\t});\r\n\t\tnew UmbExtensionApiInitializer(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\tUMB_BLOCK_WORKSPACE_ALIAS,\r\n\t\t\tapiArgsCreator,\r\n\t\t\t(permitted, ctrl) => {\r\n\t\t\t\tconst context = ctrl.api as typeof UMB_BLOCK_WORKSPACE_CONTEXT.TYPE | undefined;\r\n\t\t\t\tif (permitted && context) {\r\n\t\t\t\t\t// Risky business, cause here we are lucky that it seems to be consumed and set before this is called and there for this is acceptable for now. [NL]\r\n\t\t\t\t\tif (this.#parentUnique === undefined || this.#areaKey === undefined) {\r\n\t\t\t\t\t\tthrow new Error('Parent unique and area key must be defined');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.#workspaceContext = context;\r\n\t\t\t\t\tcontext.setOriginData({\r\n\t\t\t\t\t\tareaKey: this.#areaKey,\r\n\t\t\t\t\t\tparentUnique: this.#parentUnique,\r\n\t\t\t\t\t} as UmbBlockGridWorkspaceOriginData);\r\n\t\t\t\t\tthis.#workspaceContext.establishLiveSync();\r\n\r\n\t\t\t\t\tthis.#load();\r\n\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tthis.#workspaceContext.content.structure.contentTypeProperties,\r\n\t\t\t\t\t\t(contentTypeProperties) => {\r\n\t\t\t\t\t\t\tthis._inlineProperty = contentTypeProperties[0];\r\n\t\t\t\t\t\t\tthis.#generatePropertyDataPath();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeProperties',\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tcontext.content.structure.ownerContentTypeName,\r\n\t\t\t\t\t\t(name) => {\r\n\t\t\t\t\t\t\tthis._ownerContentTypeName = name;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeContentTypeName',\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tcontext.variantId,\r\n\t\t\t\t\t\tasync (variantId) => {\r\n\t\t\t\t\t\t\tthis.#variantId = variantId;\r\n\t\t\t\t\t\t\tthis.#generatePropertyDataPath();\r\n\t\t\t\t\t\t\tif (variantId) {\r\n\t\t\t\t\t\t\t\tcontext.content.setup(this, variantId);\r\n\t\t\t\t\t\t\t\tconst culture = variantId.culture;\r\n\t\t\t\t\t\t\t\tif (culture) {\r\n\t\t\t\t\t\t\t\t\tconst languageRepository = new UmbLanguageItemRepository(this);\r\n\t\t\t\t\t\t\t\t\tconst { data } = await languageRepository.requestItems([culture]);\r\n\t\t\t\t\t\t\t\t\tconst name = data?.[0].name;\r\n\t\t\t\t\t\t\t\t\tthis._variantName = name ? this.localize.string(name) : undefined;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeVariant',\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tnew UmbExtensionsApiInitializer(this, umbExtensionsRegistry, 'workspaceContext', [this.#workspaceContext]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\t#load() {\r\n\t\tif (!this.#workspaceContext || !this.#contentKey) return;\r\n\t\tthis.#workspaceContext.load(this.#contentKey);\r\n\t}\r\n\r\n\t#generatePropertyDataPath() {\r\n\t\tif (!this.#variantId || !this._inlineProperty) return;\r\n\t\tconst property = this._inlineProperty;\r\n\t\tthis._inlinePropertyDataPath = `$.values[${UmbDataPathPropertyValueQuery({\r\n\t\t\talias: property.alias,\r\n\t\t\tculture: property.variesByCulture ? this.#variantId!.culture : null,\r\n\t\t\tsegment: property.variesBySegment ? this.#variantId!.segment : null,\r\n\t\t})}].value`;\r\n\t}\r\n\r\n\t#expose = () => {\r\n\t\tthis.#workspaceContext?.expose();\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"host\">\r\n\t\t\t\t<button id=\"open-part\" tabindex=\"0\">\r\n\t\t\t\t\t${this.#renderBlockInfo()}\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t\t<slot name=\"tag\"></slot>\r\n\t\t\t\t</button>\r\n\t\t\t\t${this.#renderInside()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlockInfo() {\r\n\t\tconst blockValue = { ...this.content, $settings: this.settings, $index: this.index };\r\n\t\treturn html`\r\n\t\t\t<span id=\"content\">\r\n\t\t\t\t<span id=\"icon\">\r\n\t\t\t\t\t<umb-icon .name=${this.icon}></umb-icon>\r\n\t\t\t\t</span>\r\n\t\t\t\t<div id=\"info\">\r\n\t\t\t\t\t<umb-ufm-render id=\"name\" inline .markdown=${this.label} .value=${blockValue}></umb-ufm-render>\r\n\t\t\t\t</div>\r\n\t\t\t</span>\r\n\t\t\t${when(\r\n\t\t\t\tthis.unpublished,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-tag slot=\"name\" look=\"secondary\" title=${this.localize.term('blockEditor_notExposedDescription')}\r\n\t\t\t\t\t\t><umb-localize key=\"blockEditor_notExposedLabel\"></umb-localize\r\n\t\t\t\t\t></uui-tag>`,\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInside() {\r\n\t\tif (this.unpublished === true) {\r\n\t\t\treturn html`<uui-button id=\"exposeButton\" @click=${this.#expose}\r\n\t\t\t\t><uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\t<umb-localize\r\n\t\t\t\t\tkey=\"blockEditor_createThisFor\"\r\n\t\t\t\t\t.args=${[this._ownerContentTypeName, this._variantName]}></umb-localize\r\n\t\t\t></uui-button>`;\r\n\t\t} else {\r\n\t\t\treturn html`<div id=\"inside\" draggable=\"false\">\r\n\t\t\t\t<umb-property-type-based-property\r\n\t\t\t\t\t.property=${this._inlineProperty}\r\n\t\t\t\t\t.dataPath=${this._inlinePropertyDataPath ?? ''}\r\n\t\t\t\t\tslot=\"areas\"></umb-property-type-based-property>\r\n\t\t\t\t<umb-block-grid-areas-container slot=\"areas\" draggable=\"false\"></umb-block-grid-areas-container>\r\n\t\t\t</div>`;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tumb-block-grid-areas-container {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\t\t\tumb-block-grid-areas-container::part(area) {\r\n\t\t\t\tmargin: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\t#exposeButton {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t}\r\n\r\n\t\t\t#host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\ttransition: border-color 80ms;\r\n\r\n\t\t\t\tmin-width: 250px;\r\n\t\t\t}\r\n\t\t\t#open-part + * {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\t\t\t:host([disabled]) #open-part {\r\n\t\t\t\tcursor: default;\r\n\t\t\t\ttransition: border-color 80ms;\r\n\t\t\t}\r\n\t\t\t:host(:not([disabled])) #host:has(#open-part:hover) {\r\n\t\t\t\tborder-color: var(--uui-color-border-emphasis);\r\n\t\t\t}\r\n\t\t\t:host(:not([disabled])) #open-part:hover + * {\r\n\t\t\t\tborder-color: var(--uui-color-border-emphasis);\r\n\t\t\t}\r\n\t\t\t:host([disabled]) #host {\r\n\t\t\t\tborder-color: var(--uui-color-disabled-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) #open-part #content {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\r\n\t\t\tslot[name='tag'] {\r\n\t\t\t\tflex-grow: 1;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\tbutton {\r\n\t\t\t\tfont-size: inherit;\r\n\t\t\t\tfont-family: inherit;\r\n\t\t\t\tborder: 0;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tbackground-color: transparent;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\talign-self: stretch;\r\n\t\t\t\tline-height: normal;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#open-part {\r\n\t\t\t\tcolor: inherit;\r\n\t\t\t\ttext-decoration: none;\r\n\t\t\t\tcursor: pointer;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: flex-start;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tbackground: none;\r\n\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tpadding: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\tfont-size: 1.2em;\r\n\t\t\t\tmargin-left: var(--uui-size-2);\r\n\t\t\t\tmargin-right: var(--uui-size-1);\r\n\t\t\t}\r\n\r\n\t\t\t#info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: start;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-2, 6px);\r\n\t\t\t}\r\n\r\n\t\t\t#name {\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tag {\r\n\t\t\t\tmargin-left: 0.5em;\r\n\t\t\t\tmargin-bottom: -0.3em;\r\n\t\t\t\tmargin-top: -0.3em;\r\n\t\t\t\tvertical-align: text-top;\r\n\t\t\t}\r\n\r\n\t\t\t:host(:not([disabled])) #open-part:hover #icon {\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\t\t\t:host(:not([disabled])) #open-part:hover #name {\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t:host([disabled]) #icon {\r\n\t\t\t\tcolor: var(--uui-color-disabled-contrast);\r\n\t\t\t}\r\n\t\t\t:host([disabled]) #name {\r\n\t\t\t\tcolor: var(--uui-color-disabled-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t#inside {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: calc(var(--uui-size-layout-1));\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridBlockInlineElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-block-inline': UmbBlockGridBlockInlineElement;\r\n\t}\r\n}\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n@customElement('umb-block-grid-block-unsupported')\r\nexport class UmbBlockGridBlockUnsupportedElement extends UmbLitElement {\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"host\">\r\n\t\t\t\t<div id=\"open-part\">\r\n\t\t\t\t\t${this.#renderBlockInfo()}\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t\t<slot name=\"tag\"></slot>\r\n\t\t\t\t</div>\r\n\t\t\t\t${this.#renderInside()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlockInfo() {\r\n\t\treturn html`\r\n\t\t\t<span id=\"content\">\r\n\t\t\t\t<span id=\"icon\">\r\n\t\t\t\t\t<umb-icon name=\"icon-alert\"></umb-icon>\r\n\t\t\t\t</span>\r\n\t\t\t\t<div id=\"info\">\r\n\t\t\t\t\t<span id=\"name\">${this.localize.term('blockEditor_unsupportedBlockName')}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</span>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInside() {\r\n\t\treturn html`<div id=\"inside\" draggable=\"false\">\r\n\t\t\t${this.localize.term('blockEditor_unsupportedBlockDescription')}\r\n\t\t\t<umb-block-grid-areas-container slot=\"areas\"></umb-block-grid-areas-container>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tumb-block-grid-areas-container {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\t\t\tumb-block-grid-areas-container::part(area) {\r\n\t\t\t\tmargin: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\t#exposeButton {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t}\r\n\r\n\t\t\t#host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\ttransition: border-color 80ms;\r\n\r\n\t\t\t\tmin-width: 250px;\r\n\t\t\t}\r\n\t\t\t#open-part + * {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\t\t\t#open-part {\r\n\t\t\t\tcursor: default;\r\n\t\t\t\ttransition: border-color 80ms;\r\n\t\t\t}\r\n\t\t\t#host {\r\n\t\t\t\tborder-color: var(--uui-color-disabled-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) #open-part #content {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\r\n\t\t\tslot[name='tag'] {\r\n\t\t\t\tflex-grow: 1;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\talign-self: stretch;\r\n\t\t\t\tline-height: normal;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#open-part {\r\n\t\t\t\tcolor: inherit;\r\n\t\t\t\ttext-decoration: none;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: flex-start;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tbackground: none;\r\n\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tpadding: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\tfont-size: 1.2em;\r\n\t\t\t\tmargin-left: var(--uui-size-2);\r\n\t\t\t\tmargin-right: var(--uui-size-1);\r\n\t\t\t}\r\n\r\n\t\t\t#info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: start;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-2, 6px);\r\n\t\t\t}\r\n\r\n\t\t\t#name {\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tag {\r\n\t\t\t\tmargin-left: 0.5em;\r\n\t\t\t\tmargin-bottom: -0.3em;\r\n\t\t\t\tmargin-top: -0.3em;\r\n\t\t\t\tvertical-align: text-top;\r\n\t\t\t}\r\n\r\n\t\t\t#inside {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: calc(var(--uui-size-layout-1));\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridBlockUnsupportedElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-block-unsupported': UmbBlockGridBlockUnsupportedElement;\r\n\t}\r\n}\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html, property, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbBlockDataType } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockEditorCustomViewConfiguration } from '@umbraco-cms/backoffice/block-custom-view';\r\n\r\nimport '@umbraco-cms/backoffice/ufm';\r\n\r\n@customElement('umb-block-grid-block')\r\nexport class UmbBlockGridBlockElement extends UmbLitElement {\r\n\t//\r\n\t@property({ attribute: false })\r\n\tlabel?: string;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\ticon?: string;\r\n\r\n\t@property({ type: Number, attribute: false })\r\n\tindex?: number;\r\n\r\n\t@property({ attribute: false })\r\n\tconfig?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\tunpublished?: boolean;\r\n\r\n\t@property({ attribute: false })\r\n\tcontent?: UmbBlockDataType;\r\n\r\n\t@property({ attribute: false })\r\n\tsettings?: UmbBlockDataType;\r\n\r\n\toverride render() {\r\n\t\tconst blockValue = { ...this.content, $settings: this.settings, $index: this.index };\r\n\t\treturn html`\r\n\t\t\t<umb-ref-grid-block\r\n\t\t\t\tstandalone\r\n\t\t\t\thref=${(this.config?.showContentEdit ? this.config?.editContentPath : undefined) ?? ''}>\r\n\t\t\t\t<umb-icon slot=\"icon\" .name=${this.icon}></umb-icon>\r\n\t\t\t\t<umb-ufm-render slot=\"name\" inline .markdown=${this.label} .value=${blockValue}></umb-ufm-render>\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis.unpublished,\r\n\t\t\t\t\t() =>\r\n\t\t\t\t\t\thtml`<uui-tag slot=\"name\" look=\"secondary\" title=${this.localize.term('blockEditor_notExposedDescription')}\r\n\t\t\t\t\t\t\t><umb-localize key=\"blockEditor_notExposedLabel\"></umb-localize\r\n\t\t\t\t\t\t></uui-tag>`,\r\n\t\t\t\t)}\r\n\t\t\t\t<umb-block-grid-areas-container slot=\"areas\" draggable=\"false\"></umb-block-grid-areas-container>\r\n\t\t\t</umb-ref-grid-block>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tumb-block-grid-areas-container {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\t\t\tumb-block-grid-areas-container::part(area) {\r\n\t\t\t\tmargin: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\tuui-tag {\r\n\t\t\t\tmargin-left: 0.5em;\r\n\t\t\t\tmargin-bottom: -0.3em;\r\n\t\t\t\tmargin-top: -0.3em;\r\n\t\t\t\tvertical-align: text-top;\r\n\t\t\t}\r\n\t\t\t:host([unpublished]) umb-icon,\r\n\t\t\t:host([unpublished]) umb-ufm-render {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridBlockElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-block': UmbBlockGridBlockElement;\r\n\t}\r\n}\r\n","import type {\r\n\tUmbBlockGridLayoutModel,\r\n\tUmbBlockGridTypeAreaType,\r\n\tUmbBlockGridTypeModel,\r\n\tUmbBlockGridValueModel,\r\n} from '../../types.js';\r\nimport { forEachBlockLayoutEntryOf } from '../../utils/index.js';\r\nimport type { UmbBlockGridPropertyEditorConfig } from '../../property-editors/block-grid-editor/types.js';\r\nimport { UMB_BLOCK_GRID_MANAGER_CONTEXT } from '../../block-grid-manager/constants.js';\r\nimport { UMB_BLOCK_GRID_WORKSPACE_MODAL, type UmbBlockGridWorkspaceOriginData } from '../../workspace/index.js';\r\nimport type { UmbBlockGridScalableContainerContext } from '../../context/block-grid-scale-manager/block-grid-scale-manager.controller.js';\r\nimport { UMB_BLOCK_GRID_ENTRY_CONTEXT } from '../block-grid-entry/constants.js';\r\nimport {\r\n\tUMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS,\r\n\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n} from '../../property-editors/block-grid-editor/constants.js';\r\nimport {\r\n\tUmbArrayState,\r\n\tUmbBooleanState,\r\n\tUmbNumberState,\r\n\tUmbObjectState,\r\n\tUmbStringState,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbModalRouteRegistrationController, UmbRoutePathAddendumContext } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbNumberRangeValueType } from '@umbraco-cms/backoffice/models';\r\nimport {\r\n\tUMB_CLIPBOARD_PROPERTY_CONTEXT,\r\n\tUmbClipboardPastePropertyValueTranslatorValueResolver,\r\n} from '@umbraco-cms/backoffice/clipboard';\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport {\r\n\tUMB_BLOCK_CATALOGUE_MODAL,\r\n\tUmbBlockEntriesContext,\r\n\ttype UmbBlockDataModel,\r\n} from '@umbraco-cms/backoffice/block';\r\n\r\ninterface UmbBlockGridAreaTypeInvalidRuleType {\r\n\tgroupKey?: string;\r\n\tkey?: string;\r\n\tname: string;\r\n\tamount: number;\r\n\tminRequirement: number;\r\n\tmaxRequirement: number;\r\n}\r\n\r\nexport class UmbBlockGridEntriesContext\r\n\textends UmbBlockEntriesContext<\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT,\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT.TYPE,\r\n\t\tUmbBlockGridTypeModel,\r\n\t\tUmbBlockGridLayoutModel,\r\n\t\tUmbBlockGridWorkspaceOriginData\r\n\t>\r\n\timplements UmbBlockGridScalableContainerContext\r\n{\r\n\t//\r\n\t#pathAddendum = new UmbRoutePathAddendumContext(this);\r\n\r\n\t#parentEntry?: typeof UMB_BLOCK_GRID_ENTRY_CONTEXT.TYPE;\r\n\r\n\t#layoutColumns = new UmbNumberState(undefined);\r\n\treadonly layoutColumns = this.#layoutColumns.asObservable();\r\n\r\n\t#areaType = new UmbObjectState<UmbBlockGridTypeAreaType | undefined>(undefined);\r\n\tareaType = this.#areaType.asObservable();\r\n\tareaTypeCreateLabel = this.#areaType.asObservablePart((x) => x?.createLabel);\r\n\r\n\t#parentUnique?: string | null;\r\n\t#areaKey?: string | null;\r\n\r\n\t#rangeLimits = new UmbObjectState<UmbNumberRangeValueType | undefined>(undefined);\r\n\treadonly rangeLimits = this.#rangeLimits.asObservable();\r\n\r\n\t#allowedBlockTypes = new UmbArrayState<UmbBlockGridTypeModel>([], (x) => x.contentElementTypeKey);\r\n\tpublic readonly allowedBlockTypes = this.#allowedBlockTypes.asObservable();\r\n\tpublic readonly amountOfAllowedBlockTypes = this.#allowedBlockTypes.asObservablePart((x) => x.length);\r\n\tpublic readonly canCreate = this.#allowedBlockTypes.asObservablePart((x) => x.length > 0);\r\n\r\n\t#hasTypeLimits = new UmbBooleanState(undefined);\r\n\tpublic readonly hasTypeLimits = this.#hasTypeLimits.asObservable();\r\n\r\n\tfirstAllowedBlockTypeName() {\r\n\t\tif (!this._manager) {\r\n\t\t\tthrow new Error('Manager not ready');\r\n\t\t}\r\n\r\n\t\tconst nameState = new UmbStringState(undefined);\r\n\t\tthis.observe(this.allowedBlockTypes, (x) => {\r\n\t\t\tif (x.length === 1) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tthis._manager!.contentTypeNameOf(x[0].contentElementTypeKey),\r\n\t\t\t\t\t(name) => {\r\n\t\t\t\t\t\tnameState.setValue(name);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'getFirstAllowedBlockTypeName',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.removeUmbControllerByAlias('getFirstAllowedBlockTypeName');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn nameState.asObservable();\r\n\t}\r\n\r\n\tsetParentUnique(contentKey: string | null) {\r\n\t\tthis.#parentUnique = contentKey;\r\n\t}\r\n\r\n\tgetParentUnique(): string | null | undefined {\r\n\t\treturn this.#parentUnique;\r\n\t}\r\n\r\n\tsetAreaKey(areaKey: string | null) {\r\n\t\tthis.#areaKey = areaKey;\r\n\t\tthis.#pathAddendum.setAddendum(areaKey ?? '');\r\n\t\tthis.#gotAreaKey();\r\n\r\n\t\t// Idea: If we need to parse down a validation data path to target the specific layout object: [NL]\r\n\t\t// If we have a areaKey, we want to inherit our layoutDataPath from nearest blockGridEntry context.\r\n\t\t// If not, we want to set the layoutDataPath to a base one.\r\n\t}\r\n\r\n\tgetAreaKey(): string | null | undefined {\r\n\t\treturn this.#areaKey;\r\n\t}\r\n\r\n\tsetLayoutColumns(columns: number | undefined) {\r\n\t\tthis.#layoutColumns.setValue(columns);\r\n\t}\r\n\tgetLayoutColumns() {\r\n\t\treturn this.#layoutColumns.getValue();\r\n\t}\r\n\r\n\tgetMinAllowed() {\r\n\t\tif (this.#areaKey) {\r\n\t\t\treturn this.#areaType.getValue()?.minAllowed ?? 0;\r\n\t\t}\r\n\t\treturn this._manager?.getMinAllowed() ?? 0;\r\n\t}\r\n\r\n\tgetMaxAllowed() {\r\n\t\tif (this.#areaKey) {\r\n\t\t\treturn this.#areaType.getValue()?.maxAllowed ?? Infinity;\r\n\t\t}\r\n\t\treturn this._manager?.getMaxAllowed() ?? Infinity;\r\n\t}\r\n\r\n\tgetLayoutContainerElement() {\r\n\t\treturn this.getHostElement().shadowRoot?.querySelector('.umb-block-grid__layout-container') as\r\n\t\t\t| HTMLElement\r\n\t\t\t| undefined;\r\n\t}\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_BLOCK_GRID_MANAGER_CONTEXT);\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (blockGridEntry) => {\r\n\t\t\tthis.#parentEntry = blockGridEntry;\r\n\t\t\tthis.#gotBlockParentEntry(); // is not used at this point. [NL]\r\n\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_BLOCK_CATALOGUE_MODAL)\r\n\t\t\t.addAdditionalPath('_catalogue/:view/:index')\r\n\t\t\t.onSetup(async (routingInfo) => {\r\n\t\t\t\tif (!this._manager) return false;\r\n\t\t\t\t// Idea: Maybe on setup should be async, so it can retrieve the values when needed? [NL]\r\n\t\t\t\tconst index = routingInfo.index ? parseInt(routingInfo.index) : -1;\r\n\t\t\t\tconst clipboardContext = await this.getContext(UMB_CLIPBOARD_PROPERTY_CONTEXT);\r\n\t\t\t\tif (!clipboardContext) {\r\n\t\t\t\t\tthrow new Error('Clipboard context not available');\r\n\t\t\t\t}\r\n\t\t\t\tconst pasteTranslatorManifests = clipboardContext.getPasteTranslatorManifests(\r\n\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// TODO: consider moving some of this logic to the clipboard property context\r\n\t\t\t\tconst propertyContext = await this.getContext(UMB_PROPERTY_CONTEXT);\r\n\t\t\t\tif (!propertyContext) {\r\n\t\t\t\t\tthrow new Error('Property context not available');\r\n\t\t\t\t}\r\n\t\t\t\tconst config = propertyContext.getConfig() as UmbBlockGridPropertyEditorConfig;\r\n\t\t\t\tconst valueResolver = new UmbClipboardPastePropertyValueTranslatorValueResolver(this);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tblocks: this.#allowedBlockTypes.getValue(),\r\n\t\t\t\t\t\tblockGroups: this._manager.getBlockGroups() ?? [],\r\n\t\t\t\t\t\topenClipboard: routingInfo.view === 'clipboard',\r\n\t\t\t\t\t\tclipboardFilter: async (clipboardEntryDetail) => {\r\n\t\t\t\t\t\t\tconst hasSupportedPasteTranslator = clipboardContext.hasSupportedPasteTranslator(\r\n\t\t\t\t\t\t\t\tpasteTranslatorManifests,\r\n\t\t\t\t\t\t\t\tclipboardEntryDetail.values,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (!hasSupportedPasteTranslator) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst pasteTranslator = await valueResolver.getPasteTranslator(\r\n\t\t\t\t\t\t\t\tclipboardEntryDetail.values,\r\n\t\t\t\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (pasteTranslator.isCompatibleValue) {\r\n\t\t\t\t\t\t\t\tconst value = await valueResolver.resolve(\r\n\t\t\t\t\t\t\t\t\tclipboardEntryDetail.values,\r\n\t\t\t\t\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\treturn pasteTranslator.isCompatibleValue(value, config, (value) => this.#clipboardEntriesFilter(value));\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\toriginData: {\r\n\t\t\t\t\t\t\tindex: index,\r\n\t\t\t\t\t\t\tareaKey: this.#areaKey,\r\n\t\t\t\t\t\t\tparentUnique: this.#parentUnique,\r\n\t\t\t\t\t\t} as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t\tcreateBlockInWorkspace: this._manager.getInlineEditingMode() === false,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.onSubmit(async (value, data) => {\r\n\t\t\t\tif (value?.create && data) {\r\n\t\t\t\t\tconst created = await this.create(\r\n\t\t\t\t\t\tvalue.create.contentElementTypeKey,\r\n\t\t\t\t\t\t// We can parse an empty object, cause the rest will be filled in by others.\r\n\t\t\t\t\t\t{} as any,\r\n\t\t\t\t\t\tdata.originData as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (created) {\r\n\t\t\t\t\t\tawait this.insert(\r\n\t\t\t\t\t\t\tcreated.layout,\r\n\t\t\t\t\t\t\tcreated.content,\r\n\t\t\t\t\t\t\tcreated.settings,\r\n\t\t\t\t\t\t\tdata.originData as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('Failed to create block');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (value?.clipboard && value.clipboard.selection?.length && data) {\r\n\t\t\t\t\tconst clipboardContext = await this.getContext(UMB_CLIPBOARD_PROPERTY_CONTEXT);\r\n\t\t\t\t\tif (!clipboardContext) {\r\n\t\t\t\t\t\tthrow new Error('Clipboard context not available');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst propertyValues = await clipboardContext.readMultiple<UmbBlockGridValueModel>(\r\n\t\t\t\t\t\tvalue.clipboard.selection,\r\n\t\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis._insertFromPropertyValues(propertyValues, data.originData as UmbBlockGridWorkspaceOriginData);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\t// TODO: Does it make any sense that this is a state? Check usage and confirm. [NL]\r\n\t\t\t\tthis._catalogueRouteBuilderState.setValue(routeBuilder);\r\n\t\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_BLOCK_GRID_WORKSPACE_MODAL)\r\n\t\t\t.addAdditionalPath('block')\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tentityType: 'block',\r\n\t\t\t\t\t\tpreset: {},\r\n\t\t\t\t\t\toriginData: {\r\n\t\t\t\t\t\t\tindex: -1,\r\n\t\t\t\t\t\t\tareaKey: this.#areaKey,\r\n\t\t\t\t\t\t\tparentUnique: this.#parentUnique,\r\n\t\t\t\t\t\t\tbaseDataPath: this._dataPath,\r\n\t\t\t\t\t\t} as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmodal: { size: 'medium' },\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tconst newPath = routeBuilder({});\r\n\t\t\t\tthis._workspacePath.setValue(newPath);\r\n\t\t\t});\r\n\t}\r\n\r\n\tasync #clipboardEntriesFilter(propertyValue: UmbBlockGridValueModel) {\r\n\t\tconst allowedElementTypeKeys = this.#retrieveAllowedElementTypes().map((x) => x.contentElementTypeKey);\r\n\r\n\t\tconst rootContentKeys = propertyValue.layout['Umbraco.BlockGrid']?.map((block) => block.contentKey) ?? [];\r\n\t\tconst rootContentTypeKeys = propertyValue.contentData\r\n\t\t\t.filter((content) => rootContentKeys.includes(content.key))\r\n\t\t\t.map((content) => content.contentTypeKey);\r\n\r\n\t\tconst allContentTypesAllowed = rootContentTypeKeys.every((contentKey) =>\r\n\t\t\tallowedElementTypeKeys.includes(contentKey),\r\n\t\t);\r\n\r\n\t\treturn allContentTypesAllowed;\r\n\t}\r\n\r\n\tprotected _gotBlockManager() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tthis.#setupAllowedBlockTypes();\r\n\t\tthis.#setupRangeLimits();\r\n\t}\r\n\r\n\t#gotAreaKey() {\r\n\t\tif (this.#areaKey === undefined) return;\r\n\t\tthis.#gotBlockParentEntry();\r\n\t}\r\n\r\n\tasync #gotBlockParentEntry() {\r\n\t\tif (this.#areaKey === undefined) return;\r\n\r\n\t\tif (this.#areaKey === null) {\r\n\t\t\t// Root entries:\r\n\t\t\tawait this._retrieveManager;\r\n\t\t\tif (!this._manager) return;\r\n\r\n\t\t\tthis.removeUmbControllerByAlias('observeParentUnique');\r\n\t\t\tthis.setParentUnique(null);\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis._manager.layouts,\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tthis._layoutEntries.setValue(layouts);\r\n\t\t\t\t},\r\n\t\t\t\t'observeParentLayouts',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.layoutEntries,\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tthis._manager?.setLayouts(layouts);\r\n\t\t\t\t},\r\n\t\t\t\t'observeThisLayouts',\r\n\t\t\t);\r\n\r\n\t\t\tconst hostEl = this.getHostElement() as HTMLElement | undefined;\r\n\t\t\tif (hostEl) {\r\n\t\t\t\thostEl.removeAttribute('data-area-alias');\r\n\t\t\t\thostEl.removeAttribute('data-area-col-span');\r\n\t\t\t\thostEl.removeAttribute('data-area-row-span');\r\n\t\t\t\thostEl.style.removeProperty('--umb-block-grid--grid-columns');\r\n\t\t\t\thostEl.style.removeProperty('--umb-block-grid--area-column-span');\r\n\t\t\t\thostEl.style.removeProperty('--umb-block-grid--area-row-span');\r\n\t\t\t}\r\n\r\n\t\t\tthis.removeUmbControllerByAlias('observeAreaType');\r\n\t\t\tthis.#setupAllowedBlockTypes();\r\n\t\t\tthis.#setupRangeLimits();\r\n\t\t} else {\r\n\t\t\tif (!this.#parentEntry) return;\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#parentEntry.unique,\r\n\t\t\t\t(unique) => {\r\n\t\t\t\t\tthis.setParentUnique(unique ?? null);\r\n\t\t\t\t},\r\n\t\t\t\t'observeParentUnique',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#parentEntry.layoutsOfArea(this.#areaKey),\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tif (layouts) {\r\n\t\t\t\t\t\tthis._layoutEntries.setValue(layouts);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeParentLayouts',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.layoutEntries,\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tif (this.#areaKey) {\r\n\t\t\t\t\t\tthis.#parentEntry?.setLayoutsOfArea(this.#areaKey, layouts);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeThisLayouts',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#parentEntry.areaType(this.#areaKey),\r\n\t\t\t\t(areaType) => {\r\n\t\t\t\t\tthis.#areaType.setValue(areaType);\r\n\t\t\t\t\tconst hostEl = this.getHostElement() as HTMLElement | undefined;\r\n\t\t\t\t\tif (!hostEl) return;\r\n\t\t\t\t\thostEl.setAttribute('data-area-alias', areaType?.alias ?? '');\r\n\t\t\t\t\thostEl.setAttribute('data-area-col-span', areaType?.columnSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.setAttribute('data-area-row-span', areaType?.rowSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.style.setProperty('--umb-block-grid--grid-columns', areaType?.columnSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.style.setProperty('--umb-block-grid--area-column-span', areaType?.columnSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.style.setProperty('--umb-block-grid--area-row-span', areaType?.rowSpan?.toString() ?? '');\r\n\t\t\t\t\tthis.#setupAllowedBlockTypes();\r\n\t\t\t\t\tthis.#setupRangeLimits();\r\n\t\t\t\t},\r\n\t\t\t\t'observeAreaType',\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t#setupAllowedBlockTypes() {\r\n\t\tif (!this._manager) return;\r\n\t\tthis.#allowedBlockTypes.setValue(this.#retrieveAllowedElementTypes());\r\n\t\tthis.#setupAllowedBlockTypesLimits();\r\n\t}\r\n\t#setupRangeLimits() {\r\n\t\tif (!this._manager) return;\r\n\t\t//const range = this.#retrieveRangeLimits();\r\n\t\tif (this.#areaKey != null) {\r\n\t\t\tconst areaType = this.#areaType.getValue();\r\n\t\t\tthis.removeUmbControllerByAlias('observeConfigurationRootLimits');\r\n\t\t\t// Area entries:\r\n\t\t\tif (!areaType) return undefined;\r\n\t\t\t// No need to observe as this method is called every time the area is changed.\r\n\t\t\tthis.#rangeLimits.setValue({\r\n\t\t\t\tmin: areaType.minAllowed ?? 0,\r\n\t\t\t\tmax: areaType.maxAllowed ?? Infinity,\r\n\t\t\t});\r\n\t\t} else if (this.#areaKey === null) {\r\n\t\t\tif (!this._manager) return undefined;\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis._manager.editorConfiguration,\r\n\t\t\t\t(config) => {\r\n\t\t\t\t\tconst min = config?.getValueByAlias<UmbNumberRangeValueType>('validationLimit')?.min ?? 0;\r\n\t\t\t\t\tconst max = config?.getValueByAlias<UmbNumberRangeValueType>('validationLimit')?.max ?? Infinity;\r\n\t\t\t\t\tthis.#rangeLimits.setValue({ min, max });\r\n\t\t\t\t},\r\n\t\t\t\t'observeConfigurationRootLimits',\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tgetPathForCreateBlock(index: number) {\r\n\t\treturn this._catalogueRouteBuilderState.getValue()?.({ view: 'create', index: index });\r\n\t}\r\n\r\n\tgetPathForClipboard(index: number) {\r\n\t\treturn this._catalogueRouteBuilderState.getValue()?.({ view: 'clipboard', index: index });\r\n\t}\r\n\r\n\tisBlockTypeAllowed(contentTypeKey: string) {\r\n\t\treturn this.#allowedBlockTypes.asObservablePart((types) =>\r\n\t\t\ttypes.some((x) => x.contentElementTypeKey === contentTypeKey),\r\n\t\t);\r\n\t}\r\n\r\n\t/*\r\n\tasync setLayouts(layouts: Array<UmbBlockGridLayoutModel>) {\r\n\t\tawait this._retrieveManager;\r\n\t\tif (this.#areaKey === null) {\r\n\t\t\tthis._manager?.setLayouts(layouts);\r\n\t\t} else {\r\n\t\t\tif (!this.#parentUnique || !this.#areaKey) {\r\n\t\t\t\tthrow new Error('ParentUnique or AreaKey not set');\r\n\t\t\t}\r\n\t\t\tthis._manager?.setLayoutsOfArea(this.#parentUnique, this.#areaKey, layouts);\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tasync create(\r\n\t\tcontentElementTypeKey: string,\r\n\t\tpartialLayoutEntry?: Omit<UmbBlockGridLayoutModel, 'contentKey'>,\r\n\t\toriginData?: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tawait this._retrieveManager;\r\n\t\treturn await this._manager?.createWithPresets(contentElementTypeKey, partialLayoutEntry, originData);\r\n\t}\r\n\r\n\t// insert Block?\r\n\r\n\tasync insert(\r\n\t\tlayoutEntry: UmbBlockGridLayoutModel,\r\n\t\tcontent: UmbBlockDataModel,\r\n\t\tsettings: UmbBlockDataModel | undefined,\r\n\t\toriginData: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tawait this._retrieveManager;\r\n\t\treturn this._manager?.insert(layoutEntry, content, settings, originData) ?? false;\r\n\t}\r\n\r\n\t// create Block?\r\n\toverride async delete(contentKey: string) {\r\n\t\t// TODO: Loop through children and delete them as well?\r\n\t\t// Find layout entry:\r\n\t\tconst layout = this._layoutEntries.getValue().find((x) => x.contentKey === contentKey);\r\n\t\tif (!layout) {\r\n\t\t\tthrow new Error(`Cannot delete block, missing layout for ${contentKey}`);\r\n\t\t}\r\n\t\t// The following loop will only delete the referenced data of sub Layout Entries, as the Layout entry is part of the main Layout Entry they will go away when that is removed. [NL]\r\n\t\tforEachBlockLayoutEntryOf(layout, async (entry) => {\r\n\t\t\tif (entry.settingsKey) {\r\n\t\t\t\tthis._manager!.removeOneSettings(entry.settingsKey);\r\n\t\t\t}\r\n\t\t\tthis._manager!.removeOneContent(contentKey);\r\n\t\t\tthis._manager!.removeExposesOf(contentKey);\r\n\t\t});\r\n\r\n\t\tawait super.delete(contentKey);\r\n\t}\r\n\r\n\tprotected async _insertFromPropertyValue(value: UmbBlockGridValueModel, originData: UmbBlockGridWorkspaceOriginData) {\r\n\t\tconst layoutEntries = value.layout[UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS];\r\n\r\n\t\tif (!layoutEntries) {\r\n\t\t\tthrow new Error('No layout entries found');\r\n\t\t}\r\n\r\n\t\tawait Promise.all(\r\n\t\t\tlayoutEntries.map(async (layoutEntry) => {\r\n\t\t\t\tawait this._insertBlockFromPropertyValue(layoutEntry, value, originData);\r\n\t\t\t\tif (originData.index !== -1) {\r\n\t\t\t\t\toriginData = { ...originData, index: originData.index + 1 };\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\treturn originData;\r\n\t}\r\n\r\n\tprotected override async _insertBlockFromPropertyValue(\r\n\t\tlayoutEntry: UmbBlockGridLayoutModel,\r\n\t\tvalue: UmbBlockGridValueModel,\r\n\t\toriginData: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tawait super._insertBlockFromPropertyValue(layoutEntry, value, originData);\r\n\r\n\t\t// Handle inserting of the inner blocks..\r\n\t\tawait forEachBlockLayoutEntryOf(layoutEntry, async (entry, parentUnique, areaKey) => {\r\n\t\t\tconst localOriginData = { index: -1, parentUnique, areaKey };\r\n\t\t\tawait this._insertBlockFromPropertyValue(entry, value, localOriginData);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @returns {Array<UmbBlockGridTypeModel>} an Array of ElementTypeKeys that are allowed in the current area. Or undefined if not ready jet.\r\n\t */\r\n\t#retrieveAllowedElementTypes() {\r\n\t\tif (!this._manager) return [];\r\n\r\n\t\tif (this.#areaKey) {\r\n\t\t\tconst areaType = this.#areaType.getValue();\r\n\t\t\t// Area entries:\r\n\t\t\tif (!areaType) return [];\r\n\r\n\t\t\tif (areaType.specifiedAllowance && areaType.specifiedAllowance?.length > 0) {\r\n\t\t\t\treturn (\r\n\t\t\t\t\tareaType.specifiedAllowance\r\n\t\t\t\t\t\t.flatMap((permission) => {\r\n\t\t\t\t\t\t\tif (permission.groupKey) {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\tthis._manager?.getBlockTypes().filter((blockType) => blockType.groupKey === permission.groupKey) ?? []\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else if (permission.elementTypeKey) {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\tthis._manager?.getBlockTypes().filter((x) => x.contentElementTypeKey === permission.elementTypeKey) ??\r\n\t\t\t\t\t\t\t\t\t[]\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// Remove duplicates:\r\n\t\t\t\t\t\t.filter((v, i, a) => a.findIndex((x) => x.contentElementTypeKey === v.contentElementTypeKey) === i)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// No specific permissions setup, so we will fallback to items allowed in areas:\r\n\t\t\treturn this._manager.getBlockTypes().filter((x) => x.allowInAreas);\r\n\t\t} else if (this.#areaKey === null) {\r\n\t\t\t// If AreaKey is null, then we are in the root, looking for items allowed as root:\r\n\t\t\treturn this._manager.getBlockTypes().filter((x) => x.allowAtRoot);\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t#setupAllowedBlockTypesLimits() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tif (this.#areaKey) {\r\n\t\t\tconst areaType = this.#areaType.getValue();\r\n\t\t\t// Area entries:\r\n\t\t\tif (!areaType) return;\r\n\r\n\t\t\tif (areaType.specifiedAllowance && areaType.specifiedAllowance?.length > 0) {\r\n\t\t\t\tthis.#hasTypeLimits.setValue(true);\r\n\t\t\t}\r\n\t\t} else if (this.#areaKey === null) {\r\n\t\t\t// RESET\r\n\t\t}\r\n\t}\r\n\r\n\t// Property to hold the result of the check, used to make a meaningful Validation Message\r\n\t#invalidBlockTypeLimits?: Array<UmbBlockGridAreaTypeInvalidRuleType>;\r\n\r\n\tgetInvalidBlockTypeLimits() {\r\n\t\treturn this.#invalidBlockTypeLimits ?? [];\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t * @returns {boolean} - True if the block type limits are valid, otherwise false.\r\n\t */\r\n\tcheckBlockTypeLimitsValidity(): boolean {\r\n\t\tconst areaType = this.#areaType.getValue();\r\n\t\tif (!areaType || !areaType.specifiedAllowance) return false;\r\n\r\n\t\tconst layoutEntries = this._layoutEntries.getValue();\r\n\r\n\t\tthis.#invalidBlockTypeLimits = areaType.specifiedAllowance\r\n\t\t\t.map((rule) => {\r\n\t\t\t\tconst minAllowed = rule.minAllowed || 0;\r\n\t\t\t\tconst maxAllowed = rule.maxAllowed || 0;\r\n\r\n\t\t\t\t// For block groups:\r\n\t\t\t\tif (rule.groupKey) {\r\n\t\t\t\t\tconst groupElementTypeKeys =\r\n\t\t\t\t\t\tthis._manager\r\n\t\t\t\t\t\t\t?.getBlockTypes()\r\n\t\t\t\t\t\t\t.filter((blockType) => blockType.groupKey === rule.groupKey && blockType.allowInAreas === true)\r\n\t\t\t\t\t\t\t.map((x) => x.contentElementTypeKey) ?? [];\r\n\t\t\t\t\tconst groupAmount = layoutEntries.filter((entry) => {\r\n\t\t\t\t\t\tconst contentTypeKey = this._manager!.getContentTypeKeyOfContentKey(entry.contentKey);\r\n\t\t\t\t\t\treturn contentTypeKey ? groupElementTypeKeys.indexOf(contentTypeKey) !== -1 : false;\r\n\t\t\t\t\t}).length;\r\n\r\n\t\t\t\t\tif (groupAmount < minAllowed || (maxAllowed > 0 && groupAmount > maxAllowed)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tgroupKey: rule.groupKey,\r\n\t\t\t\t\t\t\tname: this._manager!.getBlockGroupName(rule.groupKey) ?? '?',\r\n\t\t\t\t\t\t\tamount: groupAmount,\r\n\t\t\t\t\t\t\tminRequirement: minAllowed,\r\n\t\t\t\t\t\t\tmaxRequirement: maxAllowed,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t\t// For specific elementTypes:\r\n\t\t\t\telse if (rule.elementTypeKey) {\r\n\t\t\t\t\tconst amount = layoutEntries.filter((entry) => {\r\n\t\t\t\t\t\tconst contentTypeKey = this._manager!.getContentOf(entry.contentKey)?.contentTypeKey;\r\n\t\t\t\t\t\treturn contentTypeKey === rule.elementTypeKey;\r\n\t\t\t\t\t}).length;\r\n\t\t\t\t\tif (amount < minAllowed || (maxAllowed > 0 ? amount > maxAllowed : false)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tkey: rule.elementTypeKey,\r\n\t\t\t\t\t\t\tname: this._manager!.getContentTypeNameOf(rule.elementTypeKey) ?? '?',\r\n\t\t\t\t\t\t\tamount: amount,\r\n\t\t\t\t\t\t\tminRequirement: minAllowed,\r\n\t\t\t\t\t\t\tmaxRequirement: maxAllowed,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Lets fail cause the rule was bad.\r\n\t\t\t\tconsole.error('Invalid block type limit rule.', rule);\r\n\t\t\t\treturn undefined;\r\n\t\t\t})\r\n\t\t\t.filter((x) => x !== undefined) as Array<UmbBlockGridAreaTypeInvalidRuleType>;\r\n\t\treturn this.#invalidBlockTypeLimits.length === 0;\r\n\t}\r\n\r\n\t#invalidBlockTypeConfigurations?: Array<string>;\r\n\r\n\tgetInvalidBlockTypeConfigurations() {\r\n\t\treturn this.#invalidBlockTypeConfigurations ?? [];\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t * @returns {boolean} - True if the block type limits are valid, otherwise false.\r\n\t */\r\n\tcheckBlockTypeConfigurationValidity(): boolean {\r\n\t\tthis.#invalidBlockTypeConfigurations = [];\r\n\r\n\t\tconst layoutEntries = this._layoutEntries.getValue();\r\n\t\tif (layoutEntries.length === 0) return true;\r\n\r\n\t\t// Check all layout entries if they are allowed.\r\n\t\tconst allowedBlocks = this.#allowedBlockTypes.getValue();\r\n\t\tif (allowedBlocks.length === 0) return false;\r\n\r\n\t\tconst allowedKeys = allowedBlocks.map((x) => x.contentElementTypeKey);\r\n\t\t// get content for each layout entry:\r\n\t\tconst invalidEntries = layoutEntries.filter((entry) => {\r\n\t\t\tconst contentTypeKey = this._manager!.getContentTypeKeyOfContentKey(entry.contentKey);\r\n\t\t\tif (!contentTypeKey) {\r\n\t\t\t\t// We could not find the content type key, so we cant determin if this is valid or not when the content is missing.\r\n\t\t\t\t// This should be captured elsewhere as the Block then becomes invalid. So the unsupported Block should capture this.\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tconst isBad = allowedKeys.indexOf(contentTypeKey) === -1;\r\n\t\t\tif (contentTypeKey && isBad) {\r\n\t\t\t\t// if bad, then add the ContentTypeName to the list of invalids (if we could not find the name add the key)\r\n\t\t\t\tthis.#invalidBlockTypeConfigurations?.push(\r\n\t\t\t\t\tthis._manager?.getContentTypeNameOf(contentTypeKey) ?? contentTypeKey,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn isBad;\r\n\t\t});\r\n\r\n\t\treturn invalidEntries.length === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Check if given contentKey is allowed in the current area.\r\n\t * @param {string} contentKey - The contentKey of the content to check.\r\n\t * @returns {boolean} - True if the content is allowed in the current area, otherwise false.\r\n\t */\r\n\tallowDrop(contentKey: string) {\r\n\t\tconst content = this._manager?.getContentOf(contentKey);\r\n\t\tconst allowedBlocks = this.#allowedBlockTypes.getValue();\r\n\t\tif (!content || !allowedBlocks) return false;\r\n\r\n\t\treturn allowedBlocks.map((x) => x.contentElementTypeKey).indexOf(content.contentTypeKey) !== -1;\r\n\t}\r\n\r\n\tonDragStart() {\r\n\t\tthis._manager?.onDragStart();\r\n\t}\r\n\r\n\tonDragEnd() {\r\n\t\tthis._manager?.onDragEnd();\r\n\t}\r\n}\r\n","import type { UmbBlockGridEntryElement } from '../block-grid-entry/block-grid-entry.element.js';\r\nimport type { UmbBlockGridLayoutModel } from '../../types.js';\r\nimport { UmbBlockGridEntriesContext } from './block-grid-entries.context.js';\r\nimport {\r\n\tgetAccumulatedValueOfIndex,\r\n\tgetInterpolatedIndexOfPositionInWeightMap,\r\n\tisWithinRect,\r\n} from '@umbraco-cms/backoffice/utils';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, customElement, state, repeat, css, property, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport {\r\n\tUmbSorterController,\r\n\ttype UmbSorterConfig,\r\n\ttype UmbSorterResolvePlacementArgs,\r\n} from '@umbraco-cms/backoffice/sorter';\r\nimport {\r\n\tUmbFormControlMixin,\r\n\tUmbFormControlValidator,\r\n\ttype UmbFormControlValidatorConfig,\r\n} from '@umbraco-cms/backoffice/validation';\r\nimport type { UmbNumberRangeValueType } from '@umbraco-cms/backoffice/models';\r\n\r\n/**\r\n * Notice this utility method is not really shareable with others as it also takes areas into account. [NL]\r\n * @param args\r\n * @returns { null | true }\r\n */\r\nfunction resolvePlacementAsBlockGrid(\r\n\targs: UmbSorterResolvePlacementArgs<UmbBlockGridLayoutModel, UmbBlockGridEntryElement>,\r\n) {\r\n\t// If this has areas, we do not want to move, unless we are at the edge\r\n\tif (\r\n\t\targs.relatedModel.areas &&\r\n\t\targs.relatedModel.areas.length > 0 &&\r\n\t\tisWithinRect(args.pointerX, args.pointerY, args.relatedRect, -10)\r\n\t) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/** We need some data about the grid to figure out if there is room to be placed next to the found element */\r\n\tconst approvedContainerComputedStyles = getComputedStyle(args.containerElement);\r\n\tconst gridColumnGap = Number(approvedContainerComputedStyles.columnGap.split('px')[0]) || 0;\r\n\tconst gridColumnNumber = parseInt(\r\n\t\tapprovedContainerComputedStyles.getPropertyValue('--umb-block-grid--grid-columns'),\r\n\t\t10,\r\n\t);\r\n\r\n\tconst foundElColumns = parseInt(args.relatedElement.dataset.colSpan ?? '', 10);\r\n\tconst currentElementColumns = args.item.columnSpan;\r\n\r\n\tif (currentElementColumns >= gridColumnNumber) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Get grid template:\r\n\tconst approvedContainerGridColumns = approvedContainerComputedStyles.gridTemplateColumns\r\n\t\t.trim()\r\n\t\t.split('px')\r\n\t\t.map((x) => Number(x))\r\n\t\t.filter((n) => n > 0)\r\n\t\t.map((n, i, list) => (list.length === i ? n : n + gridColumnGap));\r\n\r\n\t// ensure all columns are there.\r\n\t// This will also ensure handling non-css-grid mode,\r\n\t// use container width divided by amount of columns( or the item width divided by its amount of columnSpan)\r\n\tlet amountOfColumnsInWeightMap = approvedContainerGridColumns.length;\r\n\tconst amountOfUnknownColumns = gridColumnNumber - amountOfColumnsInWeightMap;\r\n\tif (amountOfUnknownColumns > 0) {\r\n\t\tconst accumulatedValue = getAccumulatedValueOfIndex(amountOfColumnsInWeightMap, approvedContainerGridColumns) || 0;\r\n\t\tconst missingColumnWidth = (args.containerRect.width - accumulatedValue) / amountOfUnknownColumns;\r\n\t\tif (missingColumnWidth > 0) {\r\n\t\t\twhile (amountOfColumnsInWeightMap++ < gridColumnNumber) {\r\n\t\t\t\tapprovedContainerGridColumns.push(missingColumnWidth);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet offsetPlacement = 0;\r\n\t/* If placeholder is in this same line, we want to assume that it will offset the placement of the found element,\r\n\twhich provides more potential space for the item to drop at.\r\n\tThis is relevant in this calculation where we look at the space to determine if its a vertical or horizontal drop in relation to the found element.\r\n\t*/\r\n\tif (args.placeholderIsInThisRow && args.elementRect.left < args.relatedRect.left) {\r\n\t\toffsetPlacement = -(args.elementRect.width + gridColumnGap);\r\n\t}\r\n\r\n\tconst relatedStartX = Math.max(args.relatedRect.left - args.containerRect.left + offsetPlacement, 0);\r\n\tconst relatedStartCol = Math.round(\r\n\t\tgetInterpolatedIndexOfPositionInWeightMap(relatedStartX, approvedContainerGridColumns),\r\n\t);\r\n\t// If the found related element does not have enough room after which for the current element, then we go vertical mode:\r\n\tconst verticalDirection = relatedStartCol + foundElColumns + currentElementColumns > gridColumnNumber;\r\n\treturn verticalDirection;\r\n\t/*\r\n\tlet placeAfter = args.horizontalPlaceAfter;\r\n\r\n\treturn {\r\n\t\tverticalDirection,\r\n\t\tplaceAfter,\r\n\t};*/\r\n}\r\n\r\n// --------------------------\r\n// End of utils.\r\n// --------------------------\r\n\r\nconst SORTER_CONFIG: UmbSorterConfig<UmbBlockGridLayoutModel, UmbBlockGridEntryElement> = {\r\n\tgetUniqueOfElement: (element) => {\r\n\t\treturn element.contentKey!;\r\n\t},\r\n\tgetUniqueOfModel: (modelEntry) => {\r\n\t\treturn modelEntry.contentKey;\r\n\t},\r\n\tresolvePlacement: resolvePlacementAsBlockGrid,\r\n\tidentifier: 'block-grid-editor',\r\n\titemSelector: 'umb-block-grid-entry',\r\n\tcontainerSelector: '.umb-block-grid__layout-container',\r\n};\r\n\r\n/**\r\n * @element umb-block-grid-entries\r\n */\r\n@customElement('umb-block-grid-entries')\r\nexport class UmbBlockGridEntriesElement extends UmbFormControlMixin(UmbLitElement) {\r\n\t//\r\n\t#sorter = new UmbSorterController<UmbBlockGridLayoutModel, UmbBlockGridEntryElement>(this, {\r\n\t\t...SORTER_CONFIG,\r\n\t\tonStart: () => {\r\n\t\t\tthis.#context.onDragStart();\r\n\t\t},\r\n\t\tonEnd: () => {\r\n\t\t\tthis.#context.onDragEnd();\r\n\t\t},\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.#context.setLayouts(model);\r\n\t\t},\r\n\t\tonRequestMove: ({ item }) => {\r\n\t\t\treturn this.#context.allowDrop(item.contentKey);\r\n\t\t},\r\n\t\tonDisallowed: () => {\r\n\t\t\tthis.setAttribute('disallow-drop', '');\r\n\t\t},\r\n\t\tonAllowed: () => {\r\n\t\t\tthis.removeAttribute('disallow-drop');\r\n\t\t},\r\n\t});\r\n\r\n\t#context = new UmbBlockGridEntriesContext(this);\r\n\t#controlValidator?: UmbFormControlValidator;\r\n\t#typeLimitValidator?: UmbFormControlValidatorConfig;\r\n\t#rangeUnderflowValidator?: UmbFormControlValidatorConfig;\r\n\t#rangeOverflowValidator?: UmbFormControlValidatorConfig;\r\n\r\n\t@property({ type: String, attribute: 'area-key', reflect: true })\r\n\tpublic set areaKey(value: string | null | undefined) {\r\n\t\tthis._areaKey = value;\r\n\t\tthis.#context.setAreaKey(value ?? null);\r\n\t\tthis.#controlValidator?.destroy();\r\n\t\tif (this.areaKey) {\r\n\t\t\t// Only when there is a area key we should create a validator, otherwise it is the root entries element, which is taking part of the Property Editor Form Control. [NL]\r\n\t\t\t// Currently there is no server validation for areas. So we can leave out the data path for it for now. [NL]\r\n\t\t\tthis.#controlValidator = new UmbFormControlValidator(this, this);\r\n\r\n\t\t\t//new UmbBindServerValidationToFormControl(this, this, \"$.values.[?(@.alias == 'my-input-alias')].value\");\r\n\t\t}\r\n\t}\r\n\tpublic get areaKey(): string | null | undefined {\r\n\t\treturn this._areaKey;\r\n\t}\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set layoutColumns(value: number | undefined) {\r\n\t\tthis.#context.setLayoutColumns(value);\r\n\t}\r\n\tpublic get layoutColumns(): number | undefined {\r\n\t\treturn this.#context.getLayoutColumns();\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _areaKey?: string | null;\r\n\r\n\t@state()\r\n\tprivate _canCreate?: boolean;\r\n\r\n\t@state()\r\n\tprivate _createLabel?: string;\r\n\r\n\t@state()\r\n\tprivate _configCreateLabel?: string;\r\n\r\n\t@state()\r\n\tprivate _styleElement?: HTMLLinkElement;\r\n\r\n\t@state()\r\n\tprivate _layoutEntries: Array<UmbBlockGridLayoutModel> = [];\r\n\r\n\t@state()\r\n\tprivate _isReadOnly: boolean = false;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.layoutEntries,\r\n\t\t\t(layoutEntries) => {\r\n\t\t\t\t//const oldValue = this._layoutEntries;\r\n\t\t\t\tthis.#sorter.setModel(layoutEntries);\r\n\t\t\t\tthis._layoutEntries = layoutEntries;\r\n\t\t\t\t//this.requestUpdate('layoutEntries', oldValue);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.amountOfAllowedBlockTypes,\r\n\t\t\t(length) => {\r\n\t\t\t\tthis._canCreate = length > 0;\r\n\t\t\t\tif (length === 1) {\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tthis.#context.firstAllowedBlockTypeName(),\r\n\t\t\t\t\t\t(firstAllowedName) => {\r\n\t\t\t\t\t\t\tthis._createLabel = this.localize.term('blockEditor_addThis', this.localize.string(firstAllowedName));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeSingleBlockTypeName',\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.removeUmbControllerByAlias('observeSingleBlockTypeName');\r\n\t\t\t\t\tthis._createLabel = this.localize.term('blockEditor_addBlock');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.rangeLimits,\r\n\t\t\t(rangeLimits) => {\r\n\t\t\t\tthis.#setupRangeValidation(rangeLimits);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.hasTypeLimits,\r\n\t\t\t(hasTypeLimits) => {\r\n\t\t\t\tthis.#setupBlockTypeLimitValidation(hasTypeLimits);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.#context.getManager().then((manager) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.layoutStylesheet,\r\n\t\t\t\t(stylesheet) => {\r\n\t\t\t\t\tif (!stylesheet || this._styleElement?.href === stylesheet) return;\r\n\t\t\t\t\tthis._styleElement = document.createElement('link');\r\n\t\t\t\t\tthis._styleElement.rel = 'stylesheet';\r\n\t\t\t\t\tthis._styleElement.href = stylesheet;\r\n\t\t\t\t},\r\n\t\t\t\t'observeStylesheet',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.readOnlyState.permitted,\r\n\t\t\t\t(isReadOnly) => (this._isReadOnly = isReadOnly),\r\n\t\t\t\t'observeIsReadOnly',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.variantId,\r\n\t\t\t\t(variantId) => {\r\n\t\t\t\t\tif (variantId) {\r\n\t\t\t\t\t\tthis.#sorter.identifier = 'umb-block-grid-' + variantId.toString();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeVariantId',\r\n\t\t\t);\r\n\r\n\t\t\tif (this.areaKey) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tthis.#context.areaTypeCreateLabel,\r\n\t\t\t\t\t(label) => (this._configCreateLabel = label),\r\n\t\t\t\t\t'observeConfigCreateLabel',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tmanager.editorConfigurationPart((x) => x?.find((y) => y.alias === 'createLabel')?.value),\r\n\t\t\t\t\t(label) => (this._configCreateLabel = label as string | undefined),\r\n\t\t\t\t\t'observeConfigCreateLabel',\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tnew UmbFormControlValidator(this, this /*, this.#dataPath*/);\r\n\t}\r\n\r\n\tasync #setupRangeValidation(rangeLimit: UmbNumberRangeValueType | undefined) {\r\n\t\tif (this.#rangeUnderflowValidator) {\r\n\t\t\tthis.removeValidator(this.#rangeUnderflowValidator);\r\n\t\t\tthis.#rangeUnderflowValidator = undefined;\r\n\t\t}\r\n\t\tif (rangeLimit?.min !== 0) {\r\n\t\t\tthis.#rangeUnderflowValidator = this.addValidator(\r\n\t\t\t\t'rangeUnderflow',\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn this.localize.term(\r\n\t\t\t\t\t\t'validation_entriesShort',\r\n\t\t\t\t\t\trangeLimit!.min,\r\n\t\t\t\t\t\t(rangeLimit!.min ?? 0) - this._layoutEntries.length,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t() => this._layoutEntries.length < (rangeLimit?.min ?? 0),\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.#rangeOverflowValidator) {\r\n\t\t\tthis.removeValidator(this.#rangeOverflowValidator);\r\n\t\t\tthis.#rangeOverflowValidator = undefined;\r\n\t\t}\r\n\t\tif (rangeLimit?.max !== Infinity) {\r\n\t\t\tthis.#rangeOverflowValidator = this.addValidator(\r\n\t\t\t\t'rangeOverflow',\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn this.localize.term(\r\n\t\t\t\t\t\t'validation_entriesExceed',\r\n\t\t\t\t\t\trangeLimit!.max,\r\n\t\t\t\t\t\tthis._layoutEntries.length - (rangeLimit!.max ?? this._layoutEntries.length),\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t() => this._layoutEntries.length > (rangeLimit?.max ?? Infinity),\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #setupBlockTypeLimitValidation(hasTypeLimits: boolean | undefined) {\r\n\t\tif (this.#typeLimitValidator) {\r\n\t\t\tthis.removeValidator(this.#typeLimitValidator);\r\n\t\t\tthis.#typeLimitValidator = undefined;\r\n\t\t}\r\n\t\tif (hasTypeLimits) {\r\n\t\t\t// If we have specific block type limits, we should use those for validation (not the Block Type Configurations)\r\n\t\t\tthis.#typeLimitValidator = this.addValidator(\r\n\t\t\t\t'customError',\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst invalids = this.#context.getInvalidBlockTypeLimits();\r\n\t\t\t\t\treturn invalids\r\n\t\t\t\t\t\t.map((invalidRule) =>\r\n\t\t\t\t\t\t\tthis.localize.term(\r\n\t\t\t\t\t\t\t\tinvalidRule.amount < invalidRule.minRequirement\r\n\t\t\t\t\t\t\t\t\t? 'blockEditor_areaValidationEntriesShort'\r\n\t\t\t\t\t\t\t\t\t: 'blockEditor_areaValidationEntriesExceed',\r\n\t\t\t\t\t\t\t\tinvalidRule.name,\r\n\t\t\t\t\t\t\t\tinvalidRule.amount,\r\n\t\t\t\t\t\t\t\tinvalidRule.minRequirement,\r\n\t\t\t\t\t\t\t\tinvalidRule.maxRequirement,\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.join(', ');\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn !this.#context.checkBlockTypeLimitsValidity();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\t// Limit based on Block Type Configurations (Allow in Areas / allow in root)\r\n\t\t\tthis.#typeLimitValidator = this.addValidator(\r\n\t\t\t\t'customError',\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst invalids = this.#context\r\n\t\t\t\t\t\t.getInvalidBlockTypeConfigurations()\r\n\t\t\t\t\t\t// make invalids unique:\r\n\t\t\t\t\t\t.filter((v, i, a) => a.indexOf(v) === i)\r\n\t\t\t\t\t\t// join them together to become a string:\r\n\t\t\t\t\t\t.join(', ');\r\n\t\t\t\t\treturn this.localize.term(\r\n\t\t\t\t\t\tthis._areaKey\r\n\t\t\t\t\t\t\t? 'blockEditor_areaValidationEntriesNotAllowed'\r\n\t\t\t\t\t\t\t: 'blockEditor_rootValidationEntriesNotAllowed',\r\n\t\t\t\t\t\tinvalids,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn !this.#context.checkBlockTypeConfigurationValidity();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t// TODO: Missing ability to jump directly to creating a Block, when there is only one Block Type. [NL]\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${this._styleElement}\r\n\t\t\t<div class=\"umb-block-grid__layout-container\" data-area-length=${this._layoutEntries.length}>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._layoutEntries,\r\n\t\t\t\t\t(layout, index) => `${index}_${layout.contentKey}`,\r\n\t\t\t\t\t(layout, index) =>\r\n\t\t\t\t\t\thtml`<umb-block-grid-entry\r\n\t\t\t\t\t\t\tclass=\"umb-block-grid__layout-item\"\r\n\t\t\t\t\t\t\tindex=${index}\r\n\t\t\t\t\t\t\t.contentKey=${layout.contentKey}\r\n\t\t\t\t\t\t\t.layout=${layout}>\r\n\t\t\t\t\t\t</umb-block-grid-entry>`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t\t${this._canCreate ? this.#renderCreateButtonGroup() : nothing}\r\n\t\t\t${this._areaKey ? html` <uui-form-validation-message .for=${this}></uui-form-validation-message>` : nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCreateButtonGroup() {\r\n\t\tif (this._areaKey === null || this._layoutEntries.length === 0) {\r\n\t\t\treturn html` <uui-button-group id=\"createButton\">\r\n\t\t\t\t${this.#renderCreateButton()} ${this.#renderPasteButton()}\r\n\t\t\t</uui-button-group>`;\r\n\t\t} else if (this._isReadOnly === false) {\r\n\t\t\treturn html`<uui-button-inline-create\r\n\t\t\t\thref=${this.#context.getPathForCreateBlock(-1) ?? ''}\r\n\t\t\t\tlabel=${this.localize.term('blockEditor_addBlock')}></uui-button-inline-create> `;\r\n\t\t} else {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderCreateButton() {\r\n\t\tif (this._isReadOnly && this._layoutEntries.length > 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\tcolor=${this.pristine === false && this.validity.valid === false ? 'invalid' : 'default'}\r\n\t\t\t\tlabel=${this._configCreateLabel ?? this._createLabel ?? ''}\r\n\t\t\t\thref=${this.#context.getPathForCreateBlock(-1) ?? ''}\r\n\t\t\t\t?disabled=${this._isReadOnly}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderPasteButton() {\r\n\t\tif (this._areaKey) return nothing;\r\n\t\tif (this._isReadOnly && this._layoutEntries.length > 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tlabel=${this.localize.term('content_createFromClipboard')}\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\thref=${this.#context.getPathForClipboard(-1) ?? ''}\r\n\t\t\t\t?disabled=${this._isReadOnly}>\r\n\t\t\t\t<uui-icon name=\"icon-clipboard-paste\"></uui-icon>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: 1px;\r\n\t\t\t}\r\n\t\t\t:host([disallow-drop])::before {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder: 2px solid var(--uui-color-danger);\r\n\t\t\t\tborder-radius: calc(var(--uui-border-radius) * 2);\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t}\r\n\t\t\t:host([disallow-drop])::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder-radius: calc(var(--uui-border-radius) * 2);\r\n\t\t\t\tbackground-color: var(--uui-color-danger);\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t}\r\n\r\n\t\t\t> div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: stretch;\r\n\t\t\t}\r\n\r\n\t\t\t#createButton {\r\n\t\t\t\tgrid-template-columns: 1fr auto;\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t}\r\n\r\n\t\t\t/* Only when we are n an area, we like to hide the button on drag */\r\n\t\t\t:host([area-key]) #createButton {\r\n\t\t\t\t--umb-block-grid--create-button--is-dragging--variable: var(--umb-block-grid--is-dragging) none;\r\n\t\t\t\tdisplay: var(--umb-block-grid--create-button--is-dragging--variable, grid);\r\n\t\t\t}\r\n\r\n\t\t\t.umb-block-grid__layout-container[data-area-length='0'] {\r\n\t\t\t\t--umb-block-grid--layout-container--is-dragging--variable: var(--umb-block-grid--is-dragging) 1;\r\n\t\t\t\tmin-height: calc(var(--umb-block-grid--layout-container--is-dragging--variable, 0) * var(--uui-size-11));\r\n\t\t\t}\r\n\r\n\t\t\t.umb-block-grid__layout-container[data-area-length='0']::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\ttop: 1px;\r\n\t\t\t\tborder: calc(var(--umb-block-grid--layout-container--is-dragging--variable, 0) * 1px) dashed\r\n\t\t\t\t\tvar(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridEntriesElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-entries': UmbBlockGridEntriesElement;\r\n\t}\r\n}\r\n","import { closestColumnSpanOption, forEachBlockLayoutEntryOf } from '../../utils/index.js';\r\nimport type { UmbBlockGridLayoutModel, UmbBlockGridTypeModel, UmbBlockGridValueModel } from '../../types.js';\r\nimport {\r\n\tUMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS,\r\n\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n} from '../../constants.js';\r\nimport { UMB_BLOCK_GRID_MANAGER_CONTEXT } from '../../block-grid-manager/block-grid-manager.context-token.js';\r\nimport { UMB_BLOCK_GRID_ENTRIES_CONTEXT } from '../block-grid-entries/block-grid-entries.context-token.js';\r\nimport { UmbBlockGridScaleManager } from '../../context/block-grid-scale-manager/block-grid-scale-manager.controller.js';\r\nimport type { UmbBlockGridScalableContext } from '../../context/block-grid-scale-manager/block-grid-scale-manager.controller.js';\r\nimport {\r\n\tUmbArrayState,\r\n\tUmbBooleanState,\r\n\tUmbNumberState,\r\n\tappendToFrozenArray,\r\n\tmergeObservables,\r\n\tobserveMultiple,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbBlockEntryContext } from '@umbraco-cms/backoffice/block';\r\nimport { UMB_PROPERTY_CONTEXT, UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport { UMB_CLIPBOARD_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/clipboard';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbBlockGridEntryContext\r\n\textends UmbBlockEntryContext<\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT,\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT.TYPE,\r\n\t\ttypeof UMB_BLOCK_GRID_ENTRIES_CONTEXT,\r\n\t\ttypeof UMB_BLOCK_GRID_ENTRIES_CONTEXT.TYPE,\r\n\t\tUmbBlockGridTypeModel,\r\n\t\tUmbBlockGridLayoutModel\r\n\t>\r\n\timplements UmbBlockGridScalableContext\r\n{\r\n\t//\r\n\treadonly columnSpan = this._layout.asObservablePart((x) => (x ? (x.columnSpan ?? null) : undefined));\r\n\treadonly rowSpan = this._layout.asObservablePart((x) => (x ? (x.rowSpan ?? null) : undefined));\r\n\treadonly layoutAreas = this._layout.asObservablePart((x) => x?.areas);\r\n\treadonly columnSpanOptions = this._blockType.asObservablePart((x) => x?.columnSpanOptions ?? []);\r\n\treadonly areaTypeGridColumns = this._blockType.asObservablePart((x) => x?.areaGridColumns);\r\n\treadonly areas = this._blockType.asObservablePart((x) => x?.areas ?? []);\r\n\treadonly minMaxRowSpan = this._blockType.asObservablePart((x) =>\r\n\t\tx ? [x.rowMinSpan ?? 1, x.rowMaxSpan ?? 1] : undefined,\r\n\t);\r\n\treadonly forceHideContentEditorInOverlay = this._blockType.asObservablePart((x) =>\r\n\t\tx ? (x.forceHideContentEditorInOverlay ?? false) : undefined,\r\n\t);\r\n\r\n\tpublic getMinMaxRowSpan(): [number, number] | undefined {\r\n\t\tconst x = this._blockType.getValue();\r\n\t\tif (!x) return undefined;\r\n\t\treturn [x.rowMinSpan ?? 1, x.rowMaxSpan ?? 1];\r\n\t}\r\n\treadonly inlineEditingMode = this._blockType.asObservablePart((x) => x?.inlineEditing === true);\r\n\r\n\t#relevantColumnSpanOptions = new UmbArrayState<number>([], (x) => x);\r\n\treadonly relevantColumnSpanOptions = this.#relevantColumnSpanOptions.asObservable();\r\n\tpublic getRelevantColumnSpanOptions() {\r\n\t\treturn this.#relevantColumnSpanOptions.getValue();\r\n\t}\r\n\r\n\t#canScale = new UmbBooleanState(false);\r\n\treadonly canScale = this.#canScale.asObservable();\r\n\r\n\t#isAllowed = new UmbBooleanState(false);\r\n\treadonly isAllowed = this.#isAllowed.asObservable();\r\n\r\n\t#areaGridColumns = new UmbNumberState(undefined);\r\n\treadonly areaGridColumns = this.#areaGridColumns.asObservable();\r\n\r\n\treadonly showContentEdit = mergeObservables(\r\n\t\t[this._contentStructureHasProperties, this.forceHideContentEditorInOverlay],\r\n\t\t([a, b]) => a === true && b === false,\r\n\t);\r\n\r\n\treadonly scaleManager = new UmbBlockGridScaleManager(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_BLOCK_GRID_MANAGER_CONTEXT, UMB_BLOCK_GRID_ENTRIES_CONTEXT);\r\n\t}\r\n\r\n\tlayoutsOfArea(areaKey: string) {\r\n\t\treturn this._layout.asObservablePart((x) => x?.areas?.find((x) => x.key === areaKey)?.items);\r\n\t}\r\n\r\n\tareaType(areaKey: string) {\r\n\t\treturn this._blockType.asObservablePart((x) => x?.areas?.find((x) => x.key === areaKey));\r\n\t}\r\n\r\n\tsetLayoutsOfArea(areaKey: string, layouts: UmbBlockGridLayoutModel[]) {\r\n\t\tconst frozenValue = this._layout.value;\r\n\t\tif (!frozenValue) return;\r\n\t\tconst areas = appendToFrozenArray(\r\n\t\t\tfrozenValue?.areas ?? [],\r\n\t\t\t{\r\n\t\t\t\tkey: areaKey,\r\n\t\t\t\titems: layouts,\r\n\t\t\t},\r\n\t\t\t(x) => x.key,\r\n\t\t);\r\n\t\tthis._layout.update({ areas });\r\n\t}\r\n\r\n\t/**\r\n\t * Set the column span of this entry.\r\n\t * @param columnSpan {number} The new column span.\r\n\t */\r\n\tsetColumnSpan(columnSpan: number) {\r\n\t\tif (!this._entries) return;\r\n\t\tconst layoutColumns = this._entries.getLayoutColumns();\r\n\t\tif (!layoutColumns) return;\r\n\r\n\t\tcolumnSpan = this.#calcColumnSpan(columnSpan, this.getRelevantColumnSpanOptions(), layoutColumns);\r\n\t\tif (columnSpan === this.getColumnSpan()) return;\r\n\t\tconst layoutValue = this._layout.getValue();\r\n\t\tif (!layoutValue) return;\r\n\t\tthis._layout.setValue({\r\n\t\t\t...layoutValue,\r\n\t\t\tcolumnSpan,\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * Get the column span of this entry.\r\n\t * @returns {number} The column span.\r\n\t */\r\n\tgetColumnSpan() {\r\n\t\treturn this._layout.getValue()?.columnSpan;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the row span of this entry.\r\n\t * @param rowSpan {number} The new row span.\r\n\t */\r\n\tsetRowSpan(rowSpan: number) {\r\n\t\tconst minMax = this.getMinMaxRowSpan();\r\n\t\tif (!minMax) return;\r\n\t\trowSpan = Math.max(minMax[0], Math.min(rowSpan, minMax[1]));\r\n\t\tif (rowSpan === this.getRowSpan()) return;\r\n\t\tconst layoutValue = this._layout.getValue();\r\n\t\tif (!layoutValue) return;\r\n\t\tthis._layout.setValue({\r\n\t\t\t...layoutValue,\r\n\t\t\trowSpan,\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * Get the row span of this entry.\r\n\t * @returns {number} The row span.\r\n\t */\r\n\tgetRowSpan() {\r\n\t\treturn this._layout.getValue()?.rowSpan;\r\n\t}\r\n\r\n\tprotected override _gotManager() {\r\n\t\tthis.#gotEntriesAndManager();\r\n\t}\r\n\r\n\tprotected override _gotEntries() {\r\n\t\tthis.scaleManager.setEntriesContext(this._entries);\r\n\t\tif (!this._entries) return;\r\n\r\n\t\tthis.#gotEntriesAndManager();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.contentElementTypeKey,\r\n\t\t\t(key) => {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tkey ? this._entries?.isBlockTypeAllowed(key) : undefined,\r\n\t\t\t\t\t(isAllowed) => {\r\n\t\t\t\t\t\tif (isAllowed === undefined) return;\r\n\t\t\t\t\t\tthis.#isAllowed.setValue(isAllowed);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeIsAllowed',\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t'observeContentElementTypeKey',\r\n\t\t);\r\n\r\n\t\t// Retrieve scale options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.minMaxRowSpan, this.columnSpanOptions, this._entries.layoutColumns]),\r\n\t\t\t([minMaxRowSpan, columnSpanOptions, layoutColumns]) => {\r\n\t\t\t\tif (!layoutColumns || !minMaxRowSpan) return;\r\n\t\t\t\tconst relevantColumnSpanOptions = columnSpanOptions\r\n\t\t\t\t\t? columnSpanOptions\r\n\t\t\t\t\t\t\t.filter((x) => x.columnSpan <= layoutColumns)\r\n\t\t\t\t\t\t\t.map((x) => x.columnSpan)\r\n\t\t\t\t\t\t\t.sort((a, b) => (a > b ? 1 : b > a ? -1 : 0))\r\n\t\t\t\t\t: [];\r\n\t\t\t\tthis.#relevantColumnSpanOptions.setValue(relevantColumnSpanOptions);\r\n\t\t\t\tconst hasRelevantColumnSpanOptions = relevantColumnSpanOptions.length > 1;\r\n\t\t\t\tconst hasRowSpanOptions = minMaxRowSpan[0] !== minMaxRowSpan[1];\r\n\t\t\t\tconst canScale = hasRelevantColumnSpanOptions || hasRowSpanOptions;\r\n\r\n\t\t\t\tthis.#canScale.setValue(canScale);\r\n\t\t\t},\r\n\t\t\t'observeScaleOptions',\r\n\t\t);\r\n\r\n\t\t// Retrieve The Grid Columns for the Areas:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.areaTypeGridColumns, this._entries.layoutColumns]),\r\n\t\t\t([areaTypeGridColumns, layoutColumns]) => {\r\n\t\t\t\tthis.#areaGridColumns.setValue(areaTypeGridColumns ?? layoutColumns);\r\n\t\t\t},\r\n\t\t\t'observeAreaGridColumns',\r\n\t\t);\r\n\t}\r\n\r\n\t#gotEntriesAndManager() {\r\n\t\tif (!this._entries || !this._manager) return;\r\n\r\n\t\t// Secure areas fits options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.areas, this.layoutAreas]),\r\n\t\t\t([areas, layoutAreas]) => {\r\n\t\t\t\tif (!areas || !layoutAreas) return;\r\n\t\t\t\tconst areasAreIdentical =\r\n\t\t\t\t\tareas.length === layoutAreas.length && areas.every((area) => layoutAreas.some((y) => y.key === area.key));\r\n\t\t\t\tif (areasAreIdentical === false) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\tareas: layoutAreas.map((x) => (areas.find((y) => y.key === x.key) ? x : { key: x.key, items: [] })),\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeAreaValidation',\r\n\t\t);\r\n\r\n\t\t// Secure columnSpan fits options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.columnSpan, this.relevantColumnSpanOptions, this._entries.layoutColumns]),\r\n\t\t\t([columnSpan, relevantColumnSpanOptions, layoutColumns]) => {\r\n\t\t\t\tif (!layoutColumns || columnSpan === undefined) return;\r\n\t\t\t\tconst newColumnSpan = this.#calcColumnSpan(\r\n\t\t\t\t\tcolumnSpan ?? layoutColumns,\r\n\t\t\t\t\trelevantColumnSpanOptions,\r\n\t\t\t\t\tlayoutColumns,\r\n\t\t\t\t);\r\n\t\t\t\tif (newColumnSpan !== columnSpan) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\tcolumnSpan: newColumnSpan,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeColumnSpanValidation',\r\n\t\t);\r\n\r\n\t\t// Secure rowSpan fits options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.minMaxRowSpan, this.rowSpan]),\r\n\t\t\t([minMax, rowSpan]) => {\r\n\t\t\t\tif (!minMax || rowSpan === undefined) return;\r\n\t\t\t\tconst newRowSpan = Math.max(minMax[0], Math.min(rowSpan ?? 1, minMax[1]));\r\n\t\t\t\tif (newRowSpan !== rowSpan) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\trowSpan: newRowSpan,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeRowSpanValidation',\r\n\t\t);\r\n\t}\r\n\r\n\tprotected override _gotContentType() {}\r\n\r\n\t#calcColumnSpan(columnSpan: number, relevantColumnSpanOptions: number[], layoutColumns: number) {\r\n\t\tif (relevantColumnSpanOptions.length > 0) {\r\n\t\t\t// Correct to a columnSpan option.\r\n\t\t\tconst newColumnSpan =\r\n\t\t\t\tclosestColumnSpanOption(columnSpan, relevantColumnSpanOptions, layoutColumns) ?? layoutColumns;\r\n\t\t\tif (newColumnSpan !== columnSpan) {\r\n\t\t\t\treturn newColumnSpan;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Fallback to the layoutColumns.\r\n\t\t\treturn layoutColumns;\r\n\t\t}\r\n\t\treturn columnSpan;\r\n\t}\r\n\r\n\tasync copyToClipboard() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tconst propertyDatasetContext = await this.getContext(UMB_PROPERTY_DATASET_CONTEXT);\r\n\t\tconst propertyContext = await this.getContext(UMB_PROPERTY_CONTEXT);\r\n\t\tconst clipboardContext = await this.getContext(UMB_CLIPBOARD_PROPERTY_CONTEXT);\r\n\t\tif (!clipboardContext) {\r\n\t\t\tthrow new Error('No clipboard context found');\r\n\t\t}\r\n\r\n\t\tconst workspaceName = propertyDatasetContext?.getName();\r\n\t\tconst propertyLabel = propertyContext?.getLabel();\r\n\t\tconst blockLabel = this.getName();\r\n\r\n\t\tconst entryName = workspaceName\r\n\t\t\t? `${workspaceName} - ${propertyLabel} - ${blockLabel}`\r\n\t\t\t: `${propertyLabel} - ${blockLabel}`;\r\n\r\n\t\tconst layout = this.getLayout();\r\n\t\tif (!layout) {\r\n\t\t\tthrow new Error('No layout found');\r\n\t\t}\r\n\t\tconst content = this.getContent();\r\n\t\tconst settings = this.getSettings();\r\n\t\tconst expose = this.getExpose();\r\n\r\n\t\tconst contentData = content ? [structuredClone(content)] : [];\r\n\t\tconst settingsData = settings ? [structuredClone(settings)] : [];\r\n\t\tconst exposes = expose ? [structuredClone(expose)] : [];\r\n\r\n\t\t// Find sub Blocks and append their data:\r\n\t\tforEachBlockLayoutEntryOf(layout, async (entry) => {\r\n\t\t\tconst content = this._manager!.getContentOf(entry.contentKey);\r\n\t\t\tif (!content) {\r\n\t\t\t\tthrow new Error('No content found');\r\n\t\t\t}\r\n\t\t\tcontentData.push(structuredClone(content));\r\n\r\n\t\t\tif (entry.settingsKey) {\r\n\t\t\t\tconst settings = this._manager!.getSettingsOf(entry.settingsKey);\r\n\t\t\t\tif (settings) {\r\n\t\t\t\t\tsettingsData.push(structuredClone(settings));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst propertyValue: UmbBlockGridValueModel = {\r\n\t\t\tlayout: {\r\n\t\t\t\t[UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS]: layout ? [structuredClone(layout)] : undefined,\r\n\t\t\t},\r\n\t\t\tcontentData,\r\n\t\t\tsettingsData,\r\n\t\t\texpose: exposes,\r\n\t\t};\r\n\r\n\t\tclipboardContext.write({\r\n\t\t\ticon: this.getContentElementTypeIcon(),\r\n\t\t\tname: entryName,\r\n\t\t\tpropertyValue,\r\n\t\t\tpropertyEditorUiAlias: UMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t});\r\n\t}\r\n}\r\n","import type { UmbBlockGridLayoutModel } from '../../types.js';\r\nimport { UMB_BLOCK_GRID } from '../../constants.js';\r\nimport { UmbBlockGridEntryContext } from './block-grid-entry.context.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, css, customElement, property, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\nimport { stringOrStringArrayContains } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbObserveValidationStateController } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbDataPathBlockElementDataQuery } from '@umbraco-cms/backoffice/block';\r\nimport type {\r\n\tManifestBlockEditorCustomView,\r\n\tUmbBlockEditorCustomViewProperties,\r\n} from '@umbraco-cms/backoffice/block-custom-view';\r\nimport { UUIBlinkAnimationValue, UUIBlinkKeyframes } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbExtensionElementInitializer } from '@umbraco-cms/backoffice/extension-api';\r\n\r\n/**\r\n * @element umb-block-grid-entry\r\n */\r\n@customElement('umb-block-grid-entry')\r\nexport class UmbBlockGridEntryElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t//\r\n\t@property({ type: Number, reflect: true })\r\n\tpublic get index(): number | undefined {\r\n\t\treturn this.#context.getIndex();\r\n\t}\r\n\tpublic set index(value: number | undefined) {\r\n\t\tthis.#context.setIndex(value);\r\n\t}\r\n\r\n\t@property({ attribute: false })\r\n\tpublic get contentKey(): string | undefined {\r\n\t\treturn this._contentKey;\r\n\t}\r\n\tpublic set contentKey(key: string | undefined) {\r\n\t\tif (!key || key === this._contentKey) return;\r\n\t\tthis._contentKey = key;\r\n\t\tthis._blockViewProps.contentKey = key;\r\n\t\tthis.setAttribute('data-element-key', key);\r\n\t\tthis.#context.setContentKey(key);\r\n\r\n\t\tnew UmbObserveValidationStateController(\r\n\t\t\tthis,\r\n\t\t\t`$.contentData[${UmbDataPathBlockElementDataQuery({ key: key })}]`,\r\n\t\t\t(hasMessages) => {\r\n\t\t\t\tthis._contentInvalid = hasMessages;\r\n\t\t\t\tthis._blockViewProps.contentInvalid = hasMessages;\r\n\t\t\t},\r\n\t\t\t'observeMessagesForContent',\r\n\t\t);\r\n\t}\r\n\tprivate _contentKey?: string | undefined;\r\n\t//\r\n\r\n\t#context = new UmbBlockGridEntryContext(this);\r\n\t#renderTimeout: number | undefined;\r\n\r\n\t@state()\r\n\tprivate _contentTypeAlias?: string;\r\n\r\n\t@state()\r\n\tprivate _contentTypeName?: string;\r\n\r\n\t@state()\r\n\tprivate _columnSpan?: number;\r\n\r\n\t@state()\r\n\tprivate _rowSpan?: number;\r\n\r\n\t@state()\r\n\tprivate _showContentEdit = false;\r\n\r\n\t@state()\r\n\tprivate _hasSettings = false;\r\n\r\n\t// If _createPath is undefined, its because no blocks are allowed to be created here[NL]\r\n\t@state()\r\n\tprivate _createBeforePath?: string;\r\n\r\n\t@state()\r\n\tprivate _createAfterPath?: string;\r\n\r\n\t@state()\r\n\tprivate _label = '';\r\n\r\n\t@state()\r\n\tprivate _icon?: string;\r\n\r\n\t@state()\r\n\tprivate _exposed?: boolean;\r\n\r\n\t// Unuspported is triggerede if the Block Type is not reconized, it can also be triggerede by the Content Element Type not existing any longer. [NL]\r\n\t@state()\r\n\tprivate _unsupported?: boolean;\r\n\r\n\t@state()\r\n\tprivate _showActions?: boolean;\r\n\r\n\t@state()\r\n\tprivate _workspaceEditContentPath?: string;\r\n\r\n\t@state()\r\n\tprivate _workspaceEditSettingsPath?: string;\r\n\r\n\t@state()\r\n\tprivate _inlineEditingMode?: boolean;\r\n\r\n\t@state()\r\n\tprivate _canScale?: boolean;\r\n\r\n\t@state()\r\n\tprivate _showInlineCreateBefore?: boolean;\r\n\r\n\t@state()\r\n\tprivate _showInlineCreateAfter?: boolean;\r\n\r\n\t@state()\r\n\tprivate _inlineCreateAboveWidth?: string;\r\n\r\n\t// If the Block Type is disallowed in this location then it become a invalid Block Type. Notice not supported blocks are determined via the unsupported property. [NL]\r\n\t@property({ type: Boolean, attribute: 'location-invalid', reflect: true })\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_invalidLocation?: boolean;\r\n\r\n\t// 'content-invalid' attribute is used for styling purpose.\r\n\t@property({ type: Boolean, attribute: 'content-invalid', reflect: true })\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_contentInvalid?: boolean;\r\n\r\n\t// 'settings-invalid' attribute is used for styling purpose.\r\n\t@property({ type: Boolean, attribute: 'settings-invalid', reflect: true })\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_settingsInvalid?: boolean;\r\n\r\n\t@state()\r\n\tprivate _blockViewProps: UmbBlockEditorCustomViewProperties<UmbBlockGridLayoutModel> = {\r\n\t\tcontentKey: undefined!,\r\n\t\tconfig: { showContentEdit: false, showSettingsEdit: false },\r\n\t}; // Set to undefined cause it will be set before we render.\r\n\r\n\t#updateBlockViewProps(incoming: Partial<UmbBlockEditorCustomViewProperties<UmbBlockGridLayoutModel>>) {\r\n\t\tthis._blockViewProps = { ...this._blockViewProps, ...incoming };\r\n\t\tthis.requestUpdate('_blockViewProps');\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _isReadOnly = false;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#init();\r\n\t}\r\n\t#init() {\r\n\t\t// Misc:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.showContentEdit,\r\n\t\t\t(showContentEdit) => {\r\n\t\t\t\tthis._showContentEdit = showContentEdit;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, showContentEdit } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.settingsElementTypeKey,\r\n\t\t\t(key) => {\r\n\t\t\t\tthis._hasSettings = !!key;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, showSettingsEdit: !!key } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.canScale,\r\n\t\t\t(canScale) => {\r\n\t\t\t\tthis._canScale = canScale;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.isAllowed,\r\n\t\t\t(isAllowed) => {\r\n\t\t\t\tthis._invalidLocation = !isAllowed;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.blockType,\r\n\t\t\t(blockType) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ blockType });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(this.#context.index, (index) => this.#updateBlockViewProps({ index }), null);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.label,\r\n\t\t\t(label) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ label });\r\n\t\t\t\tthis._label = label;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeIcon,\r\n\t\t\t(icon) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ icon });\r\n\t\t\t\tthis._icon = icon;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.hasExpose,\r\n\t\t\t(exposed) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ unpublished: !exposed });\r\n\t\t\t\tthis._exposed = exposed;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.unsupported,\r\n\t\t\t(unsupported) => {\r\n\t\t\t\tif (unsupported === undefined) return;\r\n\t\t\t\tthis.#updateBlockViewProps({ unsupported: unsupported });\r\n\t\t\t\tthis._unsupported = unsupported;\r\n\t\t\t\tthis.toggleAttribute('unsupported', unsupported);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.actionsVisibility,\r\n\t\t\t(showActions) => {\r\n\t\t\t\tthis._showActions = showActions;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.inlineEditingMode,\r\n\t\t\t(mode) => {\r\n\t\t\t\tthis._inlineEditingMode = mode;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\t// Data:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.layout,\r\n\t\t\t(layout) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ layout });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.#observeData();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.settingsKey,\r\n\t\t\t(settingsKey) => {\r\n\t\t\t\tthis.removeUmbControllerByAlias('observeMessagesForSettings');\r\n\t\t\t\tif (settingsKey) {\r\n\t\t\t\t\t// Observe settings validation state:\r\n\t\t\t\t\tnew UmbObserveValidationStateController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\t`$.settingsData[${UmbDataPathBlockElementDataQuery({ key: settingsKey })}]`,\r\n\t\t\t\t\t\t(hasMessages) => {\r\n\t\t\t\t\t\t\tthis._settingsInvalid = hasMessages;\r\n\t\t\t\t\t\t\tthis._blockViewProps.settingsInvalid = hasMessages;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeMessagesForSettings',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\t// Paths:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.createBeforePath,\r\n\t\t\t(createPath) => {\r\n\t\t\t\tthis._createBeforePath = createPath;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.createAfterPath,\r\n\t\t\t(createPath) => {\r\n\t\t\t\tthis._createAfterPath = createPath;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.workspaceEditContentPath,\r\n\t\t\t(path) => {\r\n\t\t\t\tthis._workspaceEditContentPath = path;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, editContentPath: path } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.workspaceEditSettingsPath,\r\n\t\t\t(path) => {\r\n\t\t\t\tthis._workspaceEditSettingsPath = path;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, editSettingsPath: path } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.readOnlyGuard.permitted,\r\n\t\t\t(isReadOnly) => (this._isReadOnly = isReadOnly),\r\n\t\t\t'umbReadOnlyObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #observeData() {\r\n\t\tthis.observe(\r\n\t\t\tawait this.#context.contentValues(),\r\n\t\t\t(content) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ content });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tawait this.#context.settingsValues(),\r\n\t\t\t(settings) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ settings });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\t// element styling:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.columnSpan,\r\n\t\t\t(columnSpan) => {\r\n\t\t\t\tthis._columnSpan = columnSpan;\r\n\t\t\t\tthis.setAttribute('data-col-span', columnSpan ? columnSpan.toString() : '');\r\n\t\t\t\tthis.style.setProperty('--umb-block-grid--item-column-span', columnSpan ? columnSpan.toString() : '');\r\n\t\t\t},\r\n\t\t\t'columnSpan',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.rowSpan,\r\n\t\t\t(rowSpan) => {\r\n\t\t\t\tthis._rowSpan = rowSpan;\r\n\t\t\t\tthis.setAttribute('data-row-span', rowSpan ? rowSpan.toString() : '');\r\n\t\t\t\tthis.style.setProperty('--umb-block-grid--item-row-span', rowSpan ? rowSpan.toString() : '');\r\n\t\t\t},\r\n\t\t\t'rowSpan',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeKey,\r\n\t\t\t(contentElementTypeKey) => {\r\n\t\t\t\tif (contentElementTypeKey) {\r\n\t\t\t\t\tthis.setAttribute('data-content-element-type-key', contentElementTypeKey);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'contentElementTypeKey',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeAlias,\r\n\t\t\t(contentElementTypeAlias) => {\r\n\t\t\t\tif (contentElementTypeAlias) {\r\n\t\t\t\t\tthis._contentTypeAlias = contentElementTypeAlias;\r\n\t\t\t\t\tthis.setAttribute('data-content-element-type-alias', contentElementTypeAlias);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'contentElementTypeAlias',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeName,\r\n\t\t\t(contentElementTypeName) => {\r\n\t\t\t\tthis._contentTypeName = contentElementTypeName;\r\n\t\t\t},\r\n\t\t\t'contentElementTypeName',\r\n\t\t);\r\n\r\n\t\tthis.#callUpdateInlineCreateButtons();\r\n\t}\r\n\r\n\tprotected override updated(_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.updated(_changedProperties);\r\n\t\tif (_changedProperties.has('_blockViewProps') || _changedProperties.has('_columnSpan')) {\r\n\t\t\tthis.#callUpdateInlineCreateButtons();\r\n\t\t}\r\n\t}\r\n\r\n\t#expose = () => {\r\n\t\tthis.#context.expose();\r\n\t};\r\n\r\n\t#callUpdateInlineCreateButtons() {\r\n\t\tclearTimeout(this.#renderTimeout);\r\n\t\tthis.#renderTimeout = setTimeout(this.#updateInlineCreateButtons, 100) as unknown as number;\r\n\t}\r\n\r\n\t#updateInlineCreateButtons = () => {\r\n\t\t// TODO: Could we optimize this, so it wont break?, cause currently we trust blindly that parentElement is '.umb-block-grid__layout-container' [NL]\r\n\t\tconst layoutContainer = this.parentElement;\r\n\t\tif (!layoutContainer) return;\r\n\t\tconst layoutContainerRect = layoutContainer.getBoundingClientRect();\r\n\r\n\t\tif (layoutContainerRect.width === 0) {\r\n\t\t\tthis._showInlineCreateBefore = false;\r\n\t\t\tthis._showInlineCreateAfter = false;\r\n\t\t\tthis._inlineCreateAboveWidth = undefined;\r\n\t\t\tthis.#renderTimeout = setTimeout(this.#updateInlineCreateButtons, 100) as unknown as number;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst layoutItemRect = this.getBoundingClientRect();\r\n\t\tif (layoutItemRect.right > layoutContainerRect.right - 5) {\r\n\t\t\tthis._showInlineCreateAfter = false;\r\n\t\t} else {\r\n\t\t\tthis._showInlineCreateAfter = true;\r\n\t\t}\r\n\r\n\t\tif (layoutItemRect.left > layoutContainerRect.left + 5) {\r\n\t\t\tthis._showInlineCreateBefore = false;\r\n\t\t\tthis._inlineCreateAboveWidth = undefined;\r\n\t\t} else {\r\n\t\t\tthis._inlineCreateAboveWidth = getComputedStyle(layoutContainer).width;\r\n\t\t\tthis._showInlineCreateBefore = true;\r\n\t\t}\r\n\t};\r\n\r\n\t#extensionSlotFilterMethod = (manifest: ManifestBlockEditorCustomView) => {\r\n\t\tif (!this._contentTypeAlias) {\r\n\t\t\t// accept no extensions if we don't have a content type alias\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// We do have _contentTypeAlias at this stage, cause we do use the filter method in the extension slot which first gets rendered when we have the _contentTypeAlias. [NL]\r\n\t\tif (\r\n\t\t\tmanifest.forContentTypeAlias &&\r\n\t\t\t!stringOrStringArrayContains(manifest.forContentTypeAlias, this._contentTypeAlias!)\r\n\t\t) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (manifest.forBlockEditor && !stringOrStringArrayContains(manifest.forBlockEditor, UMB_BLOCK_GRID)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\t#extensionSlotRenderMethod = (ext: UmbExtensionElementInitializer<ManifestBlockEditorCustomView>) => {\r\n\t\tif (ext.component) {\r\n\t\t\text.component.classList.add('umb-block-grid__block--view');\r\n\t\t\text.component.setAttribute('part', 'component');\r\n\t\t}\r\n\t\tif (this._exposed) {\r\n\t\t\treturn ext.component;\r\n\t\t} else {\r\n\t\t\treturn html`<div>\r\n\t\t\t\t${ext.component}\r\n\t\t\t\t<umb-block-overlay-expose-button\r\n\t\t\t\t\t.contentTypeName=${this._contentTypeName}\r\n\t\t\t\t\t@click=${this.#expose}></umb-block-overlay-expose-button>\r\n\t\t\t</div>`;\r\n\t\t}\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn this.contentKey && (this._contentTypeAlias || this._unsupported)\r\n\t\t\t? html`\r\n\t\t\t\t\t${this.#renderCreateBeforeInlineButton()}\r\n\t\t\t\t\t<div class=\"umb-block-grid__block\" part=\"umb-block-grid__block\">\r\n\t\t\t\t\t\t<umb-extension-slot\r\n\t\t\t\t\t\t\t.filter=${this.#extensionSlotFilterMethod}\r\n\t\t\t\t\t\t\t.renderMethod=${this.#extensionSlotRenderMethod}\r\n\t\t\t\t\t\t\t.fallbackRenderMethod=${this.#renderBuiltinBlockView}\r\n\t\t\t\t\t\t\t.props=${this._blockViewProps}\r\n\t\t\t\t\t\t\tdefault-element=${this._inlineEditingMode ? 'umb-block-grid-block-inline' : 'umb-block-grid-block'}\r\n\t\t\t\t\t\t\ttype=\"blockEditorCustomView\"\r\n\t\t\t\t\t\t\tsingle></umb-extension-slot>\r\n\t\t\t\t\t\t${this.#renderActionBar()}\r\n\t\t\t\t\t\t${!this._showContentEdit && this._contentInvalid\r\n\t\t\t\t\t\t\t? html`<uui-badge attention color=\"invalid\" label=\"Invalid content\">!</uui-badge>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t${this._invalidLocation\r\n\t\t\t\t\t\t\t? html`<uui-tag id=\"invalidLocation\" color=\"danger\"\r\n\t\t\t\t\t\t\t\t\t><umb-localize key=\"blockEditor_invalidDropPosition\" .args=${[this._label]}></umb-localize\r\n\t\t\t\t\t\t\t\t></uui-tag>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t${this._canScale\r\n\t\t\t\t\t\t\t? html` <umb-block-scale-handler\r\n\t\t\t\t\t\t\t\t\t@mousedown=${(e: MouseEvent) => this.#context.scaleManager.onScaleMouseDown(e)}>\r\n\t\t\t\t\t\t\t\t\t${this._columnSpan}x${this._rowSpan}\r\n\t\t\t\t\t\t\t\t</umb-block-scale-handler>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#renderCreateAfterInlineButton()}\r\n\t\t\t\t`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderBuiltinBlockView = () => {\r\n\t\tif (this._unsupported) {\r\n\t\t\treturn this.#renderUnsupportedBlock();\r\n\t\t}\r\n\t\tif (this._inlineEditingMode) {\r\n\t\t\treturn this.renderInlineBlock();\r\n\t\t}\r\n\t\treturn this.#renderRefBlock();\r\n\t};\r\n\r\n\t#renderUnsupportedBlock() {\r\n\t\treturn html`<umb-block-grid-block-unsupported\r\n\t\t\tclass=\"umb-block-grid__block--view\"\r\n\t\t\t.config=${this._blockViewProps.config}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}></umb-block-grid-block-unsupported>`;\r\n\t\t//TODO: investigate if we should have ${umbDestroyOnDisconnect()} here. Note how it works for drag n' drop in grid between areas and areas-root\r\n\t}\r\n\r\n\trenderInlineBlock() {\r\n\t\treturn html`<umb-block-grid-block-inline\r\n\t\t\tclass=\"umb-block-grid__block--view\"\r\n\t\t\t.label=${this._label}\r\n\t\t\t.icon=${this._icon}\r\n\t\t\t.index=${this._blockViewProps.index}\r\n\t\t\t.unpublished=${!this._exposed}\r\n\t\t\t.config=${this._blockViewProps.config}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}></umb-block-grid-block-inline>`;\r\n\t\t//TODO: investigate if we should have ${umbDestroyOnDisconnect()} here. Note how it works for drag n' drop in grid between areas and areas-root\r\n\t}\r\n\r\n\t#renderRefBlock() {\r\n\t\treturn html`<umb-block-grid-block\r\n\t\t\tclass=\"umb-block-grid__block--view\"\r\n\t\t\t.label=${this._label}\r\n\t\t\t.icon=${this._icon}\r\n\t\t\t.index=${this._blockViewProps.index}\r\n\t\t\t.unpublished=${!this._exposed}\r\n\t\t\t.config=${this._blockViewProps.config}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}></umb-block-grid-block>`;\r\n\t\t//TODO: investigate if we should have ${umbDestroyOnDisconnect()} here. Note how it works for drag n' drop in grid between areas and areas-root\r\n\t}\r\n\r\n\t#renderCreateBeforeInlineButton() {\r\n\t\tif (this._isReadOnly) return nothing;\r\n\t\tif (!this._createBeforePath) return nothing;\r\n\t\tif (!this._showInlineCreateBefore) return nothing;\r\n\r\n\t\treturn html`<uui-button-inline-create\r\n\t\t\thref=${this._createBeforePath}\r\n\t\t\tlabel=${this.localize.term('blockEditor_addBlock')}\r\n\t\t\tstyle=${this._inlineCreateAboveWidth\r\n\t\t\t\t? `width: ${this._inlineCreateAboveWidth}`\r\n\t\t\t\t: ''}></uui-button-inline-create>`;\r\n\t}\r\n\r\n\t#renderCreateAfterInlineButton() {\r\n\t\tif (this._isReadOnly) return nothing;\r\n\t\tif (!this._createAfterPath) return nothing;\r\n\t\tif (!this._showInlineCreateAfter) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button-inline-create\r\n\t\t\t\tvertical\r\n\t\t\t\tlabel=${this.localize.term('blockEditor_addBlock')}\r\n\t\t\t\thref=${this._createAfterPath}></uui-button-inline-create>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderActionBar() {\r\n\t\treturn this._showActions\r\n\t\t\t? html`\r\n\t\t\t\t\t<uui-action-bar>\r\n\t\t\t\t\t\t${this.#renderEditAction()} ${this.#renderEditSettingsAction()} ${this.#renderCopyToClipboardAction()}\r\n\t\t\t\t\t\t${this.#renderDeleteAction()}</uui-action-bar\r\n\t\t\t\t\t>\r\n\t\t\t\t`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderEditAction() {\r\n\t\treturn this._showContentEdit && this._workspaceEditContentPath\r\n\t\t\t? html`<uui-button\r\n\t\t\t\t\tlabel=\"edit\"\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tcolor=${this._contentInvalid ? 'danger' : ''}\r\n\t\t\t\t\thref=${this._workspaceEditContentPath}>\r\n\t\t\t\t\t<uui-icon name=${this._exposed === false ? 'icon-add' : 'icon-edit'}></uui-icon>\r\n\t\t\t\t\t${this._contentInvalid\r\n\t\t\t\t\t\t? html`<uui-badge attention color=\"invalid\" label=\"Invalid content\">!</uui-badge>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</uui-button>`\r\n\t\t\t: this._showContentEdit === false && this._exposed === false\r\n\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\t@click=${this.#expose}\r\n\t\t\t\t\t\tlabel=${this.localize.term('blockEditor_createThisFor', this._contentTypeName)}\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t><uui-icon name=\"icon-add\"></uui-icon\r\n\t\t\t\t\t></uui-button>`\r\n\t\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderEditSettingsAction() {\r\n\t\treturn html`\r\n\t\t\t${this._hasSettings && this._workspaceEditSettingsPath\r\n\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\tlabel=\"Edit settings\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tcolor=${this._settingsInvalid ? 'invalid' : ''}\r\n\t\t\t\t\t\thref=${this._workspaceEditSettingsPath}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-settings\"></uui-icon>\r\n\t\t\t\t\t\t${this._settingsInvalid\r\n\t\t\t\t\t\t\t? html`<uui-badge attention color=\"invalid\" label=\"Invalid settings\">!</uui-badge>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</uui-button>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCopyToClipboardAction() {\r\n\t\treturn html`<uui-button label=\"Copy to clipboard\" look=\"secondary\" @click=${() => this.#context.copyToClipboard()}>\r\n\t\t\t<uui-icon name=\"icon-clipboard-copy\"></uui-icon>\r\n\t\t</uui-button>`;\r\n\t}\r\n\r\n\t#renderDeleteAction() {\r\n\t\tif (this._isReadOnly) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-button label=\"delete\" look=\"secondary\" @click=${() => this.#context.requestDelete()}>\r\n\t\t\t\t<uui-icon name=\"icon-remove\"></uui-icon>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUUIBlinkKeyframes,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\t--umb-block-grid-entry-actions-opacity: 0;\r\n\t\t\t}\r\n\r\n\t\t\t:host([settings-invalid]),\r\n\t\t\t:host([content-invalid]),\r\n\t\t\t:host(:hover),\r\n\t\t\t:host(:focus-within) {\r\n\t\t\t\t--umb-block-grid-entry-actions-opacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t:host::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder: 1px solid transparent;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\r\n\t\t\t\ttransition: border-color 240ms ease-in;\r\n\t\t\t}\r\n\r\n\t\t\t:host([location-invalid])::after,\r\n\t\t\t:host([settings-invalid])::after,\r\n\t\t\t:host([content-invalid])::after {\r\n\t\t\t\tborder-color: var(--uui-color-invalid);\r\n\t\t\t}\r\n\r\n\t\t\tumb-extension-slot::part(component) {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tz-index: 0;\r\n\t\t\t}\r\n\r\n\t\t\t#invalidLocation {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: -1em;\r\n\t\t\t\tleft: var(--uui-size-space-2);\r\n\t\t\t\tz-index: 2;\r\n\t\t\t}\r\n\r\n\t\t\tuui-action-bar {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: var(--uui-size-2);\r\n\t\t\t\tright: var(--uui-size-2);\r\n\t\t\t\topacity: var(--umb-block-grid-entry-actions-opacity, 0);\r\n\t\t\t\ttransition: opacity 120ms;\r\n\t\t\t}\r\n\t\t\tuui-button-inline-create {\r\n\t\t\t\ttop: 0px;\r\n\t\t\t\tposition: absolute;\r\n\r\n\t\t\t\t--umb-block-grid__block--inline-create-button-display--condition: var(--umb-block-grid--dragging-mode) none;\r\n\t\t\t\tdisplay: var(--umb-block-grid__block--inline-create-button-display--condition);\r\n\t\t\t}\r\n\t\t\tuui-button-inline-create:not([vertical]) {\r\n\t\t\t\tleft: 0;\r\n\t\t\t\twidth: var(--umb-block-grid-editor--inline-create-width, 100%);\r\n\t\t\t}\r\n\t\t\t:host(:not([index='0'])) uui-button-inline-create:not([vertical]) {\r\n\t\t\t\ttop: calc(var(--umb-block-grid--row-gap, 0px) * -0.5);\r\n\t\t\t}\r\n\t\t\tuui-button-inline-create[vertical] {\r\n\t\t\t\tright: calc(1px - (var(--umb-block-grid--column-gap, 0px) * 0.5));\r\n\t\t\t}\r\n\r\n\t\t\t.umb-block-grid__block {\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t:host(:hover):not(:drop)::after {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tborder-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\tbox-shadow:\r\n\t\t\t\t\t0 0 0 1px rgba(255, 255, 255, 0.7),\r\n\t\t\t\t\tinset 0 0 0 1px rgba(255, 255, 255, 0.7);\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder])::after {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tborder-width: 2px;\r\n\t\t\t\tborder-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\tanimation: ${UUIBlinkAnimationValue};\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder])::before {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\topacity: 0.12;\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder]) .umb-block-grid__block {\r\n\t\t\t\ttransition: opacity 50ms 16ms;\r\n\t\t\t\topacity: 0;\r\n\t\t\t}\r\n\r\n\t\t\tuui-badge {\r\n\t\t\t\tz-index: 2;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridEntryElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-entry': UmbBlockGridEntryElement;\r\n\t}\r\n}\r\n","import { UUIRefNodeElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { css, customElement, html } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * @element umb-ref-grid-block\r\n */\r\n@customElement('umb-ref-grid-block')\r\nexport class UmbRefGridBlockElement extends UUIRefNodeElement {\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${super.render()}\r\n\t\t\t<div class=\"break\"></div>\r\n\t\t\t<slot name=\"areas\"></slot>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\t...UUIRefNodeElement.styles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tmin-width: 20px; /* Set to something, to overwrite UUI min width. */\r\n\t\t\t\theight: 100%; /* Help to fill out the whole layout entry. */\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tflex-flow: row wrap;\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.break {\r\n\t\t\t\tflex-basis: 100%;\r\n\t\t\t\theight: 0;\r\n\t\t\t}\r\n\r\n\t\t\t#open-part {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tpadding: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) #open-part {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbRefGridBlockElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-ref-grid-block': UmbRefGridBlockElement;\r\n\t}\r\n}\r\n","import { UmbBlockGridManagerContext } from '../../block-grid-manager/index.js';\r\nimport type { UmbBlockGridTypeModel, UmbBlockGridValueModel } from '../../types.js';\r\nimport { UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS } from './constants.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport {\r\n\thtml,\r\n\tcustomElement,\r\n\tproperty,\r\n\tstate,\r\n\tcss,\r\n\ttype PropertyValueMap,\r\n\tref,\r\n\tnothing,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type {\r\n\tUmbPropertyEditorUiElement,\r\n\tUmbPropertyEditorConfigCollection,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\nimport { jsonStringComparison, observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UMB_PROPERTY_CONTEXT, UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport { UmbFormControlMixin, UmbValidationContext } from '@umbraco-cms/backoffice/validation';\r\nimport type { UmbBlockTypeGroup } from '@umbraco-cms/backoffice/block-type';\r\nimport { debounceTime } from '@umbraco-cms/backoffice/external/rxjs';\r\n\r\n// TODO: consider moving the components to the property editor folder as they are only used here\r\nimport '../../local-components.js';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\n\r\n/**\r\n * @element umb-property-editor-ui-block-grid\r\n */\r\n@customElement('umb-property-editor-ui-block-grid')\r\nexport class UmbPropertyEditorUIBlockGridElement\r\n\textends UmbFormControlMixin<UmbBlockGridValueModel, typeof UmbLitElement>(UmbLitElement)\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#validationContext = new UmbValidationContext(this);\r\n\t#managerContext = new UmbBlockGridManagerContext(this);\r\n\t//\r\n\r\n\t#lastValue: UmbBlockGridValueModel | undefined = undefined;\r\n\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tif (!config) return;\r\n\r\n\t\tconst blocks = config.getValueByAlias<Array<UmbBlockGridTypeModel>>('blocks') ?? [];\r\n\t\tthis.#managerContext.setBlockTypes(blocks);\r\n\r\n\t\tconst blockGroups = config.getValueByAlias<Array<UmbBlockTypeGroup>>('blockGroups') ?? [];\r\n\t\tthis.#managerContext.setBlockGroups(blockGroups);\r\n\r\n\t\tconst useInlineEditingAsDefault = config.getValueByAlias<boolean>('useInlineEditingAsDefault');\r\n\t\tthis.#managerContext.setInlineEditingMode(useInlineEditingAsDefault);\r\n\r\n\t\tthis.style.maxWidth = config.getValueByAlias<string>('maxPropertyWidth') ?? '';\r\n\r\n\t\t//config.useLiveEditing, is covered by the EditorConfiguration of context. [NL]\r\n\t\tthis.#managerContext.setEditorConfiguration(config);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @default\r\n\t */\r\n\tpublic set readonly(value) {\r\n\t\tthis.#readonly = value;\r\n\r\n\t\tif (this.#readonly) {\r\n\t\t\tthis.#managerContext.readOnlyState.fallbackToPermitted();\r\n\t\t} else {\r\n\t\t\tthis.#managerContext.readOnlyState.fallbackToNotPermitted();\r\n\t\t}\r\n\t}\r\n\tpublic get readonly() {\r\n\t\treturn this.#readonly;\r\n\t}\r\n\t#readonly = false;\r\n\r\n\t@state()\r\n\tprivate _layoutColumns?: number;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic override set value(value: UmbBlockGridValueModel | undefined) {\r\n\t\tthis.#lastValue = value;\r\n\r\n\t\tif (!value) {\r\n\t\t\tsuper.value = undefined;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst buildUpValue: Partial<UmbBlockGridValueModel> = value ? { ...value } : {};\r\n\t\tbuildUpValue.layout ??= {};\r\n\t\tbuildUpValue.contentData ??= [];\r\n\t\tbuildUpValue.settingsData ??= [];\r\n\t\tbuildUpValue.expose ??= [];\r\n\t\tsuper.value = buildUpValue as UmbBlockGridValueModel;\r\n\r\n\t\tthis.#managerContext.setLayouts(super.value.layout[UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS] ?? []);\r\n\t\tthis.#managerContext.setContents(super.value.contentData);\r\n\t\tthis.#managerContext.setSettings(super.value.settingsData);\r\n\t\tthis.#managerContext.setExposes(super.value.expose);\r\n\t}\r\n\tpublic override get value(): UmbBlockGridValueModel | undefined {\r\n\t\treturn super.value;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _notSupportedVariantSetting?: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (context) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tobserveMultiple([\r\n\t\t\t\t\t\tthis.#managerContext.blockTypes,\r\n\t\t\t\t\t\tcontext.structure.variesByCulture,\r\n\t\t\t\t\t\tcontext.structure.variesBySegment,\r\n\t\t\t\t\t]),\r\n\t\t\t\t\tasync ([blockTypes, variesByCulture, variesBySegment]) => {\r\n\t\t\t\t\t\tif (blockTypes.length > 0 && (variesByCulture === false || variesBySegment === false)) {\r\n\t\t\t\t\t\t\t// check if any of the Blocks varyByCulture or Segment and then display a warning.\r\n\t\t\t\t\t\t\tconst promises = await Promise.all(\r\n\t\t\t\t\t\t\t\tblockTypes.map(async (blockType) => {\r\n\t\t\t\t\t\t\t\t\tconst elementType = blockType.contentElementTypeKey;\r\n\t\t\t\t\t\t\t\t\tawait this.#managerContext.contentTypesLoaded;\r\n\t\t\t\t\t\t\t\t\tconst structure = await this.#managerContext.getStructure(elementType);\r\n\t\t\t\t\t\t\t\t\tif (variesByCulture === false && structure?.getVariesByCulture() === true) {\r\n\t\t\t\t\t\t\t\t\t\t// If block varies by culture but document does not.\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t} else if (variesBySegment === false && structure?.getVariesBySegment() === true) {\r\n\t\t\t\t\t\t\t\t\t\t// If block varies by segment but document does not.\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tthis._notSupportedVariantSetting = promises.filter((x) => x === true).length > 0;\r\n\r\n\t\t\t\t\t\t\tif (this._notSupportedVariantSetting) {\r\n\t\t\t\t\t\t\t\tthis.#validationContext.messages.addMessage(\r\n\t\t\t\t\t\t\t\t\t'config',\r\n\t\t\t\t\t\t\t\t\t'$',\r\n\t\t\t\t\t\t\t\t\t'#blockEditor_blockVariantConfigurationNotSupported',\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeBlockTypes',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.removeUmbControllerByAlias('observeBlockTypes');\r\n\t\t\t}\r\n\t\t}).passContextAliasMatches();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.dataPath,\r\n\t\t\t\t(dataPath) => {\r\n\t\t\t\t\tif (dataPath) {\r\n\t\t\t\t\t\t// Set the data path for the local validation context:\r\n\t\t\t\t\t\tthis.#validationContext.setDataPath(dataPath);\r\n\t\t\t\t\t\tthis.#validationContext.autoReport();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeDataPath',\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\t// TODO: Prevent initial notification from these observes\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (propertyContext) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tobserveMultiple([\r\n\t\t\t\t\tthis.#managerContext.layouts,\r\n\t\t\t\t\tthis.#managerContext.contents,\r\n\t\t\t\t\tthis.#managerContext.settings,\r\n\t\t\t\t\tthis.#managerContext.exposes,\r\n\t\t\t\t]).pipe(debounceTime(20)),\r\n\t\t\t\t([layouts, contents, settings, exposes]) => {\r\n\t\t\t\t\tif (layouts.length === 0) {\r\n\t\t\t\t\t\tif (this.value === undefined) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsuper.value = undefined;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst newValue = {\r\n\t\t\t\t\t\t\t...super.value,\r\n\t\t\t\t\t\t\tlayout: { [UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS]: layouts },\r\n\t\t\t\t\t\t\tcontentData: contents,\r\n\t\t\t\t\t\t\tsettingsData: settings,\r\n\t\t\t\t\t\t\texpose: exposes,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (jsonStringComparison(this.value, newValue)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsuper.value = newValue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// If we don't have a value set from the outside or an internal value, we don't want to set the value.\r\n\t\t\t\t\t// This is added to prevent the block grid from setting an empty value on startup.\r\n\t\t\t\t\tif (this.#lastValue === undefined && super.value === undefined) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpropertyContext?.setValue(super.value);\r\n\t\t\t\t},\r\n\t\t\t\t'motherObserver',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tpropertyContext?.alias,\r\n\t\t\t\t(alias) => {\r\n\t\t\t\t\tthis.#managerContext.setPropertyAlias(alias);\r\n\t\t\t\t},\r\n\t\t\t\t'observePropertyAlias',\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, (context) => {\r\n\t\t\tthis.#managerContext.setVariantId(context?.getVariantId());\r\n\t\t});\r\n\t}\r\n\r\n\tprotected override firstUpdated(_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\r\n\t\tthis.observe(this.#managerContext.gridColumns, (gridColumns) => {\r\n\t\t\tif (gridColumns) {\r\n\t\t\t\tthis._layoutColumns = gridColumns;\r\n\t\t\t\tthis.style.setProperty('--umb-block-grid--grid-columns', gridColumns.toString());\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t#currentEntriesElement?: Element;\r\n\t#gotRootEntriesElement(element: Element | undefined): void {\r\n\t\tif (this.#currentEntriesElement === element) return;\r\n\t\tif (this.#currentEntriesElement) {\r\n\t\t\tthis.removeFormControlElement(this.#currentEntriesElement as any);\r\n\t\t}\r\n\t\tthis.#currentEntriesElement = element;\r\n\t\tif (element) {\r\n\t\t\tthis.addFormControlElement(element as any);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._notSupportedVariantSetting) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\t\treturn html` <umb-block-grid-entries\r\n\t\t\t${ref(this.#gotRootEntriesElement)}\r\n\t\t\t.areaKey=${null}\r\n\t\t\t.layoutColumns=${this._layoutColumns}></umb-block-grid-entries>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: 1px;\r\n\t\t\t}\r\n\t\t\t> div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: stretch;\r\n\t\t\t}\r\n\r\n\t\t\tuui-button-group {\r\n\t\t\t\tpadding-top: 1px;\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: 1fr auto;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbPropertyEditorUIBlockGridElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-block-grid': UmbPropertyEditorUIBlockGridElement;\r\n\t}\r\n}\r\n"],"names":["UmbBlockGridManagerContext","UmbBlockManagerContext","host","#inlineEditingMode","UmbBooleanState","#blockGroups","UmbArrayState","x","layoutStylesheet","UMB_BLOCK_GRID_DEFAULT_LAYOUT_STYLESHEET","transformServerPathToClientPath","#serverUrl","value","#initAppUrl","UMB_SERVER_CONTEXT","instance","inlineEditingMode","configs","blockGroups","unique","group","contentElementTypeKey","partialLayoutEntry","_originData","originData","#appendLayoutEntryToArea","insert","entries","parentId","areaKey","index","i","currentEntry","areas","pushAtToUniqueArray","appendToFrozenArray","y","correctedAreaItems","area","z","layoutEntry","content","settings","layoutEntries","UmbBlockGridAreasContainerElement","UmbLitElement","UMB_BLOCK_GRID_ENTRY_CONTEXT","context","areaGridColumns","UMB_BLOCK_GRID_MANAGER_CONTEXT","manager","stylesheet","html","repeat","css","__decorateClass","state","customElement","_blockContext","_workspaceContext","_variantId","_contentKey","_parentUnique","_areaKey","_UmbBlockGridBlockInlineElement_instances","load_fn","generatePropertyDataPath_fn","_expose","renderBlockInfo_fn","renderInside_fn","apiArgsCreator","manifest","UmbBlockGridBlockInlineElement","__privateAdd","__privateGet","blockContext","__privateSet","contentKey","__privateMethod","UMB_BLOCK_GRID_ENTRIES_CONTEXT","entriesContext","UmbExtensionApiInitializer","umbExtensionsRegistry","UMB_BLOCK_WORKSPACE_ALIAS","permitted","ctrl","contentTypeProperties","name","variantId","culture","languageRepository","UmbLanguageItemRepository","data","UmbExtensionsApiInitializer","property","UmbDataPathPropertyValueQuery","blockValue","when","UmbTextStyles","_UmbBlockGridBlockUnsupportedElement_instances","UmbBlockGridBlockUnsupportedElement","UmbBlockGridBlockElement","UmbBlockGridEntriesContext","UmbBlockEntriesContext","#pathAddendum","UmbRoutePathAddendumContext","#layoutColumns","UmbNumberState","#areaType","UmbObjectState","#rangeLimits","#allowedBlockTypes","#hasTypeLimits","blockGridEntry","#parentEntry","#gotBlockParentEntry","UmbModalRouteRegistrationController","UMB_BLOCK_CATALOGUE_MODAL","routingInfo","clipboardContext","UMB_CLIPBOARD_PROPERTY_CONTEXT","pasteTranslatorManifests","UMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS","propertyContext","UMB_PROPERTY_CONTEXT","config","valueResolver","UmbClipboardPastePropertyValueTranslatorValueResolver","clipboardEntryDetail","pasteTranslator","#clipboardEntriesFilter","#areaKey","#parentUnique","created","propertyValues","routeBuilder","UMB_BLOCK_GRID_WORKSPACE_MODAL","newPath","nameState","UmbStringState","#gotAreaKey","columns","propertyValue","allowedElementTypeKeys","#retrieveAllowedElementTypes","rootContentKeys","block","#setupAllowedBlockTypes","#setupRangeLimits","layouts","hostEl","areaType","#setupAllowedBlockTypesLimits","min","max","contentTypeKey","types","layout","forEachBlockLayoutEntryOf","entry","UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS","parentUnique","localOriginData","permission","blockType","v","a","#invalidBlockTypeLimits","rule","minAllowed","maxAllowed","groupElementTypeKeys","groupAmount","amount","#invalidBlockTypeConfigurations","allowedBlocks","allowedKeys","isBad","_sorter","_context","_controlValidator","_typeLimitValidator","_rangeUnderflowValidator","_rangeOverflowValidator","_UmbBlockGridEntriesElement_instances","setupRangeValidation_fn","setupBlockTypeLimitValidation_fn","renderCreateButtonGroup_fn","renderCreateButton_fn","renderPasteButton_fn","resolvePlacementAsBlockGrid","args","isWithinRect","approvedContainerComputedStyles","gridColumnGap","gridColumnNumber","foundElColumns","currentElementColumns","approvedContainerGridColumns","n","list","amountOfColumnsInWeightMap","amountOfUnknownColumns","accumulatedValue","getAccumulatedValueOfIndex","missingColumnWidth","offsetPlacement","relatedStartX","getInterpolatedIndexOfPositionInWeightMap","SORTER_CONFIG","element","modelEntry","UmbBlockGridEntriesElement","UmbFormControlMixin","UmbSorterController","model","item","length","firstAllowedName","rangeLimits","hasTypeLimits","isReadOnly","label","UmbFormControlValidator","nothing","rangeLimit","invalidRule","invalids","UmbBlockGridEntryContext","UmbBlockEntryContext","#relevantColumnSpanOptions","#canScale","#isAllowed","#areaGridColumns","mergeObservables","b","UmbBlockGridScaleManager","frozenValue","columnSpan","layoutColumns","#calcColumnSpan","layoutValue","rowSpan","minMax","#gotEntriesAndManager","key","isAllowed","observeMultiple","minMaxRowSpan","columnSpanOptions","relevantColumnSpanOptions","hasRelevantColumnSpanOptions","hasRowSpanOptions","canScale","areaTypeGridColumns","layoutAreas","newColumnSpan","newRowSpan","closestColumnSpanOption","propertyDatasetContext","UMB_PROPERTY_DATASET_CONTEXT","workspaceName","propertyLabel","blockLabel","entryName","expose","contentData","settingsData","exposes","_renderTimeout","_UmbBlockGridEntryElement_instances","updateBlockViewProps_fn","init_fn","observeData_fn","callUpdateInlineCreateButtons_fn","_updateInlineCreateButtons","_extensionSlotFilterMethod","_extensionSlotRenderMethod","_renderBuiltinBlockView","renderUnsupportedBlock_fn","renderRefBlock_fn","renderCreateBeforeInlineButton_fn","renderCreateAfterInlineButton_fn","renderActionBar_fn","renderEditAction_fn","renderEditSettingsAction_fn","renderCopyToClipboardAction_fn","renderDeleteAction_fn","UmbBlockGridEntryElement","layoutContainer","layoutContainerRect","layoutItemRect","stringOrStringArrayContains","UMB_BLOCK_GRID","ext","UmbObserveValidationStateController","UmbDataPathBlockElementDataQuery","hasMessages","contentElementTypeAlias","contentElementTypeName","_changedProperties","e","incoming","showContentEdit","icon","exposed","unsupported","showActions","mode","settingsKey","createPath","path","UUIBlinkKeyframes","UUIBlinkAnimationValue","UmbRefGridBlockElement","UUIRefNodeElement","_validationContext","_managerContext","_lastValue","_readonly","_currentEntriesElement","_UmbPropertyEditorUIBlockGridElement_instances","gotRootEntriesElement_fn","UmbPropertyEditorUIBlockGridElement","UmbValidationContext","UMB_CONTENT_WORKSPACE_CONTEXT","blockTypes","variesByCulture","variesBySegment","promises","elementType","structure","dataPath","debounceTime","contents","newValue","jsonStringComparison","alias","blocks","useInlineEditingAsDefault","buildUpValue","gridColumns","ref","UmbPropertyEditorUIBlockGridElement$1"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAqBO,MAAMA,WAEHC,GAAwG;AAAA,EA+DjH,YAAYC,GAAyB;AACpC,UAAMA,CAAI,GA9DX,KAAAC,KAAqB,IAAIC,GAAgB,MAAS,GAClD,KAAS,oBAAoB,KAAKD,GAAmB,aAAA,GAarD,KAAAE,KAAe,IAAIC,GAAwC,CAAA,GAAI,CAACC,MAAMA,EAAE,GAAG,GAC3E,KAAgB,cAAc,KAAKF,GAAa,aAAA,GAEhD,KAAA,mBAAmB,KAAK,qBAAqB,iBAAiB,CAACE,MAAM;AACpE,UAAI,CAACA,EAAG;AACR,YAAMC,IAAmBD,EAAE,gBAAwB,kBAAkB;AACrE,UAAI,CAACC,EAAkB,QAAOC;AAE9B,UAAID;AAGH,eADY,IAAI,IAAIE,GAAgCF,CAAgB,GAAG,KAAKG,EAAU,EAC3E;AAAA,IAGb,CAAC,GACD,KAAA,cAAc,KAAK,qBAAqB,iBAAiB,CAACJ,MAAM;AAC/D,YAAMK,IAAQL,GAAG,gBAAgB,aAAa;AAC9C,aAAO,SAASK,KAASA,MAAU,KAAKA,IAAQ,IAAI;AAAA,IACrD,CAAC,GAgCA,KAAKC,KAAc,KAAK,eAAeC,IAAoB,CAACC,MAAa;AACxE,WAAKJ,KAAaI,GAAU,aAAA;AAAA,IAC7B,CAAC,EAAE,UAAU,EAAE,gBAAgB,IAAM;AAAA,EACtC;AAAA,EAnEAZ;AAAA,EAGA,qBAAqBa,GAAwC;AAC5D,SAAKb,GAAmB,SAASa,KAAqB,EAAK;AAAA,EAC5D;AAAA,EACA,uBAA4C;AAC3C,WAAO,KAAKb,GAAmB,SAAA;AAAA,EAChC;AAAA,EAEAU;AAAA,EAEAF;AAAA,EAEAN;AAAA,EAoBA,gBAAgB;AACf,WAAO,KAAK,qBAAqB,SAAA,GAAY,gBAAyC,iBAAiB,GAAG,OAAO;AAAA,EAClH;AAAA,EAEA,gBAAgB;AACf,WACC,KAAK,qBAAqB,SAAA,GAAY,gBAAyC,iBAAiB,GAAG,OAAO;AAAA,EAE5G;AAAA,EAES,uBAAuBY,GAA4C;AAC3E,SAAKJ,GAAY,KAAK,MAAM;AAE3B,YAAM,uBAAuBI,CAAO;AAAA,IACrC,CAAC;AAAA,EACF;AAAA,EAEA,eAAeC,GAAuC;AACrD,SAAKb,GAAa,SAASa,CAAW;AAAA,EACvC;AAAA,EACA,iBAAiB;AAChB,WAAO,KAAKb,GAAa;AAAA,EAC1B;AAAA,EACA,kBAAkBc,GAAgB;AACjC,WAAO,KAAKd,GAAa,SAAA,EAAW,KAAK,CAACe,MAAUA,EAAM,QAAQD,CAAM,GAAG;AAAA,EAC5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeA,OAECE,GAEAC,GAGAC,GACQ;AACR,UAAM,IAAI,MAAM,0CAA0C;AAAA,EAC3D;AAAA,EAEA,MAAM,kBACLF,GACAC,GAGAE,GACC;AACD,WAAO,MAAM,MAAM,iBAAiBH,GAAuBC,CAAkB;AAAA,EAC9E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBAG,GACCC,GACAC,GACAC,GACAC,GACAC,GAC6C;AAE7C,QAAIC,IAAYJ,EAAQ;AACxB,WAAOI,OAAK;AACX,YAAMC,IAAeL,EAAQI,CAAC;AAE9B,UAAIC,EAAa,eAAeJ,GAAU;AAEzC,cAAMK,IACLD,EAAa,OAAO;AAAA,UAAI,CAACzB,MACxBA,EAAE,QAAQsB,IACP;AAAA,YACA,GAAGtB;AAAA,YACH,OAAO2B,GAAoB,CAAC,GAAG3B,EAAE,KAAK,GAAGmB,GAAQ,CAACnB,MAAMA,EAAE,eAAemB,EAAO,YAAYI,CAAK;AAAA,UAAA,IAEjGvB;AAAA,QAAA,KACC,CAAA;AACN,eAAO4B;AAAA,UACNR;AAAA,UACA;AAAA,YACC,GAAGK;AAAA,YACH,OAAAC;AAAA,UAAA;AAAA,UAED,CAAC1B,MAAMA,EAAE,eAAeyB,EAAa;AAAA,QAAA;AAAA,MAEvC;AAEA,UAAIA,EAAa,OAAO;AACvB,YAAII,IAAYJ,EAAa,MAAM;AACnC,eAAOI,OAAK;AAEX,gBAAMC,IAAqB,KAAKZ;AAAA,YAC/BC;AAAA,YACAM,EAAa,MAAMI,CAAC,EAAE;AAAA,YACtBR;AAAA,YACAC;AAAA,YACAC;AAAA,UAAA;AAED,cAAIO,GAAoB;AAEvB,kBAAMC,IAAON,EAAa,MAAMI,CAAC;AACjC,mBAAOD;AAAA,cACNR;AAAA,cACA;AAAA,gBACC,GAAGK;AAAA,gBACH,OAAOG;AAAA,kBACNH,EAAa;AAAA,kBACb,EAAE,GAAGM,GAAM,OAAOD,EAAA;AAAA,kBAClB,CAACE,MAAMA,EAAE,QAAQD,EAAK;AAAA,gBAAA;AAAA,cACvB;AAAA,cAED,CAAC/B,MAAMA,EAAE,eAAeyB,EAAa;AAAA,YAAA;AAAA,UAEvC;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EAED;AAAA,EAEA,OACCQ,GACAC,GACAC,GACAlB,GACC;AACD,gBAAK,aAAagB,GAAahB,CAAU,GACzC,KAAK,gBAAgBgB,GAAaC,GAASC,GAAUlB,CAAU,GAExD;AAAA,EACR;AAAA,EAES,aAAagB,GAA8BhB,GAA8C;AACjG,UAAMM,IAAQN,GAAY,SAAS;AAEnC,QAAIA,GAAY,gBAAgBA,GAAY,SAAS;AAEpD,YAAMmB,IAAgB,KAAKlB;AAAA,QAC1Be;AAAA,QACA,KAAK,SAAS,SAAA;AAAA,QACdhB,GAAY;AAAA,QACZA,GAAY;AAAA,QACZM;AAAA,MAAA;AAID,MAAIa,KACH,KAAK,SAAS,SAASA,CAAa;AAAA,IAEtC;AACC,WAAK,SAAS,YAAYH,GAAaV,CAAK;AAAA,EAE9C;AAAA,EAEA,cAAc;AACZ,SAAK,eAAA,EAAiC,MAAM,YAAY,iCAAiC,GAAG;AAAA,EAC9F;AAAA,EAEA,YAAY;AACV,SAAK,eAAA,EAAiC,MAAM,eAAe,+BAA+B;AAAA,EAC5F;AACD;;;;;;ACzOO,IAAMc,KAAN,cAAgDC,EAAc;AAAA,EAWpE,cAAc;AACb,UAAA,GAND,KAAQ,SAA2C,CAAA,GAQlD,KAAK,eAAeC,IAA8B,CAACC,MAAY;AAC9D,WAAK;AAAA,QACJA,GAAS;AAAA,QACT,CAACd,MAAU;AACV,eAAK,SAASA;AAAA,QACf;AAAA,QACA;AAAA,MAAA,GAED,KAAK;AAAA,QACJc,GAAS;AAAA,QACT,CAACC,MAAoB;AACpB,eAAK,mBAAmBA;AAAA,QAEzB;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC,GACD,KAAK,eAAeC,IAAgC,CAACC,MAAY;AAChE,WAAK;AAAA,QACJA,GAAS;AAAA,QACT,CAACC,MAAe;AAEf,UAAI,CAACA,KAAc,KAAK,eAAe,SAASA,MAChD,KAAK,gBAAgB,SAAS,cAAc,MAAM,GAClD,KAAK,cAAc,MAAM,cACzB,KAAK,cAAc,OAAOA;AAAA,QAC3B;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC;AAAA,EACF;AAAA,EAES,SAAS;AACjB,WAAO,KAAK,UAAU,KAAK,OAAO,SAAS,IACxCC,KAAQ,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA,oDAIqB,KAAK,gBAAgB;AAAA,QACjEC;AAAA,MACD,KAAK;AAAA,MACL,CAACf,MAASA,EAAK;AAAA,MACf,CAACA,MACAc;AAAA;AAAA;AAAA,oBAGYd,EAAK,GAAG;AAAA,0BACFA,EAAK,UAAU;AAAA,IAAA,CAClC;AAAA,eAEF;AAAA,EACJ;AAUD;AA3EaM,GAmEI,SAAS;AAAA,EACxBU;AAAA;AAAA;AAAA;AAAA;AAAA;AAMD;AAvEQC,GAAA;AAAA,EADPC,EAAA;AAAM,GAFKZ,GAGJ,WAAA,iBAAA,CAAA;AAGAW,GAAA;AAAA,EADPC,EAAA;AAAM,GALKZ,GAMJ,WAAA,UAAA,CAAA;AAGAW,GAAA;AAAA,EADPC,EAAA;AAAM,GARKZ,GASJ,WAAA,oBAAA,CAAA;AATIA,KAANW,GAAA;AAAA,EADNE,EAAc,gCAAgC;AAAA,GAClCb,EAAA;;;;;;;8XCXbc,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAiBA,MAAMC,KAAgE,CAACC,MAC/D,CAAC,EAAE,UAAAA,GAAU;AAId,IAAMC,IAAN,cAA6C3B,EAAc;AAAA,EA0CjE,cAAc;AACb,UAAA,GA3CK4B,EAAA,MAAAT,CAAA,GAENS,EAAA,MAAAf,EAAA,GACAe,EAAA,MAAAd,CAAA,GACAc,EAAA,MAAAb,EAAA,GACAa,EAAA,MAAAZ,EAAA,GACAY,EAAA,MAAAX,EAAA,GACAW,EAAA,MAAAV,EAAA,GAmIAU,EAAA,MAAAN,IAAU,MAAM;AACfO,MAAAA,EAAA,MAAKf,IAAmB,OAAA;AAAA,IACzB,CAAA,GA/FC,KAAK,eAAeb,IAA8B,CAAC6B,MAAiB;AACnEC,MAAAA,EAAA,MAAKlB,IAAgBiB,CAAA,GACrB,KAAK;AAAA,QACJD,QAAKhB,EAAA,GAAe;AAAA,QACpB,CAACmB,MAAe;AACfD,UAAAA,EAAA,MAAKf,IAAcgB,CAAA,GACnBC,EAAA,MAAKd,GAAAC,EAAA,EAAL,KAAA,IAAA;AAAA,QACD;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC,GACD,KAAK,eAAec,IAAgC,CAACC,MAAmB;AACvEJ,MAAAA,EAAA,MAAKd,IAAgBkB,GAAgB,gBAAA,CAAgB,GACrDJ,EAAA,MAAKb,IAAWiB,GAAgB,WAAA,CAAW;AAAA,IAC5C,CAAC,GACD,IAAIC;AAAA,MACH;AAAA,MACAC;AAAA,MACAC;AAAA,MACAb;AAAA,MACA,CAACc,GAAWC,MAAS;AACpB,cAAMtC,IAAUsC,EAAK;AACrB,YAAID,KAAarC,GAAS;AAEzB,cAAI2B,EAAA,MAAKZ,EAAA,MAAkB,UAAaY,EAAA,MAAKX,QAAa;AACzD,kBAAM,IAAI,MAAM,4CAA4C;AAE7Da,UAAAA,EAAA,MAAKjB,GAAoBZ,CAAA,GACzBA,EAAQ,cAAc;AAAA,YACrB,SAAS2B,EAAA,MAAKX,EAAA;AAAA,YACd,cAAcW,EAAA,MAAKZ,EAAA;AAAA,UAAA,CACgB,GACpCY,EAAA,MAAKf,GAAkB,kBAAA,GAEvBmB,EAAA,MAAKd,GAAAC,EAAA,EAAL,KAAA,IAAA,GAEA,KAAK;AAAA,YACJS,EAAA,MAAKf,CAAA,EAAkB,QAAQ,UAAU;AAAA,YACzC,CAAC2B,MAA0B;AAC1B,mBAAK,kBAAkBA,EAAsB,CAAC,GAC9CR,EAAA,MAAKd,GAAAE,EAAA,EAAL,KAAA,IAAA;AAAA,YACD;AAAA,YACA;AAAA,UAAA,GAGD,KAAK;AAAA,YACJnB,EAAQ,QAAQ,UAAU;AAAA,YAC1B,CAACwC,MAAS;AACT,mBAAK,wBAAwBA;AAAA,YAC9B;AAAA,YACA;AAAA,UAAA,GAGD,KAAK;AAAA,YACJxC,EAAQ;AAAA,YACR,OAAOyC,MAAc;AAGpB,kBAFAZ,EAAA,MAAKhB,IAAa4B,CAAA,GAClBV,EAAA,MAAKd,GAAAE,EAAA,EAAL,KAAA,IAAA,GACIsB,GAAW;AACd,gBAAAzC,EAAQ,QAAQ,MAAM,MAAMyC,CAAS;AACrC,sBAAMC,IAAUD,EAAU;AAC1B,oBAAIC,GAAS;AACZ,wBAAMC,IAAqB,IAAIC,GAA0B,IAAI,GACvD,EAAE,MAAAC,MAAS,MAAMF,EAAmB,aAAa,CAACD,CAAO,CAAC,GAC1DF,IAAOK,IAAO,CAAC,EAAE;AACvB,uBAAK,eAAeL,IAAO,KAAK,SAAS,OAAOA,CAAI,IAAI;AAAA,gBACzD;AAAA,cACD;AAAA,YACD;AAAA,YACA;AAAA,UAAA,GAGD,IAAIM,GAA4B,MAAMX,IAAuB,oBAAoB,CAACR,EAAA,MAAKf,EAAiB,CAAC;AAAA,QAC1G;AAAA,MACD;AAAA,IAAA;AAAA,EAEF;AAAA,EAqBS,SAAS;AACjB,WAAOP;AAAA;AAAA;AAAA,OAGF0B,EAAA,MAAKd,OAAL,KAAA,IAAA,CAAuB;AAAA;AAAA;AAAA;AAAA,MAIxBc,EAAA,MAAKd,OAAL,KAAA,IAAA,CAAoB;AAAA;AAAA;AAAA,EAGzB;AAsLD;AA7UCN,KAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AAPMC,IAAA,oBAAA,QAAA;AA2HNC,KAAK,WAAG;AACP,EAAI,CAACS,EAAA,MAAKf,CAAA,KAAqB,CAACe,QAAKb,EAAA,KACrCa,EAAA,MAAKf,CAAA,EAAkB,KAAKe,EAAA,MAAKb,EAAA,CAAW;AAC7C;AAEAK,KAAyB,WAAG;AAC3B,MAAI,CAACQ,EAAA,MAAKd,EAAA,KAAc,CAAC,KAAK,gBAAiB;AAC/C,QAAMkC,IAAW,KAAK;AACtB,OAAK,0BAA0B,YAAYC,GAA8B;AAAA,IACxE,OAAOD,EAAS;AAAA,IAChB,SAASA,EAAS,kBAAkBpB,EAAA,MAAKd,IAAY,UAAU;AAAA,IAC/D,SAASkC,EAAS,kBAAkBpB,EAAA,MAAKd,IAAY,UAAU;AAAA,EAAA,CAC/D,CAAC;AACH;AAEAO,KAAA,oBAAA,QAAA;AAiBAC,KAAgB,WAAG;AAClB,QAAM4B,IAAa,EAAE,GAAG,KAAK,SAAS,WAAW,KAAK,UAAU,QAAQ,KAAK,MAAA;AAC7E,SAAO5C;AAAA;AAAA;AAAA,uBAGc,KAAK,IAAI;AAAA;AAAA;AAAA,kDAGkB,KAAK,KAAK,WAAW4C,CAAU;AAAA;AAAA;AAAA,KAG5EC;AAAA,IACD,KAAK;AAAA,IACL,MACC7C,gDAAmD,KAAK,SAAS,KAAK,mCAAmC,CAAC;AAAA;AAAA;AAAA,EAAA,CAG3G;AAAA;AAEH;AAEAiB,KAAa,WAAG;AACf,SAAI,KAAK,gBAAgB,KACjBjB,yCAA4CsB,QAAKP,EAAA,CAAO;AAAA;AAAA;AAAA;AAAA,aAIrD,CAAC,KAAK,uBAAuB,KAAK,YAAY,CAAC;AAAA,qBAGlDf;AAAA;AAAA,iBAEO,KAAK,eAAe;AAAA,iBACpB,KAAK,2BAA2B,EAAE;AAAA;AAAA;AAAA;AAKlD;AAjMYoB,EAmMI,SAAS;AAAA,EACxB0B;AAAA,EACA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyID;AApUAC,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GATlBtB,EAUZ,WAAA,UAAA,CAAA;AAGAjB,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,QAAQ,SAAS,IAAO;AAAA,GAZ9BtB,EAaZ,WAAA,SAAA,CAAA;AAGAjB,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,QAAQ,SAAS,IAAO;AAAA,GAf9BtB,EAgBZ,WAAA,QAAA,CAAA;AAGAjB,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,QAAQ,WAAW,IAAO;AAAA,GAlBhCtB,EAmBZ,WAAA,SAAA,CAAA;AAGAjB,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,SAAS,SAAS,IAAM;AAAA,GArB9BtB,EAsBZ,WAAA,eAAA,CAAA;AAGAjB,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAxBlBtB,EAyBZ,WAAA,WAAA,CAAA;AAGAjB,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GA3BlBtB,EA4BZ,WAAA,YAAA,CAAA;AAGQjB,EAAA;AAAA,EADPC,EAAA;AAAM,GA9BKgB,EA+BJ,WAAA,mBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPC,EAAA;AAAM,GAjCKgB,EAkCJ,WAAA,2BAAA,CAAA;AAGAjB,EAAA;AAAA,EADPC,EAAA;AAAM,GApCKgB,EAqCJ,WAAA,yBAAA,CAAA;AAGAjB,EAAA;AAAA,EADPC,EAAA;AAAM,GAvCKgB,EAwCJ,WAAA,gBAAA,CAAA;AAxCIA,IAANjB,EAAA;AAAA,EADNE,EAAc,6BAA6B;AAAA,GAC/Be,CAAA;;;;;;;oPCtBb2B,IAAA/B,IAAAC;AAKO,IAAM+B,KAAN,cAAkDvD,EAAc;AAAA,EAAhE,cAAA;AAAA,UAAA,GAAA,SAAA,GAAA4B,GAAA,MAAA0B,EAAA;AAAA,EAAA;AAAA,EACG,SAAS;AACjB,WAAO/C;AAAA;AAAA;AAAA,OAGF0B,GAAA,MAAKqB,QAAL,KAAA,IAAA,CAAuB;AAAA;AAAA;AAAA;AAAA,MAIxBrB,GAAA,MAAKqB,QAAL,KAAA,IAAA,CAAoB;AAAA;AAAA;AAAA,EAGzB;AAmID;AA/IOA,KAAA,oBAAA,QAAA;AAcN/B,KAAgB,WAAG;AAClB,SAAOhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAMc,KAAK,SAAS,KAAK,kCAAkC,CAAC;AAAA;AAAA;AAAA;AAI5E;AAEAiB,KAAa,WAAG;AACf,SAAOjB;AAAA,KACJ,KAAK,SAAS,KAAK,yCAAyC,CAAC;AAAA;AAAA;AAGjE;AAhCYgD,GAkCI,SAAS;AAAA,EACxBF;AAAA,EACA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0GD;AA9IY8C,KAAN7C,GAAA;AAAA,EADNE,EAAc,kCAAkC;AAAA,GACpC2C,EAAA;;;;;;ACGN,IAAMC,IAAN,cAAuCxD,EAAc;AAAA,EAuBlD,SAAS;AACjB,UAAMmD,IAAa,EAAE,GAAG,KAAK,SAAS,WAAW,KAAK,UAAU,QAAQ,KAAK,MAAA;AAC7E,WAAO5C;AAAA;AAAA;AAAA,YAGG,KAAK,QAAQ,kBAAkB,KAAK,QAAQ,kBAAkB,WAAc,EAAE;AAAA,kCACxD,KAAK,IAAI;AAAA,mDACQ,KAAK,KAAK,WAAW4C,CAAU;AAAA,MAC5EC;AAAA,MACD,KAAK;AAAA,MACL,MACC7C,gDAAmD,KAAK,SAAS,KAAK,mCAAmC,CAAC;AAAA;AAAA;AAAA,IAAA,CAG3G;AAAA;AAAA;AAAA;AAAA,EAIJ;AAuBD;AAhEaiD,EA2CI,SAAS;AAAA,EACxB/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBD;AA5DAC,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAFlBO,EAGZ,WAAA,SAAA,CAAA;AAGA9C,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,QAAQ,SAAS,IAAO;AAAA,GAL9BO,EAMZ,WAAA,QAAA,CAAA;AAGA9C,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,QAAQ,WAAW,IAAO;AAAA,GARhCO,EASZ,WAAA,SAAA,CAAA;AAGA9C,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAXlBO,EAYZ,WAAA,UAAA,CAAA;AAGA9C,EAAA;AAAA,EADCuC,EAAS,EAAE,MAAM,SAAS,SAAS,IAAM;AAAA,GAd9BO,EAeZ,WAAA,eAAA,CAAA;AAGA9C,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAjBlBO,EAkBZ,WAAA,WAAA,CAAA;AAGA9C,EAAA;AAAA,EADCuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GApBlBO,EAqBZ,WAAA,YAAA,CAAA;AArBYA,IAAN9C,EAAA;AAAA,EADNE,EAAc,sBAAsB;AAAA,GACxB4C,CAAA;ACsCN,MAAMC,WACJC,GAQT;AAAA,EAmGC,YAAYrG,GAAyB;AACpC,UAAMA,GAAM+C,EAA8B,GAlG3C,KAAAuD,KAAgB,IAAIC,GAA4B,IAAI,GAIpD,KAAAC,KAAiB,IAAIC,GAAe,MAAS,GAC7C,KAAS,gBAAgB,KAAKD,GAAe,aAAA,GAE7C,KAAAE,KAAY,IAAIC,GAAqD,MAAS,GAC9E,KAAA,WAAW,KAAKD,GAAU,aAAA,GAC1B,KAAA,sBAAsB,KAAKA,GAAU,iBAAiB,CAACrG,MAAMA,GAAG,WAAW,GAK3E,KAAAuG,KAAe,IAAID,GAAoD,MAAS,GAChF,KAAS,cAAc,KAAKC,GAAa,aAAA,GAEzC,KAAAC,KAAqB,IAAIzG,GAAqC,CAAA,GAAI,CAACC,MAAMA,EAAE,qBAAqB,GAChG,KAAgB,oBAAoB,KAAKwG,GAAmB,aAAA,GAC5D,KAAgB,4BAA4B,KAAKA,GAAmB,iBAAiB,CAACxG,MAAMA,EAAE,MAAM,GACpG,KAAgB,YAAY,KAAKwG,GAAmB,iBAAiB,CAACxG,MAAMA,EAAE,SAAS,CAAC,GAExF,KAAAyG,KAAiB,IAAI5G,GAAgB,MAAS,GAC9C,KAAgB,gBAAgB,KAAK4G,GAAe,aAAA,GA6EnD,KAAK,eAAelE,IAA8B,CAACmE,MAAmB;AACrE,WAAKC,KAAeD,GACpB,KAAKE,GAAA;AAAA,IACN,CAAC,GAED,IAAIC,GAAoC,MAAMC,EAAyB,EACrE,kBAAkB,yBAAyB,EAC3C,QAAQ,OAAOC,MAAgB;AAC/B,UAAI,CAAC,KAAK,SAAU,QAAO;AAE3B,YAAMxF,IAAQwF,EAAY,QAAQ,SAASA,EAAY,KAAK,IAAI,IAC1DC,IAAmB,MAAM,KAAK,WAAWC,EAA8B;AAC7E,UAAI,CAACD;AACJ,cAAM,IAAI,MAAM,iCAAiC;AAElD,YAAME,IAA2BF,EAAiB;AAAA,QACjDG;AAAA,MAAA,GAIKC,IAAkB,MAAM,KAAK,WAAWC,EAAoB;AAClE,UAAI,CAACD;AACJ,cAAM,IAAI,MAAM,gCAAgC;AAEjD,YAAME,IAASF,EAAgB,UAAA,GACzBG,IAAgB,IAAIC,GAAsD,IAAI;AAEpF,aAAO;AAAA,QACN,MAAM;AAAA,UACL,QAAQ,KAAKhB,GAAmB,SAAA;AAAA,UAChC,aAAa,KAAK,SAAS,eAAA,KAAoB,CAAA;AAAA,UAC/C,eAAeO,EAAY,SAAS;AAAA,UACpC,iBAAiB,OAAOU,MAAyB;AAMhD,gBAAI,CALgCT,EAAiB;AAAA,cACpDE;AAAA,cACAO,EAAqB;AAAA,YAAA;AAIrB,qBAAO;AAGR,kBAAMC,IAAkB,MAAMH,EAAc;AAAA,cAC3CE,EAAqB;AAAA,cACrBN;AAAA,YAAA;AAGD,gBAAIO,EAAgB,mBAAmB;AACtC,oBAAMrH,KAAQ,MAAMkH,EAAc;AAAA,gBACjCE,EAAqB;AAAA,gBACrBN;AAAA,cAAA;AAGD,qBAAOO,EAAgB,kBAAkBrH,IAAOiH,GAAQ,CAACjH,MAAU,KAAKsH,GAAwBtH,CAAK,CAAC;AAAA,YACvG;AAEA,mBAAO;AAAA,UACR;AAAA,UACA,YAAY;AAAA,YACX,OAAAkB;AAAA,YACA,SAAS,KAAKqG;AAAA,YACd,cAAc,KAAKC;AAAA,UAAA;AAAA,UAEpB,wBAAwB,KAAK,SAAS,2BAA2B;AAAA,QAAA;AAAA,MAClE;AAAA,IAEF,CAAC,EACA,SAAS,OAAOxH,GAAOgF,MAAS;AAChC,UAAIhF,GAAO,UAAUgF,GAAM;AAC1B,cAAMyC,IAAU,MAAM,KAAK;AAAA,UAC1BzH,EAAM,OAAO;AAAA;AAAA,UAEb,CAAA;AAAA,UACAgF,EAAK;AAAA,QAAA;AAEN,YAAIyC;AACH,gBAAM,KAAK;AAAA,YACVA,EAAQ;AAAA,YACRA,EAAQ;AAAA,YACRA,EAAQ;AAAA,YACRzC,EAAK;AAAA,UAAA;AAAA;AAGN,gBAAM,IAAI,MAAM,wBAAwB;AAAA,MAE1C,WAAWhF,GAAO,aAAaA,EAAM,UAAU,WAAW,UAAUgF,GAAM;AACzE,cAAM2B,IAAmB,MAAM,KAAK,WAAWC,EAA8B;AAC7E,YAAI,CAACD;AACJ,gBAAM,IAAI,MAAM,iCAAiC;AAElD,cAAMe,IAAiB,MAAMf,EAAiB;AAAA,UAC7C3G,EAAM,UAAU;AAAA,UAChB8G;AAAA,QAAA;AAGD,aAAK,0BAA0BY,GAAgB1C,EAAK,UAA6C;AAAA,MAClG;AAAA,IACD,CAAC,EACA,oBAAoB,CAAC2C,MAAiB;AAEtC,WAAK,4BAA4B,SAASA,CAAY;AAAA,IACvD,CAAC,GAEF,IAAInB,GAAoC,MAAMoB,EAA8B,EAC1E,kBAAkB,OAAO,EACzB,QAAQ,OACD;AAAA,MACN,MAAM;AAAA,QACL,YAAY;AAAA,QACZ,QAAQ,CAAA;AAAA,QACR,YAAY;AAAA,UACX,OAAO;AAAA,UACP,SAAS,KAAKL;AAAA,UACd,cAAc,KAAKC;AAAA,UACnB,cAAc,KAAK;AAAA,QAAA;AAAA,MACpB;AAAA,MAED,OAAO,EAAE,MAAM,SAAA;AAAA,IAAS,EAEzB,EACA,oBAAoB,CAACG,MAAiB;AACtC,YAAME,IAAUF,EAAa,EAAE;AAC/B,WAAK,eAAe,SAASE,CAAO;AAAA,IACrC,CAAC;AAAA,EACH;AAAA,EAhOAjC;AAAA,EAEAU;AAAA,EAEAR;AAAA,EAGAE;AAAA,EAIAwB;AAAA,EACAD;AAAA,EAEArB;AAAA,EAGAC;AAAA,EAKAC;AAAA,EAGA,4BAA4B;AAC3B,QAAI,CAAC,KAAK;AACT,YAAM,IAAI,MAAM,mBAAmB;AAGpC,UAAM0B,IAAY,IAAIC,GAAe,MAAS;AAC9C,gBAAK,QAAQ,KAAK,mBAAmB,CAACpI,MAAM;AAC3C,MAAIA,EAAE,WAAW,IAChB,KAAK;AAAA,QACJ,KAAK,SAAU,kBAAkBA,EAAE,CAAC,EAAE,qBAAqB;AAAA,QAC3D,CAACgF,MAAS;AACT,UAAAmD,EAAU,SAASnD,CAAI;AAAA,QACxB;AAAA,QACA;AAAA,MAAA,IAGD,KAAK,2BAA2B,8BAA8B;AAAA,IAEhE,CAAC,GAEMmD,EAAU,aAAA;AAAA,EAClB;AAAA,EAEA,gBAAgB7D,GAA2B;AAC1C,SAAKuD,KAAgBvD;AAAA,EACtB;AAAA,EAEA,kBAA6C;AAC5C,WAAO,KAAKuD;AAAA,EACb;AAAA,EAEA,WAAWvG,GAAwB;AAClC,SAAKsG,KAAWtG,GAChB,KAAK2E,GAAc,YAAY3E,KAAW,EAAE,GAC5C,KAAK+G,GAAA;AAAA,EAKN;AAAA,EAEA,aAAwC;AACvC,WAAO,KAAKT;AAAA,EACb;AAAA,EAEA,iBAAiBU,GAA6B;AAC7C,SAAKnC,GAAe,SAASmC,CAAO;AAAA,EACrC;AAAA,EACA,mBAAmB;AAClB,WAAO,KAAKnC,GAAe,SAAA;AAAA,EAC5B;AAAA,EAEA,gBAAgB;AACf,WAAI,KAAKyB,KACD,KAAKvB,GAAU,SAAA,GAAY,cAAc,IAE1C,KAAK,UAAU,cAAA,KAAmB;AAAA,EAC1C;AAAA,EAEA,gBAAgB;AACf,WAAI,KAAKuB,KACD,KAAKvB,GAAU,SAAA,GAAY,cAAc,QAE1C,KAAK,UAAU,cAAA,KAAmB;AAAA,EAC1C;AAAA,EAEA,4BAA4B;AAC3B,WAAO,KAAK,eAAA,EAAiB,YAAY,cAAc,mCAAmC;AAAA,EAG3F;AAAA,EAmIA,MAAMsB,GAAwBY,GAAuC;AACpE,UAAMC,IAAyB,KAAKC,GAAA,EAA+B,IAAI,CAACzI,MAAMA,EAAE,qBAAqB,GAE/F0I,IAAkBH,EAAc,OAAO,mBAAmB,GAAG,IAAI,CAACI,MAAUA,EAAM,UAAU,KAAK,CAAA;AASvG,WAR4BJ,EAAc,YACxC,OAAO,CAACrG,MAAYwG,EAAgB,SAASxG,EAAQ,GAAG,CAAC,EACzD,IAAI,CAACA,MAAYA,EAAQ,cAAc,EAEU;AAAA,MAAM,CAACoC,MACzDkE,EAAuB,SAASlE,CAAU;AAAA,IAAA;AAAA,EAI5C;AAAA,EAEU,mBAAmB;AAC5B,IAAK,KAAK,aAEV,KAAKsE,GAAA,GACL,KAAKC,GAAA;AAAA,EACN;AAAA,EAEAR,KAAc;AACb,IAAI,KAAKT,OAAa,UACtB,KAAKhB,GAAA;AAAA,EACN;AAAA,EAEA,MAAMA,KAAuB;AAC5B,QAAI,KAAKgB,OAAa;AAEtB,UAAI,KAAKA,OAAa,MAAM;AAG3B,YADA,MAAM,KAAK,kBACP,CAAC,KAAK,SAAU;AAEpB,aAAK,2BAA2B,qBAAqB,GACrD,KAAK,gBAAgB,IAAI,GACzB,KAAK;AAAA,UACJ,KAAK,SAAS;AAAA,UACd,CAACkB,MAAY;AACZ,iBAAK,eAAe,SAASA,CAAO;AAAA,UACrC;AAAA,UACA;AAAA,QAAA,GAED,KAAK;AAAA,UACJ,KAAK;AAAA,UACL,CAACA,MAAY;AACZ,iBAAK,UAAU,WAAWA,CAAO;AAAA,UAClC;AAAA,UACA;AAAA,QAAA;AAGD,cAAMC,IAAS,KAAK,eAAA;AACpB,QAAIA,MACHA,EAAO,gBAAgB,iBAAiB,GACxCA,EAAO,gBAAgB,oBAAoB,GAC3CA,EAAO,gBAAgB,oBAAoB,GAC3CA,EAAO,MAAM,eAAe,gCAAgC,GAC5DA,EAAO,MAAM,eAAe,oCAAoC,GAChEA,EAAO,MAAM,eAAe,iCAAiC,IAG9D,KAAK,2BAA2B,iBAAiB,GACjD,KAAKH,GAAA,GACL,KAAKC,GAAA;AAAA,MACN,OAAO;AACN,YAAI,CAAC,KAAKlC,GAAc;AAExB,aAAK;AAAA,UACJ,KAAKA,GAAa;AAAA,UAClB,CAAC/F,MAAW;AACX,iBAAK,gBAAgBA,KAAU,IAAI;AAAA,UACpC;AAAA,UACA;AAAA,QAAA,GAED,KAAK;AAAA,UACJ,KAAK+F,GAAa,cAAc,KAAKiB,EAAQ;AAAA,UAC7C,CAACkB,MAAY;AACZ,YAAIA,KACH,KAAK,eAAe,SAASA,CAAO;AAAA,UAEtC;AAAA,UACA;AAAA,QAAA,GAGD,KAAK;AAAA,UACJ,KAAK;AAAA,UACL,CAACA,MAAY;AACZ,YAAI,KAAKlB,MACR,KAAKjB,IAAc,iBAAiB,KAAKiB,IAAUkB,CAAO;AAAA,UAE5D;AAAA,UACA;AAAA,QAAA,GAGD,KAAK;AAAA,UACJ,KAAKnC,GAAa,SAAS,KAAKiB,EAAQ;AAAA,UACxC,CAACoB,MAAa;AACb,iBAAK3C,GAAU,SAAS2C,CAAQ;AAChC,kBAAMD,IAAS,KAAK,eAAA;AACpB,YAAKA,MACLA,EAAO,aAAa,mBAAmBC,GAAU,SAAS,EAAE,GAC5DD,EAAO,aAAa,sBAAsBC,GAAU,YAAY,SAAA,KAAc,EAAE,GAChFD,EAAO,aAAa,sBAAsBC,GAAU,SAAS,SAAA,KAAc,EAAE,GAC7ED,EAAO,MAAM,YAAY,kCAAkCC,GAAU,YAAY,SAAA,KAAc,EAAE,GACjGD,EAAO,MAAM,YAAY,sCAAsCC,GAAU,YAAY,SAAA,KAAc,EAAE,GACrGD,EAAO,MAAM,YAAY,mCAAmCC,GAAU,SAAS,SAAA,KAAc,EAAE,GAC/F,KAAKJ,GAAA,GACL,KAAKC,GAAA;AAAA,UACN;AAAA,UACA;AAAA,QAAA;AAAA,MAEF;AAAA,EACD;AAAA,EAEAD,KAA0B;AACzB,IAAK,KAAK,aACV,KAAKpC,GAAmB,SAAS,KAAKiC,GAAA,CAA8B,GACpE,KAAKQ,GAAA;AAAA,EACN;AAAA,EACAJ,KAAoB;AACnB,QAAK,KAAK;AAEV,UAAI,KAAKjB,MAAY,MAAM;AAC1B,cAAMoB,IAAW,KAAK3C,GAAU,SAAA;AAGhC,YAFA,KAAK,2BAA2B,gCAAgC,GAE5D,CAAC2C,EAAU;AAEf,aAAKzC,GAAa,SAAS;AAAA,UAC1B,KAAKyC,EAAS,cAAc;AAAA,UAC5B,KAAKA,EAAS,cAAc;AAAA,QAAA,CAC5B;AAAA,MACF,WAAW,KAAKpB,OAAa,MAAM;AAClC,YAAI,CAAC,KAAK,SAAU;AAEpB,aAAK;AAAA,UACJ,KAAK,SAAS;AAAA,UACd,CAACN,MAAW;AACX,kBAAM4B,IAAM5B,GAAQ,gBAAyC,iBAAiB,GAAG,OAAO,GAClF6B,IAAM7B,GAAQ,gBAAyC,iBAAiB,GAAG,OAAO;AACxF,iBAAKf,GAAa,SAAS,EAAE,KAAA2C,GAAK,KAAAC,GAAK;AAAA,UACxC;AAAA,UACA;AAAA,QAAA;AAAA,MAEF;AAAA;AAAA,EACD;AAAA,EAEA,sBAAsB5H,GAAe;AACpC,WAAO,KAAK,4BAA4B,SAAA,IAAa,EAAE,MAAM,UAAU,OAAAA,GAAc;AAAA,EACtF;AAAA,EAEA,oBAAoBA,GAAe;AAClC,WAAO,KAAK,4BAA4B,SAAA,IAAa,EAAE,MAAM,aAAa,OAAAA,GAAc;AAAA,EACzF;AAAA,EAEA,mBAAmB6H,GAAwB;AAC1C,WAAO,KAAK5C,GAAmB;AAAA,MAAiB,CAAC6C,MAChDA,EAAM,KAAK,CAACrJ,MAAMA,EAAE,0BAA0BoJ,CAAc;AAAA,IAAA;AAAA,EAE9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBA,MAAM,OACLtI,GACAC,GACAE,GACC;AACD,iBAAM,KAAK,kBACJ,MAAM,KAAK,UAAU,kBAAkBH,GAAuBC,GAAoBE,CAAU;AAAA,EACpG;AAAA;AAAA,EAIA,MAAM,OACLgB,GACAC,GACAC,GACAlB,GACC;AACD,iBAAM,KAAK,kBACJ,KAAK,UAAU,OAAOgB,GAAaC,GAASC,GAAUlB,CAAU,KAAK;AAAA,EAC7E;AAAA;AAAA,EAGA,MAAe,OAAOqD,GAAoB;AAGzC,UAAMgF,IAAS,KAAK,eAAe,SAAA,EAAW,KAAK,CAACtJ,MAAMA,EAAE,eAAesE,CAAU;AACrF,QAAI,CAACgF;AACJ,YAAM,IAAI,MAAM,2CAA2ChF,CAAU,EAAE;AAGxE,IAAAiF,GAA0BD,GAAQ,OAAOE,MAAU;AAClD,MAAIA,EAAM,eACT,KAAK,SAAU,kBAAkBA,EAAM,WAAW,GAEnD,KAAK,SAAU,iBAAiBlF,CAAU,GAC1C,KAAK,SAAU,gBAAgBA,CAAU;AAAA,IAC1C,CAAC,GAED,MAAM,MAAM,OAAOA,CAAU;AAAA,EAC9B;AAAA,EAEA,MAAgB,yBAAyBjE,GAA+BY,GAA6C;AACpH,UAAMmB,IAAgB/B,EAAM,OAAOoJ,EAA2C;AAE9E,QAAI,CAACrH;AACJ,YAAM,IAAI,MAAM,yBAAyB;AAG1C,iBAAM,QAAQ;AAAA,MACbA,EAAc,IAAI,OAAOH,MAAgB;AACxC,cAAM,KAAK,8BAA8BA,GAAa5B,GAAOY,CAAU,GACnEA,EAAW,UAAU,OACxBA,IAAa,EAAE,GAAGA,GAAY,OAAOA,EAAW,QAAQ,EAAA;AAAA,MAE1D,CAAC;AAAA,IAAA,GAGKA;AAAA,EACR;AAAA,EAEA,MAAyB,8BACxBgB,GACA5B,GACAY,GACC;AACD,UAAM,MAAM,8BAA8BgB,GAAa5B,GAAOY,CAAU,GAGxE,MAAMsI,GAA0BtH,GAAa,OAAOuH,GAAOE,GAAcpI,MAAY;AACpF,YAAMqI,IAAkB,EAAE,OAAO,IAAI,cAAAD,GAAc,SAAApI,EAAA;AACnD,YAAM,KAAK,8BAA8BkI,GAAOnJ,GAAOsJ,CAAe;AAAA,IACvE,CAAC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMAlB,KAA+B;AAC9B,QAAI,CAAC,KAAK,SAAU,QAAO,CAAA;AAE3B,QAAI,KAAKb,IAAU;AAClB,YAAMoB,IAAW,KAAK3C,GAAU,SAAA;AAEhC,aAAK2C,IAEDA,EAAS,sBAAsBA,EAAS,oBAAoB,SAAS,IAEvEA,EAAS,mBACP,QAAQ,CAACY,MACLA,EAAW,WAEb,KAAK,UAAU,cAAA,EAAgB,OAAO,CAACC,MAAcA,EAAU,aAAaD,EAAW,QAAQ,KAAK,CAAA,IAE3FA,EAAW,iBAEpB,KAAK,UAAU,cAAA,EAAgB,OAAO,CAAC5J,MAAMA,EAAE,0BAA0B4J,EAAW,cAAc,KAClG,CAAA,IAGK,CAAA,CACP,EAEA,OAAO,CAACE,GAAGtI,GAAGuI,MAAMA,EAAE,UAAU,CAAC/J,MAAMA,EAAE,0BAA0B8J,EAAE,qBAAqB,MAAMtI,CAAC,IAK9F,KAAK,SAAS,cAAA,EAAgB,OAAO,CAACxB,MAAMA,EAAE,YAAY,IAxB3C,CAAA;AAAA,IAyBvB,WAAW,KAAK4H,OAAa;AAE5B,aAAO,KAAK,SAAS,cAAA,EAAgB,OAAO,CAAC5H,MAAMA,EAAE,WAAW;AAGjE,WAAO,CAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKAiJ,KAAgC;AAC/B,QAAK,KAAK;AAEV,UAAI,KAAKrB,IAAU;AAClB,cAAMoB,IAAW,KAAK3C,GAAU,SAAA;AAEhC,YAAI,CAAC2C,EAAU;AAEf,QAAIA,EAAS,sBAAsBA,EAAS,oBAAoB,SAAS,KACxE,KAAKvC,GAAe,SAAS,EAAI;AAAA,MAEnC,MAAA,CAAW,KAAKmB;AAAA,EAGjB;AAAA;AAAA,EAGAoC;AAAA,EAEA,4BAA4B;AAC3B,WAAO,KAAKA,MAA2B,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,+BAAwC;AACvC,UAAMhB,IAAW,KAAK3C,GAAU,SAAA;AAChC,QAAI,CAAC2C,KAAY,CAACA,EAAS,mBAAoB,QAAO;AAEtD,UAAM5G,IAAgB,KAAK,eAAe,SAAA;AAE1C,gBAAK4H,KAA0BhB,EAAS,mBACtC,IAAI,CAACiB,MAAS;AACd,YAAMC,IAAaD,EAAK,cAAc,GAChCE,IAAaF,EAAK,cAAc;AAGtC,UAAIA,EAAK,UAAU;AAClB,cAAMG,IACL,KAAK,UACF,cAAA,EACD,OAAO,CAACP,MAAcA,EAAU,aAAaI,EAAK,YAAYJ,EAAU,iBAAiB,EAAI,EAC7F,IAAI,CAAC7J,MAAMA,EAAE,qBAAqB,KAAK,CAAA,GACpCqK,IAAcjI,EAAc,OAAO,CAACoH,MAAU;AACnD,gBAAMJ,IAAiB,KAAK,SAAU,8BAA8BI,EAAM,UAAU;AACpF,iBAAOJ,IAAiBgB,EAAqB,QAAQhB,CAAc,MAAM,KAAK;AAAA,QAC/E,CAAC,EAAE;AAEH,eAAIiB,IAAcH,KAAeC,IAAa,KAAKE,IAAcF,IACzD;AAAA,UACN,UAAUF,EAAK;AAAA,UACf,MAAM,KAAK,SAAU,kBAAkBA,EAAK,QAAQ,KAAK;AAAA,UACzD,QAAQI;AAAA,UACR,gBAAgBH;AAAA,UAChB,gBAAgBC;AAAA,QAAA,IAGlB;AAAA,MACD,WAESF,EAAK,gBAAgB;AAC7B,cAAMK,IAASlI,EAAc,OAAO,CAACoH,MACb,KAAK,SAAU,aAAaA,EAAM,UAAU,GAAG,mBAC5CS,EAAK,cAC/B,EAAE;AACH,eAAIK,IAASJ,KAAeC,IAAa,KAAIG,IAASH,IAC9C;AAAA,UACN,KAAKF,EAAK;AAAA,UACV,MAAM,KAAK,SAAU,qBAAqBA,EAAK,cAAc,KAAK;AAAA,UAClE,QAAAK;AAAA,UACA,gBAAgBJ;AAAA,UAChB,gBAAgBC;AAAA,QAAA,IAGlB;AAAA,MACD;AAGA,cAAQ,MAAM,kCAAkCF,CAAI;AAAA,IAErD,CAAC,EACA,OAAO,CAACjK,MAAMA,MAAM,MAAS,GACxB,KAAKgK,GAAwB,WAAW;AAAA,EAChD;AAAA,EAEAO;AAAA,EAEA,oCAAoC;AACnC,WAAO,KAAKA,MAAmC,CAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,sCAA+C;AAC9C,SAAKA,KAAkC,CAAA;AAEvC,UAAMnI,IAAgB,KAAK,eAAe,SAAA;AAC1C,QAAIA,EAAc,WAAW,EAAG,QAAO;AAGvC,UAAMoI,IAAgB,KAAKhE,GAAmB,SAAA;AAC9C,QAAIgE,EAAc,WAAW,EAAG,QAAO;AAEvC,UAAMC,IAAcD,EAAc,IAAI,CAACxK,MAAMA,EAAE,qBAAqB;AAmBpE,WAjBuBoC,EAAc,OAAO,CAACoH,MAAU;AACtD,YAAMJ,IAAiB,KAAK,SAAU,8BAA8BI,EAAM,UAAU;AACpF,UAAI,CAACJ;AAGJ,eAAO;AAER,YAAMsB,IAAQD,EAAY,QAAQrB,CAAc,MAAM;AACtD,aAAIA,KAAkBsB,KAErB,KAAKH,IAAiC;AAAA,QACrC,KAAK,UAAU,qBAAqBnB,CAAc,KAAKA;AAAA,MAAA,GAGlDsB;AAAA,IACR,CAAC,EAEqB,WAAW;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAUpG,GAAoB;AAC7B,UAAMpC,IAAU,KAAK,UAAU,aAAaoC,CAAU,GAChDkG,IAAgB,KAAKhE,GAAmB,SAAA;AAC9C,WAAI,CAACtE,KAAW,CAACsI,IAAsB,KAEhCA,EAAc,IAAI,CAACxK,MAAMA,EAAE,qBAAqB,EAAE,QAAQkC,EAAQ,cAAc,MAAM;AAAA,EAC9F;AAAA,EAEA,cAAc;AACb,SAAK,UAAU,YAAA;AAAA,EAChB;AAAA,EAEA,YAAY;AACX,SAAK,UAAU,UAAA;AAAA,EAChB;AACD;;;;;;;+YCttBAyI,IAAAC,GAAAC,IAAAC,GAAAC,GAAAC,GAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AA4BA,SAASC,GACRC,GACC;AAED,MACCA,EAAK,aAAa,SAClBA,EAAK,aAAa,MAAM,SAAS,KACjCC,GAAaD,EAAK,UAAUA,EAAK,UAAUA,EAAK,aAAa,GAAG;AAEhE,WAAO;AAIR,QAAME,IAAkC,iBAAiBF,EAAK,gBAAgB,GACxEG,IAAgB,OAAOD,EAAgC,UAAU,MAAM,IAAI,EAAE,CAAC,CAAC,KAAK,GACpFE,IAAmB;AAAA,IACxBF,EAAgC,iBAAiB,gCAAgC;AAAA,IACjF;AAAA,EAAA,GAGKG,IAAiB,SAASL,EAAK,eAAe,QAAQ,WAAW,IAAI,EAAE,GACvEM,IAAwBN,EAAK,KAAK;AAExC,MAAIM,KAAyBF;AAC5B,WAAO;AAIR,QAAMG,IAA+BL,EAAgC,oBACnE,KAAA,EACA,MAAM,IAAI,EACV,IAAI,CAAC1L,MAAM,OAAOA,CAAC,CAAC,EACpB,OAAO,CAACgM,MAAMA,IAAI,CAAC,EACnB,IAAI,CAACA,GAAGxK,GAAGyK,OAAUA,GAAK,WAAWzK,IAAIwK,IAAIA,IAAIL,CAAc;AAKjE,MAAIO,IAA6BH,EAA6B;AAC9D,QAAMI,IAAyBP,IAAmBM;AAClD,MAAIC,IAAyB,GAAG;AAC/B,UAAMC,IAAmBC,GAA2BH,GAA4BH,CAA4B,KAAK,GAC3GO,KAAsBd,EAAK,cAAc,QAAQY,KAAoBD;AAC3E,QAAIG,IAAqB;AACxB,aAAOJ,MAA+BN;AACrC,QAAAG,EAA6B,KAAKO,CAAkB;AAAA,EAGvD;AAEA,MAAIC,IAAkB;AAKtB,EAAIf,EAAK,0BAA0BA,EAAK,YAAY,OAAOA,EAAK,YAAY,SAC3Ee,IAAkB,EAAEf,EAAK,YAAY,QAAQG;AAG9C,QAAMa,IAAgB,KAAK,IAAIhB,EAAK,YAAY,OAAOA,EAAK,cAAc,OAAOe,GAAiB,CAAC;AAMnG,SALwB,KAAK;AAAA,IAC5BE,GAA0CD,GAAeT,CAA4B;AAAA,EAAA,IAG1CF,IAAiBC,IAAwBF;AAStF;AAMA,MAAMc,KAAoF;AAAA,EACzF,oBAAoB,CAACC,MACbA,EAAQ;AAAA,EAEhB,kBAAkB,CAACC,MACXA,EAAW;AAAA,EAEnB,kBAAkBrB;AAAA,EAClB,YAAY;AAAA,EACZ,cAAc;AAAA,EACd,mBAAmB;AACpB;AAMO,IAAMsB,IAAN,cAAyCC,GAAoBxK,CAAa,EAAE;AAAA,EA4ElF,cAAc;AACb,UAAA,GA7EK4B,EAAA,MAAA+G,CAAA,GAEN/G,EAAA,MAAAyG,IAAU,IAAIoC,GAAuE,MAAM;AAAA,MAC1F,GAAGL;AAAA,MACH,SAAS,MAAM;AACdvI,QAAAA,EAAA,MAAKyG,GAAS,YAAA;AAAA,MACf;AAAA,MACA,OAAO,MAAM;AACZzG,QAAAA,EAAA,MAAKyG,GAAS,UAAA;AAAA,MACf;AAAA,MACA,UAAU,CAAC,EAAE,OAAAoC,QAAY;AACxB7I,QAAAA,EAAA,MAAKyG,CAAA,EAAS,WAAWoC,CAAK;AAAA,MAC/B;AAAA,MACA,eAAe,CAAC,EAAE,MAAAC,QACV9I,EAAA,MAAKyG,CAAA,EAAS,UAAUqC,EAAK,UAAU;AAAA,MAE/C,cAAc,MAAM;AACnB,aAAK,aAAa,iBAAiB,EAAE;AAAA,MACtC;AAAA,MACA,WAAW,MAAM;AAChB,aAAK,gBAAgB,eAAe;AAAA,MACrC;AAAA,IAAA,CACA,CAAA,GAED/I,EAAA,MAAA0G,GAAW,IAAI7E,GAA2B,IAAI,CAAA,GAC9C7B,EAAA,MAAA2G,EAAA,GACA3G,EAAA,MAAA4G,CAAA,GACA5G,EAAA,MAAA6G,CAAA,GACA7G,EAAA,MAAA8G,CAAA,GA2CA,KAAQ,iBAAiD,CAAA,GAGzD,KAAQ,cAAuB,IAK9B,KAAK;AAAA,MACJ7G,QAAKyG,CAAA,EAAS;AAAA,MACd,CAACxI,MAAkB;AAElB+B,QAAAA,EAAA,MAAKwG,EAAA,EAAQ,SAASvI,CAAa,GACnC,KAAK,iBAAiBA;AAAA,MAEvB;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJ+B,QAAKyG,CAAA,EAAS;AAAA,MACd,CAACsC,MAAW;AACX,aAAK,aAAaA,IAAS,GACvBA,MAAW,IACd,KAAK;AAAA,UACJ/I,EAAA,MAAKyG,GAAS,0BAAA;AAAA,UACd,CAACuC,MAAqB;AACrB,iBAAK,eAAe,KAAK,SAAS,KAAK,uBAAuB,KAAK,SAAS,OAAOA,CAAgB,CAAC;AAAA,UACrG;AAAA,UACA;AAAA,QAAA,KAGD,KAAK,2BAA2B,4BAA4B,GAC5D,KAAK,eAAe,KAAK,SAAS,KAAK,sBAAsB;AAAA,MAE/D;AAAA,MACA;AAAA,IAAA,GAGD,KAAK;AAAA,MACJhJ,QAAKyG,CAAA,EAAS;AAAA,MACd,CAACwC,MAAgB;AAChB7I,QAAAA,GAAA,MAAK0G,OAAL,KAAA,MAA2BmC,CAAA;AAAA,MAC5B;AAAA,MACA;AAAA,IAAA,GAGD,KAAK;AAAA,MACJjJ,QAAKyG,CAAA,EAAS;AAAA,MACd,CAACyC,MAAkB;AAClB9I,QAAAA,GAAA,MAAK0G,OAAL,KAAA,MAAoCoC,CAAA;AAAA,MACrC;AAAA,MACA;AAAA,IAAA,GAGDlJ,EAAA,MAAKyG,CAAA,EAAS,WAAA,EAAa,KAAK,CAACjI,MAAY;AAC5C,WAAK;AAAA,QACJA,EAAQ;AAAA,QACR,CAACC,MAAe;AACf,UAAI,CAACA,KAAc,KAAK,eAAe,SAASA,MAChD,KAAK,gBAAgB,SAAS,cAAc,MAAM,GAClD,KAAK,cAAc,MAAM,cACzB,KAAK,cAAc,OAAOA;AAAA,QAC3B;AAAA,QACA;AAAA,MAAA,GAGD,KAAK;AAAA,QACJD,EAAQ,cAAc;AAAA,QACtB,CAAC2K,MAAgB,KAAK,cAAcA;AAAA,QACpC;AAAA,MAAA,GAGD,KAAK;AAAA,QACJ3K,EAAQ;AAAA,QACR,CAACsC,MAAc;AACd,UAAIA,MACHd,EAAA,MAAKwG,EAAA,EAAQ,aAAa,oBAAoB1F,EAAU,SAAA;AAAA,QAE1D;AAAA,QACA;AAAA,MAAA,GAGG,KAAK,UACR,KAAK;AAAA,QACJd,QAAKyG,CAAA,EAAS;AAAA,QACd,CAAC2C,MAAW,KAAK,qBAAqBA;AAAA,QACtC;AAAA,MAAA,IAGD,KAAK;AAAA,QACJ5K,EAAQ,wBAAwB,CAAC3C,MAAMA,GAAG,KAAK,CAAC6B,MAAMA,EAAE,UAAU,aAAa,GAAG,KAAK;AAAA,QACvF,CAAC0L,MAAW,KAAK,qBAAqBA;AAAA,QACtC;AAAA,MAAA;AAAA,IAGH,CAAC,GAED,IAAIC;AAAA,MAAwB;AAAA,MAAM;AAAA;AAAA,IAAA;AAAA,EACnC;AAAA,EA1IA,IAAW,QAAQnN,GAAkC;AACpD,SAAK,WAAWA,GAChB8D,EAAA,MAAKyG,CAAA,EAAS,WAAWvK,KAAS,IAAI,GACtC8D,EAAA,MAAK0G,KAAmB,QAAA,GACpB,KAAK,WAGRxG,EAAA,MAAKwG,IAAoB,IAAI2C,GAAwB,MAAM,IAAI,CAAA;AAAA,EAIjE;AAAA,EACA,IAAW,UAAqC;AAC/C,WAAO,KAAK;AAAA,EACb;AAAA,EAGA,IAAW,cAAcnN,GAA2B;AACnD8D,IAAAA,EAAA,MAAKyG,CAAA,EAAS,iBAAiBvK,CAAK;AAAA,EACrC;AAAA,EACA,IAAW,gBAAoC;AAC9C,WAAO8D,EAAA,MAAKyG,GAAS,iBAAA;AAAA,EACtB;AAAA;AAAA,EAmNS,SAAS;AACjB,WAAO/H;AAAA,KACJ,KAAK,aAAa;AAAA,oEAC6C,KAAK,eAAe,MAAM;AAAA,MACxFC;AAAA,MACD,KAAK;AAAA,MACL,CAACwG,GAAQ/H,MAAU,GAAGA,CAAK,IAAI+H,EAAO,UAAU;AAAA,MAChD,CAACA,GAAQ/H,MACRsB;AAAA;AAAA,eAEStB,CAAK;AAAA,qBACC+H,EAAO,UAAU;AAAA,iBACrBA,CAAM;AAAA;AAAA,IAAA,CAElB;AAAA;AAAA,KAEA,KAAK,aAAa/E,GAAA,MAAK0G,GAAAG,EAAA,EAAL,aAAkCqC,CAAO;AAAA,KAC3D,KAAK,WAAW5K,uCAA0C,IAAI,oCAAoC4K,CAAO;AAAA;AAAA,EAE7G;AAyGD;AAlYC9C,KAAA,oBAAA,QAAA;AAsBAC,IAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AA5BMC,IAAA,oBAAA,QAAA;AA2KAC,KAAqB,eAACwC,GAAiD;AAC5E,EAAIvJ,QAAK4G,CAAA,MACR,KAAK,gBAAgB5G,QAAK4G,CAAA,CAAwB,GAClD1G,EAAA,MAAK0G,GAA2B,MAAA,IAE7B2C,GAAY,QAAQ,KACvBrJ,EAAA,MAAK0G,GAA2B,KAAK;AAAA,IACpC;AAAA,IACA,MACQ,KAAK,SAAS;AAAA,MACpB;AAAA,MACA2C,EAAY;AAAA,OACXA,EAAY,OAAO,KAAK,KAAK,eAAe;AAAA,IAAA;AAAA,IAG/C,MAAM,KAAK,eAAe,UAAUA,GAAY,OAAO;AAAA,EAAA,CACxD,GAGGvJ,QAAK6G,CAAA,MACR,KAAK,gBAAgB7G,QAAK6G,CAAA,CAAuB,GACjD3G,EAAA,MAAK2G,GAA0B,MAAA,IAE5B0C,GAAY,QAAQ,SACvBrJ,EAAA,MAAK2G,GAA0B,KAAK;AAAA,IACnC;AAAA,IACA,MACQ,KAAK,SAAS;AAAA,MACpB;AAAA,MACA0C,EAAY;AAAA,MACZ,KAAK,eAAe,UAAUA,EAAY,OAAO,KAAK,eAAe;AAAA,IAAA;AAAA,IAGvE,MAAM,KAAK,eAAe,UAAUA,GAAY,OAAO;AAAA,EAAA,CACxD;AAEF;AAEMvC,KAA8B,eAACkC,GAAoC;AACxE,EAAIlJ,QAAK2G,CAAA,MACR,KAAK,gBAAgB3G,QAAK2G,CAAA,CAAmB,GAC7CzG,EAAA,MAAKyG,GAAsB,MAAA,IAExBuC,IAEHhJ,EAAA,MAAKyG,GAAsB,KAAK;AAAA,IAC/B;AAAA,IACA,MACkB3G,EAAA,MAAKyG,CAAA,EAAS,0BAAA,EAE7B;AAAA,MAAI,CAAC+C,MACL,KAAK,SAAS;AAAA,QACbA,EAAY,SAASA,EAAY,iBAC9B,2CACA;AAAA,QACHA,EAAY;AAAA,QACZA,EAAY;AAAA,QACZA,EAAY;AAAA,QACZA,EAAY;AAAA,MAAA;AAAA,IACb,EAEA,KAAK,IAAI;AAAA,IAEZ,MACQ,CAACxJ,EAAA,MAAKyG,CAAA,EAAS,6BAAA;AAAA,EACvB,CACD,IAGAvG,EAAA,MAAKyG,GAAsB,KAAK;AAAA,IAC/B;AAAA,IACA,MAAM;AACL,YAAM8C,IAAWzJ,EAAA,MAAKyG,CAAA,EACpB,kCAAA,EAEA,OAAO,CAACd,GAAGtI,GAAGuI,MAAMA,EAAE,QAAQD,CAAC,MAAMtI,CAAC,EAEtC,KAAK,IAAI;AACX,aAAO,KAAK,SAAS;AAAA,QACpB,KAAK,WACF,gDACA;AAAA,QACHoM;AAAA,MAAA;AAAA,IAEF;AAAA,IACA,MACQ,CAACzJ,EAAA,MAAKyG,CAAA,EAAS,oCAAA;AAAA,EACvB,CACD;AAEF;AAwBAQ,KAAwB,WAAG;AAC1B,SAAI,KAAK,aAAa,QAAQ,KAAK,eAAe,WAAW,IACrDvI;AAAA,MACJ0B,SAAK0G,GAAAI,EAAA,EAAL,KAAA,IAAA,CAA0B,IAAI9G,GAAA,MAAK0G,OAAL,KAAA,IAAA,CAAyB;AAAA,0BAEhD,KAAK,gBAAgB,KACxBpI;AAAA,WACCsB,EAAA,MAAKyG,CAAA,EAAS,sBAAsB,EAAE,KAAK,EAAE;AAAA,YAC5C,KAAK,SAAS,KAAK,sBAAsB,CAAC,kCAE5C6C;AAET;AAEApC,KAAmB,WAAG;AACrB,SAAI,KAAK,eAAe,KAAK,eAAe,SAAS,IAAUoC,IAExD5K;AAAA;AAAA;AAAA,YAGG,KAAK,aAAa,MAAS,KAAK,SAAS,UAAU,KAAQ,YAAY,SAAS;AAAA,YAChF,KAAK,sBAAsB,KAAK,gBAAgB,EAAE;AAAA,WACnDsB,EAAA,MAAKyG,CAAA,EAAS,sBAAsB,EAAE,KAAK,EAAE;AAAA,gBACxC,KAAK,WAAW;AAAA;AAE/B;AAEAU,KAAkB,WAAG;AACpB,SAAI,KAAK,WAAiBmC,IACtB,KAAK,eAAe,KAAK,eAAe,SAAS,IAAUA,IAExD5K;AAAA;AAAA,YAEG,KAAK,SAAS,KAAK,6BAA6B,CAAC;AAAA;AAAA,WAElDsB,EAAA,MAAKyG,CAAA,EAAS,oBAAoB,EAAE,KAAK,EAAE;AAAA,gBACtC,KAAK,WAAW;AAAA;AAAA;AAAA;AAI/B;AArUYiC,EAuUI,SAAS;AAAA,EACxBlH;AAAA,EACA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0DD;AApWWC,EAAA;AAAA,EADVuC,EAAS,EAAE,MAAM,QAAQ,WAAW,YAAY,SAAS,IAAM;AAAA,GA9BpDsH,EA+BD,WAAA,WAAA,CAAA;AAiBA7J,EAAA;AAAA,EADVuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GA/ClBsH,EAgDD,WAAA,iBAAA,CAAA;AAQH7J,EAAA;AAAA,EADPC,EAAA;AAAM,GAvDK4J,EAwDJ,WAAA,YAAA,CAAA;AAGA7J,EAAA;AAAA,EADPC,EAAA;AAAM,GA1DK4J,EA2DJ,WAAA,cAAA,CAAA;AAGA7J,EAAA;AAAA,EADPC,EAAA;AAAM,GA7DK4J,EA8DJ,WAAA,gBAAA,CAAA;AAGA7J,EAAA;AAAA,EADPC,EAAA;AAAM,GAhEK4J,EAiEJ,WAAA,sBAAA,CAAA;AAGA7J,EAAA;AAAA,EADPC,EAAA;AAAM,GAnEK4J,EAoEJ,WAAA,iBAAA,CAAA;AAGA7J,EAAA;AAAA,EADPC,EAAA;AAAM,GAtEK4J,EAuEJ,WAAA,kBAAA,CAAA;AAGA7J,EAAA;AAAA,EADPC,EAAA;AAAM,GAzEK4J,EA0EJ,WAAA,eAAA,CAAA;AA1EIA,IAAN7J,EAAA;AAAA,EADNE,EAAc,wBAAwB;AAAA,GAC1B2J,CAAA;ACrGN,MAAMgB,WACJC,GAST;AAAA,EA4CC,YAAYnO,GAAyB;AACpC,UAAMA,GAAM+C,IAAgC8B,EAA8B,GA3C3E,KAAS,aAAa,KAAK,QAAQ,iBAAiB,CAACxE,MAAOA,IAAKA,EAAE,cAAc,OAAQ,MAAU,GACnG,KAAS,UAAU,KAAK,QAAQ,iBAAiB,CAACA,MAAOA,IAAKA,EAAE,WAAW,OAAQ,MAAU,GAC7F,KAAS,cAAc,KAAK,QAAQ,iBAAiB,CAACA,MAAMA,GAAG,KAAK,GACpE,KAAS,oBAAoB,KAAK,WAAW,iBAAiB,CAACA,MAAMA,GAAG,qBAAqB,EAAE,GAC/F,KAAS,sBAAsB,KAAK,WAAW,iBAAiB,CAACA,MAAMA,GAAG,eAAe,GACzF,KAAS,QAAQ,KAAK,WAAW,iBAAiB,CAACA,MAAMA,GAAG,SAAS,EAAE,GACvE,KAAS,gBAAgB,KAAK,WAAW;AAAA,MAAiB,CAACA,MAC1DA,IAAI,CAACA,EAAE,cAAc,GAAGA,EAAE,cAAc,CAAC,IAAI;AAAA,IAAA,GAE9C,KAAS,kCAAkC,KAAK,WAAW;AAAA,MAAiB,CAACA,MAC5EA,IAAKA,EAAE,mCAAmC,KAAS;AAAA,IAAA,GAQpD,KAAS,oBAAoB,KAAK,WAAW,iBAAiB,CAACA,MAAMA,GAAG,kBAAkB,EAAI,GAE9F,KAAA+N,KAA6B,IAAIhO,GAAsB,CAAA,GAAI,CAACC,MAAMA,CAAC,GACnE,KAAS,4BAA4B,KAAK+N,GAA2B,aAAA,GAKrE,KAAAC,KAAY,IAAInO,GAAgB,EAAK,GACrC,KAAS,WAAW,KAAKmO,GAAU,aAAA,GAEnC,KAAAC,KAAa,IAAIpO,GAAgB,EAAK,GACtC,KAAS,YAAY,KAAKoO,GAAW,aAAA,GAErC,KAAAC,KAAmB,IAAI9H,GAAe,MAAS,GAC/C,KAAS,kBAAkB,KAAK8H,GAAiB,aAAA,GAEjD,KAAS,kBAAkBC;AAAA,MAC1B,CAAC,KAAK,gCAAgC,KAAK,+BAA+B;AAAA,MAC1E,CAAC,CAACpE,GAAGqE,CAAC,MAAMrE,MAAM,MAAQqE,MAAM;AAAA,IAAA,GAGjC,KAAS,eAAe,IAAIC,GAAyB,IAAI;AAAA,EAIzD;AAAA,EA/BO,mBAAiD;AACvD,UAAMrO,IAAI,KAAK,WAAW,SAAA;AAC1B,QAAKA;AACL,aAAO,CAACA,EAAE,cAAc,GAAGA,EAAE,cAAc,CAAC;AAAA,EAC7C;AAAA,EAGA+N;AAAA,EAEO,+BAA+B;AACrC,WAAO,KAAKA,GAA2B,SAAA;AAAA,EACxC;AAAA,EAEAC;AAAA,EAGAC;AAAA,EAGAC;AAAA,EAcA,cAAc5M,GAAiB;AAC9B,WAAO,KAAK,QAAQ,iBAAiB,CAACtB,MAAMA,GAAG,OAAO,KAAK,CAACA,MAAMA,EAAE,QAAQsB,CAAO,GAAG,KAAK;AAAA,EAC5F;AAAA,EAEA,SAASA,GAAiB;AACzB,WAAO,KAAK,WAAW,iBAAiB,CAACtB,MAAMA,GAAG,OAAO,KAAK,CAACA,MAAMA,EAAE,QAAQsB,CAAO,CAAC;AAAA,EACxF;AAAA,EAEA,iBAAiBA,GAAiBwH,GAAoC;AACrE,UAAMwF,IAAc,KAAK,QAAQ;AACjC,QAAI,CAACA,EAAa;AAClB,UAAM5M,IAAQE;AAAA,MACb0M,GAAa,SAAS,CAAA;AAAA,MACtB;AAAA,QACC,KAAKhN;AAAA,QACL,OAAOwH;AAAA,MAAA;AAAA,MAER,CAAC9I,MAAMA,EAAE;AAAA,IAAA;AAEV,SAAK,QAAQ,OAAO,EAAE,OAAA0B,EAAA,CAAO;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,cAAc6M,GAAoB;AACjC,QAAI,CAAC,KAAK,SAAU;AACpB,UAAMC,IAAgB,KAAK,SAAS,iBAAA;AAIpC,QAHI,CAACA,MAELD,IAAa,KAAKE,GAAgBF,GAAY,KAAK,6BAAA,GAAgCC,CAAa,GAC5FD,MAAe,KAAK,iBAAiB;AACzC,UAAMG,IAAc,KAAK,QAAQ,SAAA;AACjC,IAAKA,KACL,KAAK,QAAQ,SAAS;AAAA,MACrB,GAAGA;AAAA,MACH,YAAAH;AAAA,IAAA,CACA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB;AACf,WAAO,KAAK,QAAQ,SAAA,GAAY;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAWI,GAAiB;AAC3B,UAAMC,IAAS,KAAK,iBAAA;AAGpB,QAFI,CAACA,MACLD,IAAU,KAAK,IAAIC,EAAO,CAAC,GAAG,KAAK,IAAID,GAASC,EAAO,CAAC,CAAC,CAAC,GACtDD,MAAY,KAAK,cAAc;AACnC,UAAMD,IAAc,KAAK,QAAQ,SAAA;AACjC,IAAKA,KACL,KAAK,QAAQ,SAAS;AAAA,MACrB,GAAGA;AAAA,MACH,SAAAC;AAAA,IAAA,CACA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa;AACZ,WAAO,KAAK,QAAQ,SAAA,GAAY;AAAA,EACjC;AAAA,EAEmB,cAAc;AAChC,SAAKE,GAAA;AAAA,EACN;AAAA,EAEmB,cAAc;AAEhC,IADA,KAAK,aAAa,kBAAkB,KAAK,QAAQ,GAC5C,KAAK,aAEV,KAAKA,GAAA,GAEL,KAAK;AAAA,MACJ,KAAK;AAAA,MACL,CAACC,MAAQ;AACR,aAAK;AAAA,UACJA,IAAM,KAAK,UAAU,mBAAmBA,CAAG,IAAI;AAAA,UAC/C,CAACC,MAAc;AACd,YAAIA,MAAc,UAClB,KAAKd,GAAW,SAASc,CAAS;AAAA,UACnC;AAAA,UACA;AAAA,QAAA;AAAA,MAEF;AAAA,MACA;AAAA,IAAA,GAID,KAAK;AAAA,MACJC,EAAgB,CAAC,KAAK,eAAe,KAAK,mBAAmB,KAAK,SAAS,aAAa,CAAC;AAAA,MACzF,CAAC,CAACC,GAAeC,GAAmBV,CAAa,MAAM;AACtD,YAAI,CAACA,KAAiB,CAACS,EAAe;AACtC,cAAME,IAA4BD,IAC/BA,EACC,OAAO,CAAClP,MAAMA,EAAE,cAAcwO,CAAa,EAC3C,IAAI,CAACxO,MAAMA,EAAE,UAAU,EACvB,KAAK,CAAC+J,GAAGqE,MAAOrE,IAAIqE,IAAI,IAAIA,IAAIrE,IAAI,KAAK,CAAE,IAC5C,CAAA;AACH,aAAKgE,GAA2B,SAASoB,CAAyB;AAClE,cAAMC,IAA+BD,EAA0B,SAAS,GAClEE,IAAoBJ,EAAc,CAAC,MAAMA,EAAc,CAAC,GACxDK,IAAWF,KAAgCC;AAEjD,aAAKrB,GAAU,SAASsB,CAAQ;AAAA,MACjC;AAAA,MACA;AAAA,IAAA,GAID,KAAK;AAAA,MACJN,EAAgB,CAAC,KAAK,qBAAqB,KAAK,SAAS,aAAa,CAAC;AAAA,MACvE,CAAC,CAACO,GAAqBf,CAAa,MAAM;AACzC,aAAKN,GAAiB,SAASqB,KAAuBf,CAAa;AAAA,MACpE;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EAEAK,KAAwB;AACvB,IAAI,CAAC,KAAK,YAAY,CAAC,KAAK,aAG5B,KAAK;AAAA,MACJG,EAAgB,CAAC,KAAK,OAAO,KAAK,WAAW,CAAC;AAAA,MAC9C,CAAC,CAACtN,GAAO8N,CAAW,MAAM;AACzB,YAAI,CAAC9N,KAAS,CAAC8N,EAAa;AAG5B,aADC9N,EAAM,WAAW8N,EAAY,UAAU9N,EAAM,MAAM,CAACK,MAASyN,EAAY,KAAK,CAAC3N,MAAMA,EAAE,QAAQE,EAAK,GAAG,CAAC,OAC/E,IAAO;AAChC,gBAAM2M,IAAc,KAAK,QAAQ,SAAA;AACjC,cAAI,CAACA,EAAa;AAClB,eAAK,QAAQ,SAAS;AAAA,YACrB,GAAGA;AAAA,YACH,OAAOc,EAAY,IAAI,CAACxP,MAAO0B,EAAM,KAAK,CAACG,MAAMA,EAAE,QAAQ7B,EAAE,GAAG,IAAIA,IAAI,EAAE,KAAKA,EAAE,KAAK,OAAO,GAAC,CAAI;AAAA,UAAA,CAClG;AAAA,QACF;AAAA,MACD;AAAA,MACA;AAAA,IAAA,GAID,KAAK;AAAA,MACJgP,EAAgB,CAAC,KAAK,YAAY,KAAK,2BAA2B,KAAK,SAAS,aAAa,CAAC;AAAA,MAC9F,CAAC,CAACT,GAAYY,GAA2BX,CAAa,MAAM;AAC3D,YAAI,CAACA,KAAiBD,MAAe,OAAW;AAChD,cAAMkB,IAAgB,KAAKhB;AAAA,UAC1BF,KAAcC;AAAA,UACdW;AAAA,UACAX;AAAA,QAAA;AAED,YAAIiB,MAAkBlB,GAAY;AACjC,gBAAMG,IAAc,KAAK,QAAQ,SAAA;AACjC,cAAI,CAACA,EAAa;AAClB,eAAK,QAAQ,SAAS;AAAA,YACrB,GAAGA;AAAA,YACH,YAAYe;AAAA,UAAA,CACZ;AAAA,QACF;AAAA,MACD;AAAA,MACA;AAAA,IAAA,GAID,KAAK;AAAA,MACJT,EAAgB,CAAC,KAAK,eAAe,KAAK,OAAO,CAAC;AAAA,MAClD,CAAC,CAACJ,GAAQD,CAAO,MAAM;AACtB,YAAI,CAACC,KAAUD,MAAY,OAAW;AACtC,cAAMe,IAAa,KAAK,IAAId,EAAO,CAAC,GAAG,KAAK,IAAID,KAAW,GAAGC,EAAO,CAAC,CAAC,CAAC;AACxE,YAAIc,MAAef,GAAS;AAC3B,gBAAMD,IAAc,KAAK,QAAQ,SAAA;AACjC,cAAI,CAACA,EAAa;AAClB,eAAK,QAAQ,SAAS;AAAA,YACrB,GAAGA;AAAA,YACH,SAASgB;AAAA,UAAA,CACT;AAAA,QACF;AAAA,MACD;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EAEmB,kBAAkB;AAAA,EAAC;AAAA,EAEtCjB,GAAgBF,GAAoBY,GAAqCX,GAAuB;AAC/F,QAAIW,EAA0B,SAAS,GAAG;AAEzC,YAAMM,IACLE,GAAwBpB,GAAYY,GAA2BX,CAAa,KAAKA;AAClF,UAAIiB,MAAkBlB;AACrB,eAAOkB;AAAA,IAET;AAEC,aAAOjB;AAER,WAAOD;AAAA,EACR;AAAA,EAEA,MAAM,kBAAkB;AACvB,QAAI,CAAC,KAAK,SAAU;AAEpB,UAAMqB,IAAyB,MAAM,KAAK,WAAWC,EAA4B,GAC3EzI,IAAkB,MAAM,KAAK,WAAWC,EAAoB,GAC5DL,IAAmB,MAAM,KAAK,WAAWC,EAA8B;AAC7E,QAAI,CAACD;AACJ,YAAM,IAAI,MAAM,4BAA4B;AAG7C,UAAM8I,IAAgBF,GAAwB,QAAA,GACxCG,IAAgB3I,GAAiB,SAAA,GACjC4I,IAAa,KAAK,QAAA,GAElBC,IAAYH,IACf,GAAGA,CAAa,MAAMC,CAAa,MAAMC,CAAU,KACnD,GAAGD,CAAa,MAAMC,CAAU,IAE7B1G,IAAS,KAAK,UAAA;AACpB,QAAI,CAACA;AACJ,YAAM,IAAI,MAAM,iBAAiB;AAElC,UAAMpH,IAAU,KAAK,WAAA,GACfC,IAAW,KAAK,YAAA,GAChB+N,IAAS,KAAK,UAAA,GAEdC,KAAcjO,IAAU,CAAC,gBAAgBA,CAAO,CAAC,IAAI,CAAA,GACrDkO,IAAejO,IAAW,CAAC,gBAAgBA,CAAQ,CAAC,IAAI,CAAA,GACxDkO,IAAUH,IAAS,CAAC,gBAAgBA,CAAM,CAAC,IAAI,CAAA;AAGrD,IAAA3G,GAA0BD,GAAQ,OAAOE,OAAU;AAClD,YAAMtH,KAAU,KAAK,SAAU,aAAasH,GAAM,UAAU;AAC5D,UAAI,CAACtH;AACJ,cAAM,IAAI,MAAM,kBAAkB;AAInC,UAFAiO,GAAY,KAAK,gBAAgBjO,EAAO,CAAC,GAErCsH,GAAM,aAAa;AACtB,cAAMrH,KAAW,KAAK,SAAU,cAAcqH,GAAM,WAAW;AAC/D,QAAIrH,MACHiO,EAAa,KAAK,gBAAgBjO,EAAQ,CAAC;AAAA,MAE7C;AAAA,IACD,CAAC;AAED,UAAMoG,KAAwC;AAAA,MAC7C,QAAQ;AAAA,QACP,CAACkB,EAA2C,GAAGH,IAAS,CAAC,gBAAgBA,CAAM,CAAC,IAAI;AAAA,MAAA;AAAA,MAErF,aAAA6G;AAAA,MACA,cAAAC;AAAA,MACA,QAAQC;AAAA,IAAA;AAGT,IAAArJ,EAAiB,MAAM;AAAA,MACtB,MAAM,KAAK,0BAAA;AAAA,MACX,MAAMiJ;AAAA,MACN,eAAA1H;AAAA,MACA,uBAAuBpB;AAAA,IAAA,CACvB;AAAA,EACF;AACD;;;;;;;+YC/VAyD,GAAA0F,IAAAC,GAAAC,GAAAC,IAAAC,IAAA9M,IAAA+M,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAqBO,IAAMC,IAAN,cAAuCnP,EAAoD;AAAA,EAgIjG,cAAc;AACb,UAAA,GAjIK4B,EAAA,MAAAqM,CAAA,GAkCNrM,EAAA,MAAA0G,GAAW,IAAIiD,GAAyB,IAAI,CAAA,GAC5C3J,EAAA,MAAAoM,EAAA,GAeA,KAAQ,mBAAmB,IAG3B,KAAQ,eAAe,IAUvB,KAAQ,SAAS,IAoDjB,KAAQ,kBAA+E;AAAA,MACtF,YAAY;AAAA,MACZ,QAAQ,EAAE,iBAAiB,IAAO,kBAAkB,GAAA;AAAA,IAAM,GAS3D,KAAQ,cAAc,IAgPtBpM,EAAA,MAAAN,IAAU,MAAM;AACfO,MAAAA,EAAA,MAAKyG,GAAS,OAAA;AAAA,IACf,CAAA,GAOA1G,EAAA,MAAA0M,IAA6B,MAAM;AAElC,YAAMc,IAAkB,KAAK;AAC7B,UAAI,CAACA,EAAiB;AACtB,YAAMC,IAAsBD,EAAgB,sBAAA;AAE5C,UAAIC,EAAoB,UAAU,GAAG;AACpC,aAAK,0BAA0B,IAC/B,KAAK,yBAAyB,IAC9B,KAAK,0BAA0B,QAC/BtN,GAAA,MAAKiM,IAAiB,WAAWnM,EAAA,MAAKyM,EAAA,GAA4B,GAAG,CAAA;AACrE;AAAA,MACD;AAEA,YAAMgB,IAAiB,KAAK,sBAAA;AAC5B,MAAIA,EAAe,QAAQD,EAAoB,QAAQ,IACtD,KAAK,yBAAyB,KAE9B,KAAK,yBAAyB,IAG3BC,EAAe,OAAOD,EAAoB,OAAO,KACpD,KAAK,0BAA0B,IAC/B,KAAK,0BAA0B,WAE/B,KAAK,0BAA0B,iBAAiBD,CAAe,EAAE,OACjE,KAAK,0BAA0B;AAAA,IAEjC,CAAA,GAEAxN,EAAA,MAAA2M,IAA6B,CAAC7M,MACzB,GAAC,KAAK,qBAMTA,EAAS,uBACT,CAAC6N,GAA4B7N,EAAS,qBAAqB,KAAK,iBAAkB,KAI/EA,EAAS,kBAAkB,CAAC6N,GAA4B7N,EAAS,gBAAgB8N,EAAc,EAIpG,GAEA5N,EAAA,MAAA4M,IAA6B,CAACiB,OACzBA,EAAI,cACPA,EAAI,UAAU,UAAU,IAAI,6BAA6B,GACzDA,EAAI,UAAU,aAAa,QAAQ,WAAW,IAE3C,KAAK,WACDA,EAAI,YAEJlP;AAAA,MACJkP,EAAI,SAAS;AAAA;AAAA,wBAEK,KAAK,gBAAgB;AAAA,cAC/B5N,QAAKP,EAAA,CAAO;AAAA,WAGzB,GAoCAM,EAAA,MAAA6M,IAA0B,MACrB,KAAK,eACDxM,QAAKgM,GAAAS,EAAA,EAAL,KAAA,IAAA,IAEJ,KAAK,qBACD,KAAK,kBAAA,IAENzM,QAAKgM,GAAAU,EAAA,EAAL,KAAA,IAAA,CACR,GAhWC1M,EAAA,MAAKgM,GAAAE,EAAA,EAAL,KAAA,IAAA;AAAA,EACD;AAAA,EAhIA,IAAW,QAA4B;AACtC,WAAOtM,EAAA,MAAKyG,GAAS,SAAA;AAAA,EACtB;AAAA,EACA,IAAW,MAAMvK,GAA2B;AAC3C8D,IAAAA,EAAA,MAAKyG,CAAA,EAAS,SAASvK,CAAK;AAAA,EAC7B;AAAA,EAGA,IAAW,aAAiC;AAC3C,WAAO,KAAK;AAAA,EACb;AAAA,EACA,IAAW,WAAWyO,GAAyB;AAC9C,IAAI,CAACA,KAAOA,MAAQ,KAAK,gBACzB,KAAK,cAAcA,GACnB,KAAK,gBAAgB,aAAaA,GAClC,KAAK,aAAa,oBAAoBA,CAAG,GACzC3K,EAAA,MAAKyG,CAAA,EAAS,cAAckE,CAAG,GAE/B,IAAIkD;AAAA,MACH;AAAA,MACA,iBAAiBC,GAAiC,EAAE,KAAAnD,EAAA,CAAU,CAAC;AAAA,MAC/D,CAACoD,MAAgB;AAChB,aAAK,kBAAkBA,GACvB,KAAK,gBAAgB,iBAAiBA;AAAA,MACvC;AAAA,MACA;AAAA,IAAA;AAAA,EAEF;AAAA,EAsRS,oBAA0B;AAClC,UAAM,kBAAA,GAEN,KAAK;AAAA,MACJ/N,QAAKyG,CAAA,EAAS;AAAA,MACd,CAAC2D,MAAe;AACf,aAAK,cAAcA,GACnB,KAAK,aAAa,iBAAiBA,IAAaA,EAAW,SAAA,IAAa,EAAE,GAC1E,KAAK,MAAM,YAAY,sCAAsCA,IAAaA,EAAW,SAAA,IAAa,EAAE;AAAA,MACrG;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJpK,QAAKyG,CAAA,EAAS;AAAA,MACd,CAAC+D,MAAY;AACZ,aAAK,WAAWA,GAChB,KAAK,aAAa,iBAAiBA,IAAUA,EAAQ,SAAA,IAAa,EAAE,GACpE,KAAK,MAAM,YAAY,mCAAmCA,IAAUA,EAAQ,SAAA,IAAa,EAAE;AAAA,MAC5F;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJxK,QAAKyG,CAAA,EAAS;AAAA,MACd,CAAC9J,MAA0B;AAC1B,QAAIA,KACH,KAAK,aAAa,iCAAiCA,CAAqB;AAAA,MAE1E;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJqD,QAAKyG,CAAA,EAAS;AAAA,MACd,CAACuH,MAA4B;AAC5B,QAAIA,MACH,KAAK,oBAAoBA,GACzB,KAAK,aAAa,mCAAmCA,CAAuB;AAAA,MAE9E;AAAA,MACA;AAAA,IAAA,GAED,KAAK;AAAA,MACJhO,QAAKyG,CAAA,EAAS;AAAA,MACd,CAACwH,MAA2B;AAC3B,aAAK,mBAAmBA;AAAA,MACzB;AAAA,MACA;AAAA,IAAA,GAGD7N,EAAA,MAAKgM,GAAAI,EAAA,EAAL,KAAA,IAAA;AAAA,EACD;AAAA,EAEmB,QAAQ0B,GAA6E;AACvG,UAAM,QAAQA,CAAkB,IAC5BA,EAAmB,IAAI,iBAAiB,KAAKA,EAAmB,IAAI,aAAa,MACpF9N,EAAA,MAAKgM,GAAAI,EAAA,EAAL,KAAA,IAAA;AAAA,EAEF;AAAA,EA4ES,SAAS;AACjB,WAAO,KAAK,eAAe,KAAK,qBAAqB,KAAK,gBACvD9N;AAAA,OACE0B,EAAA,MAAKgM,OAAL,KAAA,IAAA,CAAsC;AAAA;AAAA;AAAA,iBAG5BpM,QAAK0M,EAAA,CAA0B;AAAA,uBACzB1M,QAAK2M,EAAA,CAA0B;AAAA,+BACvB3M,QAAK4M,EAAA,CAAuB;AAAA,gBAC3C,KAAK,eAAe;AAAA,yBACX,KAAK,qBAAqB,gCAAgC,sBAAsB;AAAA;AAAA;AAAA,QAGjGxM,EAAA,MAAKgM,OAAL,KAAA,IAAA,CAAuB;AAAA,QACvB,CAAC,KAAK,oBAAoB,KAAK,kBAC9B1N,gFACA4K,CAAO;AAAA,QACR,KAAK,mBACJ5K;AAAA,sEAC6D,CAAC,KAAK,MAAM,CAAC;AAAA,uBAE1E4K,CAAO;AAAA,QACR,KAAK,YACJ5K;AAAA,sBACa,CAACyP,MAAkBnO,EAAA,MAAKyG,GAAS,aAAa,iBAAiB0H,CAAC,CAAC;AAAA,WAC5E,KAAK,WAAW,IAAI,KAAK,QAAQ;AAAA,sCAEnC7E,CAAO;AAAA;AAAA,OAETlJ,EAAA,MAAKgM,OAAL,KAAA,IAAA,CAAqC;AAAA,QAEvC9C;AAAA,EACJ;AAAA,EAqBA,oBAAoB;AACnB,WAAO5K;AAAA;AAAA,YAEG,KAAK,MAAM;AAAA,WACZ,KAAK,KAAK;AAAA,YACT,KAAK,gBAAgB,KAAK;AAAA,kBACpB,CAAC,KAAK,QAAQ;AAAA,aACnB,KAAK,gBAAgB,MAAM;AAAA,cAC1B,KAAK,gBAAgB,OAAO;AAAA,eAC3B,KAAK,gBAAgB,QAAQ;AAAA,EAE3C;AAsND;AA5qBC+H,IAAA,oBAAA,QAAA;AACA0F,KAAA,oBAAA,QAAA;AAnCMC,IAAA,oBAAA,QAAA;AAwHNC,IAAqB,SAAC+B,GAAgF;AACrG,OAAK,kBAAkB,EAAE,GAAG,KAAK,iBAAiB,GAAGA,EAAA,GACrD,KAAK,cAAc,iBAAiB;AACrC;AASA9B,KAAK,WAAG;AAEP,OAAK;AAAA,IACJtM,QAAKyG,CAAA,EAAS;AAAA,IACd,CAAC4H,MAAoB;AACpB,WAAK,mBAAmBA,GACxBjO,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,iBAAAgC,EAAA,EAAgB,CAAE;AAAA,IAC3F;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJrO,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACkE,MAAQ;AACR,WAAK,eAAe,CAAC,CAACA,GACtBvK,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,kBAAkB,CAAC,CAAC1B,KAAM;AAAA,IACnG;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ3K,QAAKyG,CAAA,EAAS;AAAA,IACd,CAAC0E,MAAa;AACb,WAAK,YAAYA;AAAA,IAClB;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJnL,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACmE,MAAc;AACd,WAAK,mBAAmB,CAACA;AAAA,IAC1B;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ5K,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACf,MAAc;AACdtF,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,WAAA3G,GAAU;AAAA,IACxC;AAAA,IACA;AAAA,EAAA,GAED,KAAK,QAAQ1F,EAAA,MAAKyG,CAAA,EAAS,OAAO,CAACrJ,MAAUgD,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,OAAAjP,EAAA,CAAM,GAAI,IAAI,GACxF,KAAK;AAAA,IACJ4C,QAAKyG,CAAA,EAAS;AAAA,IACd,CAAC2C,MAAU;AACVhJ,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,OAAAjD,GAAM,GACnC,KAAK,SAASA;AAAA,IACf;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJpJ,QAAKyG,CAAA,EAAS;AAAA,IACd,CAAC6H,MAAS;AACTlO,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,MAAAiC,GAAK,GAClC,KAAK,QAAQA;AAAA,IACd;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJtO,QAAKyG,CAAA,EAAS;AAAA,IACd,CAAC8H,MAAY;AACZnO,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,aAAa,CAACkC,GAAQ,GACnD,KAAK,WAAWA;AAAA,IACjB;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJvO,QAAKyG,CAAA,EAAS;AAAA,IACd,CAAC+H,MAAgB;AAChB,MAAIA,MAAgB,WACpBpO,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,aAAAmC,GAAyB,GACtD,KAAK,eAAeA,GACpB,KAAK,gBAAgB,eAAeA,CAAW;AAAA,IAChD;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJxO,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACgI,MAAgB;AAChB,WAAK,eAAeA;AAAA,IACrB;AAAA,IACA;AAAA,EAAA,GAGD,KAAK;AAAA,IACJzO,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACiI,MAAS;AACT,WAAK,qBAAqBA;AAAA,IAC3B;AAAA,IACA;AAAA,EAAA,GAID,KAAK;AAAA,IACJ1O,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACtB,MAAW;AACX/E,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAAlH,GAAO;AAAA,IACrC;AAAA,IACA;AAAA,EAAA,GAED/E,EAAA,MAAKgM,GAAAG,EAAA,EAAL,KAAA,IAAA,GAEA,KAAK;AAAA,IACJvM,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACkI,MAAgB;AAChB,WAAK,2BAA2B,4BAA4B,GACxDA,KAEH,IAAId;AAAA,QACH;AAAA,QACA,kBAAkBC,GAAiC,EAAE,KAAKa,EAAA,CAAa,CAAC;AAAA,QACxE,CAACZ,MAAgB;AAChB,eAAK,mBAAmBA,GACxB,KAAK,gBAAgB,kBAAkBA;AAAA,QACxC;AAAA,QACA;AAAA,MAAA;AAAA,IAGH;AAAA,IACA;AAAA,EAAA,GAID,KAAK;AAAA,IACJ/N,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACmI,MAAe;AACf,WAAK,oBAAoBA;AAAA,IAC1B;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ5O,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACmI,MAAe;AACf,WAAK,mBAAmBA;AAAA,IACzB;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ5O,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACoI,MAAS;AACT,WAAK,4BAA4BA,GACjCzO,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,iBAAiBwC,EAAA,GAAO;AAAA,IACjG;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ7O,QAAKyG,CAAA,EAAS;AAAA,IACd,CAACoI,MAAS;AACT,WAAK,6BAA6BA,GAClCzO,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,QAAQ,EAAE,GAAG,KAAK,gBAAgB,QAAS,kBAAkBwC,EAAA,GAAO;AAAA,IAClG;AAAA,IACA;AAAA,EAAA,GAGD,KAAK;AAAA,IACJ7O,EAAA,MAAKyG,GAAS,cAAc;AAAA,IAC5B,CAAC0C,MAAgB,KAAK,cAAcA;AAAA,IACpC;AAAA,EAAA;AAEF;AAEMoD,KAAY,iBAAG;AACpB,OAAK;AAAA,IACJ,MAAMvM,EAAA,MAAKyG,CAAA,EAAS,cAAA;AAAA,IACpB,CAAC1I,MAAY;AACZqC,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,SAAAtO,GAAQ;AAAA,IACtC;AAAA,IACA;AAAA,EAAA,GAED,KAAK;AAAA,IACJ,MAAMiC,EAAA,MAAKyG,CAAA,EAAS,eAAA;AAAA,IACpB,CAACzI,MAAa;AACboC,MAAAA,EAAA,MAAKgM,GAAAC,CAAA,EAAL,KAAA,MAA2B,EAAE,UAAArO,GAAS;AAAA,IACvC;AAAA,IACA;AAAA,EAAA;AAEF;AA4DAyB,KAAA,oBAAA,QAAA;AAIA+M,KAA8B,WAAG;AAChC,eAAaxM,QAAKmM,EAAA,CAAc,GAChCjM,GAAA,MAAKiM,IAAiB,WAAWnM,EAAA,MAAKyM,EAAA,GAA4B,GAAG,CAAA;AACtE;AAEAA,KAAA,oBAAA,QAAA;AA8BAC,KAAA,oBAAA,QAAA;AAkBAC,KAAA,oBAAA,QAAA;AAmDAC,KAAA,oBAAA,QAAA;AAUAC,KAAuB,WAAG;AACzB,SAAOnO;AAAA;AAAA,aAEI,KAAK,gBAAgB,MAAM;AAAA,cAC1B,KAAK,gBAAgB,OAAO;AAAA,eAC3B,KAAK,gBAAgB,QAAQ;AAE3C;AAeAoO,KAAe,WAAG;AACjB,SAAOpO;AAAA;AAAA,YAEG,KAAK,MAAM;AAAA,WACZ,KAAK,KAAK;AAAA,YACT,KAAK,gBAAgB,KAAK;AAAA,kBACpB,CAAC,KAAK,QAAQ;AAAA,aACnB,KAAK,gBAAgB,MAAM;AAAA,cAC1B,KAAK,gBAAgB,OAAO;AAAA,eAC3B,KAAK,gBAAgB,QAAQ;AAE3C;AAEAqO,KAA+B,WAAG;AACjC,SAAI,KAAK,cAAoBzD,IACxB,KAAK,oBACL,KAAK,0BAEH5K;AAAA,UACC,KAAK,iBAAiB;AAAA,WACrB,KAAK,SAAS,KAAK,sBAAsB,CAAC;AAAA,WAC1C,KAAK,0BACV,UAAU,KAAK,uBAAuB,KACtC,EAAE,iCAPoC4K,IADNA;AASrC;AAEA0D,KAA8B,WAAG;AAChC,SAAI,KAAK,cAAoB1D,IACxB,KAAK,mBACL,KAAK,yBAEH5K;AAAA;AAAA;AAAA,YAGG,KAAK,SAAS,KAAK,sBAAsB,CAAC;AAAA,WAC3C,KAAK,gBAAgB;AAAA,MANW4K,IADNA;AASpC;AAEA2D,KAAgB,WAAG;AAClB,SAAO,KAAK,eACTvO;AAAA;AAAA,QAEG0B,EAAA,MAAKgM,GAAAc,EAAA,EAAL,KAAA,IAAA,CAAwB,IAAI9M,EAAA,MAAKgM,OAAL,KAAA,IAAA,CAAgC,IAAIhM,EAAA,MAAKgM,GAAAgB,EAAA,EAAL,KAAA,IAAA,CAAmC;AAAA,QACnGhN,EAAA,MAAKgM,OAAL,KAAA,IAAA,CAA0B;AAAA;AAAA,QAG7B9C;AACJ;AAEA4D,KAAiB,WAAG;AACnB,SAAO,KAAK,oBAAoB,KAAK,4BAClCxO;AAAA;AAAA;AAAA,aAGQ,KAAK,kBAAkB,WAAW,EAAE;AAAA,YACrC,KAAK,yBAAyB;AAAA,sBACpB,KAAK,aAAa,KAAQ,aAAa,WAAW;AAAA,OACjE,KAAK,kBACJA,gFACA4K,CAAO;AAAA,qBAEV,KAAK,qBAAqB,MAAS,KAAK,aAAa,KACpD5K;AAAA,eACSsB,QAAKP,EAAA,CAAO;AAAA,cACb,KAAK,SAAS,KAAK,6BAA6B,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,uBAI9E6J;AACL;AAEA6D,KAAyB,WAAG;AAC3B,SAAOzO;AAAA,KACJ,KAAK,gBAAgB,KAAK,6BACzBA;AAAA;AAAA;AAAA,cAGQ,KAAK,mBAAmB,YAAY,EAAE;AAAA,aACvC,KAAK,0BAA0B;AAAA;AAAA,QAEpC,KAAK,mBACJA,iFACA4K,CAAO;AAAA,sBAEVA,CAAO;AAAA;AAEZ;AAEA8D,KAA4B,WAAG;AAC9B,SAAO1O,kEAAqE,MAAMsB,EAAA,MAAKyG,CAAA,EAAS,iBAAiB;AAAA;AAAA;AAGlH;AAEA4G,KAAmB,WAAG;AACrB,SAAI,KAAK,cAAoB/D,IACtB5K;AAAA,wDAC+C,MAAMsB,EAAA,MAAKyG,CAAA,EAAS,cAAA,CAAe;AAAA;AAAA;AAAA;AAI1F;AAhmBY6G,EAkmBI,SAAS;AAAA,EACxBwB;AAAA,EACAlQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAqFemQ,EAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBtC;AA1sBWlQ,EAAA;AAAA,EADVuC,EAAS,EAAE,MAAM,QAAQ,SAAS,IAAM;AAAA,GAF7BkM,EAGD,WAAA,SAAA,CAAA;AAQAzO,EAAA;AAAA,EADVuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAVlBkM,EAWD,WAAA,cAAA,CAAA;AA2BHzO,EAAA;AAAA,EADPC,EAAA;AAAM,GArCKwO,EAsCJ,WAAA,qBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAxCKwO,EAyCJ,WAAA,oBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA3CKwO,EA4CJ,WAAA,eAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA9CKwO,EA+CJ,WAAA,YAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAjDKwO,EAkDJ,WAAA,oBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GApDKwO,EAqDJ,WAAA,gBAAA,CAAA;AAIAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAxDKwO,EAyDJ,WAAA,qBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA3DKwO,EA4DJ,WAAA,oBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA9DKwO,EA+DJ,WAAA,UAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAjEKwO,EAkEJ,WAAA,SAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GApEKwO,EAqEJ,WAAA,YAAA,CAAA;AAIAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAxEKwO,EAyEJ,WAAA,gBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA3EKwO,EA4EJ,WAAA,gBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA9EKwO,EA+EJ,WAAA,6BAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAjFKwO,EAkFJ,WAAA,8BAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GApFKwO,EAqFJ,WAAA,sBAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAvFKwO,EAwFJ,WAAA,aAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA1FKwO,EA2FJ,WAAA,2BAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA7FKwO,EA8FJ,WAAA,0BAAA,CAAA;AAGAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAhGKwO,EAiGJ,WAAA,2BAAA,CAAA;AAKRzO,EAAA;AAAA,EAFCuC,EAAS,EAAE,MAAM,SAAS,WAAW,oBAAoB,SAAS,IAAM;AAAA,GApG7DkM,EAsGZ,WAAA,oBAAA,CAAA;AAKAzO,EAAA;AAAA,EAFCuC,EAAS,EAAE,MAAM,SAAS,WAAW,mBAAmB,SAAS,IAAM;AAAA,GAzG5DkM,EA2GZ,WAAA,mBAAA,CAAA;AAKAzO,EAAA;AAAA,EAFCuC,EAAS,EAAE,MAAM,SAAS,WAAW,oBAAoB,SAAS,IAAM;AAAA,GA9G7DkM,EAgHZ,WAAA,oBAAA,CAAA;AAGQzO,EAAA;AAAA,EADPC,EAAA;AAAM,GAlHKwO,EAmHJ,WAAA,mBAAA,CAAA;AAWAzO,EAAA;AAAA,EADPC,EAAA;AAAM,GA7HKwO,EA8HJ,WAAA,eAAA,CAAA;AA9HIA,IAANzO,EAAA;AAAA,EADNE,EAAc,sBAAsB;AAAA,GACxBuO,CAAA;;;;;;ACdN,IAAM0B,KAAN,cAAqCC,GAAkB;AAAA,EACpD,SAAS;AACjB,WAAOvQ;AAAA,KACJ,MAAM,QAAQ;AAAA;AAAA;AAAA;AAAA,EAIlB;AA6BD;AApCasQ,GASI,SAAS;AAAA,EACxB,GAAGC,GAAkB;AAAA,EACrBrQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBD;AAnCYoQ,KAANnQ,GAAA;AAAA,EADNE,EAAc,oBAAoB;AAAA,GACtBiQ,EAAA;;;;;;;gZCPbE,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAiCO,IAAMC,IAAN,cACE9G,GAAkExK,CAAa,EAExF;AAAA,EA2EC,cAAc;AACb,UAAA,GA/EK4B,EAAA,MAAAwP,EAAA,GAINxP,EAAA,MAAAmP,IAAqB,IAAIQ,GAAqB,IAAI,CAAA,GAClD3P,EAAA,MAAAoP,GAAkB,IAAI7T,GAA2B,IAAI,CAAA,GAGrDyE,EAAA,MAAAqP,EAAA,GAqCArP,EAAA,MAAAsP,IAAY,EAAA,GA+JZtP,EAAA,MAAAuP,EAAA,GA3HC,KAAK,eAAeK,IAA+B,CAACtR,MAAY;AAC/D,MAAIA,IACH,KAAK;AAAA,QACJwM,EAAgB;AAAA,UACf7K,QAAKmP,CAAA,EAAgB;AAAA,UACrB9Q,EAAQ,UAAU;AAAA,UAClBA,EAAQ,UAAU;AAAA,QAAA,CAClB;AAAA,QACD,OAAO,CAACuR,GAAYC,GAAiBC,CAAe,MAAM;AACzD,cAAIF,EAAW,SAAS,MAAMC,MAAoB,MAASC,MAAoB,KAAQ;AAEtF,kBAAMC,IAAW,MAAM,QAAQ;AAAA,cAC9BH,EAAW,IAAI,OAAOlK,MAAc;AACnC,sBAAMsK,IAActK,EAAU;AAC9B,sBAAM1F,QAAKmP,CAAA,EAAgB;AAC3B,sBAAMc,IAAY,MAAMjQ,EAAA,MAAKmP,CAAA,EAAgB,aAAaa,CAAW;AACrE,uBAAIH,MAAoB,MAASI,GAAW,mBAAA,MAAyB,KAE7D,KACGH,MAAoB,MAASG,GAAW,mBAAA,MAAyB;AAAA,cAK7E,CAAC;AAAA,YAAA;AAEF,iBAAK,8BAA8BF,EAAS,OAAO,CAAClU,MAAMA,MAAM,EAAI,EAAE,SAAS,GAE3E,KAAK,+BACRmE,EAAA,MAAKkP,IAAmB,SAAS;AAAA,cAChC;AAAA,cACA;AAAA,cACA;AAAA,YAAA;AAAA,UAGH;AAAA,QACD;AAAA,QACA;AAAA,MAAA,IAGD,KAAK,2BAA2B,mBAAmB;AAAA,IAErD,CAAC,EAAE,wBAAA,GAEH,KAAK,eAAehM,IAAsB,CAAC7E,MAAY;AACtD,WAAK;AAAA,QACJA,GAAS;AAAA,QACT,CAAC6R,MAAa;AACb,UAAIA,MAEHlQ,EAAA,MAAKkP,EAAA,EAAmB,YAAYgB,CAAQ,GAC5ClQ,EAAA,MAAKkP,IAAmB,WAAA;AAAA,QAE1B;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC,GAGD,KAAK,eAAehM,IAAsB,CAACD,MAAoB;AAC9D,WAAK;AAAA,QACJ4H,EAAgB;AAAA,UACf7K,QAAKmP,CAAA,EAAgB;AAAA,UACrBnP,QAAKmP,CAAA,EAAgB;AAAA,UACrBnP,QAAKmP,CAAA,EAAgB;AAAA,UACrBnP,QAAKmP,CAAA,EAAgB;AAAA,QAAA,CACrB,EAAE,KAAKgB,GAAa,EAAE,CAAC;AAAA,QACxB,CAAC,CAACxL,GAASyL,GAAUpS,GAAUkO,CAAO,MAAM;AAC3C,cAAIvH,EAAQ,WAAW,GAAG;AACzB,gBAAI,KAAK,UAAU;AAClB;AAED,kBAAM,QAAQ;AAAA,UACf,OAAO;AACN,kBAAM0L,IAAW;AAAA,cAChB,GAAG,MAAM;AAAA,cACT,QAAQ,EAAE,CAAC/K,EAA2C,GAAGX,EAAA;AAAA,cACzD,aAAayL;AAAA,cACb,cAAcpS;AAAA,cACd,QAAQkO;AAAA,YAAA;AAET,gBAAIoE,GAAqB,KAAK,OAAOD,CAAQ;AAC5C;AAED,kBAAM,QAAQA;AAAA,UACf;AAIA,UAAIrQ,EAAA,MAAKoP,EAAA,MAAe,UAAa,MAAM,UAAU,UAIrDnM,GAAiB,SAAS,MAAM,KAAK;AAAA,QACtC;AAAA,QACA;AAAA,MAAA,GAGD,KAAK;AAAA,QACJA,GAAiB;AAAA,QACjB,CAACsN,MAAU;AACV,UAAAvQ,EAAA,MAAKmP,CAAA,EAAgB,iBAAiBoB,CAAK;AAAA,QAC5C;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC,GAED,KAAK,eAAe7E,IAA8B,CAACrN,MAAY;AAC9D,MAAA2B,EAAA,MAAKmP,CAAA,EAAgB,aAAa9Q,GAAS,cAAc;AAAA,IAC1D,CAAC;AAAA,EACF;AAAA,EArLA,IAAW,OAAO8E,GAAuD;AACxE,QAAI,CAACA,EAAQ;AAEb,UAAMqN,IAASrN,EAAO,gBAA8C,QAAQ,KAAK,CAAA;AACjF,IAAAnD,EAAA,MAAKmP,CAAA,EAAgB,cAAcqB,CAAM;AAEzC,UAAMhU,IAAc2G,EAAO,gBAA0C,aAAa,KAAK,CAAA;AACvF,IAAAnD,EAAA,MAAKmP,CAAA,EAAgB,eAAe3S,CAAW;AAE/C,UAAMiU,IAA4BtN,EAAO,gBAAyB,2BAA2B;AAC7F,IAAAnD,EAAA,MAAKmP,CAAA,EAAgB,qBAAqBsB,CAAyB,GAEnE,KAAK,MAAM,WAAWtN,EAAO,gBAAwB,kBAAkB,KAAK,IAG5EnD,EAAA,MAAKmP,CAAA,EAAgB,uBAAuBhM,CAAM;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAW,SAASjH,GAAO;AAC1B,IAAAgE,GAAA,MAAKmP,IAAYnT,CAAA,GAEb8D,QAAKqP,EAAA,IACRrP,EAAA,MAAKmP,CAAA,EAAgB,cAAc,oBAAA,IAEnCnP,EAAA,MAAKmP,CAAA,EAAgB,cAAc,uBAAA;AAAA,EAErC;AAAA,EACA,IAAW,WAAW;AACrB,WAAOnP,EAAA,MAAKqP,EAAA;AAAA,EACb;AAAA,EAOA,IAAoB,MAAMnT,GAA2C;AAGpE,QAFAgE,GAAA,MAAKkP,IAAalT,CAAA,GAEd,CAACA,GAAO;AACX,YAAM,QAAQ;AACd;AAAA,IACD;AAEA,UAAMwU,IAAgDxU,IAAQ,EAAE,GAAGA,EAAA,IAAU,CAAA;AAC7E,IAAAwU,EAAa,WAAW,CAAA,GACxBA,EAAa,gBAAgB,CAAA,GAC7BA,EAAa,iBAAiB,CAAA,GAC9BA,EAAa,WAAW,CAAA,GACxB,MAAM,QAAQA,GAEd1Q,EAAA,MAAKmP,CAAA,EAAgB,WAAW,MAAM,MAAM,OAAO7J,EAA2C,KAAK,EAAE,GACrGtF,EAAA,MAAKmP,CAAA,EAAgB,YAAY,MAAM,MAAM,WAAW,GACxDnP,EAAA,MAAKmP,CAAA,EAAgB,YAAY,MAAM,MAAM,YAAY,GACzDnP,EAAA,MAAKmP,CAAA,EAAgB,WAAW,MAAM,MAAM,MAAM;AAAA,EACnD;AAAA,EACA,IAAoB,QAA4C;AAC/D,WAAO,MAAM;AAAA,EACd;AAAA,EAwHmB,aAAajB,GAA6E;AAC5G,UAAM,aAAaA,CAAkB,GAErC,KAAK,QAAQlO,EAAA,MAAKmP,CAAA,EAAgB,aAAa,CAACwB,MAAgB;AAC/D,MAAIA,MACH,KAAK,iBAAiBA,GACtB,KAAK,MAAM,YAAY,kCAAkCA,EAAY,UAAU;AAAA,IAEjF,CAAC;AAAA,EACF;AAAA,EAcS,SAAS;AACjB,WAAI,KAAK,8BACDrH,IAED5K;AAAA,KACJkS,GAAIxQ,GAAA,MAAKmP,IAAAC,EAAA,CAAsB,CAAC;AAAA,cACvB,IAAI;AAAA,oBACE,KAAK,cAAc;AAAA,EACtC;AAsBD;AAlPCN,KAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAGAC,KAAA,oBAAA,QAAA;AAqCAC,KAAA,oBAAA,QAAA;AA+JAC,KAAA,oBAAA,QAAA;AA5MMC,KAAA,oBAAA,QAAA;AA6MNC,KAAsB,SAAChH,GAAoC;AAC1D,EAAIxI,EAAA,MAAKsP,QAA2B9G,MAChCxI,QAAKsP,EAAA,KACR,KAAK,yBAAyBtP,QAAKsP,EAAA,CAA6B,GAEjEpP,GAAA,MAAKoP,IAAyB9G,CAAA,GAC1BA,KACH,KAAK,sBAAsBA,CAAc;AAE3C;AAtNYiH,EAkOI,SAAS;AAAA,EACxBjO;AAAA,EACA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBD;AArMQC,GAAA;AAAA,EADPC,EAAA;AAAM,GA/CK2Q,EAgDJ,WAAA,kBAAA,CAAA;AAGY5Q,GAAA;AAAA,EADnBuC,EAAS,EAAE,WAAW,GAAA,CAAO;AAAA,GAlDlBqO,EAmDQ,WAAA,SAAA,CAAA;AAyBZ5Q,GAAA;AAAA,EADPC,EAAA;AAAM,GA3EK2Q,EA4EJ,WAAA,+BAAA,CAAA;AA5EIA,IAAN5Q,GAAA;AAAA,EADNE,EAAc,mCAAmC;AAAA,GACrC0Q,CAAA;AAwPb,MAAAoB,KAAepB;"}