{"version":3,"file":"clipboard-entry-picker-modal.token-BGyy-GGP.js","sources":["../../../src/packages/clipboard/clipboard-entry/picker/clipboard-entry-picker.element.ts","../../../src/packages/clipboard/clipboard-entry/picker-modal/clipboard-entry-picker-modal.token.ts"],"sourcesContent":["import { UmbClipboardCollectionRepository } from '../../collection/index.js';\r\nimport type { UmbClipboardEntryDetailModel } from '../types.js';\r\nimport { css, customElement, html, property, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbEntityContext } from '@umbraco-cms/backoffice/entity';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport {\r\n\tUmbRequestReloadChildrenOfEntityEvent,\r\n\tUmbRequestReloadStructureForEntityEvent,\r\n} from '@umbraco-cms/backoffice/entity-action';\r\nimport { UmbSelectionManager } from '@umbraco-cms/backoffice/utils';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\n\r\n// TODO: make this into an extension point (Picker) with two kinds of pickers: tree-item-picker and collection-item-picker;\r\n@customElement('umb-clipboard-entry-picker')\r\nexport class UmbClipboardEntryPickerElement extends UmbLitElement {\r\n\t@property({ type: Array })\r\n\tselection: Array<UmbEntityUnique> = [];\r\n\r\n\t@property({ type: Object })\r\n\tconfig?: any;\r\n\r\n\t@state()\r\n\tprivate _items: Array<UmbClipboardEntryDetailModel> = [];\r\n\r\n\t#collectionRepository = new UmbClipboardCollectionRepository(this);\r\n\t#selectionManager = new UmbSelectionManager(this);\r\n\t#entityContext = new UmbEntityContext(this);\r\n\t#actionEventContext?: typeof UMB_ACTION_EVENT_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#entityContext.setEntityType('clipboard-entry');\r\n\t\tthis.#entityContext.setUnique(null);\r\n\t}\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#selectionManager.setSelectable(true);\r\n\t\tthis.#selectionManager.setMultiple(this.config?.multiple ?? false);\r\n\t\tthis.#selectionManager.setSelection(this.selection ?? []);\r\n\r\n\t\tthis.observe(this.#selectionManager.selection, (selection) => {\r\n\t\t\tthis.selection = selection;\r\n\t\t});\r\n\r\n\t\tthis.#listenToEntityEvents();\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tthis.#requestItems();\r\n\t}\r\n\r\n\tasync #requestItems() {\r\n\t\tconst { data } = await this.#collectionRepository.requestCollection({\r\n\t\t\ttypes: this.config?.entryTypes ?? [],\r\n\t\t});\r\n\r\n\t\tconst entries = data?.items ?? [];\r\n\t\tconst sortedEntries = entries.sort((a, b) => new Date(b.updateDate!).getTime() - new Date(a.updateDate!).getTime());\r\n\r\n\t\tif (this.config?.filter) {\r\n\t\t\tthis._items = sortedEntries.filter(this.config.filter);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.config?.asyncFilter) {\r\n\t\t\tconst promises = Promise.all(sortedEntries.map(this.config.asyncFilter));\r\n\t\t\tconst results = await promises;\r\n\t\t\tthis._items = sortedEntries.filter((_, index) => results[index]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._items = sortedEntries;\r\n\t}\r\n\r\n\tasync #listenToEntityEvents() {\r\n\t\tthis.consumeContext(UMB_ACTION_EVENT_CONTEXT, (context) => {\r\n\t\t\tthis.#actionEventContext = context;\r\n\r\n\t\t\tcontext?.removeEventListener(\r\n\t\t\t\tUmbRequestReloadStructureForEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadStructureRequest as unknown as EventListener,\r\n\t\t\t);\r\n\r\n\t\t\tcontext?.removeEventListener(\r\n\t\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadChildrenRequest as unknown as EventListener,\r\n\t\t\t);\r\n\r\n\t\t\tcontext?.addEventListener(\r\n\t\t\t\tUmbRequestReloadStructureForEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadStructureRequest as unknown as EventListener,\r\n\t\t\t);\r\n\r\n\t\t\tcontext?.addEventListener(\r\n\t\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadChildrenRequest as unknown as EventListener,\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t#onReloadStructureRequest = (event: UmbRequestReloadStructureForEntityEvent) => {\r\n\t\tconst hasItem = this._items.some((item) => item.unique === event.getUnique());\r\n\t\tif (hasItem) {\r\n\t\t\tthis.#requestItems();\r\n\t\t}\r\n\t};\r\n\r\n\t#onReloadChildrenRequest = async (event: UmbRequestReloadChildrenOfEntityEvent) => {\r\n\t\t// check if the collection is in the same context as the entity from the event\r\n\t\tconst unique = this.#entityContext.getUnique();\r\n\t\tconst entityType = this.#entityContext.getEntityType();\r\n\r\n\t\tif (unique === event.getUnique() && entityType === event.getEntityType()) {\r\n\t\t\tthis.#requestItems();\r\n\t\t}\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn when(\r\n\t\t\tthis._items.length > 0,\r\n\t\t\t() =>\r\n\t\t\t\trepeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => this.#renderItem(item),\r\n\t\t\t\t),\r\n\t\t\t() => html`<p>There are no items in the clipboard.</p>`,\r\n\t\t);\r\n\t}\r\n\r\n\t#renderItem(item: UmbClipboardEntryDetailModel) {\r\n\t\tconst label = item.name ?? item.unique;\r\n\t\treturn html`\r\n\t\t\t<uui-menu-item\r\n\t\t\t\tlabel=${label}\r\n\t\t\t\ttitle=${label}\r\n\t\t\t\tselectable\r\n\t\t\t\t@selected=${() => this.#selectionManager.select(item.unique)}\r\n\t\t\t\t@deselected=${() => this.#selectionManager.deselect(item.unique)}\r\n\t\t\t\t?selected=${this.selection.includes(item.unique)}>\r\n\t\t\t\t${this.#renderItemIcon(item)} ${this.#renderItemActions(item)}\r\n\t\t\t</uui-menu-item>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItemIcon(item: UmbClipboardEntryDetailModel) {\r\n\t\tconst iconName = item.icon ?? 'icon-clipboard-entry';\r\n\t\treturn html`<umb-icon slot=\"icon\" name=${iconName}></umb-icon>`;\r\n\t}\r\n\r\n\t#renderItemActions(item: UmbClipboardEntryDetailModel) {\r\n\t\treturn html`\r\n\t\t\t<umb-entity-actions-bundle\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\t.entityType=${item.entityType}\r\n\t\t\t\t.unique=${item.unique}\r\n\t\t\t\t.label=${this.localize.string(item.name)}>\r\n\t\t\t</umb-entity-actions-bundle>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#actionEventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadStructureForEntityEvent.TYPE,\r\n\t\t\tthis.#onReloadStructureRequest as unknown as EventListener,\r\n\t\t);\r\n\r\n\t\tthis.#actionEventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\tthis.#onReloadChildrenRequest as unknown as EventListener,\r\n\t\t);\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\t--uui-menu-item-flat-structure: 1;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-clipboard-entry-picker': UmbClipboardEntryPickerElement;\r\n\t}\r\n}\r\n","import type { UmbClipboardEntryDetailModel } from '../types.js';\r\nimport { UMB_CLIPBOARD_ENTRY_PICKER_MODAL_ALIAS } from './constants.js';\r\nimport { UmbModalToken, type UmbPickerModalData, type UmbPickerModalValue } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface UmbClipboardEntryPickerModalData extends UmbPickerModalData<UmbClipboardEntryDetailModel> {\r\n\tasyncFilter?: (item: UmbClipboardEntryDetailModel) => Promise<boolean>;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface UmbClipboardEntryPickerModalValue extends UmbPickerModalValue {}\r\n\r\nexport const UMB_CLIPBOARD_ENTRY_PICKER_MODAL = new UmbModalToken<\r\n\tUmbClipboardEntryPickerModalData,\r\n\tUmbClipboardEntryPickerModalValue\r\n>(UMB_CLIPBOARD_ENTRY_PICKER_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n"],"names":["_collectionRepository","_selectionManager","_entityContext","_actionEventContext","_UmbClipboardEntryPickerElement_instances","requestItems_fn","listenToEntityEvents_fn","_onReloadStructureRequest","_onReloadChildrenRequest","renderItem_fn","renderItemIcon_fn","renderItemActions_fn","UmbClipboardEntryPickerElement","UmbLitElement","__privateAdd","UmbClipboardCollectionRepository","UmbSelectionManager","UmbEntityContext","event","item","__privateMethod","unique","__privateGet","entityType","selection","when","repeat","html","UmbRequestReloadStructureForEntityEvent","UmbRequestReloadChildrenOfEntityEvent","data","sortedEntries","a","b","results","_","index","UMB_ACTION_EVENT_CONTEXT","context","__privateSet","label","iconName","css","__decorateClass","property","state","customElement","UMB_CLIPBOARD_ENTRY_PICKER_MODAL","UmbModalToken","UMB_CLIPBOARD_ENTRY_PICKER_MODAL_ALIAS"],"mappings":"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"}