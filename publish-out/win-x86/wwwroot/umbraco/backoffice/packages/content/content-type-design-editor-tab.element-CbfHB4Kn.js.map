{"version":3,"file":"content-type-design-editor-tab.element-CbfHB4Kn.js","sources":["../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor-property.context.ts","../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor-property.element.ts","../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor-properties.element.ts","../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor-group.element.ts","../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor-tab.element.ts"],"sourcesContent":["import { UMB_PROPERTY_TYPE_CONTEXT } from './content-type-design-editor-property.context-token.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbStringState } from '@umbraco-cms/backoffice/observable-api';\r\n\r\nexport class UmbPropertyTypeContext extends UmbContextBase {\r\n\t#alias = new UmbStringState(undefined);\r\n\tpublic readonly alias = this.#alias.asObservable();\r\n\t#label = new UmbStringState(undefined);\r\n\tpublic readonly label = this.#label.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_PROPERTY_TYPE_CONTEXT);\r\n\t}\r\n\r\n\tpublic setAlias(alias: string | undefined): void {\r\n\t\tthis.#alias.setValue(alias);\r\n\t}\r\n\tpublic getAlias(): string | undefined {\r\n\t\treturn this.#alias.getValue();\r\n\t}\r\n\tpublic setLabel(label: string | undefined): void {\r\n\t\tthis.#label.setValue(label);\r\n\t}\r\n\tpublic getLabel(): string | undefined {\r\n\t\treturn this.#label.getValue();\r\n\t}\r\n\r\n\tpublic override destroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis.#alias.destroy();\r\n\t\tthis.#label.destroy();\r\n\t}\r\n}\r\n","import type { UmbContentTypePropertyStructureHelper } from '../../../structure/index.js';\r\nimport type { UmbContentTypeModel, UmbPropertyTypeModel, UmbPropertyTypeScaffoldModel } from '../../../types.js';\r\nimport { UmbPropertyTypeContext } from './content-type-design-editor-property.context.js';\r\nimport { css, html, customElement, property, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { generateAlias } from '@umbraco-cms/backoffice/utils';\r\nimport { umbConfirmModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbDataTypeDetailRepository } from '@umbraco-cms/backoffice/data-type';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_EDIT_PROPERTY_TYPE_WORKSPACE_PATH_PATTERN } from '@umbraco-cms/backoffice/property-type';\r\nimport type { UUIInputElement, UUIInputLockElement, UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n/**\r\n *  @element umb-content-type-design-editor-property\r\n *  @description - Element for displaying a property in an workspace.\r\n *  @slot editor - Slot for rendering the Property Editor\r\n */\r\n@customElement('umb-content-type-design-editor-property')\r\nexport class UmbContentTypeDesignEditorPropertyElement extends UmbLitElement {\r\n\t#context = new UmbPropertyTypeContext(this);\r\n\t#dataTypeDetailRepository = new UmbDataTypeDetailRepository(this);\r\n\t#dataTypeUnique?: string;\r\n\t#propertyUnique?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set propertyStructureHelper(value: UmbContentTypePropertyStructureHelper<UmbContentTypeModel> | undefined) {\r\n\t\tif (value === this._propertyStructureHelper) return;\r\n\t\tthis._propertyStructureHelper = value;\r\n\t\tthis.#checkInherited();\r\n\t}\r\n\tpublic get propertyStructureHelper(): UmbContentTypePropertyStructureHelper<UmbContentTypeModel> | undefined {\r\n\t\treturn this._propertyStructureHelper;\r\n\t}\r\n\tprivate _propertyStructureHelper?: UmbContentTypePropertyStructureHelper<UmbContentTypeModel> | undefined;\r\n\r\n\t/**\r\n\t * Property, the data object for the property.\r\n\t * @type {UmbPropertyTypeModel | UmbPropertyTypeScaffoldModel | undefined}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Object })\r\n\tpublic get property(): UmbPropertyTypeModel | UmbPropertyTypeScaffoldModel | undefined {\r\n\t\treturn this._property;\r\n\t}\r\n\tpublic set property(value: UmbPropertyTypeModel | UmbPropertyTypeScaffoldModel | undefined) {\r\n\t\tconst oldValue = this._property;\r\n\t\tif (value === oldValue) return;\r\n\t\tthis._property = value;\r\n\t\tthis.#context.setAlias(value?.alias);\r\n\t\tthis.#context.setLabel(value?.name);\r\n\t\tthis.#checkAliasAutoGenerate(this._property?.unique);\r\n\t\tthis.#checkInherited();\r\n\t\tthis.#setDataType(this._property?.dataType?.unique);\r\n\t\tthis.requestUpdate('property', oldValue);\r\n\t}\r\n\tprivate _property?: UmbPropertyTypeModel | UmbPropertyTypeScaffoldModel | undefined;\r\n\r\n\t@property({ type: Boolean, reflect: true, attribute: 'sort-mode-active' })\r\n\tpublic sortModeActive = false;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic editContentTypePath?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic ownerVariesByCulture?: boolean;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic ownerVariesBySegment?: boolean;\r\n\r\n\t@property({ type: Boolean, reflect: true, attribute: '_inherited' })\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _inherited?: boolean;\r\n\r\n\t@state()\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _inheritedContentTypeId?: string;\r\n\r\n\t@state()\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _inheritedContentTypeName?: string;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\tprotected editPropertyTypePath?: string;\r\n\r\n\t@state()\r\n\tprivate _dataTypeName?: string;\r\n\r\n\t@state()\r\n\tprivate _aliasLocked = true;\r\n\r\n\t#autoGenerateAlias = true;\r\n\r\n\t#checkAliasAutoGenerate(unique: string | undefined) {\r\n\t\tif (unique === this.#propertyUnique) return;\r\n\t\tthis.#propertyUnique = unique;\r\n\r\n\t\tif (this.#context.getAlias()) {\r\n\t\t\tthis.#autoGenerateAlias = false;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #checkInherited() {\r\n\t\tif (this._propertyStructureHelper && this._property) {\r\n\t\t\t// We can first match with something if we have a name [NL]\r\n\t\t\tthis.observe(\r\n\t\t\t\tawait this._propertyStructureHelper!.contentTypeOfProperty(this._property.unique),\r\n\t\t\t\t(contentType) => {\r\n\t\t\t\t\tthis._inherited =\r\n\t\t\t\t\t\tthis._propertyStructureHelper?.getStructureManager()?.getOwnerContentTypeUnique() !== contentType?.unique;\r\n\t\t\t\t\tthis._inheritedContentTypeId = contentType?.unique;\r\n\t\t\t\t\tthis._inheritedContentTypeName = contentType?.name;\r\n\t\t\t\t},\r\n\t\t\t\t'observeIsOwnerProperty',\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t#partialUpdate(partialObject: UmbPropertyTypeModel) {\r\n\t\tif (!this._property || !this._propertyStructureHelper) return;\r\n\t\tthis._propertyStructureHelper.partialUpdateProperty(this._property.unique, partialObject);\r\n\t}\r\n\r\n\t#singleValueUpdate<PropertyNameType extends keyof UmbPropertyTypeModel>(\r\n\t\tpropertyName: PropertyNameType,\r\n\t\tvalue: UmbPropertyTypeModel[PropertyNameType],\r\n\t) {\r\n\t\tif (!this._property || !this._propertyStructureHelper) return;\r\n\t\tconst partialObject: Partial<UmbPropertyTypeModel> = {};\r\n\t\tpartialObject[propertyName] = value === null ? undefined : value;\r\n\t\tthis._propertyStructureHelper.partialUpdateProperty(this._property.unique, partialObject);\r\n\t}\r\n\r\n\t#onToggleAliasLock(event: CustomEvent) {\r\n\t\tif (!this.property?.alias && (event.target as UUIInputLockElement).locked) {\r\n\t\t\tthis.#autoGenerateAlias = true;\r\n\t\t} else {\r\n\t\t\tthis.#autoGenerateAlias = false;\r\n\t\t}\r\n\r\n\t\tthis._aliasLocked = !this._aliasLocked;\r\n\t\tif (!this._aliasLocked) {\r\n\t\t\t(event.target as UUIInputElement)?.focus();\r\n\t\t}\r\n\t}\r\n\r\n\tasync #setDataType(dataTypeUnique: string | undefined) {\r\n\t\tif (!dataTypeUnique) {\r\n\t\t\tthis._dataTypeName = undefined;\r\n\t\t\tthis.#dataTypeUnique = undefined;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (dataTypeUnique === this.#dataTypeUnique) return;\r\n\t\tthis.#dataTypeUnique = dataTypeUnique;\r\n\t\tthis.#dataTypeDetailRepository.requestByUnique(dataTypeUnique).then((x) => (this._dataTypeName = x?.data?.name));\r\n\t}\r\n\r\n\tasync #requestRemove(e: Event) {\r\n\t\te.preventDefault();\r\n\t\te.stopImmediatePropagation();\r\n\t\tif (!this._property || !this._property.unique) return;\r\n\r\n\t\tconst unique = this._property.unique;\r\n\r\n\t\t// TODO: Do proper localization here: [NL]\r\n\t\tawait umbConfirmModal(this, {\r\n\t\t\theadline: `${this.localize.term('actions_delete')} property`,\r\n\t\t\tcontent: html`<umb-localize key=\"contentTypeEditor_confirmDeletePropertyMessage\" .args=${[this._property.name ?? unique]}>Are you sure you want to delete the property <strong>${this._property.name ?? unique}</strong></umb-localize></div>`,\r\n\t\t\tconfirmLabel: this.localize.term('actions_delete'),\r\n\t\t\tcolor: 'danger',\r\n\t\t});\r\n\r\n\t\tthis._propertyStructureHelper?.removeProperty(unique);\r\n\t}\r\n\r\n\t#onAliasChanged(event: UUIInputEvent) {\r\n\t\tthis.#singleValueUpdate('alias', event.target.value.toString());\r\n\t}\r\n\r\n\t#onNameChanged(event: UUIInputEvent) {\r\n\t\tconst newName = event.target.value.toString();\r\n\t\tif (this.#autoGenerateAlias) {\r\n\t\t\tthis.#singleValueUpdate('alias', generateAlias(newName ?? ''));\r\n\t\t}\r\n\t\tthis.#singleValueUpdate('name', newName);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\t// TODO: Only show alias on label if user has access to DocumentType within settings: [NL]\r\n\t\treturn this._inherited ? this.renderInheritedProperty() : this.renderEditableProperty();\r\n\t}\r\n\r\n\trenderInheritedProperty() {\r\n\t\tif (!this.property) return;\r\n\r\n\t\tif (this.sortModeActive) {\r\n\t\t\treturn this.renderSortableProperty();\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<div id=\"header\">\r\n\t\t\t\t\t<p><b>${this.property.name}</b></p>\r\n\t\t\t\t\t<p><i>${this.property.alias}</i></p>\r\n\t\t\t\t\t<p>${this.property.description}</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div id=\"editor\">\r\n\t\t\t\t\t${this.renderPropertyTags()}\r\n\t\t\t\t\t${this._inherited\r\n\t\t\t\t\t\t? html`<uui-tag look=\"default\" class=\"inherited\">\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-merge\"></uui-icon>\r\n\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\t>${this.localize.term('contentTypeEditor_inheritedFrom')}\r\n\t\t\t\t\t\t\t\t\t<a href=${this.editContentTypePath + 'edit/' + this._inheritedContentTypeId}>\r\n\t\t\t\t\t\t\t\t\t\t${this._inheritedContentTypeName ?? '??'}\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</uui-tag>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\trenderEditableProperty() {\r\n\t\tif (!this.property || !this.editPropertyTypePath) return;\r\n\r\n\t\tif (this.sortModeActive) {\r\n\t\t\treturn this.renderSortableProperty();\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<div id=\"header\">\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tname=\"label\"\r\n\t\t\t\t\t\tid=\"label-input\"\r\n\t\t\t\t\t\tplaceholder=${this.localize.term('placeholders_label')}\r\n\t\t\t\t\t\tlabel=\"label\"\r\n\t\t\t\t\t\t.value=${this.property.name}\r\n\t\t\t\t\t\t@input=${this.#onNameChanged}></uui-input>\r\n\t\t\t\t\t${this.renderPropertyAlias()}\r\n\t\t\t\t\t<slot name=\"action-menu\"></slot>\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<uui-textarea\r\n\t\t\t\t\t\t\tlabel=\"description\"\r\n\t\t\t\t\t\t\tname=\"description\"\r\n\t\t\t\t\t\t\tid=\"description-input\"\r\n\t\t\t\t\t\t\tplaceholder=${this.localize.term('placeholders_enterDescription')}\r\n\t\t\t\t\t\t\t.value=${this.property.description}\r\n\t\t\t\t\t\t\t@input=${(e: CustomEvent) => {\r\n\t\t\t\t\t\t\t\tif (e.target) this.#singleValueUpdate('description', (e.target as HTMLInputElement).value);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tauto-height></uui-textarea>\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tid=\"editor\"\r\n\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\tlabel=${this.localize.term('contentTypeEditor_editorSettings')}\r\n\t\t\t\t\thref=${this.editPropertyTypePath +\r\n\t\t\t\t\tUMB_EDIT_PROPERTY_TYPE_WORKSPACE_PATH_PATTERN.generateLocal({ unique: this.property.unique })}>\r\n\t\t\t\t\t${this.renderPropertyTags()}\r\n\t\t\t\t\t<uui-action-bar>\r\n\t\t\t\t\t\t<uui-button label=\"${this.localize.term('actions_delete')}\" @click=\"${this.#requestRemove}\">\r\n\t\t\t\t\t\t\t<uui-icon name=\"delete\"></uui-icon>\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t</uui-action-bar>\r\n\t\t\t\t</uui-button>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\t#onPropertyOrderChanged = (e: UUIInputEvent) =>\r\n\t\tthis.#partialUpdate({ sortOrder: parseInt(e.target.value as string) ?? 0 } as UmbPropertyTypeModel);\r\n\r\n\trenderSortableProperty() {\r\n\t\tif (!this.property) return;\r\n\t\treturn html`\r\n\t\t\t<div class=\"sortable\">\r\n\t\t\t\t<uui-icon name=\"icon-grip\"></uui-icon>\r\n\t\t\t\t<span>${this.property.name}</span>\r\n\t\t\t\t<span style=\"color: var(--uui-color-disabled-contrast)\">(${this.property.alias})</span>\r\n\t\t\t</div>\r\n\t\t\t<uui-input\r\n\t\t\t\ttype=\"number\"\r\n\t\t\t\t?disabled=${this._inherited}\r\n\t\t\t\tlabel=\"sort order\"\r\n\t\t\t\t@change=${this.#onPropertyOrderChanged}\r\n\t\t\t\t.value=${(this.property.sortOrder ?? 0).toString()}></uui-input>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderPropertyAlias() {\r\n\t\tif (!this.property) return;\r\n\t\treturn html`\r\n\t\t\t<uui-input-lock\r\n\t\t\t\tname=\"alias\"\r\n\t\t\t\tid=\"alias-input\"\r\n\t\t\t\tlabel=${this.localize.term('placeholders_enterAlias')}\r\n\t\t\t\tplaceholder=${this.localize.term('placeholders_enterAlias')}\r\n\t\t\t\t.value=${this.property.alias}\r\n\t\t\t\t?locked=${this._aliasLocked}\r\n\t\t\t\t@input=${this.#onAliasChanged}\r\n\t\t\t\t@lock-change=${this.#onToggleAliasLock}>\r\n\t\t\t</uui-input-lock>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderPropertyTags() {\r\n\t\treturn this.property\r\n\t\t\t? html`<div class=\"types\">\r\n\t\t\t\t\t${this.property.dataType?.unique ? html`<uui-tag look=\"default\">${this._dataTypeName}</uui-tag>` : nothing}\r\n\t\t\t\t\t${this.#renderVariantTags()}\r\n\t\t\t\t\t${this.property.appearance?.labelOnTop == true\r\n\t\t\t\t\t\t? html`<uui-tag look=\"default\">\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-stretch-horizontal\"></uui-icon>\r\n\t\t\t\t\t\t\t\t<span>${this.localize.term('contentTypeEditor_displaySettingsLabelOnTop')}</span>\r\n\t\t\t\t\t\t\t</uui-tag>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t${this.property.validation.mandatory === true\r\n\t\t\t\t\t\t? html`<uui-tag look=\"default\">\r\n\t\t\t\t\t\t\t\t<span>* ${this.localize.term('general_mandatory')}</span>\r\n\t\t\t\t\t\t\t</uui-tag>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t${this.property.visibility?.memberCanView === true\r\n\t\t\t\t\t\t? html`<uui-tag look=\"default\">\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-eye\"></uui-icon> ${this.localize.term('contentTypeEditor_showOnMemberProfile')}\r\n\t\t\t\t\t\t\t</uui-tag>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t${this.property.visibility?.memberCanEdit === true\r\n\t\t\t\t\t\t? html`<uui-tag look=\"default\">\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-edit\"></uui-icon> ${this.localize.term('contentTypeEditor_memberCanEdit')}\r\n\t\t\t\t\t\t\t</uui-tag>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t${this.property.isSensitive === true\r\n\t\t\t\t\t\t? html`<uui-tag look=\"default\">\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-lock\"></uui-icon> ${this.localize.term('contentTypeEditor_isSensitiveData')}\r\n\t\t\t\t\t\t\t</uui-tag>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</div>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderVariantTags() {\r\n\t\tif (!this.property) return nothing;\r\n\r\n\t\tif (\r\n\t\t\tthis.ownerVariesByCulture &&\r\n\t\t\tthis.ownerVariesBySegment &&\r\n\t\t\t!this.property.variesByCulture &&\r\n\t\t\t!this.property.variesBySegment\r\n\t\t) {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-tag look=\"default\">\r\n\t\t\t\t\t<uui-icon name=\"icon-trending-up-down\"></uui-icon> ${this.localize.term(\r\n\t\t\t\t\t\t'contentTypeEditor_cultureAndVariantInvariantLabel',\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-tag>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tif (this.ownerVariesByCulture && !this.property.variesByCulture) {\r\n\t\t\treturn html`<uui-tag look=\"default\">\r\n\t\t\t\t<uui-icon name=\"icon-trending-up-down\"></uui-icon> ${this.localize.term(\r\n\t\t\t\t\t'contentTypeEditor_cultureInvariantLabel',\r\n\t\t\t\t)}\r\n\t\t\t</uui-tag>`;\r\n\t\t}\r\n\r\n\t\tif (this.ownerVariesBySegment && !this.property.variesBySegment) {\r\n\t\t\treturn html`<uui-tag look=\"default\">\r\n\t\t\t\t<uui-icon name=\"icon-trending-up-down\"></uui-icon> ${this.localize.term(\r\n\t\t\t\t\t'contentTypeEditor_segmentInvariantLabel',\r\n\t\t\t\t)}\r\n\t\t\t</uui-tag>`;\r\n\t\t}\r\n\r\n\t\t// Not shared:\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host(:not([sort-mode-active])) {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: 200px auto;\r\n\t\t\t\tcolumn-gap: var(--uui-size-layout-2);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-divider);\r\n\t\t\t\tpadding: var(--uui-size-layout-1) 0;\r\n\t\t\t\tcontainer-type: inline-size;\r\n\t\t\t}\r\n\r\n\t\t\t:host > div {\r\n\t\t\t\tgrid-column: span 2;\r\n\t\t\t}\r\n\r\n\t\t\t@container (width > 600px) {\r\n\t\t\t\t:host(:not([orientation='vertical'])) > div {\r\n\t\t\t\t\tgrid-column: span 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t:host(:first-of-type) {\r\n\t\t\t\tpadding-top: 0;\r\n\t\t\t}\r\n\t\t\t:host(:last-of-type) {\r\n\t\t\t\tborder-bottom: none;\r\n\t\t\t}\r\n\r\n\t\t\t:host([sort-mode-active]) {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tmargin-bottom: var(--uui-size-3);\r\n\t\t\t}\r\n\r\n\t\t\t:host([sort-mode-active]:last-of-type) {\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\r\n\t\t\t:host([sort-mode-active]:not([_inherited])) {\r\n\t\t\t\tcursor: grab;\r\n\t\t\t}\r\n\r\n\t\t\t:host([sort-mode-active]) .sortable {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tpadding: 0 var(--uui-size-3);\r\n\t\t\t\tgap: var(--uui-size-3);\r\n\t\t\t}\r\n\t\t\t:host([sort-mode-active][_inherited]) .sortable {\r\n\t\t\t\tcolor: var(--uui-color-disabled-contrast);\r\n\t\t\t}\r\n\t\t\t:host([sort-mode-active]:not([_inherited])) .sortable {\r\n\t\t\t\tbackground-color: var(--uui-color-divider);\r\n\t\t\t}\r\n\r\n\t\t\t:host([sort-mode-active]) uui-input {\r\n\t\t\t\tmax-width: 75px;\r\n\t\t\t}\r\n\r\n\t\t\t/* Placeholder style, used when property is being dragged.*/\r\n\t\t\t:host(.--umb-sorter-placeholder) > * {\r\n\t\t\t\tvisibility: hidden;\r\n\t\t\t}\r\n\r\n\t\t\t:host(.--umb-sorter-placeholder)::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tborder: 1px dashed var(--uui-color-divider-emphasis);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t:host([_inherited]) {\r\n\t\t\t\t#header {\r\n\t\t\t\t\tpadding: 0 var(--uui-size-3, 9px);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tp {\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\r\n\t\t\t#header {\r\n\t\t\t\tposition: sticky;\r\n\t\t\t\ttop: var(--uui-size-space-4);\r\n\t\t\t\theight: min-content;\r\n\t\t\t}\r\n\r\n\t\t\t#header i {\r\n\t\t\t\topacity: 0.55;\r\n\t\t\t}\r\n\r\n\t\t\t#editor {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\t--uui-button-background-color: var(--uui-color-background);\r\n\t\t\t\t--uui-button-background-color-hover: var(--uui-color-background);\r\n\t\t\t}\r\n\t\t\t#editor:not(uui-button) {\r\n\t\t\t\tbackground-color: var(--uui-color-background);\r\n\t\t\t\tborder-radius: var(--uui-button-border-radius, var(--uui-border-radius, 3px));\r\n\t\t\t\tmin-height: 143px;\r\n\t\t\t}\r\n\t\t\t#editor uui-action-bar {\r\n\t\t\t\t--uui-button-background-color: var(--uui-color-surface);\r\n\t\t\t\t--uui-button-background-color-hover: var(--uui-color-surface);\r\n\t\t\t}\r\n\t\t\t#alias-input,\r\n\t\t\t#label-input,\r\n\t\t\t#description-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#alias-input {\r\n\t\t\t\tborder-color: transparent;\r\n\t\t\t\tbackground: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t#label-input {\r\n\t\t\t\tfont-weight: bold; /* TODO: UUI Input does not support bold text yet */\r\n\t\t\t\t--uui-input-border-color: transparent;\r\n\t\t\t}\r\n\t\t\t#label-input input {\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\t--uui-input-border-color: transparent;\r\n\t\t\t}\r\n\r\n\t\t\t#description-input {\r\n\t\t\t\t--uui-textarea-border-color: transparent;\r\n\t\t\t\tfont-weight: 0.5rem; /* TODO: Cant change font size of UUI textarea yet */\r\n\t\t\t}\r\n\r\n\t\t\t.types > div uui-icon,\r\n\t\t\t.inherited uui-icon {\r\n\t\t\t\tvertical-align: sub;\r\n\t\t\t\tmargin-right: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t.inherited {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: var(--uui-size-space-2);\r\n\t\t\t\tright: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t.types {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: var(--uui-size-space-2);\r\n\t\t\t\tleft: var(--uui-size-space-2);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-flow: wrap;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\t#editor uui-action-bar {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: var(--uui-size-space-2);\r\n\t\t\t\tright: var(--uui-size-space-2);\r\n\t\t\t\topacity: 0;\r\n\t\t\t}\r\n\r\n\t\t\t#editor:hover uui-action-bar,\r\n\t\t\t#editor:focus uui-action-bar,\r\n\t\t\t#editor:focus-within uui-action-bar {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\ta {\r\n\t\t\t\tcolor: inherit;\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder]) {\r\n\t\t\t\topacity: 0.5;\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder]) uui-input {\r\n\t\t\t\tvisibility: hidden;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-content-type-design-editor-property': UmbContentTypeDesignEditorPropertyElement;\r\n\t}\r\n}\r\n","import { UMB_CONTENT_TYPE_WORKSPACE_CONTEXT } from '../../content-type-workspace.context-token.js';\r\nimport type { UmbContentTypeModel, UmbPropertyTypeModel } from '../../../types.js';\r\nimport { UmbContentTypePropertyStructureHelper } from '../../../structure/index.js';\r\nimport type { UmbContentTypeDesignEditorPropertyElement } from './content-type-design-editor-property.element.js';\r\nimport { UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT } from './content-type-design-editor.context-token.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tproperty,\r\n\trepeat,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { type UmbSorterConfig, UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport {\r\n\tUMB_CREATE_PROPERTY_TYPE_WORKSPACE_PATH_PATTERN,\r\n\tUMB_PROPERTY_TYPE_WORKSPACE_MODAL,\r\n} from '@umbraco-cms/backoffice/property-type';\r\n\r\nimport './content-type-design-editor-property.element.js';\r\n\r\nconst SORTER_CONFIG: UmbSorterConfig<UmbPropertyTypeModel, UmbContentTypeDesignEditorPropertyElement> = {\r\n\tgetUniqueOfElement: (element) => {\r\n\t\treturn element.getAttribute('data-umb-property-id');\r\n\t},\r\n\tgetUniqueOfModel: (modelEntry) => {\r\n\t\treturn modelEntry.unique;\r\n\t},\r\n\tidentifier: 'content-type-property-sorter',\r\n\titemSelector: 'umb-content-type-design-editor-property',\r\n\tdisabledItemSelector: '[_inherited]',\r\n\t//TODO: Set the property list (sorter wrapper) to inherited, if its inherited\r\n\t// This is because we don't want to move local properties into an inherited group container.\r\n\t// Or maybe we do, but we still need to check if the group exists locally, if not, then it needs to be created before we move a property into it.\r\n\t// TODO: Fix bug where a local property turn into an inherited when moved to a new group container.\r\n\tcontainerSelector: '#property-list',\r\n};\r\n\r\n@customElement('umb-content-type-design-editor-properties')\r\nexport class UmbContentTypeDesignEditorPropertiesElement extends UmbLitElement {\r\n\t#sorter = new UmbSorterController<UmbPropertyTypeModel, UmbContentTypeDesignEditorPropertyElement>(this, {\r\n\t\t...SORTER_CONFIG,\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis._properties = model;\r\n\t\t},\r\n\t\tonContainerChange: ({ item }) => {\r\n\t\t\tif (this._containerId === undefined) {\r\n\t\t\t\tthrow new Error('ContainerId is not set');\r\n\t\t\t}\r\n\t\t\tthis.#propertyStructureHelper.partialUpdateProperty(item.unique, {\r\n\t\t\t\tcontainer: this._containerId ? { id: this._containerId } : null,\r\n\t\t\t});\r\n\t\t},\r\n\t\tonEnd: ({ item }) => {\r\n\t\t\tif (this._containerId === undefined) {\r\n\t\t\t\tthrow new Error('ContainerId is not set.');\r\n\t\t\t}\r\n\t\t\t/**\r\n\t\t\t * Explanation: If the item is the first in list, we compare it to the item behind it to set a sortOrder.\r\n\t\t\t * If it's not the first in list, we will compare to the item in before it, and check the following item to see if it caused overlapping sortOrder, then update\r\n\t\t\t * the overlap if true, which may cause another overlap, so we loop through them till no more overlaps...\r\n\t\t\t */\r\n\t\t\tconst model = this._properties;\r\n\t\t\tconst newIndex = model.findIndex((entry) => entry.unique === item.unique);\r\n\r\n\t\t\t// Doesn't exist in model\r\n\t\t\tif (newIndex === -1) return;\r\n\r\n\t\t\t// As origin we set prev sort order to -1, so if no other then our item will become 0\r\n\t\t\tlet prevSortOrder = -1;\r\n\r\n\t\t\t// Not first in list\r\n\t\t\tif (newIndex > 0 && model.length > 0) {\r\n\t\t\t\tprevSortOrder = model[newIndex - 1].sortOrder;\r\n\t\t\t}\r\n\r\n\t\t\t// increase the prevSortOrder and use it for the moved item,\r\n\t\t\tthis.#propertyStructureHelper.partialUpdateProperty(item.unique, {\r\n\t\t\t\tsortOrder: ++prevSortOrder,\r\n\t\t\t});\r\n\r\n\t\t\t// Adjust everyone right after, meaning until there is a gap between the sortOrders:\r\n\t\t\tlet i = newIndex + 1;\r\n\t\t\tlet entry: UmbPropertyTypeModel | undefined;\r\n\t\t\t// As long as there is an item with the index & the sortOrder is less or equal to the prevSortOrder, we will update the sortOrder:\r\n\t\t\twhile ((entry = model[i]) !== undefined && entry.sortOrder <= prevSortOrder) {\r\n\t\t\t\t// Increase the prevSortOrder and use it for the item:\r\n\t\t\t\tthis.#propertyStructureHelper.partialUpdateProperty(entry.unique, {\r\n\t\t\t\t\tsortOrder: ++prevSortOrder,\r\n\t\t\t\t});\r\n\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonRequestDrop: async ({ unique }) => {\r\n\t\t\tconst context = await this.getContext(UMB_CONTENT_TYPE_WORKSPACE_CONTEXT);\r\n\t\t\tif (!context) {\r\n\t\t\t\tthrow new Error('Could not get Workspace Context');\r\n\t\t\t}\r\n\t\t\treturn context.structure.getOwnerPropertyById(unique);\r\n\t\t},\r\n\t\trequestExternalRemove: async ({ item }) => {\r\n\t\t\tconst context = await this.getContext(UMB_CONTENT_TYPE_WORKSPACE_CONTEXT);\r\n\t\t\tif (!context) {\r\n\t\t\t\tthrow new Error('Could not get Workspace Context');\r\n\t\t\t}\r\n\t\t\treturn await context.structure.removeProperty(null, item.unique).then(\r\n\t\t\t\t() => true,\r\n\t\t\t\t() => false,\r\n\t\t\t);\r\n\t\t},\r\n\t\trequestExternalInsert: async ({ item }) => {\r\n\t\t\tconst context = await this.getContext(UMB_CONTENT_TYPE_WORKSPACE_CONTEXT);\r\n\t\t\tif (!context) {\r\n\t\t\t\tthrow new Error('Could not get Workspace Context');\r\n\t\t\t}\r\n\t\t\tconst parent = this._containerId ? { id: this._containerId } : null;\r\n\t\t\tconst updatedItem = { ...item, parent };\r\n\t\t\treturn await context.structure.insertProperty(null, updatedItem).then(\r\n\t\t\t\t() => true,\r\n\t\t\t\t() => false,\r\n\t\t\t);\r\n\t\t},\r\n\t});\r\n\r\n\tprivate _containerId: string | null | undefined;\r\n\r\n\t@property({ type: String, attribute: 'container-id', reflect: false })\r\n\tpublic get containerId(): string | null | undefined {\r\n\t\treturn this._containerId;\r\n\t}\r\n\tpublic set containerId(value: string | null | undefined) {\r\n\t\tif (value === this._containerId) return;\r\n\t\tthis._containerId = value;\r\n\t\tthis.createPropertyTypeWorkspaceRoutes();\r\n\t\tthis.#propertyStructureHelper.setContainerId(value);\r\n\t\tthis.#addPropertyModal?.setUniquePathValue('container-id', value === null ? 'root' : value);\r\n\t\tthis.#editPropertyModal?.setUniquePathValue('container-id', value === null ? 'root' : value);\r\n\t}\r\n\r\n\t#addPropertyModal?: UmbModalRouteRegistrationController<\r\n\t\ttypeof UMB_PROPERTY_TYPE_WORKSPACE_MODAL.DATA,\r\n\t\ttypeof UMB_PROPERTY_TYPE_WORKSPACE_MODAL.VALUE\r\n\t>;\r\n\t#editPropertyModal?: UmbModalRouteRegistrationController<\r\n\t\ttypeof UMB_PROPERTY_TYPE_WORKSPACE_MODAL.DATA,\r\n\t\ttypeof UMB_PROPERTY_TYPE_WORKSPACE_MODAL.VALUE\r\n\t>;\r\n\r\n\t#propertyStructureHelper = new UmbContentTypePropertyStructureHelper<UmbContentTypeModel>(this);\r\n\r\n\t@property({ attribute: false })\r\n\teditContentTypePath?: string;\r\n\r\n\t@state()\r\n\tprivate _properties: Array<UmbPropertyTypeModel> = [];\r\n\r\n\t@state()\r\n\tprivate _ownerContentTypeUnique?: string;\r\n\r\n\t@state()\r\n\tprivate _ownerContentTypeVariesByCulture?: boolean;\r\n\r\n\t@state()\r\n\tprivate _ownerContentTypeVariesBySegment?: boolean;\r\n\r\n\t@state()\r\n\tprivate _newPropertyPath?: string;\r\n\r\n\t@state()\r\n\tprivate _editPropertyTypePath?: string;\r\n\r\n\t@state()\r\n\tprivate _sortModeActive?: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t//this.#sorter.disable();\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.isSorting,\r\n\t\t\t\t(isSorting) => {\r\n\t\t\t\t\tthis._sortModeActive = isSorting;\r\n\t\t\t\t},\r\n\t\t\t\t'_observeIsSorting',\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_TYPE_WORKSPACE_CONTEXT, async (workspaceContext) => {\r\n\t\t\tif (workspaceContext) {\r\n\t\t\t\tthis.#propertyStructureHelper.setStructureManager(workspaceContext.structure);\r\n\t\t\t}\r\n\r\n\t\t\tthis._ownerContentTypeUnique = workspaceContext?.structure.getOwnerContentTypeUnique();\r\n\t\t\tthis.createPropertyTypeWorkspaceRoutes();\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tworkspaceContext?.variesByCulture,\r\n\t\t\t\t(variesByCulture) => {\r\n\t\t\t\t\tthis._ownerContentTypeVariesByCulture = variesByCulture;\r\n\t\t\t\t},\r\n\t\t\t\t'observeOwnerVariesByCulture',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tworkspaceContext?.variesBySegment,\r\n\t\t\t\t(variesBySegment) => {\r\n\t\t\t\t\tthis._ownerContentTypeVariesBySegment = variesBySegment;\r\n\t\t\t\t},\r\n\t\t\t\t'observeOwnerVariesBySegment',\r\n\t\t\t);\r\n\t\t});\r\n\t\tthis.observe(this.#propertyStructureHelper.propertyStructure, (propertyStructure) => {\r\n\t\t\tthis._properties = propertyStructure;\r\n\t\t\tthis.#sorter.setModel(this._properties);\r\n\t\t});\r\n\t}\r\n\r\n\tcreatePropertyTypeWorkspaceRoutes() {\r\n\t\tif (!this._ownerContentTypeUnique || this._containerId === undefined) return;\r\n\r\n\t\t// Note: Route for adding a new property\r\n\t\tthis.#addPropertyModal?.destroy();\r\n\t\tthis.#addPropertyModal = new UmbModalRouteRegistrationController(\r\n\t\t\tthis,\r\n\t\t\tUMB_PROPERTY_TYPE_WORKSPACE_MODAL,\r\n\t\t\t'addPropertyModal',\r\n\t\t)\r\n\t\t\t.addUniquePaths(['container-id'])\r\n\t\t\t.addAdditionalPath('add-property/:sortOrder')\r\n\t\t\t.onSetup(async (params) => {\r\n\t\t\t\t// TODO: Make a onInit promise, that can be awaited here.\r\n\t\t\t\tif (!this._ownerContentTypeUnique || this._containerId === undefined) return false;\r\n\r\n\t\t\t\tconst preset: Partial<UmbPropertyTypeModel> = {};\r\n\t\t\t\tif (params.sortOrder !== undefined) {\r\n\t\t\t\t\tlet sortOrderInt = parseInt(params.sortOrder);\r\n\t\t\t\t\tif (sortOrderInt === -1) {\r\n\t\t\t\t\t\t// Find the highest sortOrder and add 1 to it:\r\n\t\t\t\t\t\tsortOrderInt = Math.max(...this._properties.map((x) => x.sortOrder), -1) + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreset.sortOrder = sortOrderInt;\r\n\t\t\t\t}\r\n\t\t\t\treturn { data: { contentTypeUnique: this._ownerContentTypeUnique, preset: preset } };\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._newPropertyPath =\r\n\t\t\t\t\trouteBuilder({ sortOrder: '-1' }) +\r\n\t\t\t\t\tUMB_CREATE_PROPERTY_TYPE_WORKSPACE_PATH_PATTERN.generateLocal({\r\n\t\t\t\t\t\tcontainerUnique: this._containerId!,\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\tif (this._containerId !== undefined) {\r\n\t\t\tthis.#addPropertyModal?.setUniquePathValue(\r\n\t\t\t\t'container-id',\r\n\t\t\t\tthis._containerId === null ? 'root' : this._containerId,\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.#editPropertyModal?.destroy();\r\n\t\tthis.#editPropertyModal = new UmbModalRouteRegistrationController(\r\n\t\t\tthis,\r\n\t\t\tUMB_PROPERTY_TYPE_WORKSPACE_MODAL,\r\n\t\t\t'editPropertyModal',\r\n\t\t)\r\n\t\t\t.addUniquePaths(['container-id'])\r\n\t\t\t.addAdditionalPath('edit-property')\r\n\t\t\t.onSetup(async () => {\r\n\t\t\t\tif (!this._ownerContentTypeUnique || this._containerId === undefined) return false;\r\n\t\t\t\treturn { data: { contentTypeUnique: this._ownerContentTypeUnique, preset: undefined } };\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._editPropertyTypePath = routeBuilder(null);\r\n\t\t\t});\r\n\t\tif (this._containerId !== undefined) {\r\n\t\t\tthis.#editPropertyModal?.setUniquePathValue(\r\n\t\t\t\t'container-id',\r\n\t\t\t\tthis._containerId === null ? 'root' : this._containerId,\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._ownerContentTypeUnique\r\n\t\t\t? html`\r\n\t\t\t\t\t<div id=\"property-list\" ?sort-mode-active=${this._sortModeActive}>\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis._properties,\r\n\t\t\t\t\t\t\t(property) => property.unique,\r\n\t\t\t\t\t\t\t(property) => {\r\n\t\t\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t\t\t<umb-content-type-design-editor-property\r\n\t\t\t\t\t\t\t\t\t\tdata-umb-property-id=${property.unique}\r\n\t\t\t\t\t\t\t\t\t\tdata-mark=\"property-type:${property.name}\"\r\n\t\t\t\t\t\t\t\t\t\t.editContentTypePath=${this.editContentTypePath}\r\n\t\t\t\t\t\t\t\t\t\t.editPropertyTypePath=${this._editPropertyTypePath}\r\n\t\t\t\t\t\t\t\t\t\t?sort-mode-active=${this._sortModeActive}\r\n\t\t\t\t\t\t\t\t\t\t.propertyStructureHelper=${this.#propertyStructureHelper}\r\n\t\t\t\t\t\t\t\t\t\t.property=${property}\r\n\t\t\t\t\t\t\t\t\t\t.ownerVariesByCulture=${this._ownerContentTypeVariesByCulture}\r\n\t\t\t\t\t\t\t\t\t\t.ownerVariesBySegment=${this._ownerContentTypeVariesBySegment}>\r\n\t\t\t\t\t\t\t\t\t</umb-content-type-design-editor-property>\r\n\t\t\t\t\t\t\t\t`;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\t!this._sortModeActive,\r\n\t\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tid=\"btn-add\"\r\n\t\t\t\t\t\t\t\thref=${ifDefined(this._newPropertyPath)}\r\n\t\t\t\t\t\t\t\tlabel=${this.localize.term('contentTypeEditor_addProperty')}\r\n\t\t\t\t\t\t\t\tlook=\"placeholder\"></uui-button>\r\n\t\t\t\t\t\t`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t`\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t}\r\n\r\n\t\t\t#property-list {\r\n\t\t\t\t/* enables dropping things into this despite it begin empty. */\r\n\t\t\t\tmargin-top: -20px;\r\n\t\t\t\tpadding-top: 20px;\r\n\t\t\t}\r\n\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\t--uui-button-height: var(--uui-size-14);\r\n\t\t\t}\r\n\r\n\t\t\t#property-list[sort-mode-active]:not(:has(umb-content-type-design-editor-property)) {\r\n\t\t\t\t/* Some height so that the sorter can target the area if the group is empty*/\r\n\t\t\t\tmin-height: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbContentTypeDesignEditorPropertiesElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-content-type-design-editor-properties': UmbContentTypeDesignEditorPropertiesElement;\r\n\t}\r\n}\r\n","import type { UmbContentTypeModel, UmbPropertyTypeContainerMergedModel } from '../../../types.js';\r\nimport type { UmbContentTypeContainerStructureHelper } from '../../../structure/index.js';\r\nimport { css, customElement, html, nothing, property, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbConfirmModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbLitElement, umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UUIBlinkAnimationValue, UUIBlinkKeyframes, type UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\nimport './content-type-design-editor-properties.element.js';\r\n\r\n@customElement('umb-content-type-design-editor-group')\r\nexport class UmbContentTypeWorkspaceViewEditGroupElement extends UmbLitElement {\r\n\t@property({ attribute: false })\r\n\tpublic set group(value: UmbPropertyTypeContainerMergedModel | undefined) {\r\n\t\tif (value === this._group) return;\r\n\t\tthis._group = value;\r\n\t\tthis._groupId = value?.ownerId ?? value?.ids[0];\r\n\t\tthis.#checkInherited();\r\n\t}\r\n\tpublic get group(): UmbPropertyTypeContainerMergedModel | undefined {\r\n\t\treturn this._group;\r\n\t}\r\n\tprivate _group?: UmbPropertyTypeContainerMergedModel | undefined;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set groupStructureHelper(value: UmbContentTypeContainerStructureHelper<UmbContentTypeModel> | undefined) {\r\n\t\tif (value === this._groupStructureHelper) return;\r\n\t\tthis._groupStructureHelper = value;\r\n\t\tthis.#checkInherited();\r\n\t}\r\n\tpublic get groupStructureHelper(): UmbContentTypeContainerStructureHelper<UmbContentTypeModel> | undefined {\r\n\t\treturn this._groupStructureHelper;\r\n\t}\r\n\tprivate _groupStructureHelper?: UmbContentTypeContainerStructureHelper<UmbContentTypeModel> | undefined;\r\n\r\n\t@property({ type: Boolean, attribute: 'sort-mode-active', reflect: true })\r\n\tsortModeActive = false;\r\n\r\n\t@property({ attribute: false })\r\n\teditContentTypePath?: string;\r\n\r\n\t@state()\r\n\tprivate _groupId?: string;\r\n\r\n\t@property({ type: Boolean, reflect: true, attribute: 'has-owner-container' })\r\n\tprivate _hasOwnerContainer?: boolean;\r\n\r\n\t// attrbute is used by Sorter Controller in parent scope.\r\n\t@property({ type: Boolean, reflect: true, attribute: 'inherited' })\r\n\tprivate _inherited?: boolean;\r\n\r\n\t@state()\r\n\tprivate _inheritedFrom?: Array<UmbContentTypeModel>;\r\n\r\n\t#checkInherited() {\r\n\t\tif (this.groupStructureHelper && this.group) {\r\n\t\t\t// Check is this container matches with any other group. If so it is inherited aka. merged with others. [NL]\r\n\t\t\tif (this.group.ownerId) {\r\n\t\t\t\tthis._hasOwnerContainer = true;\r\n\t\t\t}\r\n\r\n\t\t\tconst notOwnerContainerIds = this.group.ids.filter((id) => id !== this.group!.ownerId);\r\n\r\n\t\t\tif (notOwnerContainerIds.length > 0) {\r\n\t\t\t\tthis._inheritedFrom = notOwnerContainerIds\r\n\t\t\t\t\t.map((id) => this.groupStructureHelper!.getContentTypeOfContainer(id))\r\n\t\t\t\t\t.filter((contentType) => contentType !== undefined) as Array<UmbContentTypeModel>;\r\n\t\t\t\tthis._inherited = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._inheritedFrom = undefined;\r\n\t\t\t\tthis._inherited = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#singleValueUpdate(propertyName: string, value: string | number | boolean | null | undefined) {\r\n\t\tif (!this._groupStructureHelper || !this._group) return;\r\n\r\n\t\tconst ownerId = this._group.ownerId;\r\n\t\tif (!ownerId) return;\r\n\r\n\t\tconst partialObject = {} as any;\r\n\t\tpartialObject[propertyName] = value;\r\n\r\n\t\tthis._groupStructureHelper.partialUpdateContainer(ownerId, partialObject);\r\n\t}\r\n\r\n\t#renameGroup(e: InputEvent) {\r\n\t\tif (!this.groupStructureHelper || !this._group) return;\r\n\t\tconst ownerId = this._group.ownerId;\r\n\t\tif (!ownerId) return;\r\n\t\tlet newName = (e.target as HTMLInputElement).value;\r\n\t\t// TODO: This does not seem right, the detection of a unique name requires better awareness on the level of the change. [NL]\r\n\t\t// This seem to use check for root containers.\r\n\t\tconst changedName = this.groupStructureHelper\r\n\t\t\t.getStructureManager()!\r\n\t\t\t.makeContainerNameUniqueForOwnerContentType(ownerId, newName);\r\n\t\tif (changedName) {\r\n\t\t\tnewName = changedName;\r\n\t\t}\r\n\t\tthis.#singleValueUpdate('name', newName);\r\n\t\t(e.target as HTMLInputElement).value = newName;\r\n\t}\r\n\r\n\t#blurGroup(e: InputEvent) {\r\n\t\tif (!this.groupStructureHelper || !this._group) return;\r\n\t\tconst ownerId = this._group.ownerId;\r\n\t\tif (!ownerId) return;\r\n\t\tconst newName = (e.target as HTMLInputElement).value;\r\n\t\tif (newName === '') {\r\n\t\t\tconst changedName = this.groupStructureHelper.getStructureManager()!.makeEmptyContainerName(ownerId);\r\n\t\t\tthis.#singleValueUpdate('name', changedName);\r\n\t\t\t(e.target as HTMLInputElement).value = changedName;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #requestRemove(e: Event) {\r\n\t\te.preventDefault();\r\n\t\te.stopImmediatePropagation();\r\n\t\tif (!this.groupStructureHelper || !this._group) return;\r\n\t\tif (this._group.ownerId === undefined) return;\r\n\r\n\t\t// TODO: Do proper localization here: [NL]\r\n\t\tawait umbConfirmModal(this, {\r\n\t\t\theadline: `${this.localize.term('actions_delete')} group`,\r\n\t\t\tcontent: html`<umb-localize key=\"contentTypeEditor_confirmDeleteGroupMessage\" .args=${[\r\n\t\t\t\tthis._group.name ?? this._group.ownerId,\r\n\t\t\t]}>\r\n\t\t\t\t\tAre you sure you want to delete the group <strong>${this._group.name ?? this._group.ownerId}</strong>\r\n\t\t\t\t</umb-localize>\r\n\t\t\t\t</div>`,\r\n\t\t\tconfirmLabel: this.localize.term('actions_delete'),\r\n\t\t\tcolor: 'danger',\r\n\t\t});\r\n\r\n\t\tthis.groupStructureHelper.removeContainer(this._group.ownerId);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._inherited === undefined || !this._groupId) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-box>\r\n\t\t\t\t${this.#renderContainerHeader()}\r\n\t\t\t\t<umb-content-type-design-editor-properties\r\n\t\t\t\t\t.editContentTypePath=${this.editContentTypePath}\r\n\t\t\t\t\t.containerId=${this._groupId}></umb-content-type-design-editor-properties>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t// TODO: impl UMB_EDIT_DOCUMENT_TYPE_PATH_PATTERN, but we need either a generic type or a way to get the path pattern.... [NL]\r\n\t#renderContainerHeader() {\r\n\t\treturn html`\r\n\t\t\t<div slot=\"header\" class=\"drag-handle\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t${when(this.sortModeActive && this._hasOwnerContainer, () => html`<uui-icon name=\"icon-grip\"></uui-icon>`)}\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tid=\"group-name\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('contentTypeEditor_group')}\r\n\t\t\t\t\t\tplaceholder=${this.localize.term('placeholders_entername')}\r\n\t\t\t\t\t\t.value=${this._group!.name}\r\n\t\t\t\t\t\t?disabled=${!this._hasOwnerContainer}\r\n\t\t\t\t\t\t@blur=${this.#blurGroup}\r\n\t\t\t\t\t\t@change=${this.#renameGroup}\r\n\t\t\t\t\t\t${this._group!.name === '' ? umbFocus() : nothing}\r\n\t\t\t\t\t\tauto-width></uui-input>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div slot=\"header-actions\">\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis._hasOwnerContainer === false && this._inheritedFrom && this._inheritedFrom.length > 0,\r\n\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t<uui-tag look=\"default\" class=\"inherited\">\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-merge\"></uui-icon>\r\n\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t>${this.localize.term('contentTypeEditor_inheritedFrom')}\r\n\t\t\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\t\t\tthis._inheritedFrom!,\r\n\t\t\t\t\t\t\t\t\t(inherited) => inherited.unique,\r\n\t\t\t\t\t\t\t\t\t(inherited) => html`\r\n\t\t\t\t\t\t\t\t\t\t<a href=${this.editContentTypePath + 'edit/' + inherited.unique}>${inherited.name}</a>\r\n\t\t\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</uui-tag>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t\t${when(\r\n\t\t\t\t\t!this._inherited && !this.sortModeActive,\r\n\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t<uui-button compact label=${this.localize.term('actions_delete')} @click=${this.#requestRemove}>\r\n\t\t\t\t\t\t\t<uui-icon name=\"delete\"></uui-icon>\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis.sortModeActive,\r\n\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('sort_sortOrder')}\r\n\t\t\t\t\t\t\t.value=${this.group!.sortOrder.toString()}\r\n\t\t\t\t\t\t\t?disabled=${!this._hasOwnerContainer}\r\n\t\t\t\t\t\t\t@change=${(e: UUIInputEvent) =>\r\n\t\t\t\t\t\t\t\tthis.#singleValueUpdate('sortOrder', parseInt(e.target.value as string) ?? 0)}></uui-input>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tUUIBlinkKeyframes,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder]) {\r\n\t\t\t\topacity: 0.5;\r\n\t\t\t}\r\n\r\n\t\t\t:host::before,\r\n\t\t\t:host::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition:\r\n\t\t\t\t\topacity 60ms linear 1ms,\r\n\t\t\t\t\tborder-color,\r\n\t\t\t\t\t10ms;\r\n\t\t\t}\r\n\r\n\t\t\t:host::after {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tborder: 2px solid transparent;\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder])::after {\r\n\t\t\t\topacity: 1;\r\n\t\t\t\tborder-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\tanimation: ${UUIBlinkAnimationValue};\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder])::before {\r\n\t\t\t\tbackground-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\topacity: 0.12;\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder]) uui-box {\r\n\t\t\t\t--uui-box-default-padding: 0;\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder]) div[slot='header'],\r\n\t\t\t:host([drag-placeholder]) div[slot='header-actions'] {\r\n\t\t\t\ttransition: opacity 60ms linear 1ms;\r\n\t\t\t\topacity: 0;\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder]) umb-content-type-design-editor-properties {\r\n\t\t\t\tvisibility: hidden;\r\n\t\t\t\tdisplay: none;\r\n\t\t\t}\r\n\r\n\t\t\tuui-box {\r\n\t\t\t\t--uui-box-header-padding: 0;\r\n\t\t\t}\r\n\r\n\t\t\tdiv[slot='header'] {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tpadding: var(--uui-size-space-4) var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t:host([has-owner-container]) div[slot='header'] {\r\n\t\t\t\tcursor: grab;\r\n\t\t\t}\r\n\r\n\t\t\tdiv[slot='header'] > div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-3);\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#group-name {\r\n\t\t\t\t--uui-input-border-color: transparent;\r\n\t\t\t\tmin-width: 200px;\r\n\t\t\t}\r\n\r\n\t\t\tuui-input[type='number'] {\r\n\t\t\t\tmax-width: 75px;\r\n\t\t\t}\r\n\r\n\t\t\t.inherited uui-icon {\r\n\t\t\t\tvertical-align: sub;\r\n\t\t\t}\r\n\r\n\t\t\tdiv[slot='header-actions'] {\r\n\t\t\t\tpadding: var(--uui-size-space-4) var(--uui-size-space-5);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbContentTypeWorkspaceViewEditGroupElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-content-type-design-editor-group': UmbContentTypeWorkspaceViewEditGroupElement;\r\n\t}\r\n}\r\n","import { UMB_CONTENT_TYPE_WORKSPACE_CONTEXT } from '../../content-type-workspace.context-token.js';\r\nimport type {\r\n\tUmbContentTypeModel,\r\n\tUmbPropertyTypeContainerMergedModel,\r\n\tUmbPropertyTypeContainerModel,\r\n} from '../../../types.js';\r\nimport { UmbContentTypeContainerStructureHelper } from '../../../structure/index.js';\r\nimport type { UmbContentTypeWorkspaceViewEditGroupElement } from './content-type-design-editor-group.element.js';\r\nimport { css, customElement, html, nothing, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT } from './content-type-design-editor.context-token.js';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport { UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\nimport { UMB_WORKSPACE_MODAL } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbSorterConfig } from '@umbraco-cms/backoffice/sorter';\r\n\r\nimport './content-type-design-editor-properties.element.js';\r\nimport './content-type-design-editor-group.element.js';\r\n\r\nconst SORTER_CONFIG: UmbSorterConfig<UmbPropertyTypeContainerMergedModel, UmbContentTypeWorkspaceViewEditGroupElement> =\r\n\t{\r\n\t\tgetUniqueOfElement: (element) => element.group?.ownerId ?? element.group?.ids[0],\r\n\t\tgetUniqueOfModel: (modelEntry) => modelEntry.ownerId ?? modelEntry.ids[0],\r\n\t\t// TODO: Make specific to the current owner document. [NL]\r\n\t\tidentifier: 'content-type-container-sorter',\r\n\t\titemSelector: 'umb-content-type-design-editor-group',\r\n\t\thandleSelector: '.drag-handle',\r\n\t\tdisabledItemSelector: ':not([has-owner-container])', // Inherited attribute is set by the umb-content-type-design-editor-group.\r\n\t\tcontainerSelector: '.container-list',\r\n\t};\r\n\r\n@customElement('umb-content-type-design-editor-tab')\r\nexport class UmbContentTypeDesignEditorTabElement extends UmbLitElement {\r\n\t#sorter = new UmbSorterController<UmbPropertyTypeContainerMergedModel, UmbContentTypeWorkspaceViewEditGroupElement>(\r\n\t\tthis,\r\n\t\t{\r\n\t\t\t...SORTER_CONFIG,\r\n\t\t\tonChange: ({ model }) => {\r\n\t\t\t\tthis._groups = model;\r\n\t\t\t},\r\n\t\t\tonContainerChange: ({ item }) => {\r\n\t\t\t\tif (this.#containerId === undefined) {\r\n\t\t\t\t\tthrow new Error('ContainerId is not set');\r\n\t\t\t\t}\r\n\t\t\t\tif (item.ownerId === undefined) {\r\n\t\t\t\t\t// This may be possible later, but for now this is not possible. [NL]\r\n\t\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\t'OwnerId is not set for the given container, we cannot move containers that are not owned by the current Document.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tthis.#groupStructureHelper.partialUpdateContainer(item.ownerId, {\r\n\t\t\t\t\tparent: this.#containerId ? { id: this.#containerId } : null,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonEnd: ({ item }) => {\r\n\t\t\t\tif (item.ownerId === undefined) {\r\n\t\t\t\t\t// This may be possible later, but for now this is not possible. [NL]\r\n\t\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\t'OwnerId is not set for the given container, we cannot move containers that are not owned by the current Document.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\t/**\r\n\t\t\t\t * Explanation: If the item is the first in list, we compare it to the item behind it to set a sortOrder.\r\n\t\t\t\t * If it's not the first in list, we will compare to the item in before it, and check the following item to see if it caused overlapping sortOrder, then update\r\n\t\t\t\t * the overlap if true, which may cause another overlap, so we loop through them till no more overlaps...\r\n\t\t\t\t */\r\n\t\t\t\tconst model = this._groups;\r\n\t\t\t\tconst newIndex = model.findIndex((entry) => entry.ownerId === item.ownerId);\r\n\r\n\t\t\t\t// Doesn't exist in model\r\n\t\t\t\tif (newIndex === -1) return;\r\n\r\n\t\t\t\t// As origin we set prev sort order to -1, so if no other then our item will become 0\r\n\t\t\t\tlet prevSortOrder = -1;\r\n\r\n\t\t\t\t// Not first in list\r\n\t\t\t\tif (newIndex > 0 && model.length > 0) {\r\n\t\t\t\t\tprevSortOrder = model[newIndex - 1].sortOrder;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst ownerId = item.ownerId;\r\n\r\n\t\t\t\tif (ownerId === undefined) {\r\n\t\t\t\t\t// This may be possible later, but for now this is not possible. [NL]\r\n\t\t\t\t\tthrow new Error(\r\n\t\t\t\t\t\t'OwnerId is not set for the given container, we cannot move containers that are not owned by the current Document.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// increase the prevSortOrder and use it for the moved item,\r\n\t\t\t\tthis.#groupStructureHelper.partialUpdateContainer(ownerId, {\r\n\t\t\t\t\tsortOrder: ++prevSortOrder,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Adjust everyone right after, meaning until there is a gap between the sortOrders:\r\n\t\t\t\tlet i = newIndex + 1;\r\n\t\t\t\tlet entry: UmbPropertyTypeContainerMergedModel | undefined;\r\n\t\t\t\t// As long as there is an item with the index & the sortOrder is less or equal to the prevSortOrder, we will update the sortOrder:\r\n\t\t\t\twhile ((entry = model[i]) !== undefined && entry.sortOrder <= prevSortOrder) {\r\n\t\t\t\t\t// Only updated owned containers:\r\n\t\t\t\t\tif (entry.ownerId) {\r\n\t\t\t\t\t\t// Increase the prevSortOrder and use it for the item:\r\n\t\t\t\t\t\tthis.#groupStructureHelper.partialUpdateContainer(entry.ownerId, {\r\n\t\t\t\t\t\t\tsortOrder: ++prevSortOrder,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonRequestDrop: async ({ unique }) => {\r\n\t\t\t\tconst context = this.#contentTypeWorkspaceContext;\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Could not get Workspace Context');\r\n\t\t\t\t}\r\n\t\t\t\tconst result = context.structure.getMergedContainerById(unique) as\r\n\t\t\t\t\t| UmbPropertyTypeContainerMergedModel\r\n\t\t\t\t\t| undefined;\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\t\t\trequestExternalRemove: async ({ item }) => {\r\n\t\t\t\tconst context = this.#contentTypeWorkspaceContext;\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Could not get Workspace Context');\r\n\t\t\t\t}\r\n\t\t\t\treturn await context.structure.removeContainer(null, item.ownerId, { preventRemovingProperties: true }).then(\r\n\t\t\t\t\t() => true,\r\n\t\t\t\t\t() => false,\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\trequestExternalInsert: async ({ item }) => {\r\n\t\t\t\tconst context = this.#contentTypeWorkspaceContext;\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Could not get Workspace Context');\r\n\t\t\t\t}\r\n\t\t\t\tif (item.ownerId === undefined) {\r\n\t\t\t\t\t// This may be possible later, but for now this is not possible. [NL]\r\n\t\t\t\t\tthrow new Error('OwnerId is not set, we cannot move containers that are not owned by the current Document.');\r\n\t\t\t\t}\r\n\t\t\t\tconst parent = this.#containerId ? { id: this.#containerId } : null;\r\n\t\t\t\tconst containerModelItem: UmbPropertyTypeContainerModel = {\r\n\t\t\t\t\tid: item.ownerId,\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\tsortOrder: item.sortOrder,\r\n\t\t\t\t\ttype: item.type,\r\n\t\t\t\t\tparent,\r\n\t\t\t\t};\r\n\t\t\t\treturn await context.structure.insertContainer(null, containerModelItem).then(\r\n\t\t\t\t\t() => true,\r\n\t\t\t\t\t() => false,\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t},\r\n\t);\r\n\r\n\t#workspaceModal?: UmbModalRouteRegistrationController<\r\n\t\ttypeof UMB_WORKSPACE_MODAL.DATA,\r\n\t\ttypeof UMB_WORKSPACE_MODAL.VALUE\r\n\t>;\r\n\t#containerId?: string | null;\r\n\r\n\t@property({ type: String })\r\n\tpublic get containerId(): string | null | undefined {\r\n\t\treturn this.#containerId;\r\n\t}\r\n\tpublic set containerId(value: string | null | undefined) {\r\n\t\tconst oldValue = this.#containerId;\r\n\t\tif (value === this.#containerId) return;\r\n\t\tthis.#containerId = value;\r\n\t\tthis.#groupStructureHelper.setContainerId(value);\r\n\t\tthis.requestUpdate('containerId', oldValue);\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _groups: Array<UmbPropertyTypeContainerMergedModel> = [];\r\n\r\n\t@state()\r\n\tprivate _hasProperties = false;\r\n\r\n\t@state()\r\n\tprivate _sortModeActive?: boolean;\r\n\r\n\t@state()\r\n\tprivate _editContentTypePath?: string;\r\n\r\n\t#groupStructureHelper = new UmbContentTypeContainerStructureHelper<UmbContentTypeModel>(this);\r\n\t#contentTypeWorkspaceContext?: typeof UMB_CONTENT_TYPE_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_TYPE_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#contentTypeWorkspaceContext = context;\r\n\t\t\tthis.#groupStructureHelper.setStructureManager(context?.structure);\r\n\r\n\t\t\tconst entityType = context?.getEntityType();\r\n\r\n\t\t\tthis.#workspaceModal?.destroy();\r\n\t\t\tthis.#workspaceModal = new UmbModalRouteRegistrationController(this, UMB_WORKSPACE_MODAL)\r\n\t\t\t\t.addAdditionalPath(entityType ?? 'unknown')\r\n\t\t\t\t.onSetup(async () => {\r\n\t\t\t\t\treturn { data: { entityType: entityType, preset: {} } };\r\n\t\t\t\t})\r\n\t\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\t\tthis._editContentTypePath = routeBuilder({});\r\n\t\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.isSorting,\r\n\t\t\t\t(isSorting) => {\r\n\t\t\t\t\tthis._sortModeActive = isSorting;\r\n\t\t\t\t},\r\n\t\t\t\t'_observeIsSorting',\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#groupStructureHelper.childContainers,\r\n\t\t\t(groups) => {\r\n\t\t\t\tthis._groups = groups;\r\n\t\t\t\tthis.#sorter.setModel(this._groups);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#groupStructureHelper.hasProperties,\r\n\t\t\t(hasProperties) => {\r\n\t\t\t\tthis._hasProperties = hasProperties;\r\n\t\t\t\tthis.requestUpdate('_hasProperties');\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\t#onAddGroup = () => {\r\n\t\t// Idea, maybe we can gather the sortOrder from the last group rendered and add 1 to it?\r\n\t\tconst len = this._groups.length;\r\n\t\tconst sortOrder = len === 0 ? 0 : this._groups[len - 1].sortOrder + 1;\r\n\t\tthis.#groupStructureHelper.addContainer(this.#containerId, sortOrder);\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${\r\n\t\t\t\tthis.#containerId\r\n\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t<uui-box class=\"${this._hasProperties ? '' : 'opaque'}\">\r\n\t\t\t\t\t\t\t\t<umb-content-type-design-editor-properties\r\n\t\t\t\t\t\t\t\t\t.containerId=${this.containerId}\r\n\t\t\t\t\t\t\t\t\t.editContentTypePath=${this._editContentTypePath}></umb-content-type-design-editor-properties>\r\n\t\t\t\t\t\t\t</uui-box>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t: nothing\r\n\t\t\t}\r\n\r\n\t\t\t\t<div class=\"container-list\" ?sort-mode-active=${this._sortModeActive}>\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._groups,\r\n\t\t\t\t\t\t(group) => group.ids[0],\r\n\t\t\t\t\t\t(group) => html`\r\n\t\t\t\t\t\t\t<umb-content-type-design-editor-group\r\n\t\t\t\t\t\t\t\t?sort-mode-active=${this._sortModeActive}\r\n\t\t\t\t\t\t\t\t.editContentTypePath=${this._editContentTypePath}\r\n\t\t\t\t\t\t\t\t.group=${group}\r\n\t\t\t\t\t\t\t\t.groupStructureHelper=${this.#groupStructureHelper as any}\r\n\t\t\t\t\t\t\t\tdata-umb-group-id=${group.ownerId ?? group.ids[0]}\r\n\t\t\t\t\t\t\t\tdata-mark=\"group:${group.name}\">\r\n\t\t\t\t\t\t\t</umb-content-type-design-editor-group>\r\n\t\t\t\t\t\t`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t${this.#renderAddGroupButton()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddGroupButton() {\r\n\t\tif (this._sortModeActive) return;\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tid=\"btn-add\"\r\n\t\t\t\tlabel=${this.localize.term('contentTypeEditor_addGroup')}\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t@click=${this.#onAddGroup}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\t--uui-button-height: var(--uui-size-24);\r\n\t\t\t}\r\n\r\n\t\t\tuui-box,\r\n\t\t\tumb-content-type-design-editor-group {\r\n\t\t\t\tmargin-bottom: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\t\t\tuui-box.opaque {\r\n\t\t\t\tbackground-color: transparent;\r\n\t\t\t\tborder-color: transparent;\r\n\t\t\t}\r\n\r\n\t\t\t.container-list {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: 10px;\r\n\t\t\t\talign-content: start;\r\n\t\t\t}\r\n\r\n\t\t\t/* Ensure the container-list has some height when its empty so groups can be dropped into it.*/\r\n\t\t\t.container-list {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-layout-1) * -1);\r\n\t\t\t\tpadding-top: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.container-list #convert-to-tab {\r\n\t\t\t\tmargin-bottom: var(--uui-size-layout-1);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t}\r\n\r\n\t\t\t.container-list[sort-mode-active] {\r\n\t\t\t\tmin-height: 100px;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbContentTypeDesignEditorTabElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-content-type-design-editor-tab': UmbContentTypeDesignEditorTabElement;\r\n\t}\r\n}\r\n"],"names":["UmbPropertyTypeContext","UmbContextBase","host","UMB_PROPERTY_TYPE_CONTEXT","#alias","UmbStringState","#label","alias","label","_context","_dataTypeDetailRepository","_dataTypeUnique","_propertyUnique","_autoGenerateAlias","_UmbContentTypeDesignEditorPropertyElement_instances","checkAliasAutoGenerate_fn","checkInherited_fn","partialUpdate_fn","singleValueUpdate_fn","onToggleAliasLock_fn","setDataType_fn","requestRemove_fn","onAliasChanged_fn","onNameChanged_fn","_onPropertyOrderChanged","renderVariantTags_fn","UmbContentTypeDesignEditorPropertyElement","UmbLitElement","__privateAdd","UmbDataTypeDetailRepository","e","__privateMethod","value","oldValue","__privateGet","html","nothing","UMB_EDIT_PROPERTY_TYPE_WORKSPACE_PATH_PATTERN","unique","__privateSet","contentType","partialObject","propertyName","event","dataTypeUnique","x","umbConfirmModal","newName","generateAlias","UmbTextStyles","css","__decorateClass","property","state","customElement","_sorter","_addPropertyModal","_editPropertyModal","_propertyStructureHelper","SORTER_CONFIG","element","modelEntry","UmbContentTypeDesignEditorPropertiesElement","UmbSorterController","model","item","newIndex","entry","prevSortOrder","i","context","UMB_CONTENT_TYPE_WORKSPACE_CONTEXT","parent","updatedItem","UmbContentTypePropertyStructureHelper","UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT","isSorting","workspaceContext","variesByCulture","variesBySegment","propertyStructure","UmbModalRouteRegistrationController","UMB_PROPERTY_TYPE_WORKSPACE_MODAL","params","preset","sortOrderInt","routeBuilder","UMB_CREATE_PROPERTY_TYPE_WORKSPACE_PATH_PATTERN","repeat","when","ifDefined","_UmbContentTypeWorkspaceViewEditGroupElement_instances","renameGroup_fn","blurGroup_fn","renderContainerHeader_fn","UmbContentTypeWorkspaceViewEditGroupElement","notOwnerContainerIds","id","ownerId","changedName","umbFocus","inherited","UUIBlinkKeyframes","UUIBlinkAnimationValue","_workspaceModal","_containerId","_groupStructureHelper","_contentTypeWorkspaceContext","_onAddGroup","_UmbContentTypeDesignEditorTabElement_instances","renderAddGroupButton_fn","UmbContentTypeDesignEditorTabElement","containerModelItem","UmbContentTypeContainerStructureHelper","len","sortOrder","entityType","UMB_WORKSPACE_MODAL","groups","hasProperties","group","UmbContentTypeDesignEditorTabElement$1"],"mappings":"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"}