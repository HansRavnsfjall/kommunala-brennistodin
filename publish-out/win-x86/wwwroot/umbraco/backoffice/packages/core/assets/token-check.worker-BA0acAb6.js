(function(){"use strict";const r=[];let o;console.log("[Token Check Worker] Token check worker initialized.");const c=globalThis;c.onconnect=t=>{console.log("[Token Check Worker] Connected to main thread.");const n=t.ports[0];r.push(n),n.onmessage=e=>{e.data?.command==="init"&&(console.log("[Token Check Worker] Initializing with token response:",e.data.tokenResponse),e.data.tokenResponse?l(e.data.tokenResponse):o&&(console.warn("[Token Check Worker] No token response provided, stopping the interval."),clearInterval(o),o=void 0))}};function k(t){const n=Math.floor(Date.now()/1e3),i=t.issuedAt+(t.expiresIn??1)*4-n;console.log("[Token Check Worker] Token expires in",i,"seconds");let s=i-60;return s<0&&(s=0),{tokenIsExpired:s===0,numberOfSecondsUntilExpiration:s}}function l(t){console.log("[Token Check Worker] Initializing token check worker..."),o&&clearInterval(o),o=setInterval(()=>{const n=k(t);if(n.tokenIsExpired){console.log("[Token Check Worker] Token is expired or missing, triggering logout.");for(const e of r)e&&e.postMessage({command:"logout"});clearInterval(o),o=void 0,console.log("[Token Check Worker] Waiting for token refresh...")}else if(n.numberOfSecondsUntilExpiration<=60){console.log("[Token Check Worker] Token should be refreshed, but it is not expired yet.");for(const e of r)e&&e.postMessage({command:"refreshToken",secondsUntilLogout:n.numberOfSecondsUntilExpiration})}},3e4)}})();
//# sourceMappingURL=token-check.worker-BA0acAb6.js.map
