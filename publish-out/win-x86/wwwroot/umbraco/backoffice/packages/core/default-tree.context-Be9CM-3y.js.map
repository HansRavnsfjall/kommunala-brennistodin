{"version":3,"file":"default-tree.context-Be9CM-3y.js","sources":["../../../src/packages/core/tree/expansion-manager/tree-expansion-manager.ts","../../../src/packages/core/tree/default/default-tree.context.ts"],"sourcesContent":["import type { UmbTreeExpansionModel } from './types.js';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport type { Observable } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbEntityExpansionManager } from '@umbraco-cms/backoffice/utils';\r\n\r\n/**\r\n * Manages the expansion state of a tree\r\n * @exports\r\n * @class UmbTreeExpansionManager\r\n * @augments {UmbControllerBase}\r\n */\r\nexport class UmbTreeExpansionManager extends UmbControllerBase {\r\n\t#manager = new UmbEntityExpansionManager(this);\r\n\texpansion = this.#manager.expansion;\r\n\r\n\t/**\r\n\t * Checks if an entity is expanded\r\n\t * @param {UmbEntityModel} entity The entity to check\r\n\t * @param {string} entity.entityType The entity type\r\n\t * @param {string} entity.unique The unique key\r\n\t * @returns {Observable<boolean>} True if the entity is expanded\r\n\t * @memberof UmbTreeExpansionManager\r\n\t */\r\n\tisExpanded(entity: UmbEntityModel): Observable<boolean> {\r\n\t\treturn this.#manager.isExpanded(entity);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the expansion state\r\n\t * @param {UmbTreeExpansionModel | undefined} expansion The expansion state\r\n\t * @memberof UmbTreeExpansionManager\r\n\t * @returns {void}\r\n\t */\r\n\tsetExpansion(expansion: UmbTreeExpansionModel): void {\r\n\t\tthis.#manager.setExpansion(expansion);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the expansion state\r\n\t * @memberof UmbTreeExpansionManager\r\n\t * @returns {UmbTreeExpansionModel} The expansion state\r\n\t */\r\n\tgetExpansion(): UmbTreeExpansionModel {\r\n\t\treturn this.#manager.getExpansion();\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a child tree item\r\n\t * @param {UmbEntityModel} entity The entity to open\r\n\t * @param {string} entity.entityType The entity type\r\n\t * @param {string} entity.unique The unique key\r\n\t * @memberof UmbTreeExpansionManager\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic async expandItem(entity: UmbEntityModel): Promise<void> {\r\n\t\tthis.#manager.expandItem(entity);\r\n\t}\r\n\r\n\t/**\r\n\t * Closes a child tree item\r\n\t * @param {UmbEntityModel} entity The entity to close\r\n\t * @param {string} entity.entityType The entity type\r\n\t * @param {string} entity.unique The unique key\r\n\t * @memberof UmbTreeExpansionManager\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic async collapseItem(entity: UmbEntityModel): Promise<void> {\r\n\t\tthis.#manager.collapseItem(entity);\r\n\t}\r\n\r\n\t/**\r\n\t * Closes all child tree items\r\n\t * @memberof UmbTreeExpansionManager\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic async collapseAll(): Promise<void> {\r\n\t\tthis.#manager.collapseAll();\r\n\t}\r\n}\r\n","import type { UmbTreeItemModel, UmbTreeRootModel, UmbTreeStartNode } from '../types.js';\r\nimport type { UmbTreeRepository } from '../data/tree-repository.interface.js';\r\nimport type { UmbTreeContext } from '../tree-context.interface.js';\r\nimport type { UmbTreeRootItemsRequestArgs } from '../data/types.js';\r\nimport type { ManifestTree } from '../extensions/types.js';\r\nimport { UmbTreeExpansionManager } from '../expansion-manager/index.js';\r\nimport type { UmbTreeExpansionModel } from '../expansion-manager/types.js';\r\nimport { UMB_TREE_CONTEXT } from './default-tree.context-token.js';\r\nimport { type UmbActionEventContext, UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport { type ManifestRepository, umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbExtensionApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbDeprecation, UmbPaginationManager, UmbSelectionManager, debounce } from '@umbraco-cms/backoffice/utils';\r\nimport {\r\n\tUmbRequestReloadChildrenOfEntityEvent,\r\n\ttype UmbEntityActionEvent,\r\n} from '@umbraco-cms/backoffice/entity-action';\r\nimport { UmbArrayState, UmbBooleanState, UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\n\r\nexport class UmbDefaultTreeContext<\r\n\t\tTreeItemType extends UmbTreeItemModel,\r\n\t\tTreeRootType extends UmbTreeRootModel,\r\n\t\tRequestArgsType extends UmbTreeRootItemsRequestArgs = UmbTreeRootItemsRequestArgs,\r\n\t>\r\n\textends UmbContextBase\r\n\timplements UmbTreeContext\r\n{\r\n\t#additionalRequestArgs = new UmbObjectState<Partial<RequestArgsType> | object>({});\r\n\tpublic readonly additionalRequestArgs = this.#additionalRequestArgs.asObservable();\r\n\r\n\t#treeRoot = new UmbObjectState<TreeRootType | undefined>(undefined);\r\n\ttreeRoot = this.#treeRoot.asObservable();\r\n\r\n\t#rootItems = new UmbArrayState<TreeItemType>([], (x) => x.unique);\r\n\trootItems = this.#rootItems.asObservable();\r\n\r\n\tpublic selectableFilter?: (item: TreeItemType) => boolean = () => true;\r\n\tpublic filter?: (item: TreeItemType) => boolean = () => true;\r\n\tpublic readonly selection = new UmbSelectionManager(this);\r\n\tpublic readonly pagination = new UmbPaginationManager();\r\n\tpublic readonly expansion = new UmbTreeExpansionManager(this);\r\n\r\n\t#hideTreeRoot = new UmbBooleanState(false);\r\n\thideTreeRoot = this.#hideTreeRoot.asObservable();\r\n\r\n\t#expandTreeRoot = new UmbBooleanState(undefined);\r\n\texpandTreeRoot = this.#expandTreeRoot.asObservable();\r\n\r\n\t#startNode = new UmbObjectState<UmbTreeStartNode | undefined>(undefined);\r\n\tstartNode = this.#startNode.asObservable();\r\n\r\n\t#foldersOnly = new UmbBooleanState(false);\r\n\tfoldersOnly = this.#foldersOnly.asObservable();\r\n\r\n\t#manifest?: ManifestTree;\r\n\t#repository?: UmbTreeRepository<TreeItemType, TreeRootType>;\r\n\t#actionEventContext?: UmbActionEventContext;\r\n\r\n\t#paging = {\r\n\t\tskip: 0,\r\n\t\ttake: 50,\r\n\t};\r\n\r\n\t#initResolver?: () => void;\r\n\t#initialized = false;\r\n\r\n\t#init = new Promise<void>((resolve) => {\r\n\t\tif (this.#initialized) {\r\n\t\t\tresolve();\r\n\t\t} else {\r\n\t\t\tthis.#initResolver = resolve;\r\n\t\t}\r\n\t});\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tsuper(host, UMB_TREE_CONTEXT);\r\n\r\n\t\tthis.pagination.setPageSize(this.#paging.take);\r\n\t\tthis.#consumeContexts();\r\n\r\n\t\t// listen for page changes on the pagination manager\r\n\t\tthis.pagination.addEventListener(UmbChangeEvent.TYPE, this.#onPageChange);\r\n\r\n\t\t// always load the tree root because we need the root entity to reload the entire tree\r\n\t\tthis.#loadTreeRoot();\r\n\t}\r\n\r\n\t// TODO: find a generic way to do this\r\n\t#checkIfInitialized() {\r\n\t\tif (this.#repository) {\r\n\t\t\tthis.#initialized = true;\r\n\t\t\tthis.#initResolver?.();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the manifest\r\n\t * @param {ManifestTree} manifest\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tpublic set manifest(manifest: ManifestTree | undefined) {\r\n\t\tif (this.#manifest === manifest) return;\r\n\t\tthis.#manifest = manifest;\r\n\t\tthis.#observeRepository(this.#manifest?.meta.repositoryAlias);\r\n\t}\r\n\tpublic get manifest() {\r\n\t\treturn this.#manifest;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the manifest.\r\n\t * @returns {ManifestTree}\r\n\t * @memberof UmbDefaultTreeContext\r\n\t * @deprecated Use the `.manifest` property instead.\r\n\t */\r\n\tpublic getManifest() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tremoveInVersion: '18.0.0',\r\n\t\t\tdeprecated: 'getManifest',\r\n\t\t\tsolution: 'Use .manifest property instead',\r\n\t\t}).warn();\r\n\t\treturn this.#manifest;\r\n\t}\r\n\r\n\tpublic getRepository() {\r\n\t\treturn this.#repository;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads the tree\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\t// TODO: debouncing the load tree method because multiple props can be set at the same time\r\n\t// that would trigger multiple loadTree calls. This is a temporary solution to avoid that.\r\n\tpublic loadTree = debounce(() => this.#debouncedLoadTree(), 100);\r\n\r\n\t/**\r\n\t * Reloads the tree\r\n\t * @memberof UmbDefaultTreeContext\r\n\t * @returns {void}\r\n\t */\r\n\tpublic loadMore = () => this.#debouncedLoadTree(true);\r\n\r\n\t#debouncedLoadTree(reload = false) {\r\n\t\tif (this.getStartNode()) {\r\n\t\t\tthis.#loadRootItems(reload);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst hideTreeRoot = this.getHideTreeRoot();\r\n\t\tif (hideTreeRoot) {\r\n\t\t\tthis.#loadRootItems(reload);\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #loadTreeRoot() {\r\n\t\tawait this.#init;\r\n\r\n\t\tconst { data } = await this.#repository!.requestTreeRoot();\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#treeRoot.setValue(data);\r\n\t\t\tthis.pagination.setTotalItems(1);\r\n\r\n\t\t\tif (this.getExpandTreeRoot()) {\r\n\t\t\t\tthis.#toggleTreeRootExpansion(true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #loadRootItems(loadMore = false) {\r\n\t\tawait this.#init;\r\n\r\n\t\tconst skip = loadMore ? this.#paging.skip : 0;\r\n\t\tconst take = loadMore ? this.#paging.take : this.pagination.getCurrentPageNumber() * this.#paging.take;\r\n\r\n\t\t// If we have a start node get children of that instead of the root\r\n\t\tconst startNode = this.getStartNode();\r\n\t\tconst foldersOnly = this.#foldersOnly.getValue();\r\n\t\tconst additionalArgs = this.#additionalRequestArgs.getValue();\r\n\r\n\t\tconst { data } = startNode?.unique\r\n\t\t\t? await this.#repository!.requestTreeItemsOf({\r\n\t\t\t\t\t...additionalArgs,\r\n\t\t\t\t\tparent: {\r\n\t\t\t\t\t\tunique: startNode.unique,\r\n\t\t\t\t\t\tentityType: startNode.entityType,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfoldersOnly,\r\n\t\t\t\t\tskip,\r\n\t\t\t\t\ttake,\r\n\t\t\t\t})\r\n\t\t\t: await this.#repository!.requestTreeRootItems({\r\n\t\t\t\t\t...additionalArgs,\r\n\t\t\t\t\tfoldersOnly,\r\n\t\t\t\t\tskip,\r\n\t\t\t\t\ttake,\r\n\t\t\t\t});\r\n\r\n\t\tif (data) {\r\n\t\t\tif (loadMore) {\r\n\t\t\t\tconst currentItems = this.#rootItems.getValue();\r\n\t\t\t\tthis.#rootItems.setValue([...currentItems, ...data.items]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.#rootItems.setValue(data.items);\r\n\t\t\t}\r\n\r\n\t\t\tthis.pagination.setTotalItems(data.total);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the hideTreeRoot config\r\n\t * @param {boolean} hideTreeRoot - Whether to hide the tree root\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tsetHideTreeRoot(hideTreeRoot: boolean) {\r\n\t\tthis.#hideTreeRoot.setValue(hideTreeRoot);\r\n\t\t// we need to reset the tree if this config changes\r\n\t\tthis.#resetTree();\r\n\t\tthis.loadTree();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the hideTreeRoot config\r\n\t * @returns {boolean}\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tgetHideTreeRoot() {\r\n\t\treturn this.#hideTreeRoot.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the startNode config\r\n\t * @param {UmbTreeStartNode} startNode\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tsetStartNode(startNode: UmbTreeStartNode | undefined) {\r\n\t\tthis.#startNode.setValue(startNode);\r\n\t\t// we need to reset the tree if this config changes\r\n\t\tthis.#resetTree();\r\n\t\tthis.loadTree();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the startNode config\r\n\t * @returns {UmbTreeStartNode} - The start node\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tgetStartNode() {\r\n\t\treturn this.#startNode.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the foldersOnly config\r\n\t * @param {boolean} foldersOnly - Whether to show only folders\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tsetFoldersOnly(foldersOnly: boolean) {\r\n\t\tthis.#foldersOnly.setValue(foldersOnly);\r\n\t\t// we need to reset the tree if this config changes\r\n\t\tthis.#resetTree();\r\n\t\tthis.loadTree();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the foldersOnly config\r\n\t * @returns {boolean} - Whether to show only folders\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tgetFoldersOnly() {\r\n\t\treturn this.#foldersOnly.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the requestArgs config and reloads the tree.\r\n\t * @param args\r\n\t */\r\n\tpublic updateAdditionalRequestArgs(args: Partial<RequestArgsType>) {\r\n\t\tthis.#additionalRequestArgs.setValue({ ...this.#additionalRequestArgs.getValue(), ...args });\r\n\t\tthis.#resetTree();\r\n\t\tthis.loadTree();\r\n\t}\r\n\r\n\tpublic getAdditionalRequestArgs() {\r\n\t\treturn this.#additionalRequestArgs.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the expansion state\r\n\t * @param {UmbTreeExpansionModel} data - The expansion state\r\n\t * @returns {void}\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tsetExpansion(data: UmbTreeExpansionModel): void {\r\n\t\tthis.expansion.setExpansion(data);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the expansion state\r\n\t * @returns {UmbTreeExpansionModel} - The expansion state\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tgetExpansion(): UmbTreeExpansionModel {\r\n\t\treturn this.expansion.getExpansion();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the expandTreeRoot config\r\n\t * @param {boolean} expandTreeRoot - Whether to expand the tree root\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tsetExpandTreeRoot(expandTreeRoot: boolean) {\r\n\t\tthis.#expandTreeRoot.setValue(expandTreeRoot);\r\n\t\tthis.#toggleTreeRootExpansion(expandTreeRoot);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the expandTreeRoot config\r\n\t * @returns {boolean | undefined} - Whether to expand the tree root\r\n\t * @memberof UmbDefaultTreeContext\r\n\t */\r\n\tgetExpandTreeRoot(): boolean | undefined {\r\n\t\treturn this.#expandTreeRoot.getValue();\r\n\t}\r\n\r\n\t#toggleTreeRootExpansion(expand: boolean) {\r\n\t\tconst treeRoot = this.#treeRoot.getValue();\r\n\t\tif (!treeRoot) return;\r\n\t\tconst treeRootEntity = { entityType: treeRoot.entityType, unique: treeRoot.unique };\r\n\r\n\t\tif (expand) {\r\n\t\t\tthis.expansion.expandItem(treeRootEntity);\r\n\t\t} else {\r\n\t\t\tthis.expansion.collapseItem(treeRootEntity);\r\n\t\t}\r\n\t}\r\n\r\n\t#resetTree() {\r\n\t\tthis.#treeRoot.setValue(undefined);\r\n\t\tthis.#rootItems.setValue([]);\r\n\t\tthis.pagination.clear();\r\n\t}\r\n\r\n\t#consumeContexts() {\r\n\t\tthis.consumeContext(UMB_ACTION_EVENT_CONTEXT, (instance) => {\r\n\t\t\tthis.#removeEventListeners();\r\n\t\t\tthis.#actionEventContext = instance;\r\n\r\n\t\t\tthis.#actionEventContext?.addEventListener(\r\n\t\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadRequest as EventListener,\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t#onPageChange = (event: UmbChangeEvent) => {\r\n\t\tconst target = event.target as UmbPaginationManager;\r\n\t\tthis.#paging.skip = target.getSkip();\r\n\t\tthis.loadMore();\r\n\t};\r\n\r\n\t#observeRepository(repositoryAlias?: string) {\r\n\t\tif (!repositoryAlias) throw new Error('Tree must have a repository alias.');\r\n\r\n\t\tnew UmbExtensionApiInitializer<ManifestRepository<UmbTreeRepository<TreeItemType>>>(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\trepositoryAlias,\r\n\t\t\t[this],\r\n\t\t\t(permitted, ctrl) => {\r\n\t\t\t\tthis.#repository = permitted ? ctrl.api : undefined;\r\n\t\t\t\tthis.#checkIfInitialized();\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\t#onReloadRequest = (event: UmbEntityActionEvent) => {\r\n\t\t// Only handle root request here. Items are handled by the tree item context\r\n\t\tconst treeRoot = this.#treeRoot.getValue();\r\n\t\tif (treeRoot === undefined) return;\r\n\t\tif (event.getUnique() !== treeRoot.unique) return;\r\n\t\tif (event.getEntityType() !== treeRoot.entityType) return;\r\n\t\tthis.loadTree();\r\n\t};\r\n\r\n\t#removeEventListeners() {\r\n\t\tthis.#actionEventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\tthis.#onReloadRequest as EventListener,\r\n\t\t);\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#removeEventListeners();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport { UmbDefaultTreeContext as api };\r\n"],"names":["UmbTreeExpansionManager","UmbControllerBase","#manager","UmbEntityExpansionManager","entity","expansion","UmbDefaultTreeContext","UmbContextBase","host","UMB_TREE_CONTEXT","#additionalRequestArgs","UmbObjectState","#treeRoot","#rootItems","UmbArrayState","x","UmbSelectionManager","UmbPaginationManager","#hideTreeRoot","UmbBooleanState","#expandTreeRoot","#startNode","#foldersOnly","#paging","#initialized","#init","resolve","#initResolver","debounce","#debouncedLoadTree","#onPageChange","event","target","#onReloadRequest","treeRoot","#consumeContexts","UmbChangeEvent","#loadTreeRoot","#manifest","#repository","#actionEventContext","#checkIfInitialized","manifest","#observeRepository","UmbDeprecation","reload","#loadRootItems","data","#toggleTreeRootExpansion","loadMore","skip","take","startNode","foldersOnly","additionalArgs","currentItems","hideTreeRoot","#resetTree","args","expandTreeRoot","expand","treeRootEntity","UMB_ACTION_EVENT_CONTEXT","instance","#removeEventListeners","UmbRequestReloadChildrenOfEntityEvent","repositoryAlias","UmbExtensionApiInitializer","umbExtensionsRegistry","permitted","ctrl"],"mappings":"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"}