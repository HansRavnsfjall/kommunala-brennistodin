{"version":3,"file":"delete.action-i_U4UuZZ.js","sources":["../../../src/packages/core/entity-action/common/delete/delete.action.ts"],"sourcesContent":["import { UmbEntityActionBase } from '../../entity-action-base.js';\r\nimport { UmbRequestReloadStructureForEntityEvent } from '../../request-reload-structure-for-entity.event.js';\r\nimport type { MetaEntityActionDeleteKind } from './types.js';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { umbConfirmModal } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDetailRepository, UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\n\r\nexport class UmbDeleteEntityAction<\r\n\tMetaKind extends MetaEntityActionDeleteKind = MetaEntityActionDeleteKind,\r\n> extends UmbEntityActionBase<MetaKind> {\r\n\t// TODO: make base type for item and detail models\r\n\t#localize = new UmbLocalizationController(this);\r\n\r\n\toverride async execute() {\r\n\t\tif (!this.args.unique) throw new Error('Cannot delete an item without a unique identifier.');\r\n\r\n\t\tconst item = await this.#requestItem();\r\n\r\n\t\tawait this._confirmDelete(item);\r\n\r\n\t\tconst detailRepository = await createExtensionApiByAlias<UmbDetailRepository<any>>(\r\n\t\t\tthis,\r\n\t\t\tthis.args.meta.detailRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tconst { error } = await detailRepository.delete(this.args.unique);\r\n\t\tif (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\r\n\t\tawait this.#notify();\r\n\t}\r\n\r\n\tprotected async _confirmDelete(item: any) {\r\n\t\tconst headline = this.args.meta.confirm?.headline ?? '#actions_delete';\r\n\t\tconst message = this.args.meta.confirm?.message ?? '#defaultdialogs_confirmdelete';\r\n\r\n\t\t// TODO: handle items with variants\r\n\t\tawait umbConfirmModal(this, {\r\n\t\t\theadline,\r\n\t\t\tcontent: this.#localize.string(message, item.name),\r\n\t\t\tcolor: 'danger',\r\n\t\t\tconfirmLabel: '#general_delete',\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestItem() {\r\n\t\tif (!this.args.unique) throw new Error('Cannot delete an item without a unique identifier.');\r\n\r\n\t\tconst itemRepository = await createExtensionApiByAlias<UmbItemRepository<any>>(\r\n\t\t\tthis,\r\n\t\t\tthis.args.meta.itemRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tconst { data } = await itemRepository.requestItems([this.args.unique]);\r\n\t\tconst item = data?.[0];\r\n\t\tif (!item) throw new Error('Item not found.');\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\tasync #notify() {\r\n\t\tconst actionEventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\t\tif (!actionEventContext) {\r\n\t\t\tthrow new Error('Action event context not found.');\r\n\t\t}\r\n\r\n\t\tconst event = new UmbRequestReloadStructureForEntityEvent({\r\n\t\t\tunique: this.args.unique,\r\n\t\t\tentityType: this.args.entityType,\r\n\t\t});\r\n\r\n\t\tactionEventContext.dispatchEvent(event);\r\n\t}\r\n}\r\nexport default UmbDeleteEntityAction;\r\n"],"names":["UmbDeleteEntityAction","UmbEntityActionBase","#localize","UmbLocalizationController","item","#requestItem","detailRepository","createExtensionApiByAlias","error","#notify","headline","message","umbConfirmModal","itemRepository","data","actionEventContext","UMB_ACTION_EVENT_CONTEXT","event","UmbRequestReloadStructureForEntityEvent"],"mappings":";;;;;;AASO,MAAMA,UAEHC,EAA8B;AAAA;AAAA,EAEvCC,KAAY,IAAIC,EAA0B,IAAI;AAAA,EAE9C,MAAe,UAAU;AACxB,QAAI,CAAC,KAAK,KAAK,OAAQ,OAAM,IAAI,MAAM,oDAAoD;AAE3F,UAAMC,IAAO,MAAM,KAAKC,GAAA;AAExB,UAAM,KAAK,eAAeD,CAAI;AAE9B,UAAME,IAAmB,MAAMC;AAAA,MAC9B;AAAA,MACA,KAAK,KAAK,KAAK;AAAA,IAAA,GAGV,EAAE,OAAAC,MAAU,MAAMF,EAAiB,OAAO,KAAK,KAAK,MAAM;AAChE,QAAIE;AACH,YAAMA;AAGP,UAAM,KAAKC,GAAA;AAAA,EACZ;AAAA,EAEA,MAAgB,eAAeL,GAAW;AACzC,UAAMM,IAAW,KAAK,KAAK,KAAK,SAAS,YAAY,mBAC/CC,IAAU,KAAK,KAAK,KAAK,SAAS,WAAW;AAGnD,UAAMC,EAAgB,MAAM;AAAA,MAC3B,UAAAF;AAAA,MACA,SAAS,KAAKR,GAAU,OAAOS,GAASP,EAAK,IAAI;AAAA,MACjD,OAAO;AAAA,MACP,cAAc;AAAA,IAAA,CACd;AAAA,EACF;AAAA,EAEA,MAAMC,KAAe;AACpB,QAAI,CAAC,KAAK,KAAK,OAAQ,OAAM,IAAI,MAAM,oDAAoD;AAE3F,UAAMQ,IAAiB,MAAMN;AAAA,MAC5B;AAAA,MACA,KAAK,KAAK,KAAK;AAAA,IAAA,GAGV,EAAE,MAAAO,EAAA,IAAS,MAAMD,EAAe,aAAa,CAAC,KAAK,KAAK,MAAM,CAAC,GAC/DT,IAAOU,IAAO,CAAC;AACrB,QAAI,CAACV,EAAM,OAAM,IAAI,MAAM,iBAAiB;AAE5C,WAAOA;AAAA,EACR;AAAA,EAEA,MAAMK,KAAU;AACf,UAAMM,IAAqB,MAAM,KAAK,WAAWC,CAAwB;AACzE,QAAI,CAACD;AACJ,YAAM,IAAI,MAAM,iCAAiC;AAGlD,UAAME,IAAQ,IAAIC,EAAwC;AAAA,MACzD,QAAQ,KAAK,KAAK;AAAA,MAClB,YAAY,KAAK,KAAK;AAAA,IAAA,CACtB;AAED,IAAAH,EAAmB,cAAcE,CAAK;AAAA,EACvC;AACD;"}