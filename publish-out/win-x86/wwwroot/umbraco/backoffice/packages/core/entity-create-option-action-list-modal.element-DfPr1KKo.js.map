{"version":3,"file":"entity-create-option-action-list-modal.element-DfPr1KKo.js","sources":["../../../src/packages/core/entity-action/common/create/modal/entity-create-option-action-list-modal.element.ts"],"sourcesContent":["import type {\r\n\tUmbEntityCreateOptionActionListModalData,\r\n\tUmbEntityCreateOptionActionListModalValue,\r\n} from './entity-create-option-action-list-modal.token.js';\r\nimport { UmbRefItemElement } from '@umbraco-cms/backoffice/components';\r\nimport type { ManifestEntityCreateOptionAction } from '@umbraco-cms/backoffice/entity-create-option-action';\r\nimport type { UmbExtensionApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbExtensionsApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport {\r\n\thtml,\r\n\tcustomElement,\r\n\tstate,\r\n\trepeat,\r\n\tifDefined,\r\n\ttype PropertyValues,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\n\r\ntype ManifestType = ManifestEntityCreateOptionAction;\r\n\r\n@customElement('umb-entity-create-option-action-list-modal')\r\nexport class UmbEntityCreateOptionActionListModalElement extends UmbModalBaseElement<\r\n\tUmbEntityCreateOptionActionListModalData,\r\n\tUmbEntityCreateOptionActionListModalValue\r\n> {\r\n\t@state()\r\n\tprivate _apiControllers: Array<UmbExtensionApiInitializer<ManifestType>> = [];\r\n\r\n\t@state()\r\n\tprivate _hrefList: Array<string | undefined> = [];\r\n\r\n\tprotected override updated(_changedProperties: PropertyValues): void {\r\n\t\tsuper.updated(_changedProperties);\r\n\r\n\t\tif (_changedProperties.has('data')) {\r\n\t\t\tthis.#initApi();\r\n\t\t}\r\n\t}\r\n\r\n\t#initApi() {\r\n\t\tconst data = this.data;\r\n\t\tif (!data) throw new Error('No data found');\r\n\r\n\t\tif (!data.entityType) throw new Error('No entityType found');\r\n\t\tif (data.unique === undefined) throw new Error('No unique found');\r\n\r\n\t\tnew UmbExtensionsApiInitializer(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\t'entityCreateOptionAction',\r\n\t\t\t(manifest: ManifestType) => {\r\n\t\t\t\treturn [{ entityType: data.entityType, unique: data.unique, meta: manifest.meta }];\r\n\t\t\t},\r\n\t\t\t(manifest: ManifestType) => manifest.forEntityTypes.includes(data.entityType),\r\n\t\t\tasync (controllers) => {\r\n\t\t\t\tthis._apiControllers = controllers as unknown as Array<UmbExtensionApiInitializer<ManifestType>>;\r\n\t\t\t\tconst hrefPromises = this._apiControllers.map((controller) => controller.api?.getHref());\r\n\t\t\t\tthis._hrefList = await Promise.all(hrefPromises);\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\tasync #onOpen(event: Event, controller: UmbExtensionApiInitializer<ManifestType>) {\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tif (!controller.api) {\r\n\t\t\tthrow new Error('No API found');\r\n\t\t}\r\n\r\n\t\tcontroller.api\r\n\t\t\t.execute()\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis._submitModal();\r\n\t\t\t})\r\n\t\t\t.catch(() => {});\r\n\t}\r\n\r\n\tasync #onNavigate(event: Event, href: string | undefined) {\r\n\t\tconst refItemElement = event.composedPath().find((x) => x instanceof UmbRefItemElement) as UmbRefItemElement;\r\n\r\n\t\t// ignore click events if they are not on a ref item\r\n\t\tif (!refItemElement) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!href) {\r\n\t\t\tthrow new Error('No href found');\r\n\t\t}\r\n\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#getTarget(href?: string) {\r\n\t\tif (href && href.startsWith('http')) {\r\n\t\t\treturn '_blank';\r\n\t\t}\r\n\r\n\t\treturn '_self';\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"${this.localize.term('general_create')}\">\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t${this._apiControllers.length === 0\r\n\t\t\t\t\t\t? html`<div>No create options available.</div>`\r\n\t\t\t\t\t\t: html`\r\n\t\t\t\t\t\t\t\t<uui-ref-list>\r\n\t\t\t\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\t\t\t\tthis._apiControllers,\r\n\t\t\t\t\t\t\t\t\t\t(controller) => controller.manifest?.alias,\r\n\t\t\t\t\t\t\t\t\t\t(controller, index) => this.#renderRefItem(controller, index),\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</uui-ref-list>\r\n\t\t\t\t\t\t\t`}\r\n\t\t\t\t</uui-box>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t\t@click=${this._rejectModal}></uui-button>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRefItem(controller: UmbExtensionApiInitializer<ManifestType>, index: number) {\r\n\t\tconst manifest = controller.manifest;\r\n\t\tif (!manifest) throw new Error('No manifest found');\r\n\r\n\t\tconst label = manifest.meta.label ? this.localize.string(manifest.meta.label) : manifest.name;\r\n\t\tconst description = manifest.meta.description ? this.localize.string(manifest.meta.description) : undefined;\r\n\t\tconst href = this._hrefList[index];\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-ref-item\r\n\t\t\t\tname=${label}\r\n\t\t\t\tdetail=${ifDefined(description)}\r\n\t\t\t\ticon=${manifest.meta.icon}\r\n\t\t\t\thref=${ifDefined(href)}\r\n\t\t\t\ttarget=${this.#getTarget(href)}\r\n\t\t\t\t@open=${async (event: Event) => await this.#onOpen(event, controller).catch(() => undefined)}\r\n\t\t\t\t@click=${(event: Event) => this.#onNavigate(event, href)}>\r\n\t\t\t</umb-ref-item>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport { UmbEntityCreateOptionActionListModalElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-entity-create-option-action-list-modal': UmbEntityCreateOptionActionListModalElement;\r\n\t}\r\n}\r\n"],"names":["_UmbEntityCreateOptionActionListModalElement_instances","initApi_fn","onOpen_fn","onNavigate_fn","getTarget_fn","renderRefItem_fn","UmbEntityCreateOptionActionListModalElement","UmbModalBaseElement","__privateAdd","_changedProperties","__privateMethod","html","repeat","controller","index","data","UmbExtensionsApiInitializer","umbExtensionsRegistry","manifest","controllers","hrefPromises","event","href","x","UmbRefItemElement","label","description","ifDefined","__decorateClass","state","customElement"],"mappings":"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"}