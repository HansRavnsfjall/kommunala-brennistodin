{"version":3,"file":"entity-sign-bundle.element-hkC5dsoB.js","sources":["../../../src/packages/core/entity-sign/components/entity-sign-bundle.element.ts"],"sourcesContent":["import { UmbLitElement } from '../../lit-element/lit-element.element.js';\r\nimport type { ManifestEntitySign } from '../types.js';\r\nimport { customElement, html, nothing, property, repeat, state, css } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbExtensionsElementAndApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport type { UmbObserverController } from '@umbraco-cms/backoffice/observable-api';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { UmbEntityFlag } from '@umbraco-cms/backoffice/entity-flag';\r\n\r\n@customElement('umb-entity-sign-bundle')\r\nexport class UmbEntitySignBundleElement extends UmbLitElement {\r\n\t#entityType?: string;\r\n\t#entityFlagAliases?: Array<string>;\r\n\r\n\t@property({ type: String, attribute: 'entity-type', reflect: false })\r\n\tget entityType(): string | undefined {\r\n\t\treturn this.#entityType;\r\n\t}\r\n\r\n\tset entityType(value: string | undefined) {\r\n\t\tif (this.#entityType === value) return;\r\n\t\tthis.#entityType = value;\r\n\t\tthis.#gotProperties();\r\n\t}\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tget entityFlags(): Array<UmbEntityFlag> | undefined {\r\n\t\treturn this.#entityFlagAliases?.map((x) => ({ alias: x }));\r\n\t}\r\n\r\n\tset entityFlags(value: Array<UmbEntityFlag> | undefined) {\r\n\t\tconst entityFlagAliases = value?.map((x) => x.alias);\r\n\t\t// If they are equal return:\r\n\t\tif (this.#entityFlagAliases?.join(',') === entityFlagAliases?.join(',')) return;\r\n\t\tthis.#entityFlagAliases = entityFlagAliases;\r\n\t\tthis.#gotProperties();\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _signs?: Array<any>;\r\n\r\n\t@state()\r\n\tprivate _labels: Map<string, string> = new Map();\r\n\r\n\tprivate _open = false;\r\n\tprivate _hoverTimer?: number;\r\n\r\n\t#signLabelObservations: Array<UmbObserverController<string>> = [];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.addEventListener('mouseenter', this.#openTooltip);\r\n\t\tthis.addEventListener('mouseleave', this.#cancelOpen);\r\n\t}\r\n\r\n\t#manifestFilter = (manifest: ManifestEntitySign) => {\r\n\t\tif (manifest.forEntityTypes && !manifest.forEntityTypes.includes(this.#entityType!)) return false;\r\n\t\tif (manifest.forEntityFlags && !manifest.forEntityFlags.some((x) => this.#entityFlagAliases?.includes(x)))\r\n\t\t\treturn false;\r\n\t\treturn true;\r\n\t};\r\n\r\n\t#gotProperties() {\r\n\t\tif (!this.#entityType || !this.#entityFlagAliases) {\r\n\t\t\tthis.removeUmbControllerByAlias('extensionsInitializer');\r\n\t\t\tthis._signs = [];\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnew UmbExtensionsElementAndApiInitializer(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\t'entitySign',\r\n\t\t\t(manifest: ManifestEntitySign) => [{ meta: manifest.meta }],\r\n\t\t\tthis.#manifestFilter,\r\n\t\t\t(signs) => {\r\n\t\t\t\t// Clean up old observers\r\n\t\t\t\tthis.#signLabelObservations.forEach((o) => this.removeUmbController(o));\r\n\t\t\t\tthis.#signLabelObservations = [];\r\n\r\n\t\t\t\t// Setup label observers\r\n\t\t\t\tsigns.forEach((sign) => {\r\n\t\t\t\t\tif (sign.api?.label) {\r\n\t\t\t\t\t\tconst obs = this.observe(\r\n\t\t\t\t\t\t\tsign.api.label,\r\n\t\t\t\t\t\t\t(label) => {\r\n\t\t\t\t\t\t\t\tthis._labels.set(sign.alias, label);\r\n\t\t\t\t\t\t\t\tthis.requestUpdate('_labels');\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t'_observeSignLabelOf_' + sign.alias,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tthis.#signLabelObservations.push(obs);\r\n\t\t\t\t\t} else if (sign.api?.getLabel) {\r\n\t\t\t\t\t\tthis._labels.set(sign.alias, sign.api.getLabel() ?? '');\r\n\t\t\t\t\t\tthis.requestUpdate('_labels');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis._signs = signs;\r\n\t\t\t},\r\n\t\t\t'extensionsInitializer',\r\n\t\t);\r\n\t}\r\n\r\n\t#handleHoverTimer(open: boolean, delay: number) {\r\n\t\tif (this._hoverTimer) clearTimeout(this._hoverTimer);\r\n\t\tthis._hoverTimer = window.setTimeout(() => {\r\n\t\t\tthis._open = open;\r\n\t\t\tthis.requestUpdate();\r\n\t\t\tthis._hoverTimer = undefined;\r\n\t\t}, delay);\r\n\t}\r\n\r\n\t#openTooltip = () => {\r\n\t\tif (!this._open) {\r\n\t\t\tthis.#handleHoverTimer(true, 240);\r\n\t\t}\r\n\t};\r\n\r\n\t#cancelOpen = () => {\r\n\t\tif (this._open) {\r\n\t\t\tthis.#handleHoverTimer(false, 360);\r\n\t\t} else if (this._hoverTimer) {\r\n\t\t\tclearTimeout(this._hoverTimer);\r\n\t\t\tthis._hoverTimer = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<slot></slot>\r\n\t\t\t${this.#renderBundle()}\r\n\t\t`;\r\n\t}\r\n\t#renderBundle() {\r\n\t\tif (!this._signs || this._signs.length === 0) return nothing;\r\n\r\n\t\tconst first = this._signs?.[0];\r\n\t\tif (!first) return nothing;\r\n\t\treturn html`<div class=\"infobox ${this._open ? 'is-open' : ''}\" style=${`--count:${this._signs.length}`}>\r\n\t\t\t${this.#renderOptions()}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\t#renderOptions() {\r\n\t\treturn this._signs\r\n\t\t\t? repeat(\r\n\t\t\t\t\tthis._signs,\r\n\t\t\t\t\t(c) => c.alias,\r\n\t\t\t\t\t(c, i) => {\r\n\t\t\t\t\t\treturn html`<div class=\"sign-container ${i > 1 ? 'hide-in-overview' : ''}\" style=${`--i:${i}`}>\r\n\t\t\t\t\t\t\t<span class=\"badge-icon\">${c.component}</span><span class=\"label\">${this._labels.get(c.alias)}</span>\r\n\t\t\t\t\t\t</div>`;\r\n\t\t\t\t\t},\r\n\t\t\t\t)\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tanchor-name: --entity-sign;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\t--offset-h: 12px; /* 22px / 16 */\r\n\t\t\t\t--row-h: 1.36rem; /* 22px / 16 */\r\n\t\t\t\t--icon-w: 0.75rem; /* 12px / 16 */\r\n\t\t\t\t--pad-x: 0.25rem; /*  4px / 16 */\r\n\t\t\t\t--ease: cubic-bezier(0.1, 0, 0.3, 1);\r\n\t\t\t\t--ease-bounce: cubic-bezier(0.175, 0.885, 0.32, 1.275);\r\n\t\t\t}\r\n\r\n\t\t\t.infobox {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 100%;\r\n\t\t\t\tmargin-top: calc(-12px + var(--offset-h));\r\n\t\t\t\tleft: 100%;\r\n\t\t\t\tmargin-left: -6px;\r\n\t\t\t\tbackground-color: transparent;\r\n\t\t\t\tpadding: var(--uui-size-2);\r\n\t\t\t\tpadding-left: var(--uui-size-3);\r\n\t\t\t\tfont-size: 8px;\r\n\t\t\t\tclip-path: inset(-10px calc(100% - 30px) calc(100% - 10px) -20px);\r\n\t\t\t\ttransition:\r\n\t\t\t\t\tbackground-color 80ms 40ms linear,\r\n\t\t\t\t\tclip-path 120ms var(--ease-bounce),\r\n\t\t\t\t\tfont-size 120ms var(--ease);\r\n\t\t\t\t/*will-change: clip-path;*/\r\n\t\t\t\tmin-height: fit-content;\r\n\t\t\t}\r\n\t\t\t.infobox::before {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tleft: 0;\r\n\t\t\t\tright: 100%;\r\n\t\t\t\tbottom: 100%;\r\n\t\t\t\topacity: 0;\r\n\t\t\t\tborder-radius: 3px;\r\n\t\t\t\tbox-shadow: var(--uui-shadow-depth-2);\r\n\t\t\t\tdisplay: none;\r\n\t\t\t\ttransition:\r\n\t\t\t\t\tright 120ms var(--ease-bounce),\r\n\t\t\t\t\tbottom 120ms var(--ease-bounce),\r\n\t\t\t\t\topacity 120ms linear,\r\n\t\t\t\t\tdisplay 0 120ms;\r\n\t\t\t}\r\n\r\n\t\t\t.infobox > .sign-container {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: start;\r\n\t\t\t\tgap: 3px;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\ttransform: translate(calc((var(--i) * -5px) - 10px), calc((-1 * var(--i) * var(--row-h)) - var(--offset-h)));\r\n\t\t\t\ttransition:\r\n\t\t\t\t\ttransform 120ms var(--ease),\r\n\t\t\t\t\tvisibility 0ms linear 120ms opacity 120ms linear;\r\n\t\t\t\tz-index: calc(var(--count) - var(--i));\r\n\t\t\t\t/*will-change: transform;*/\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t}\r\n\t\t\t.infobox > .sign-container.hide-in-overview {\r\n\t\t\t\tvisibility: hidden;\r\n\t\t\t}\r\n\r\n\t\t\t.infobox .sign-container .label {\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 120ms;\r\n\t\t\t}\r\n\r\n\t\t\t/*OPEN STATE -- Prevent the hover state in firefox(until support of the position-anchor)*/\r\n\t\t\t@supports (position-anchor: --any-check) {\r\n\t\t\t\t.infobox {\r\n\t\t\t\t\tposition: fixed;\r\n\t\t\t\t\tposition-anchor: --entity-sign;\r\n\t\t\t\t\ttop: anchor(bottom);\r\n\t\t\t\t\tleft: anchor(right);\r\n\t\t\t\t\tz-index: 1;\r\n\t\t\t\t}\r\n\t\t\t\t.infobox.is-open {\r\n\t\t\t\t\tz-index: 10;\r\n\t\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\t\tfont-size: 12px;\r\n\t\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\t\tclip-path: inset(-6px);\r\n\t\t\t\t\t--umb-sign-bundle-bg: var(--uui-color-surface);\r\n\t\t\t\t}\r\n\t\t\t\t.infobox.is-open::before {\r\n\t\t\t\t\tright: 0;\r\n\t\t\t\t\tbottom: 0;\r\n\t\t\t\t\topacity: 100;\r\n\t\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\ttransition:\r\n\t\t\t\t\t\tright 120ms var(--ease-bounce),\r\n\t\t\t\t\t\tbottom 120ms var(--ease-bounce),\r\n\t\t\t\t\t\topacity 120ms var(--ease),\r\n\t\t\t\t\t\tdisplay 0 0;\r\n\t\t\t\t}\r\n\t\t\t\t.infobox.is-open > .sign-container {\r\n\t\t\t\t\ttransform: none;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\ttransition: transform 120ms var(--ease);\r\n\t\t\t\t\tvisibility: visible;\r\n\t\t\t\t}\r\n\t\t\t\t.infobox.is-open .sign-container .label {\r\n\t\t\t\t\topacity: 1;\r\n\t\t\t\t\tpointer-events: auto;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-entity-sign-bundle': UmbEntitySignBundleElement;\r\n\t}\r\n}\r\n"],"names":["_entityType","_entityFlagAliases","_signLabelObservations","_manifestFilter","_UmbEntitySignBundleElement_instances","gotProperties_fn","handleHoverTimer_fn","_openTooltip","_cancelOpen","renderBundle_fn","renderOptions_fn","UmbEntitySignBundleElement","UmbLitElement","__privateAdd","manifest","__privateGet","x","__privateMethod","value","__privateSet","entityFlagAliases","html","UmbExtensionsElementAndApiInitializer","umbExtensionsRegistry","signs","o","sign","obs","label","open","delay","nothing","repeat","c","i","css","__decorateClass","property","state","customElement"],"mappings":";;;;;;;;;;wYAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AASO,IAAMC,IAAN,cAAyCC,EAAc;AAAA,EAuC7D,cAAc;AACb,UAAA,GAxCKC,EAAA,MAAAT,CAAA,GACNS,EAAA,MAAAb,CAAA,GACAa,EAAA,MAAAZ,CAAA,GA8BA,KAAQ,8BAAmC,IAAA,GAE3C,KAAQ,QAAQ,IAGhBY,EAAA,MAAAX,GAA+D,EAAC,GAQhEW,EAAA,MAAAV,GAAkB,CAACW,MACd,EAAAA,EAAS,kBAAkB,CAACA,EAAS,eAAe,SAASC,EAAA,MAAKf,CAAA,CAAY,KAC9Ec,EAAS,kBAAkB,CAACA,EAAS,eAAe,KAAK,CAACE,MAAMD,EAAA,MAAKd,CAAA,GAAoB,SAASe,CAAC,CAAC,EAGzG,GAqDAH,EAAA,MAAAN,GAAe,MAAM;AACpB,MAAK,KAAK,SACTU,EAAA,MAAKb,GAAAE,CAAA,EAAL,WAAuB,IAAM,GAAA;AAAA,IAE/B,CAAA,GAEAO,EAAA,MAAAL,GAAc,MAAM;AACnB,MAAI,KAAK,QACRS,EAAA,MAAKb,GAAAE,CAAA,EAAL,WAAuB,IAAO,GAAA,IACpB,KAAK,gBACf,aAAa,KAAK,WAAW,GAC7B,KAAK,cAAc;AAAA,IAErB,CAAA,GA3EC,KAAK,iBAAiB,cAAcS,EAAA,MAAKR,CAAA,CAAY,GACrD,KAAK,iBAAiB,cAAcQ,EAAA,MAAKP,CAAA,CAAW;AAAA,EACrD;AAAA,EAtCA,IAAI,aAAiC;AACpC,WAAOO,EAAA,MAAKf,CAAA;AAAA,EACb;AAAA,EAEA,IAAI,WAAWkB,GAA2B;AACzC,IAAIH,EAAA,MAAKf,OAAgBkB,MACzBC,EAAA,MAAKnB,GAAckB,CAAA,GACnBD,EAAA,MAAKb,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,EACD;AAAA,EAGA,IAAI,cAAgD;AACnD,WAAOU,EAAA,MAAKd,IAAoB,IAAI,CAACe,OAAO,EAAE,OAAOA,IAAI;AAAA,EAC1D;AAAA,EAEA,IAAI,YAAYE,GAAyC;AACxD,UAAME,IAAoBF,GAAO,IAAI,CAACF,MAAMA,EAAE,KAAK;AAEnD,IAAID,EAAA,MAAKd,IAAoB,KAAK,GAAG,MAAMmB,GAAmB,KAAK,GAAG,MACtED,EAAA,MAAKlB,GAAqBmB,CAAA,GAC1BH,EAAA,MAAKb,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,EACD;AAAA,EA4FS,SAAS;AACjB,WAAOgB;AAAA;AAAA,KAEJJ,EAAA,MAAKb,MAAL,KAAA,IAAA,CAAoB;AAAA;AAAA,EAExB;AA0ID;AApQCJ,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAmCAC,IAAA,oBAAA,QAAA;AAQAC,IAAA,oBAAA,QAAA;AA7CMC,IAAA,oBAAA,QAAA;AAoDNC,IAAc,WAAG;AAChB,MAAI,CAACU,EAAA,MAAKf,CAAA,KAAe,CAACe,QAAKd,CAAA,GAAoB;AAClD,SAAK,2BAA2B,uBAAuB,GACvD,KAAK,SAAS,CAAA;AACd;AAAA,EACD;AAEA,MAAIqB;AAAA,IACH;AAAA,IACAC;AAAA,IACA;AAAA,IACA,CAACT,MAAiC,CAAC,EAAE,MAAMA,EAAS,MAAM;AAAA,IAC1DC,EAAA,MAAKZ,CAAA;AAAA,IACL,CAACqB,MAAU;AAEV,MAAAT,EAAA,MAAKb,GAAuB,QAAQ,CAACuB,MAAM,KAAK,oBAAoBA,CAAC,CAAC,GACtEN,EAAA,MAAKjB,GAAyB,EAAC,GAG/BsB,EAAM,QAAQ,CAACE,MAAS;AACvB,YAAIA,EAAK,KAAK,OAAO;AACpB,gBAAMC,IAAM,KAAK;AAAA,YAChBD,EAAK,IAAI;AAAA,YACT,CAACE,MAAU;AACV,mBAAK,QAAQ,IAAIF,EAAK,OAAOE,CAAK,GAClC,KAAK,cAAc,SAAS;AAAA,YAC7B;AAAA,YACA,yBAAyBF,EAAK;AAAA,UAAA;AAE/B,UAAAX,EAAA,MAAKb,CAAA,EAAuB,KAAKyB,CAAG;AAAA,QACrC,MAAA,CAAWD,EAAK,KAAK,aACpB,KAAK,QAAQ,IAAIA,EAAK,OAAOA,EAAK,IAAI,SAAA,KAAc,EAAE,GACtD,KAAK,cAAc,SAAS;AAAA,MAE9B,CAAC,GAED,KAAK,SAASF;AAAA,IACf;AAAA,IACA;AAAA,EAAA;AAEF;AAEAlB,IAAiB,SAACuB,GAAeC,GAAe;AAC/C,EAAI,KAAK,eAAa,aAAa,KAAK,WAAW,GACnD,KAAK,cAAc,OAAO,WAAW,MAAM;AAC1C,SAAK,QAAQD,GACb,KAAK,cAAA,GACL,KAAK,cAAc;AAAA,EACpB,GAAGC,CAAK;AACT;AAEAvB,IAAA,oBAAA,QAAA;AAMAC,IAAA,oBAAA,QAAA;AAeAC,IAAa,WAAG;AACf,SAAI,CAAC,KAAK,UAAU,KAAK,OAAO,WAAW,IAAUsB,IAEvC,KAAK,SAAS,CAAC,IAEtBV,wBAA2B,KAAK,QAAQ,YAAY,EAAE,WAAW,WAAW,KAAK,OAAO,MAAM,EAAE;AAAA,KACpGJ,EAAA,MAAKb,MAAL,KAAA,IAAA,CAAqB;AAAA,YAFL2B;AAIpB;AAEArB,IAAc,WAAG;AAChB,SAAO,KAAK,SACTsB;AAAA,IACA,KAAK;AAAA,IACL,CAACC,MAAMA,EAAE;AAAA,IACT,CAACA,GAAGC,MACIb,+BAAkCa,IAAI,IAAI,qBAAqB,EAAE,WAAW,OAAOA,CAAC,EAAE;AAAA,kCACjED,EAAE,SAAS,8BAA8B,KAAK,QAAQ,IAAIA,EAAE,KAAK,CAAC;AAAA;AAAA,EAE/F,IAEAF;AACJ;AAlJYpB,EAoJI,SAAS;AAAA,EACxBwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+GD;AA/PIC,EAAA;AAAA,EADHC,EAAS,EAAE,MAAM,QAAQ,WAAW,eAAe,SAAS,IAAO;AAAA,GAJxD1B,EAKR,WAAA,cAAA,CAAA;AAWAyB,EAAA;AAAA,EADHC,EAAS,EAAE,MAAM,OAAO,WAAW,IAAO;AAAA,GAf/B1B,EAgBR,WAAA,eAAA,CAAA;AAaIyB,EAAA;AAAA,EADPE,EAAA;AAAM,GA5BK3B,EA6BJ,WAAA,UAAA,CAAA;AAGAyB,EAAA;AAAA,EADPE,EAAA;AAAM,GA/BK3B,EAgCJ,WAAA,WAAA,CAAA;AAhCIA,IAANyB,EAAA;AAAA,EADNG,EAAc,wBAAwB;AAAA,GAC1B5B,CAAA;"}