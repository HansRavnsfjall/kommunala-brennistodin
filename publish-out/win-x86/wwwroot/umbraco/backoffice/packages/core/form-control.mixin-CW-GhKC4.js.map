{"version":3,"file":"form-control.mixin-CW-GhKC4.js","sources":["../../../src/packages/core/validation/events/validation.event.ts","../../../src/packages/core/validation/events/validation-invalid.event.ts","../../../src/packages/core/validation/events/validation-valid.event.ts","../../../src/packages/core/validation/mixins/form-control.mixin.ts"],"sourcesContent":["export class UmbValidationEvent extends Event {\r\n\tpublic constructor(type: string) {\r\n\t\tsuper(type, { bubbles: true, composed: false, cancelable: false });\r\n\t}\r\n}\r\n","import { UmbValidationEvent } from './validation.event.js';\r\n\r\nexport class UmbValidationInvalidEvent extends UmbValidationEvent {\r\n\tstatic readonly TYPE = 'invalid';\r\n\r\n\tpublic constructor() {\r\n\t\tsuper(UmbValidationInvalidEvent.TYPE);\r\n\t}\r\n}\r\n","import { UmbValidationEvent } from './validation.event.js';\r\n\r\nexport class UmbValidationValidEvent extends UmbValidationEvent {\r\n\tstatic readonly TYPE = 'valid';\r\n\r\n\tconstructor() {\r\n\t\tsuper(UmbValidationValidEvent.TYPE);\r\n\t}\r\n}\r\n","import { UmbValidationInvalidEvent } from '../events/validation-invalid.event.js';\r\nimport { UmbValidationValidEvent } from '../events/validation-valid.event.js';\r\nimport { property, type LitElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { HTMLElementConstructor } from '@umbraco-cms/backoffice/extension-api';\r\n\r\ntype UmbNativeFormControlElement = Pick<\r\n\tHTMLObjectElement,\r\n\t'validity' | 'checkValidity' | 'validationMessage' | 'setCustomValidity'\r\n> &\r\n\tHTMLElement; // Eventually use a specific interface or list multiple options like appending these types: ... | HTMLTextAreaElement | HTMLSelectElement\r\n\r\n/* FlagTypes type options originate from:\r\n * https://developer.mozilla.org/en-US/docs/Web/API/ValidityState\r\n * */\r\ntype FlagTypes =\r\n\t| 'customError'\r\n\t| 'badInput'\r\n\t| 'patternMismatch'\r\n\t| 'rangeOverflow'\r\n\t| 'rangeUnderflow'\r\n\t| 'stepMismatch'\r\n\t| 'tooLong'\r\n\t| 'tooShort'\r\n\t| 'typeMismatch'\r\n\t| 'valueMissing'\r\n\t| 'valid';\r\n\r\nconst WeightedErrorFlagTypes = [\r\n\t'customError',\r\n\t'valueMissing',\r\n\t'badInput',\r\n\t'typeMismatch',\r\n\t'patternMismatch',\r\n\t'rangeOverflow',\r\n\t'rangeUnderflow',\r\n\t'stepMismatch',\r\n\t'tooLong',\r\n\t'tooShort',\r\n];\r\n\r\n// Acceptable as an internal interface/type, BUT if exposed externally this should be turned into a public interface in a separate file.\r\nexport interface UmbFormControlValidatorConfig {\r\n\tflagKey: FlagTypes;\r\n\tgetMessageMethod: () => string;\r\n\tcheckMethod: () => boolean;\r\n\tweight: number;\r\n}\r\n\r\nexport interface UmbFormControlMixinInterface<ValueType> extends HTMLElement {\r\n\taddValidator: (\r\n\t\tflagKey: FlagTypes,\r\n\t\tgetMessageMethod: () => string,\r\n\t\tcheckMethod: () => boolean,\r\n\t) => UmbFormControlValidatorConfig;\r\n\tremoveValidator: (obj: UmbFormControlValidatorConfig) => void;\r\n\t//static formAssociated: boolean;\r\n\t//protected getFormElement(): HTMLElement | undefined | null; // allows for null as it makes it simpler to just implement a querySelector as that might return null. [NL]\r\n\tfocusFirstInvalidElement(): void;\r\n\tget value(): ValueType;\r\n\tset value(newValue: ValueType);\r\n\tformResetCallback(): void;\r\n\tcheckValidity(): boolean;\r\n\tget validationMessage(): string;\r\n\tget validity(): ValidityState;\r\n\tsetCustomValidity(error?: string): void;\r\n\tsubmit(): void;\r\n\tpristine: boolean;\r\n}\r\n\r\nexport declare abstract class UmbFormControlMixinElement<ValueType>\r\n\textends LitElement\r\n\timplements UmbFormControlMixinInterface<ValueType>\r\n{\r\n\tprotected _internals: ElementInternals;\r\n\tprotected _runValidators(): void;\r\n\taddValidator: (\r\n\t\tflagKey: FlagTypes,\r\n\t\tgetMessageMethod: () => string,\r\n\t\tcheckMethod: () => boolean,\r\n\t) => UmbFormControlValidatorConfig;\r\n\tremoveValidator: (obj: UmbFormControlValidatorConfig) => void;\r\n\tprotected addFormControlElement(element: UmbNativeFormControlElement): void;\r\n\tprotected removeFormControlElement(element: UmbNativeFormControlElement): void;\r\n\r\n\t//static formAssociated: boolean;\r\n\tprotected getFormElement(): HTMLElement | undefined | null;\r\n\tfocusFirstInvalidElement(): void;\r\n\tget value(): ValueType;\r\n\tset value(newValue: ValueType);\r\n\tformResetCallback(): void;\r\n\tcheckValidity(): boolean;\r\n\tget validationMessage(): string;\r\n\tget validity(): ValidityState;\r\n\tsetCustomValidity(error?: string): void;\r\n\tsubmit(): void;\r\n\tpristine: boolean;\r\n}\r\n\r\n/**\r\n * @mixin\r\n * The mixin allows a custom element to participate in HTML forms.\r\n * @param {object} superClass - superclass to be extended.\r\n * @param {object} defaultValue - Default value for the form control.\r\n * @returns {Function} - The mixin class.\r\n */\r\nexport function UmbFormControlMixin<\r\n\tValueType = FormData | FormDataEntryValue,\r\n\tT extends HTMLElementConstructor<LitElement> = HTMLElementConstructor<LitElement>,\r\n\tDefaultValueType = undefined,\r\n>(superClass: T, defaultValue?: DefaultValueType) {\r\n\tabstract class UmbFormControlMixinClass extends superClass {\r\n\t\t/**\r\n\t\t * This is a static class field indicating that the element is can be used inside a native form and participate in its events.\r\n\t\t * It may require a polyfill, check support here https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/attachInternals.\r\n\t\t * Read more about form controls here https://web.dev/more-capable-form-controls/\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tstatic readonly formAssociated = true;\r\n\r\n\t\t/**\r\n\t\t * Value of this form control.\r\n\t\t * @type {string}\r\n\t\t * @attr value\r\n\t\t * @default\r\n\t\t */\r\n\t\t@property({ reflect: false }) // Do not 'reflect' as the attribute value is used as fallback. [NL]\r\n\t\tget value(): ValueType | DefaultValueType {\r\n\t\t\t// For some reason we need to keep this as setters and getters for inherited classes for work properly when they override these methods. [NL]\r\n\t\t\treturn this.#value;\r\n\t\t}\r\n\t\tset value(newValue: ValueType | DefaultValueType) {\r\n\t\t\tthis.#value = newValue;\r\n\t\t}\r\n\r\n\t\t// Validation\r\n\t\t//private _validityState = new UmbValidityState();\r\n\t\t#validity: any = {};\r\n\r\n\t\t/**\r\n\t\t * Determines wether the form control has been touched or interacted with, this determines wether the validation-status of this form control should be made visible.\r\n\t\t * @type {boolean}\r\n\t\t * @attr\r\n\t\t * @default\r\n\t\t */\r\n\t\t@property({ type: Boolean, reflect: true })\r\n\t\tpublic set pristine(value: boolean) {\r\n\t\t\tif (this._pristine !== value) {\r\n\t\t\t\tthis._pristine = value;\r\n\t\t\t\tthis._runValidators();\r\n\t\t\t}\r\n\t\t}\r\n\t\tpublic get pristine(): boolean {\r\n\t\t\treturn this._pristine;\r\n\t\t}\r\n\t\tprivate _pristine: boolean = true;\r\n\r\n\t\t#value: ValueType | DefaultValueType = defaultValue as unknown as DefaultValueType;\r\n\t\tprotected _internals: ElementInternals;\r\n\t\t#form: HTMLFormElement | null = null;\r\n\t\t#validators: UmbFormControlValidatorConfig[] = [];\r\n\t\t#formCtrlElements: UmbNativeFormControlElement[] = [];\r\n\r\n\t\tconstructor(...args: any[]) {\r\n\t\t\tsuper(...args);\r\n\t\t\tthis._internals = this.attachInternals();\r\n\r\n\t\t\tthis.addEventListener('blur', () => {\r\n\t\t\t\t/*if (e.composedPath().some((x) => x === this)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}*/\r\n\t\t\t\tthis.checkValidity();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Get internal form element.\r\n\t\t * This has to be implemented to provide a FormControl Element of choice for the given context. The element is used as anchor for validation-messages.\r\n\t\t * @function getFormElement\r\n\t\t * @returns {HTMLElement | undefined | null} - Returns the form element or undefined if not found.\r\n\t\t */\r\n\t\tprotected getFormElement(): HTMLElement | undefined | null {\r\n\t\t\treturn this.#formCtrlElements.find((el) => el.validity.valid === false);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Focus first element that is invalid.\r\n\t\t * @function focusFirstInvalidElement\r\n\t\t * @returns {HTMLElement | undefined} - Returns the first invalid element or undefined if no invalid elements are found.\r\n\t\t */\r\n\t\tfocusFirstInvalidElement() {\r\n\t\t\tconst firstInvalid = this.#formCtrlElements.find((el) => el.validity.valid === false);\r\n\t\t\tif (firstInvalid) {\r\n\t\t\t\tif ('focusFirstInvalidElement' in firstInvalid) {\r\n\t\t\t\t\t(firstInvalid as any).focusFirstInvalidElement();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfirstInvalid.focus();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.focus();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\toverride disconnectedCallback(): void {\r\n\t\t\tsuper.disconnectedCallback();\r\n\t\t\tthis.#removeFormListeners();\r\n\t\t}\r\n\t\t#removeFormListeners() {\r\n\t\t\tif (this.#form) {\r\n\t\t\t\tthis.#form.removeEventListener('submit', this.#onFormSubmit);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Add validation, to validate this Form Control.\r\n\t\t * See https://developer.mozilla.org/en-US/docs/Web/API/ValidityState for available Validator FlagTypes.\r\n\t\t * @example\r\n\t\t * this.addValidator(\r\n\t\t *  'tooLong',\r\n\t\t *  () => 'This input contains too many characters',\r\n\t\t *  () => this._value.length > 10\r\n\t\t * );\r\n\t\t * @function addValidator\r\n\t\t * @param {FlagTypes} flagKey the type of validation.\r\n\t\t * @param {method} getMessageMethod method to retrieve relevant message. Is executed every time the validator is re-executed.\r\n\t\t * @param {method} checkMethod method to determine if this validator should invalidate this form control. Return true if this should prevent submission.\r\n\t\t * @returns {UmbFormControlValidatorConfig} - The added validator configuration.\r\n\t\t */\r\n\t\taddValidator(\r\n\t\t\tflagKey: FlagTypes,\r\n\t\t\tgetMessageMethod: () => string,\r\n\t\t\tcheckMethod: () => boolean,\r\n\t\t): UmbFormControlValidatorConfig {\r\n\t\t\tconst validator = {\r\n\t\t\t\tflagKey: flagKey,\r\n\t\t\t\tgetMessageMethod: getMessageMethod,\r\n\t\t\t\tcheckMethod: checkMethod,\r\n\t\t\t\tweight: WeightedErrorFlagTypes.indexOf(flagKey),\r\n\t\t\t} satisfies UmbFormControlValidatorConfig;\r\n\t\t\tthis.#validators.push(validator);\r\n\t\t\t// Sort validators based on the WeightedErrorFlagTypes order. [NL]\r\n\t\t\tthis.#validators.sort((a, b) => (a.weight > b.weight ? 1 : b.weight > a.weight ? -1 : 0));\r\n\t\t\treturn validator;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Remove validation from this form control.\r\n\t\t * @function removeValidator\r\n\t\t * @param {UmbFormControlValidatorConfig} validator - The specific validation configuration to remove.\r\n\t\t */\r\n\t\tremoveValidator(validator: UmbFormControlValidatorConfig) {\r\n\t\t\tconst index = this.#validators.indexOf(validator);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tthis.#validators.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t#runValidatorsCallback = () => this._runValidators;\r\n\r\n\t\t/**\r\n\t\t * @function addFormControlElement\r\n\t\t * @description Important notice if adding a native form control then ensure that its value and thereby validity is updated when value is changed from the outside.\r\n\t\t * @param {UmbNativeFormControlElement} element - element to validate and include as part of this form control association.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tprotected addFormControlElement(element: UmbNativeFormControlElement) {\r\n\t\t\tif (!element) {\r\n\t\t\t\tthrow new Error('Element is null or undefined');\r\n\t\t\t}\r\n\t\t\tif (!element.validity) {\r\n\t\t\t\tconsole.log(element);\r\n\t\t\t\tthrow new Error('Element is not a Form Control');\r\n\t\t\t}\r\n\t\t\tif (this.#formCtrlElements.includes(element)) return;\r\n\t\t\tthis.#formCtrlElements.push(element);\r\n\t\t\telement.addEventListener(UmbValidationInvalidEvent.TYPE, this.#runValidatorsCallback);\r\n\t\t\telement.addEventListener(UmbValidationValidEvent.TYPE, this.#runValidatorsCallback);\r\n\t\t\t// If we are in validationMode/'touched'/not-pristine then we need to validate this newly added control. [NL]\r\n\t\t\tif (this._pristine === false) {\r\n\t\t\t\telement.checkValidity();\r\n\t\t\t\t// I think we could just execute validators for the new control, but now lets just run al of it again. [NL]\r\n\t\t\t\tthis._runValidators();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @function removeFormControlElement\r\n\t\t * @param {UmbNativeFormControlElement} element - element to remove as part of this form controls associated controls.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tprotected removeFormControlElement(element: UmbNativeFormControlElement) {\r\n\t\t\tconst index = this.#formCtrlElements.indexOf(element);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tthis.#formCtrlElements.splice(index, 1);\r\n\t\t\t\telement.removeEventListener(UmbValidationInvalidEvent.TYPE, this.#runValidatorsCallback);\r\n\t\t\t\telement.removeEventListener(UmbValidationValidEvent.TYPE, this.#runValidatorsCallback);\r\n\t\t\t\tif (this._pristine === false) {\r\n\t\t\t\t\tthis._runValidators();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate _customValidityObject?: UmbFormControlValidatorConfig;\r\n\r\n\t\t/**\r\n\t\t * @function setCustomValidity\r\n\t\t * @description Set custom validity state, set to empty string to remove the custom message.\r\n\t\t * @param {string} message - The message to be shown\r\n\t\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLObjectElement/setCustomValidity|HTMLObjectElement:setCustomValidity}\r\n\t\t */\r\n\t\tprotected setCustomValidity(message: string | null) {\r\n\t\t\tif (this._customValidityObject) {\r\n\t\t\t\tthis.removeValidator(this._customValidityObject);\r\n\t\t\t}\r\n\r\n\t\t\tif (message != null && message !== '') {\r\n\t\t\t\tthis._customValidityObject = this.addValidator(\r\n\t\t\t\t\t'customError',\r\n\t\t\t\t\t(): string => message,\r\n\t\t\t\t\t() => true,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tthis._runValidators();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @function _runValidators\r\n\t\t * @description Run all validators and set the validityState of this form control.\r\n\t\t * Run this method when you want to re-run all validators.\r\n\t\t * This can be relevant if you have a validators that is using values that is not triggering the Lit Updated Callback.\r\n\t\t * Such are mainly properties that are not declared as a Lit state and or Lit property.\r\n\t\t */\r\n\t\tprotected _runValidators() {\r\n\t\t\tthis.#validity = {};\r\n\t\t\tlet message: string | undefined = undefined;\r\n\t\t\tlet innerFormControlEl: UmbNativeFormControlElement | undefined = undefined;\r\n\r\n\t\t\t// Loop through custom validators, currently its intentional to have them overwritten native validity. but might need to be reconsidered (This current way enables to overwrite with custom messages) [NL]\r\n\t\t\tthis.#validators.some((validator) => {\r\n\t\t\t\tif (validator.checkMethod()) {\r\n\t\t\t\t\tthis.#validity[validator.flagKey] = true;\r\n\t\t\t\t\tmessage = validator.getMessageMethod();\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\r\n\t\t\tif (!message) {\r\n\t\t\t\t// Loop through inner native form controls to adapt their validityState. [NL]\r\n\t\t\t\tthis.#formCtrlElements.some((formCtrlEl) => {\r\n\t\t\t\t\tlet key: keyof ValidityState;\r\n\t\t\t\t\tfor (key in formCtrlEl.validity) {\r\n\t\t\t\t\t\tif (key !== 'valid' && formCtrlEl.validity[key]) {\r\n\t\t\t\t\t\t\tthis.#validity[key] = true;\r\n\t\t\t\t\t\t\t//messages.add(formCtrlEl.validationMessage);\r\n\t\t\t\t\t\t\tmessage = formCtrlEl.validationMessage;\r\n\t\t\t\t\t\t\tinnerFormControlEl ??= formCtrlEl;\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst hasError = Object.values(this.#validity).includes(true);\r\n\r\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/API/ValidityState#valid\r\n\t\t\tthis.#validity.valid = !hasError;\r\n\r\n\t\t\t// Transfer the new validityState to the ElementInternals. [NL]\r\n\t\t\tthis._internals.setValidity(this.#validity, message, innerFormControlEl ?? this.getFormElement() ?? undefined);\r\n\r\n\t\t\tthis.#dispatchValidationState();\r\n\t\t}\r\n\r\n\t\t#dispatchValidationState() {\r\n\t\t\t// Do not fire validation events unless we are not pristine/'untouched'/not-in-validation-mode. [NL]\r\n\t\t\tif (this._pristine === true) return;\r\n\t\t\tif (this.#validity.valid) {\r\n\t\t\t\tthis.dispatchEvent(new UmbValidationValidEvent());\r\n\t\t\t} else {\r\n\t\t\t\tthis.dispatchEvent(new UmbValidationInvalidEvent());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\toverride updated(changedProperties: Map<string | number | symbol, unknown>) {\r\n\t\t\tsuper.updated(changedProperties);\r\n\t\t\tthis._runValidators();\r\n\t\t}\r\n\r\n\t\t#onFormSubmit = () => {\r\n\t\t\tthis.pristine = false;\r\n\t\t};\r\n\r\n\t\tpublic formAssociatedCallback() {\r\n\t\t\tthis.#removeFormListeners();\r\n\t\t\tthis.#form = this._internals.form;\r\n\t\t\tif (this.#form) {\r\n\t\t\t\t// This relies on the form begin a 'uui-form': [NL]\r\n\t\t\t\tif (this.#form.hasAttribute('submit-invalid')) {\r\n\t\t\t\t\tthis.pristine = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.#form.addEventListener('submit', this.#onFormSubmit);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpublic formResetCallback() {\r\n\t\t\tthis.pristine = true;\r\n\t\t\tthis.value = this.getInitialValue() ?? this.getDefaultValue();\r\n\t\t}\r\n\r\n\t\tprotected getDefaultValue(): DefaultValueType {\r\n\t\t\treturn defaultValue as DefaultValueType;\r\n\t\t}\r\n\t\tprotected getInitialValue(): ValueType | DefaultValueType {\r\n\t\t\treturn this.getAttribute('value') as ValueType | DefaultValueType;\r\n\t\t}\r\n\r\n\t\tpublic checkValidity() {\r\n\t\t\tthis.pristine = false;\r\n\t\t\tthis._runValidators();\r\n\r\n\t\t\tfor (const key in this.#formCtrlElements) {\r\n\t\t\t\tif (this.#formCtrlElements[key].checkValidity() === false) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this._internals?.checkValidity();\r\n\t\t}\r\n\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/HTMLObjectElement/validity\r\n\t\tpublic get validity(): ValidityState {\r\n\t\t\treturn this.#validity;\r\n\t\t}\r\n\r\n\t\tget validationMessage() {\r\n\t\t\treturn this._internals?.validationMessage;\r\n\t\t}\r\n\t}\r\n\treturn UmbFormControlMixinClass as unknown as HTMLElementConstructor<\r\n\t\tUmbFormControlMixinElement<ValueType | DefaultValueType>\r\n\t> &\r\n\t\tT;\r\n}\r\n"],"names":["UmbValidationEvent","type","UmbValidationInvalidEvent","UmbValidationValidEvent","WeightedErrorFlagTypes","UmbFormControlMixin","superClass","defaultValue","UmbFormControlMixinClass","args","#validity","#value","#form","#validators","#formCtrlElements","#runValidatorsCallback","#onFormSubmit","newValue","value","el","firstInvalid","#removeFormListeners","flagKey","getMessageMethod","checkMethod","validator","b","index","element","message","innerFormControlEl","formCtrlEl","key","hasError","#dispatchValidationState","changedProperties","__decorateClass","property"],"mappings":"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"}