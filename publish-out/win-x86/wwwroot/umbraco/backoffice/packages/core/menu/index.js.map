{"version":3,"file":"index.js","sources":["../../../../src/packages/core/menu/menu-structure-workspace-context.context-token.ts","../../../../src/packages/core/menu/menu-tree-structure-workspace-context-base.ts","../../../../src/packages/core/menu/menu-variant-structure-workspace-context.context-token.ts","../../../../src/packages/core/menu/menu-variant-tree-structure-workspace-context-base.ts"],"sourcesContent":["import type { UmbMenuStructureWorkspaceContext } from './menu-structure-workspace-context.interface.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MENU_STRUCTURE_WORKSPACE_CONTEXT = new UmbContextToken<UmbMenuStructureWorkspaceContext>(\r\n\t'UmbWorkspaceContext',\r\n\t'UmbMenuStructure',\r\n);\r\n","import type { ManifestWorkspaceContextMenuStructureKind, UmbStructureItemModel } from './types.js';\r\nimport { UMB_MENU_STRUCTURE_WORKSPACE_CONTEXT } from './menu-structure-workspace-context.context-token.js';\r\nimport { UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT } from './section-sidebar-menu/index.js';\r\nimport type { UmbTreeRepository, UmbTreeItemModel, UmbTreeRootModel } from '@umbraco-cms/backoffice/tree';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbArrayState, UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbAncestorsEntityContext, UmbParentEntityContext, type UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport { linkEntityExpansionEntries } from '@umbraco-cms/backoffice/utils';\r\nimport { UMB_MODAL_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\n\r\ninterface UmbMenuTreeStructureWorkspaceContextBaseArgs {\r\n\ttreeRepositoryAlias: string;\r\n}\r\n\r\n// TODO: introduce base class for all menu structure workspaces to handle ancestors and parent\r\nexport abstract class UmbMenuTreeStructureWorkspaceContextBase extends UmbContextBase {\r\n\tmanifest?: ManifestWorkspaceContextMenuStructureKind;\r\n\r\n\t#workspaceContext?: typeof UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT.TYPE;\r\n\t#args: UmbMenuTreeStructureWorkspaceContextBaseArgs;\r\n\r\n\t#structure = new UmbArrayState<UmbStructureItemModel>([], (x) => x.unique);\r\n\tpublic readonly structure = this.#structure.asObservable();\r\n\r\n\t#parent = new UmbObjectState<UmbStructureItemModel | undefined>(undefined);\r\n\t/**\r\n\t * @deprecated Will be removed in v.18: Use UMB_PARENT_ENTITY_CONTEXT instead.\r\n\t */\r\n\tpublic readonly parent = this.#parent.asObservable();\r\n\r\n\t#parentContext = new UmbParentEntityContext(this);\r\n\t#ancestorContext = new UmbAncestorsEntityContext(this);\r\n\t#sectionSidebarMenuContext?: typeof UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT.TYPE;\r\n\t#isModalContext: boolean = false;\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbMenuTreeStructureWorkspaceContextBaseArgs) {\r\n\t\tsuper(host, UMB_MENU_STRUCTURE_WORKSPACE_CONTEXT);\r\n\t\t// 'UmbMenuStructureWorkspaceContext' is Obsolete, will be removed in v.18\r\n\t\tthis.provideContext('UmbMenuStructureWorkspaceContext', this);\r\n\t\tthis.#args = args;\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_CONTEXT, (modalContext) => {\r\n\t\t\tthis.#isModalContext = modalContext !== undefined;\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT, (instance) => {\r\n\t\t\tthis.#sectionSidebarMenuContext = instance;\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT, (instance) => {\r\n\t\t\tthis.#workspaceContext = instance;\r\n\t\t\tthis.observe(this.#workspaceContext?.unique, (value) => {\r\n\t\t\t\tif (!value) return;\r\n\t\t\t\tthis.#requestStructure();\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#workspaceContext?.isNew, (value) => {\r\n\t\t\t\tif (value === undefined) return;\r\n\t\t\t\tthis.#requestStructure();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestStructure() {\r\n\t\tconst isNew = this.#workspaceContext?.getIsNew();\r\n\t\tconst uniqueObservable = isNew\r\n\t\t\t? this.#workspaceContext?._internal_createUnderParentEntityUnique\r\n\t\t\t: this.#workspaceContext?.unique;\r\n\t\tconst entityTypeObservable = isNew\r\n\t\t\t? this.#workspaceContext?._internal_createUnderParentEntityType\r\n\t\t\t: this.#workspaceContext?.entityType;\r\n\r\n\t\tlet structureItems: Array<UmbStructureItemModel> = [];\r\n\r\n\t\tconst unique = (await this.observe(uniqueObservable, () => {})?.asPromise()) as string;\r\n\t\tif (unique === undefined) throw new Error('Unique is not available');\r\n\r\n\t\tconst entityType = (await this.observe(entityTypeObservable, () => {})?.asPromise()) as string;\r\n\t\tif (!entityType) throw new Error('Entity type is not available');\r\n\r\n\t\tconst treeRepository = await createExtensionApiByAlias<UmbTreeRepository<UmbTreeItemModel, UmbTreeRootModel>>(\r\n\t\t\tthis,\r\n\t\t\tthis.#args.treeRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tconst { data: root } = await treeRepository.requestTreeRoot();\r\n\r\n\t\tif (root) {\r\n\t\t\tstructureItems = [\r\n\t\t\t\t{\r\n\t\t\t\t\tunique: root.unique,\r\n\t\t\t\t\tentityType: root.entityType,\r\n\t\t\t\t\tname: root.name,\r\n\t\t\t\t\tisFolder: root.isFolder,\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\tconst isRoot = entityType === root?.entityType;\r\n\r\n\t\t// If the entity type is different from the root entity type, then we can request the ancestors.\r\n\t\tif (!isRoot) {\r\n\t\t\tconst { data } = await treeRepository.requestTreeItemAncestors({ treeItem: { unique, entityType } });\r\n\r\n\t\t\tif (data) {\r\n\t\t\t\tconst ancestorItems = data.map((treeItem) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tunique: treeItem.unique,\r\n\t\t\t\t\t\tentityType: treeItem.entityType,\r\n\t\t\t\t\t\tname: treeItem.name,\r\n\t\t\t\t\t\tisFolder: treeItem.isFolder,\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.#setAncestorData(data);\r\n\r\n\t\t\t\tstructureItems.push(...ancestorItems);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.#structure.setValue(structureItems);\r\n\t\tthis.#setParentData(structureItems);\r\n\r\n\t\tconst menuItemAlias = this.manifest?.meta?.menuItemAlias;\r\n\t\tif (menuItemAlias && !this.#isModalContext) {\r\n\t\t\tthis.#expandSectionSidebarMenu(structureItems, menuItemAlias);\r\n\t\t}\r\n\t}\r\n\r\n\t#setParentData(structureItems: Array<UmbStructureItemModel>) {\r\n\t\t/* If the item is not new, the current item is the last item in the array.\r\n\t\t\tWe filter out the current item unique to handle any case where it could show up */\r\n\t\tconst parent = structureItems.filter((item) => item.unique !== this.#workspaceContext?.getUnique()).pop();\r\n\r\n\t\t// TODO: remove this when the parent gets removed from the structure interface\r\n\t\tthis.#parent.setValue(parent);\r\n\r\n\t\tconst parentEntity = parent\r\n\t\t\t? {\r\n\t\t\t\t\tunique: parent.unique,\r\n\t\t\t\t\tentityType: parent.entityType,\r\n\t\t\t\t}\r\n\t\t\t: undefined;\r\n\r\n\t\tthis.#parentContext.setParent(parentEntity);\r\n\t}\r\n\r\n\t/* Notice: ancestors are based on the server \"data\" ancestors and are not based on the full Menu (UI) structure.\r\n\t\tThis will mean that any item placed in the data root will not have any ancestors. But will have a parent based on the UI structure.\r\n\t*/\r\n\t#setAncestorData(ancestors: Array<UmbTreeItemModel>) {\r\n\t\tconst ancestorEntities = ancestors\r\n\t\t\t.map((treeItem) => {\r\n\t\t\t\tconst entity: UmbEntityModel = {\r\n\t\t\t\t\tunique: treeItem.unique,\r\n\t\t\t\t\tentityType: treeItem.entityType,\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn entity;\r\n\t\t\t})\r\n\t\t\t/* If the item is not new, the current item is the last item in the array.\r\n\t\t\t\tWe filter out the current item unique to handle any case where it could show up */\r\n\t\t\t.filter((item) => item.unique !== this.#workspaceContext?.getUnique());\r\n\r\n\t\tthis.#ancestorContext.setAncestors(ancestorEntities);\r\n\t}\r\n\r\n\t#expandSectionSidebarMenu(structureItems: Array<UmbStructureItemModel>, menuItemAlias: string) {\r\n\t\tconst linkedEntries = linkEntityExpansionEntries(structureItems);\r\n\t\t// Filter out the current entity as we don't want to expand it\r\n\t\tconst expandableItems = linkedEntries.filter((item) => item.unique !== this.#workspaceContext?.getUnique());\r\n\t\tconst expandableItemsWithMenuItem = expandableItems.map((item) => {\r\n\t\t\treturn {\r\n\t\t\t\t...item,\r\n\t\t\t\tmenuItemAlias,\r\n\t\t\t};\r\n\t\t});\r\n\t\tthis.#sectionSidebarMenuContext?.expansion.expandItems(expandableItemsWithMenuItem);\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis.#structure.destroy();\r\n\t\tthis.#parent.destroy();\r\n\t\tthis.#parentContext.destroy();\r\n\t\tthis.#ancestorContext.destroy();\r\n\t}\r\n}\r\n","import type { UmbMenuVariantStructureWorkspaceContext } from './menu-variant-structure-workspace-context.interface.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MENU_VARIANT_STRUCTURE_WORKSPACE_CONTEXT =\r\n\tnew UmbContextToken<UmbMenuVariantStructureWorkspaceContext>(\r\n\t\t'UmbWorkspaceContext',\r\n\t\t'UmbMenuStructure',\r\n\t\t(context): context is UmbMenuVariantStructureWorkspaceContext =>\r\n\t\t\t'IS_MENU_VARIANT_STRUCTURE_WORKSPACE_CONTEXT' in context,\r\n\t);\r\n","import type { ManifestWorkspaceContextMenuStructureKind, UmbVariantStructureItemModel } from './types.js';\r\nimport { UMB_MENU_VARIANT_STRUCTURE_WORKSPACE_CONTEXT } from './menu-variant-structure-workspace-context.context-token.js';\r\nimport { UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT } from './section-sidebar-menu/section-context/section-sidebar-menu.section-context.token.js';\r\nimport type { UmbTreeItemModel, UmbTreeRepository, UmbTreeRootModel } from '@umbraco-cms/backoffice/tree';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbArrayState, UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbAncestorsEntityContext, UmbParentEntityContext, type UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport { UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { linkEntityExpansionEntries } from '@umbraco-cms/backoffice/utils';\r\nimport { UMB_MODAL_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\n\r\ninterface UmbMenuVariantTreeStructureWorkspaceContextBaseArgs {\r\n\ttreeRepositoryAlias: string;\r\n}\r\n\r\n// TODO: introduce base class for all menu structure workspaces to handle ancestors and parent\r\nexport abstract class UmbMenuVariantTreeStructureWorkspaceContextBase extends UmbContextBase {\r\n\tmanifest?: ManifestWorkspaceContextMenuStructureKind;\r\n\r\n\t#workspaceContext?: typeof UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT.TYPE;\r\n\t#args: UmbMenuVariantTreeStructureWorkspaceContextBaseArgs;\r\n\r\n\t#structure = new UmbArrayState<UmbVariantStructureItemModel>([], (x) => x.unique);\r\n\tpublic readonly structure = this.#structure.asObservable();\r\n\r\n\t#parent = new UmbObjectState<UmbVariantStructureItemModel | undefined>(undefined);\r\n\t/**\r\n\t * @deprecated Will be removed in v.18: Use UMB_PARENT_ENTITY_CONTEXT instead.\r\n\t */\r\n\tpublic readonly parent = this.#parent.asObservable();\r\n\r\n\t#parentContext = new UmbParentEntityContext(this);\r\n\t#ancestorContext = new UmbAncestorsEntityContext(this);\r\n\t#sectionSidebarMenuContext?: typeof UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT.TYPE;\r\n\t#isModalContext: boolean = false;\r\n\r\n\tpublic readonly IS_MENU_VARIANT_STRUCTURE_WORKSPACE_CONTEXT = true;\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbMenuVariantTreeStructureWorkspaceContextBaseArgs) {\r\n\t\tsuper(host, UMB_MENU_VARIANT_STRUCTURE_WORKSPACE_CONTEXT);\r\n\t\t// 'UmbMenuStructureWorkspaceContext' is Obsolete, will be removed in v.18\r\n\t\tthis.provideContext('UmbMenuStructureWorkspaceContext', this);\r\n\t\tthis.#args = args;\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_CONTEXT, (modalContext) => {\r\n\t\t\tthis.#isModalContext = modalContext !== undefined;\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT, (instance) => {\r\n\t\t\tthis.#sectionSidebarMenuContext = instance;\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT, (instance) => {\r\n\t\t\tthis.#workspaceContext = instance;\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#workspaceContext?.unique,\r\n\t\t\t\t(value) => {\r\n\t\t\t\t\tif (!value) return;\r\n\t\t\t\t\tthis.#requestStructure();\r\n\t\t\t\t},\r\n\t\t\t\t'observeUnique',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestStructure() {\r\n\t\tconst isNew = this.#workspaceContext?.getIsNew();\r\n\t\tconst uniqueObservable = isNew\r\n\t\t\t? this.#workspaceContext?._internal_createUnderParentEntityUnique\r\n\t\t\t: this.#workspaceContext?.unique;\r\n\t\tconst entityTypeObservable = isNew\r\n\t\t\t? this.#workspaceContext?._internal_createUnderParentEntityType\r\n\t\t\t: this.#workspaceContext?.entityType;\r\n\r\n\t\tlet structureItems: Array<UmbVariantStructureItemModel> = [];\r\n\r\n\t\tconst unique = (await this.observe(uniqueObservable, () => {})?.asPromise()) as string;\r\n\t\tif (unique === undefined) throw new Error('Unique is not available');\r\n\r\n\t\tconst entityType = (await this.observe(entityTypeObservable, () => {})?.asPromise()) as string;\r\n\t\tif (!entityType) throw new Error('Entity type is not available');\r\n\r\n\t\t// TODO: introduce variant tree item model\r\n\t\tconst treeRepository = await createExtensionApiByAlias<UmbTreeRepository<any, UmbTreeRootModel>>(\r\n\t\t\tthis,\r\n\t\t\tthis.#args.treeRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tconst { data: root } = await treeRepository.requestTreeRoot();\r\n\r\n\t\tif (root) {\r\n\t\t\tstructureItems = [\r\n\t\t\t\t{\r\n\t\t\t\t\tunique: root.unique,\r\n\t\t\t\t\tentityType: root.entityType,\r\n\t\t\t\t\tvariants: [{ name: root.name, culture: null, segment: null }],\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\tconst { data } = await treeRepository.requestTreeItemAncestors({ treeItem: { unique, entityType } });\r\n\r\n\t\tif (data) {\r\n\t\t\tconst treeItemAncestors = data.map((treeItem) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tunique: treeItem.unique,\r\n\t\t\t\t\tentityType: treeItem.entityType,\r\n\t\t\t\t\tvariants: treeItem.variants.map((variant: any) => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tname: variant.name,\r\n\t\t\t\t\t\t\tculture: variant.culture,\r\n\t\t\t\t\t\t\tsegment: variant.segment,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tstructureItems.push(...treeItemAncestors);\r\n\r\n\t\t\tthis.#structure.setValue(structureItems);\r\n\t\t\tthis.#setParentData(structureItems);\r\n\t\t\tthis.#setAncestorData(data);\r\n\r\n\t\t\tconst menuItemAlias = this.manifest?.meta?.menuItemAlias;\r\n\t\t\tif (menuItemAlias && !this.#isModalContext) {\r\n\t\t\t\tthis.#expandSectionSidebarMenu(structureItems, menuItemAlias);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#setParentData(structureItems: Array<UmbVariantStructureItemModel>) {\r\n\t\t/* If the item is not new, the current item is the last item in the array.\r\n\t\t\tWe filter out the current item unique to handle any case where it could show up */\r\n\t\tconst parent = structureItems.filter((item) => item.unique !== this.#workspaceContext?.getUnique()).pop();\r\n\r\n\t\t// TODO: remove this when the parent gets removed from the structure interface\r\n\t\tthis.#parent.setValue(parent);\r\n\r\n\t\tconst parentEntity = parent\r\n\t\t\t? {\r\n\t\t\t\t\tunique: parent.unique,\r\n\t\t\t\t\tentityType: parent.entityType,\r\n\t\t\t\t}\r\n\t\t\t: undefined;\r\n\r\n\t\tthis.#parentContext.setParent(parentEntity);\r\n\t}\r\n\r\n\t/* Notice: ancestors are based on the server \"data\" ancestors and are not based on the full Menu (UI) structure.\r\n\t\tThis will mean that any item placed in the data root will not have any ancestors. But will have a parent based on the UI structure.\r\n\t*/\r\n\t#setAncestorData(ancestors: Array<UmbTreeItemModel>) {\r\n\t\tconst ancestorEntities = ancestors\r\n\t\t\t.map((treeItem) => {\r\n\t\t\t\tconst entity: UmbEntityModel = {\r\n\t\t\t\t\tunique: treeItem.unique,\r\n\t\t\t\t\tentityType: treeItem.entityType,\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn entity;\r\n\t\t\t})\r\n\t\t\t/* If the item is not new, the current item is the last item in the array.\r\n\t\t\tWe filter out the current item unique to handle any case where it could show up */\r\n\t\t\t.filter((item) => item.unique !== this.#workspaceContext?.getUnique());\r\n\r\n\t\tthis.#ancestorContext.setAncestors(ancestorEntities);\r\n\t}\r\n\r\n\t#expandSectionSidebarMenu(structureItems: Array<UmbVariantStructureItemModel>, menuItemAlias: string) {\r\n\t\tconst linkedEntries = linkEntityExpansionEntries(structureItems);\r\n\t\t// Filter out the current entity as we don't want to expand it\r\n\t\tconst expandableItems = linkedEntries.filter((item) => item.unique !== this.#workspaceContext?.getUnique());\r\n\t\tconst expandableItemsWithMenuItem = expandableItems.map((item) => {\r\n\t\t\treturn {\r\n\t\t\t\t...item,\r\n\t\t\t\tmenuItemAlias,\r\n\t\t\t};\r\n\t\t});\r\n\t\tthis.#sectionSidebarMenuContext?.expansion.expandItems(expandableItemsWithMenuItem);\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis.#structure.destroy();\r\n\t\tthis.#parent.destroy();\r\n\t\tthis.#parentContext.destroy();\r\n\t\tthis.#ancestorContext.destroy();\r\n\t}\r\n}\r\n"],"names":["UMB_MENU_STRUCTURE_WORKSPACE_CONTEXT","UmbContextToken","UmbMenuTreeStructureWorkspaceContextBase","UmbContextBase","host","args","#structure","UmbArrayState","x","#parent","UmbObjectState","#parentContext","UmbParentEntityContext","#ancestorContext","UmbAncestorsEntityContext","#isModalContext","#args","UMB_MODAL_CONTEXT","modalContext","UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT","instance","#sectionSidebarMenuContext","UMB_SUBMITTABLE_TREE_ENTITY_WORKSPACE_CONTEXT","#workspaceContext","value","#requestStructure","isNew","uniqueObservable","entityTypeObservable","structureItems","unique","entityType","treeRepository","createExtensionApiByAlias","root","data","ancestorItems","treeItem","#setAncestorData","#setParentData","menuItemAlias","#expandSectionSidebarMenu","parent","item","parentEntity","ancestors","ancestorEntities","expandableItemsWithMenuItem","linkEntityExpansionEntries","UMB_MENU_VARIANT_STRUCTURE_WORKSPACE_CONTEXT","context","UmbMenuVariantTreeStructureWorkspaceContextBase","treeItemAncestors","variant"],"mappings":"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"}