{"version":3,"file":"modal-manager.context-B1sl36Ce.js","sources":["../../../src/packages/core/modal/context/modal.context-token.ts","../../../src/packages/core/modal/component/modal.element.ts","../../../src/packages/core/modal/context/modal.context.ts","../../../src/packages/core/modal/context/modal-manager.context.ts"],"sourcesContent":["import type { UmbModalContext } from './modal.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MODAL_CONTEXT = new UmbContextToken<UmbModalContext>('UmbModalContext');\r\n","import type { UmbModalContext } from '../context/modal.context.js';\r\nimport { UMB_MODAL_CONTEXT } from '../context/modal.context-token.js';\r\nimport type { ManifestModal } from '../extensions/types.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { CSSResultGroup } from '@umbraco-cms/backoffice/external/lit';\r\nimport { html, customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbBasicState, type UmbObserverController } from '@umbraco-cms/backoffice/observable-api';\r\nimport {\r\n\tUUIModalCloseEvent,\r\n\ttype UUIModalElement,\r\n\ttype UUIDialogElement,\r\n\ttype UUIModalDialogElement,\r\n\ttype UUIModalSidebarElement,\r\n\ttype UUIModalSidebarSize,\r\n} from '@umbraco-cms/backoffice/external/uui';\r\nimport { UMB_ROUTE_CONTEXT, type UmbRouterSlotElement } from '@umbraco-cms/backoffice/router';\r\nimport { createExtensionElement, loadManifestElement } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbContextBoundary, UmbContextProvider } from '@umbraco-cms/backoffice/context-api';\r\nimport { UmbContextProxyController } from '@umbraco-cms/backoffice/context-proxy';\r\n\r\n@customElement('umb-modal')\r\nexport class UmbModalElement extends UmbLitElement {\r\n\t#modalContext?: UmbModalContext;\r\n\r\n\tpublic element?: UUIModalDialogElement | UUIModalSidebarElement | UUIModalElement;\r\n\r\n\t#innerElement = new UmbBasicState<HTMLElement | undefined>(undefined);\r\n\r\n\t#modalExtensionObserver?: UmbObserverController<ManifestModal | undefined>;\r\n\t#modalRouterElement?: HTMLDivElement | UmbRouterSlotElement;\r\n\r\n\t#onClose = (e: Event) => {\r\n\t\tif (this.#modalContext?.isResolved() === false) {\r\n\t\t\t// If not resolved, and has a router, then we do not want to close, but instead let the router try to change the path for that to eventually trigger another round of close.\r\n\t\t\tif (this.#modalContext?.router) {\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis.#modalContext._internal_removeCurrentModal();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.element?.removeEventListener(UUIModalCloseEvent, this.#onClose);\r\n\t\tthis.#modalContext?.reject({ type: 'close' });\r\n\t};\r\n\r\n\tasync init(modalContext: UmbModalContext | undefined) {\r\n\t\tif (this.#modalContext === modalContext) return;\r\n\t\tthis.#modalContext = modalContext;\r\n\r\n\t\tif (!this.#modalContext) {\r\n\t\t\tthis.destroy();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#modalContext.addEventListener('umb:destroy', this.#onContextDestroy);\r\n\t\tthis.#modalContext.view.provideAt(this);\r\n\t\tthis.element = await this.#createContainerElement();\r\n\r\n\t\t// Makes sure that the modal triggers the reject of the context promise when it is closed by pressing escape.\r\n\t\tthis.element.addEventListener(UUIModalCloseEvent, this.#onClose);\r\n\r\n\t\tnew UmbContextProxyController(this, this.element, () =>\r\n\t\t\tthis.#modalContext?.getHostElement(),\r\n\t\t).setIgnoreContextAliases([UMB_MODAL_CONTEXT.contextAlias]);\r\n\r\n\t\tthis.#modalContext.onSubmit().then(\r\n\t\t\t() => {\r\n\t\t\t\tthis.element?.close();\r\n\t\t\t},\r\n\t\t\t() => {\r\n\t\t\t\tthis.element?.close();\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\t/**\r\n\t\t *\r\n\t\t * Maybe we could just get a Modal Router Slot. But it needs to have the ability to actually inject via slot. so the modal inner element can be within.\r\n\t\t *\r\n\t\t */\r\n\t\tif (this.#modalContext.router) {\r\n\t\t\tthis.#modalRouterElement = document.createElement('umb-router-slot');\r\n\t\t\tthis.#modalRouterElement.routes = [\r\n\t\t\t\t{\r\n\t\t\t\t\tunique: '_umbEmptyRoute_',\r\n\t\t\t\t\tpath: '',\r\n\t\t\t\t\tcomponent: document.createElement('slot'),\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t\tthis.#modalRouterElement.parent = this.#modalContext.router;\r\n\t\t} else {\r\n\t\t\tthis.#modalRouterElement = document.createElement('div');\r\n\t\t\t// Notice inline styling here is used cause the element is not appended into this elements shadowDom but outside and there by gets into the element via a slot.\r\n\t\t\tthis.#modalRouterElement.style.display = 'contents';\r\n\t\t\tnew UmbContextBoundary(this.#modalRouterElement, UMB_ROUTE_CONTEXT).hostConnected();\r\n\t\t}\r\n\r\n\t\tthis.element.appendChild(this.#modalRouterElement);\r\n\r\n\t\tthis.#observeModal(this.#modalContext.alias.toString());\r\n\r\n\t\tconst provider = new UmbContextProvider(this.element, UMB_MODAL_CONTEXT, this.#modalContext);\r\n\t\tprovider.hostConnected();\r\n\t}\r\n\r\n\tasync #createContainerElement() {\r\n\t\tif (this.#modalContext!.type == 'custom' && this.#modalContext?.element) {\r\n\t\t\tconst customWrapperElementCtor = await loadManifestElement(this.#modalContext.element);\r\n\t\t\treturn new customWrapperElementCtor!();\r\n\t\t}\r\n\r\n\t\treturn this.#modalContext!.type === 'sidebar' ? this.#createSidebarElement() : this.#createDialogElement();\r\n\t}\r\n\r\n\t#createSidebarElement() {\r\n\t\tconst sidebarElement = document.createElement('uui-modal-sidebar');\r\n\t\tthis.observe(\r\n\t\t\tthis.#modalContext!.size,\r\n\t\t\t(size) => {\r\n\t\t\t\tsidebarElement.size = size as UUIModalSidebarSize;\r\n\t\t\t},\r\n\t\t\t'observeSize',\r\n\t\t);\r\n\t\treturn sidebarElement;\r\n\t}\r\n\r\n\t#createDialogElement() {\r\n\t\tconst modalDialogElement = document.createElement('uui-modal-dialog');\r\n\t\tconst dialogElement: UUIDialogElement = document.createElement('uui-dialog');\r\n\t\tmodalDialogElement.appendChild(dialogElement);\r\n\t\treturn modalDialogElement;\r\n\t}\r\n\r\n\t#observeModal(alias: string) {\r\n\t\tthis.#modalExtensionObserver?.destroy();\r\n\r\n\t\tthis.observe(umbExtensionsRegistry.byTypeAndAlias('modal', alias), async (manifest) => {\r\n\t\t\tthis.#removeInnerElement();\r\n\r\n\t\t\tif (manifest) {\r\n\t\t\t\tconst innerElement = await this.#createInnerElement(manifest);\r\n\t\t\t\tif (innerElement) {\r\n\t\t\t\t\tthis.#appendInnerElement(innerElement);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tasync #createInnerElement(manifest: ManifestModal) {\r\n\t\t// TODO: add inner fallback element if no extension element is found\r\n\t\tconst innerElement = await createExtensionElement(manifest);\r\n\r\n\t\tif (!this.#modalContext) {\r\n\t\t\t// If context does not exist any more, it means we have been destroyed. So we need to back out:\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tif (innerElement) {\r\n\t\t\tinnerElement.manifest = manifest;\r\n\t\t\tinnerElement.data = this.#modalContext.data;\r\n\t\t\tinnerElement.modalContext = this.#modalContext;\r\n\t\t}\r\n\r\n\t\treturn innerElement;\r\n\t}\r\n\r\n\t#appendInnerElement(element: HTMLElement) {\r\n\t\tthis.#modalRouterElement!.appendChild(element);\r\n\t\tthis.#innerElement.setValue(element);\r\n\t}\r\n\r\n\t#removeInnerElement() {\r\n\t\tconst innerElement = this.#innerElement.getValue();\r\n\t\tif (innerElement) {\r\n\t\t\tthis.#modalRouterElement!.removeChild(innerElement);\r\n\t\t\tthis.#innerElement.setValue(undefined);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.element}`;\r\n\t}\r\n\r\n\toverride disconnectedCallback(): void {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tthis.destroy();\r\n\t}\r\n\r\n\t#onContextDestroy = () => {\r\n\t\tthis.destroy();\r\n\t};\r\n\r\n\toverride destroy() {\r\n\t\tthis.#innerElement.destroy();\r\n\t\tthis.#modalExtensionObserver?.destroy();\r\n\t\tthis.#modalExtensionObserver = undefined;\r\n\t\tif (this.#modalContext) {\r\n\t\t\tthis.#modalContext.removeEventListener('umb:destroy', this.#onContextDestroy);\r\n\t\t\tthis.#modalContext.destroy();\r\n\t\t\tthis.#modalContext = undefined;\r\n\t\t}\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tstatic override styles: CSSResultGroup = [UmbTextStyles];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-modal': UmbModalElement;\r\n\t}\r\n}\r\n","import { UmbModalToken } from '../token/modal-token.js';\r\nimport type { UmbModalConfig, UmbModalType } from '../types.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UUIModalElement, UUIModalSidebarSize } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { umbDeepMerge } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport { UmbObjectState, UmbStringState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbViewController } from '@umbraco-cms/backoffice/view';\r\nimport { UMB_ROUTE_CONTEXT } from '@umbraco-cms/backoffice/router';\r\nimport type { ElementLoaderProperty } from '@umbraco-cms/backoffice/extension-api';\r\nimport type { IRouterSlot } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbDeepPartialObject } from '@umbraco-cms/backoffice/utils';\r\n\r\nexport interface UmbModalRejectReason {\r\n\ttype: string;\r\n}\r\n\r\nexport type UmbModalContextClassArgs<\r\n\tModalAliasType extends string | UmbModalToken,\r\n\tModalAliasTypeAsToken extends UmbModalToken = ModalAliasType extends UmbModalToken\r\n\t\t? ModalAliasType\r\n\t\t: UmbModalToken<never, never>,\r\n> = {\r\n\trouter?: IRouterSlot | null;\r\n\tdata?: ModalAliasTypeAsToken['DATA'];\r\n\tvalue?: ModalAliasTypeAsToken['VALUE'];\r\n\tmodal?: UmbModalConfig;\r\n};\r\n\r\n// TODO: consider splitting this into two separate handlers\r\nexport class UmbModalContext<\r\n\tModalData extends { [key: string]: any } = { [key: string]: any },\r\n\tModalValue = any,\r\n> extends UmbControllerBase {\r\n\t//\r\n\t// TODO: Come up with a better name:\r\n\t#submitIsGood?: boolean;\r\n\t#submitRejectReason?: UmbModalRejectReason;\r\n\t#submitIsResolved?: boolean;\r\n\r\n\t#submitPromise: Promise<ModalValue>;\r\n\t#submitResolver?: (value: ModalValue) => void;\r\n\t#submitRejecter?: (reason?: UmbModalRejectReason) => void;\r\n\t#markAsResolved() {\r\n\t\tthis.#submitResolver = undefined;\r\n\t\tthis.#submitRejecter = undefined;\r\n\t\tthis.#submitIsResolved = true;\r\n\t}\r\n\r\n\tpublic readonly key: string;\r\n\tpublic readonly data: ModalData;\r\n\tpublic readonly type: UmbModalType = 'dialog';\r\n\tpublic readonly element?: ElementLoaderProperty<UUIModalElement>;\r\n\tpublic readonly backdropBackground?: string;\r\n\tpublic readonly router: IRouterSlot | null = null;\r\n\tpublic readonly alias: string | UmbModalToken<ModalData, ModalValue>;\r\n\r\n\t#value;\r\n\tpublic readonly value;\r\n\r\n\t#size = new UmbStringState<UUIModalSidebarSize>('small');\r\n\tpublic readonly size = this.#size.asObservable();\r\n\r\n\tpublic readonly view;\r\n\r\n\tconstructor(\r\n\t\thost: UmbControllerHost,\r\n\t\tmodalAlias: string | UmbModalToken<ModalData, ModalValue>,\r\n\t\targs: UmbModalContextClassArgs<UmbModalToken>,\r\n\t) {\r\n\t\tsuper(host);\r\n\t\tthis.key = args.modal?.key || UmbId.new();\r\n\t\tthis.router = args.router ?? null;\r\n\t\tthis.alias = modalAlias;\r\n\r\n\t\tthis.view = new UmbViewController(this, modalAlias.toString());\r\n\r\n\t\tlet title: string | undefined = undefined;\r\n\t\tlet size = 'small';\r\n\r\n\t\tif (this.alias instanceof UmbModalToken) {\r\n\t\t\tthis.type = this.alias.getDefaultModal()?.type || this.type;\r\n\t\t\tsize = this.alias.getDefaultModal()?.size ?? size;\r\n\t\t\tthis.element = this.alias.getDefaultModal()?.element || this.element;\r\n\t\t\tthis.backdropBackground = this.alias.getDefaultModal()?.backdropBackground || this.backdropBackground;\r\n\t\t\ttitle = this.alias.getDefaultModal()?.title ?? undefined;\r\n\t\t}\r\n\r\n\t\tthis.view.setTitle(title);\r\n\r\n\t\tthis.type = args.modal?.type || this.type;\r\n\t\tsize = args.modal?.size ?? size;\r\n\t\tthis.element = args.modal?.element || this.element;\r\n\t\tthis.backdropBackground = args.modal?.backdropBackground || this.backdropBackground;\r\n\r\n\t\tthis.#size.setValue(size);\r\n\r\n\t\tconst defaultData = this.alias instanceof UmbModalToken ? this.alias.getDefaultData() : undefined;\r\n\t\tthis.data = Object.freeze(\r\n\t\t\t// If we have both data and defaultData perform a deep merge\r\n\t\t\targs.data && defaultData\r\n\t\t\t\t? (umbDeepMerge(args.data as UmbDeepPartialObject<ModalData>, defaultData) as ModalData)\r\n\t\t\t\t: // otherwise pick one of them:\r\n\t\t\t\t\t((args.data as ModalData) ?? defaultData),\r\n\t\t);\r\n\r\n\t\tconst initValue =\r\n\t\t\targs.value ?? (this.alias instanceof UmbModalToken ? (this.alias as UmbModalToken).getDefaultValue() : undefined);\r\n\r\n\t\tthis.#value = new UmbObjectState(initValue) as UmbObjectState<ModalValue>;\r\n\t\tthis.value = this.#value.asObservable();\r\n\r\n\t\t// TODO: Consider if its right to use Promises, or use another event based system? Would we need to be able to cancel an event, to then prevent the closing..?\r\n\t\tthis.#submitPromise = new Promise((resolve, reject) => {\r\n\t\t\tthis.#submitResolver = resolve;\r\n\t\t\tthis.#submitRejecter = reject;\r\n\t\t});\r\n\t}\r\n\r\n\t#activeModalPath?: string;\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_internal_setCurrentModalPath(path: string) {\r\n\t\tthis.#activeModalPath = path;\r\n\t}\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tasync _internal_removeCurrentModal() {\r\n\t\tconst routeContext = await this.getContext(UMB_ROUTE_CONTEXT);\r\n\t\trouteContext?._internal_removeModalPath(this.#activeModalPath);\r\n\t}\r\n\r\n\tforceResolve() {\r\n\t\t// THIS should close the element no matter what.\r\n\t\tif (this.#submitIsGood) {\r\n\t\t\tconst resolver = this.#submitResolver;\r\n\t\t\tthis.#markAsResolved();\r\n\t\t\tresolver?.(this.getValue());\r\n\t\t} else {\r\n\t\t\t// We might store the reason from reject and use it here?, but I'm not sure what the real need is for this reason. [NL]\r\n\t\t\tconst resolver = this.#submitRejecter;\r\n\t\t\tthis.#markAsResolved();\r\n\t\t\tresolver?.(this.#submitRejectReason ?? { type: 'close' });\r\n\t\t}\r\n\t}\r\n\r\n\tisResolved() {\r\n\t\treturn this.#submitIsResolved === true;\r\n\t}\r\n\r\n\t// note, this methods is private  argument is not defined correctly here, but requires to be fix by appending the OptionalSubmitArgumentIfUndefined type when newing up this class.\r\n\t/**\r\n\t * Submits this modal, returning with a value to the initiator of the modal.\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tpublic submit() {\r\n\t\tif (this.#submitIsResolved) return;\r\n\t\tif (this.router) {\r\n\t\t\t// Do not resolve jet, lets try to change the URL.\r\n\t\t\tthis.#submitIsGood = true;\r\n\t\t\tthis._internal_removeCurrentModal();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst resolver = this.#submitResolver;\r\n\t\tthis.#markAsResolved();\r\n\t\tresolver?.(this.getValue());\r\n\t\t// TODO: Could we clean up this class here? (Example destroy the value state, and other things?)\r\n\t}\r\n\r\n\t/**\r\n\t * Closes this modal\r\n\t * @param reason\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tpublic reject(reason?: UmbModalRejectReason) {\r\n\t\tif (this.#submitIsResolved) return;\r\n\t\tif (this.router) {\r\n\t\t\t// Do not reject jet, lets try to change the URL.\r\n\t\t\tthis.#submitIsGood = false;\r\n\t\t\tthis.#submitRejectReason = reason;\r\n\t\t\tthis._internal_removeCurrentModal();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst resolver = this.#submitRejecter;\r\n\t\tthis.#markAsResolved();\r\n\t\tresolver?.(reason);\r\n\t\t// TODO: Could we clean up this class here? (Example destroy the value state, and other things?)\r\n\t}\r\n\r\n\t/**\r\n\t * Gives a Promise which will be resolved when this modal is submitted.\r\n\t * @returns {Promise<ModalValue>}\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tpublic async onSubmit() {\r\n\t\treturn await this.#submitPromise;\r\n\t}\r\n\r\n\t/**\r\n\t * Gives the current value of this modal.\r\n\t * @returns {ModalValue}\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tpublic getValue() {\r\n\t\treturn this.#value.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the current value of this modal.\r\n\t * @param value\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tpublic setValue(value: ModalValue) {\r\n\t\tthis.#value.setValue(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the current value of this modal.\r\n\t * @param partialValue\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tpublic updateValue(partialValue: Partial<ModalValue>) {\r\n\t\tthis.#value.update(partialValue);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the size this modal.\r\n\t * @param size\r\n\t * @public\r\n\t * @memberof UmbModalContext\r\n\t */\r\n\tsetModalSize(size: UUIModalSidebarSize) {\r\n\t\tthis.#size.setValue(size);\r\n\t}\r\n\r\n\tpublic override destroy(): void {\r\n\t\tthis.dispatchEvent(new CustomEvent('umb:destroy'));\r\n\t\tthis.#value.destroy();\r\n\t\t(this as any).router = null;\r\n\t\t(this as any).data = undefined;\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","import type { UmbModalToken } from '../token/modal-token.js';\r\nimport { UmbModalContext } from './modal.context.js';\r\nimport type { UmbModalContextClassArgs } from './modal.context.js';\r\nimport { UmbBasicState, appendToFrozenArray } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbModalManagerContext extends UmbContextBase {\r\n\t// TODO: Investigate if we can get rid of HTML elements in our store, so we can use one of our states.\r\n\t#modals = new UmbBasicState(<Array<UmbModalContext>>[]);\r\n\tpublic readonly modals = this.#modals.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_MODAL_MANAGER_CONTEXT);\r\n\r\n\t\twindow.addEventListener('navigationsuccess', this.#onNavigationSuccess);\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a modal or sidebar modal\r\n\t * @public\r\n\t * @param {UmbControllerHost} host - The host that the modal should be attached to, this is usually the controller/element that is opening the modal. This additionally acts as the modal origin for the context api.\r\n\t * @param {(string | UmbModalToken)} modalAlias - The alias or token of the modal to open\r\n\t * @param {UmbModalContextClassArgs} args - The arguments for this setup.\r\n\t * @returns {*}  {UmbModalHandler}\r\n\t * @memberof UmbModalManagerContext\r\n\t */\r\n\tpublic open<\r\n\t\tModalData extends { [key: string]: any } = { [key: string]: any },\r\n\t\tModalValue = unknown,\r\n\t\tModalAliasTypeAsToken extends UmbModalToken = UmbModalToken<ModalData, ModalValue>,\r\n\t>(\r\n\t\thost: UmbControllerHost,\r\n\t\tmodalAlias: UmbModalToken<ModalData, ModalValue> | string,\r\n\t\targs: UmbModalContextClassArgs<ModalAliasTypeAsToken> = {},\r\n\t) {\r\n\t\tconst modalContext = new UmbModalContext(host, modalAlias, args);\r\n\r\n\t\t// Append to store:\r\n\t\tthis.#modals.setValue(\r\n\t\t\tappendToFrozenArray(this.#modals.value, modalContext, (entry) => entry.key === modalContext.key),\r\n\t\t);\r\n\r\n\t\t// Return to implementor:\r\n\t\treturn modalContext;\r\n\t}\r\n\r\n\t/**\r\n\t * Closes a modal or sidebar modal\r\n\t * @private\r\n\t * @param {string} key - The key of the modal to close\r\n\t * @memberof UmbModalManagerContext\r\n\t */\r\n\tpublic close(key: string) {\r\n\t\tconst modal = this.#modals.getValue().find((modal) => modal.key === key);\r\n\t\tif (modal) {\r\n\t\t\tmodal.forceResolve();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic remove(key: string) {\r\n\t\tthis.#modals.setValue(this.#modals.getValue().filter((modal) => modal.key !== key));\r\n\t}\r\n\r\n\t/**\r\n\t * Closes all modals that is not routable\r\n\t * @private\r\n\t * @memberof UmbModalManagerContext\r\n\t */\r\n\t#closeNoneRoutableModals() {\r\n\t\tthis.#modals\r\n\t\t\t.getValue()\r\n\t\t\t.filter((modal) => modal.router === null)\r\n\t\t\t.forEach((modal) => {\r\n\t\t\t\tmodal.forceResolve();\r\n\t\t\t});\r\n\t}\r\n\r\n\t#onNavigationSuccess = () => {\r\n\t\tthis.#closeNoneRoutableModals();\r\n\t};\r\n\r\n\toverride destroy() {\r\n\t\tsuper.destroy();\r\n\t\tthis.#modals.destroy();\r\n\t\twindow.removeEventListener('navigationsuccess', this.#onNavigationSuccess);\r\n\t}\r\n}\r\n\r\nexport const UMB_MODAL_MANAGER_CONTEXT = new UmbContextToken<UmbModalManagerContext, UmbModalManagerContext>(\r\n\t'UmbModalManagerContext',\r\n);\r\n"],"names":["UMB_MODAL_CONTEXT","UmbContextToken","_modalContext","_innerElement","_modalExtensionObserver","_modalRouterElement","_onClose","_UmbModalElement_instances","createContainerElement_fn","createSidebarElement_fn","createDialogElement_fn","observeModal_fn","createInnerElement_fn","appendInnerElement_fn","removeInnerElement_fn","_onContextDestroy","UmbModalElement","UmbLitElement","__privateAdd","UmbBasicState","__privateGet","UUIModalCloseEvent","modalContext","__privateSet","__privateMethod","UmbContextProxyController","UmbContextBoundary","UMB_ROUTE_CONTEXT","UmbContextProvider","html","customWrapperElementCtor","loadManifestElement","sidebarElement","size","modalDialogElement","dialogElement","alias","umbExtensionsRegistry","manifest","innerElement","createExtensionElement","element","UmbTextStyles","__decorateClass","customElement","UmbModalContext","UmbControllerBase","host","modalAlias","args","#size","UmbStringState","UmbId","UmbViewController","title","UmbModalToken","defaultData","umbDeepMerge","initValue","#value","UmbObjectState","#submitPromise","resolve","reject","#submitResolver","#submitRejecter","#submitIsGood","#submitRejectReason","#submitIsResolved","#markAsResolved","#activeModalPath","path","resolver","reason","value","partialValue","UmbModalManagerContext","UmbContextBase","UMB_MODAL_MANAGER_CONTEXT","#modals","#onNavigationSuccess","#closeNoneRoutableModals","appendToFrozenArray","entry","key","modal"],"mappings":"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"}