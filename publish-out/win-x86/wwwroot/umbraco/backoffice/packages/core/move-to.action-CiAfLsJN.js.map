{"version":3,"file":"move-to.action-CiAfLsJN.js","sources":["../../../src/packages/core/tree/entity-actions/move/move-to.action.ts"],"sourcesContent":["import { UMB_TREE_PICKER_MODAL } from '../../tree-picker-modal/index.js';\r\nimport type { UmbMoveRepository } from './move-repository.interface.js';\r\nimport type { MetaEntityActionMoveToKind } from './types.js';\r\nimport { UmbEntityActionBase, UmbRequestReloadStructureForEntityEvent } from '@umbraco-cms/backoffice/entity-action';\r\nimport { umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\n\r\nexport class UmbMoveToEntityAction extends UmbEntityActionBase<MetaEntityActionMoveToKind> {\r\n\toverride async execute() {\r\n\t\tif (!this.args.unique) throw new Error('Unique is not available');\r\n\t\tif (!this.args.entityType) throw new Error('Entity Type is not available');\r\n\r\n\t\tconst value = await umbOpenModal(this, UMB_TREE_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\ttreeAlias: this.args.meta.treeAlias,\r\n\t\t\t\tfoldersOnly: this.args.meta.foldersOnly,\r\n\t\t\t\texpandTreeRoot: true,\r\n\t\t\t\tpickableFilter: (treeItem) => treeItem.unique !== this.args.unique,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst destinationUnique = value.selection[0];\r\n\t\tif (destinationUnique === undefined) throw new Error('Destination Unique is not available');\r\n\r\n\t\tconst moveRepository = await createExtensionApiByAlias<UmbMoveRepository>(this, this.args.meta.moveRepositoryAlias);\r\n\t\tif (!moveRepository) throw new Error('Move Repository is not available');\r\n\r\n\t\tconst { error } = await moveRepository.requestMoveTo({\r\n\t\t\tunique: this.args.unique,\r\n\t\t\tdestination: { unique: destinationUnique },\r\n\t\t});\r\n\r\n\t\tif (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\r\n\t\tthis.#reloadMenu();\r\n\t}\r\n\r\n\tasync #reloadMenu() {\r\n\t\tconst actionEventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\t\tif (!actionEventContext) throw new Error('Action Event Context is not available');\r\n\t\tconst event = new UmbRequestReloadStructureForEntityEvent({\r\n\t\t\tunique: this.args.unique,\r\n\t\t\tentityType: this.args.entityType,\r\n\t\t});\r\n\r\n\t\tactionEventContext.dispatchEvent(event);\r\n\r\n\t\t// TODO: Reload destination\r\n\t}\r\n}\r\n\r\nexport default UmbMoveToEntityAction;\r\n"],"names":["UmbMoveToEntityAction","UmbEntityActionBase","destinationUnique","umbOpenModal","UMB_TREE_PICKER_MODAL","treeItem","moveRepository","createExtensionApiByAlias","error","#reloadMenu","actionEventContext","UMB_ACTION_EVENT_CONTEXT","event","UmbRequestReloadStructureForEntityEvent"],"mappings":";;;;;AAQO,MAAMA,UAA8BC,EAAgD;AAAA,EAC1F,MAAe,UAAU;AACxB,QAAI,CAAC,KAAK,KAAK,OAAQ,OAAM,IAAI,MAAM,yBAAyB;AAChE,QAAI,CAAC,KAAK,KAAK,WAAY,OAAM,IAAI,MAAM,8BAA8B;AAWzE,UAAMC,KATQ,MAAMC,EAAa,MAAMC,GAAuB;AAAA,MAC7D,MAAM;AAAA,QACL,WAAW,KAAK,KAAK,KAAK;AAAA,QAC1B,aAAa,KAAK,KAAK,KAAK;AAAA,QAC5B,gBAAgB;AAAA,QAChB,gBAAgB,CAACC,MAAaA,EAAS,WAAW,KAAK,KAAK;AAAA,MAAA;AAAA,IAC7D,CACA,GAE+B,UAAU,CAAC;AAC3C,QAAIH,MAAsB,OAAW,OAAM,IAAI,MAAM,qCAAqC;AAE1F,UAAMI,IAAiB,MAAMC,EAA6C,MAAM,KAAK,KAAK,KAAK,mBAAmB;AAClH,QAAI,CAACD,EAAgB,OAAM,IAAI,MAAM,kCAAkC;AAEvE,UAAM,EAAE,OAAAE,EAAA,IAAU,MAAMF,EAAe,cAAc;AAAA,MACpD,QAAQ,KAAK,KAAK;AAAA,MAClB,aAAa,EAAE,QAAQJ,EAAA;AAAA,IAAkB,CACzC;AAED,QAAIM;AACH,YAAMA;AAGP,SAAKC,GAAA;AAAA,EACN;AAAA,EAEA,MAAMA,KAAc;AACnB,UAAMC,IAAqB,MAAM,KAAK,WAAWC,CAAwB;AACzE,QAAI,CAACD,EAAoB,OAAM,IAAI,MAAM,uCAAuC;AAChF,UAAME,IAAQ,IAAIC,EAAwC;AAAA,MACzD,QAAQ,KAAK,KAAK;AAAA,MAClB,YAAY,KAAK,KAAK;AAAA,IAAA,CACtB;AAED,IAAAH,EAAmB,cAAcE,CAAK;AAAA,EAGvC;AACD;"}