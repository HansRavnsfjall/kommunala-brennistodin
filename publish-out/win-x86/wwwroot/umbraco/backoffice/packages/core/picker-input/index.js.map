{"version":3,"file":"index.js","sources":["../../../../src/packages/core/picker-input/picker-input.context-token.ts","../../../../src/packages/core/picker-input/picker-input.context.ts"],"sourcesContent":["import type { UmbPickerInputContext } from './picker-input.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_PICKER_INPUT_CONTEXT = new UmbContextToken<UmbPickerInputContext>('UmbPickerInputContext');\r\n","import { UMB_PICKER_INPUT_CONTEXT } from './picker-input.context-token.js';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbDeprecation } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbInteractionMemoryManager } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport { UmbRepositoryItemsManager } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\nimport {\r\n\tumbConfirmModal,\r\n\tumbOpenModal,\r\n\ttype UmbModalToken,\r\n\ttype UmbPickerModalData,\r\n\ttype UmbPickerModalValue,\r\n} from '@umbraco-cms/backoffice/modal';\r\n\r\ntype PickerItemBaseType = { name: string; unique: string };\r\nexport class UmbPickerInputContext<\r\n\tPickedItemType extends PickerItemBaseType = PickerItemBaseType,\r\n\tPickerItemType extends PickerItemBaseType = PickedItemType,\r\n\tPickerModalConfigType extends UmbPickerModalData<PickerItemType> = UmbPickerModalData<PickerItemType>,\r\n\tPickerModalValueType extends UmbPickerModalValue = UmbPickerModalValue,\r\n> extends UmbContextBase {\r\n\tmodalAlias: string | UmbModalToken<UmbPickerModalData<PickerItemType>, PickerModalValueType>;\r\n\trepository?: UmbItemRepository<PickedItemType>;\r\n\t#getUnique: (entry: PickedItemType) => string | undefined;\r\n\r\n\t#itemManager;\r\n\r\n\tpublic readonly selection;\r\n\tpublic readonly selectedItems;\r\n\tpublic readonly statuses;\r\n\tpublic readonly interactionMemory = new UmbInteractionMemoryManager(this);\r\n\r\n\t/**\r\n\t * Define a minimum amount of selected items in this input, for this input to be valid.\r\n\t */\r\n\tpublic get max() {\r\n\t\treturn this._max;\r\n\t}\r\n\tpublic set max(value) {\r\n\t\tthis._max = value === undefined ? Infinity : value;\r\n\t}\r\n\tprivate _max = Infinity;\r\n\r\n\t/**\r\n\t * Define a maximum amount of selected items in this input, for this input to be valid.\r\n\t */\r\n\tpublic get min() {\r\n\t\treturn this._min;\r\n\t}\r\n\tpublic set min(value) {\r\n\t\tthis._min = value === undefined ? 0 : value;\r\n\t}\r\n\tprivate _min = 0;\r\n\r\n\t/**\r\n\t * Creates an instance of UmbPickerInputContext.\r\n\t * @param {UmbControllerHost} host - The host for the controller.\r\n\t * @param {string} repositoryAlias - The alias of the repository to use.\r\n\t * @param {(string | UmbModalToken<UmbPickerModalData<PickerItemType>, PickerModalValueType>)} modalAlias - The alias of the modal to use.\r\n\t * @param {((entry: PickedItemType) => string | undefined)} [getUniqueMethod] - DEPRECATED since 15.3. Will be removed in v. 17: A method to get the unique key from the item.\r\n\t * @memberof UmbPickerInputContext\r\n\t */\r\n\tconstructor(\r\n\t\thost: UmbControllerHost,\r\n\t\trepositoryAlias: string,\r\n\t\tmodalAlias: string | UmbModalToken<UmbPickerModalData<PickerItemType>, PickerModalValueType>,\r\n\t\tgetUniqueMethod?: (entry: PickedItemType) => string | undefined,\r\n\t) {\r\n\t\tsuper(host, UMB_PICKER_INPUT_CONTEXT);\r\n\t\tthis.modalAlias = modalAlias;\r\n\r\n\t\tthis.#getUnique = getUniqueMethod\r\n\t\t\t? (entry: PickedItemType) => {\r\n\t\t\t\t\tnew UmbDeprecation({\r\n\t\t\t\t\t\tdeprecated: 'The getUniqueMethod parameter.',\r\n\t\t\t\t\t\tremoveInVersion: '17.0.0',\r\n\t\t\t\t\t\tsolution: 'The required unique property on the item will be used instead.',\r\n\t\t\t\t\t}).warn();\r\n\t\t\t\t\treturn getUniqueMethod(entry);\r\n\t\t\t\t}\r\n\t\t\t: (entry) => entry.unique;\r\n\r\n\t\tthis.#itemManager = new UmbRepositoryItemsManager<PickedItemType>(this, repositoryAlias, getUniqueMethod);\r\n\r\n\t\tthis.selection = this.#itemManager.uniques;\r\n\t\tthis.statuses = this.#itemManager.statuses;\r\n\t\tthis.selectedItems = this.#itemManager.items;\r\n\t}\r\n\r\n\tgetSelection() {\r\n\t\treturn this.#itemManager.getUniques();\r\n\t}\r\n\r\n\tsetSelection(selection: Array<string | null>) {\r\n\t\t// Note: Currently we do not support picking root item. So we filter out null values:\r\n\t\tthis.#itemManager.setUniques(selection.filter((value) => value !== null) as Array<string>);\r\n\t}\r\n\r\n\tasync openPicker(pickerData?: Partial<PickerModalConfigType>) {\r\n\t\tawait this.#itemManager.init;\r\n\t\tconst modalValue = await umbOpenModal(this, this.modalAlias, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: this._max === 1 ? false : true,\r\n\t\t\t\t...pickerData,\r\n\t\t\t},\r\n\t\t\tvalue: {\r\n\t\t\t\tselection: this.getSelection(),\r\n\t\t\t} as PickerModalValueType,\r\n\t\t}).catch(() => undefined);\r\n\r\n\t\tif (!modalValue) return;\r\n\r\n\t\tthis.setSelection(modalValue.selection);\r\n\t\tthis.getHostElement().dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync requestRemoveItem(unique: string) {\r\n\t\tconst item = this.#itemManager.getItems().find((item) => this.#getUnique(item) === unique);\r\n\r\n\t\tconst name = item?.name ?? '#general_notFound';\r\n\t\tawait umbConfirmModal(this, {\r\n\t\t\tcolor: 'danger',\r\n\t\t\theadline: `#actions_remove ${name}?`,\r\n\t\t\tcontent: `#defaultdialogs_confirmremove ${name}?`,\r\n\t\t\tconfirmLabel: '#actions_remove',\r\n\t\t});\r\n\r\n\t\tthis.#removeItem(unique);\r\n\t}\r\n\r\n\t#removeItem(unique: string) {\r\n\t\tconst newSelection = this.getSelection().filter((value) => value !== unique);\r\n\t\tthis.setSelection(newSelection);\r\n\t\tthis.getHostElement().dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n}\r\n"],"names":["UMB_PICKER_INPUT_CONTEXT","UmbContextToken","UmbPickerInputContext","UmbContextBase","host","repositoryAlias","modalAlias","getUniqueMethod","UmbInteractionMemoryManager","#getUnique","entry","UmbDeprecation","#itemManager","UmbRepositoryItemsManager","value","selection","pickerData","modalValue","umbOpenModal","UmbChangeEvent","unique","name","item","umbConfirmModal","#removeItem","newSelection"],"mappings":";;;;;;;AAGO,MAAMA,IAA2B,IAAIC,EAAuC,uBAAuB;ACcnG,MAAMC,UAKHC,EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA0CxB,YACCC,GACAC,GACAC,GACAC,GACC;AACD,UAAMH,GAAMJ,CAAwB,GAtCrC,KAAgB,oBAAoB,IAAIQ,EAA4B,IAAI,GAWxE,KAAQ,OAAO,OAWf,KAAQ,OAAO,GAiBd,KAAK,aAAaF,GAElB,KAAKG,KAAaF,IACf,CAACG,OACD,IAAIC,EAAe;AAAA,MAClB,YAAY;AAAA,MACZ,iBAAiB;AAAA,MACjB,UAAU;AAAA,IAAA,CACV,EAAE,KAAA,GACIJ,EAAgBG,CAAK,KAE5B,CAACA,MAAUA,EAAM,QAEpB,KAAKE,KAAe,IAAIC,EAA0C,MAAMR,GAAiBE,CAAe,GAExG,KAAK,YAAY,KAAKK,GAAa,SACnC,KAAK,WAAW,KAAKA,GAAa,UAClC,KAAK,gBAAgB,KAAKA,GAAa;AAAA,EACxC;AAAA,EAhEAH;AAAA,EAEAG;AAAA;AAAA;AAAA;AAAA,EAUA,IAAW,MAAM;AAChB,WAAO,KAAK;AAAA,EACb;AAAA,EACA,IAAW,IAAIE,GAAO;AACrB,SAAK,OAAOA,MAAU,SAAY,QAAWA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAMA,IAAW,MAAM;AAChB,WAAO,KAAK;AAAA,EACb;AAAA,EACA,IAAW,IAAIA,GAAO;AACrB,SAAK,OAAOA,MAAU,SAAY,IAAIA;AAAA,EACvC;AAAA,EAsCA,eAAe;AACd,WAAO,KAAKF,GAAa,WAAA;AAAA,EAC1B;AAAA,EAEA,aAAaG,GAAiC;AAE7C,SAAKH,GAAa,WAAWG,EAAU,OAAO,CAACD,MAAUA,MAAU,IAAI,CAAkB;AAAA,EAC1F;AAAA,EAEA,MAAM,WAAWE,GAA6C;AAC7D,UAAM,KAAKJ,GAAa;AACxB,UAAMK,IAAa,MAAMC,EAAa,MAAM,KAAK,YAAY;AAAA,MAC5D,MAAM;AAAA,QACL,UAAU,KAAK,SAAS;AAAA,QACxB,GAAGF;AAAA,MAAA;AAAA,MAEJ,OAAO;AAAA,QACN,WAAW,KAAK,aAAA;AAAA,MAAa;AAAA,IAC9B,CACA,EAAE,MAAM,MAAA;AAAA,KAAe;AAExB,IAAKC,MAEL,KAAK,aAAaA,EAAW,SAAS,GACtC,KAAK,eAAA,EAAiB,cAAc,IAAIE,GAAgB;AAAA,EACzD;AAAA,EAEA,MAAM,kBAAkBC,GAAgB;AAGvC,UAAMC,IAFO,KAAKT,GAAa,SAAA,EAAW,KAAK,CAACU,MAAS,KAAKb,GAAWa,CAAI,MAAMF,CAAM,GAEtE,QAAQ;AAC3B,UAAMG,EAAgB,MAAM;AAAA,MAC3B,OAAO;AAAA,MACP,UAAU,mBAAmBF,CAAI;AAAA,MACjC,SAAS,iCAAiCA,CAAI;AAAA,MAC9C,cAAc;AAAA,IAAA,CACd,GAED,KAAKG,GAAYJ,CAAM;AAAA,EACxB;AAAA,EAEAI,GAAYJ,GAAgB;AAC3B,UAAMK,IAAe,KAAK,aAAA,EAAe,OAAO,CAACX,MAAUA,MAAUM,CAAM;AAC3E,SAAK,aAAaK,CAAY,GAC9B,KAAK,eAAA,EAAiB,cAAc,IAAIN,GAAgB;AAAA,EACzD;AACD;"}