{"version":3,"file":"index.js","sources":["../../../../src/packages/core/picker/modal/picker-modal-base.element.ts","../../../../src/packages/core/picker/search/manager/picker-search.manager.ts","../../../../src/packages/core/picker/picker.context.ts","../../../../src/packages/core/picker/search/picker-search-field.element.ts","../../../../src/packages/core/picker/search/picker-search-result.element.ts"],"sourcesContent":["import type { UmbPickerContext } from '../picker.context.js';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbInteractionMemoryModel } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport type { ManifestModal, UmbPickerModalData } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_PICKER_INPUT_CONTEXT } from '@umbraco-cms/backoffice/picker-input';\r\n\r\nexport abstract class UmbPickerModalBaseElement<\r\n\tItemType = UmbEntityModel,\r\n\tModalDataType extends UmbPickerModalData<ItemType> = UmbPickerModalData<ItemType>,\r\n\tModalValueType = unknown,\r\n\tModalManifestType extends ManifestModal = ManifestModal,\r\n> extends UmbModalBaseElement<ModalDataType, ModalValueType, ModalManifestType> {\r\n\tprotected abstract _pickerContext: UmbPickerContext;\r\n\r\n\t#pickerInputContext?: typeof UMB_PICKER_INPUT_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_PICKER_INPUT_CONTEXT, (pickerInputContext) => {\r\n\t\t\tthis.#pickerInputContext = pickerInputContext;\r\n\t\t\tthis.#observeMemoriesFromInputContext();\r\n\t\t});\r\n\t}\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#observeMemoriesFromPicker();\r\n\t}\r\n\r\n\t#observeMemoriesFromPicker() {\r\n\t\tthis.observe(this._pickerContext.interactionMemory.memories, (memories) => {\r\n\t\t\tthis.#setMemoriesOnInputContext(memories);\r\n\t\t});\r\n\t}\r\n\r\n\t#getInteractionMemoryUnique() {\r\n\t\t// TODO: consider appending with a unique when we have that implemented.\r\n\t\treturn `UmbPickerModal`;\r\n\t}\r\n\r\n\t#observeMemoriesFromInputContext() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#pickerInputContext?.interactionMemory.memory(this.#getInteractionMemoryUnique()),\r\n\t\t\t(memory) => {\r\n\t\t\t\tmemory?.memories?.forEach((memory) => this._pickerContext.interactionMemory.setMemory(memory));\r\n\t\t\t},\r\n\t\t\t'umbModalInteractionMemoryObserver',\r\n\t\t);\r\n\t}\r\n\r\n\t#setMemoriesOnInputContext(pickerMemories: Array<UmbInteractionMemoryModel>) {\r\n\t\tif (pickerMemories?.length > 0) {\r\n\t\t\tconst pickerModalMemory: UmbInteractionMemoryModel = {\r\n\t\t\t\tunique: this.#getInteractionMemoryUnique(),\r\n\t\t\t\tmemories: pickerMemories,\r\n\t\t\t};\r\n\r\n\t\t\tthis.#pickerInputContext?.interactionMemory.setMemory(pickerModalMemory);\r\n\t\t} else {\r\n\t\t\tthis.#pickerInputContext?.interactionMemory.deleteMemory(this.#getInteractionMemoryUnique());\r\n\t\t}\r\n\t}\r\n}\r\n","import type { UmbPickerSearchManagerConfig } from './types.js';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { debounce } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbArrayState, UmbBooleanState, UmbNumberState, UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbSearchProvider, UmbSearchRequestArgs, UmbSearchResultItemModel } from '@umbraco-cms/backoffice/search';\r\n\r\n/**\r\n * A manager for searching items in a picker.\r\n * @exports\r\n * @class UmbPickerSearchManager\r\n * @augments {UmbControllerBase}\r\n * @template ResultItemType\r\n * @template SearchRequestArgsType\r\n */\r\nexport class UmbPickerSearchManager<\r\n\tResultItemType extends UmbSearchResultItemModel = UmbSearchResultItemModel,\r\n\tSearchRequestArgsType extends UmbSearchRequestArgs = UmbSearchRequestArgs,\r\n> extends UmbControllerBase {\r\n\t#searchable = new UmbBooleanState(false);\r\n\tpublic readonly searchable = this.#searchable.asObservable();\r\n\r\n\t#query = new UmbObjectState<SearchRequestArgsType | undefined>(undefined);\r\n\tpublic readonly query = this.#query.asObservable();\r\n\r\n\t#searching = new UmbBooleanState(false);\r\n\tpublic readonly searching = this.#searching.asObservable();\r\n\r\n\t#resultItems = new UmbArrayState<ResultItemType>([], (x) => x.unique);\r\n\tpublic readonly resultItems = this.#resultItems.asObservable();\r\n\r\n\t#resultTotalItems = new UmbNumberState(0);\r\n\tpublic readonly resultTotalItems = this.#resultTotalItems.asObservable();\r\n\r\n\t#config?: UmbPickerSearchManagerConfig;\r\n\t#searchProvider?: UmbSearchProvider<UmbSearchResultItemModel, SearchRequestArgsType>;\r\n\r\n\t/**\r\n\t * Set the configuration for the search manager.\r\n\t * @param {UmbPickerSearchManagerConfig} config The configuration for the search manager.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic setConfig(config: UmbPickerSearchManagerConfig) {\r\n\t\tthis.#config = config;\r\n\t\tthis.#initSearch();\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current configuration for the search manager.\r\n\t * @returns {UmbPickerSearchManagerConfig | undefined} The current configuration for the search manager.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic getConfig(): UmbPickerSearchManagerConfig | undefined {\r\n\t\treturn this.#config;\r\n\t}\r\n\r\n\t/**\r\n\t * Update the current configuration for the search manager.\r\n\t * @param {Partial<UmbPickerSearchManagerConfig>} partialConfig\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic updateConfig(partialConfig: Partial<UmbPickerSearchManagerConfig>) {\r\n\t\tconst mergedConfig = { ...this.#config, ...partialConfig } as UmbPickerSearchManagerConfig;\r\n\t\tthis.setConfig(mergedConfig);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether items can be searched.\r\n\t * @returns {boolean} Whether items can be searched.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic getSearchable(): boolean {\r\n\t\treturn this.#searchable.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets whether items can be searched.\r\n\t * @param {boolean} value Whether items can be searched.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic setSearchable(value: boolean) {\r\n\t\tthis.#searchable.setValue(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Search for items based on the current query.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic search() {\r\n\t\tif (this.getSearchable() === false) throw new Error('Search is not enabled');\r\n\r\n\t\tconst query = this.#query.getValue();\r\n\t\tif (!query?.query) {\r\n\t\t\tthis.clear();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#searching.setValue(true);\r\n\t\tthis.#debouncedSearch();\r\n\t}\r\n\r\n\t/**\r\n\t * Clear the current search query and result items.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic clear() {\r\n\t\tthis.#query.setValue(undefined);\r\n\t\tthis.#resultItems.setValue([]);\r\n\t\tthis.#searching.setValue(false);\r\n\t\tthis.#resultTotalItems.setValue(0);\r\n\t}\r\n\r\n\t/**\r\n\t * Set the search query.\r\n\t * @param {SearchRequestArgsType} query The search query.\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic setQuery(query: SearchRequestArgsType) {\r\n\t\tif (!this.query) {\r\n\t\t\tthis.clear();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#query.setValue(query);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current search query.\r\n\t * @memberof UmbPickerSearchManager\r\n\t * @returns {SearchRequestArgsType | undefined} The current search query.\r\n\t */\r\n\tpublic getQuery(): SearchRequestArgsType | undefined {\r\n\t\treturn this.#query.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Update the current search query.\r\n\t * @param {Partial<SearchRequestArgsType>} query\r\n\t * @memberof UmbPickerSearchManager\r\n\t */\r\n\tpublic updateQuery(query: Partial<SearchRequestArgsType>) {\r\n\t\tconst mergedQuery = { ...this.getQuery(), ...query } as SearchRequestArgsType;\r\n\t\tthis.#query.setValue(mergedQuery);\r\n\t}\r\n\r\n\tasync #initSearch() {\r\n\t\tconst providerAlias = this.#config?.providerAlias;\r\n\t\tif (!providerAlias) {\r\n\t\t\tthis.setSearchable(false);\r\n\t\t\tthrow new Error('No search provider alias provided');\r\n\t\t}\r\n\r\n\t\tthis.#searchProvider = await createExtensionApiByAlias<UmbSearchProvider>(this, providerAlias);\r\n\r\n\t\tif (!this.#searchProvider) {\r\n\t\t\tthis.setSearchable(false);\r\n\t\t\tthrow new Error(`Search Provider with alias ${providerAlias} is not available`);\r\n\t\t}\r\n\r\n\t\tthis.setSearchable(true);\r\n\t}\r\n\r\n\t#debouncedSearch = debounce(this.#search, 300);\r\n\r\n\tasync #search() {\r\n\t\tif (this.getSearchable() === false) throw new Error('Search is not enabled');\r\n\t\tif (!this.#searchProvider) throw new Error('Search provider is not available');\r\n\r\n\t\tconst query = this.#query.getValue();\r\n\t\tif (!query?.query) {\r\n\t\t\tthis.clear();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst args = {\r\n\t\t\t...query,\r\n\t\t\t// ensure that config params are always included\r\n\t\t\t...this.#config?.queryParams,\r\n\t\t\tsearchFrom: this.#config?.searchFrom,\r\n\t\t\t// TODO: Move this implementation to another place. The generic picker search manager shouldn't be aware of data types.\r\n\t\t\tdataTypeUnique: this.#config?.dataTypeUnique,\r\n\t\t};\r\n\r\n\t\tconst { data } = await this.#searchProvider.search(args);\r\n\t\tconst items = (data?.items as ResultItemType[]) ?? [];\r\n\t\tthis.#resultItems.setValue(items);\r\n\t\tthis.#resultTotalItems.setValue(data?.total ?? 0);\r\n\t\tthis.#searching.setValue(false);\r\n\t}\r\n}\r\n","import { UMB_PICKER_CONTEXT } from './picker.context.token.js';\r\nimport { UmbPickerSearchManager } from './search/manager/picker-search.manager.js';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbInteractionMemoryManager } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport { UmbSelectionManager } from '@umbraco-cms/backoffice/utils';\r\nimport { UMB_PROPERTY_TYPE_BASED_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbPickerContext extends UmbContextBase {\r\n\tpublic readonly interactionMemory = new UmbInteractionMemoryManager(this);\r\n\tpublic readonly selection = new UmbSelectionManager(this);\r\n\tpublic readonly search = new UmbPickerSearchManager(this);\r\n\r\n\tpublic dataType?: { unique: string };\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_PICKER_CONTEXT);\r\n\r\n\t\t/* TODO: Move this implementation to another place. The generic picker context shouldn't be aware of property and data types.\r\n\t\tIt also gives an illegal import of content module */\r\n\t\tthis.consumeContext(UMB_PROPERTY_TYPE_BASED_PROPERTY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(context?.dataType, (dataType) => {\r\n\t\t\t\tthis.dataType = dataType;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n","import type { UmbPickerContext } from '../picker.context.js';\r\nimport { UMB_PICKER_CONTEXT } from '../picker.context.token.js';\r\nimport type { UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { html, customElement, state, nothing, css } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n@customElement('umb-picker-search-field')\r\nexport class UmbPickerSearchFieldElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _query: string = '';\r\n\r\n\t@state()\r\n\tprivate _searching: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _isSearchable: boolean = false;\r\n\r\n\t#pickerContext?: UmbPickerContext;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PICKER_CONTEXT, (context) => {\r\n\t\t\tthis.#pickerContext = context;\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#pickerContext?.search.searchable,\r\n\t\t\t\t(isSearchable) => (this._isSearchable = isSearchable ?? false),\r\n\t\t\t);\r\n\t\t\tthis.observe(this.#pickerContext?.search.searching, (searching) => (this._searching = searching ?? false));\r\n\t\t\tthis.observe(this.#pickerContext?.search.query, (query) => (this._query = query?.query || ''));\r\n\t\t});\r\n\t}\r\n\r\n\t#onInput(event: UUIInputEvent) {\r\n\t\tconst value = event.target.value as string;\r\n\t\tthis.#pickerContext?.search.updateQuery({ query: value });\r\n\t\tthis.#pickerContext?.search.search();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._isSearchable) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-input .value=${this._query} placeholder=\"Search...\" @input=${this.#onInput}>\r\n\t\t\t\t<div slot=\"prepend\">\r\n\t\t\t\t\t${this._searching\r\n\t\t\t\t\t\t? html`<uui-loader-circle id=\"searching-indicator\"></uui-loader-circle>`\r\n\t\t\t\t\t\t: html`<uui-icon name=\"search\"></uui-icon>`}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t${this._query\r\n\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t<uui-button slot=\"append\" type=\"button\" @click=${() => this.#pickerContext?.search.clear()} compact>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-delete\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t: nothing}\r\n\t\t\t</uui-input>\r\n\t\t\t<div id=\"divider\"></div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tuui-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-input [slot='prepend'] {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#divider {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 1px;\r\n\t\t\t\tbackground-color: var(--uui-color-divider);\r\n\t\t\t\tmargin-top: var(--uui-size-space-5);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t#searching-indicator {\r\n\t\t\t\tmargin-left: 7px;\r\n\t\t\t\tmargin-top: 4px;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-picker-search-field': UmbPickerSearchFieldElement;\r\n\t}\r\n}\r\n","import { UMB_PICKER_CONTEXT } from '../picker.context.token.js';\r\nimport type { UmbPickerContext } from '../picker.context.js';\r\nimport type { ManifestPickerSearchResultItem } from './result-item/picker-search-result-item.extension.js';\r\nimport { customElement, html, nothing, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbSearchRequestArgs } from '@umbraco-cms/backoffice/search';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\n\r\ntype PickableFilterMethodType<T extends UmbEntityModel = UmbEntityModel> = (item: T) => boolean;\r\n\r\n@customElement('umb-picker-search-result')\r\nexport class UmbPickerSearchResultElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _query?: UmbSearchRequestArgs;\r\n\r\n\t@state()\r\n\tprivate _searching: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _items: UmbEntityModel[] = [];\r\n\r\n\t@state()\r\n\tprivate _isSearchable: boolean = false;\r\n\r\n\t@property({ attribute: false })\r\n\tpickableFilter: PickableFilterMethodType = () => true;\r\n\r\n\t#pickerContext?: UmbPickerContext;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PICKER_CONTEXT, (context) => {\r\n\t\t\tthis.#pickerContext = context;\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#pickerContext?.search.searchable,\r\n\t\t\t\t(isSearchable) => (this._isSearchable = isSearchable ?? false),\r\n\t\t\t\t'obsSearchable',\r\n\t\t\t);\r\n\t\t\tthis.observe(this.#pickerContext?.search.query, (query) => (this._query = query), 'obsQuery');\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#pickerContext?.search.searching,\r\n\t\t\t\t(query) => (this._searching = query ?? false),\r\n\t\t\t\t'obsSearching',\r\n\t\t\t);\r\n\t\t\tthis.observe(this.#pickerContext?.search.resultItems, (items) => (this._items = items ?? []), 'obsResultItems');\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._isSearchable) return nothing;\r\n\r\n\t\tif (this._query?.query && this._searching === false && this._items.length === 0) {\r\n\t\t\treturn this.#renderEmptyResult();\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t${repeat(\r\n\t\t\t\tthis._items,\r\n\t\t\t\t(item) => item.unique,\r\n\t\t\t\t(item) => this.#renderResultItem(item),\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEmptyResult() {\r\n\t\treturn html`<small>No result for <strong>\"${this._query?.query}\"</strong>.</small>`;\r\n\t}\r\n\r\n\t#renderResultItem(item: UmbEntityModel) {\r\n\t\treturn html`\r\n\t\t\t<umb-extension-with-api-slot\r\n\t\t\t\ttype=\"pickerSearchResultItem\"\r\n\t\t\t\t.filter=${(manifest: ManifestPickerSearchResultItem) => manifest.forEntityTypes.includes(item.entityType)}\r\n\t\t\t\t.elementProps=${{\r\n\t\t\t\t\titem,\r\n\t\t\t\t\tdisabled: this.pickableFilter ? !this.pickableFilter(item) : undefined,\r\n\t\t\t\t}}></umb-extension-with-api-slot>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-picker-search-result': UmbPickerSearchResultElement;\r\n\t}\r\n}\r\n"],"names":["UmbPickerModalBaseElement","UmbModalBaseElement","#pickerInputContext","UMB_PICKER_INPUT_CONTEXT","pickerInputContext","#observeMemoriesFromInputContext","#observeMemoriesFromPicker","memories","#setMemoriesOnInputContext","#getInteractionMemoryUnique","memory","pickerMemories","pickerModalMemory","UmbPickerSearchManager","UmbControllerBase","#searchable","UmbBooleanState","#query","UmbObjectState","#searching","#resultItems","UmbArrayState","x","#resultTotalItems","UmbNumberState","#debouncedSearch","debounce","#search","#config","#searchProvider","config","#initSearch","partialConfig","mergedConfig","value","query","mergedQuery","providerAlias","createExtensionApiByAlias","args","data","items","UmbPickerContext","UmbContextBase","host","UMB_PICKER_CONTEXT","UmbInteractionMemoryManager","UmbSelectionManager","UMB_PROPERTY_TYPE_BASED_PROPERTY_CONTEXT","context","dataType","_pickerContext","_UmbPickerSearchFieldElement_instances","onInput_fn","UmbPickerSearchFieldElement","UmbLitElement","__privateAdd","__privateSet","__privateGet","isSearchable","searching","html","__privateMethod","nothing","event","UmbTextStyles","css","__decorateClass","state","customElement","_UmbPickerSearchResultElement_instances","renderEmptyResult_fn","renderResultItem_fn","UmbPickerSearchResultElement","repeat","item","manifest","property"],"mappings":"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"}