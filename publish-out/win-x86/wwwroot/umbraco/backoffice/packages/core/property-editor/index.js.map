{"version":3,"file":"index.js","sources":["../../../../src/packages/core/property-editor/constants.ts","../../../../src/packages/core/property-editor/components/ref-property-editor-ui/ref-property-editor-ui.element.ts","../../../../src/packages/core/property-editor/config/property-editor-config-collection.class.ts","../../../../src/packages/core/property-editor/events/property-value-change.event.ts","../../../../src/packages/core/property-editor/interaction-memory/property-editor-ui-interaction-memory.manager.ts","../../../../src/packages/core/property-editor/ui-picker-modal/property-editor-ui-picker-modal.token.ts"],"sourcesContent":["export const UMB_PROPERTY_EDITOR_SCHEMA_ALIAS_DEFAULT = 'Umbraco.Label';\r\nexport const UMB_MISSING_PROPERTY_EDITOR_UI_ALIAS = 'Umb.PropertyEditorUi.Missing';\r\nexport const UMB_MISSING_PROPERTY_EDITOR_UI_UI_ALIAS = 'Umb.PropertyEditorUi.MissingUi';\r\n","import { UMB_PROPERTY_EDITOR_SCHEMA_ALIAS_DEFAULT } from '../../constants.js';\r\nimport { UUIRefNodeElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { html, customElement, property } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n *  @element umb-ref-property-editor-ui\r\n *  @description - Component for displaying a reference to a Property Editor UI\r\n *  @augments UUIRefNodeElement\r\n */\r\n@customElement('umb-ref-property-editor-ui')\r\nexport class UmbRefPropertyEditorUIElement extends UUIRefNodeElement {\r\n\tprotected override fallbackIcon =\r\n\t\t'<svg xmlns=\"https://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path d=\"M142.212 397.267l106.052-48.024L398.479 199.03l-26.405-26.442-90.519 90.517-15.843-15.891 90.484-90.486-16.204-16.217-150.246 150.243-47.534 106.513zm74.904-100.739l23.285-23.283 3.353 22.221 22.008 3.124-23.283 23.313-46.176 20.991 20.813-46.366zm257.6-173.71L416.188 64.3l-49.755 49.785 58.504 58.503 49.779-49.77zM357.357 300.227h82.826v116.445H68.929V300.227h88.719v-30.648H38.288v177.733h432.537V269.578H357.357v30.649z\"></path></svg>';\r\n\r\n\t/**\r\n\t * Alias\r\n\t * @type {string}\r\n\t * @attr\r\n\t * @default ''\r\n\t */\r\n\t@property({ type: String })\r\n\talias = '';\r\n\r\n\t/**\r\n\t * Property Editor Alias\r\n\t * @type {string}\r\n\t * @attr\r\n\t * @default ''\r\n\t */\r\n\t@property({ type: String, attribute: 'property-editor-schema-alias' })\r\n\tpropertyEditorSchemaAlias = '';\r\n\r\n\tprotected override renderDetail() {\r\n\t\tconst details: string[] = [];\r\n\r\n\t\tif (this.alias !== '') {\r\n\t\t\tdetails.push(this.alias);\r\n\t\t}\r\n\r\n\t\tif (this.propertyEditorSchemaAlias !== '') {\r\n\t\t\tdetails.push(this.propertyEditorSchemaAlias);\r\n\t\t} else {\r\n\t\t\tdetails.push(UMB_PROPERTY_EDITOR_SCHEMA_ALIAS_DEFAULT);\r\n\t\t}\r\n\r\n\t\tif (this.detail !== '') {\r\n\t\t\tdetails.push(this.detail);\r\n\t\t}\r\n\t\treturn html`<small id=\"detail\">${details.join(' | ')}<slot name=\"detail\"></slot></small>`;\r\n\t}\r\n\r\n\tstatic override styles = [...UUIRefNodeElement.styles];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-ref-property-editor-ui': UmbRefPropertyEditorUIElement;\r\n\t}\r\n}\r\n","import type { UmbPropertyEditorConfigProperty, UmbPropertyEditorConfig } from '../types.js';\r\nimport type { DataTypePropertyPresentationModel } from '@umbraco-cms/backoffice/external/backend-api';\r\n\r\n/**\r\n * Extends Array to add utility functions for accessing data type properties\r\n * by alias, returning either the value or the complete DataTypePropertyPresentationModel object\r\n */\r\nexport class UmbPropertyEditorConfigCollection extends Array<UmbPropertyEditorConfigProperty> {\r\n\tconstructor(args: UmbPropertyEditorConfig) {\r\n\t\tsuper(...args);\r\n\t}\r\n\tstatic override get [Symbol.species](): ArrayConstructor {\r\n\t\treturn Array;\r\n\t}\r\n\r\n\tgetValueByAlias<T>(alias: string): T | undefined {\r\n\t\tconst property = this.getByAlias(alias);\r\n\r\n\t\tif (property?.value === undefined || property?.value === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn property.value as T;\r\n\t}\r\n\r\n\tgetByAlias(alias: string): DataTypePropertyPresentationModel | undefined {\r\n\t\treturn this.find((x) => x.alias === alias);\r\n\t}\r\n\r\n\t/**\r\n\t * Convert the underlying array to an object where\r\n\t * the property value is keyed by its alias\r\n\t * eg\r\n\t * `[\r\n\t *   { 'alias': 'myProperty', 'value': 27 },\r\n\t *   { 'alias': 'anotherProperty', 'value': 'eleven' },\r\n\t * ]`\r\n\t * is returned as\r\n\t * `{\r\n\t *   myProperty: 27,\r\n\t * \t anotherProperty: 'eleven',\r\n\t * }`\r\n\t */\r\n\ttoObject(): Record<string, unknown> {\r\n\t\treturn Object.fromEntries(this.map((x) => [x.alias, x.value]));\r\n\t}\r\n\r\n\tequal(other: UmbPropertyEditorConfigCollection | undefined): boolean {\r\n\t\tif (this.length !== other?.length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn this.every((x) => {\r\n\t\t\tconst otherProperty = x.alias ? other.getByAlias(x.alias!) : undefined;\r\n\t\t\treturn otherProperty && x.value === otherProperty.value;\r\n\t\t});\r\n\t}\r\n}\r\n","import { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbDeprecation } from '@umbraco-cms/backoffice/utils';\r\n\r\n/**\r\n * @deprecated Use UmbChangeEvent instead, this will be removed as of v.18.0.0\r\n */\r\nexport class UmbPropertyValueChangeEvent extends UmbChangeEvent {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tnew UmbDeprecation({\r\n\t\t\tremoveInVersion: '18.0.0',\r\n\t\t\tdeprecated: 'UmbPropertyValueChangeEvent',\r\n\t\t\tsolution: 'Use UmbChangeEvent instead',\r\n\t\t}).warn();\r\n\t}\r\n}\r\n","import type { UmbPropertyEditorConfigCollection } from '../config/index.js';\r\nimport { simpleHashCode, UmbArrayState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UMB_INTERACTION_MEMORY_CONTEXT } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbInteractionMemoryModel } from '@umbraco-cms/backoffice/interaction-memory';\r\n\r\nexport interface UmbPropertyEditorUiInteractionMemoryManagerArgs {\r\n\tmemoryUniquePrefix: string;\r\n}\r\n\r\nexport class UmbPropertyEditorUiInteractionMemoryManager extends UmbControllerBase {\r\n\t#memories = new UmbArrayState<UmbInteractionMemoryModel>([], (x) => x.unique);\r\n\tmemoriesForPropertyEditor = this.#memories.asObservable();\r\n\r\n\t#interactionMemoryContext?: typeof UMB_INTERACTION_MEMORY_CONTEXT.TYPE;\r\n\t#configHashCode?: number;\r\n\t#memoryUniquePrefix: string;\r\n\t#init?: Promise<unknown>;\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbPropertyEditorUiInteractionMemoryManagerArgs) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#memoryUniquePrefix = args.memoryUniquePrefix;\r\n\r\n\t\tthis.#init = Promise.all([\r\n\t\t\tthis.consumeContext(UMB_INTERACTION_MEMORY_CONTEXT, (context) => {\r\n\t\t\t\tthis.#interactionMemoryContext = context;\r\n\t\t\t}).asPromise(),\r\n\t\t]);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the property editor config, used to create a unique hash for the interaction memory.\r\n\t * @param {(UmbPropertyEditorConfigCollection | undefined)} config\r\n\t * @memberof UmbPropertyEditorUiInteractionMemoryManager\r\n\t */\r\n\tsetPropertyEditorConfig(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tthis.#setConfigHash(config);\r\n\t\tthis.#getInteractionMemory();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates or updates an interaction memory for this property editor based on the provided memories.\r\n\t * @param {Array<UmbInteractionMemoryModel>} memories - The memories to include for this property editor.\r\n\t * @returns {Promise<void>}\r\n\t * @memberof UmbPropertyEditorUiInteractionMemoryManager\r\n\t */\r\n\tasync saveMemoriesForPropertyEditor(memories: Array<UmbInteractionMemoryModel>): Promise<void> {\r\n\t\tawait this.#init;\r\n\t\tconst memoryUnique = this.#getInteractionMemoryUnique();\r\n\t\tif (!this.#interactionMemoryContext) return;\r\n\r\n\t\tconst propertyEditorMemory: UmbInteractionMemoryModel = {\r\n\t\t\tunique: memoryUnique,\r\n\t\t\tmemories,\r\n\t\t};\r\n\r\n\t\tthis.#interactionMemoryContext.memory.setMemory(propertyEditorMemory);\r\n\t\tthis.#memories.setValue(memories);\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes the interaction memory for this property editor.\r\n\t * @memberof UmbPropertyEditorUiInteractionMemoryManager\r\n\t */\r\n\tasync deleteMemoriesForPropertyEditor(): Promise<void> {\r\n\t\tawait this.#init;\r\n\t\tconst unique = this.#getInteractionMemoryUnique();\r\n\t\tthis.#interactionMemoryContext?.memory.deleteMemory(unique);\r\n\t\tthis.#memories.setValue([]);\r\n\t}\r\n\r\n\t#getInteractionMemoryUnique() {\r\n\t\treturn `${this.#memoryUniquePrefix}PropertyEditorUi${this.#configHashCode ? '-' + this.#configHashCode : ''}`;\r\n\t}\r\n\r\n\tasync #getInteractionMemory() {\r\n\t\tawait this.#init;\r\n\t\tconst memoryUnique = this.#getInteractionMemoryUnique();\r\n\t\tif (!memoryUnique) return;\r\n\t\tif (!this.#interactionMemoryContext) return;\r\n\r\n\t\tconst memory = this.#interactionMemoryContext.memory.getMemory(memoryUnique);\r\n\t\tthis.#memories.setValue(memory?.memories ?? []);\r\n\t}\r\n\r\n\t#setConfigHash(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tconst configString = config ? JSON.stringify(config.toObject()) : '';\r\n\t\tconst hashCode = simpleHashCode(configString);\r\n\t\tthis.#configHashCode = hashCode;\r\n\t}\r\n}\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport type UmbPropertyEditorUIPickerModalData = object;\r\n\r\nexport type UmbPropertyEditorUIPickerModalValue = {\r\n\tselection: Array<string>;\r\n};\r\n\r\nexport const UMB_PROPERTY_EDITOR_UI_PICKER_MODAL = new UmbModalToken<\r\n\tUmbPropertyEditorUIPickerModalData,\r\n\tUmbPropertyEditorUIPickerModalValue\r\n>('Umb.Modal.PropertyEditorUiPicker', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n"],"names":["UMB_PROPERTY_EDITOR_SCHEMA_ALIAS_DEFAULT","UMB_MISSING_PROPERTY_EDITOR_UI_ALIAS","UMB_MISSING_PROPERTY_EDITOR_UI_UI_ALIAS","UmbRefPropertyEditorUIElement","UUIRefNodeElement","details","html","__decorateClass","property","customElement","UmbPropertyEditorConfigCollection","args","alias","x","other","otherProperty","UmbPropertyValueChangeEvent","UmbChangeEvent","UmbDeprecation","UmbPropertyEditorUiInteractionMemoryManager","UmbControllerBase","host","#memories","UmbArrayState","#memoryUniquePrefix","#init","UMB_INTERACTION_MEMORY_CONTEXT","context","#interactionMemoryContext","#configHashCode","config","#setConfigHash","#getInteractionMemory","memories","memoryUnique","#getInteractionMemoryUnique","propertyEditorMemory","unique","memory","configString","hashCode","simpleHashCode","UMB_PROPERTY_EDITOR_UI_PICKER_MODAL","UmbModalToken"],"mappings":"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"}