{"version":3,"file":"section-sidebar-menu.section-context-DfLlL1GU.js","sources":["../../../src/packages/core/menu/section-sidebar-menu/section-context/expansion/section-sidebar-menu-section-expansion.manager.ts","../../../src/packages/core/menu/section-sidebar-menu/section-context/section-sidebar-menu.section-context.ts"],"sourcesContent":["import { UMB_SECTION_SIDEBAR_MENU_GLOBAL_CONTEXT } from '../../global-context/section-sidebar-menu.global-context.token.js';\r\nimport type { UmbSectionMenuItemExpansionEntryModel } from '../../types.js';\r\nimport type { UmbMenuItemExpansionEntryModel } from '../../../components/menu/types.js';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { Observable } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UMB_SECTION_CONTEXT } from '@umbraco-cms/backoffice/section';\r\nimport { UmbEntityExpansionManager, type UmbEntityExpansionModel } from '@umbraco-cms/backoffice/utils';\r\n\r\n/**\r\n * Manages the expansion state of a section sidebar menu.\r\n * @exports\r\n * @class UmbSectionSidebarMenuSectionExpansionManager\r\n * @augments {UmbControllerBase}\r\n */\r\nexport class UmbSectionSidebarMenuSectionExpansionManager extends UmbControllerBase {\r\n\t#manager = new UmbEntityExpansionManager<UmbMenuItemExpansionEntryModel>(this);\r\n\tpublic readonly expansion = this.#manager.expansion;\r\n\r\n\t#sectionContext?: typeof UMB_SECTION_CONTEXT.TYPE;\r\n\t#globalContext?: typeof UMB_SECTION_SIDEBAR_MENU_GLOBAL_CONTEXT.TYPE;\r\n\t#currentSectionAlias?: string;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.consumeContext(UMB_SECTION_CONTEXT, (sectionContext) => {\r\n\t\t\tthis.#sectionContext = sectionContext;\r\n\t\t\tthis.#observeCurrentSectionAlias();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_SECTION_SIDEBAR_MENU_GLOBAL_CONTEXT, (globalContext) => {\r\n\t\t\tthis.#globalContext = globalContext;\r\n\t\t\tthis.#observeGlobalMenuExpansion();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeCurrentSectionAlias() {\r\n\t\tthis.observe(this.#sectionContext?.alias, (alias) => {\r\n\t\t\tif (!alias) return;\r\n\t\t\tthis.#currentSectionAlias = alias;\r\n\t\t});\r\n\t}\r\n\r\n\t#observeGlobalMenuExpansion() {\r\n\t\tif (!this.#globalContext || !this.#currentSectionAlias) return;\r\n\t\tthis.observe(this.#globalContext?.expansion.expansionBySectionAlias(this.#currentSectionAlias), (expansion) => {\r\n\t\t\tthis.#manager.setExpansion(expansion);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if an entry is expanded\r\n\t * @param {UmbMenuItemExpansionEntryModel} entry The entry to check\r\n\t * @returns {Observable<boolean>} True if the entry is expanded\r\n\t * @memberof UmbSectionSidebarMenuSectionExpansionManager\r\n\t */\r\n\tisExpanded(entry: UmbMenuItemExpansionEntryModel): Observable<boolean> {\r\n\t\treturn this.#manager.isExpanded(entry);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the expansion state\r\n\t * @param {UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel> | undefined} expansion The expansion state\r\n\t * @memberof UmbSectionSidebarMenuSectionExpansionManager\r\n\t * @returns {void}\r\n\t */\r\n\tsetExpansion(expansion: UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel>): void {\r\n\t\tthis.#manager.setExpansion(expansion);\r\n\t\tconst entries = this.#bindEntriesToSection(expansion);\r\n\t\tthis.#globalContext?.expansion.setExpansion(entries);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the expansion state\r\n\t * @memberof UmbSectionSidebarMenuSectionExpansionManager\r\n\t * @returns {UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel>} The expansion state\r\n\t */\r\n\tgetExpansion(): UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel> {\r\n\t\treturn this.#manager.getExpansion();\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a menu item\r\n\t * @param {UmbMenuItemExpansionEntryModel} entry The item to open\r\n\t * @memberof UmbSectionSidebarMenuSectionExpansionManager\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic async expandItem(entry: UmbMenuItemExpansionEntryModel): Promise<void> {\r\n\t\tthis.#manager.expandItem(entry);\r\n\t\tconst entries = this.#bindEntriesToSection([entry]);\r\n\t\tthis.#globalContext?.expansion.expandItem(entries[0]);\r\n\t}\r\n\r\n\t/**\r\n\t * Expands multiple entities\r\n\t * @param {UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel>} entries The entities to open\r\n\t * @memberof UmbEntityExpansionManager\r\n\t * @returns {void}\r\n\t */\r\n\tpublic expandItems(entries: UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel>): void {\r\n\t\tthis.#manager.expandItems(entries);\r\n\t\tconst entriesWithSectionAlias = this.#bindEntriesToSection(entries);\r\n\t\tthis.#globalContext?.expansion.expandItems(entriesWithSectionAlias);\r\n\t}\r\n\r\n\t/**\r\n\t * Closes a menu item\r\n\t * @param {UmbMenuItemExpansionEntryModel} entry The item to close\r\n\t * @memberof UmbSectionSidebarMenuSectionExpansionManager\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic async collapseItem(entry: UmbMenuItemExpansionEntryModel): Promise<void> {\r\n\t\tthis.#manager.collapseItem(entry);\r\n\t\tconst entries = this.#bindEntriesToSection([entry]);\r\n\t\tthis.#globalContext?.expansion.collapseItem(entries[0]);\r\n\t}\r\n\r\n\t/**\r\n\t * Closes all menu items\r\n\t * @memberof UmbSectionSidebarMenuSectionExpansionManager\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic async collapseAll(): Promise<void> {\r\n\t\t// Collapse all items in the global context matching the current section\r\n\t\tconst entries = this.#bindEntriesToSection(this.#manager.getExpansion());\r\n\t\tthis.#manager.collapseAll();\r\n\t\tthis.#globalContext?.expansion.collapseItems(entries);\r\n\t}\r\n\r\n\t#bindEntriesToSection(\r\n\t\texpansion: UmbEntityExpansionModel<UmbMenuItemExpansionEntryModel>,\r\n\t): UmbEntityExpansionModel<UmbSectionMenuItemExpansionEntryModel> {\r\n\t\treturn expansion.map((item) => ({\r\n\t\t\t...item,\r\n\t\t\tsectionAlias: this.#currentSectionAlias,\r\n\t\t}));\r\n\t}\r\n}\r\n","import { UmbSectionSidebarMenuSectionExpansionManager } from './expansion/section-sidebar-menu-section-expansion.manager.js';\r\nimport { UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT } from './section-sidebar-menu.section-context.token.js';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbSectionSidebarMenuSectionContext extends UmbContextBase {\r\n\tpublic readonly expansion = new UmbSectionSidebarMenuSectionExpansionManager(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT);\r\n\t}\r\n}\r\n\r\nexport { UmbSectionSidebarMenuSectionContext as api };\r\n"],"names":["UmbSectionSidebarMenuSectionExpansionManager","UmbControllerBase","host","#manager","UmbEntityExpansionManager","UMB_SECTION_CONTEXT","sectionContext","#sectionContext","#observeCurrentSectionAlias","UMB_SECTION_SIDEBAR_MENU_GLOBAL_CONTEXT","globalContext","#globalContext","#observeGlobalMenuExpansion","#currentSectionAlias","alias","expansion","entry","entries","#bindEntriesToSection","entriesWithSectionAlias","item","UmbSectionSidebarMenuSectionContext","UmbContextBase","UMB_SECTION_SIDEBAR_MENU_SECTION_CONTEXT"],"mappings":";;;;;AAeO,MAAMA,UAAqDC,EAAkB;AAAA,EAQnF,YAAYC,GAAyB;AACpC,UAAMA,CAAI,GARX,KAAAC,KAAW,IAAIC,EAA0D,IAAI,GAC7E,KAAgB,YAAY,KAAKD,GAAS,WASzC,KAAK,eAAeE,GAAqB,CAACC,MAAmB;AAC5D,WAAKC,KAAkBD,GACvB,KAAKE,GAAA;AAAA,IACN,CAAC,GAED,KAAK,eAAeC,GAAyC,CAACC,MAAkB;AAC/E,WAAKC,KAAiBD,GACtB,KAAKE,GAAA;AAAA,IACN,CAAC;AAAA,EACF;AAAA,EAnBAT;AAAA,EAGAI;AAAA,EACAI;AAAA,EACAE;AAAA,EAgBAL,KAA8B;AAC7B,SAAK,QAAQ,KAAKD,IAAiB,OAAO,CAACO,MAAU;AACpD,MAAKA,MACL,KAAKD,KAAuBC;AAAA,IAC7B,CAAC;AAAA,EACF;AAAA,EAEAF,KAA8B;AAC7B,IAAI,CAAC,KAAKD,MAAkB,CAAC,KAAKE,MAClC,KAAK,QAAQ,KAAKF,IAAgB,UAAU,wBAAwB,KAAKE,EAAoB,GAAG,CAACE,MAAc;AAC9G,WAAKZ,GAAS,aAAaY,CAAS;AAAA,IACrC,CAAC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,WAAWC,GAA4D;AACtE,WAAO,KAAKb,GAAS,WAAWa,CAAK;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAaD,GAA0E;AACtF,SAAKZ,GAAS,aAAaY,CAAS;AACpC,UAAME,IAAU,KAAKC,GAAsBH,CAAS;AACpD,SAAKJ,IAAgB,UAAU,aAAaM,CAAO;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,eAAwE;AACvE,WAAO,KAAKd,GAAS,aAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAa,WAAWa,GAAsD;AAC7E,SAAKb,GAAS,WAAWa,CAAK;AAC9B,UAAMC,IAAU,KAAKC,GAAsB,CAACF,CAAK,CAAC;AAClD,SAAKL,IAAgB,UAAU,WAAWM,EAAQ,CAAC,CAAC;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQO,YAAYA,GAAwE;AAC1F,SAAKd,GAAS,YAAYc,CAAO;AACjC,UAAME,IAA0B,KAAKD,GAAsBD,CAAO;AAClE,SAAKN,IAAgB,UAAU,YAAYQ,CAAuB;AAAA,EACnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAa,aAAaH,GAAsD;AAC/E,SAAKb,GAAS,aAAaa,CAAK;AAChC,UAAMC,IAAU,KAAKC,GAAsB,CAACF,CAAK,CAAC;AAClD,SAAKL,IAAgB,UAAU,aAAaM,EAAQ,CAAC,CAAC;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,cAA6B;AAEzC,UAAMA,IAAU,KAAKC,GAAsB,KAAKf,GAAS,cAAc;AACvE,SAAKA,GAAS,YAAA,GACd,KAAKQ,IAAgB,UAAU,cAAcM,CAAO;AAAA,EACrD;AAAA,EAEAC,GACCH,GACiE;AACjE,WAAOA,EAAU,IAAI,CAACK,OAAU;AAAA,MAC/B,GAAGA;AAAA,MACH,cAAc,KAAKP;AAAA,IAAA,EAClB;AAAA,EACH;AACD;ACrIO,MAAMQ,UAA4CC,EAAe;AAAA,EAGvE,YAAYpB,GAAyB;AACpC,UAAMA,GAAMqB,CAAwC,GAHrD,KAAgB,YAAY,IAAIvB,EAA6C,IAAI;AAAA,EAIjF;AACD;"}