{"version":3,"file":"tree-item-element-base-mu8pGzwR.js","sources":["../../../src/packages/core/tree/entity-actions/reload-tree-item-children/reload-tree-item-children-request.event.ts","../../../src/packages/core/tree/tree-item/tree-item-base/tree-item-context-base.ts","../../../src/packages/core/tree/tree-item/tree-item-base/tree-item-element-base.ts"],"sourcesContent":["import { UmbEntityActionEvent, type UmbEntityActionEventArgs } from '@umbraco-cms/backoffice/entity-action';\r\n\r\n/**\r\n * @deprecated Use `UmbRequestReloadChildrenOfEntityEvent` instead.\r\n */\r\nexport class UmbRequestReloadTreeItemChildrenEvent extends UmbEntityActionEvent {\r\n\tstatic readonly TYPE = 'request-reload-tree-item-children';\r\n\r\n\tconstructor(args: UmbEntityActionEventArgs) {\r\n\t\tsuper(UmbRequestReloadTreeItemChildrenEvent.TYPE, args);\r\n\t}\r\n}\r\n","import type { UmbTreeItemContext } from '../tree-item-context.interface.js';\r\nimport { UMB_TREE_CONTEXT, type UmbDefaultTreeContext } from '../../default/index.js';\r\nimport type { UmbTreeItemModel, UmbTreeRootModel } from '../../types.js';\r\nimport { UmbRequestReloadTreeItemChildrenEvent } from '../../entity-actions/reload-tree-item-children/index.js';\r\nimport type { ManifestTreeItem } from '../../extensions/types.js';\r\nimport { map } from '@umbraco-cms/backoffice/external/rxjs';\r\nimport { UmbArrayState, UmbBooleanState, UmbObjectState, UmbStringState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { UMB_SECTION_CONTEXT, UMB_SECTION_SIDEBAR_CONTEXT } from '@umbraco-cms/backoffice/section';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport {\r\n\tUmbHasChildrenEntityContext,\r\n\tUmbRequestReloadChildrenOfEntityEvent,\r\n\tUmbRequestReloadStructureForEntityEvent,\r\n} from '@umbraco-cms/backoffice/entity-action';\r\nimport type { UmbEntityActionEvent } from '@umbraco-cms/backoffice/entity-action';\r\nimport { UmbDeprecation, UmbPaginationManager, debounce } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbParentEntityContext, type UmbEntityModel, type UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport { ensureSlash } from '@umbraco-cms/backoffice/router';\r\n\r\nexport abstract class UmbTreeItemContextBase<\r\n\t\tTreeItemType extends UmbTreeItemModel,\r\n\t\tTreeRootType extends UmbTreeRootModel,\r\n\t\tManifestType extends ManifestTreeItem = ManifestTreeItem,\r\n\t>\r\n\textends UmbContextBase\r\n\timplements UmbTreeItemContext<TreeItemType>\r\n{\r\n\tpublic unique?: UmbEntityUnique;\r\n\tpublic entityType?: string;\r\n\tpublic readonly pagination = new UmbPaginationManager();\r\n\r\n\t#manifest?: ManifestType;\r\n\r\n\tprotected readonly _treeItem = new UmbObjectState<TreeItemType | undefined>(undefined);\r\n\treadonly treeItem = this._treeItem.asObservable();\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t// @ts-ignore\r\n\t#childItems = new UmbArrayState<TreeItemType>([], (x) => x.unique);\r\n\treadonly childItems = this.#childItems.asObservable();\r\n\r\n\t#hasChildren = new UmbBooleanState(false);\r\n\treadonly hasChildren = this.#hasChildren.asObservable();\r\n\r\n\t#isLoading = new UmbBooleanState(false);\r\n\treadonly isLoading = this.#isLoading.asObservable();\r\n\r\n\t#isSelectable = new UmbBooleanState(false);\r\n\treadonly isSelectable = this.#isSelectable.asObservable();\r\n\r\n\t#isSelectableContext = new UmbBooleanState(false);\r\n\treadonly isSelectableContext = this.#isSelectableContext.asObservable();\r\n\r\n\t#isSelected = new UmbBooleanState(false);\r\n\treadonly isSelected = this.#isSelected.asObservable();\r\n\r\n\t#isActive = new UmbBooleanState(false);\r\n\treadonly isActive = this.#isActive.asObservable();\r\n\r\n\t#hasActions = new UmbBooleanState(false);\r\n\treadonly hasActions = this.#hasActions.asObservable();\r\n\r\n\t#path = new UmbStringState('');\r\n\treadonly path = this.#path.asObservable();\r\n\r\n\t#isOpen = new UmbBooleanState(false);\r\n\tisOpen = this.#isOpen.asObservable();\r\n\r\n\t#foldersOnly = new UmbBooleanState(false);\r\n\treadonly foldersOnly = this.#foldersOnly.asObservable();\r\n\r\n\tpublic treeContext?: UmbDefaultTreeContext<TreeItemType, TreeRootType>;\r\n\tpublic parentTreeItemContext?: UmbTreeItemContext<TreeItemType>;\r\n\r\n\t#sectionContext?: typeof UMB_SECTION_CONTEXT.TYPE;\r\n\t#sectionSidebarContext?: typeof UMB_SECTION_SIDEBAR_CONTEXT.TYPE;\r\n\t#actionEventContext?: typeof UMB_ACTION_EVENT_CONTEXT.TYPE;\r\n\r\n\t#hasChildrenContext = new UmbHasChildrenEntityContext(this);\r\n\t#parentContext = new UmbParentEntityContext(this);\r\n\r\n\t// TODO: get this from the tree context\r\n\t#paging = {\r\n\t\tskip: 0,\r\n\t\ttake: 50,\r\n\t};\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_TREE_ITEM_CONTEXT);\r\n\t\tthis.pagination.setPageSize(this.#paging.take);\r\n\t\tthis.#consumeContexts();\r\n\r\n\t\t// listen for page changes on the pagination manager\r\n\t\tthis.pagination.addEventListener(UmbChangeEvent.TYPE, this.#onPageChange);\r\n\r\n\t\twindow.addEventListener('navigationend', this.#debouncedCheckIsActive);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the manifest\r\n\t * @param {ManifestCollection} manifest\r\n\t * @memberof UmbCollectionContext\r\n\t */\r\n\tpublic set manifest(manifest: ManifestType | undefined) {\r\n\t\tif (this.#manifest === manifest) return;\r\n\t\tthis.#manifest = manifest;\r\n\t}\r\n\tpublic get manifest() {\r\n\t\treturn this.#manifest;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the manifest.\r\n\t * @returns {ManifestCollection}\r\n\t * @memberof UmbCollectionContext\r\n\t * @deprecated Use the `.manifest` property instead.\r\n\t */\r\n\tpublic getManifest() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tremoveInVersion: '18.0.0',\r\n\t\t\tdeprecated: 'getManifest',\r\n\t\t\tsolution: 'Use .manifest property instead',\r\n\t\t}).warn();\r\n\t\treturn this.#manifest;\r\n\t}\r\n\r\n\tpublic setTreeItem(treeItem: TreeItemType | undefined) {\r\n\t\tif (!treeItem) {\r\n\t\t\tthis._treeItem.setValue(undefined);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Only check for undefined. The tree root has null as unique\r\n\t\tif (treeItem.unique === undefined) throw new Error('Could not create tree item context, unique is missing');\r\n\t\tthis.unique = treeItem.unique;\r\n\r\n\t\tif (!treeItem.entityType) throw new Error('Could not create tree item context, tree item type is missing');\r\n\t\tthis.entityType = treeItem.entityType;\r\n\r\n\t\tconst hasChildren = treeItem.hasChildren || false;\r\n\t\tthis.#hasChildren.setValue(hasChildren);\r\n\t\tthis.#hasChildrenContext.setHasChildren(hasChildren);\r\n\r\n\t\tconst parentEntity: UmbEntityModel | undefined = treeItem.parent\r\n\t\t\t? {\r\n\t\t\t\t\tentityType: treeItem.parent.entityType,\r\n\t\t\t\t\tunique: treeItem.parent.unique,\r\n\t\t\t\t}\r\n\t\t\t: undefined;\r\n\t\tthis.#parentContext.setParent(parentEntity);\r\n\t\tthis._treeItem.setValue(treeItem);\r\n\r\n\t\t// Update observers:\r\n\t\tthis.#observeActions();\r\n\t\tthis.#observeIsSelectable();\r\n\t\tthis.#observeIsSelected();\r\n\t\tthis.#observeSectionPath();\r\n\t}\r\n\r\n\t/**\r\n\t * Load children of the tree item\r\n\t * @memberof UmbTreeItemContextBase\r\n\t */\r\n\tpublic loadChildren = () => this.#loadChildren();\r\n\r\n\t/**\r\n\t * Load more children of the tree item\r\n\t * @memberof UmbTreeItemContextBase\r\n\t */\r\n\tpublic loadMore = () => this.#loadChildren(true);\r\n\r\n\tasync #loadChildren(loadMore = false) {\r\n\t\tif (this.unique === undefined) throw new Error('Could not request children, unique key is missing');\r\n\t\tif (this.entityType === undefined) throw new Error('Could not request children, entity type is missing');\r\n\r\n\t\t// TODO: wait for tree context to be ready\r\n\t\tconst repository = this.treeContext?.getRepository();\r\n\t\tif (!repository) throw new Error('Could not request children, repository is missing');\r\n\r\n\t\tthis.#isLoading.setValue(true);\r\n\r\n\t\tconst skip = loadMore ? this.#paging.skip : 0;\r\n\t\tconst take = loadMore ? this.#paging.take : this.pagination.getCurrentPageNumber() * this.#paging.take;\r\n\t\tconst foldersOnly = this.#foldersOnly.getValue();\r\n\t\tconst additionalArgs = this.treeContext?.getAdditionalRequestArgs();\r\n\r\n\t\tconst { data } = await repository.requestTreeItemsOf({\r\n\t\t\tparent: {\r\n\t\t\t\tunique: this.unique,\r\n\t\t\t\tentityType: this.entityType,\r\n\t\t\t},\r\n\t\t\tfoldersOnly,\r\n\t\t\tskip,\r\n\t\t\ttake,\r\n\t\t\t...additionalArgs,\r\n\t\t});\r\n\r\n\t\tif (data) {\r\n\t\t\tif (loadMore) {\r\n\t\t\t\tconst currentItems = this.#childItems.getValue();\r\n\t\t\t\tthis.#childItems.setValue([...currentItems, ...data.items]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.#childItems.setValue(data.items);\r\n\t\t\t}\r\n\r\n\t\t\tconst hasChildren = data.total > 0;\r\n\t\t\tthis.#hasChildren.setValue(hasChildren);\r\n\t\t\tthis.#hasChildrenContext.setHasChildren(hasChildren);\r\n\r\n\t\t\tthis.pagination.setTotalItems(data.total);\r\n\t\t}\r\n\r\n\t\tthis.#isLoading.setValue(false);\r\n\t}\r\n\r\n\tpublic toggleContextMenu() {\r\n\t\tif (!this.getTreeItem() || !this.entityType || this.unique === undefined) {\r\n\t\t\tthrow new Error('Could not request children, tree item is not set');\r\n\t\t}\r\n\r\n\t\tthis.#sectionSidebarContext?.toggleContextMenu(this.getHostElement(), {\r\n\t\t\tentityType: this.entityType,\r\n\t\t\tunique: this.unique,\r\n\t\t\theadline: this.getTreeItem()?.name || '',\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Selects the tree item\r\n\t * @memberof UmbTreeItemContextBase\r\n\t * @returns {void}\r\n\t */\r\n\tpublic select() {\r\n\t\tif (this.unique === undefined) throw new Error('Could not select. Unique is missing');\r\n\t\tthis.treeContext?.selection.select(this.unique);\r\n\t}\r\n\r\n\t/**\r\n\t * Deselects the tree item\r\n\t * @memberof UmbTreeItemContextBase\r\n\t * @returns {void}\r\n\t */\r\n\tpublic deselect() {\r\n\t\tif (this.unique === undefined) throw new Error('Could not deselect. Unique is missing');\r\n\t\tthis.treeContext?.selection.deselect(this.unique);\r\n\t}\r\n\r\n\tpublic showChildren() {\r\n\t\tconst entityType = this.entityType;\r\n\t\tconst unique = this.unique;\r\n\r\n\t\tif (!entityType) {\r\n\t\t\tthrow new Error('Could not show children, entity type is missing');\r\n\t\t}\r\n\r\n\t\tif (unique === undefined) {\r\n\t\t\tthrow new Error('Could not show children, unique is missing');\r\n\t\t}\r\n\r\n\t\t// It is the tree that keeps track of the open children. We tell the tree to open this child\r\n\t\tthis.treeContext?.expansion.expandItem({ entityType, unique });\r\n\t}\r\n\r\n\tpublic hideChildren() {\r\n\t\tconst entityType = this.entityType;\r\n\t\tconst unique = this.unique;\r\n\r\n\t\tif (!entityType) {\r\n\t\t\tthrow new Error('Could not show children, entity type is missing');\r\n\t\t}\r\n\r\n\t\tif (unique === undefined) {\r\n\t\t\tthrow new Error('Could not show children, unique is missing');\r\n\t\t}\r\n\r\n\t\tthis.treeContext?.expansion.collapseItem({ entityType, unique });\r\n\t}\r\n\r\n\tasync #consumeContexts() {\r\n\t\tthis.consumeContext(UMB_SECTION_CONTEXT, (instance) => {\r\n\t\t\tthis.#sectionContext = instance;\r\n\t\t\tthis.#observeSectionPath();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_SECTION_SIDEBAR_CONTEXT, (instance) => {\r\n\t\t\tthis.#sectionSidebarContext = instance;\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_TREE_CONTEXT, (treeContext) => {\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t\t// @ts-ignore\r\n\t\t\tthis.treeContext = treeContext;\r\n\t\t\tthis.#observeIsSelectable();\r\n\t\t\tthis.#observeIsSelected();\r\n\t\t\tthis.#observeFoldersOnly();\r\n\t\t\tthis.#observeExpansion();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_TREE_ITEM_CONTEXT, (instance) => {\r\n\t\t\tthis.parentTreeItemContext = instance;\r\n\t\t}).skipHost();\r\n\r\n\t\tthis.consumeContext(UMB_ACTION_EVENT_CONTEXT, (instance) => {\r\n\t\t\tthis.#removeEventListeners();\r\n\t\t\tthis.#actionEventContext = instance;\r\n\r\n\t\t\tthis.#actionEventContext?.addEventListener(\r\n\t\t\t\tUmbRequestReloadTreeItemChildrenEvent.TYPE,\r\n\t\t\t\tthis.#onReloadRequest as EventListener,\r\n\t\t\t);\r\n\r\n\t\t\tthis.#actionEventContext?.addEventListener(\r\n\t\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadRequest as EventListener,\r\n\t\t\t);\r\n\r\n\t\t\tthis.#actionEventContext?.addEventListener(\r\n\t\t\t\tUmbRequestReloadStructureForEntityEvent.TYPE,\r\n\t\t\t\tthis.#onReloadStructureRequest as unknown as EventListener,\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tgetTreeItem() {\r\n\t\treturn this._treeItem.getValue();\r\n\t}\r\n\r\n\t#observeIsSelectable() {\r\n\t\tif (!this.treeContext) return;\r\n\t\tthis.observe(\r\n\t\t\tthis.treeContext.selection.selectable,\r\n\t\t\t(value) => {\r\n\t\t\t\tthis.#isSelectableContext.setValue(value);\r\n\r\n\t\t\t\t// If the tree is selectable, check if this item is selectable\r\n\t\t\t\tif (value === true) {\r\n\t\t\t\t\tconst isSelectable = this.treeContext?.selectableFilter?.(this.getTreeItem()!) ?? true;\r\n\t\t\t\t\tthis.#isSelectable.setValue(isSelectable);\r\n\t\t\t\t\tthis.#checkIsActive();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeIsSelectable',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeIsSelected() {\r\n\t\tif (!this.treeContext || !this.unique) return;\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.treeContext.selection.selection.pipe(map((selection) => selection.includes(this.unique!))),\r\n\t\t\t(isSelected) => {\r\n\t\t\t\tthis.#isSelected.setValue(isSelected);\r\n\t\t\t},\r\n\t\t\t'observeIsSelected',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeFoldersOnly() {\r\n\t\tif (this.unique === undefined) return;\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.treeContext?.foldersOnly,\r\n\t\t\t(foldersOnly) => {\r\n\t\t\t\tthis.#foldersOnly.setValue(foldersOnly ?? false);\r\n\t\t\t},\r\n\t\t\t'observeFoldersOnly',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeSectionPath() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#sectionContext?.pathname,\r\n\t\t\t(pathname) => {\r\n\t\t\t\tif (!pathname || !this.entityType || this.unique === undefined) return;\r\n\t\t\t\tconst path = this.constructPath(pathname, this.entityType, this.unique);\r\n\t\t\t\tthis.#path.setValue(path);\r\n\t\t\t\tthis.#checkIsActive();\r\n\t\t\t},\r\n\t\t\t'observeSectionPath',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeActions() {\r\n\t\tthis.observe(\r\n\t\t\tumbExtensionsRegistry\r\n\t\t\t\t.byType('entityAction')\r\n\t\t\t\t.pipe(map((actions) => actions.filter((action) => action.forEntityTypes.includes(this.entityType!)))),\r\n\t\t\t(actions) => {\r\n\t\t\t\tthis.#hasActions.setValue(actions.length > 0);\r\n\t\t\t},\r\n\t\t\t'observeActions',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeExpansion() {\r\n\t\tif (this.unique === undefined) return;\r\n\t\tif (!this.entityType) return;\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.treeContext?.expansion.isExpanded({ entityType: this.entityType, unique: this.unique }),\r\n\t\t\t(isExpanded) => {\r\n\t\t\t\t// If this item has children, load them\r\n\t\t\t\tif (isExpanded && this.#hasChildren.getValue() && this.#isOpen.getValue() === false) {\r\n\t\t\t\t\tthis.loadChildren();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.#isOpen.setValue(isExpanded ?? false);\r\n\t\t\t},\r\n\t\t\t'observeExpansion',\r\n\t\t);\r\n\t}\r\n\r\n\t#onReloadRequest = (event: UmbEntityActionEvent) => {\r\n\t\tif (event.getUnique() !== this.unique) return;\r\n\t\tif (event.getEntityType() !== this.entityType) return;\r\n\t\tthis.loadChildren();\r\n\t};\r\n\r\n\t#onReloadStructureRequest = async (event: UmbRequestReloadStructureForEntityEvent) => {\r\n\t\tif (!this.unique) return;\r\n\t\tif (event.getUnique() !== this.unique) return;\r\n\t\tif (event.getEntityType() !== this.entityType) return;\r\n\r\n\t\tif (this.parentTreeItemContext) {\r\n\t\t\tthis.parentTreeItemContext.loadChildren();\r\n\t\t} else {\r\n\t\t\tthis.treeContext?.loadTree();\r\n\t\t}\r\n\t};\r\n\r\n\t#onPageChange = (event: UmbChangeEvent) => {\r\n\t\tconst target = event.target as UmbPaginationManager;\r\n\t\tthis.#paging.skip = target.getSkip();\r\n\t\tthis.loadMore();\r\n\t};\r\n\r\n\t#debouncedCheckIsActive = debounce(() => this.#checkIsActive(), 100);\r\n\r\n\t#checkIsActive() {\r\n\t\t// don't set the active state if the item is selectable\r\n\t\tconst isSelectable = this.#isSelectable.getValue();\r\n\r\n\t\tif (isSelectable) {\r\n\t\t\tthis.#isActive.setValue(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t/* Check if the current location includes the path of this tree item.\r\n\t\tWe ensure that the paths ends with a slash to avoid collisions with paths like /path-1 and /path-1-2 where /path-1 is in both.\r\n\t\tInstead we compare /path-1/ with /path-1-2/ which wont collide.*/\r\n\t\tconst location = ensureSlash(window.location.pathname);\r\n\t\tconst comparePath = ensureSlash(this.#path.getValue());\r\n\t\tconst isActive = location.includes(comparePath);\r\n\t\tthis.#isActive.setValue(isActive);\r\n\t}\r\n\r\n\t// TODO: use router context\r\n\tconstructPath(pathname: string, entityType: string, unique: string | null) {\r\n\t\t// TODO: Encode uniques [NL]\r\n\t\treturn `section/${pathname}/workspace/${entityType}/edit/${unique}`;\r\n\t}\r\n\r\n\t#removeEventListeners = () => {\r\n\t\tthis.#actionEventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadTreeItemChildrenEvent.TYPE,\r\n\t\t\tthis.#onReloadRequest as EventListener,\r\n\t\t);\r\n\r\n\t\tthis.#actionEventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadChildrenOfEntityEvent.TYPE,\r\n\t\t\tthis.#onReloadRequest as EventListener,\r\n\t\t);\r\n\r\n\t\tthis.#actionEventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadStructureForEntityEvent.TYPE,\r\n\t\t\tthis.#onReloadStructureRequest as unknown as EventListener,\r\n\t\t);\r\n\t};\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#removeEventListeners();\r\n\t\twindow.removeEventListener('navigationend', this.#debouncedCheckIsActive);\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport const UMB_TREE_ITEM_CONTEXT = new UmbContextToken<UmbTreeItemContext<any>>('UmbTreeItemContext');\r\n","import type { UmbTreeItemContext } from '../index.js';\r\nimport type { UmbTreeItemModel } from '../../types.js';\r\nimport { html, ifDefined, nothing, state, repeat, property, css } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UUIMenuItemEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbEntityFlag } from '@umbraco-cms/backoffice/entity-flag';\r\n\r\nexport abstract class UmbTreeItemElementBase<\r\n\tTreeItemModelType extends UmbTreeItemModel,\r\n\tTreeItemContextType extends UmbTreeItemContext<TreeItemModelType> = UmbTreeItemContext<TreeItemModelType>,\r\n> extends UmbLitElement {\r\n\t@property({ type: Object, attribute: false })\r\n\tset item(newVal: TreeItemModelType) {\r\n\t\tthis._item = newVal;\r\n\t\tthis._extractFlags(newVal);\r\n\r\n\t\tif (this._item) {\r\n\t\t\tthis._label = this.localize.string(this._item?.name ?? '');\r\n\t\t\tthis.#initTreeItem();\r\n\t\t}\r\n\t}\r\n\tget item(): TreeItemModelType | undefined {\r\n\t\treturn this._item;\r\n\t}\r\n\tprotected _item?: TreeItemModelType;\r\n\r\n\t/**\r\n\t * @param item - The item from which to extract flags.\r\n\t * @description This method is called whenever the `item` property is set. It extracts the flags from the item and assigns them to the `_flags` state property.\r\n\t * This method is in some cases overridden in subclasses to customize how flags are extracted!\r\n\t */\r\n\tprotected _extractFlags(item: TreeItemModelType | undefined) {\r\n\t\tthis._flags = item?.flags ?? [];\r\n\t}\r\n\r\n\t@state()\r\n\tprotected _flags?: Array<UmbEntityFlag>;\r\n\r\n\t@state()\r\n\tprivate _label?: string;\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tpublic set api(value: TreeItemContextType | undefined) {\r\n\t\tthis.#api = value;\r\n\r\n\t\tif (this.#api) {\r\n\t\t\tthis.observe(this.#api.childItems, (value) => (this._childItems = value));\r\n\t\t\tthis.observe(this.#api.hasChildren, (value) => (this._hasChildren = value));\r\n\t\t\tthis.observe(this.#api.isActive, (value) => (this._isActive = value));\r\n\t\t\tthis.observe(this.#api.isOpen, (value) => (this._isOpen = value));\r\n\t\t\tthis.observe(this.#api.isLoading, (value) => (this._isLoading = value));\r\n\t\t\tthis.observe(this.#api.isSelectableContext, (value) => (this._isSelectableContext = value));\r\n\t\t\tthis.observe(this.#api.isSelectable, (value) => (this._isSelectable = value));\r\n\t\t\tthis.observe(this.#api.isSelected, (value) => (this._isSelected = value));\r\n\t\t\tthis.observe(this.#api.path, (value) => (this._href = value));\r\n\t\t\tthis.observe(this.#api.pagination.currentPage, (value) => (this._currentPage = value));\r\n\t\t\tthis.observe(this.#api.pagination.totalPages, (value) => (this._totalPages = value));\r\n\t\t\tthis.#initTreeItem();\r\n\t\t}\r\n\t}\r\n\tpublic get api(): TreeItemContextType | undefined {\r\n\t\treturn this.#api;\r\n\t}\r\n\t#api: TreeItemContextType | undefined;\r\n\r\n\t@property({ type: Boolean, attribute: false })\r\n\thideActions: boolean = false;\r\n\r\n\t@state()\r\n\tprotected _isActive = false;\r\n\r\n\t@state()\r\n\tprivate _childItems?: TreeItemModelType[];\r\n\r\n\t@state()\r\n\tprivate _href?: string;\r\n\r\n\t@state()\r\n\tprivate _isLoading = false;\r\n\r\n\t@state()\r\n\tprivate _isSelectableContext = false;\r\n\r\n\t@state()\r\n\tprivate _isSelectable = false;\r\n\r\n\t@state()\r\n\tprotected _isSelected = false;\r\n\r\n\t@state()\r\n\tprivate _hasChildren = false;\r\n\r\n\t@state()\r\n\tprivate _isOpen = false;\r\n\r\n\t@state()\r\n\tprivate _iconSlotHasChildren = false;\r\n\r\n\t@state()\r\n\tprivate _totalPages = 1;\r\n\r\n\t@state()\r\n\tprivate _currentPage = 1;\r\n\r\n\t#initTreeItem() {\r\n\t\tif (!this.#api) return;\r\n\t\tif (!this._item) return;\r\n\t\tthis.#api.setTreeItem(this._item);\r\n\t}\r\n\r\n\tprivate _handleSelectedItem(event: Event) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis.#api?.select();\r\n\t}\r\n\r\n\tprivate _handleDeselectedItem(event: Event) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis.#api?.deselect();\r\n\t}\r\n\r\n\tprivate _onShowChildren(event: UUIMenuItemEvent) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis.#api?.showChildren();\r\n\t}\r\n\r\n\tprivate _onHideChildren(event: UUIMenuItemEvent) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis.#api?.hideChildren();\r\n\t}\r\n\r\n\t#onLoadMoreClick = (event: any) => {\r\n\t\tevent.stopPropagation();\r\n\t\tconst next = (this._currentPage = this._currentPage + 1);\r\n\t\tthis.#api?.pagination.setCurrentPageNumber(next);\r\n\t};\r\n\r\n\t// Note: Currently we want to prevent opening when the item is in a selectable context, but this might change in the future.\r\n\t// If we like to be able to open items in selectable context, then we might want to make it as a menu item action, so you have to click ... and chose an action called 'Edit'\r\n\toverride render() {\r\n\t\tconst caretLabelKey = this._isOpen\r\n\t\t\t? 'visuallyHiddenTexts_collapseChildItems'\r\n\t\t\t: 'visuallyHiddenTexts_expandChildItems';\r\n\t\treturn html`\r\n\t\t\t<uui-menu-item\r\n\t\t\t\t@show-children=${this._onShowChildren}\r\n\t\t\t\t@hide-children=${this._onHideChildren}\r\n\t\t\t\t@selected=${this._handleSelectedItem}\r\n\t\t\t\t@deselected=${this._handleDeselectedItem}\r\n\t\t\t\t?active=${this._isActive}\r\n\t\t\t\t?disabled=${this._isSelectableContext && !this._isSelectable}\r\n\t\t\t\t?selectable=${this._isSelectable}\r\n\t\t\t\t?selected=${this._isSelected}\r\n\t\t\t\t.loading=${this._isLoading}\r\n\t\t\t\t.hasChildren=${this._hasChildren}\r\n\t\t\t\t.showChildren=${this._isOpen}\r\n\t\t\t\t.caretLabel=${this.localize.term(caretLabelKey) + ' ' + this._label}\r\n\t\t\t\tlabel=${ifDefined(this._label)}\r\n\t\t\t\thref=${ifDefined(this._isSelectableContext ? undefined : this._href)}>\r\n\t\t\t\t${this.renderIconContainer()} ${this.renderLabel()} ${this.#renderActions()} ${this.#renderChildItems()}\r\n\t\t\t\t<slot></slot>\r\n\t\t\t\t${this.#renderPaging()}\r\n\t\t\t</uui-menu-item>\r\n\t\t`;\r\n\t}\r\n\r\n\t#hasNodes = (e: Event) => {\r\n\t\treturn (e.target as HTMLSlotElement).assignedNodes({ flatten: true }).length > 0;\r\n\t};\r\n\r\n\trenderIconContainer() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"icon-container\" slot=\"icon\">\r\n\t\t\t\t<slot\r\n\t\t\t\t\tname=\"icon\"\r\n\t\t\t\t\t@slotchange=${(e: Event) => {\r\n\t\t\t\t\t\tthis._iconSlotHasChildren = this.#hasNodes(e);\r\n\t\t\t\t\t}}></slot>\r\n\t\t\t\t${this.#renderSigns()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderSigns() {\r\n\t\treturn this._item\r\n\t\t\t? html`<umb-entity-sign-bundle .entityType=${this._item!.entityType} .entityFlags=${this._flags}\r\n\t\t\t\t\t>${!this._iconSlotHasChildren ? this.#renderIcon() : nothing}</umb-entity-sign-bundle\r\n\t\t\t\t>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderIcon() {\r\n\t\tconst iconName = this._getIconName();\r\n\t\tconst isFolder = this._item?.isFolder;\r\n\r\n\t\tif (iconName) {\r\n\t\t\treturn html`<umb-icon name=\"${this._getIconToRender(iconName)}\"></umb-icon>`;\r\n\t\t}\r\n\r\n\t\tif (isFolder) {\r\n\t\t\treturn html`<umb-icon name=\"icon-folder\"></umb-icon>`;\r\n\t\t}\r\n\r\n\t\treturn html`<umb-icon name=\"icon-circle-dotted\"></umb-icon>`;\r\n\t}\r\n\r\n\tprotected _getIconToRender(icon: string) {\r\n\t\tconst iconWithoutColor = icon.split(' ')[0];\r\n\t\treturn this._isActive || this._isSelected ? iconWithoutColor : icon;\r\n\t}\r\n\r\n\tprotected _getIconName(): string | null | undefined {\r\n\t\treturn this._item?.icon;\r\n\t}\r\n\r\n\trenderLabel() {\r\n\t\treturn html`<slot name=\"label\" slot=\"label\"></slot>`;\r\n\t}\r\n\r\n\t#renderActions() {\r\n\t\tif (this.hideActions) return nothing;\r\n\t\tif (!this.#api || !this._item) return nothing;\r\n\t\treturn html`\r\n\t\t\t<umb-entity-actions-bundle\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\t.entityType=${this.#api.entityType}\r\n\t\t\t\t.unique=${this.#api.unique}\r\n\t\t\t\t.label=${this._label}>\r\n\t\t\t</umb-entity-actions-bundle>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderChildItems() {\r\n\t\treturn html`\r\n\t\t\t${this._childItems\r\n\t\t\t\t? repeat(\r\n\t\t\t\t\t\tthis._childItems,\r\n\t\t\t\t\t\t(item, index) => item.name + '___' + index,\r\n\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t<umb-tree-item\r\n\t\t\t\t\t\t\t\t.entityType=${item.entityType}\r\n\t\t\t\t\t\t\t\t.props=${{ hideActions: this.hideActions, item }}></umb-tree-item>\r\n\t\t\t\t\t\t`,\r\n\t\t\t\t\t)\r\n\t\t\t\t: ''}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderPaging() {\r\n\t\tif (this._totalPages <= 1 || this._currentPage === this._totalPages) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\treturn html` <umb-tree-load-more-button @click=${this.#onLoadMoreClick}></umb-tree-load-more-button> `;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#icon-container {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tfont-size: 15px;\r\n\t\t\t}\r\n\r\n\t\t\tuui-menu-item {\r\n\t\t\t\t--umb-sign-bundle-bg: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\tuui-menu-item:hover {\r\n\t\t\t\t--umb-sign-bundle-bg: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\tuui-menu-item[active],\r\n\t\t\tuui-menu-item[selected] {\r\n\t\t\t\t--umb-sign-bundle-bg: var(--uui-color-current);\r\n\t\t\t}\r\n\r\n\t\t\tuui-menu-item[selected]:hover,\r\n\t\t\tuui-menu-item[active]:hover {\r\n\t\t\t\t--umb-sign-bundle-bg: var(--uui-color-current-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t#label {\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n"],"names":["UmbRequestReloadTreeItemChildrenEvent","UmbEntityActionEvent","args","UmbTreeItemContextBase","UmbContextBase","host","UMB_TREE_ITEM_CONTEXT","UmbPaginationManager","UmbObjectState","#childItems","UmbArrayState","x","#hasChildren","UmbBooleanState","#isLoading","#isSelectable","#isSelectableContext","#isSelected","#isActive","#hasActions","#path","UmbStringState","#isOpen","#foldersOnly","#hasChildrenContext","UmbHasChildrenEntityContext","#parentContext","UmbParentEntityContext","#paging","#loadChildren","#onReloadRequest","event","#onReloadStructureRequest","#onPageChange","target","#debouncedCheckIsActive","debounce","#checkIsActive","#removeEventListeners","#actionEventContext","UmbRequestReloadChildrenOfEntityEvent","UmbRequestReloadStructureForEntityEvent","#consumeContexts","UmbChangeEvent","#manifest","#sectionContext","#sectionSidebarContext","manifest","UmbDeprecation","treeItem","hasChildren","parentEntity","#observeActions","#observeIsSelectable","#observeIsSelected","#observeSectionPath","loadMore","repository","skip","take","foldersOnly","additionalArgs","data","currentItems","entityType","unique","UMB_SECTION_CONTEXT","instance","UMB_SECTION_SIDEBAR_CONTEXT","UMB_TREE_CONTEXT","treeContext","#observeFoldersOnly","#observeExpansion","UMB_ACTION_EVENT_CONTEXT","value","isSelectable","map","selection","isSelected","pathname","path","umbExtensionsRegistry","actions","action","isExpanded","location","ensureSlash","comparePath","isActive","UmbContextToken","UmbTreeItemElementBase","UmbLitElement","#onLoadMoreClick","next","#api","#hasNodes","newVal","#initTreeItem","item","caretLabelKey","html","ifDefined","#renderActions","#renderChildItems","#renderPaging","#renderSigns","nothing","#renderIcon","iconName","isFolder","icon","iconWithoutColor","repeat","index","UmbTextStyles","css","__decorateClass","property","state"],"mappings":"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"}