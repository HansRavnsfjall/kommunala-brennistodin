{"version":3,"file":"index.js","sources":["../../../../src/packages/core/view/context/view.context-token.ts","../../../../src/packages/core/view/context/view.controller.ts","../../../../src/packages/core/view/context/view.context.ts"],"sourcesContent":["import type { UmbViewContext } from './view.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_VIEW_CONTEXT = new UmbContextToken<UmbViewContext>('UmbViewContext');\r\n","import { UmbShortcutController } from '../../shortcut/context/shortcut.controller.js';\r\nimport { UMB_VIEW_CONTEXT } from './view.context-token.js';\r\nimport { UmbClassState, UmbStringState, mergeObservables } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbHintController } from '@umbraco-cms/backoffice/hint';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\nimport type { UmbClassInterface } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbContextConsumerController, UmbContextProviderController } from '@umbraco-cms/backoffice/context-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbVariantHint } from '@umbraco-cms/backoffice/hint';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\n/**\r\n *\r\n * The View Context handles the aspects of three Features:\r\n * Browser Titles — Provide a title for this view and it will be set or joint with parent views depending on the inheritance setting.\r\n * Hints — Holds Hints for this view, depending on the inheritance setting it will propagate the hints to be displayed at parent views.\r\n * Shortcuts — Not implemented yet.\r\n *\r\n */\r\nexport class UmbViewController extends UmbControllerBase {\r\n\t//\r\n\tstatic #ActiveView?: UmbViewController;\r\n\t//\r\n\t#attached = false;\r\n\t#providerCtrl?: UmbContextProviderController;\r\n\t#consumeParentCtrl?: UmbContextConsumerController<typeof UMB_VIEW_CONTEXT.TYPE>;\r\n\t#currentProvideHost?: UmbClassInterface;\r\n\t#localize = new UmbLocalizationController(this);\r\n\r\n\t// State used to know if the context can be auto activated when attached.\r\n\t#autoActivate = true;\r\n\t#active = false;\r\n\tget isActive() {\r\n\t\treturn this.#active;\r\n\t}\r\n\t#setActive() {\r\n\t\tthis.#active = true;\r\n\t\tif (this.#inherit) {\r\n\t\t\t// Secure the parent in the inheritance chain is active.\r\n\t\t\tthis.#parentView?._internal_activate();\r\n\t\t} else {\r\n\t\t\t// This is for a single, or top level of the inheritance chain, so we can disable the previous active view.\r\n\t\t\tif (UmbViewController.#ActiveView && UmbViewController.#ActiveView !== this) {\r\n\t\t\t\tUmbViewController.#ActiveView._internal_deactivate();\r\n\t\t\t\tUmbViewController.#ActiveView = undefined;\r\n\t\t\t}\r\n\t\t\tUmbViewController.#ActiveView = this;\r\n\t\t}\r\n\t}\r\n\t#removeActive() {\r\n\t\tthis.#active = false;\r\n\t\tif (!this.#inherit) {\r\n\t\t\tif (UmbViewController.#ActiveView === this) {\r\n\t\t\t\tUmbViewController.#ActiveView = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#inherit = false;\r\n\t#explicitInheritance?: boolean;\r\n\t#parentView?: UmbViewController;\r\n\t#title?: string;\r\n\t#computedTitle = new UmbStringState(undefined);\r\n\treadonly computedTitle = this.#computedTitle.asObservable();\r\n\r\n\tpublic readonly viewAlias: string | null;\r\n\r\n\t#variantId = new UmbClassState<UmbVariantId | undefined>(undefined);\r\n\tprotected readonly variantId = this.#variantId.asObservable();\r\n\r\n\tpublic readonly hints;\r\n\r\n\tpublic readonly shortcuts = new UmbShortcutController(this);\r\n\r\n\tpublic readonly firstHintOfVariant;\r\n\r\n\tconstructor(host: UmbControllerHost, viewAlias: string | null) {\r\n\t\tsuper(host);\r\n\t\tthis.viewAlias = viewAlias;\r\n\t\tthis.hints = new UmbHintController<UmbVariantHint>(this, {\r\n\t\t\tviewAlias: viewAlias,\r\n\t\t});\r\n\t\tthis.firstHintOfVariant = mergeObservables([this.variantId, this.hints.hints], ([variantId, hints]) => {\r\n\t\t\t// Notice, because we in UI have invariant fields on Variants, then we will accept invariant hints on variants.\r\n\t\t\tif (variantId) {\r\n\t\t\t\treturn hints.find((hint) =>\r\n\t\t\t\t\thint.variantId ? hint.variantId.equal(variantId!) || hint.variantId.isInvariant() : true,\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\treturn hints[0];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.#consumeParentCtrl = this.consumeContext(UMB_VIEW_CONTEXT, (parentView) => {\r\n\t\t\t// In case of explicit inheritance we do not want to overview the parent view.\r\n\t\t\tif (this.#explicitInheritance) return;\r\n\t\t\tif (parentView) {\r\n\t\t\t\tthis.#setParentView(parentView);\r\n\t\t\t}\r\n\t\t\t// only activate if we had an incoming parentView, cause if not we are in a disassembling state. [NL]\r\n\t\t\tif (parentView && this.#attached && this.#autoActivate) {\r\n\t\t\t\tthis._internal_requestActivate();\r\n\t\t\t}\r\n\t\t}).skipHost();\r\n\t}\r\n\r\n\t#setParentView(view: UmbViewController | undefined) {\r\n\t\tif (this.#parentView === view) return;\r\n\t\tthis.#parentView = view;\r\n\r\n\t\tif (this.#inherit) {\r\n\t\t\tthis.#inheritFromParent();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic setVariantId(variantId: UmbVariantId | undefined): void {\r\n\t\tthis.#variantId.setValue(variantId);\r\n\t\tthis.hints.updateScaffold({ variantId: variantId });\r\n\t}\r\n\r\n\tpublic setTitle(title: string | undefined): void {\r\n\t\tif (this.#title === title) return;\r\n\t\tthis.#title = title;\r\n\t\tthis.#computeTitle();\r\n\t\tthis.#updateTitle();\r\n\t}\r\n\r\n\tpublic provideAt(controllerHost: UmbClassInterface): void {\r\n\t\tif (this.#currentProvideHost === controllerHost) return;\r\n\r\n\t\tthis.unprovide();\r\n\r\n\t\tthis.#autoActivate = true;\r\n\t\tthis.#currentProvideHost = controllerHost;\r\n\t\tthis.#providerCtrl = controllerHost.provideContext(UMB_VIEW_CONTEXT, this);\r\n\t\tthis.hints.provideAt(controllerHost);\r\n\t\tthis.shortcuts.provideAt(controllerHost);\r\n\r\n\t\tif (this.#attached) {\r\n\t\t\tthis._internal_requestActivate();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic unprovide(): void {\r\n\t\tif (this.#providerCtrl) {\r\n\t\t\tthis.#providerCtrl.destroy();\r\n\t\t\tthis.#providerCtrl = undefined;\r\n\t\t}\r\n\t\tthis.hints.unprovide();\r\n\t\tthis.shortcuts.unprovide();\r\n\r\n\t\tthis._internal_deactivate();\r\n\t\tthis.#requestActivateParent();\r\n\t}\r\n\r\n\toverride hostConnected(): void {\r\n\t\tconst wasActive = this.isActive;\r\n\t\tconst wasAttached = this.#attached;\r\n\t\tthis.#attached = true;\r\n\t\tsuper.hostConnected();\r\n\t\tif (!wasAttached) {\r\n\t\t\tthis.#parentView?._internal_addChild(this);\r\n\t\t}\r\n\t\t// Check that we have a providerController, otherwise this is not provided. [NL]\r\n\t\tif (this.#autoActivate && !wasActive) {\r\n\t\t\tthis._internal_requestActivate();\r\n\t\t}\r\n\t}\r\n\r\n\toverride hostDisconnected(): void {\r\n\t\tconst wasAttached = this.#attached;\r\n\t\tthis.#attached = false;\r\n\t\tif (wasAttached) {\r\n\t\t\tthis.#parentView?._internal_removeChild(this);\r\n\t\t}\r\n\r\n\t\tthis._internal_deactivate();\r\n\t\tsuper.hostDisconnected();\r\n\t\tthis.#autoActivate = true;\r\n\t\tthis.#requestActivateParent();\r\n\t}\r\n\r\n\tpublic isInheriting() {\r\n\t\treturn this.#inherit;\r\n\t}\r\n\r\n\tpublic inherit() {\r\n\t\tthis.#inherit = true;\r\n\t}\r\n\r\n\tpublic inheritFrom(context?: UmbViewController): void {\r\n\t\tthis.#inherit = true;\r\n\t\tthis.#explicitInheritance = true;\r\n\t\tthis.#consumeParentCtrl?.destroy();\r\n\t\tthis.#consumeParentCtrl = undefined;\r\n\t\tthis.#setParentView(context);\r\n\t}\r\n\r\n\t#inheritFromParent(): void {\r\n\t\tthis.observe(\r\n\t\t\tthis.#parentView?.variantId,\r\n\t\t\t(variantId) => {\r\n\t\t\t\tthis.setVariantId(variantId);\r\n\t\t\t},\r\n\t\t\t'observeParentVariantId',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#parentView?.computedTitle,\r\n\t\t\t() => {\r\n\t\t\t\tthis.#computeTitle();\r\n\t\t\t\t// Check for parent view as it is undefined in a disassembling state and we do not want to update the title in that situation. [NL]\r\n\t\t\t\tif (this.#providerCtrl && this.#parentView && this.isActive) {\r\n\t\t\t\t\tthis.#updateTitle();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeParentTitle',\r\n\t\t);\r\n\t\tthis.hints.inheritFrom(this.#parentView?.hints);\r\n\t}\r\n\r\n\t#requestActivateParent() {\r\n\t\tif (!this.#inherit) {\r\n\t\t\tif (this.#parentView) {\r\n\t\t\t\tthis.#parentView._internal_requestActivate();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * Notify that a view context has been activated.\r\n\t */\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _internal_requestActivate(): boolean {\r\n\t\tif (!this.#providerCtrl) {\r\n\t\t\t// If we are not provided we should not be activated. [NL]\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// TODO: Check this one: We do not want a parent to auto activate if a child is having the activation. [NL], well maybe it not that bad because of the asking of the children...\r\n\t\tthis.#autoActivate = true;\r\n\t\tif (this.isActive) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t// If not attached then propagate the activation to the parent. [NL]\r\n\t\tif (this.#attached === false) {\r\n\t\t\tif (!this.#parentView) {\r\n\t\t\t\tthrow new Error('Cannot activate a view that is not attached to the DOM.');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Check if any of the children likes to be activated instead:\r\n\t\t\t// A reverse loop ensures latest added child gets first chance to activate. This may matter in some future issue-scenario, I will say it could be that it is not the right way to determine if multiple children wants to be active. [NL]\r\n\t\t\tlet i = this.#children.length;\r\n\t\t\twhile (i--) {\r\n\t\t\t\tconst child = this.#children[i];\r\n\t\t\t\tif (child._internal_requestActivate()) {\r\n\t\t\t\t\t// If we have an active child we should not update the title.\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// if not then check your self:\r\n\t\t\tif (this.#autoActivate && this.#attached) {\r\n\t\t\t\tthis._internal_activate();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * Notify that a view context has been activated.\r\n\t */\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _internal_activate() {\r\n\t\tif (this.#attached) {\r\n\t\t\tthis.#autoActivate = true;\r\n\t\t\tthis.#setActive();\r\n\t\t\tthis.#updateTitle();\r\n\t\t\tthis.shortcuts.activate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * Deactivate the view context.\r\n\t * We cannot conclude that this means the parent should be activated, it can be because of a child being activated.\r\n\t */\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _internal_deactivate() {\r\n\t\tif (!this.isActive) return;\r\n\t\tthis.#autoActivate = false;\r\n\r\n\t\t// Deactive children:\r\n\t\tthis.#children.forEach((child) => {\r\n\t\t\tif (child.isInheriting()) {\r\n\t\t\t\tchild._internal_deactivate();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.shortcuts.deactivate();\r\n\t\tthis.#removeActive();\r\n\t}\r\n\r\n\t#updateTitle() {\r\n\t\tif (!this.#active || this.#hasActiveChildren()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst localTitle = this.getComputedTitle();\r\n\t\tdocument.title = (localTitle ? localTitle + ' | ' : '') + 'Umbraco';\r\n\t}\r\n\r\n\t#computeTitle() {\r\n\t\tconst titles = [];\r\n\t\tif (this.#inherit && this.#parentView) {\r\n\t\t\ttitles.push(this.#parentView.getComputedTitle());\r\n\t\t}\r\n\t\tif (this.#title) {\r\n\t\t\ttitles.push(this.#localize.string(this.#title));\r\n\t\t}\r\n\t\tthis.#computedTitle.setValue(titles.length > 0 ? titles.join(' | ') : undefined);\r\n\t}\r\n\r\n\tpublic getComputedTitle(): string | undefined {\r\n\t\treturn this.#computedTitle.getValue();\r\n\t}\r\n\r\n\t#children: UmbViewController[] = [];\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _internal_addChild(child: UmbViewController) {\r\n\t\tthis.#children.push(child);\r\n\t\tif (this.isActive) {\r\n\t\t\tchild._internal_activate();\r\n\t\t}\r\n\t}\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic _internal_removeChild(child: UmbViewController) {\r\n\t\tconst index = this.#children.indexOf(child);\r\n\t\tif (index !== -1) {\r\n\t\t\tthis.#children.splice(index, 1);\r\n\t\t}\r\n\t\t// update title?\r\n\t\tif (this.#active && !this.#hasActiveChildren()) {\r\n\t\t\tthis.#updateTitle();\r\n\t\t}\r\n\t}\r\n\t#hasActiveChildren() {\r\n\t\treturn this.#children.some((child) => child.isActive);\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#inherit = false;\r\n\t\tthis.#removeActive();\r\n\t\tthis.#autoActivate = false;\r\n\t\t(this as any).provideAt = undefined;\r\n\t\tthis.unprovide();\r\n\t\tsuper.destroy();\r\n\t\tthis.#consumeParentCtrl = undefined;\r\n\t}\r\n}\r\n","import { UmbViewController } from './view.controller.js';\r\nimport type { UmbClassInterface } from '@umbraco-cms/backoffice/class-api';\r\n\r\nexport class UmbViewContext extends UmbViewController {\r\n\tconstructor(host: UmbClassInterface, viewAlias: string | null) {\r\n\t\tsuper(host, viewAlias);\r\n\t\tthis.provideAt(host);\r\n\t}\r\n}\r\n"],"names":["UMB_VIEW_CONTEXT","UmbContextToken","UmbViewController","UmbControllerBase","host","viewAlias","#attached","#localize","UmbLocalizationController","#autoActivate","#active","#inherit","#computedTitle","UmbStringState","#variantId","UmbClassState","UmbShortcutController","#children","UmbHintController","mergeObservables","variantId","hints","hint","#consumeParentCtrl","parentView","#explicitInheritance","#setParentView","#ActiveView","#providerCtrl","#currentProvideHost","#setActive","#parentView","#removeActive","#title","view","#inheritFromParent","title","#computeTitle","#updateTitle","controllerHost","#requestActivateParent","wasActive","wasAttached","context","i","child","#hasActiveChildren","localTitle","titles","index","UmbViewContext"],"mappings":"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"}