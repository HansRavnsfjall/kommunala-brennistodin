{"version":3,"file":"index.js","sources":["../../../../src/packages/core/workspace/components/workspace-action-menu-item/workspace-action-menu-item-base.controller.ts","../../../../src/packages/core/workspace/components/workspace-action/workspace-action-base.controller.ts","../../../../src/packages/core/workspace/components/workspace-action/common/save/save.action.ts","../../../../src/packages/core/workspace/components/workspace-action/common/submit/submit.action.ts","../../../../src/packages/core/workspace/components/workspace-editor/workspace-view.context.ts","../../../../src/packages/core/workspace/components/workspace-editor/workspace-editor.context-token.ts","../../../../src/packages/core/workspace/components/workspace-editor/workspace-editor.context.ts","../../../../src/packages/core/workspace/components/workspace-editor/workspace-editor.element.ts","../../../../src/packages/core/workspace/components/workspace-editor/workspace-view.context-token.ts","../../../../src/packages/core/workspace/components/workspace-entity-action-menu/workspace-entity-action-menu.element.ts","../../../../src/packages/core/workspace/components/workspace-footer/workspace-footer.element.ts","../../../../src/packages/core/workspace/namable/namable-workspace.context-token.ts","../../../../src/packages/core/workspace/namable/name-write-guard.manager.ts","../../../../src/packages/core/workspace/components/workspace-header-name-editable/workspace-header-name-editable.element.ts","../../../../src/packages/core/workspace/components/workspace-split-view/workspace-split-view.context.ts","../../../../src/packages/core/workspace/components/workspace-split-view/workspace-split-view-variant-selector.element.ts","../../../../src/packages/core/workspace/components/workspace-split-view/workspace-split-view.element.ts","../../../../src/packages/core/workspace/entity-detail/global-components/entity-detail-forbidden.element.ts","../../../../src/packages/core/workspace/entity-detail/global-components/entity-detail-not-found.element.ts","../../../../src/packages/core/workspace/entity-detail/entity-detail-workspace.context-token.ts","../../../../src/packages/core/workspace/entity-detail/global-components/entity-detail-workspace-editor.element.ts","../../../../src/packages/core/workspace/controllers/workspace-route-manager.controller.ts","../../../../src/packages/core/workspace/submittable/submittable-workspace-context-base.ts","../../../../src/packages/core/workspace/entity/entity-workspace-data-manager.ts","../../../../src/packages/core/workspace/entity-detail/entity-detail-workspace-base.ts","../../../../src/packages/core/workspace/entity-detail/entity-named-detail-workspace.context-token.ts","../../../../src/packages/core/workspace/entity-detail/entity-named-detail-workspace-base.ts","../../../../src/packages/core/workspace/controllers/workspace-is-new-redirect.controller.ts","../../../../src/packages/core/workspace/controllers/workspace-split-view-manager.controller.ts","../../../../src/packages/core/workspace/info-app/global-components/workspace-info-app-layout.element.ts","../../../../src/packages/core/workspace/modals/workspace-modal.token.ts","../../../../src/packages/core/workspace/utils/object-to-property-value-array.function.ts","../../../../src/packages/core/workspace/workspace-property-dataset/invariant-workspace-property-dataset-context.ts"],"sourcesContent":["import type { UmbWorkspaceActionMenuItemArgs } from './types.js';\r\nimport type { UmbWorkspaceActionMenuItem } from './workspace-action-menu-item.interface.js';\r\nimport { UmbActionBase } from '@umbraco-cms/backoffice/action';\r\n\r\n/**\r\n * Base class for an workspace action.\r\n * @abstract\r\n * @class UmbWorkspaceActionMenuItemBase\r\n * @augments {UmbActionBase}\r\n * @implements {UmbWorkspaceActionMenuItem}\r\n * @template RepositoryType\r\n */\r\nexport abstract class UmbWorkspaceActionMenuItemBase<ArgsMetaType = never>\r\n\textends UmbActionBase<UmbWorkspaceActionMenuItemArgs<ArgsMetaType>>\r\n\timplements UmbWorkspaceActionMenuItem<ArgsMetaType>\r\n{\r\n\t/**\r\n\t * By specifying the href, the action will act as a link.\r\n\t * The `execute` method will not be called.\r\n\t * @abstract\r\n\t * @returns {string | undefined}\r\n\t */\r\n\tpublic getHref(): Promise<string | undefined> {\r\n\t\treturn Promise.resolve(undefined);\r\n\t}\r\n\r\n\t/**\r\n\t * By specifying the `execute` method, the action will act as a button.\r\n\t * @abstract\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic execute(): Promise<void> {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n}\r\n","import type { UmbWorkspaceActionArgs } from './types.js';\r\nimport type { UmbWorkspaceAction } from './workspace-action.interface.js';\r\nimport { UmbBooleanState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbActionBase } from '@umbraco-cms/backoffice/action';\r\n\r\n/**\r\n * Base class for an workspace action.\r\n * @abstract\r\n * @class UmbWorkspaceActionBase\r\n * @augments {UmbActionBase}\r\n * @implements {UmbEntityAction}\r\n * @template RepositoryType\r\n */\r\nexport abstract class UmbWorkspaceActionBase<ArgsMetaType = never>\r\n\textends UmbActionBase<UmbWorkspaceActionArgs<ArgsMetaType>>\r\n\timplements UmbWorkspaceAction<ArgsMetaType>\r\n{\r\n\tprotected _isDisabled = new UmbBooleanState(false);\r\n\tpublic isDisabled = this._isDisabled.asObservable();\r\n\r\n\t/**\r\n\t * By specifying the href, the action will act as a link.\r\n\t * The `execute` method will not be called.\r\n\t * @abstract\r\n\t * @returns {string | undefined}\r\n\t */\r\n\tpublic getHref(): Promise<string | undefined> {\r\n\t\treturn Promise.resolve(undefined);\r\n\t}\r\n\r\n\t/**\r\n\t * By specifying the `execute` method, the action will act as a button.\r\n\t * @abstract\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tpublic execute(): Promise<void> {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\r\n\t/**\r\n\t * Disables the action.\r\n\t * @memberof UmbWorkspaceActionBase\r\n\t */\r\n\tpublic disable(): void {\r\n\t\tthis._isDisabled.setValue(true);\r\n\t}\r\n\r\n\t/**\r\n\t * Enables the action.\r\n\t * @memberof UmbWorkspaceActionBase\r\n\t */\r\n\tpublic enable(): void {\r\n\t\tthis._isDisabled.setValue(false);\r\n\t}\r\n}\r\n","import type { MetaWorkspaceAction } from '../../../../types.js';\r\nimport { UMB_SAVEABLE_WORKSPACE_CONTEXT } from '../../../../contexts/tokens/index.js';\r\nimport type { UmbSaveableWorkspaceContext } from '../../../../contexts/tokens/index.js';\r\nimport { UmbWorkspaceActionBase } from '../../workspace-action-base.controller.js';\r\nimport type { UmbSaveWorkspaceActionArgs } from './types.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbSaveWorkspaceAction<\r\n\tArgsMetaType extends MetaWorkspaceAction = MetaWorkspaceAction,\r\n\tWorkspaceContextType extends UmbSaveableWorkspaceContext = UmbSaveableWorkspaceContext,\r\n> extends UmbWorkspaceActionBase<ArgsMetaType> {\r\n\tprotected _retrieveWorkspaceContext: Promise<unknown>;\r\n\tprotected _workspaceContext?: WorkspaceContextType;\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbSaveWorkspaceActionArgs<ArgsMetaType, WorkspaceContextType>) {\r\n\t\tsuper(host, args);\r\n\r\n\t\tthis._retrieveWorkspaceContext = this.consumeContext(\r\n\t\t\targs.workspaceContextToken ?? UMB_SAVEABLE_WORKSPACE_CONTEXT,\r\n\t\t\t(context) => {\r\n\t\t\t\tthis._workspaceContext = context as WorkspaceContextType | undefined;\r\n\t\t\t\tthis.#observeUnique();\r\n\t\t\t\tthis._gotWorkspaceContext();\r\n\t\t\t},\r\n\t\t)\r\n\t\t\t.asPromise()\r\n\t\t\t.catch(() => undefined);\r\n\t}\r\n\r\n\t#observeUnique() {\r\n\t\tthis.observe(\r\n\t\t\tthis._workspaceContext?.unique,\r\n\t\t\t(unique) => {\r\n\t\t\t\t// We can't save if we don't have a unique\r\n\t\t\t\tif (unique === undefined) {\r\n\t\t\t\t\tthis.disable();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Dangerous, cause this could enable despite a class extension decided to disable it?. [NL]\r\n\t\t\t\t\tthis.enable();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'saveWorkspaceActionUniqueObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tprotected _gotWorkspaceContext() {\r\n\t\t// Override in subclass\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tawait this._retrieveWorkspaceContext;\r\n\t\tawait this._workspaceContext?.requestSave();\r\n\t}\r\n}\r\n","import type { MetaWorkspaceAction } from '../../../../types.js';\r\nimport { UMB_SUBMITTABLE_WORKSPACE_CONTEXT } from '../../../../contexts/tokens/index.js';\r\nimport type { UmbSubmittableWorkspaceContext } from '../../../../contexts/tokens/index.js';\r\nimport { UmbWorkspaceActionBase } from '../../workspace-action-base.controller.js';\r\nimport type { UmbSubmitWorkspaceActionArgs } from './types.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbSubmitWorkspaceAction<\r\n\tArgsMetaType extends MetaWorkspaceAction = MetaWorkspaceAction,\r\n\tWorkspaceContextType extends UmbSubmittableWorkspaceContext = UmbSubmittableWorkspaceContext,\r\n> extends UmbWorkspaceActionBase<ArgsMetaType> {\r\n\tprotected _retrieveWorkspaceContext: Promise<unknown>;\r\n\tprotected _workspaceContext?: WorkspaceContextType;\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbSubmitWorkspaceActionArgs<ArgsMetaType>) {\r\n\t\tsuper(host, args);\r\n\r\n\t\t// TODO: Could we make change label depending on the state? [NL]\r\n\t\tthis._retrieveWorkspaceContext = this.consumeContext(\r\n\t\t\targs.workspaceContextToken ?? UMB_SUBMITTABLE_WORKSPACE_CONTEXT,\r\n\t\t\t(context) => {\r\n\t\t\t\tthis._workspaceContext = context as WorkspaceContextType;\r\n\t\t\t\tthis.#observeUnique();\r\n\t\t\t\tthis._gotWorkspaceContext();\r\n\t\t\t},\r\n\t\t).asPromise();\r\n\t}\r\n\r\n\t#observeUnique() {\r\n\t\tthis.observe(\r\n\t\t\tthis._workspaceContext?.unique,\r\n\t\t\t(unique) => {\r\n\t\t\t\t// We can't save if we don't have a unique\r\n\t\t\t\tif (unique === undefined) {\r\n\t\t\t\t\tthis.disable();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Dangerous, cause this could enable despite a class extension decided to disable it?. [NL]\r\n\t\t\t\t\tthis.enable();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'saveWorkspaceActionUniqueObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tprotected _gotWorkspaceContext() {\r\n\t\t// Override in subclass\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tawait this._retrieveWorkspaceContext;\r\n\t\treturn await this._workspaceContext!.requestSubmit();\r\n\t}\r\n}\r\n","import type { ManifestWorkspaceView } from '../../types.js';\r\nimport { UmbViewContext } from '@umbraco-cms/backoffice/view';\r\nimport type { UmbClassInterface } from '@umbraco-cms/backoffice/class-api';\r\n\r\nexport class UmbWorkspaceViewContext extends UmbViewContext {\r\n\tpublic readonly IS_WORKSPACE_VIEW_CONTEXT = true as const;\r\n\r\n\t// Note: manifest can change later, but because we currently only use the alias from it, it's not something we need to handle. [NL]\r\n\tpublic manifest: ManifestWorkspaceView;\r\n\r\n\tconstructor(host: UmbClassInterface, manifest: ManifestWorkspaceView) {\r\n\t\tsuper(host, manifest.alias);\r\n\t\tthis.manifest = manifest;\r\n\t}\r\n}\r\n","import type { UmbWorkspaceEditorContext } from './workspace-editor.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_WORKSPACE_EDITOR_CONTEXT = new UmbContextToken<UmbWorkspaceEditorContext>('UmbWorkspaceViewContext');\r\n","import type { ManifestWorkspaceView } from '../../types.js';\r\nimport { UmbWorkspaceViewContext } from './workspace-view.context.js';\r\nimport { UMB_WORKSPACE_EDITOR_CONTEXT } from './workspace-editor.context-token.js';\r\nimport { UmbBasicState, mergeObservables } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbExtensionsManifestInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbDeepPartialObject } from '@umbraco-cms/backoffice/utils';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\nexport class UmbWorkspaceEditorContext extends UmbContextBase {\r\n\t//\r\n\t#init: Promise<void>;\r\n\t/**\r\n\t * State holding the permitted Workspace Views as a Workspace View Context\r\n\t */\r\n\r\n\t#manifests = new UmbBasicState<Array<ManifestWorkspaceView>>([]);\r\n\t#overrides = new UmbBasicState<Array<UmbDeepPartialObject<ManifestWorkspaceView>>>([]);\r\n\tpublic readonly views = mergeObservables(\r\n\t\t[this.#manifests.asObservable(), this.#overrides.asObservable()],\r\n\t\t([manifests, overrides]): Array<UmbWorkspaceViewContext> => {\r\n\t\t\tlet contexts = this.#contexts;\r\n\r\n\t\t\t// remove ones that are no longer contained in the workspaceViews (And thereby make the new array):\r\n\t\t\tconst contextsToKeep = contexts.filter((view) => {\r\n\t\t\t\tconst keep = manifests.some((manifest) => manifest.alias === view.manifest.alias);\r\n\t\t\t\tif (!keep) {\r\n\t\t\t\t\tview.destroy();\r\n\t\t\t\t}\r\n\t\t\t\treturn keep;\r\n\t\t\t});\r\n\r\n\t\t\tconst hasDiff = contextsToKeep.length !== manifests.length;\r\n\t\t\tif (hasDiff) {\r\n\t\t\t\tcontexts = [...contextsToKeep];\r\n\r\n\t\t\t\t// Add ones that are new:\r\n\t\t\t\tmanifests\r\n\t\t\t\t\t.filter((manifest) => !contextsToKeep.some((x) => x.manifest.alias === manifest.alias))\r\n\t\t\t\t\t.forEach((manifest) => {\r\n\t\t\t\t\t\tconst context = new UmbWorkspaceViewContext(this, manifest);\r\n\t\t\t\t\t\tcontext.setVariantId(this.#variantId);\r\n\t\t\t\t\t\tcontext.setTitle(manifest.meta.label);\r\n\t\t\t\t\t\tcontext.inherit();\r\n\t\t\t\t\t\tcontexts.push(context);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Apply overrides:\r\n\t\t\tcontexts.forEach((context) => {\r\n\t\t\t\tconst override = overrides.find((x) => x.alias === context.manifest.alias);\r\n\t\t\t\tif (override) {\r\n\t\t\t\t\t// Test to see if there is a change, to avoid unnecessary updates, this prevents re-setting the manifest again and again. [NL]\r\n\t\t\t\t\tconst overrideKeys = Object.keys(override) as Array<keyof ManifestWorkspaceView>;\r\n\t\t\t\t\tconst hasOverrideDiff = overrideKeys.some((key) => context.manifest[key] !== override[key]);\r\n\t\t\t\t\tif (hasOverrideDiff) {\r\n\t\t\t\t\t\tcontext.manifest = {\r\n\t\t\t\t\t\t\t...context.manifest,\r\n\t\t\t\t\t\t\t...(override as ManifestWorkspaceView),\r\n\t\t\t\t\t\t\tmeta: { ...context.manifest.meta, ...override.meta },\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// sort contexts to match manifests weights:\r\n\t\t\tcontexts.sort((a, b): number => (b.manifest.weight || 0) - (a.manifest.weight || 0));\r\n\r\n\t\t\tthis.#contexts = contexts;\r\n\t\t\treturn contexts;\r\n\t\t},\r\n\t\t// Custom memoize method, to check context instance and manifest instance:\r\n\t\t(previousValue: Array<UmbWorkspaceViewContext>, currentValue: Array<UmbWorkspaceViewContext>): boolean => {\r\n\t\t\treturn (\r\n\t\t\t\tpreviousValue === currentValue &&\r\n\t\t\t\tcurrentValue.some(\r\n\t\t\t\t\t(x) => x.manifest === previousValue.find((y) => y.manifest.alias === x.manifest.alias)?.manifest,\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t},\r\n\t);\r\n\t// A storage and cache for the current contexts, to enable communicating to them and to avoid re-initializing them every time there is a change of manifests/overrides. [NL]\r\n\t#contexts = new Array<UmbWorkspaceViewContext>();\r\n\r\n\t#variantId?: UmbVariantId;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_WORKSPACE_EDITOR_CONTEXT);\r\n\r\n\t\tthis.#init = new UmbExtensionsManifestInitializer(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\t'workspaceView',\r\n\t\t\tnull,\r\n\t\t\t(workspaceViews) => {\r\n\t\t\t\tthis.#manifests.setValue(workspaceViews.map((controller) => controller.manifest));\r\n\t\t\t},\r\n\t\t).asPromise();\r\n\t}\r\n\r\n\tsetVariantId(variantId: UmbVariantId | undefined): void {\r\n\t\tthis.#variantId = variantId;\r\n\t\tthis.#contexts.forEach((view) => {\r\n\t\t\tview.hints.updateScaffold({ variantId });\r\n\t\t});\r\n\t}\r\n\r\n\tsetOverrides(overrides?: Array<UmbDeepPartialObject<ManifestWorkspaceView>>): void {\r\n\t\tthis.#overrides.setValue(overrides ?? []);\r\n\t}\r\n\r\n\tasync getViewContext(alias: string): Promise<UmbWorkspaceViewContext | undefined> {\r\n\t\tawait this.#init;\r\n\t\treturn this.#contexts.find((view) => view.manifest.alias === alias);\r\n\t}\r\n}\r\n","import { UMB_WORKSPACE_VIEW_PATH_PATTERN } from '../../paths.js';\r\nimport type { ManifestWorkspaceView } from '../../types.js';\r\nimport { UmbWorkspaceEditorContext } from './workspace-editor.context.js';\r\nimport type { UmbWorkspaceViewContext } from './workspace-view.context.js';\r\nimport { css, customElement, html, nothing, property, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { createExtensionElement } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbDeepPartialObject } from '@umbraco-cms/backoffice/utils';\r\nimport type { UmbObserverController } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbRoute, UmbRouterSlotInitEvent, UmbRouterSlotChangeEvent } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbVariantHint } from '@umbraco-cms/backoffice/hint';\r\n\r\n/**\r\n * @element umb-workspace-editor\r\n * @description\r\n * @slot header - Slot for workspace header\r\n * @slot action-menu - Slot for workspace header\r\n * @slot footer-info - Slot for workspace footer\r\n * @slot actions - Slot for workspace footer actions\r\n * @slot - slot for main content\r\n * @class UmbWorkspaceEditorElement\r\n * @augments {UmbLitElement}\r\n */\r\n@customElement('umb-workspace-editor')\r\nexport class UmbWorkspaceEditorElement extends UmbLitElement {\r\n\t//\r\n\t#navigationContext = new UmbWorkspaceEditorContext(this);\r\n\t#workspaceViewHintObservers: Array<UmbObserverController> = [];\r\n\r\n\t@property()\r\n\tpublic headline = '';\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic hideNavigation = false;\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic enforceNoFooter = false;\r\n\r\n\t@property({ attribute: 'back-path' })\r\n\tpublic backPath?: string;\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic loading = false;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic get variantId(): UmbVariantId | undefined {\r\n\t\treturn this._variantId;\r\n\t}\r\n\tpublic set variantId(value: UmbVariantId | undefined) {\r\n\t\tif (value && this._variantId?.equal(value)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._variantId = value;\r\n\t\tthis.#navigationContext.setVariantId(value);\r\n\t\tthis.#observeWorkspaceViewHints();\r\n\t}\r\n\tprivate _variantId?: UmbVariantId | undefined;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set overrides(value: Array<UmbDeepPartialObject<ManifestWorkspaceView>> | undefined) {\r\n\t\tthis.#navigationContext.setOverrides(value);\r\n\t}\r\n\tpublic get overrides(): Array<UmbDeepPartialObject<ManifestWorkspaceView>> | undefined {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _workspaceViews: Array<UmbWorkspaceViewContext> = [];\r\n\r\n\t@state()\r\n\tprivate _hintMap: Map<string, UmbVariantHint> = new Map();\r\n\r\n\t@state()\r\n\tprivate _routes?: UmbRoute[];\r\n\r\n\t@state()\r\n\tprivate _routerPath?: string;\r\n\r\n\t@state()\r\n\tprivate _activePath?: string;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.observe(\r\n\t\t\tthis.#navigationContext.views,\r\n\t\t\t(views) => {\r\n\t\t\t\tthis._workspaceViews = views;\r\n\t\t\t\tthis.#observeWorkspaceViewHints();\r\n\t\t\t\tthis.#createRoutes();\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\t#observeWorkspaceViewHints() {\r\n\t\tthis.#workspaceViewHintObservers.forEach((observer) => observer.destroy());\r\n\t\tthis._hintMap = new Map();\r\n\t\tthis.#workspaceViewHintObservers = this._workspaceViews.map((view, index) =>\r\n\t\t\tthis.observe(\r\n\t\t\t\tview.firstHintOfVariant,\r\n\t\t\t\t(hint) => {\r\n\t\t\t\t\tif (hint) {\r\n\t\t\t\t\t\tthis._hintMap.set(view.manifest.alias, hint);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._hintMap.delete(view.manifest.alias);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.requestUpdate('_hintMap');\r\n\t\t\t\t},\r\n\t\t\t\t'umbObserveState_' + index,\r\n\t\t\t),\r\n\t\t);\r\n\t}\r\n\r\n\t#currentProvidedView?: UmbWorkspaceViewContext;\r\n\t#createRoutes() {\r\n\t\tlet newRoutes: UmbRoute[] = [];\r\n\r\n\t\tif (this._workspaceViews.length > 0) {\r\n\t\t\tnewRoutes = this._workspaceViews.map((context) => {\r\n\t\t\t\tconst manifest = context.manifest;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tpath: UMB_WORKSPACE_VIEW_PATH_PATTERN.generateLocal({ viewPathname: manifest.meta.pathname }),\r\n\t\t\t\t\tcomponent: () => createExtensionElement(manifest),\r\n\t\t\t\t\tsetup: (component?: any) => {\r\n\t\t\t\t\t\tif (this.#currentProvidedView !== context) {\r\n\t\t\t\t\t\t\tthis.#currentProvidedView?.unprovide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (component) {\r\n\t\t\t\t\t\t\tthis.#currentProvidedView = context;\r\n\t\t\t\t\t\t\tcontext.provideAt(component);\r\n\t\t\t\t\t\t\tcomponent.manifest = manifest;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t// Duplicate first workspace and use it for the empty path scenario. [NL]\r\n\t\t\tnewRoutes.push({ ...newRoutes[0], unique: newRoutes[0].path, path: '' });\r\n\t\t}\r\n\r\n\t\t// Add a catch-all route for not found\r\n\t\t// This will be the last route, so it will only match if no other routes match or if no workspace views are defined.\r\n\t\tnewRoutes.push({\r\n\t\t\tpath: `**`,\r\n\t\t\tcomponent: async () => (await import('@umbraco-cms/backoffice/router')).UmbRouteNotFoundElement,\r\n\t\t});\r\n\r\n\t\tthis._routes = newRoutes;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\t// Notice if no routes then fallback to use a slot.\r\n\t\t// TODO: Deprecate the slot feature, to rely purely on routes, cause currently bringing an additional route would mean the slotted content would never be shown. [NL]\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout main-no-padding .headline=${this.headline} ?loading=${this.loading}>\r\n\t\t\t\t${this.#renderBackButton()}\r\n\t\t\t\t<slot name=\"header\" slot=\"header\"></slot>\r\n\t\t\t\t<slot name=\"action-menu\" slot=\"action-menu\"></slot>\r\n\t\t\t\t${this.#renderViews()} ${this.#renderRoutes()}\r\n\t\t\t\t<slot></slot>\r\n\t\t\t\t${when(\r\n\t\t\t\t\t!this.enforceNoFooter,\r\n\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t<umb-workspace-footer slot=\"footer\" data-mark=\"workspace:footer\">\r\n\t\t\t\t\t\t\t<slot name=\"footer-info\"></slot>\r\n\t\t\t\t\t\t\t<slot name=\"actions\" slot=\"actions\" data-mark=\"workspace:footer-actions\"></slot>\r\n\t\t\t\t\t\t</umb-workspace-footer>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderViews() {\r\n\t\treturn html`\r\n\t\t\t${!this.hideNavigation && this._workspaceViews.length > 1\r\n\t\t\t\t? html`\r\n\t\t\t\t\t\t<uui-tab-group slot=\"navigation\" data-mark=\"workspace:view-links\">\r\n\t\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\t\tthis._workspaceViews,\r\n\t\t\t\t\t\t\t\t(view) => view.manifest.alias,\r\n\t\t\t\t\t\t\t\t(view, index) => {\r\n\t\t\t\t\t\t\t\t\tconst manifest = view.manifest;\r\n\t\t\t\t\t\t\t\t\tconst displayName = manifest.meta.label ? this.localize.string(manifest.meta.label) : manifest.name;\r\n\t\t\t\t\t\t\t\t\tconst hint = this._hintMap.get(manifest.alias);\r\n\t\t\t\t\t\t\t\t\tconst active =\r\n\t\t\t\t\t\t\t\t\t\t'view/' + manifest.meta.pathname === this._activePath || (index === 0 && this._activePath === '');\r\n\t\t\t\t\t\t\t\t\t// Notice how we use index 0 to determine which workspace that is active with empty path. [NL]\r\n\t\t\t\t\t\t\t\t\treturn html`\r\n\t\t\t\t\t\t\t\t\t\t<uui-tab\r\n\t\t\t\t\t\t\t\t\t\t\thref=\"${this._routerPath}/view/${manifest.meta.pathname}\"\r\n\t\t\t\t\t\t\t\t\t\t\t.label=${displayName}\r\n\t\t\t\t\t\t\t\t\t\t\t?active=${active}\r\n\t\t\t\t\t\t\t\t\t\t\tdata-mark=\"workspace:view-link:${manifest.alias}\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div slot=\"icon\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<umb-icon name=${manifest.meta.icon}></umb-icon> ${hint && !active\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? html`<umb-badge .color=${hint.color ?? 'default'} ?attention=${hint.color === 'invalid'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>${hint.text}</umb-badge\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t${displayName}\r\n\t\t\t\t\t\t\t\t\t\t</uui-tab>\r\n\t\t\t\t\t\t\t\t\t`;\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</uui-tab-group>\r\n\t\t\t\t\t`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBackButton() {\r\n\t\tif (!this.backPath) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"header\"\r\n\t\t\t\tclass=\"back-button\"\r\n\t\t\t\tcompact\r\n\t\t\t\thref=${this.backPath}\r\n\t\t\t\tlabel=${this.localize.term('general_back')}\r\n\t\t\t\tdata-mark=\"action:back\">\r\n\t\t\t\t<uui-icon name=\"icon-arrow-left\"></uui-icon>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRoutes() {\r\n\t\tif (!this._routes || this._routes.length === 0 || !this._workspaceViews || this._workspaceViews.length === 0) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\t\treturn html`\r\n\t\t\t<umb-router-slot\r\n\t\t\t\tinherit-addendum\r\n\t\t\t\tid=\"router-slot\"\r\n\t\t\t\t.routes=${this._routes}\r\n\t\t\t\t@init=${(event: UmbRouterSlotInitEvent) => {\r\n\t\t\t\t\tthis._routerPath = event.target.absoluteRouterPath;\r\n\t\t\t\t}}\r\n\t\t\t\t@change=${(event: UmbRouterSlotChangeEvent) => {\r\n\t\t\t\t\tthis._activePath = event.target.localActiveViewPath;\r\n\t\t\t\t}}></umb-router-slot>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#router-slot {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.back-button {\r\n\t\t\t\tmargin-right: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\tuui-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tab-group {\r\n\t\t\t\t--uui-tab-divider: var(--uui-color-border);\r\n\t\t\t\tborder-left: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-right: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\tdiv[slot='icon'] {\r\n\t\t\t\tposition: relative;\r\n\t\t\t}\r\n\r\n\t\t\tumb-badge {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tright: -1.5em;\r\n\t\t\t}\r\n\r\n\t\t\tumb-extension-slot[slot='actions'] {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-editor': UmbWorkspaceEditorElement;\r\n\t}\r\n}\r\n","import type { UmbWorkspaceViewContext } from './workspace-view.context.js';\r\nimport type { UmbViewContext } from '@umbraco-cms/backoffice/view';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_WORKSPACE_VIEW_CONTEXT = new UmbContextToken<UmbViewContext, UmbWorkspaceViewContext>(\r\n\t'UmbViewContext',\r\n\tundefined,\r\n\t(context): context is UmbWorkspaceViewContext => (context as UmbWorkspaceViewContext).IS_WORKSPACE_VIEW_CONTEXT,\r\n);\r\n","import { UMB_ENTITY_WORKSPACE_CONTEXT } from '../../contexts/index.js';\r\nimport { html, customElement, state, nothing, css } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n@customElement('umb-workspace-entity-action-menu')\r\nexport class UmbWorkspaceEntityActionMenuElement extends UmbLitElement {\r\n\tprivate _workspaceContext?: typeof UMB_ENTITY_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\t@state()\r\n\tprivate _unique?: UmbEntityUnique;\r\n\r\n\t@state()\r\n\tprivate _entityType?: string;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_ENTITY_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis._workspaceContext = context;\r\n\t\t\tthis.observe(this._workspaceContext?.unique, (unique) => {\r\n\t\t\t\tthis._unique = unique;\r\n\t\t\t\t// TODO: the context does not have an observable for the entity type, so we need to use the\r\n\t\t\t\t// getEntityType method until we can add an observable for it.\r\n\t\t\t\tthis._entityType = this._workspaceContext?.getEntityType();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._entityType) return nothing;\r\n\t\tif (this._unique === undefined) return nothing;\r\n\r\n\t\treturn html`<umb-entity-actions-dropdown\r\n\t\t\tdata-mark=\"workspace:action-menu-button\"\r\n\t\t\tlabel=${this.localize.term('general_actions')}>\r\n\t\t\t<uui-symbol-more slot=\"label\"></uui-symbol-more>\r\n\t\t</umb-entity-actions-dropdown>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tmargin-left: calc(var(--uui-size-layout-1) * -1);\r\n\t\t\t}\r\n\r\n\t\t\tumb-entity-actions-dropdown {\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-entity-action-menu': UmbWorkspaceEntityActionMenuElement;\r\n\t}\r\n}\r\n","import { UMB_SUBMITTABLE_WORKSPACE_CONTEXT } from '../../contexts/index.js';\r\nimport type { ManifestWorkspaceAction, MetaWorkspaceAction } from '../../extensions/types.js';\r\nimport type { UmbWorkspaceActionArgs } from '../workspace-action/types.js';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { css, html, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbModalContext } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MODAL_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\n\r\n/**\r\n *\r\n * @param manifest\r\n * @returns\r\n */\r\nfunction ExtensionApiArgsMethod(\r\n\tmanifest: ManifestWorkspaceAction<MetaWorkspaceAction>,\r\n): [UmbWorkspaceActionArgs<MetaWorkspaceAction>] {\r\n\treturn [{ meta: manifest.meta }];\r\n}\r\n\r\n/**\r\n * @element umb-workspace-footer\r\n * @slot - Slot for workspace footer items\r\n * @slot actions - Slot for workspace actions\r\n * @class UmbWorkspaceFooterLayout\r\n * @augments {UmbLitElement}\r\n */\r\n// TODO: stop naming this something with layout. as its not just an layout. it hooks up with extensions.\r\n@customElement('umb-workspace-footer')\r\nexport class UmbWorkspaceFooterLayoutElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _modalContext?: UmbModalContext;\r\n\r\n\t@state()\r\n\tprivate _isNew?: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_SUBMITTABLE_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis._isNew = context?.getIsNew();\r\n\t\t});\r\n\t\tthis.consumeContext(UMB_MODAL_CONTEXT, (context) => {\r\n\t\t\tthis._modalContext = context;\r\n\t\t});\r\n\t}\r\n\r\n\t#rejectModal = () => {\r\n\t\tthis._modalContext?.reject();\r\n\t};\r\n\r\n\t// TODO: Some event/callback from umb-extension-slot that can be utilized to hide the footer, if empty.\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-footer-layout>\r\n\t\t\t\t<umb-extension-slot type=\"workspaceFooterApp\"></umb-extension-slot>\r\n\t\t\t\t<slot></slot>\r\n\t\t\t\t${this._modalContext\r\n\t\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\t\tlabel=${this._isNew ? 'Cancel' : 'Close'}\r\n\t\t\t\t\t\t\t@click=${this.#rejectModal}></uui-button>`\r\n\t\t\t\t\t: ''}\r\n\r\n\t\t\t\t<slot name=\"actions\" slot=\"actions\"></slot>\r\n\t\t\t\t<umb-extension-with-api-slot\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\ttype=\"workspaceAction\"\r\n\t\t\t\t\t.apiArgs=${ExtensionApiArgsMethod}></umb-extension-with-api-slot>\r\n\t\t\t</umb-footer-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t/* prevents text in action buttons from wrapping */\r\n\t\t\tumb-extension-with-api-slot {\r\n\t\t\t\ttext-wrap: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\tumb-extension-slot[slot='actions'] {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-footer': UmbWorkspaceFooterLayoutElement;\r\n\t}\r\n}\r\n","import type { UmbWorkspaceContext } from '../workspace-context.interface.js';\r\nimport type { UmbNamableWorkspaceContext } from './namable-workspace-context.interface.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_NAMABLE_WORKSPACE_CONTEXT = new UmbContextToken<UmbWorkspaceContext, UmbNamableWorkspaceContext>(\r\n\t'UmbWorkspaceContext',\r\n\tundefined,\r\n\t(context): context is UmbNamableWorkspaceContext => (context as any).getName !== undefined,\r\n);\r\n","import type { Observable } from '@umbraco-cms/backoffice/external/rxjs';\r\nimport { UmbGuardManagerBase, type UmbGuardRule } from '@umbraco-cms/backoffice/utils';\r\n\r\nexport class UmbNameWriteGuardManager extends UmbGuardManagerBase {\r\n\tpublic isPermittedForName(): Observable<boolean> {\r\n\t\treturn this._rules.asObservablePart((rules) => this.#resolvePermission(rules));\r\n\t}\r\n\r\n\t#resolvePermission(rules: Array<UmbGuardRule>): boolean {\r\n\t\tif (rules.some((rule) => rule.permitted === false)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (rules.some((rule) => rule.permitted === true)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn this._fallback;\r\n\t}\r\n}\r\n","import { UMB_NAMABLE_WORKSPACE_CONTEXT } from '../../namable/index.js';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { css, html, customElement, state, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbFocus, UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UUIInputElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { umbBindToValidation } from '@umbraco-cms/backoffice/validation';\r\n\r\n@customElement('umb-workspace-header-name-editable')\r\nexport class UmbWorkspaceHeaderNameEditableElement extends UmbLitElement {\r\n\t/**\r\n\t * The label for the inner input.\r\n\t * @attr\r\n\t */\r\n\t@property()\r\n\tlabel?: string;\r\n\r\n\t/**\r\n\t * The placeholder for the inner input.\r\n\t * @attr\r\n\t */\r\n\t@property()\r\n\tplaceholder?: string;\r\n\r\n\t/**\r\n\t * The readonly state of the inner input.\r\n\t * @attr\r\n\t */\r\n\treadonly = false;\r\n\r\n\t@state()\r\n\tprivate _name = '';\r\n\r\n\t@state()\r\n\tprivate _isWritableName = true;\r\n\r\n\t#workspaceContext?: typeof UMB_NAMABLE_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_NAMABLE_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.#workspaceContext = workspaceContext;\r\n\t\t\tthis.#observeName();\r\n\t\t\tthis.#observeNameWriteGuardRules();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeNameWriteGuardRules() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.nameWriteGuard?.isPermittedForName(),\r\n\t\t\t(isPermitted) => {\r\n\t\t\t\tthis._isWritableName = isPermitted ?? true;\r\n\t\t\t},\r\n\t\t\t'umbObserveWorkspaceNameWriteGuardRules',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeName() {\r\n\t\tif (!this.#workspaceContext) return;\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext.name,\r\n\t\t\t(name) => {\r\n\t\t\t\tif (name !== this._name) {\r\n\t\t\t\t\tthis._name = name ?? '';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeWorkspaceName',\r\n\t\t);\r\n\t}\r\n\r\n\t#onNameInput(event: UUIInputEvent) {\r\n\t\tif (event instanceof UUIInputEvent) {\r\n\t\t\tconst target = event.composedPath()[0] as UUIInputElement;\r\n\r\n\t\t\tif (typeof target?.value === 'string') {\r\n\t\t\t\tthis.#workspaceContext?.setName(target.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<uui-input\r\n\t\t\tid=\"nameInput\"\r\n\t\t\tdata-mark=\"input:workspace-name\"\r\n\t\t\t.value=${this._name}\r\n\t\t\t@input=\"${this.#onNameInput}\"\r\n\t\t\tlabel=${this.label ?? this.localize.term('placeholders_entername')}\r\n\t\t\tplaceholder=${this.placeholder ?? this.localize.term('placeholders_entername')}\r\n\t\t\t?readonly=${this.readonly || !this._isWritableName}\r\n\t\t\trequired\r\n\t\t\t${umbBindToValidation(this, `$.name`, this._name)}\r\n\t\t\t${umbFocus()}></uui-input>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: contents;\r\n\t\t\t}\r\n\r\n\t\t\t#nameInput {\r\n\t\t\t\tflex: 1 1 auto;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-header-name-editable': UmbWorkspaceHeaderNameEditableElement;\r\n\t}\r\n}\r\n","import { UMB_VARIANT_WORKSPACE_CONTEXT } from '../../contexts/index.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbBooleanState, UmbClassState, UmbNumberState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbPropertyDatasetContext } from '@umbraco-cms/backoffice/property';\r\nimport { UMB_MARK_ATTRIBUTE_NAME } from '@umbraco-cms/backoffice/const';\r\nimport type { UmbValidationController } from '@umbraco-cms/backoffice/validation';\r\n\r\nexport class UmbWorkspaceSplitViewContext extends UmbContextBase {\r\n\t//\r\n\t#variantVariantValidationContext?: UmbValidationController;\r\n\t#workspaceContext?: typeof UMB_VARIANT_WORKSPACE_CONTEXT.TYPE;\r\n\tpublic getWorkspaceContext() {\r\n\t\treturn this.#workspaceContext;\r\n\t}\r\n\r\n\t#datasetContext?: UmbPropertyDatasetContext;\r\n\r\n\t#index = new UmbNumberState(undefined);\r\n\tindex = this.#index.asObservable();\r\n\r\n\t#isNew = new UmbBooleanState(undefined);\r\n\tisNew = this.#isNew.asObservable();\r\n\r\n\t#variantId = new UmbClassState<UmbVariantId | undefined>(undefined);\r\n\tvariantId = this.#variantId.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_WORKSPACE_SPLIT_VIEW_CONTEXT);\r\n\r\n\t\tthis.consumeContext(UMB_VARIANT_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#workspaceContext = context;\r\n\t\t\tthis.#observeVariant();\r\n\t\t\tthis.#observeIsNew();\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.index,\r\n\t\t\t() => {\r\n\t\t\t\tthis.#observeVariant();\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\t#observeIsNew() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.isNew,\r\n\t\t\t(isNew) => {\r\n\t\t\t\tthis.#isNew.setValue(isNew ?? false);\r\n\t\t\t},\r\n\t\t\t'umbObserveIsNew',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeVariant() {\r\n\t\tif (!this.#workspaceContext) return;\r\n\r\n\t\tconst index = this.#index.getValue();\r\n\t\tif (index === undefined) return;\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext.splitView.activeVariantByIndex(index),\r\n\t\t\tasync (activeVariantInfo) => {\r\n\t\t\t\tif (this.#variantVariantValidationContext) {\r\n\t\t\t\t\tthis.#variantVariantValidationContext.unprovide();\r\n\t\t\t\t}\r\n\t\t\t\tif (!activeVariantInfo) return;\r\n\r\n\t\t\t\tthis.#datasetContext?.destroy();\r\n\t\t\t\tconst variantId = UmbVariantId.Create(activeVariantInfo);\r\n\t\t\t\tthis.#variantId.setValue(variantId);\r\n\r\n\t\t\t\tconst validationContext = this.#workspaceContext?.getVariantValidationContext(variantId);\r\n\t\t\t\tif (validationContext) {\r\n\t\t\t\t\tvalidationContext.provideAt(this);\r\n\t\t\t\t\tthis.#variantVariantValidationContext = validationContext;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.#datasetContext = this.#workspaceContext?.createPropertyDatasetContext(this, variantId);\r\n\t\t\t\tthis.getHostElement().setAttribute(UMB_MARK_ATTRIBUTE_NAME, 'workspace-split-view:' + variantId.toString());\r\n\t\t\t},\r\n\t\t\t'_observeActiveVariant',\r\n\t\t);\r\n\t}\r\n\r\n\tpublic switchVariant(variant: UmbVariantId) {\r\n\t\tconst index = this.#index.value;\r\n\t\tif (index === undefined) return;\r\n\t\tthis.#workspaceContext?.splitView.switchVariant(index, variant);\r\n\t}\r\n\r\n\tpublic closeSplitView() {\r\n\t\tconst index = this.#index.value;\r\n\t\tif (index === undefined) return;\r\n\t\tthis.#workspaceContext?.splitView.closeSplitView(index);\r\n\t}\r\n\r\n\tpublic openSplitView(variant: UmbVariantId) {\r\n\t\tthis.#workspaceContext?.splitView.openSplitView(variant);\r\n\t}\r\n\r\n\tpublic getSplitViewIndex() {\r\n\t\treturn this.#index.getValue();\r\n\t}\r\n\tpublic setSplitViewIndex(index: number) {\r\n\t\tthis.#index.setValue(index);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * concept this class could have methods to set and get the culture and segment of the active variant? just by using the index.\r\n\t */\r\n\r\n\tpublic override destroy(): void {\r\n\t\tthis.#isNew.destroy();\r\n\t\tthis.#variantId.destroy();\r\n\t\tthis.#index.destroy();\r\n\t\tthis.#variantVariantValidationContext?.unprovide();\r\n\t\tthis.#datasetContext?.destroy();\r\n\t\tthis.#workspaceContext = undefined;\r\n\t\tthis.#variantVariantValidationContext = undefined;\r\n\t\tthis.#datasetContext = undefined;\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport const UMB_WORKSPACE_SPLIT_VIEW_CONTEXT = new UmbContextToken<UmbWorkspaceSplitViewContext>(\r\n\t'UmbWorkspaceSplitViewContext',\r\n);\r\n","import type { UmbVariantDatasetWorkspaceContext } from '../../contexts/index.js';\r\nimport { UMB_WORKSPACE_SPLIT_VIEW_CONTEXT } from './workspace-split-view.context.js';\r\nimport { css, customElement, html, nothing, query, ref, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport { UmbDataPathVariantQuery, umbBindToValidation } from '@umbraco-cms/backoffice/validation';\r\nimport { UMB_PROPERTY_DATASET_CONTEXT, isNameablePropertyDatasetContext } from '@umbraco-cms/backoffice/property';\r\nimport { UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbEntityVariantModel, UmbEntityVariantOptionModel } from '@umbraco-cms/backoffice/variant';\r\nimport type { UUIInputElement, UUIPopoverContainerElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { DocumentVariantStateModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { UMB_HINT_CONTEXT } from '@umbraco-cms/backoffice/hint';\r\nimport type { UmbHint, UmbVariantHint } from '@umbraco-cms/backoffice/hint';\r\nimport { observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\n\r\n@customElement('umb-workspace-split-view-variant-selector')\r\nexport class UmbWorkspaceSplitViewVariantSelectorElement<\r\n\tVariantOptionModelType extends\r\n\t\tUmbEntityVariantOptionModel<UmbEntityVariantModel> = UmbEntityVariantOptionModel<UmbEntityVariantModel>,\r\n> extends UmbLitElement {\r\n\t@query('#popover')\r\n\tprivate _popoverElement?: UUIPopoverContainerElement;\r\n\r\n\t@state()\r\n\tprivate _variantOptions: Array<VariantOptionModelType> = [];\r\n\r\n\t@state()\r\n\tprivate _cultureVariantOptions: Array<VariantOptionModelType> = [];\r\n\r\n\t@state()\r\n\tprivate _activeVariants: Array<UmbVariantId> = [];\r\n\r\n\t#splitViewContext?: typeof UMB_WORKSPACE_SPLIT_VIEW_CONTEXT.TYPE;\r\n\t#datasetContext?: typeof UMB_PROPERTY_DATASET_CONTEXT.TYPE;\r\n\r\n\t@state()\r\n\tprivate _name?: string;\r\n\r\n\t@state()\r\n\tprivate _activeVariant?: VariantOptionModelType;\r\n\r\n\t@state()\r\n\tprivate _variantId?: UmbVariantId;\r\n\r\n\t@state()\r\n\tprivate _variantSelectorOpen = false;\r\n\r\n\t@state()\r\n\tprivate _readOnlyCultures: Array<string | null> = [];\r\n\r\n\t@state()\r\n\tprivate _variesByCulture = false;\r\n\r\n\t@state()\r\n\tprivate _variesBySegment = false;\r\n\r\n\t@state()\r\n\tprivate _expandedVariants: Array<UmbVariantId> = [];\r\n\r\n\t@state()\r\n\tprivate _labelDefault = '';\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\tprotected _variantSorter = (a: VariantOptionModelType, b: VariantOptionModelType) => {\r\n\t\treturn 0;\r\n\t};\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis._labelDefault = this.localize.term('general_default');\r\n\r\n\t\tthis.consumeContext(UMB_WORKSPACE_SPLIT_VIEW_CONTEXT, (instance) => {\r\n\t\t\tthis.#splitViewContext = instance;\r\n\r\n\t\t\tconst workspaceContext = this.#splitViewContext?.getWorkspaceContext();\r\n\r\n\t\t\tthis.#observeVariants(workspaceContext);\r\n\t\t\tthis.#observeActiveVariants(workspaceContext);\r\n\t\t\tthis.#observeCurrentVariant();\r\n\t\t\tthis.#observeReadOnlyGuardRules(workspaceContext);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tworkspaceContext?.variesBySegment,\r\n\t\t\t\t(value) => (this._variesBySegment = value ?? false),\r\n\t\t\t\t'umbObserveVariesBySegment',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tworkspaceContext?.variesByCulture,\r\n\t\t\t\t(value) => (this._variesByCulture = value ?? false),\r\n\t\t\t\t'umbObserveVariesByCulture',\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, (instance) => {\r\n\t\t\tthis.#datasetContext = instance;\r\n\t\t\tthis.#observeDatasetContext();\r\n\t\t\tthis.#observeCurrentVariant();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_HINT_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.descendingHints(),\r\n\t\t\t\t(hints) => {\r\n\t\t\t\t\tthis._hintMap.clear();\r\n\t\t\t\t\thints?.forEach((hint) => {\r\n\t\t\t\t\t\tif (this.#isVariantHint(hint) && hint.variantId) {\r\n\t\t\t\t\t\t\t// Add the hint if there is no existing hint for this variantId or if the existing hint has a lower weight\r\n\t\t\t\t\t\t\tconst existingHint = this._hintMap.get(hint.variantId.toString());\r\n\t\t\t\t\t\t\tif (!existingHint || existingHint.weight < hint.weight) {\r\n\t\t\t\t\t\t\t\tthis._hintMap.set(hint.variantId.toString(), hint);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.requestUpdate('_hintMap');\r\n\t\t\t\t},\r\n\t\t\t\t'umbObserveHints',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t#isVariantHint(hint: UmbHint): hint is UmbVariantHint {\r\n\t\treturn hint && 'variantId' in hint;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _hintMap = new Map<string, UmbVariantHint>();\r\n\r\n\tasync #observeVariants(workspaceContext?: UmbVariantDatasetWorkspaceContext) {\r\n\t\tthis.observe(\r\n\t\t\tworkspaceContext?.variantOptions,\r\n\t\t\t(variantOptions) => {\r\n\t\t\t\tthis._variantOptions = ((variantOptions ?? []) as VariantOptionModelType[]).sort(this._variantSorter);\r\n\t\t\t\tthis._cultureVariantOptions = this._variantOptions.filter((variant) => variant.segment === null);\r\n\t\t\t\tthis.#setReadOnlyCultures(workspaceContext);\r\n\t\t\t},\r\n\t\t\t'_observeVariantOptions',\r\n\t\t);\r\n\r\n\t\tif (workspaceContext) {\r\n\t\t\tthis.observe(\r\n\t\t\t\tobserveMultiple([\r\n\t\t\t\t\tworkspaceContext.variesByCulture,\r\n\t\t\t\t\tworkspaceContext.variesBySegment,\r\n\t\t\t\t\tworkspaceContext.variantOptions,\r\n\t\t\t\t]),\r\n\t\t\t\t([variesByCulture, variesBySegment, variantOptions]) => {\r\n\t\t\t\t\tif (variesByCulture === false && variesBySegment === true && variantOptions.length > 1) {\r\n\t\t\t\t\t\tthis.#expandVariant(UmbVariantId.Create(variantOptions[0]));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'_observeExpandFirstVariantIfSegmentOnly',\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis.removeUmbControllerByAlias('_observeExpandFirstVariantIfSegmentOnly');\r\n\t\t}\r\n\t}\r\n\r\n\tasync #observeActiveVariants(workspaceContext?: UmbVariantDatasetWorkspaceContext) {\r\n\t\tthis.observe(\r\n\t\t\tworkspaceContext?.splitView.activeVariantsInfo,\r\n\t\t\t(activeVariants) => {\r\n\t\t\t\tif (activeVariants) {\r\n\t\t\t\t\tthis._activeVariants = activeVariants.map((variant) => UmbVariantId.Create(variant));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'_observeActiveVariants',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #observeDatasetContext() {\r\n\t\tif (!this.#datasetContext) return;\r\n\t\tthis.observe(\r\n\t\t\tthis.#datasetContext.name,\r\n\t\t\t(name) => {\r\n\t\t\t\tthis._name = name;\r\n\t\t\t},\r\n\t\t\t'_name',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #observeCurrentVariant() {\r\n\t\tif (!this.#datasetContext || !this.#splitViewContext) return;\r\n\t\tconst workspaceContext =\r\n\t\t\tthis.#splitViewContext.getWorkspaceContext() as unknown as UmbVariantDatasetWorkspaceContext;\r\n\t\tif (!workspaceContext) return;\r\n\r\n\t\tthis._variantId = this.#datasetContext.getVariantId();\r\n\r\n\t\tthis.observe(\r\n\t\t\tworkspaceContext.variantOptions,\r\n\t\t\t(options) => {\r\n\t\t\t\tconst option = options.find(\r\n\t\t\t\t\t(option) => option.culture === this._variantId?.culture && option.segment === this._variantId?.segment,\r\n\t\t\t\t);\r\n\t\t\t\tthis._activeVariant = option as VariantOptionModelType;\r\n\t\t\t},\r\n\t\t\t'umbObserveActiveVariant',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeReadOnlyGuardRules(workspaceContext?: UmbVariantDatasetWorkspaceContext) {\r\n\t\tthis.observe(\r\n\t\t\tworkspaceContext?.readOnlyGuard.rules,\r\n\t\t\t() => this.#setReadOnlyCultures(workspaceContext),\r\n\t\t\t'umbObserveReadOnlyGuardRules',\r\n\t\t);\r\n\t}\r\n\r\n\t#handleInput(event: UUIInputEvent) {\r\n\t\tif (event instanceof UUIInputEvent) {\r\n\t\t\tconst target = event.composedPath()[0] as UUIInputElement;\r\n\r\n\t\t\tif (\r\n\t\t\t\ttypeof target?.value === 'string' &&\r\n\t\t\t\tthis.#datasetContext &&\r\n\t\t\t\tisNameablePropertyDatasetContext(this.#datasetContext)\r\n\t\t\t) {\r\n\t\t\t\tthis.#datasetContext.setName(target.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#switchVariant(variant: VariantOptionModelType) {\r\n\t\tthis.#splitViewContext?.switchVariant(UmbVariantId.Create(variant));\r\n\t}\r\n\r\n\t#openSplitView(variant: VariantOptionModelType) {\r\n\t\tthis.#splitViewContext?.openSplitView(UmbVariantId.Create(variant));\r\n\t}\r\n\r\n\t#closeSplitView() {\r\n\t\tthis.#splitViewContext?.closeSplitView();\r\n\t}\r\n\r\n\t#isVariantActive(variantId: UmbVariantId) {\r\n\t\treturn this._activeVariants.find((activeVariantId) => activeVariantId.equal(variantId)) !== undefined;\r\n\t}\r\n\r\n\t#isCreateMode(variantOption: VariantOptionModelType, variantId: UmbVariantId) {\r\n\t\treturn !variantOption.variant && !this.#isVariantActive(variantId);\r\n\t}\r\n\r\n\t#selectorIsEnabled() {\r\n\t\t// only varies by segment\r\n\t\tif (!this._variesByCulture && this._variesBySegment) {\r\n\t\t\treturn (\r\n\t\t\t\tthis._cultureVariantOptions.length > 1 ||\r\n\t\t\t\t(this._variantOptions.length > 1 && this._variantOptions[0].variant?.state)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this._variantOptions.length > 1;\r\n\t}\r\n\r\n\t#setReadOnlyCultures(workspaceContext?: UmbVariantDatasetWorkspaceContext) {\r\n\t\tif (workspaceContext) {\r\n\t\t\tthis._readOnlyCultures = this._variantOptions\r\n\t\t\t\t.filter((variant) => workspaceContext.readOnlyGuard.getIsPermittedForVariant(UmbVariantId.Create(variant)))\r\n\t\t\t\t.map((variant) => variant.culture);\r\n\t\t} else {\r\n\t\t\tthis._readOnlyCultures = [];\r\n\t\t}\r\n\t}\r\n\r\n\t#onPopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just needed for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._variantSelectorOpen = event.newState === 'open';\r\n\r\n\t\tif (!this._popoverElement) return;\r\n\r\n\t\t// TODO: This ignorer is just needed for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tconst isOpen = event.newState === 'open';\r\n\t\tif (!isOpen) return;\r\n\r\n\t\tconst host = this.getBoundingClientRect();\r\n\t\t// TODO: Ideally this is kept updated while open, but for now we just set it once:\r\n\t\tthis._popoverElement.style.width = `${host.width}px`;\r\n\r\n\t\t// If the active variant is a segment then we expend the culture variant when the selector is opened.\r\n\t\tif (this.#isSegmentVariantOption(this._activeVariant)) {\r\n\t\t\tconst option = this._cultureVariantOptions.find((variant) => {\r\n\t\t\t\treturn variant.culture === this._activeVariant?.culture && variant.segment === null;\r\n\t\t\t});\r\n\r\n\t\t\tif (!option) return;\r\n\t\t\tconst variantId = UmbVariantId.Create(option);\r\n\t\t\tthis.#expandVariant(variantId);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Focuses the input element after a short delay to ensure it is rendered.\r\n\t * This works better than the {umbFocus()} directive, which does not work in this context.\r\n\t * @param {Element} element  The element to focus.\r\n\t */\r\n\t#focusInput(element?: Element) {\r\n\t\tif (!element) return;\r\n\r\n\t\tsetTimeout(async () => {\r\n\t\t\tawait this.updateComplete;\r\n\t\t\t(element as UUIInputElement)?.focus();\r\n\t\t}, 200);\r\n\t}\r\n\r\n\t#isReadOnlyCulture(culture: string | null) {\r\n\t\treturn this._readOnlyCultures.includes(culture);\r\n\t}\r\n\r\n\t#isSegmentVariantOption(variantOption: VariantOptionModelType | undefined) {\r\n\t\treturn variantOption?.segment !== null;\r\n\t}\r\n\r\n\t#onVariantExpandClick(event: PointerEvent, variantId: UmbVariantId) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis.#toggleVariantExpansion(variantId);\r\n\t}\r\n\r\n\t#expandVariant(variantId: UmbVariantId) {\r\n\t\tif (this.#isVariantExpanded(variantId)) return;\r\n\t\tthis._expandedVariants = [...this._expandedVariants, variantId];\r\n\t}\r\n\r\n\t#toggleVariantExpansion(variantId: UmbVariantId) {\r\n\t\tthis._expandedVariants = this.#isVariantExpanded(variantId)\r\n\t\t\t? this._expandedVariants.filter((expandedVariant) => expandedVariant.equal(variantId) === false)\r\n\t\t\t: [...this._expandedVariants, variantId];\r\n\t}\r\n\r\n\t#isVariantExpanded(variantId: UmbVariantId) {\r\n\t\treturn this._expandedVariants.find((expandedVariant) => expandedVariant.equal(variantId)) !== undefined;\r\n\t}\r\n\r\n\t#getSegmentVariantOptionsForCulture(\r\n\t\tvariantOption: VariantOptionModelType,\r\n\t\tvariantId: UmbVariantId,\r\n\t): Array<VariantOptionModelType> {\r\n\t\tconst segmentVariants = this._variantOptions.filter(\r\n\t\t\t(variant) => variant.culture === variantId.culture && variant.segment !== null,\r\n\t\t);\r\n\t\treturn variantOption.variant ? segmentVariants : [];\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._variantId) return nothing;\r\n\r\n\t\tlet firstHintOnInactiveVariant: UmbVariantHint | undefined;\r\n\r\n\t\tif (this._activeVariant) {\r\n\t\t\tconst hintsOrderedByWeight = Array.from(this._hintMap.values()).sort((a, b) => (b.weight || 0) - (a.weight || 0));\r\n\t\t\tfirstHintOnInactiveVariant = hintsOrderedByWeight.find((hint) => {\r\n\t\t\t\tif (!hint.variantId) return false;\r\n\t\t\t\treturn !hint.variantId.isInvariant() && this.#isVariantActive(hint.variantId) === false;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-input\r\n\t\t\t\tid=\"name-input\"\r\n\t\t\t\tdata-mark=\"input:entity-name\"\r\n\t\t\t\tplaceholder=${this.localize.term('placeholders_entername')}\r\n\t\t\t\tlabel=${this.localize.term('placeholders_entername')}\r\n\t\t\t\tautocomplete=\"off\"\r\n\t\t\t\t.value=${this.#getNameValue()}\r\n\t\t\t\t@input=${this.#handleInput}\r\n\t\t\t\trequired\r\n\t\t\t\t?readonly=${this.#isReadOnlyCulture(this._activeVariant?.culture ?? null) ||\r\n\t\t\t\tthis.#isSegmentVariantOption(this._activeVariant)}\r\n\t\t\t\t${umbBindToValidation(this, `$.variants[${UmbDataPathVariantQuery(this._variantId)}].name`, this._name ?? '')}\r\n\t\t\t\t${ref(this.#focusInput)}>\r\n\t\t\t\t${this.#selectorIsEnabled()\r\n\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tid=\"toggle\"\r\n\t\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\t\tslot=\"append\"\r\n\t\t\t\t\t\t\t\tpopovertarget=\"popover\"\r\n\t\t\t\t\t\t\t\ttitle=${this.#getVariantSpecInfo(this._activeVariant)}\r\n\t\t\t\t\t\t\t\tlabel=${this._variantSelectorOpen\r\n\t\t\t\t\t\t\t\t\t? this.localize.term('buttons_closeVersionSelector')\r\n\t\t\t\t\t\t\t\t\t: this.localize.term('buttons_openVersionSelector')}>\r\n\t\t\t\t\t\t\t\t${this.#getVariantSpecInfo(this._activeVariant)}\r\n\t\t\t\t\t\t\t\t${this.#renderReadOnlyTag(this._activeVariant?.culture)}\r\n\t\t\t\t\t\t\t\t<uui-symbol-expand .open=${this._variantSelectorOpen}></uui-symbol-expand>\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t${!this._variantSelectorOpen ? this.#renderHintBadge(firstHintOnInactiveVariant) : nothing}\r\n\t\t\t\t\t\t\t${this._activeVariants.length > 1\r\n\t\t\t\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t\t\t\t<uui-button slot=\"append\" compact id=\"variant-close\" @click=${this.#closeSplitView}>\r\n\t\t\t\t\t\t\t\t\t\t\t<uui-icon name=\"remove\"></uui-icon>\r\n\t\t\t\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t\t\t`\r\n\t\t\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t: html`<span id=\"read-only-tag\" slot=\"append\"> ${this.#renderReadOnlyTag(null)} </span>`}\r\n\t\t\t</uui-input>\r\n\r\n\t\t\t${this.#selectorIsEnabled()\r\n\t\t\t\t? html`\r\n\t\t\t\t\t\t<uui-popover-container id=\"popover\" @beforetoggle=${this.#onPopoverToggle} placement=\"bottom-end\">\r\n\t\t\t\t\t\t\t<div id=\"dropdown\">\r\n\t\t\t\t\t\t\t\t<uui-scroll-container>\r\n\t\t\t\t\t\t\t\t\t${this._cultureVariantOptions.map((variant) => this.#renderCultureVariantOption(variant))}\r\n\t\t\t\t\t\t\t\t</uui-scroll-container>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</uui-popover-container>\r\n\t\t\t\t\t`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCultureVariantOption(variantOption: VariantOptionModelType) {\r\n\t\tconst variantId = UmbVariantId.Create(variantOption);\r\n\t\tconst notCreated = this.#isCreateMode(variantOption, variantId);\r\n\t\tconst subVariantOptions = this.#getSegmentVariantOptionsForCulture(variantOption, variantId);\r\n\t\tconst hint = this._hintMap.get(variantId.toString());\r\n\t\tconst active = this.#isVariantActive(variantId);\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"variant culture-variant ${active ? 'selected' : ''}\">\r\n\t\t\t\t${this._variesBySegment && this.#isCreated(variantOption) && subVariantOptions.length > 0\r\n\t\t\t\t\t? html`<div class=\"expand-area\">${this.#renderExpandToggle(variantId)}</div>`\r\n\t\t\t\t\t: nothing}\r\n\r\n\t\t\t\t<button\r\n\t\t\t\t\tclass=\"switch-button ${notCreated ? 'add-mode' : ''} ${this.#isReadOnlyCulture(variantId.culture)\r\n\t\t\t\t\t\t? 'readonly-mode'\r\n\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t@click=${() => this.#switchVariant(variantOption)}>\r\n\t\t\t\t\t${notCreated ? html`<uui-icon class=\"add-icon\" name=\"icon-add\"></uui-icon>` : nothing}\r\n\t\t\t\t\t<div class=\"variant-info\">\r\n\t\t\t\t\t\t<div class=\"variant-name\">\r\n\t\t\t\t\t\t\t${this.#getVariantDisplayName(variantOption)}${this.#renderReadOnlyTag(variantId.culture)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"variant-details\">\r\n\t\t\t\t\t\t\t<span>${this._renderVariantDetails(variantOption)}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"specs-info\">${this.#getVariantSpecInfo(variantOption)}</div>\r\n\t\t\t\t</button>\r\n\t\t\t\t${this.#renderHintBadge(!active ? hint : undefined)} ${this.#renderSplitViewButton(variantOption)}\r\n\t\t\t</div>\r\n\t\t\t${this.#isVariantExpanded(variantId)\r\n\t\t\t\t? html` ${subVariantOptions.map((option) => this.#renderSegmentVariantOption(option))} `\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderHintBadge(hint?: UmbVariantHint) {\r\n\t\tif (!hint) return nothing;\r\n\t\treturn html` <umb-badge slot=\"append\" .color=${hint.color ?? 'default'} ?attention=${hint.color === 'invalid'}\r\n\t\t\t>${hint.text}</umb-badge\r\n\t\t>`;\r\n\t}\r\n\r\n\t#isCreated(variantOption: VariantOptionModelType) {\r\n\t\treturn (\r\n\t\t\tvariantOption.variant?.state &&\r\n\t\t\tvariantOption.variant?.state !== ('NotCreated' as DocumentVariantStateModel.NOT_CREATED)\r\n\t\t);\r\n\t}\r\n\r\n\t#renderExpandToggle(variantId: UmbVariantId) {\r\n\t\treturn html`\r\n\t\t\t<uui-button @click=${(event: PointerEvent) => this.#onVariantExpandClick(event, variantId)} compact>\r\n\t\t\t\t<uui-symbol-expand .open=${this.#isVariantExpanded(variantId)}></uui-symbol-expand>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderSegmentVariantOption(variantOption: VariantOptionModelType) {\r\n\t\tconst variantId = UmbVariantId.Create(variantOption);\r\n\t\tconst notCreated = this.#isCreateMode(variantOption, variantId);\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"variant segment-variant ${this.#isVariantActive(variantId) ? 'selected' : ''}\">\r\n\t\t\t\t${notCreated ? nothing : html`<div class=\"expand-area\"></div>`}\r\n\t\t\t\t<button\r\n\t\t\t\t\tclass=\"switch-button ${notCreated ? 'add-mode' : ''} ${this.#isReadOnlyCulture(variantId.culture)\r\n\t\t\t\t\t\t? 'readonly-mode'\r\n\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t@click=${() => this.#switchVariant(variantOption)}>\r\n\t\t\t\t\t${notCreated ? html`<uui-icon class=\"add-icon\" name=\"icon-add\"></uui-icon>` : nothing}\r\n\t\t\t\t\t<div class=\"variant-info\">\r\n\t\t\t\t\t\t<div class=\"variant-name\">\r\n\t\t\t\t\t\t\t${this.#getVariantDisplayName(variantOption)}${this.#renderReadOnlyTag(variantId.culture)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"variant-details\">\r\n\t\t\t\t\t\t\t<span>${this._renderVariantDetails(variantOption)}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"specs-info\">${this.#getVariantSpecInfo(variantOption)}</div>\r\n\t\t\t\t</button>\r\n\t\t\t\t${this.#renderSplitViewButton(variantOption)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#getNameValue() {\r\n\t\t// It is currently not possible to edit the name of a segment variant option. We render the name of the segment instead and set the input to readonly.\r\n\t\tconst segmentName =\r\n\t\t\tthis.#isSegmentVariantOption(this._activeVariant) && this._activeVariant?.segmentInfo?.name\r\n\t\t\t\t? this._activeVariant.segmentInfo.name\r\n\t\t\t\t: '';\r\n\t\treturn segmentName !== '' ? segmentName : (this._name ?? '');\r\n\t}\r\n\r\n\t#getVariantDisplayName(variantOption: VariantOptionModelType) {\r\n\t\tif (this.#isSegmentVariantOption(variantOption)) {\r\n\t\t\treturn variantOption?.segmentInfo?.name ?? this._labelDefault;\r\n\t\t}\r\n\r\n\t\tif (variantOption.variant?.name && variantOption.variant?.name.trim() !== '') {\r\n\t\t\treturn variantOption.variant?.name;\r\n\t\t}\r\n\r\n\t\treturn variantOption.language.name;\r\n\t}\r\n\r\n\t#getVariantSpecInfo(variantOption: VariantOptionModelType | undefined) {\r\n\t\tif (!variantOption) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\t// If we vary by culture and segment, we show both\r\n\t\tif (this._variesByCulture && this._variesBySegment) {\r\n\t\t\treturn variantOption.segmentInfo\r\n\t\t\t\t? `${variantOption.language.name} - ${variantOption.segmentInfo.name}`\r\n\t\t\t\t: variantOption.language.name || this._labelDefault;\r\n\t\t}\r\n\r\n\t\t// If we vary by segment only, we only show the segment and show \"Default\" for the language\r\n\t\tif (!this._variesByCulture && this._variesBySegment) {\r\n\t\t\treturn variantOption?.segmentInfo?.name ?? this._labelDefault;\r\n\t\t}\r\n\r\n\t\treturn variantOption.language.name;\r\n\t}\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\tprotected _renderVariantDetails(variantOption: VariantOptionModelType) {\r\n\t\treturn html``;\r\n\t}\r\n\r\n\t#renderReadOnlyTag(culture?: string | null) {\r\n\t\tif (culture === undefined) return nothing;\r\n\t\treturn this.#isReadOnlyCulture(culture)\r\n\t\t\t? html`<uui-tag look=\"secondary\">${this.localize.term('general_readOnly')}</uui-tag>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderSplitViewButton(variant: VariantOptionModelType) {\r\n\t\tconst variantId = UmbVariantId.Create(variant);\r\n\t\treturn html`\r\n\t\t\t${this.#isVariantActive(variantId)\r\n\t\t\t\t? nothing\r\n\t\t\t\t: html`\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tclass=\"split-view\"\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('content_openSplitViewForVariant', this.#getVariantSpecInfo(variant))}\r\n\t\t\t\t\t\t\t@click=${() => this.#openSplitView(variant)}>\r\n\t\t\t\t\t\t\t${this.localize.term('buttons_openInSplitView')}\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t`}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#name-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#toggle {\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t#popover {\r\n\t\t\t\ttranslate: 1px; /* Fixes tiny alignment issue caused by border */\r\n\t\t\t}\r\n\r\n\t\t\t#dropdown {\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\tz-index: -1;\r\n\t\t\t\tbackground-color: var(--uui-combobox-popover-background-color, var(--uui-color-surface));\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: auto;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tbox-shadow: var(--uui-shadow-depth-3);\r\n\t\t\t}\r\n\r\n\t\t\t#variant-close {\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t#read-only-tag {\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t}\r\n\r\n\t\t\tuui-scroll-container {\r\n\t\t\t\tmax-height: 50dvh;\r\n\t\t\t}\r\n\r\n\t\t\t.variant {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-divider-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t.expand-area {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: var(--uui-size-12);\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t}\r\n\r\n\t\t\t.expand-area uui-button {\r\n\t\t\t\theight: 100%;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-symbol-expand {\r\n\t\t\t\tbackground: none;\r\n\t\t\t}\r\n\r\n\t\t\t.variant:hover > .split-view,\r\n\t\t\t.variant:focus > .split-view,\r\n\t\t\t.variant:focus-within > .split-view {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t}\r\n\r\n\t\t\t.variant:nth-last-of-type(1) {\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.variant.selected:before {\r\n\t\t\t\tbackground-color: var(--uui-color-current);\r\n\t\t\t\tborder-radius: 0 4px 4px 0;\r\n\t\t\t\tbottom: 8px;\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tleft: 0;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 8px;\r\n\t\t\t\twidth: 4px;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tbackground: transparent;\r\n\t\t\t\tcolor: var(--uui-color-current-contrast);\r\n\t\t\t\tpadding: var(--uui-size-space-2) var(--uui-size-space-6);\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.expand-area + .switch-button {\r\n\t\t\t\tpadding-left: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.segment-variant > .switch-button {\r\n\t\t\t\tpadding-left: var(--uui-size-space-6);\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button:hover {\r\n\t\t\t\tbackground: var(--uui-color-surface-emphasis);\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\t\t\t.switch-button .variant-info {\r\n\t\t\t\tflex-grow: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button .variant-details {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: normal;\r\n\t\t\t}\r\n\t\t\t.switch-button .variant-details {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: normal;\r\n\t\t\t}\r\n\t\t\t.switch-button.add-mode .variant-details {\r\n\t\t\t\tcolor: var(--uui-palette-dusty-grey-dark);\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button .specs-info {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: normal;\r\n\t\t\t}\r\n\t\t\t.switch-button.add-mode .specs-info {\r\n\t\t\t\tcolor: var(--uui-palette-dusty-grey-dark);\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button i {\r\n\t\t\t\tfont-weight: normal;\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button.add-mode {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tcolor: var(--uui-palette-dusty-grey-dark);\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button.add-mode:after {\r\n\t\t\t\tborder: 1px dashed var(--uui-color-divider-standalone);\r\n\t\t\t\tbottom: 0;\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tleft: 0;\r\n\t\t\t\tmargin: 2px;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tright: 0;\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button .variant-name {\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t.switch-button.readonly-mode .variant-name {\r\n\t\t\t\tmargin-bottom: calc(var(--uui-size-space-1) * -1);\r\n\t\t\t}\r\n\r\n\t\t\t.add-icon {\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tmargin-right: 21px;\r\n\t\t\t}\r\n\r\n\t\t\t.split-view {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tright: 0;\r\n\t\t\t\tbottom: 1px;\r\n\t\t\t\tdisplay: none;\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\tfont-size: var(--uui-type-small-size);\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-split-view-variant-selector': UmbWorkspaceSplitViewVariantSelectorElement;\r\n\t}\r\n}\r\n","import type { ManifestWorkspaceView } from '../../types.js';\r\nimport { UmbWorkspaceSplitViewContext } from './workspace-split-view.context.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tnothing,\r\n\tproperty,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbDeepPartialObject } from '@umbraco-cms/backoffice/utils';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\n// import local components\r\nimport './workspace-split-view-variant-selector.element.js';\r\n\r\n/**\r\n *\r\n * Example. Document Workspace would use a Variant-component(variant component would talk directly to the workspace-context)\r\n * As well breadcrumbs etc.\r\n *\r\n */\r\n@customElement('umb-workspace-split-view')\r\nexport class UmbWorkspaceSplitViewElement extends UmbLitElement {\r\n\t@property({ type: Boolean })\r\n\tpublic loading = false;\r\n\r\n\t@property({ type: Boolean })\r\n\tdisplayNavigation = false;\r\n\r\n\t@property({ attribute: 'back-path' })\r\n\tpublic backPath?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic overrides?: Array<UmbDeepPartialObject<ManifestWorkspaceView>>;\r\n\r\n\t@property({ type: Number })\r\n\tpublic set splitViewIndex(index: number) {\r\n\t\tthis.splitViewContext.setSplitViewIndex(index);\r\n\t}\r\n\tpublic get splitViewIndex(): number {\r\n\t\treturn this.splitViewContext.getSplitViewIndex()!;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _variantSelectorSlotHasContent = false;\r\n\r\n\t@state()\r\n\tprivate _isNew = false;\r\n\r\n\t@state()\r\n\tprivate _variantId?: UmbVariantId;\r\n\r\n\treadonly splitViewContext = new UmbWorkspaceSplitViewContext(this);\r\n\r\n\t#onVariantSelectorSlotChanged(e: Event) {\r\n\t\tthis._variantSelectorSlotHasContent = (e.target as HTMLSlotElement).assignedNodes({ flatten: true }).length > 0;\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.splitViewContext.isNew,\r\n\t\t\t(isNew) => {\r\n\t\t\t\tthis._isNew = isNew ?? false;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.splitViewContext.variantId,\r\n\t\t\t(variantId) => {\r\n\t\t\t\tthis._variantId = variantId;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-workspace-editor\r\n\t\t\t\t.loading=${this.loading}\r\n\t\t\t\tback-path=${ifDefined(this.backPath)}\r\n\t\t\t\t.hideNavigation=${!this.displayNavigation}\r\n\t\t\t\t.variantId=${this._variantId}\r\n\t\t\t\t.overrides=${this.overrides}\r\n\t\t\t\t.enforceNoFooter=${true}>\r\n\t\t\t\t<slot id=\"icon\" name=\"icon\" slot=\"header\"></slot>\r\n\t\t\t\t<slot id=\"header\" name=\"variant-selector\" slot=\"header\" @slotchange=${this.#onVariantSelectorSlotChanged}>\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\t!this._variantSelectorSlotHasContent,\r\n\t\t\t\t\t\t() => html`<umb-workspace-split-view-variant-selector></umb-workspace-split-view-variant-selector>`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t</slot>\r\n\t\t\t\t${this.#renderEntityActions()}\r\n\t\t\t\t<slot name=\"action-menu\" slot=\"action-menu\"></slot>\r\n\t\t\t</umb-workspace-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEntityActions() {\r\n\t\tif (this._isNew) return nothing;\r\n\t\tif (!this.displayNavigation) return nothing;\r\n\r\n\t\treturn html`<umb-workspace-entity-action-menu\r\n\t\t\tslot=\"action-menu\"\r\n\t\t\tdata-mark=\"workspace:action-menu\"></umb-workspace-entity-action-menu>`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t:host(:not(:last-child)) {\r\n\t\t\t\tborder-right: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t#header {\r\n\t\t\t\tflex: 1 1 auto;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t\tfont-size: var(--uui-size-6);\r\n\t\t\t\tmargin-right: var(--uui-size-space-4);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbWorkspaceSplitViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-split-view': UmbWorkspaceSplitViewElement;\r\n\t}\r\n}\r\n","import { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { css, html, customElement, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-entity-detail-forbidden')\r\nexport class UmbEntityDetailForbiddenElement extends UmbLitElement {\r\n\t@property({ type: String, attribute: 'entity-type' })\r\n\tentityType = '';\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"uui-text\">\r\n\t\t\t\t<h4>${this.localize.term('entityDetail_forbiddenTitle', this.entityType)}</h4>\r\n\t\t\t\t${this.localize.term('entityDetail_forbiddenDescription', this.entityType)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t:host > div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t@keyframes fadeIn {\r\n\t\t\t\t100% {\r\n\t\t\t\t\topacity: 100%;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-entity-detail-forbidden': UmbEntityDetailForbiddenElement;\r\n\t}\r\n}\r\n","import { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { css, html, customElement, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-entity-detail-not-found')\r\nexport class UmbEntityDetailNotFoundElement extends UmbLitElement {\r\n\t@property({ type: String, attribute: 'entity-type' })\r\n\tentityType = '';\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"uui-text\">\r\n\t\t\t\t<h4>${this.localize.term('entityDetail_notFoundTitle', this.entityType)}</h4>\r\n\t\t\t\t${this.localize.term('entityDetail_notFoundDescription', this.entityType)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tmin-width: 0;\r\n\t\t\t}\r\n\r\n\t\t\t:host > div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t@keyframes fadeIn {\r\n\t\t\t\t100% {\r\n\t\t\t\t\topacity: 100%;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-entity-detail-not-found': UmbEntityDetailNotFoundElement;\r\n\t}\r\n}\r\n","import type { UmbWorkspaceContext } from '../workspace-context.interface.js';\r\nimport type { UmbEntityDetailWorkspaceContextBase } from './entity-detail-workspace-base.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_ENTITY_DETAIL_WORKSPACE_CONTEXT = new UmbContextToken<\r\n\tUmbWorkspaceContext,\r\n\tUmbEntityDetailWorkspaceContextBase\r\n>(\r\n\t'UmbWorkspaceContext',\r\n\tundefined,\r\n\t(context): context is UmbEntityDetailWorkspaceContextBase =>\r\n\t\t(context as UmbEntityDetailWorkspaceContextBase).IS_ENTITY_DETAIL_WORKSPACE_CONTEXT,\r\n);\r\n","import { UMB_ENTITY_DETAIL_WORKSPACE_CONTEXT } from '../entity-detail-workspace.context-token.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html, ifDefined, nothing, property, state } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n@customElement('umb-entity-detail-workspace-editor')\r\nexport class UmbEntityDetailWorkspaceEditorElement extends UmbLitElement {\r\n\t@property({ attribute: 'back-path' })\r\n\tpublic backPath?: string;\r\n\r\n\t@state()\r\n\tprivate _entityType?: string;\r\n\r\n\t@state()\r\n\tprivate _isLoading = false;\r\n\r\n\t@state()\r\n\tprivate _isForbidden = false;\r\n\r\n\t@state()\r\n\tprivate _exists = false;\r\n\r\n\t@state()\r\n\tprivate _isNew? = false;\r\n\r\n\t#context?: typeof UMB_ENTITY_DETAIL_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_ENTITY_DETAIL_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#context = context;\r\n\t\t\tthis.observe(this.#context?.entityType, (entityType) => (this._entityType = entityType));\r\n\t\t\tthis.observe(this.#context?.loading.isOn, (isLoading) => (this._isLoading = isLoading ?? false));\r\n\t\t\tthis.observe(this.#context?.forbidden.isOn, (isForbidden) => (this._isForbidden = isForbidden ?? false));\r\n\t\t\tthis.observe(this.#context?.data, (data) => (this._exists = !!data));\r\n\t\t\tthis.observe(this.#context?.isNew, (isNew) => (this._isNew = isNew));\r\n\t\t});\r\n\t}\r\n\r\n\t#renderForbidden() {\r\n\t\tif (!this._isLoading && this._isForbidden) {\r\n\t\t\treturn html`<umb-entity-detail-forbidden\r\n\t\t\t\tentity-type=${ifDefined(this._entityType)}></umb-entity-detail-forbidden>`;\r\n\t\t}\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\t#renderNotFound() {\r\n\t\tif (!this._isLoading && !this._exists) {\r\n\t\t\treturn html`<umb-entity-detail-not-found\r\n\t\t\t\tentity-type=${ifDefined(this._entityType)}></umb-entity-detail-not-found>`;\r\n\t\t}\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\tprotected override render() {\r\n\t\treturn html` ${this.#renderForbidden()} ${this.#renderNotFound()}\r\n\r\n\t\t\t<!-- TODO: It is currently on purpose that the workspace editor is always in the DOM, even when it doesn't have data.\r\n\t\t\t We currently rely on the entity actions to be available to execute, and we ran into an issue when the entity got deleted; then the DOM got cleared, and the delete action couldn't complete.\r\n\t\t\t We need to look into loading the entity actions in the workspace context instead so we don't rely on the DOM.\r\n\t\t -->\r\n\t\t\t<umb-workspace-editor\r\n\t\t\t\t?loading=${this._isLoading}\r\n\t\t\t\t.backPath=${this.backPath}\r\n\t\t\t\tclass=\"${this._exists === false ? 'hide' : ''}\">\r\n\t\t\t\t<slot name=\"header\" slot=\"header\"></slot>\r\n\t\t\t\t${this.#renderEntityActions()}\r\n\t\t\t\t<slot></slot>\r\n\t\t\t</umb-workspace-editor>`;\r\n\t}\r\n\r\n\t#renderEntityActions() {\r\n\t\tif (this._isNew) return nothing;\r\n\t\treturn html`<umb-workspace-entity-action-menu\r\n\t\t\tslot=\"action-menu\"\r\n\t\t\tdata-mark=\"workspace:action-menu\"></umb-workspace-entity-action-menu>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tumb-workspace-editor {\r\n\t\t\t\tvisibility: visible;\r\n\t\t\t}\r\n\r\n\t\t\tumb-workspace-editor.hide {\r\n\t\t\t\tvisibility: hidden;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-entity-detail-workspace-editor': UmbEntityDetailWorkspaceEditorElement;\r\n\t}\r\n}\r\n","import { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbArrayState, UmbStringState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { IComponentRoute, UmbRoute } from '@umbraco-cms/backoffice/router';\r\n\r\n/**\r\n * The workspace route manager.\r\n * @class UmbWorkspaceRouteManager\r\n * @augments {UmbControllerBase}\r\n */\r\nexport class UmbWorkspaceRouteManager extends UmbControllerBase {\r\n\t//\r\n\t#routes = new UmbArrayState<UmbRoute>([], (x) => x.path);\r\n\tpublic readonly routes = this.#routes.asObservable();\r\n\r\n\t#activeLocalPath = new UmbStringState('');\r\n\r\n\t/**\r\n\t * Set the routes for the workspace.\r\n\t * @param {Array<UmbRoute>} routes The routes for the workspace.\r\n\t * @memberof UmbWorkspaceRouteManager\r\n\t */\r\n\tsetRoutes(routes: Array<UmbRoute>) {\r\n\t\tconst allRoutes = [...routes] as Array<IComponentRoute>;\r\n\r\n\t\tif (routes.length > 0) {\r\n\t\t\tallRoutes.push({\r\n\t\t\t\tpath: `**`,\r\n\t\t\t\tcomponent: async () => (await import('@umbraco-cms/backoffice/router')).UmbRouteNotFoundElement,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst mappedRoutes = allRoutes.map((route) => {\r\n\t\t\t// override the setup method to set the active local path\r\n\t\t\tconst oldSetupCallback = route.setup;\r\n\r\n\t\t\troute.setup = (_component: any, info: any) => {\r\n\t\t\t\tthis.#activeLocalPath.setValue(info.match.fragments.consumed);\r\n\r\n\t\t\t\tif (oldSetupCallback) {\r\n\t\t\t\t\toldSetupCallback(_component, info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\treturn route;\r\n\t\t});\r\n\r\n\t\tthis.#routes.setValue([...mappedRoutes]);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the routes for the workspace.\r\n\t * @returns {Array<UmbRoute>} The routes for the workspace.\r\n\t * @memberof UmbWorkspaceRouteManager\r\n\t */\r\n\tgetRoutes(): Array<UmbRoute> {\r\n\t\treturn this.#routes.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Get the active local path.\r\n\t * @returns {*}  {string}\r\n\t * @memberof UmbWorkspaceRouteManager\r\n\t */\r\n\tgetActiveLocalPath(): string {\r\n\t\treturn this.#activeLocalPath.getValue();\r\n\t}\r\n}\r\n","import { UmbWorkspaceRouteManager } from '../controllers/workspace-route-manager.controller.js';\r\nimport { UMB_WORKSPACE_CONTEXT } from '../workspace.context-token.js';\r\nimport type { UmbSubmittableWorkspaceContext } from '../contexts/tokens/submittable-workspace-context.interface.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbBooleanState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbModalContext } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MODAL_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { Observable } from '@umbraco-cms/backoffice/external/rxjs';\r\nimport type { UmbValidationController } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbViewContext } from '@umbraco-cms/backoffice/view';\r\n\r\nexport abstract class UmbSubmittableWorkspaceContextBase<WorkspaceDataModelType>\r\n\textends UmbContextBase\r\n\timplements UmbSubmittableWorkspaceContext\r\n{\r\n\tpublic readonly workspaceAlias: string;\r\n\r\n\t// TODO: We could make a base type for workspace modal data, and use this here: As well as a base for the result, to make sure we always include the unique (instead of the object type)\r\n\tpublic readonly modalContext?: UmbModalContext<{ preset: object }>;\r\n\r\n\t#validationContexts: Array<UmbValidationController> = [];\r\n\r\n\tpublic readonly view = new UmbViewContext(this, null);\r\n\r\n\t/**\r\n\t * Appends a validation context to the workspace.\r\n\t * @param context\r\n\t */\r\n\taddValidationContext(context: UmbValidationController) {\r\n\t\tthis.#validationContexts.push(context);\r\n\t}\r\n\r\n\t#submitPromise: Promise<void> | undefined;\r\n\t#submitResolve: (() => void) | undefined;\r\n\t#submitReject: ((reason?: any) => void) | undefined;\r\n\r\n\tabstract readonly unique: Observable<string | null | undefined>;\r\n\r\n\t#isNew = new UmbBooleanState(undefined);\r\n\tisNew = this.#isNew.asObservable();\r\n\r\n\treadonly routes = new UmbWorkspaceRouteManager(this);\r\n\r\n\t/*\r\n\t\tConcept notes: [NL]\r\n\t\tConsiderations are, if we bring a dirty state (observable) we need to maintain it all the time.\r\n\t\tThis might be too heavy process, so we might want to consider just having a get dirty state method.\r\n\t*/\r\n\t//#isDirty = new UmbBooleanState(undefined);\r\n\t//isDirty = this.#isNew.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost, workspaceAlias: string) {\r\n\t\tsuper(host, UMB_WORKSPACE_CONTEXT.toString());\r\n\t\tthis.workspaceAlias = workspaceAlias;\r\n\t\t// TODO: Consider if we can move this consumption to #resolveSubmit, just as a getContext, but it depends if others use the modalContext prop.. [NL]\r\n\t\tthis.consumeContext(UMB_MODAL_CONTEXT, (context) => {\r\n\t\t\t(this.modalContext as UmbModalContext | undefined) = context;\r\n\t\t});\r\n\r\n\t\tthis.view.shortcuts.addOne({\r\n\t\t\tkey: 's',\r\n\t\t\tmodifier: true,\r\n\t\t\taction: () => this.requestSubmit(),\r\n\t\t\tlabel: '#general_submit',\r\n\t\t});\r\n\t}\r\n\r\n\tprotected resetState() {\r\n\t\tthis.#validationContexts.forEach((context) => context.reset());\r\n\t\tthis.#isNew.setValue(undefined);\r\n\t}\r\n\r\n\tpublic getIsNew() {\r\n\t\treturn this.#isNew.getValue();\r\n\t}\r\n\r\n\tprotected setIsNew(isNew: boolean) {\r\n\t\tthis.#isNew.setValue(isNew);\r\n\t}\r\n\r\n\t/**\r\n\t * If a Workspace has multiple validation contexts, then this method can be overwritten to return the correct one.\r\n\t * @returns Promise that resolves to void when the validation is complete.\r\n\t */\r\n\tpublic async validate(): Promise<Array<void>> {\r\n\t\treturn await Promise.all(this.#validationContexts.map((context) => context.validate()));\r\n\t}\r\n\r\n\tpublic async requestSubmit(): Promise<void> {\r\n\t\treturn this.validateAndSubmit(\r\n\t\t\t() => this.submit(),\r\n\t\t\t(reason?: any) => this.invalidSubmit(reason),\r\n\t\t);\r\n\t}\r\n\r\n\tprotected async _validateAndLog(): Promise<void> {\r\n\t\tawait this.validate().catch(async () => {\r\n\t\t\t// TODO: Implement developer-mode logging here. [NL]\r\n\t\t\tconsole.warn(\r\n\t\t\t\t'Validation failed because of these validation messages still begin present: ',\r\n\t\t\t\tthis.#validationContexts.flatMap((x) => x.messages.getMessages()),\r\n\t\t\t);\r\n\t\t\treturn Promise.reject();\r\n\t\t});\r\n\t}\r\n\r\n\tpublic async validateAndSubmit(\r\n\t\tonValid: () => Promise<void>,\r\n\t\tonInvalid: (reason?: any) => Promise<void>,\r\n\t): Promise<void> {\r\n\t\tif (this.#submitPromise) {\r\n\t\t\treturn this.#submitPromise;\r\n\t\t}\r\n\t\tthis.#submitPromise = new Promise<void>((resolve, reject) => {\r\n\t\t\tthis.#submitResolve = resolve;\r\n\t\t\tthis.#submitReject = reject;\r\n\t\t});\r\n\t\tthis._validateAndLog().then(\r\n\t\t\tasync () => {\r\n\t\t\t\tonValid().then(this.#completeSubmit, this.#rejectSubmit);\r\n\t\t\t},\r\n\t\t\tasync (error) => {\r\n\t\t\t\tonInvalid(error).then(this.#resolveSubmit, this.#rejectSubmit);\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\treturn await this.#submitPromise;\r\n\t}\r\n\r\n\t#rejectSubmit = (error: any) => {\r\n\t\tif (this.#submitPromise) {\r\n\t\t\t// TODO: Capture the validation contexts messages on open, and then reset to them in this case. [NL]\r\n\r\n\t\t\tthis.#submitReject?.(error);\r\n\t\t\tthis.#submitPromise = undefined;\r\n\t\t\tthis.#submitResolve = undefined;\r\n\t\t\tthis.#submitReject = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\t#resolveSubmit = () => {\r\n\t\t// Resolve the submit promise:\r\n\t\tthis.#submitResolve?.();\r\n\t\tthis.#submitPromise = undefined;\r\n\t\tthis.#submitResolve = undefined;\r\n\t\tthis.#submitReject = undefined;\r\n\t};\r\n\r\n\t#completeSubmit = () => {\r\n\t\tthis.#resolveSubmit();\r\n\r\n\t\t// Calling reset on the validation context here. [NL]\r\n\t\t// TODO: Capture the validation messages on open, and then reset to that.\r\n\t\t//this.validation.reset();\r\n\r\n\t\tthis._closeModal();\r\n\t};\r\n\r\n\tprotected _closeModal() {\r\n\t\tif (this.modalContext) {\r\n\t\t\tthis.modalContext?.setValue(this.getData());\r\n\t\t\tthis.modalContext?.submit();\r\n\t\t}\r\n\t}\r\n\r\n\t//abstract getIsDirty(): Promise<boolean>;\r\n\tabstract getUnique(): string | null | undefined;\r\n\tabstract getEntityType(): string;\r\n\tabstract getData(): WorkspaceDataModelType | undefined;\r\n\tprotected abstract submit(): Promise<void>;\r\n\tprotected invalidSubmit(reason?: any): Promise<void> {\r\n\t\treturn Promise.reject(reason);\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#isNew.destroy();\r\n\t\tthis.routes.destroy();\r\n\t\tsuper.destroy();\r\n\t\tthis.#submitPromise = undefined;\r\n\t\tthis.#submitResolve = undefined;\r\n\t\tthis.#submitReject = undefined;\r\n\t\tthis.#validationContexts.forEach((context) => context.destroy());\r\n\t\tthis.#validationContexts = [];\r\n\t}\r\n}\r\n\r\n/*\r\n * @deprecated Use UmbSubmittableWorkspaceContextBase instead  Will be removed before RC.\r\n * Rename `save` to `submit` and return a promise that resolves to true when save is complete.\r\n * TODO: Delete before RC.\r\n */\r\nexport abstract class UmbEditableWorkspaceContextBase<\r\n\tWorkspaceDataModelType,\r\n> extends UmbSubmittableWorkspaceContextBase<WorkspaceDataModelType> {}\r\n","import type { UmbWorkspaceDataManager } from '../data-manager/workspace-data-manager.interface.js';\r\nimport { jsonStringComparison, UmbObjectState, type MappingFunction } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\n\r\n/**\r\n * Manages the workspace data for an entity.\r\n * @class UmbEntityWorkspaceDataManager\r\n * @augments {UmbControllerBase}\r\n * @implements {UmbWorkspaceDataManager<ModelType>}\r\n * @template ModelType\r\n */\r\nexport class UmbEntityWorkspaceDataManager<ModelType>\r\n\textends UmbControllerBase\r\n\timplements UmbWorkspaceDataManager<ModelType>\r\n{\r\n\tprotected readonly _persisted = new UmbObjectState<ModelType | undefined>(undefined);\r\n\tprotected readonly _current = new UmbObjectState<ModelType | undefined>(undefined);\r\n\r\n\t/**\r\n\t * Observable of the persisted data\r\n\t * @memberof UmbEntityWorkspaceDataManager\r\n\t */\r\n\tpublic readonly persisted = this._persisted.asObservable();\r\n\r\n\t/**\r\n\t * Observable of the current data\r\n\t * @memberof UmbEntityWorkspaceDataManager\r\n\t */\r\n\tpublic readonly current = this._current.asObservable();\r\n\r\n\tprotected _sortCurrentData<GivenType extends Partial<ModelType> = Partial<ModelType>>(\r\n\t\tpersistedData: Partial<ModelType>,\r\n\t\tcurrentData: GivenType,\r\n\t): GivenType {\r\n\t\t// do nothing.\r\n\t\treturn currentData;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets persisted data\r\n\t * @returns {(ModelType | undefined)}\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tgetPersisted() {\r\n\t\treturn this._persisted.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the persisted data\r\n\t * @param {(ModelType | undefined)} data\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tsetPersisted(data: ModelType | undefined) {\r\n\t\tthis._persisted.setValue(data);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the persisted data\r\n\t * @param {Partial<ModelType>} partialData\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tupdatePersisted(partialData: Partial<ModelType>) {\r\n\t\tthis._persisted.update(partialData);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an observable part of the persisted data\r\n\t * @template ReturnType\r\n\t * @param {(MappingFunction<ModelType | undefined, ReturnType>)} mappingFunction\r\n\t * @returns {*}\r\n\t * @memberof UmbEntityWorkspaceDataManager\r\n\t */\r\n\tcreateObservablePartOfPersisted<ReturnType>(mappingFunction: MappingFunction<ModelType | undefined, ReturnType>) {\r\n\t\treturn this._persisted.asObservablePart(mappingFunction);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the current data\r\n\t * @returns {(ModelType | undefined)}\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tgetCurrent() {\r\n\t\treturn this._current.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the current data\r\n\t * @param {(ModelType | undefined)} data\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tsetCurrent(data: ModelType | undefined) {\r\n\t\tif (data) {\r\n\t\t\tconst persistedData = this._persisted.getValue();\r\n\t\t\tif (persistedData) {\r\n\t\t\t\tdata = this._sortCurrentData(persistedData, data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._current.setValue(data);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the current data\r\n\t * @param {Partial<ModelType>} partialData\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tupdateCurrent(partialData: Partial<ModelType>) {\r\n\t\tif (partialData) {\r\n\t\t\tconst persistedData = this._persisted.getValue();\r\n\t\t\tif (persistedData) {\r\n\t\t\t\tpartialData = this._sortCurrentData(persistedData, partialData);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._current.update(partialData);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an observable part of the current data\r\n\t * @template ReturnType\r\n\t * @param {(MappingFunction<ModelType | undefined, ReturnType>)} mappingFunction\r\n\t * @returns {*}\r\n\t * @memberof UmbEntityWorkspaceDataManager\r\n\t */\r\n\tcreateObservablePartOfCurrent<ReturnType>(mappingFunction: MappingFunction<ModelType | undefined, ReturnType>) {\r\n\t\treturn this._current.asObservablePart(mappingFunction);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if there are unpersisted changes\r\n\t * @returns {*}\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tgetHasUnpersistedChanges() {\r\n\t\tconst persisted = this._persisted.getValue();\r\n\t\tconst current = this._current.getValue();\r\n\t\tconst result = jsonStringComparison(persisted, current) === false;\r\n\t\t// TODO: Implement developer-mode\r\n\t\tif (result) {\r\n\t\t\tconsole.warn('Changes detected based on JSON comparison between', persisted, 'and', current);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the current data to the persisted data\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tresetCurrent() {\r\n\t\tthis._current.setValue(this._persisted.getValue());\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the data\r\n\t * @memberof UmbSubmittableWorkspaceDataManager\r\n\t */\r\n\tclear() {\r\n\t\tthis._persisted.setValue(undefined);\r\n\t\tthis._current.setValue(undefined);\r\n\t}\r\n\r\n\toverride destroy() {\r\n\t\tthis._persisted?.destroy();\r\n\t\tthis._current?.destroy();\r\n\r\n\t\t(this._persisted as any) = undefined;\r\n\t\t(this._current as any) = undefined;\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","import { UmbSubmittableWorkspaceContextBase } from '../submittable/index.js';\r\nimport { UmbEntityWorkspaceDataManager } from '../entity/entity-workspace-data-manager.js';\r\nimport type { UmbSubmittableTreeEntityWorkspaceContext } from '../contexts/tokens/index.js';\r\nimport type { UmbEntityDetailWorkspaceContextArgs, UmbEntityDetailWorkspaceContextCreateArgs } from './types.js';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbEntityContext, type UmbEntityModel, type UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport { UMB_DISCARD_CHANGES_MODAL, umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport {\r\n\tUmbEntityUpdatedEvent,\r\n\tUmbRequestReloadChildrenOfEntityEvent,\r\n\tUmbRequestReloadStructureForEntityEvent,\r\n} from '@umbraco-cms/backoffice/entity-action';\r\nimport { UmbExtensionApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { umbExtensionsRegistry, type ManifestRepository } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type {\r\n\tUmbDetailRepository,\r\n\tUmbRepositoryResponse,\r\n\tUmbRepositoryResponseWithAsObservable,\r\n} from '@umbraco-cms/backoffice/repository';\r\nimport { UmbDeprecation, UmbStateManager } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbValidationContext } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport { UmbApiError } from '@umbraco-cms/backoffice/resources';\r\n\r\nconst LOADING_STATE_UNIQUE = 'umbLoadingEntityDetail';\r\nconst FORBIDDEN_STATE_UNIQUE = 'umbForbiddenEntityDetail';\r\n\r\nexport abstract class UmbEntityDetailWorkspaceContextBase<\r\n\t\tDetailModelType extends UmbEntityModel = UmbEntityModel,\r\n\t\tDetailRepositoryType extends UmbDetailRepository<DetailModelType> = UmbDetailRepository<DetailModelType>,\r\n\t\tCreateArgsType extends\r\n\t\t\tUmbEntityDetailWorkspaceContextCreateArgs<DetailModelType> = UmbEntityDetailWorkspaceContextCreateArgs<DetailModelType>,\r\n\t>\r\n\textends UmbSubmittableWorkspaceContextBase<DetailModelType>\r\n\timplements UmbSubmittableTreeEntityWorkspaceContext\r\n{\r\n\t// Just for context token safety:\r\n\tpublic readonly IS_ENTITY_DETAIL_WORKSPACE_CONTEXT = true;\r\n\r\n\t/**\r\n\t * @description Data manager for the workspace.\r\n\t * @protected\r\n\t * @memberof UmbEntityWorkspaceContextBase\r\n\t */\r\n\tprotected readonly _data = new UmbEntityWorkspaceDataManager<DetailModelType>(this);\r\n\r\n\t#entityContext = new UmbEntityContext(this);\r\n\tpublic readonly entityType = this.#entityContext.entityType;\r\n\tpublic readonly unique = this.#entityContext.unique;\r\n\r\n\tpublic readonly data = this._data.current;\r\n\tpublic readonly persistedData = this._data.persisted;\r\n\tpublic readonly loading = new UmbStateManager(this);\r\n\tpublic readonly forbidden = new UmbStateManager(this);\r\n\r\n\tprotected _getDataPromise?: Promise<\r\n\t\tUmbRepositoryResponse<DetailModelType> | UmbRepositoryResponseWithAsObservable<DetailModelType>\r\n\t>;\r\n\tprotected _detailRepository?: DetailRepositoryType;\r\n\r\n\t#eventContext?: typeof UMB_ACTION_EVENT_CONTEXT.TYPE;\r\n\r\n\t#createUnderParent = new UmbObjectState<UmbEntityModel | undefined>(undefined);\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic readonly _internal_createUnderParent = this.#createUnderParent.asObservable();\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic readonly _internal_createUnderParentEntityUnique = this.#createUnderParent.asObservablePart((parent) =>\r\n\t\tparent ? parent.unique : undefined,\r\n\t);\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\tpublic readonly _internal_createUnderParentEntityType = this.#createUnderParent.asObservablePart((parent) =>\r\n\t\tparent ? parent.entityType : undefined,\r\n\t);\r\n\r\n\t/**\r\n\t * @deprecated Will be removed in v.18: Use UMB_PARENT_ENTITY_CONTEXT instead to get the parent both when creating and editing.\r\n\t */\r\n\tpublic readonly parentUnique = this.#createUnderParent.asObservablePart((parent) =>\r\n\t\tparent ? parent.unique : undefined,\r\n\t);\r\n\t/**\r\n\t * @deprecated Will be removed in v.18: Use UMB_PARENT_ENTITY_CONTEXT instead to get the parent both when creating and editing.\r\n\t */\r\n\tpublic readonly parentEntityType = this.#createUnderParent.asObservablePart((parent) =>\r\n\t\tparent ? parent.entityType : undefined,\r\n\t);\r\n\r\n\t/**\r\n\t * The base validation context for the workspace. This ensures that at least one validation context is always present.\r\n\t * @example You can manually validate all properties on the context:\r\n\t * ```ts\r\n\t * try {\r\n\t *   await this.validationContext.validate();\r\n\t * } catch (error) {\r\n\t *   console.error(error);\r\n\t * }\r\n\t * ```\r\n\t * @example You can set the data path on the context to map to a specific part of the server validation:\r\n\t * ```ts\r\n\t * this.validationContext.setDataPath('path.to.data');\r\n\t * ```\r\n\t */\r\n\tprotected validationContext = new UmbValidationContext(this);\r\n\r\n\t#initResolver?: () => void;\r\n\t#initialized = false;\r\n\r\n\t#init = new Promise<void>((resolve) => {\r\n\t\tif (this.#initialized) {\r\n\t\t\tresolve();\r\n\t\t} else {\r\n\t\t\tthis.#initResolver = resolve;\r\n\t\t}\r\n\t});\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbEntityDetailWorkspaceContextArgs) {\r\n\t\tsuper(host, args.workspaceAlias);\r\n\t\tthis.addValidationContext(this.validationContext);\r\n\t\tthis.#entityContext.setEntityType(args.entityType);\r\n\t\twindow.addEventListener('willchangestate', this.#onWillNavigate);\r\n\t\tthis.#observeRepository(args.detailRepositoryAlias);\r\n\r\n\t\tthis.consumeContext(UMB_ACTION_EVENT_CONTEXT, (context) => {\r\n\t\t\tthis.#eventContext = context;\r\n\r\n\t\t\tthis.#eventContext?.removeEventListener(\r\n\t\t\t\tUmbEntityUpdatedEvent.TYPE,\r\n\t\t\t\tthis.#onEntityUpdatedEvent as unknown as EventListener,\r\n\t\t\t);\r\n\t\t\tthis.#eventContext?.addEventListener(\r\n\t\t\t\tUmbEntityUpdatedEvent.TYPE,\r\n\t\t\t\tthis.#onEntityUpdatedEvent as unknown as EventListener,\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Get the entity type\r\n\t * @returns { string } The entity type\r\n\t */\r\n\tgetEntityType(): string {\r\n\t\tconst entityType = this.#entityContext.getEntityType();\r\n\t\tif (!entityType) throw new Error('Entity type is not set');\r\n\t\treturn entityType;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current data\r\n\t * @returns { DetailModelType | undefined } The entity context\r\n\t */\r\n\tgetData(): DetailModelType | undefined {\r\n\t\treturn this._data.getCurrent();\r\n\t}\r\n\r\n\t/**\r\n\t * Get the persisted data\r\n\t * @returns { DetailModelType | undefined } The persisted data\r\n\t */\r\n\tpublic getPersistedData(): DetailModelType | undefined {\r\n\t\treturn this._data.getPersisted();\r\n\t}\r\n\r\n\t/**\r\n\t * Get the unique\r\n\t * @returns { string | undefined } The unique identifier\r\n\t */\r\n\tgetUnique(): UmbEntityUnique | undefined {\r\n\t\treturn this.#entityContext.getUnique();\r\n\t}\r\n\r\n\tsetUnique(unique: string) {\r\n\t\tthis.#entityContext.setUnique(unique);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the parent that a new entity will be created under.\r\n\t * @returns { UmbEntityModel | undefined } The parent entity\r\n\t */\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_internal_getCreateUnderParent(): UmbEntityModel | undefined {\r\n\t\treturn this.#createUnderParent.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the parent that a new entity will be created under.\r\n\t * @param {UmbEntityModel} parent The parent entity\r\n\t */\r\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\r\n\t_internal_setCreateUnderParent(parent: UmbEntityModel): void {\r\n\t\tthis.#createUnderParent.setValue(parent);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the parent\r\n\t * @deprecated Will be removed in v.18: Use UMB_PARENT_ENTITY_CONTEXT instead to get the parent both when creating and editing.\r\n\t * @returns { UmbEntityModel | undefined } The parent entity\r\n\t */\r\n\tgetParent(): UmbEntityModel | undefined {\r\n\t\treturn this.#createUnderParent.getValue();\r\n\t}\r\n\r\n\t/**\r\n\t * Set the parent\r\n\t * @deprecated Will be removed in v.18.\r\n\t * @param { UmbEntityModel } parent The parent entity\r\n\t */\r\n\tsetParent(parent: UmbEntityModel) {\r\n\t\tthis.#createUnderParent.setValue(parent);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the parent unique\r\n\t * @deprecated Will be removed in v.18: Use UMB_PARENT_ENTITY_CONTEXT instead to get the parent both when creating and editing.\r\n\t * @returns { string | undefined } The parent unique identifier\r\n\t */\r\n\tgetParentUnique(): UmbEntityUnique | undefined {\r\n\t\treturn this.#createUnderParent.getValue()?.unique;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the parent entity type\r\n\t * @deprecated Will be removed in v.18\r\n\t * @returns { string | undefined } The parent entity type\r\n\t */\r\n\tgetParentEntityType() {\r\n\t\treturn this.#createUnderParent.getValue()?.entityType;\r\n\t}\r\n\r\n\tasync load(\r\n\t\tunique: string,\r\n\t): Promise<UmbRepositoryResponse<DetailModelType> | UmbRepositoryResponseWithAsObservable<DetailModelType>> {\r\n\t\tif (unique === this.getUnique() && this._getDataPromise) {\r\n\t\t\treturn await this._getDataPromise;\r\n\t\t}\r\n\t\tthis.resetState();\r\n\t\tthis.setIsNew(false);\r\n\t\tthis.#entityContext.setUnique(unique);\r\n\t\tthis.loading.addState({ unique: LOADING_STATE_UNIQUE, message: `Loading ${this.getEntityType()} Details` });\r\n\t\tawait this.#init;\r\n\t\tthis._getDataPromise = this._detailRepository!.requestByUnique(unique);\r\n\t\tconst response = (await this._getDataPromise) as UmbRepositoryResponseWithAsObservable<DetailModelType>;\r\n\t\tconst { data, error, asObservable } = response;\r\n\r\n\t\tif (error) {\r\n\t\t\tthis.removeUmbControllerByAlias('umbEntityDetailTypeStoreObserver');\r\n\t\t\tif (UmbApiError.isUmbApiError(error)) {\r\n\t\t\t\tif (error.status === 401 || error.status === 403) {\r\n\t\t\t\t\tthis.forbidden.addState({ unique: FORBIDDEN_STATE_UNIQUE, message: error.message });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (data) {\r\n\t\t\tconst processedData = await this._processIncomingData(data);\r\n\r\n\t\t\tthis._data.setPersisted(processedData);\r\n\t\t\tthis._data.setCurrent(processedData);\r\n\r\n\t\t\tthis.observe(asObservable?.(), (entity) => this.#onDetailStoreChange(entity), 'umbEntityDetailTypeStoreObserver');\r\n\t\t}\r\n\r\n\t\tthis.loading.removeState(LOADING_STATE_UNIQUE);\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/**\r\n\t * Reload the workspace data\r\n\t * @returns { Promise<void> } The promise of the reload\r\n\t */\r\n\tpublic async reload(): Promise<void> {\r\n\t\tconst unique = this.getUnique();\r\n\t\tif (!unique) throw new Error('Unique is not set');\r\n\t\tconst { data } = await this._detailRepository!.requestByUnique(unique);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis._data.setPersisted(data);\r\n\t\t\tthis._data.setCurrent(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Method to check if the workspace data is loaded.\r\n\t * @returns { Promise<any> | undefined } true if the workspace data is loaded.\r\n\t * @memberof UmbEntityWorkspaceContextBase\r\n\t */\r\n\tpublic isLoaded(): Promise<any> | undefined {\r\n\t\treturn this._getDataPromise;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a data scaffold\r\n\t * @param {CreateArgsType} args The arguments to create the scaffold.\r\n\t * @param {UmbEntityModel} args.parent The parent entity.\r\n\t * @param {UmbEntityUnique} args.parent.unique The unique identifier of the parent entity.\r\n\t * @param {string} args.parent.entityType The entity type of the parent entity.\r\n\t * @param {Partial<DetailModelType>} args.preset The preset data.\r\n\t * @returns { Promise<any> | undefined } The data of the scaffold.\r\n\t */\r\n\tpublic async createScaffold(args: CreateArgsType) {\r\n\t\tthis.resetState();\r\n\t\tthis.loading.addState({ unique: LOADING_STATE_UNIQUE, message: `Creating ${this.getEntityType()} scaffold` });\r\n\t\tawait this.#init;\r\n\t\t// keeping setParent for backwards compatibility. Remove in v18.\r\n\t\tthis.setParent(args.parent);\r\n\t\tthis._internal_setCreateUnderParent(args.parent);\r\n\r\n\t\tconst request = this._detailRepository!.createScaffold(args.preset);\r\n\t\tthis._getDataPromise = request;\r\n\t\tlet { data } = await request;\r\n\r\n\t\tif (data) {\r\n\t\t\tdata = await this._processIncomingData(data);\r\n\t\t\tdata = await this._scaffoldProcessData(data);\r\n\r\n\t\t\tif (this.modalContext) {\r\n\t\t\t\t// Notice if the preset comes with values, they will overwrite the scaffolded values... [NL]\r\n\t\t\t\tdata = { ...data, ...this.modalContext.data.preset };\r\n\t\t\t}\r\n\r\n\t\t\tthis.setIsNew(true);\r\n\t\t\tthis.#entityContext.setUnique(data.unique);\r\n\t\t\tthis._data.setPersisted(data);\r\n\t\t\tthis._data.setCurrent(data);\r\n\t\t}\r\n\r\n\t\tthis.loading.removeState(LOADING_STATE_UNIQUE);\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated Override `_processIncomingData` instead. `_scaffoldProcessData` will be removed in v.18.\r\n\t * @param {DetailModelType} data - The data to process.\r\n\t * @returns {Promise<DetailModelType>} The processed data.\r\n\t */\r\n\tprotected async _scaffoldProcessData(data: DetailModelType): Promise<DetailModelType> {\r\n\t\treturn data;\r\n\t}\r\n\tprotected async _processIncomingData(data: DetailModelType): Promise<DetailModelType> {\r\n\t\treturn data;\r\n\t}\r\n\r\n\tasync submit() {\r\n\t\tawait this.#init;\r\n\t\tconst currentData = this.getData();\r\n\r\n\t\tif (!currentData) {\r\n\t\t\tthrow new Error('Data is not set');\r\n\t\t}\r\n\r\n\t\tif (currentData.unique === undefined) {\r\n\t\t\tthrow new Error('Unique is not set');\r\n\t\t}\r\n\r\n\t\tif (this.getIsNew()) {\r\n\t\t\tconst parent = this.#createUnderParent.getValue();\r\n\t\t\tif (parent?.unique === undefined) throw new Error('Parent unique is missing');\r\n\t\t\tif (!parent.entityType) throw new Error('Parent entity type is missing');\r\n\t\t\tawait this._create(currentData, parent);\r\n\t\t} else {\r\n\t\t\tawait this._update(currentData);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes the entity.\r\n\t * @param unique The unique identifier of the entity to delete.\r\n\t */\r\n\tasync delete(unique: string) {\r\n\t\tawait this.#init;\r\n\t\tawait this._detailRepository!.delete(unique);\r\n\t}\r\n\r\n\t/**\r\n\t * Check if the workspace is about to navigate away.\r\n\t * @protected\r\n\t * @param {string} newUrl The new url that the workspace is navigating to.\r\n\t * @returns { boolean} true if the workspace is navigating away.\r\n\t * @memberof UmbEntityWorkspaceContextBase\r\n\t */\r\n\tprotected _checkWillNavigateAway(newUrl: string): boolean {\r\n\t\treturn !newUrl.includes(this.routes.getActiveLocalPath());\r\n\t}\r\n\r\n\tprotected async _create(currentData: DetailModelType, parent: UmbEntityModel) {\r\n\t\tif (!this._detailRepository) throw new Error('Detail repository is not set');\r\n\r\n\t\tconst { error, data } = await this._detailRepository.create(currentData, parent.unique);\r\n\t\tif (error || !data) {\r\n\t\t\tthrow error?.message ?? 'Repository did not return data after create.';\r\n\t\t}\r\n\r\n\t\tthis.#entityContext.setUnique(data.unique);\r\n\t\tthis._data.setPersisted(data);\r\n\t\tthis._data.setCurrent(data);\r\n\t\tthis.setIsNew(false);\r\n\r\n\t\tconst eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\t\tif (!eventContext) throw new Error('Event context not found.');\r\n\r\n\t\tconst reloadStructureEvent = new UmbRequestReloadStructureForEntityEvent({\r\n\t\t\tentityType: parent.entityType,\r\n\t\t\tunique: parent.unique,\r\n\t\t});\r\n\r\n\t\teventContext.dispatchEvent(reloadStructureEvent);\r\n\r\n\t\tconst reloadChildren = new UmbRequestReloadChildrenOfEntityEvent({\r\n\t\t\tentityType: parent.entityType,\r\n\t\t\tunique: parent.unique,\r\n\t\t});\r\n\r\n\t\teventContext.dispatchEvent(reloadChildren);\r\n\t}\r\n\r\n\tprotected async _update(currentData: DetailModelType) {\r\n\t\tconst { error, data } = await this._detailRepository!.save(currentData);\r\n\t\tif (error || !data) {\r\n\t\t\tthrow error?.message ?? 'Repository did not return data after create.';\r\n\t\t}\r\n\r\n\t\tthis._data.setPersisted(data);\r\n\t\tthis._data.setCurrent(data);\r\n\r\n\t\tconst unique = this.getUnique()!;\r\n\t\tconst entityType = this.getEntityType();\r\n\r\n\t\tconst eventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\t\tif (!eventContext) throw new Error('Event context not found.');\r\n\t\tconst event = new UmbRequestReloadStructureForEntityEvent({ unique, entityType });\r\n\r\n\t\teventContext.dispatchEvent(event);\r\n\r\n\t\tconst updatedEvent = new UmbEntityUpdatedEvent({\r\n\t\t\tunique,\r\n\t\t\tentityType,\r\n\t\t\teventUnique: this._workspaceEventUnique,\r\n\t\t});\r\n\r\n\t\teventContext.dispatchEvent(updatedEvent);\r\n\t}\r\n\r\n\t#allowNavigateAway = false;\r\n\r\n\t#onWillNavigate = async (e: CustomEvent) => {\r\n\t\tconst newUrl = e.detail.url;\r\n\r\n\t\tif (this.#allowNavigateAway) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (this._checkWillNavigateAway(newUrl) && this.getHasUnpersistedChanges()) {\r\n\t\t\t/* Since ours modals are async while events are synchronous, we need to prevent the default behavior of the event, even if the modal hasnt been resolved yet.\r\n\t\t\tOnce the modal is resolved (the user accepted to discard the changes and navigate away from the route), we will push a new history state.\r\n\t\t\tThis push will make the \"willchangestate\" event happen again and due to this somewhat \"backward\" behavior,\r\n\t\t\twe set an \"allowNavigateAway\"-flag to prevent the \"discard-changes\" functionality from running in a loop.*/\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\ttry {\r\n\t\t\t\t// navigate to the new url when discarding changes\r\n\t\t\t\tawait umbOpenModal(this, UMB_DISCARD_CHANGES_MODAL);\r\n\t\t\t\tthis.#allowNavigateAway = true;\r\n\t\t\t\thistory.pushState({}, '', e.detail.url);\r\n\t\t\t\treturn true;\r\n\t\t\t} catch {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\t/**\r\n\t * Check if there are unpersisted changes.\r\n\t * @returns { boolean } true if there are unpersisted changes.\r\n\t */\r\n\tpublic getHasUnpersistedChanges(): boolean {\r\n\t\treturn this._data.getHasUnpersistedChanges();\r\n\t}\r\n\t// @deprecated use getHasUnpersistedChanges instead, will be removed in v17.0\r\n\tprotected _getHasUnpersistedChanges(): boolean {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tremoveInVersion: '17',\r\n\t\t\tdeprecated: '_getHasUnpersistedChanges',\r\n\t\t\tsolution: 'use public getHasUnpersistedChanges instead.',\r\n\t\t}).warn();\r\n\t\treturn this.getHasUnpersistedChanges();\r\n\t}\r\n\r\n\toverride resetState() {\r\n\t\tsuper.resetState();\r\n\t\tthis.loading.clear();\r\n\t\tthis.forbidden.clear();\r\n\t\tthis._data.clear();\r\n\t\tthis.#allowNavigateAway = false;\r\n\t\tthis._getDataPromise = undefined;\r\n\t}\r\n\r\n\t#checkIfInitialized() {\r\n\t\tif (this._detailRepository) {\r\n\t\t\tthis.#initialized = true;\r\n\t\t\tthis.#initResolver?.();\r\n\t\t}\r\n\t}\r\n\r\n\t#observeRepository(repositoryAlias: string) {\r\n\t\tif (!repositoryAlias) throw new Error('Entity Workspace must have a repository alias.');\r\n\r\n\t\tnew UmbExtensionApiInitializer<ManifestRepository<DetailRepositoryType>>(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\trepositoryAlias,\r\n\t\t\t[],\r\n\t\t\t(permitted, ctrl) => {\r\n\t\t\t\tthis._detailRepository = permitted ? ctrl.api : undefined;\r\n\t\t\t\tthis.#checkIfInitialized();\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\t#onDetailStoreChange(entity: DetailModelType | undefined) {\r\n\t\tif (!entity) {\r\n\t\t\tthis._data.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t// Discriminator to identify events from this workspace context\r\n\tprotected readonly _workspaceEventUnique = UmbId.new();\r\n\r\n\t#onEntityUpdatedEvent = (event: UmbEntityUpdatedEvent) => {\r\n\t\tconst eventEntityUnique = event.getUnique();\r\n\t\tconst eventEntityType = event.getEntityType();\r\n\t\tconst eventDiscriminator = event.getEventUnique();\r\n\r\n\t\t// Ignore events for other entities\r\n\t\tif (eventEntityType !== this.getEntityType()) return;\r\n\t\tif (eventEntityUnique !== this.getUnique()) return;\r\n\r\n\t\t// Ignore events from this workspace so we don't reload the data twice. Ex saving this workspace\r\n\t\tif (eventDiscriminator === this._workspaceEventUnique) return;\r\n\r\n\t\tthis.reload();\r\n\t};\r\n\r\n\tpublic override destroy(): void {\r\n\t\twindow.removeEventListener('willchangestate', this.#onWillNavigate);\r\n\t\tthis.#eventContext?.removeEventListener(\r\n\t\t\tUmbEntityUpdatedEvent.TYPE,\r\n\t\t\tthis.#onEntityUpdatedEvent as unknown as EventListener,\r\n\t\t);\r\n\t\tthis._detailRepository?.destroy();\r\n\t\tthis.#entityContext.destroy();\r\n\t\tthis._getDataPromise = undefined;\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","import type { UmbWorkspaceContext } from '../workspace-context.interface.js';\r\nimport type { UmbEntityNamedDetailWorkspaceContextBase } from './entity-named-detail-workspace-base.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_ENTITY_NAMED_DETAIL_WORKSPACE_CONTEXT = new UmbContextToken<\r\n\tUmbWorkspaceContext,\r\n\tUmbEntityNamedDetailWorkspaceContextBase\r\n>(\r\n\t'UmbWorkspaceContext',\r\n\tundefined,\r\n\t(context): context is UmbEntityNamedDetailWorkspaceContextBase =>\r\n\t\t(context as UmbEntityNamedDetailWorkspaceContextBase).IS_ENTITY_NAMED_DETAIL_WORKSPACE_CONTEXT,\r\n);\r\n","import type { UmbNamableWorkspaceContext } from '../types.js';\r\nimport { UmbNameWriteGuardManager } from '../namable/index.js';\r\nimport { UmbEntityDetailWorkspaceContextBase } from './entity-detail-workspace-base.js';\r\nimport type { UmbEntityDetailWorkspaceContextArgs, UmbEntityDetailWorkspaceContextCreateArgs } from './types.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbDetailRepository } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbNamedEntityModel } from '@umbraco-cms/backoffice/entity';\r\n\r\nexport abstract class UmbEntityNamedDetailWorkspaceContextBase<\r\n\t\tNamedDetailModelType extends UmbNamedEntityModel = UmbNamedEntityModel,\r\n\t\tNamedDetailRepositoryType extends\r\n\t\t\tUmbDetailRepository<NamedDetailModelType> = UmbDetailRepository<NamedDetailModelType>,\r\n\t\tCreateArgsType extends\r\n\t\t\tUmbEntityDetailWorkspaceContextCreateArgs<NamedDetailModelType> = UmbEntityDetailWorkspaceContextCreateArgs<NamedDetailModelType>,\r\n\t>\r\n\textends UmbEntityDetailWorkspaceContextBase<NamedDetailModelType, NamedDetailRepositoryType, CreateArgsType>\r\n\timplements UmbNamableWorkspaceContext\r\n{\r\n\t// Just for context token safety:\r\n\tpublic readonly IS_ENTITY_NAMED_DETAIL_WORKSPACE_CONTEXT = true;\r\n\r\n\tpublic readonly name = this._data.createObservablePartOfCurrent((data) => data?.name);\r\n\r\n\tpublic readonly nameWriteGuard = new UmbNameWriteGuardManager(this);\r\n\r\n\tconstructor(host: UmbControllerHost, args: UmbEntityDetailWorkspaceContextArgs) {\r\n\t\tsuper(host, args);\r\n\t\tthis.nameWriteGuard.fallbackToPermitted();\r\n\t\tthis.observe(\r\n\t\t\tthis.name,\r\n\t\t\t(name) => {\r\n\t\t\t\tthis.view.setTitle(name);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this._data.getCurrent()?.name;\r\n\t}\r\n\r\n\tsetName(name: string | undefined) {\r\n\t\t// We have to cast to Partial because TypeScript doesn't understand that the model has a name property due to generic sub-types\r\n\t\tthis._data.updateCurrent({ name } as Partial<NamedDetailModelType>);\r\n\t}\r\n}\r\n","import type { UmbSubmittableWorkspaceContextBase } from '../submittable/index.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbRouterSlotElement } from '@umbraco-cms/backoffice/router';\r\nimport { ensurePathEndsWithSlash, umbUrlPatternToString } from '@umbraco-cms/backoffice/utils';\r\n\r\nexport const UmbWorkspaceIsNewRedirectControllerAlias = Symbol('IsNewRedirectControllerAlias');\r\n\r\n/**\r\n * Observe the workspace context to see if the entity is new or not.\r\n * If that changes redirect to the edit url.\r\n *\r\n * This requires that the edit URL, is edit/:id\r\n * @param host\r\n * @param workspaceContext\r\n * @param router\r\n */\r\nexport class UmbWorkspaceIsNewRedirectController extends UmbControllerBase {\r\n\t/**\r\n\t * TODO: Figure out why we need this timeout. [NL]\r\n\t * The problem this fixes it when save & publishing a document open in a modal, like from a collection.\r\n\t * The redirect triggers something that ends up re-setting the path, making the modal path the one in the browser despite the modal is closed.\r\n\t */\r\n\ttimeout: any | undefined;\r\n\r\n\tconstructor(\r\n\t\thost: UmbControllerHost,\r\n\t\tworkspaceContext: UmbSubmittableWorkspaceContextBase<unknown>,\r\n\t\trouter: UmbRouterSlotElement,\r\n\t) {\r\n\t\tsuper(host, UmbWorkspaceIsNewRedirectControllerAlias);\r\n\r\n\t\t// Navigate to edit route when language is created:\r\n\t\tthis.observe(workspaceContext.isNew, (isNew) => {\r\n\t\t\tif (this.timeout) {\r\n\t\t\t\tclearTimeout(this.timeout);\r\n\t\t\t}\r\n\t\t\tif (isNew === false) {\r\n\t\t\t\tthis.timeout = setTimeout(() => {\r\n\t\t\t\t\tconst unique = workspaceContext.getUnique();\r\n\t\t\t\t\tif (router && unique) {\r\n\t\t\t\t\t\tconst routerPath = router.absoluteRouterPath;\r\n\t\t\t\t\t\tif (routerPath) {\r\n\t\t\t\t\t\t\tconst newPath: string = umbUrlPatternToString(ensurePathEndsWithSlash(routerPath) + 'edit/:id', {\r\n\t\t\t\t\t\t\t\tid: unique,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t\t\t// get current url:\r\n\t\t\t\t\t\t\tconst currentUrl = window.location.href;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\trouter.localActiveViewPath === undefined ||\r\n\t\t\t\t\t\t\t\trouter.localActiveViewPath === '' ||\r\n\t\t\t\t\t\t\t\t!currentUrl.includes(router.localActiveViewPath)\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// Check that we are still part of the DOM and thereby relevant:\r\n\t\t\t\t\t\t\twindow.history.replaceState(null, '', newPath);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.timeout = undefined;\r\n\t\t\t\t}, 500);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO: If workspace route changes cause of other reasons then this controller should be destroyed.\r\n\t}\r\n\r\n\toverride destroy() {\r\n\t\tsuper.destroy();\r\n\t\tif (this.timeout) {\r\n\t\t\tclearTimeout(this.timeout);\r\n\t\t\tthis.timeout = undefined;\r\n\t\t}\r\n\t}\r\n}\r\n","import { UmbArrayState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\nexport type UmbActiveVariant = {\r\n\tindex: number;\r\n\tculture: string | null;\r\n\tsegment: string | null;\r\n};\r\n\r\n/**\r\n * @deprecated Use {@link UmbActiveVariant} instead. This will be removed in Umbraco 18.\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport type ActiveVariant = UmbActiveVariant;\r\n\r\nconst UBM_VARIANT_DELIMITER = '_&_';\r\n\r\n/**\r\n * @class UmbWorkspaceSplitViewManager\r\n * @description - Class managing the split view state for a workspace context.\r\n */\r\nexport class UmbWorkspaceSplitViewManager {\r\n\t#activeVariantsInfo = new UmbArrayState<UmbActiveVariant>([], (x) => x.index).sortBy(\r\n\t\t(a, b) => (a.index || 0) - (b.index || 0),\r\n\t);\r\n\tpublic readonly activeVariantsInfo = this.#activeVariantsInfo.asObservable();\r\n\tpublic readonly splitViewActive = this.#activeVariantsInfo.asObservablePart((x) => x.length > 1);\r\n\r\n\tprivate _routeBase?: string;\r\n\tpublic getWorkspaceRoute(): string | undefined {\r\n\t\treturn this._routeBase;\r\n\t}\r\n\tpublic setWorkspaceRoute(route: string | undefined) {\r\n\t\tthis._routeBase = route;\r\n\t}\r\n\r\n\tsetActiveVariant(index: number, culture: string | null, segment: string | null) {\r\n\t\tthis.#activeVariantsInfo.appendOneAt({ index, culture: culture ?? null, segment: segment ?? null }, index);\r\n\t}\r\n\r\n\tgetActiveVariants() {\r\n\t\treturn this.#activeVariantsInfo.getValue();\r\n\t}\r\n\r\n\tpublic removeActiveVariant(index: number) {\r\n\t\tif (this.getActiveVariants().length > 1) {\r\n\t\t\tthis.#activeVariantsInfo.removeOne(index);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic activeVariantByIndex(index: number) {\r\n\t\treturn this.#activeVariantsInfo.asObservablePart((data) => data.find((x) => x.index === index) || undefined);\r\n\t}\r\n\r\n\tpublic switchVariant(index: number, variantId: UmbVariantId) {\r\n\t\t// TODO: remember current path and extend url with it.\r\n\t\t// TODO: construct URl with all active routes:\r\n\t\t// TODO: use method for generating variant url:\r\n\t\tconst workspaceRoute = this.getWorkspaceRoute();\r\n\t\tif (workspaceRoute) {\r\n\t\t\tconst activeVariants = this.getActiveVariants();\r\n\t\t\tif (activeVariants && index < activeVariants.length) {\r\n\t\t\t\tconst newVariants = [...activeVariants];\r\n\t\t\t\tnewVariants[index] = { index, culture: variantId.culture, segment: variantId.segment };\r\n\r\n\t\t\t\tconst variantPart: string = newVariants\r\n\t\t\t\t\t.map((v) => UmbVariantId.Create(v).toString())\r\n\t\t\t\t\t.join(UBM_VARIANT_DELIMITER);\r\n\r\n\t\t\t\tconst additionalPathname = this.#getAdditionalPathname();\r\n\t\t\t\thistory.pushState(null, '', `${workspaceRoute}/${variantPart}${additionalPathname}`);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpublic openSplitView(newVariant: UmbVariantId) {\r\n\t\t// TODO: remember current path and extend url with it.\r\n\t\t// TODO: construct URl with all active routes:\r\n\t\t// TODO: use method for generating variant url:\r\n\r\n\t\tconst currentVariant = this.getActiveVariants()[0];\r\n\t\tconst workspaceRoute = this.getWorkspaceRoute();\r\n\t\tif (currentVariant && workspaceRoute) {\r\n\t\t\thistory.pushState(\r\n\t\t\t\tnull,\r\n\t\t\t\t'',\r\n\t\t\t\t`${workspaceRoute}/${UmbVariantId.Create(currentVariant)}${UBM_VARIANT_DELIMITER}${newVariant}`,\r\n\t\t\t);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpublic closeSplitView(index: number) {\r\n\t\tconst workspaceRoute = this.getWorkspaceRoute();\r\n\t\tif (workspaceRoute) {\r\n\t\t\tconst activeVariants = this.getActiveVariants();\r\n\t\t\tif (activeVariants && index < activeVariants.length) {\r\n\t\t\t\tconst newVariants = activeVariants.filter((x) => x.index !== index);\r\n\r\n\t\t\t\tconst variantPart: string = newVariants.map((v) => UmbVariantId.Create(v)).join(UBM_VARIANT_DELIMITER);\r\n\r\n\t\t\t\thistory.pushState(null, '', `${workspaceRoute}/${variantPart}`);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tpublic setVariantParts(routeFragment: string) {\r\n\t\tconst variantSplit = routeFragment.split(UBM_VARIANT_DELIMITER);\r\n\t\tvariantSplit.forEach((part, index) => {\r\n\t\t\tthis.handleVariantFolderPart(index, part);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic handleVariantFolderPart(index: number, folderPart: string) {\r\n\t\tconst variantId = UmbVariantId.FromString(folderPart);\r\n\t\tthis.setActiveVariant(index, variantId.culture, variantId.segment);\r\n\t}\r\n\r\n\t#getCurrentVariantPathname() {\r\n\t\tconst workspaceRoute = this.getWorkspaceRoute();\r\n\t\tconst activeVariants = this.getActiveVariants();\r\n\t\tconst currentVariantPart: string = activeVariants\r\n\t\t\t.map((v) => UmbVariantId.Create(v).toString())\r\n\t\t\t.join(UBM_VARIANT_DELIMITER);\r\n\r\n\t\treturn `${workspaceRoute}/${currentVariantPart}`;\r\n\t}\r\n\r\n\t#getAdditionalPathname() {\r\n\t\tconst currentUrl = new URL(window.location.href);\r\n\t\tconst currentFullPathname = currentUrl.pathname;\r\n\t\tconst currentVariantPathname = this.#getCurrentVariantPathname();\r\n\r\n\t\tif (currentVariantPathname && currentFullPathname.startsWith(currentVariantPathname)) {\r\n\t\t\treturn currentFullPathname.substring(currentVariantPathname.length);\r\n\t\t}\r\n\r\n\t\t// If the currentVariantPathname is not a prefix, return empty string\r\n\t\treturn '';\r\n\t}\r\n}\r\n","import { css, customElement, html, ifDefined, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-workspace-info-app-layout')\r\nexport class UmbWorkspaceInfoAppLayoutElement extends UmbLitElement {\r\n\t@property({ type: String })\r\n\theadline?: string;\r\n\r\n\tprotected override render() {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=${ifDefined(this.headline ? this.localize.string(this.headline) : undefined)}>\r\n\t\t\t\t<slot name=\"header-actions\" slot=\"header-actions\"></slot>\r\n\t\t\t\t<div id=\"container\">\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t</div>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tuui-box {\r\n\t\t\t\t--uui-box-default-padding: 0;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-info-app-layout': UmbWorkspaceInfoAppLayoutElement;\r\n\t}\r\n}\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nexport interface UmbWorkspaceModalData<DataModelType = unknown> {\r\n\tentityType: string;\r\n\tpreset: Partial<DataModelType>;\r\n\tbaseDataPath?: string;\r\n\tinheritValidationLook?: boolean;\r\n}\r\n\r\nexport type UmbWorkspaceModalValue =\r\n\t| {\r\n\t\t\tunique: string;\r\n\t  }\r\n\t| undefined;\r\n\r\nexport const UMB_WORKSPACE_MODAL = new UmbModalToken<UmbWorkspaceModalData, UmbWorkspaceModalValue>(\r\n\t'Umb.Modal.Workspace',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'large',\r\n\t\t},\r\n\t},\r\n);\r\n","import type { UmbPropertyValueData } from '../../property/types.js';\r\n\r\n/**\r\n * @function UmbObjectToPropertyValueArray\r\n * @param {object} data - an object with properties to be converted.\r\n * @returns {Array<UmbPropertyValueData> | undefined} - and array of property values or undefined\r\n */\r\nexport function umbObjectToPropertyValueArray(data: object | undefined): Array<UmbPropertyValueData> | undefined {\r\n\tif (!data) return;\r\n\treturn Object.keys(data).map((key) => ({\r\n\t\talias: key,\r\n\t\tvalue: (data as any)[key],\r\n\t}));\r\n}\r\n","import type { UmbInvariantDatasetWorkspaceContext } from '../contexts/index.js';\r\nimport type {\r\n\tUmbPropertyDatasetContext,\r\n\tUmbNameablePropertyDatasetContext,\r\n\tUmbPropertyValueData,\r\n} from '@umbraco-cms/backoffice/property';\r\nimport { UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbVariantContext, UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport { UmbBooleanState, type Observable } from '@umbraco-cms/backoffice/observable-api';\r\n\r\n/**\r\n * A property dataset context that hooks directly into the workspace context.\r\n */\r\nexport class UmbInvariantWorkspacePropertyDatasetContext<\r\n\t\tWorkspaceType extends UmbInvariantDatasetWorkspaceContext = UmbInvariantDatasetWorkspaceContext,\r\n\t>\r\n\textends UmbContextBase\r\n\timplements UmbPropertyDatasetContext, UmbNameablePropertyDatasetContext\r\n{\r\n\t#readOnly = new UmbBooleanState(false);\r\n\tpublic readOnly = this.#readOnly.asObservable();\r\n\r\n\t#workspace: WorkspaceType;\r\n\t#variantContext = new UmbVariantContext(this).inherit();\r\n\r\n\tname;\r\n\r\n\t// default data:\r\n\r\n\tgetVariantId() {\r\n\t\treturn UmbVariantId.CreateInvariant();\r\n\t}\r\n\tgetEntityType() {\r\n\t\treturn this.#workspace.getEntityType();\r\n\t}\r\n\tgetUnique() {\r\n\t\treturn this.#workspace.getUnique();\r\n\t}\r\n\tgetName() {\r\n\t\treturn this.#workspace.getName();\r\n\t}\r\n\tsetName(name: string) {\r\n\t\tthis.#workspace.setName(name);\r\n\t}\r\n\r\n\tconstructor(host: UmbControllerHost, workspace: WorkspaceType) {\r\n\t\tsuper(host, UMB_PROPERTY_DATASET_CONTEXT);\r\n\t\tthis.#workspace = workspace;\r\n\r\n\t\tthis.name = this.#workspace.name;\r\n\t\tthis.#variantContext.setVariantId(this.getVariantId());\r\n\t}\r\n\r\n\tget properties(): Observable<Array<UmbPropertyValueData> | undefined> {\r\n\t\treturn this.#workspace.values;\r\n\t}\r\n\tgetProperties(): Promise<Array<UmbPropertyValueData> | undefined> {\r\n\t\treturn this.#workspace.getValues();\r\n\t}\r\n\r\n\t/**\r\n\t * @function propertyValueByAlias\r\n\t * @param {string} propertyAlias\r\n\t * @returns {Promise<Observable<ReturnType | undefined> | undefined>}\r\n\t * @description Get an Observable for the value of this property.\r\n\t */\r\n\tasync propertyValueByAlias<ReturnType = unknown>(propertyAlias: string) {\r\n\t\treturn await this.#workspace.propertyValueByAlias<ReturnType>(propertyAlias);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} propertyAlias - The alias of the property\r\n\t * @param {unknown} value - The value to be set for this property\r\n\t * @returns {Promise<void>} - an promise which resolves once the value has been set.\r\n\t */\r\n\tasync setPropertyValue(propertyAlias: string, value: unknown) {\r\n\t\treturn this.#workspace.setPropertyValue(propertyAlias, value);\r\n\t}\r\n\r\n\tgetReadOnly() {\r\n\t\treturn this.#readOnly.getValue();\r\n\t}\r\n}\r\n"],"names":["UmbWorkspaceActionMenuItemBase","UmbActionBase","UmbWorkspaceActionBase","UmbBooleanState","UmbSaveWorkspaceAction","host","args","UMB_SAVEABLE_WORKSPACE_CONTEXT","context","#observeUnique","unique","UmbSubmitWorkspaceAction","UMB_SUBMITTABLE_WORKSPACE_CONTEXT","UmbWorkspaceViewContext","UmbViewContext","manifest","UMB_WORKSPACE_EDITOR_CONTEXT","UmbContextToken","UmbWorkspaceEditorContext","UmbContextBase","#manifests","UmbBasicState","#overrides","mergeObservables","manifests","overrides","contexts","#contexts","contextsToKeep","view","keep","x","#variantId","override","key","a","b","previousValue","currentValue","y","#init","UmbExtensionsManifestInitializer","umbExtensionsRegistry","workspaceViews","controller","variantId","alias","_navigationContext","_workspaceViewHintObservers","_UmbWorkspaceEditorElement_instances","observeWorkspaceViewHints_fn","_currentProvidedView","createRoutes_fn","renderViews_fn","renderBackButton_fn","renderRoutes_fn","UmbWorkspaceEditorElement","UmbLitElement","__privateAdd","__privateGet","views","__privateMethod","value","html","when","observer","__privateSet","index","hint","newRoutes","UMB_WORKSPACE_VIEW_PATH_PATTERN","createExtensionElement","component","repeat","displayName","active","nothing","event","UmbTextStyles","css","__decorateClass","property","state","customElement","UMB_WORKSPACE_VIEW_CONTEXT","UmbWorkspaceEntityActionMenuElement","UMB_ENTITY_WORKSPACE_CONTEXT","_rejectModal","ExtensionApiArgsMethod","UmbWorkspaceFooterLayoutElement","UMB_MODAL_CONTEXT","UMB_NAMABLE_WORKSPACE_CONTEXT","UmbNameWriteGuardManager","UmbGuardManagerBase","rules","#resolvePermission","rule","_workspaceContext","_UmbWorkspaceHeaderNameEditableElement_instances","observeNameWriteGuardRules_fn","observeName_fn","onNameInput_fn","UmbWorkspaceHeaderNameEditableElement","workspaceContext","umbBindToValidation","umbFocus","isPermitted","name","UUIInputEvent","target","UmbWorkspaceSplitViewContext","UMB_WORKSPACE_SPLIT_VIEW_CONTEXT","#index","UmbNumberState","#isNew","UmbClassState","UMB_VARIANT_WORKSPACE_CONTEXT","#workspaceContext","#observeVariant","#observeIsNew","#variantVariantValidationContext","#datasetContext","isNew","activeVariantInfo","UmbVariantId","validationContext","UMB_MARK_ATTRIBUTE_NAME","variant","_splitViewContext","_datasetContext","_UmbWorkspaceSplitViewVariantSelectorElement_instances","isVariantHint_fn","observeVariants_fn","observeActiveVariants_fn","observeDatasetContext_fn","observeCurrentVariant_fn","observeReadOnlyGuardRules_fn","handleInput_fn","switchVariant_fn","openSplitView_fn","closeSplitView_fn","isVariantActive_fn","isCreateMode_fn","selectorIsEnabled_fn","setReadOnlyCultures_fn","onPopoverToggle_fn","focusInput_fn","isReadOnlyCulture_fn","isSegmentVariantOption_fn","onVariantExpandClick_fn","expandVariant_fn","toggleVariantExpansion_fn","isVariantExpanded_fn","getSegmentVariantOptionsForCulture_fn","renderCultureVariantOption_fn","renderHintBadge_fn","isCreated_fn","renderExpandToggle_fn","renderSegmentVariantOption_fn","getNameValue_fn","getVariantDisplayName_fn","getVariantSpecInfo_fn","renderReadOnlyTag_fn","renderSplitViewButton_fn","UmbWorkspaceSplitViewVariantSelectorElement","instance","UMB_PROPERTY_DATASET_CONTEXT","UMB_HINT_CONTEXT","hints","existingHint","firstHintOnInactiveVariant","UmbDataPathVariantQuery","ref","variantOption","variantOptions","observeMultiple","variesByCulture","variesBySegment","activeVariants","options","option","isNameablePropertyDatasetContext","activeVariantId","element","culture","expandedVariant","segmentVariants","notCreated","subVariantOptions","segmentName","query","_UmbWorkspaceSplitViewElement_instances","onVariantSelectorSlotChanged_fn","renderEntityActions_fn","UmbWorkspaceSplitViewElement","ifDefined","UmbEntityDetailForbiddenElement","UmbEntityDetailNotFoundElement","UMB_ENTITY_DETAIL_WORKSPACE_CONTEXT","_context","_UmbEntityDetailWorkspaceEditorElement_instances","renderForbidden_fn","renderNotFound_fn","UmbEntityDetailWorkspaceEditorElement","entityType","isLoading","isForbidden","data","UmbWorkspaceRouteManager","UmbControllerBase","#routes","UmbArrayState","#activeLocalPath","UmbStringState","routes","allRoutes","mappedRoutes","route","oldSetupCallback","_component","info","UmbSubmittableWorkspaceContextBase","workspaceAlias","UMB_WORKSPACE_CONTEXT","#validationContexts","#rejectSubmit","error","#submitPromise","#submitReject","#submitResolve","#resolveSubmit","#completeSubmit","reason","onValid","onInvalid","resolve","reject","UmbEditableWorkspaceContextBase","UmbEntityWorkspaceDataManager","UmbObjectState","persistedData","currentData","partialData","mappingFunction","persisted","current","result","jsonStringComparison","LOADING_STATE_UNIQUE","FORBIDDEN_STATE_UNIQUE","UmbEntityDetailWorkspaceContextBase","#entityContext","UmbEntityContext","UmbStateManager","#createUnderParent","parent","UmbValidationContext","#initialized","#initResolver","#allowNavigateAway","#onWillNavigate","e","newUrl","umbOpenModal","UMB_DISCARD_CHANGES_MODAL","UmbId","#onEntityUpdatedEvent","eventEntityUnique","eventEntityType","eventDiscriminator","#observeRepository","UMB_ACTION_EVENT_CONTEXT","#eventContext","UmbEntityUpdatedEvent","response","asObservable","UmbApiError","processedData","entity","#onDetailStoreChange","request","eventContext","reloadStructureEvent","UmbRequestReloadStructureForEntityEvent","reloadChildren","UmbRequestReloadChildrenOfEntityEvent","updatedEvent","UmbDeprecation","#checkIfInitialized","repositoryAlias","UmbExtensionApiInitializer","permitted","ctrl","UMB_ENTITY_NAMED_DETAIL_WORKSPACE_CONTEXT","UmbEntityNamedDetailWorkspaceContextBase","UmbWorkspaceIsNewRedirectControllerAlias","UmbWorkspaceIsNewRedirectController","router","routerPath","newPath","umbUrlPatternToString","ensurePathEndsWithSlash","currentUrl","UBM_VARIANT_DELIMITER","UmbWorkspaceSplitViewManager","#activeVariantsInfo","segment","workspaceRoute","newVariants","variantPart","v","additionalPathname","#getAdditionalPathname","newVariant","currentVariant","routeFragment","part","folderPart","#getCurrentVariantPathname","currentVariantPart","currentFullPathname","currentVariantPathname","UmbWorkspaceInfoAppLayoutElement","UMB_WORKSPACE_MODAL","UmbModalToken","umbObjectToPropertyValueArray","UmbInvariantWorkspacePropertyDatasetContext","workspace","#readOnly","#variantContext","UmbVariantContext","#workspace","propertyAlias"],"mappings":"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"}