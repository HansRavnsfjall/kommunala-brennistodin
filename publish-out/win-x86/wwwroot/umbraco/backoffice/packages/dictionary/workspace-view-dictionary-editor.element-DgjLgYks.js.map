{"version":3,"file":"workspace-view-dictionary-editor.element-DgjLgYks.js","sources":["../../../src/packages/dictionary/workspace/views/workspace-view-dictionary-editor.element.ts"],"sourcesContent":["import { UMB_DICTIONARY_WORKSPACE_CONTEXT } from '../dictionary-workspace.context-token.js';\r\nimport type { UmbDictionaryDetailModel } from '../../types.js';\r\nimport type { UUITextareaElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { css, html, customElement, state, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbLanguageCollectionRepository, type UmbLanguageDetailModel } from '@umbraco-cms/backoffice/language';\r\nimport { UMB_CURRENT_USER_CONTEXT } from '@umbraco-cms/backoffice/current-user';\r\n\r\n@customElement('umb-workspace-view-dictionary-editor')\r\nexport class UmbWorkspaceViewDictionaryEditorElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _dictionary?: UmbDictionaryDetailModel;\r\n\r\n\t@state()\r\n\tprivate _languages: Array<UmbLanguageDetailModel> = [];\r\n\r\n\t@state()\r\n\tprivate _currentUserLanguageAccess?: Array<string> = [];\r\n\r\n\t@state()\r\n\tprivate _currentUserHasAccessToAllLanguages?: boolean = false;\r\n\r\n\treadonly #languageCollectionRepository = new UmbLanguageCollectionRepository(this);\r\n\t#workspaceContext?: typeof UMB_DICTIONARY_WORKSPACE_CONTEXT.TYPE;\r\n\t#currentUserContext?: typeof UMB_CURRENT_USER_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_DICTIONARY_WORKSPACE_CONTEXT, (_instance) => {\r\n\t\t\tthis.#workspaceContext = _instance;\r\n\t\t\tthis.#observeDictionary();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_CURRENT_USER_CONTEXT, (context) => {\r\n\t\t\tthis.#currentUserContext = context;\r\n\t\t\tthis.#observeCurrentUserLanguageAccess();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeCurrentUserLanguageAccess() {\r\n\t\tif (!this.#currentUserContext) return;\r\n\r\n\t\tthis.observe(this.#currentUserContext.languages, (languages) => {\r\n\t\t\tthis._currentUserLanguageAccess = languages;\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#currentUserContext.hasAccessToAllLanguages, (hasAccess) => {\r\n\t\t\tthis._currentUserHasAccessToAllLanguages = hasAccess;\r\n\t\t});\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tconst { data } = await this.#languageCollectionRepository.requestCollection({});\r\n\t\tif (data) {\r\n\t\t\tthis._languages = data.items;\r\n\t\t}\r\n\t}\r\n\r\n\t#observeDictionary() {\r\n\t\tthis.observe(this.#workspaceContext?.dictionary, (dictionary) => {\r\n\t\t\tthis._dictionary = dictionary;\r\n\t\t});\r\n\t}\r\n\r\n\t#isReadOnly(culture: string | null) {\r\n\t\tif (!this.#currentUserContext) return true;\r\n\t\tif (!culture) return false;\r\n\t\tif (this._currentUserHasAccessToAllLanguages) return false;\r\n\t\treturn !this._currentUserLanguageAccess?.includes(culture);\r\n\t}\r\n\r\n\t#onTextareaChange(e: Event) {\r\n\t\tconst target = e.composedPath()[0] as UUITextareaElement;\r\n\t\tconst translation = (target.value as string).toString();\r\n\t\tconst isoCode = target.getAttribute('name')!;\r\n\r\n\t\tthis.#workspaceContext?.setPropertyValue(isoCode, translation);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-box>\r\n\t\t\t\t<umb-localize key=\"dictionaryItem_description\" .args=${[this._dictionary?.name ?? '...']}></umb-localize>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._languages,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => this.#renderTranslation(item),\r\n\t\t\t\t)}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderTranslation(language: UmbLanguageDetailModel) {\r\n\t\tif (!language.unique) return;\r\n\r\n\t\tconst translation = this._dictionary?.translations?.find((x) => x.isoCode === language.unique);\r\n\r\n\t\treturn html` <umb-property-layout label=${language.name ?? language.unique}>\r\n\t\t\t<uui-textarea\r\n\t\t\t\tslot=\"editor\"\r\n\t\t\t\tname=${language.unique}\r\n\t\t\t\tlabel=\"translation\"\r\n\t\t\t\t@input=${this.#onTextareaChange}\r\n\t\t\t\t.value=${translation?.translation ?? ''}\r\n\t\t\t\t?readonly=${this.#isReadOnly(language.unique)}></uui-textarea>\r\n\t\t</umb-property-layout>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-space-6);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbWorkspaceViewDictionaryEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-workspace-view-dictionary-editor': UmbWorkspaceViewDictionaryEditorElement;\r\n\t}\r\n}\r\n"],"names":["_languageCollectionRepository","_workspaceContext","_currentUserContext","_UmbWorkspaceViewDictionaryEditorElement_instances","observeCurrentUserLanguageAccess_fn","observeDictionary_fn","isReadOnly_fn","onTextareaChange_fn","renderTranslation_fn","UmbWorkspaceViewDictionaryEditorElement","UmbLitElement","__privateAdd","UmbLanguageCollectionRepository","UMB_DICTIONARY_WORKSPACE_CONTEXT","_instance","__privateSet","__privateMethod","UMB_CURRENT_USER_CONTEXT","context","data","__privateGet","html","repeat","item","languages","hasAccess","dictionary","culture","e","target","translation","isoCode","language","x","css","__decorateClass","state","customElement","UmbWorkspaceViewDictionaryEditorElement$1"],"mappings":"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"}