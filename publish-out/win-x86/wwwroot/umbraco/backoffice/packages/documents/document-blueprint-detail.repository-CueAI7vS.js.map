{"version":3,"file":"document-blueprint-detail.repository-CueAI7vS.js","sources":["../../../src/packages/documents/document-blueprints/repository/detail/document-blueprint-detail.server.data-source.ts","../../../src/packages/documents/document-blueprints/repository/detail/document-blueprint-detail.repository.ts"],"sourcesContent":["import type { UmbDocumentBlueprintDetailModel } from '../../types.js';\r\nimport { UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE, UMB_DOCUMENT_BLUEPRINT_PROPERTY_VALUE_ENTITY_TYPE } from '../../entity.js';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport type { UmbDataSourceResponse, UmbDetailDataSource } from '@umbraco-cms/backoffice/repository';\r\nimport type {\r\n\tCreateDocumentBlueprintRequestModel,\r\n\tDocumentBlueprintResponseModel,\r\n\tUpdateDocumentBlueprintRequestModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { DocumentBlueprintService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\n/**\r\n * A data source for the Document that fetches data from the server\r\n * @class UmbDocumentBlueprintServerDataSource\r\n * @implements {UmbDetailDataSource}\r\n */\r\nexport class UmbDocumentBlueprintServerDataSource implements UmbDetailDataSource<UmbDocumentBlueprintDetailModel> {\r\n\t#host: UmbControllerHost;\r\n\r\n\t/**\r\n\t * Creates an instance of UmbDocumentBlueprintServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbDocumentBlueprintServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new Document scaffold\r\n\t * @param preset\r\n\t * @returns { UmbDocumentBlueprintDetailModel }\r\n\t * @memberof UmbDocumentBlueprintServerDataSource\r\n\t */\r\n\tasync createScaffold(preset: Partial<UmbDocumentBlueprintDetailModel> = {}) {\r\n\t\tconst data: UmbDocumentBlueprintDetailModel = {\r\n\t\t\tentityType: UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE,\r\n\t\t\tunique: UmbId.new(),\r\n\t\t\tdocumentType: {\r\n\t\t\t\tunique: '',\r\n\t\t\t\tcollection: null,\r\n\t\t\t},\r\n\t\t\tvalues: [],\r\n\t\t\tvariants: [],\r\n\t\t\tflags: [],\r\n\t\t\t...preset,\r\n\t\t};\r\n\r\n\t\treturn { data };\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new variant scaffold.\r\n\t * @returns A new variant scaffold.\r\n\t */\r\n\t/*\r\n\t// TDOD: remove if not used\r\n\tcreateVariantScaffold(): UmbDocumentBlueprintVariantModel {\r\n\t\treturn {\r\n\t\t\tstate: null,\r\n\t\t\tculture: null,\r\n\t\t\tsegment: null,\r\n\t\t\tname: '',\r\n\t\t\tpublishDate: null,\r\n\t\t\tcreateDate: null,\r\n\t\t\tupdateDate: null,\r\n\t\t};\r\n\t}\r\n\t*/\r\n\r\n\t/**\r\n\t * Fetches a Document with the given id from the server\r\n\t * @param {string} unique\r\n\t * @returns {*}\r\n\t * @memberof UmbDocumentBlueprintServerDataSource\r\n\t */\r\n\tasync read(unique: string): Promise<UmbDataSourceResponse<UmbDocumentBlueprintDetailModel>> {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tDocumentBlueprintService.getDocumentBlueprintById({ path: { id: unique } }),\r\n\t\t);\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\tconst document = this.#createDocumentBlueprintDetailModel(data);\r\n\r\n\t\treturn { data: document };\r\n\t}\r\n\r\n\tasync scaffoldByUnique(unique: string): Promise<UmbDataSourceResponse<UmbDocumentBlueprintDetailModel>> {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tDocumentBlueprintService.getDocumentBlueprintByIdScaffold({ path: { id: unique } }),\r\n\t\t);\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\tconst document = this.#createDocumentBlueprintDetailModel(data);\r\n\r\n\t\treturn { data: document };\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a new Document on the server\r\n\t * @param {UmbDocumentBlueprintDetailModel} model\r\n\t * @param parentUnique\r\n\t * @returns {*}\r\n\t * @memberof UmbDocumentBlueprintServerDataSource\r\n\t */\r\n\tasync create(model: UmbDocumentBlueprintDetailModel, parentUnique: string | null = null) {\r\n\t\tif (!model) throw new Error('Document is missing');\r\n\t\tif (!model.unique) throw new Error('Document unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: CreateDocumentBlueprintRequestModel = {\r\n\t\t\tid: model.unique,\r\n\t\t\tparent: parentUnique ? { id: parentUnique } : null,\r\n\t\t\tdocumentType: { id: model.documentType.unique },\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tDocumentBlueprintService.postDocumentBlueprint({\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\treturn this.read(data);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\t/**\r\n\t * Updates a Document on the server\r\n\t * @param {UmbDocumentBlueprintDetailModel} Document\r\n\t * @param model\r\n\t * @returns {*}\r\n\t * @memberof UmbDocumentBlueprintServerDataSource\r\n\t */\r\n\tasync update(model: UmbDocumentBlueprintDetailModel) {\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: UpdateDocumentBlueprintRequestModel = {\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\tconst { error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tDocumentBlueprintService.putDocumentBlueprintById({\r\n\t\t\t\tpath: { id: model.unique },\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (!error) {\r\n\t\t\treturn this.read(model.unique);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes a Document on the server\r\n\t * @param {string} unique\r\n\t * @returns {*}\r\n\t * @memberof UmbDocumentBlueprintServerDataSource\r\n\t */\r\n\tasync delete(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\treturn tryExecute(this.#host, DocumentBlueprintService.deleteDocumentBlueprintById({ path: { id: unique } }));\r\n\t}\r\n\r\n\t#createDocumentBlueprintDetailModel(data: DocumentBlueprintResponseModel): UmbDocumentBlueprintDetailModel {\r\n\t\treturn {\r\n\t\t\tentityType: UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE,\r\n\t\t\tunique: data.id,\r\n\t\t\tvalues: data.values.map((value) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\teditorAlias: value.editorAlias,\r\n\t\t\t\t\tentityType: UMB_DOCUMENT_BLUEPRINT_PROPERTY_VALUE_ENTITY_TYPE,\r\n\t\t\t\t\tculture: value.culture || null,\r\n\t\t\t\t\tsegment: value.segment || null,\r\n\t\t\t\t\talias: value.alias,\r\n\t\t\t\t\tvalue: value.value,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tvariants: data.variants.map((variant) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tculture: variant.culture || null,\r\n\t\t\t\t\tsegment: variant.segment || null,\r\n\t\t\t\t\tstate: variant.state,\r\n\t\t\t\t\tname: variant.name,\r\n\t\t\t\t\tpublishDate: variant.publishDate || null,\r\n\t\t\t\t\tcreateDate: variant.createDate,\r\n\t\t\t\t\tupdateDate: variant.updateDate,\r\n\t\t\t\t\tscheduledPublishDate: variant.scheduledPublishDate || null,\r\n\t\t\t\t\tscheduledUnpublishDate: variant.scheduledUnpublishDate || null,\r\n\t\t\t\t\tflags: variant.flags,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tdocumentType: {\r\n\t\t\t\tunique: data.documentType.id,\r\n\t\t\t\tcollection: data.documentType.collection ? { unique: data.documentType.collection.id } : null,\r\n\t\t\t},\r\n\t\t\tflags: data.flags,\r\n\t\t};\r\n\t}\r\n}\r\n","import type { UmbDocumentBlueprintDetailModel } from '../../types.js';\r\nimport { UmbDocumentBlueprintServerDataSource } from './document-blueprint-detail.server.data-source.js';\r\nimport { UMB_DOCUMENT_BLUEPRINT_DETAIL_STORE_CONTEXT } from './document-blueprint-detail.store.context-token.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbDetailRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\n\r\nexport class UmbDocumentBlueprintDetailRepository extends UmbDetailRepositoryBase<\r\n\tUmbDocumentBlueprintDetailModel,\r\n\tUmbDocumentBlueprintServerDataSource\r\n> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbDocumentBlueprintServerDataSource, UMB_DOCUMENT_BLUEPRINT_DETAIL_STORE_CONTEXT);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets an existing document blueprint by its unique identifier for scaffolding purposes, i.e. to create a new document based on an existing blueprint.\r\n\t * @param {string} unique - The unique identifier of the document blueprint.\r\n\t * @returns {UmbRepositoryResponse<UmbDocumentBlueprintDetailModel>} - The document blueprint data.\r\n\t * @memberof UmbDocumentBlueprintDetailRepository\r\n\t */\r\n\tscaffoldByUnique(unique: string) {\r\n\t\treturn this.detailDataSource.scaffoldByUnique(unique);\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentBlueprintDetailRepository as api };\r\n"],"names":["UmbDocumentBlueprintServerDataSource","#host","host","preset","UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE","UmbId","unique","data","error","tryExecute","DocumentBlueprintService","#createDocumentBlueprintDetailModel","model","parentUnique","body","value","UMB_DOCUMENT_BLUEPRINT_PROPERTY_VALUE_ENTITY_TYPE","variant","UmbDocumentBlueprintDetailRepository","UmbDetailRepositoryBase","UMB_DOCUMENT_BLUEPRINT_DETAIL_STORE_CONTEXT"],"mappings":"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"}