{"version":3,"file":"document-notifications-modal.element-XMinmAhz.js","sources":["../../../src/packages/documents/documents/entity-actions/notifications/modal/document-notifications-modal.element.ts"],"sourcesContent":["import { UmbDocumentItemRepository } from '../../../item/index.js';\r\nimport { UmbDocumentNotificationsRepository } from '../repository/document-notifications.repository.js';\r\nimport type { UmbDocumentNotificationsModalData } from './document-notifications-modal.token.js';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport type { GetDocumentByIdNotificationsResponse } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { css, customElement, html, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\ntype UmbDocumentNotificationSettings = GetDocumentByIdNotificationsResponse;\r\n\r\n@customElement('umb-document-notifications-modal')\r\nexport class UmbDocumentNotificationsModalElement extends UmbModalBaseElement<\r\n\tUmbDocumentNotificationsModalData,\r\n\tnever\r\n> {\r\n\t#unique?: UmbEntityUnique;\r\n\t#documentNotificationsRepository = new UmbDocumentNotificationsRepository(this);\r\n\r\n\t@state()\r\n\tprivate _settings: UmbDocumentNotificationSettings = [];\r\n\r\n\t@state()\r\n\tprivate _documentName = '';\r\n\r\n\toverride firstUpdated() {\r\n\t\tthis.#unique = this.data?.unique;\r\n\t\tthis.#readNotificationSettings();\r\n\t\tthis.#getDocumentName();\r\n\t}\r\n\r\n\tasync #getDocumentName() {\r\n\t\tif (!this.#unique) return;\r\n\t\t// Should this be done here or in the action file?\r\n\t\tconst { data } = await new UmbDocumentItemRepository(this).requestItems([this.#unique]);\r\n\t\tif (!data) return;\r\n\t\tconst item = data[0];\r\n\t\t//TODO How do we ensure we get the correct variant?\r\n\t\tthis._documentName = item.variants[0]?.name;\r\n\t}\r\n\r\n\tasync #readNotificationSettings() {\r\n\t\tif (!this.#unique) return;\r\n\t\tconst { data } = await this.#documentNotificationsRepository.readNotifications(this.#unique);\r\n\r\n\t\tif (!data) return;\r\n\t\tthis._settings = data;\r\n\t}\r\n\r\n\tasync #updateNotificationSettings() {\r\n\t\tif (!this.#unique) return;\r\n\r\n\t\tconst subscribedActionIds = this._settings.filter((x) => x.subscribed).map((x) => x.actionId);\r\n\t\tconst { error } = await this.#documentNotificationsRepository.updateNotifications(\r\n\t\t\tthis.#unique,\r\n\t\t\tthis._documentName,\r\n\t\t\t{\r\n\t\t\t\tsubscribedActionIds,\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\tif (error) return;\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\tasync #updateSubscription(actionId: string) {\r\n\t\tthis._settings = this._settings.map((setting) => {\r\n\t\t\tif (setting.actionId === actionId) {\r\n\t\t\t\tconst subscribed = !setting.subscribed;\r\n\t\t\t\treturn { ...setting, subscribed };\r\n\t\t\t}\r\n\t\t\treturn setting;\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('notifications_notifications')}>\r\n\t\t\t\t<uui-box .headline=${this.localize.term('notifications_editNotifications', this._documentName)}>\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._settings,\r\n\t\t\t\t\t\t(setting) => setting.actionId,\r\n\t\t\t\t\t\t(setting) => {\r\n\t\t\t\t\t\t\tconst localizationKey = `actions_${setting.alias}`;\r\n\t\t\t\t\t\t\tlet localization = this.localize.term(localizationKey);\r\n\t\t\t\t\t\t\tif (localization === localizationKey) {\r\n\t\t\t\t\t\t\t\t// Fallback to alias if no localization is found\r\n\t\t\t\t\t\t\t\tlocalization = setting.alias;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn html`<uui-toggle\r\n\t\t\t\t\t\t\t\tid=${setting.actionId}\r\n\t\t\t\t\t\t\t\t@change=${() => this.#updateSubscription(setting.actionId)}\r\n\t\t\t\t\t\t\t\t.label=${localization}\r\n\t\t\t\t\t\t\t\t?checked=${setting.subscribed}></uui-toggle>`;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-box>\r\n\t\t\t\t<umb-footer-layout slot=\"footer\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t\t\t@click=${this._rejectModal}></uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('buttons_save')}\r\n\t\t\t\t\t\t@click=${this.#updateNotificationSettings}></uui-button>\r\n\t\t\t\t</umb-footer-layout>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tuui-toggle {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentNotificationsModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-notifications-modal': UmbDocumentNotificationsModalElement;\r\n\t}\r\n}\r\n"],"names":["_unique","_documentNotificationsRepository","_UmbDocumentNotificationsModalElement_instances","getDocumentName_fn","readNotificationSettings_fn","updateNotificationSettings_fn","updateSubscription_fn","UmbDocumentNotificationsModalElement","UmbModalBaseElement","__privateAdd","UmbDocumentNotificationsRepository","__privateSet","__privateMethod","html","repeat","setting","localizationKey","localization","__privateGet","data","UmbDocumentItemRepository","item","subscribedActionIds","x","error","actionId","subscribed","UmbTextStyles","css","__decorateClass","state","customElement","UmbDocumentNotificationsModalElement$1"],"mappings":"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"}