{"version":3,"file":"document-preview.repository-Eycecmbi.js","sources":["../../../src/packages/documents/documents/components/input-document/input-document.context.ts","../../../src/packages/documents/documents/components/input-document/input-document.element.ts","../../../src/packages/documents/documents/reference/components/document-reference-table.element.ts","../../../src/packages/documents/documents/repository/preview/document-preview.repository.ts"],"sourcesContent":["import type { UmbDocumentPickerModalData, UmbDocumentPickerModalValue } from '../../modals/types.js';\r\nimport { UMB_DOCUMENT_PICKER_MODAL, UMB_DOCUMENT_SEARCH_PROVIDER_ALIAS } from '../../constants.js';\r\nimport type { UmbDocumentItemModel } from '../../item/types.js';\r\nimport { UMB_DOCUMENT_ITEM_REPOSITORY_ALIAS } from '../../item/constants.js';\r\nimport type { UmbDocumentTreeItemModel } from '../../tree/types.js';\r\nimport { UmbPickerInputContext } from '@umbraco-cms/backoffice/picker-input';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbDocumentTypeEntityType } from '@umbraco-cms/backoffice/document-type';\r\nimport { UMB_VARIANT_CONTEXT } from '@umbraco-cms/backoffice/variant';\r\n\r\ninterface UmbDocumentPickerInputContextOpenArgs {\r\n\tallowedContentTypes?: Array<{ unique: string; entityType: UmbDocumentTypeEntityType }>;\r\n\tincludeTrashed?: boolean;\r\n}\r\n\r\nexport class UmbDocumentPickerInputContext extends UmbPickerInputContext<\r\n\tUmbDocumentItemModel,\r\n\tUmbDocumentTreeItemModel,\r\n\tUmbDocumentPickerModalData,\r\n\tUmbDocumentPickerModalValue\r\n> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_DOCUMENT_ITEM_REPOSITORY_ALIAS, UMB_DOCUMENT_PICKER_MODAL);\r\n\t}\r\n\r\n\toverride async openPicker(\r\n\t\tpickerData?: Partial<UmbDocumentPickerModalData>,\r\n\t\targs?: UmbDocumentPickerInputContextOpenArgs,\r\n\t) {\r\n\t\tconst combinedPickerData = {\r\n\t\t\t...pickerData,\r\n\t\t};\r\n\r\n\t\t// transform allowedContentTypes to a pickable filter\r\n\t\tcombinedPickerData.pickableFilter = (item) => this.#pickableFilter(item, args?.allowedContentTypes);\r\n\r\n\t\t// set default search data\r\n\t\tif (!pickerData?.search) {\r\n\t\t\tcombinedPickerData.search = {\r\n\t\t\t\tproviderAlias: UMB_DOCUMENT_SEARCH_PROVIDER_ALIAS,\r\n\t\t\t\t...pickerData?.search,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst variantContext = await this.getContext(UMB_VARIANT_CONTEXT);\r\n\t\tconst culture = await variantContext?.getDisplayCulture();\r\n\r\n\t\t// pass allowedContentTypes to the search request args\r\n\t\tcombinedPickerData.search!.queryParams = {\r\n\t\t\tallowedContentTypes: args?.allowedContentTypes,\r\n\t\t\tincludeTrashed: args?.includeTrashed,\r\n\t\t\tculture,\r\n\t\t\t...pickerData?.search?.queryParams,\r\n\t\t};\r\n\r\n\t\tawait super.openPicker(combinedPickerData);\r\n\t}\r\n\r\n\t#pickableFilter = (\r\n\t\titem: UmbDocumentItemModel,\r\n\t\tallowedContentTypes?: Array<{ unique: string; entityType: UmbDocumentTypeEntityType }>,\r\n\t): boolean => {\r\n\t\tif (allowedContentTypes && allowedContentTypes.length > 0) {\r\n\t\t\treturn allowedContentTypes\r\n\t\t\t\t.map((contentTypeReference) => contentTypeReference.unique)\r\n\t\t\t\t.includes(item.documentType.unique);\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n}\r\n","import type { UmbDocumentItemModel } from '../../item/types.js';\r\nimport { UmbDocumentPickerInputContext } from './input-document.context.js';\r\nimport { css, customElement, html, nothing, property, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { jsonStringComparison } from '@umbraco-cms/backoffice/observable-api';\r\nimport { splitStringToArray } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbInteractionMemoriesChangeEvent } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\nimport { UMB_DOCUMENT_TYPE_ENTITY_TYPE } from '@umbraco-cms/backoffice/document-type';\r\nimport type { UmbTreeStartNode } from '@umbraco-cms/backoffice/tree';\r\nimport type { UmbInteractionMemoryModel } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport type { UmbRepositoryItemsStatus } from '@umbraco-cms/backoffice/repository';\r\n\r\n@customElement('umb-input-document')\r\nexport class UmbInputDocumentElement extends UmbFormControlMixin<string | undefined, typeof UmbLitElement>(\r\n\tUmbLitElement,\r\n) {\r\n\t#sorter = new UmbSorterController<string>(this, {\r\n\t\tgetUniqueOfElement: (element) => {\r\n\t\t\treturn element.id;\r\n\t\t},\r\n\t\tgetUniqueOfModel: (modelEntry) => {\r\n\t\t\treturn modelEntry;\r\n\t\t},\r\n\t\tidentifier: 'Umb.SorterIdentifier.InputDocument',\r\n\t\titemSelector: 'umb-entity-item-ref',\r\n\t\tcontainerSelector: 'uui-ref-list',\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.selection = model;\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t},\r\n\t});\r\n\r\n\t/**\r\n\t * This is a minimum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set min(value: number) {\r\n\t\tthis.#pickerInputContext.min = value;\r\n\t}\r\n\tpublic get min(): number {\r\n\t\treturn this.#pickerInputContext.min;\r\n\t}\r\n\r\n\t/**\r\n\t * Min validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tminMessage = 'This field need more items';\r\n\r\n\t/**\r\n\t * This is a maximum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set max(value: number) {\r\n\t\tthis.#pickerInputContext.max = value;\r\n\t}\r\n\tpublic get max(): number {\r\n\t\treturn this.#pickerInputContext.max;\r\n\t}\r\n\r\n\t/**\r\n\t * Max validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'max-message' })\r\n\tmaxMessage = 'This field exceeds the allowed amount of items';\r\n\r\n\tpublic set selection(ids: Array<string>) {\r\n\t\tthis.#pickerInputContext.setSelection(ids);\r\n\t\tthis.#sorter.setModel(ids);\r\n\t}\r\n\tpublic get selection(): Array<string> {\r\n\t\treturn this.#pickerInputContext.getSelection();\r\n\t}\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tstartNode?: UmbTreeStartNode;\r\n\r\n\t@property({ type: Array })\r\n\tallowedContentTypeIds?: string[] | undefined;\r\n\r\n\t@property({ type: Boolean, attribute: 'include-trashed' })\r\n\tincludeTrashed = false;\r\n\r\n\t@property({ type: String })\r\n\tpublic override set value(selectionString: string | undefined) {\r\n\t\tthis.selection = splitStringToArray(selectionString);\r\n\t\tsuper.value = selectionString; // Call the parent setter to ensure the value change is triggered in the FormControlMixin. [NL]\r\n\t}\r\n\tpublic override get value(): string | undefined {\r\n\t\treturn this.selection.length > 0 ? this.selection.join(',') : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\tpublic get readonly() {\r\n\t\treturn this.#readonly;\r\n\t}\r\n\tpublic set readonly(value) {\r\n\t\tthis.#readonly = value;\r\n\r\n\t\tif (this.#readonly) {\r\n\t\t\tthis.#sorter.disable();\r\n\t\t} else {\r\n\t\t\tthis.#sorter.enable();\r\n\t\t}\r\n\t}\r\n\t#readonly = false;\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tpublic get interactionMemories(): Array<UmbInteractionMemoryModel> | undefined {\r\n\t\treturn this.#pickerInputContext.interactionMemory.getAllMemories();\r\n\t}\r\n\tpublic set interactionMemories(value: Array<UmbInteractionMemoryModel> | undefined) {\r\n\t\tthis.#interactionMemories = value;\r\n\t\tvalue?.forEach((memory) => this.#pickerInputContext.interactionMemory.setMemory(memory));\r\n\t}\r\n\r\n\t#interactionMemories?: Array<UmbInteractionMemoryModel> = [];\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbDocumentItemModel>;\r\n\r\n\t@state()\r\n\tprivate _statuses?: Array<UmbRepositoryItemsStatus>;\r\n\r\n\t#pickerInputContext = new UmbDocumentPickerInputContext(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeUnderflow',\r\n\t\t\t() => this.minMessage,\r\n\t\t\t() => !!this.min && this.selection.length < this.min,\r\n\t\t);\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeOverflow',\r\n\t\t\t() => this.maxMessage,\r\n\t\t\t() => !!this.max && this.selection.length > this.max,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#pickerInputContext.selection,\r\n\t\t\t(selection) => (this.value = selection.join(',')),\r\n\t\t\t'_observeSelection',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#pickerInputContext.selectedItems,\r\n\t\t\t(selectedItems) => (this._items = selectedItems),\r\n\t\t\t'_observerItems',\r\n\t\t);\r\n\r\n\t\tthis.observe(this.#pickerInputContext.statuses, (statuses) => (this._statuses = statuses), '_observerStatuses');\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#pickerInputContext.interactionMemory.memories,\r\n\t\t\t(memories) => {\r\n\t\t\t\t// only dispatch the event if the interaction memories have actually changed\r\n\t\t\t\tconst isIdentical = jsonStringComparison(memories, this.#interactionMemories);\r\n\r\n\t\t\t\tif (!isIdentical) {\r\n\t\t\t\t\tthis.#interactionMemories = memories;\r\n\t\t\t\t\tthis.dispatchEvent(new UmbInteractionMemoriesChangeEvent());\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'_observeMemories',\r\n\t\t);\r\n\t}\r\n\r\n\t#openPicker() {\r\n\t\tthis.#pickerInputContext.openPicker(\r\n\t\t\t{\r\n\t\t\t\thideTreeRoot: true,\r\n\t\t\t\tstartNode: this.startNode,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tallowedContentTypes: this.allowedContentTypeIds?.map((id) => ({\r\n\t\t\t\t\tunique: id,\r\n\t\t\t\t\tentityType: UMB_DOCUMENT_TYPE_ENTITY_TYPE,\r\n\t\t\t\t})),\r\n\t\t\t\tincludeTrashed: this.includeTrashed,\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\t#onRemove(unique: string) {\r\n\t\tthis.#pickerInputContext.requestRemoveItem(unique);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderItems()} ${this.#renderAddButton()}`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\tif (this.selection.length >= this.max) return nothing;\r\n\t\tif (this.readonly && this.selection.length > 0) {\r\n\t\t\treturn nothing;\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tid=\"btn-add\"\r\n\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t@click=${this.#openPicker}\r\n\t\t\t\t\tlabel=${this.localize.term('general_choose')}\r\n\t\t\t\t\t?disabled=${this.readonly}></uui-button>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._statuses) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._statuses,\r\n\t\t\t\t\t(status) => status.unique,\r\n\t\t\t\t\t(status) => {\r\n\t\t\t\t\t\tconst unique = status.unique;\r\n\t\t\t\t\t\tconst item = this._items?.find((x) => x.unique === unique);\r\n\t\t\t\t\t\treturn html`<umb-entity-item-ref\r\n\t\t\t\t\t\t\tid=${unique}\r\n\t\t\t\t\t\t\t.item=${item}\r\n\t\t\t\t\t\t\t?error=${status.state.type === 'error'}\r\n\t\t\t\t\t\t\t.errorMessage=${status.state.error}\r\n\t\t\t\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t\t\t\t?standalone=${this.max === 1}>\r\n\t\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\t\t!this.readonly,\r\n\t\t\t\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}\r\n\t\t\t\t\t\t\t\t\t\t\t@click=${() => this.#onRemove(unique)}></uui-button>\r\n\t\t\t\t\t\t\t\t\t</uui-action-bar>\r\n\t\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</umb-entity-item-ref>`;\r\n\t\t\t\t\t},\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbInputDocumentElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-document': UmbInputDocumentElement;\r\n\t}\r\n}\r\n","import { UmbDocumentReferenceRepository } from '../repository/index.js';\r\nimport { css, customElement, html, nothing, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport {\r\n\ttype UmbReferenceModel,\r\n\tisDocumentReference,\r\n\tisMediaReference,\r\n\tisMemberReference,\r\n\tisDefaultReference,\r\n} from '@umbraco-cms/backoffice/relations';\r\nimport { UmbDeprecation } from '@umbraco-cms/backoffice/utils';\r\n\r\n/**\r\n * @deprecated Deprecated from 15.4. The element will be removed in v17.0.0. For modals use the <umb-confirm-action-modal-entity-references> or <umb-confirm-bulk-action-modal-entity-references> element instead\r\n * @class UmbDocumentReferenceTableElement\r\n */\r\n@customElement('umb-document-reference-table')\r\nexport class UmbDocumentReferenceTableElement extends UmbLitElement {\r\n\t#documentReferenceRepository = new UmbDocumentReferenceRepository(this);\r\n\t#pageSize = 10;\r\n\r\n\t@property()\r\n\tunique = '';\r\n\r\n\t@state()\r\n\tprivate _items: Array<UmbReferenceModel> = [];\r\n\r\n\t/**\r\n\t * Indicates if there are more references to load, i.e. if the server has more references to return.\r\n\t * This is used to determine if the \"...and X more references\" text should be displayed.\r\n\t */\r\n\t@state()\r\n\tprivate _hasMoreReferences = 0;\r\n\r\n\t@state()\r\n\tprivate _errorMessage = '';\r\n\r\n\toverride firstUpdated() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tremoveInVersion: '17',\r\n\t\t\tdeprecated: '<umb-document-reference-table> element',\r\n\t\t\tsolution:\r\n\t\t\t\t'For modals use the <umb-confirm-action-modal-entity-references> or <umb-confirm-bulk-action-modal-entity-references> element instead',\r\n\t\t}).warn();\r\n\r\n\t\tthis.#getReferences();\r\n\t}\r\n\r\n\tasync #getReferences() {\r\n\t\t// Get the first 10 references for the document:\r\n\t\tconst { data, error } = await this.#documentReferenceRepository.requestReferencedBy(this.unique, 0, this.#pageSize);\r\n\r\n\t\tif (error) {\r\n\t\t\tthis._errorMessage = error.message;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!data) return;\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t//@ts-ignore\r\n\t\tthis._items = data.items;\r\n\t\tthis._hasMoreReferences = data.total > this.#pageSize ? data.total - this.#pageSize : 0;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html` ${this.#renderErrorMessage()} ${this.#renderTable()} `;\r\n\t}\r\n\r\n\t#getIcon(item: UmbReferenceModel) {\r\n\t\tif (isDocumentReference(item)) {\r\n\t\t\treturn item.documentType.icon ?? 'icon-document';\r\n\t\t}\r\n\t\tif (isMediaReference(item)) {\r\n\t\t\treturn item.mediaType.icon ?? 'icon-picture';\r\n\t\t}\r\n\t\tif (isMemberReference(item)) {\r\n\t\t\treturn item.memberType.icon ?? 'icon-user';\r\n\t\t}\r\n\t\tif (isDefaultReference(item)) {\r\n\t\t\treturn item.icon ?? 'icon-document';\r\n\t\t}\r\n\t\treturn 'icon-document';\r\n\t}\r\n\r\n\t#getContentTypeName(item: UmbReferenceModel) {\r\n\t\tif (isDocumentReference(item)) {\r\n\t\t\treturn item.documentType.name;\r\n\t\t}\r\n\t\tif (isMediaReference(item)) {\r\n\t\t\treturn item.mediaType.name;\r\n\t\t}\r\n\t\tif (isDefaultReference(item)) {\r\n\t\t\treturn item.type;\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\t#renderTable() {\r\n\t\tif (this._items?.length === 0) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=${this.localize.term('references_labelDependsOnThis')} style=\"--uui-box-default-padding:0\">\r\n\t\t\t\t<uui-table>\r\n\t\t\t\t\t<uui-table-head>\r\n\t\t\t\t\t\t<uui-table-head-cell></uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell><umb-localize key=\"general_name\">Name</umb-localize></uui-table-head-cell>\r\n\t\t\t\t\t\t<uui-table-head-cell><umb-localize key=\"general_typeName\">Type Name</umb-localize></uui-table-head-cell>\r\n\t\t\t\t\t</uui-table-head>\r\n\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._items,\r\n\t\t\t\t\t\t(item) => item.id,\r\n\t\t\t\t\t\t(item) =>\r\n\t\t\t\t\t\t\thtml`<uui-table-row>\r\n\t\t\t\t\t\t\t\t<uui-table-cell style=\"text-align:center;\">\r\n\t\t\t\t\t\t\t\t\t<umb-icon name=${this.#getIcon(item)}></umb-icon>\r\n\t\t\t\t\t\t\t\t</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell class=\"link-cell\"> ${item.name} </uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>${this.#getContentTypeName(item)}</uui-table-cell>\r\n\t\t\t\t\t\t\t</uui-table-row>`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t${this._hasMoreReferences\r\n\t\t\t\t\t\t? html`<uui-table-row>\r\n\t\t\t\t\t\t\t\t<uui-table-cell></uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell>\r\n\t\t\t\t\t\t\t\t\t<umb-localize key=\"references_labelMoreReferences\" .args=\"${[this._hasMoreReferences]}\">\r\n\t\t\t\t\t\t\t\t\t\t...and ${this._hasMoreReferences} more items\r\n\t\t\t\t\t\t\t\t\t</umb-localize>\r\n\t\t\t\t\t\t\t\t</uui-table-cell>\r\n\t\t\t\t\t\t\t\t<uui-table-cell></uui-table-cell>\r\n\t\t\t\t\t\t\t</uui-table-row>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</uui-table>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderErrorMessage() {\r\n\t\tif (this._errorMessage) {\r\n\t\t\treturn html`<div id=\"error\"><strong>${this._errorMessage}</strong></div>`;\r\n\t\t}\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#error {\r\n\t\t\t\tcolor: var(--uui-color-negative);\r\n\t\t\t\tmargin-bottom: 1rem;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-reference-table': UmbDocumentReferenceTableElement;\r\n\t}\r\n}\r\n","import type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport { PreviewService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\nexport class UmbDocumentPreviewRepository extends UmbRepositoryBase {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t}\r\n\r\n\t/**\r\n\t * Enters preview mode.\r\n\t * @returns {Promise<void>}\r\n\t * @memberof UmbDocumentPreviewRepository\r\n\t */\r\n\tasync enter(): Promise<void> {\r\n\t\tawait tryExecute(this, PreviewService.postPreview(), { disableNotifications: true });\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Exits preview mode.\r\n\t * @returns {Promise<void>}\r\n\t * @memberof UmbDocumentPreviewRepository\r\n\t */\r\n\tasync exit(): Promise<void> {\r\n\t\tawait tryExecute(this, PreviewService.deletePreview(), { disableNotifications: true });\r\n\t\treturn;\r\n\t}\r\n}\r\n"],"names":["UmbDocumentPickerInputContext","UmbPickerInputContext","host","UMB_DOCUMENT_ITEM_REPOSITORY_ALIAS","UMB_DOCUMENT_PICKER_MODAL","pickerData","args","combinedPickerData","item","#pickableFilter","UMB_DOCUMENT_SEARCH_PROVIDER_ALIAS","culture","UMB_VARIANT_CONTEXT","allowedContentTypes","contentTypeReference","_sorter","_readonly","_interactionMemories","_pickerInputContext","_UmbInputDocumentElement_instances","openPicker_fn","onRemove_fn","renderAddButton_fn","renderItems_fn","UmbInputDocumentElement","UmbFormControlMixin","UmbLitElement","__privateAdd","UmbSorterController","element","modelEntry","model","UmbChangeEvent","__privateGet","selection","selectedItems","statuses","memories","jsonStringComparison","__privateSet","UmbInteractionMemoriesChangeEvent","value","ids","selectionString","splitStringToArray","memory","html","__privateMethod","id","UMB_DOCUMENT_TYPE_ENTITY_TYPE","unique","nothing","repeat","status","x","when","css","__decorateClass","property","state","customElement","_documentReferenceRepository","_pageSize","_UmbDocumentReferenceTableElement_instances","getReferences_fn","getIcon_fn","getContentTypeName_fn","renderTable_fn","renderErrorMessage_fn","UmbDocumentReferenceTableElement","UmbDocumentReferenceRepository","UmbDeprecation","data","error","isDocumentReference","isMediaReference","isMemberReference","isDefaultReference","UmbTextStyles","UmbDocumentPreviewRepository","UmbRepositoryBase","tryExecute","PreviewService"],"mappings":"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"}