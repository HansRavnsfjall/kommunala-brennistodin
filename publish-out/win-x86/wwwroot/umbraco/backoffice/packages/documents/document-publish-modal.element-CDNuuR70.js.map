{"version":3,"file":"document-publish-modal.element-CDNuuR70.js","sources":["../../../src/packages/documents/documents/publishing/publish/modal/document-publish-modal.element.ts"],"sourcesContent":["import { UmbDocumentVariantState, type UmbDocumentVariantOptionModel } from '../../../types.js';\r\nimport { isNotPublishedMandatory } from '../../utils.js';\r\nimport type { UmbDocumentPublishModalData, UmbDocumentPublishModalValue } from './document-publish-modal.token.js';\r\nimport { css, customElement, html, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbSelectionManager } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\nimport '../../../modals/shared/document-variant-language-picker.element.js';\r\n\r\n@customElement('umb-document-publish-modal')\r\nexport class UmbDocumentPublishModalElement extends UmbModalBaseElement<\r\n\tUmbDocumentPublishModalData,\r\n\tUmbDocumentPublishModalValue\r\n> {\r\n\t#selectionManager = new UmbSelectionManager<string>(this);\r\n\r\n\t@state()\r\n\tprivate _options: Array<UmbDocumentVariantOptionModel> = [];\r\n\r\n\t@state()\r\n\tprivate _hasNotSelectedMandatory?: boolean;\r\n\r\n\t@state()\r\n\tprivate _hasInvalidSelection = true;\r\n\r\n\t@state()\r\n\tprivate _isInvariant = false;\r\n\r\n\t#pickableFilter = (option: UmbDocumentVariantOptionModel) => {\r\n\t\tif (!option.variant || option.variant.state === UmbDocumentVariantState.NOT_CREATED) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.data?.pickableFilter ? this.data.pickableFilter(option) : true;\r\n\t};\r\n\r\n\toverride firstUpdated() {\r\n\t\t// If invariant, don't display the variant selection component.\r\n\t\tif (this.data?.options.length === 1 && this.data.options[0].culture === null) {\r\n\t\t\tthis._isInvariant = true;\r\n\t\t\tthis._hasInvalidSelection = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#configureSelectionManager();\r\n\t}\r\n\r\n\tasync #configureSelectionManager() {\r\n\t\tthis.#selectionManager.setMultiple(true);\r\n\t\tthis.#selectionManager.setSelectable(true);\r\n\r\n\t\t// Only display variants that are relevant to pick from, i.e. variants that are draft, not-published-mandatory or published with pending changes.\r\n\t\t// If we don't know the state (e.g. from a bulk publishing selection) we need to consider it available for selection.\r\n\t\tthis._options =\r\n\t\t\tthis.data?.options.filter(\r\n\t\t\t\t(option) =>\r\n\t\t\t\t\t(option.variant && option.variant.state === null) ||\r\n\t\t\t\t\tisNotPublishedMandatory(option) ||\r\n\t\t\t\t\toption.variant?.state !== UmbDocumentVariantState.NOT_CREATED,\r\n\t\t\t) ?? [];\r\n\r\n\t\tlet selected = this.value?.selection ?? [];\r\n\r\n\t\tconst validOptions = this._options.filter((o) => this.#pickableFilter(o));\r\n\r\n\t\t// Filter selection based on options:\r\n\t\tselected = selected.filter((s) => validOptions.some((o) => o.unique === s));\r\n\r\n\t\t// Additionally select mandatory languages:\r\n\t\t// [NL]: I think for now lets make it an active choice to select the languages. If you just made them, they would be selected. So it just to underline the act of actually selecting these languages.\r\n\t\t/*\r\n\t\tthis._options.forEach((variant) => {\r\n\t\t\tif (variant.language?.isMandatory) {\r\n\t\t\t\tselected.push(variant.unique);\r\n\t\t\t}\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\tthis.#selectionManager.setSelection(selected);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#selectionManager.selection,\r\n\t\t\t(selection: Array<string>) => {\r\n\t\t\t\tif (!this._options && !selection) return;\r\n\r\n\t\t\t\t//Getting not published mandatory options â€” the options that are mandatory and not currently published.\r\n\t\t\t\tconst missingMandatoryOptions = this._options.filter(isNotPublishedMandatory);\r\n\t\t\t\tthis._hasNotSelectedMandatory = missingMandatoryOptions.some((option) => !selection.includes(option.unique));\r\n\t\t\t},\r\n\t\t\t'observeSelection',\r\n\t\t);\r\n\t}\r\n\r\n\t#submit() {\r\n\t\tthis.value = { selection: this._isInvariant ? ['invariant'] : this.#selectionManager.getSelection() };\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#close() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tconst headline = this.data?.headline ?? this.localize.term('content_publishModalTitle');\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-dialog-layout headline=${headline}>\r\n\t\t\t\t<p><umb-localize key=\"prompt_confirmPublish\"></umb-localize></p>\r\n\r\n\t\t\t\t${when(\r\n\t\t\t\t\t!this._isInvariant,\r\n\t\t\t\t\t() =>\r\n\t\t\t\t\t\thtml`<umb-document-variant-language-picker\r\n\t\t\t\t\t\t\t.selectionManager=${this.#selectionManager}\r\n\t\t\t\t\t\t\t.variantLanguageOptions=${this._options}\r\n\t\t\t\t\t\t\t.requiredFilter=${isNotPublishedMandatory}\r\n\t\t\t\t\t\t\t.pickableFilter=${this.#pickableFilter}></umb-document-variant-language-picker>`,\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_close')} @click=${this.#close}></uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t${umbFocus()}\r\n\t\t\t\t\t\tlabel=\"${this.data?.confirmLabel\r\n\t\t\t\t\t\t\t? this.localize.string(this.data.confirmLabel)\r\n\t\t\t\t\t\t\t: this.localize.term('buttons_saveAndPublish')}\"\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t?disabled=${this._hasNotSelectedMandatory}\r\n\t\t\t\t\t\t@click=${this.#submit}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</uui-dialog-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmin-width: 460px;\r\n\t\t\t\tmax-width: 90vw;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentPublishModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-publish-modal': UmbDocumentPublishModalElement;\r\n\t}\r\n}\r\n"],"names":["_selectionManager","_pickableFilter","_UmbDocumentPublishModalElement_instances","configureSelectionManager_fn","submit_fn","close_fn","UmbDocumentPublishModalElement","UmbModalBaseElement","__privateAdd","UmbSelectionManager","option","UmbDocumentVariantState","__privateMethod","headline","html","when","__privateGet","isNotPublishedMandatory","umbFocus","selected","validOptions","o","s","selection","missingMandatoryOptions","UmbTextStyles","css","__decorateClass","state","customElement","UmbDocumentPublishModalElement$1"],"mappings":"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"}