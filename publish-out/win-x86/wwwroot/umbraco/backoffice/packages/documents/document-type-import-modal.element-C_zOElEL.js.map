{"version":3,"file":"document-type-import-modal.element-C_zOElEL.js","sources":["../../../src/packages/documents/document-types/entity-actions/import/modal/document-type-import-modal.element.ts"],"sourcesContent":["import { UmbDocumentTypeImportRepository } from '../repository/document-type-import.repository.js';\r\nimport type {\r\n\tUmbDocumentTypeImportModalData,\r\n\tUmbDocumentTypeImportModalValue,\r\n} from './document-type-import-modal.token.js';\r\nimport { css, html, customElement, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDropzoneMediaElement } from '@umbraco-cms/backoffice/media';\r\nimport type { UmbDropzoneChangeEvent } from '@umbraco-cms/backoffice/dropzone';\r\n\r\ninterface UmbDocumentTypePreview {\r\n\tunique: string;\r\n\tname: string;\r\n\talias: string;\r\n\ticon: string;\r\n}\r\n\r\n@customElement('umb-document-type-import-modal')\r\nexport class UmbDocumentTypeImportModalLayout extends UmbModalBaseElement<\r\n\tUmbDocumentTypeImportModalData,\r\n\tUmbDocumentTypeImportModalValue\r\n> {\r\n\t#documentTypeImportRepository = new UmbDocumentTypeImportRepository(this);\r\n\t#temporaryUnique?: string;\r\n\t#fileReader;\r\n\r\n\t@state()\r\n\tprivate _fileContent: Array<UmbDocumentTypePreview> = [];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#fileReader = new FileReader();\r\n\t\tthis.#fileReader.onload = (e) => {\r\n\t\t\tif (typeof e.target?.result === 'string') {\r\n\t\t\t\tconst fileContent = e.target.result;\r\n\t\t\t\tthis.#documentTypePreviewBuilder(fileContent);\r\n\t\t\t} else {\r\n\t\t\t\tthis.#requestReset();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t#onUploadComplete(evt: UmbDropzoneChangeEvent) {\r\n\t\tevt.preventDefault();\r\n\t\tconst target = evt.target as UmbDropzoneMediaElement;\r\n\t\tconst data = target.value;\r\n\t\tif (!data?.length) return;\r\n\r\n\t\tconst file = data[0];\r\n\r\n\t\tif (file.temporaryFile) {\r\n\t\t\tthis.#temporaryUnique = file.temporaryFile.temporaryUnique;\r\n\t\t\tthis.#fileReader.readAsText(file.temporaryFile.file);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onFileImport() {\r\n\t\tif (!this.#temporaryUnique) return;\r\n\t\tconst { error } = await this.#documentTypeImportRepository.requestImport(this.#temporaryUnique);\r\n\t\tif (error) return;\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#documentTypePreviewBuilder(htmlString: string) {\r\n\t\tconst parser = new DOMParser();\r\n\t\tconst doc = parser.parseFromString(htmlString, 'text/xml');\r\n\t\tconst elements = doc.childNodes;\r\n\r\n\t\tconst documentTypes: Array<Element> = [];\r\n\r\n\t\telements.forEach((node) => {\r\n\t\t\tif (node.nodeType === Node.ELEMENT_NODE && node.nodeName === 'DocumentType') {\r\n\t\t\t\tdocumentTypes.push(node as Element);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._fileContent = this.#documentTypePreviewItemBuilder(documentTypes);\r\n\t}\r\n\r\n\t#documentTypePreviewItemBuilder(elements: Array<Element>) {\r\n\t\tconst documentTypes: Array<UmbDocumentTypePreview> = [];\r\n\t\telements.forEach((documentType) => {\r\n\t\t\tconst info = documentType.getElementsByTagName('Info')[0];\r\n\t\t\tconst unique = info.getElementsByTagName('Key')[0].textContent ?? '';\r\n\t\t\tconst name = info.getElementsByTagName('Name')[0].textContent ?? '';\r\n\t\t\tconst alias = info.getElementsByTagName('Alias')[0].textContent ?? '';\r\n\t\t\tconst icon = info.getElementsByTagName('Icon')[0].textContent ?? '';\r\n\r\n\t\t\tdocumentTypes.push({ unique, name, alias, icon });\r\n\t\t});\r\n\t\treturn documentTypes;\r\n\t}\r\n\r\n\t#requestReset() {\r\n\t\tthis._fileContent = [];\r\n\t\tthis.#temporaryUnique = undefined;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html` <umb-body-layout headline=${this.localize.term('general_import')}>\r\n\t\t\t<uui-box> ${this.#renderUploadZone()} </uui-box>\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t@click=${this._rejectModal}></uui-button>\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tlook=\"primary\"\r\n\t\t\t\t?disabled=${!this.#temporaryUnique}\r\n\t\t\t\tlabel=${this.localize.term('actions_importdocumenttype')}\r\n\t\t\t\t@click=${this.#onFileImport}></uui-button>\r\n\t\t</umb-body-layout>`;\r\n\t}\r\n\r\n\t#renderUploadZone() {\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis._fileContent.length,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-ref-node-document-type\r\n\t\t\t\t\t\tname=${this._fileContent[0].name}\r\n\t\t\t\t\t\talias=${this._fileContent[0].alias}\r\n\t\t\t\t\t\treadonly\r\n\t\t\t\t\t\tstandalone>\r\n\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${this._fileContent[0].icon}></umb-icon>\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\t\t@click=${this.#requestReset}\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}></uui-button>\r\n\t\t\t\t\t</uui-ref-node-document-type>`,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<div id=\"wrapper\">\r\n\t\t\t\t\t\t<umb-input-dropzone id=\"dropzone\" accept=\".udt\" @change=${this.#onUploadComplete}\r\n\t\t\t\t\t\t\t><umb-localize slot=\"text\" key=\"media_dragAndDropYourFilesIntoTheArea\"\r\n\t\t\t\t\t\t\t\t>Drag and drop your file(s) into the area\r\n\t\t\t\t\t\t\t</umb-localize></umb-input-dropzone\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t</div>`,\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#wrapper {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tborder: 2px dashed var(--uui-color-divider-standalone);\r\n\t\t\t\tbackground-color: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: var(--uui-size-space-6);\r\n\t\t\t}\r\n\r\n\t\t\t#dropzone {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#import {\r\n\t\t\t\tmargin-top: var(--uui-size-space-6);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentTypeImportModalLayout;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-type-import-modal': UmbDocumentTypeImportModalLayout;\r\n\t}\r\n}\r\n"],"names":["_documentTypeImportRepository","_temporaryUnique","_fileReader","_UmbDocumentTypeImportModalLayout_instances","onUploadComplete_fn","onFileImport_fn","documentTypePreviewBuilder_fn","documentTypePreviewItemBuilder_fn","requestReset_fn","renderUploadZone_fn","UmbDocumentTypeImportModalLayout","UmbModalBaseElement","__privateAdd","UmbDocumentTypeImportRepository","__privateSet","__privateGet","fileContent","__privateMethod","html","evt","data","file","error","htmlString","elements","documentTypes","node","documentType","info","unique","name","alias","icon","when","UmbTextStyles","css","__decorateClass","state","customElement","UmbDocumentTypeImportModalLayout$1"],"mappings":"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"}