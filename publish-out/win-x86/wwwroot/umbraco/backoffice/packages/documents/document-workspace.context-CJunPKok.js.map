{"version":3,"file":"document-workspace.context-CJunPKok.js","sources":["../../../src/packages/documents/documents/property-dataset-context/document-property-dataset.context.ts","../../../src/packages/documents/documents/repository/validation/document-validation.server.data-source.ts","../../../src/packages/documents/documents/repository/validation/document-validation.repository.ts","../../../src/packages/documents/documents/workspace/document-workspace.context.ts"],"sourcesContent":["import type { UmbDocumentDetailModel, UmbDocumentVariantModel, UmbDocumentWorkspaceContext } from '../types.js';\r\nimport { UmbContentPropertyDatasetContext } from '@umbraco-cms/backoffice/content';\r\nimport type { UmbDocumentTypeDetailModel } from '@umbraco-cms/backoffice/document-type';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbDocumentPropertyDatasetContext extends UmbContentPropertyDatasetContext<\r\n\tUmbDocumentDetailModel,\r\n\tUmbDocumentTypeDetailModel,\r\n\tUmbDocumentVariantModel\r\n> {\r\n\tconstructor(host: UmbControllerHost, dataOwner: UmbDocumentWorkspaceContext, variantId?: UmbVariantId) {\r\n\t\tsuper(host, dataOwner, variantId);\r\n\t}\r\n}\r\n","import type { UmbDocumentDetailModel } from '../../types.js';\r\nimport {\r\n\ttype CreateDocumentRequestModel,\r\n\tDocumentService,\r\n\ttype ValidateUpdateDocumentRequestModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbDataSourceResponse } from '@umbraco-cms/backoffice/repository';\r\n\r\n/**\r\n * A server data source for Document Validation\r\n */\r\nexport class UmbDocumentValidationServerDataSource {\r\n\t#host: UmbControllerHost;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate a new Document on the server\r\n\t * @param {UmbDocumentDetailModel} model - Document Model\r\n\t * @param parentUnique - Parent Unique\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateCreate(\r\n\t\tmodel: UmbDocumentDetailModel,\r\n\t\tparentUnique: UmbEntityUnique = null,\r\n\t): Promise<UmbDataSourceResponse<string>> {\r\n\t\tif (!model) throw new Error('Document is missing');\r\n\t\tif (!model.unique) throw new Error('Document unique is missing');\r\n\t\tif (parentUnique === undefined) throw new Error('Parent unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: CreateDocumentRequestModel = {\r\n\t\t\tid: model.unique,\r\n\t\t\tparent: parentUnique ? { id: parentUnique } : null,\r\n\t\t\tdocumentType: { id: model.documentType.unique },\r\n\t\t\ttemplate: model.template ? { id: model.template.unique } : null,\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\t// Maybe use: tryExecuteAndNotify\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tDocumentService.postDocumentValidate({\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t\t{\r\n\t\t\t\tdisableNotifications: true,\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\treturn { data };\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\t/**\r\n\t * Validate a existing Document\r\n\t * @param {UmbDocumentDetailModel} model - Document Model\r\n\t * @param {Array<UmbVariantId>} variantIds - Variant Ids\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateUpdate(\r\n\t\tmodel: UmbDocumentDetailModel,\r\n\t\tvariantIds: Array<UmbVariantId>,\r\n\t): Promise<UmbDataSourceResponse<string>> {\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst cultures = variantIds.map((id) => id.culture).filter((culture) => culture !== null) as Array<string>;\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: ValidateUpdateDocumentRequestModel = {\r\n\t\t\ttemplate: model.template ? { id: model.template.unique } : null,\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t\tcultures,\r\n\t\t};\r\n\r\n\t\t// Maybe use: tryExecuteAndNotify\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tDocumentService.putUmbracoManagementApiV1Service.documentByIdValidate1Service.putUmbracoManagementApiV11DocumentByIdValidate11(\r\n\t\t\t\t{\r\n\t\t\t\t\tpath: { id: model.unique },\r\n\t\t\t\t\tbody,\r\n\t\t\t\t},\r\n\t\t\t),\r\n\t\t\t{\r\n\t\t\t\tdisableNotifications: true,\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\treturn { data };\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n}\r\n","import type { UmbDocumentDetailModel } from '../../types.js';\r\nimport { UmbDocumentValidationServerDataSource } from './document-validation.server.data-source.js';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbContentValidationRepository } from '@umbraco-cms/backoffice/content';\r\n\r\ntype DetailModelType = UmbDocumentDetailModel;\r\n\r\nexport class UmbDocumentValidationRepository\r\n\textends UmbRepositoryBase\r\n\timplements UmbContentValidationRepository<DetailModelType>\r\n{\r\n\t#validationDataSource: UmbDocumentValidationServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#validationDataSource = new UmbDocumentValidationServerDataSource(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a promise with an observable of the detail for the given unique\r\n\t * @param {DetailModelType} model\r\n\t * @param {string | null} [parentUnique]\r\n\t * @returns {*}\r\n\t * @memberof UmbDetailRepositoryBase\r\n\t */\r\n\tasync validateCreate(model: DetailModelType, parentUnique: string | null) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\r\n\t\treturn this.#validationDataSource.validateCreate(model, parentUnique);\r\n\t}\r\n\r\n\t/**\r\n\t * Saves the given data\r\n\t * @param {DetailModelType} model\r\n\t * @param variantIds\r\n\t * @returns {*}\r\n\t * @memberof UmbDetailRepositoryBase\r\n\t */\r\n\tasync validateSave(model: DetailModelType, variantIds: Array<UmbVariantId>) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\treturn this.#validationDataSource.validateUpdate(model, variantIds);\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentValidationRepository as api };\r\n","import { UmbDocumentTypeDetailRepository } from '../../document-types/repository/detail/document-type-detail.repository.js';\r\nimport { UmbDocumentPropertyDatasetContext } from '../property-dataset-context/document-property-dataset.context.js';\r\nimport type { UmbDocumentDetailRepository } from '../repository/index.js';\r\nimport { UMB_DOCUMENT_DETAIL_REPOSITORY_ALIAS } from '../repository/index.js';\r\nimport type { UmbDocumentDetailModel, UmbDocumentVariantModel } from '../types.js';\r\nimport {\r\n\tUMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN,\r\n\tUMB_CREATE_FROM_BLUEPRINT_DOCUMENT_WORKSPACE_PATH_PATTERN,\r\n\tUMB_DOCUMENT_COLLECTION_ALIAS,\r\n\tUMB_DOCUMENT_ENTITY_TYPE,\r\n\tUMB_DOCUMENT_SAVE_MODAL,\r\n\tUMB_DOCUMENT_USER_PERMISSION_CONDITION_ALIAS,\r\n\tUMB_EDIT_DOCUMENT_WORKSPACE_PATH_PATTERN,\r\n\tUMB_USER_PERMISSION_DOCUMENT_CREATE,\r\n\tUMB_USER_PERMISSION_DOCUMENT_UPDATE,\r\n} from '../constants.js';\r\nimport { UmbDocumentPreviewRepository } from '../repository/preview/index.js';\r\nimport { UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT, UmbDocumentPublishingRepository } from '../publishing/index.js';\r\nimport { UmbDocumentValidationRepository } from '../repository/validation/index.js';\r\nimport { UMB_DOCUMENT_CONFIGURATION_CONTEXT } from '../index.js';\r\nimport { UMB_DOCUMENT_DETAIL_MODEL_VARIANT_SCAFFOLD, UMB_DOCUMENT_WORKSPACE_ALIAS } from './constants.js';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { ensurePathEndsWithSlash, UmbDeprecation } from '@umbraco-cms/backoffice/utils';\r\nimport { observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbContentDetailWorkspaceContextBase } from '@umbraco-cms/backoffice/content';\r\nimport { UmbDocumentBlueprintDetailRepository } from '@umbraco-cms/backoffice/document-blueprint';\r\nimport { UmbIsTrashedEntityContext } from '@umbraco-cms/backoffice/recycle-bin';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport {\r\n\tUmbWorkspaceIsNewRedirectController,\r\n\tUmbWorkspaceIsNewRedirectControllerAlias,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_SERVER_CONTEXT } from '@umbraco-cms/backoffice/server';\r\nimport type { UmbContentWorkspaceContext } from '@umbraco-cms/backoffice/content';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbDocumentTypeDetailModel } from '@umbraco-cms/backoffice/document-type';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbPublishableWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbVariantPropertyGuardRule } from '@umbraco-cms/backoffice/property';\r\n\r\ntype ContentModel = UmbDocumentDetailModel;\r\ntype ContentTypeModel = UmbDocumentTypeDetailModel;\r\nexport class UmbDocumentWorkspaceContext\r\n\textends UmbContentDetailWorkspaceContextBase<\r\n\t\tContentModel,\r\n\t\tUmbDocumentDetailRepository,\r\n\t\tContentTypeModel,\r\n\t\tUmbDocumentVariantModel\r\n\t>\r\n\timplements\r\n\t\tUmbContentWorkspaceContext<ContentModel, ContentTypeModel, UmbDocumentVariantModel>,\r\n\t\tUmbPublishableWorkspaceContext\r\n{\r\n\t/**\r\n\t * The publishing repository for the document workspace.\r\n\t * @deprecated Will be removed in v17. Use the methods on the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.\r\n\t * @memberof UmbDocumentWorkspaceContext\r\n\t */\r\n\tpublic readonly publishingRepository = new UmbDocumentPublishingRepository(this);\r\n\r\n\treadonly isTrashed = this._data.createObservablePartOfCurrent((data) => data?.isTrashed);\r\n\r\n\treadonly contentTypeUnique = this._data.createObservablePartOfCurrent((data) => data?.documentType.unique);\r\n\r\n\t/*\r\n\t * @deprecated Use `collection.hasCollection` instead, will be removed in v.18\r\n\t */\r\n\treadonly contentTypeHasCollection = this._data.createObservablePartOfCurrent(\r\n\t\t(data) => !!data?.documentType.collection,\r\n\t);\r\n\r\n\treadonly contentTypeIcon = this._data.createObservablePartOfCurrent((data) => data?.documentType.icon || null);\r\n\r\n\treadonly templateId = this._data.createObservablePartOfCurrent((data) => data?.template?.unique || null);\r\n\r\n\t#isTrashedContext = new UmbIsTrashedEntityContext(this);\r\n\t#publishingContext?: typeof UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tentityType: UMB_DOCUMENT_ENTITY_TYPE,\r\n\t\t\tworkspaceAlias: UMB_DOCUMENT_WORKSPACE_ALIAS,\r\n\t\t\tcollectionAlias: UMB_DOCUMENT_COLLECTION_ALIAS,\r\n\t\t\tdetailRepositoryAlias: UMB_DOCUMENT_DETAIL_REPOSITORY_ALIAS,\r\n\t\t\tcontentTypeDetailRepository: UmbDocumentTypeDetailRepository,\r\n\t\t\tcontentValidationRepository: UmbDocumentValidationRepository,\r\n\t\t\tskipValidationOnSubmit: false,\r\n\t\t\tignoreValidationResultOnSubmit: true,\r\n\t\t\tcontentVariantScaffold: UMB_DOCUMENT_DETAIL_MODEL_VARIANT_SCAFFOLD,\r\n\t\t\tcontentTypePropertyName: 'documentType',\r\n\t\t\tsaveModalToken: UMB_DOCUMENT_SAVE_MODAL,\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_DOCUMENT_CONFIGURATION_CONTEXT, async (context) => {\r\n\t\t\tconst config = await context?.getDocumentConfiguration();\r\n\t\t\tconst allowSegmentCreation = config?.allowNonExistingSegmentsCreation ?? false;\r\n\t\t\tconst allowEditInvariantFromNonDefault = config?.allowEditInvariantFromNonDefault ?? true;\r\n\r\n\t\t\t// Deprecation warning for allowNonExistingSegmentsCreation (default from server is true, so we warn on false)\r\n\t\t\tif (!allowSegmentCreation) {\r\n\t\t\t\tnew UmbDeprecation({\r\n\t\t\t\t\tdeprecated: 'The \"AllowNonExistingSegmentsCreation\" setting is deprecated.',\r\n\t\t\t\t\tremoveInVersion: '19.0.0',\r\n\t\t\t\t\tsolution: 'This functionality will be moved to a client-side extension.',\r\n\t\t\t\t}).warn();\r\n\t\t\t}\r\n\r\n\t\t\tthis._variantOptionsFilter = (variantOption) => {\r\n\t\t\t\tconst isNotCreatedSegmentVariant = variantOption.segment && !variantOption.variant;\r\n\r\n\t\t\t\t// Do not allow creating a segment variant\r\n\t\t\t\tif (!allowSegmentCreation && isNotCreatedSegmentVariant) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\r\n\t\t\tif (allowEditInvariantFromNonDefault === false) {\r\n\t\t\t\tthis.#preventEditInvariantFromNonDefault();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.contentTypeUnique,\r\n\t\t\t(unique) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis.structure.loadType(unique);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\t// TODO: Remove this in v17 as we have moved the publishing methods to the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT.\r\n\t\tthis.consumeContext(UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#publishingContext = context;\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.isNew,\r\n\t\t\t(isNew) => {\r\n\t\t\t\tif (isNew === undefined) return;\r\n\t\t\t\tif (isNew) {\r\n\t\t\t\t\tthis.#enforceUserPermission(\r\n\t\t\t\t\t\tUMB_USER_PERMISSION_DOCUMENT_CREATE,\r\n\t\t\t\t\t\t'You do not have permission to create documents.',\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.#enforceUserPermission(\r\n\t\t\t\t\t\tUMB_USER_PERMISSION_DOCUMENT_UPDATE,\r\n\t\t\t\t\t\t'You do not have permission to update documents.',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: UMB_CREATE_FROM_BLUEPRINT_DOCUMENT_WORKSPACE_PATH_PATTERN.toString(),\r\n\t\t\t\tcomponent: () => import('./document-workspace-editor.element.js'),\r\n\t\t\t\tsetup: async (_component, info) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.parentEntityType;\r\n\t\t\t\t\tconst parentUnique: string | null =\r\n\t\t\t\t\t\tinfo.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tconst documentTypeUnique = info.match.params.documentTypeUnique;\r\n\t\t\t\t\tconst blueprintUnique = info.match.params.blueprintUnique;\r\n\r\n\t\t\t\t\tawait this.create(\r\n\t\t\t\t\t\t{ entityType: parentEntityType, unique: parentUnique },\r\n\t\t\t\t\t\tdocumentTypeUnique,\r\n\t\t\t\t\t\tblueprintUnique,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: UMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN.toString(),\r\n\t\t\t\tcomponent: () => import('./document-workspace-editor.element.js'),\r\n\t\t\t\tsetup: async (_component, info) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.parentEntityType;\r\n\t\t\t\t\tconst parentUnique = info.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tconst documentTypeUnique = info.match.params.documentTypeUnique;\r\n\t\t\t\t\tawait this.create({ entityType: parentEntityType, unique: parentUnique }, documentTypeUnique);\r\n\t\t\t\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: UMB_EDIT_DOCUMENT_WORKSPACE_PATH_PATTERN.toString(),\r\n\t\t\t\tcomponent: () => import('./document-workspace-editor.element.js'),\r\n\t\t\t\tsetup: async (_component, info) => {\r\n\t\t\t\t\tthis.removeUmbControllerByAlias(UmbWorkspaceIsNewRedirectControllerAlias);\r\n\t\t\t\t\tconst unique = info.match.params.unique;\r\n\t\t\t\t\tawait this.load(unique);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\t#enforceUserPermission(verb: string, message: string) {\r\n\t\t// We set the initial permission state to false because the condition is false by default and only execute the callback if it changes.\r\n\t\tthis.#handleUserPermissionChange(verb, false, message);\r\n\r\n\t\tcreateExtensionApiByAlias(this, UMB_DOCUMENT_USER_PERMISSION_CONDITION_ALIAS, [\r\n\t\t\t{\r\n\t\t\t\tconfig: {\r\n\t\t\t\t\tallOf: [verb],\r\n\t\t\t\t},\r\n\t\t\t\tonChange: (permitted: boolean) => {\r\n\t\t\t\t\tthis.#handleUserPermissionChange(verb, permitted, message);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\toverride resetState(): void {\r\n\t\tsuper.resetState();\r\n\t\tthis.#isTrashedContext.setIsTrashed(false);\r\n\t}\r\n\r\n\toverride async load(unique: string) {\r\n\t\tconst response = await super.load(unique);\r\n\r\n\t\tif (response?.data) {\r\n\t\t\tthis.#isTrashedContext.setIsTrashed(response.data.isTrashed);\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\tasync create(parent: UmbEntityModel, documentTypeUnique: string, blueprintUnique?: string) {\r\n\t\tif (blueprintUnique) {\r\n\t\t\tconst blueprintRepository = new UmbDocumentBlueprintDetailRepository(this);\r\n\t\t\tconst { data } = await blueprintRepository.scaffoldByUnique(blueprintUnique);\r\n\r\n\t\t\tif (!data) throw new Error('Blueprint data is missing');\r\n\r\n\t\t\treturn this.createScaffold({\r\n\t\t\t\tparent,\r\n\t\t\t\tpreset: {\r\n\t\t\t\t\tdocumentType: data.documentType,\r\n\t\t\t\t\tvalues: data.values,\r\n\t\t\t\t\tvariants: data.variants as Array<UmbDocumentVariantModel>,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.createScaffold({\r\n\t\t\tparent,\r\n\t\t\tpreset: {\r\n\t\t\t\tdocumentType: {\r\n\t\t\t\t\tunique: documentTypeUnique,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\t/** @deprecated will be removed in v.18 */\r\n\tgetCollectionAlias() {\r\n\t\treturn UMB_DOCUMENT_COLLECTION_ALIAS;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the unique identifier of the content type.\r\n\t * @deprecated Use `getContentTypeUnique` instead.\r\n\t * @returns { string | undefined} The unique identifier of the content type.\r\n\t * @memberof UmbDocumentWorkspaceContext\r\n\t */\r\n\tgetContentTypeId(): string | undefined {\r\n\t\treturn this.getContentTypeUnique();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the unique identifier of the content type.\r\n\t * @returns { string | undefined} The unique identifier of the content type.\r\n\t * @memberof UmbDocumentWorkspaceContext\r\n\t */\r\n\tgetContentTypeUnique(): string | undefined {\r\n\t\treturn this.getData()?.documentType.unique;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the template\r\n\t * @param {string} templateUnique The unique identifier of the template.\r\n\t * @memberof UmbDocumentWorkspaceContext\r\n\t */\r\n\tsetTemplate(templateUnique: string) {\r\n\t\tthis._data.updateCurrent({ template: { unique: templateUnique } });\r\n\t}\r\n\r\n\tprotected override async _handleSave() {\r\n\t\tconst elementStyle = (this.getHostElement() as HTMLElement).style;\r\n\t\telementStyle.setProperty('--uui-color-invalid', 'var(--uui-color-warning)');\r\n\t\telementStyle.setProperty('--uui-color-invalid-emphasis', 'var(--uui-color-warning-emphasis)');\r\n\t\telementStyle.setProperty('--uui-color-invalid-standalone', 'var(--uui-color-warning-standalone)');\r\n\t\telementStyle.setProperty('--uui-color-invalid-contrast', 'var(--uui-color-warning-contrast)');\r\n\t\tawait super._handleSave();\r\n\t}\r\n\r\n\tpublic async saveAndPreview(): Promise<void> {\r\n\t\treturn await this.#handleSaveAndPreview();\r\n\t}\r\n\r\n\tasync #handleSaveAndPreview() {\r\n\t\tconst unique = this.getUnique();\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tlet firstVariantId = UmbVariantId.CreateInvariant();\r\n\r\n\t\t// Save document (the active variant) before previewing.\r\n\t\tconst { selected } = await this._determineVariantOptions();\r\n\t\tif (selected.length > 0) {\r\n\t\t\tfirstVariantId = UmbVariantId.FromString(selected[0]);\r\n\t\t\tconst variantIds = [firstVariantId];\r\n\t\t\tconst saveData = await this._data.constructData(variantIds);\r\n\t\t\tawait this.runMandatoryValidationForSaveData(saveData);\r\n\t\t\tawait this.performCreateOrUpdate(variantIds, saveData);\r\n\t\t}\r\n\r\n\t\t// Tell the server that we're entering preview mode.\r\n\t\tawait new UmbDocumentPreviewRepository(this).enter();\r\n\r\n\t\tconst serverContext = await this.getContext(UMB_SERVER_CONTEXT);\r\n\t\tif (!serverContext) {\r\n\t\t\tthrow new Error('Server context is missing');\r\n\t\t}\r\n\r\n\t\tconst backofficePath = serverContext.getBackofficePath();\r\n\t\tconst previewUrl = new URL(ensurePathEndsWithSlash(backofficePath) + 'preview', window.location.origin);\r\n\t\tpreviewUrl.searchParams.set('id', unique);\r\n\r\n\t\tif (firstVariantId.culture) {\r\n\t\t\tpreviewUrl.searchParams.set('culture', firstVariantId.culture);\r\n\t\t}\r\n\r\n\t\tif (firstVariantId.segment) {\r\n\t\t\tpreviewUrl.searchParams.set('segment', firstVariantId.segment);\r\n\t\t}\r\n\r\n\t\tconst previewWindow = window.open(previewUrl.toString(), `umbpreview-${unique}`);\r\n\t\tpreviewWindow?.focus();\r\n\t}\r\n\r\n\tpublic async publish() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tdeprecated: 'The Publish method on the UMB_DOCUMENT_WORKSPACE_CONTEXT is deprecated.',\r\n\t\t\tremoveInVersion: '17.0.0',\r\n\t\t\tsolution: 'Use the Publish method on the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.',\r\n\t\t}).warn();\r\n\t\tif (!this.#publishingContext) throw new Error('Publishing context is missing');\r\n\t\tawait this.#publishingContext.publish();\r\n\t}\r\n\r\n\t/**\r\n\t * Save the document and publish it.\r\n\t * @deprecated Will be removed in v17. Use the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.\r\n\t */\r\n\tpublic async saveAndPublish(): Promise<void> {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tdeprecated: 'The SaveAndPublish method on the UMB_DOCUMENT_WORKSPACE_CONTEXT is deprecated.',\r\n\t\t\tremoveInVersion: '17.0.0',\r\n\t\t\tsolution: 'Use the SaveAndPublish method on the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.',\r\n\t\t}).warn();\r\n\t\tif (!this.#publishingContext) throw new Error('Publishing context is missing');\r\n\t\tawait this.#publishingContext.saveAndPublish();\r\n\t}\r\n\r\n\t/**\r\n\t * Schedule the document to be published at a later date.\r\n\t * @deprecated Will be removed in v17. Use the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.\r\n\t */\r\n\tpublic async schedule() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tdeprecated: 'The Schedule method on the UMB_DOCUMENT_WORKSPACE_CONTEXT is deprecated.',\r\n\t\t\tremoveInVersion: '17.0.0',\r\n\t\t\tsolution: 'Use the Schedule method on the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.',\r\n\t\t}).warn();\r\n\t\tif (!this.#publishingContext) throw new Error('Publishing context is missing');\r\n\t\tawait this.#publishingContext.schedule();\r\n\t}\r\n\r\n\t/**\r\n\t * Unpublish the document.\r\n\t * @deprecated Will be removed in v17. Use the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.\r\n\t */\r\n\tpublic async unpublish() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tdeprecated: 'The Unpublish method on the UMB_DOCUMENT_WORKSPACE_CONTEXT is deprecated.',\r\n\t\t\tremoveInVersion: '17.0.0',\r\n\t\t\tsolution: 'Use the Unpublish method on the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.',\r\n\t\t}).warn();\r\n\t\tif (!this.#publishingContext) throw new Error('Publishing context is missing');\r\n\t\tawait this.#publishingContext.unpublish();\r\n\t}\r\n\r\n\t/**\r\n\t * Publish the document and all its descendants.\r\n\t * @deprecated Will be removed in v17. Use the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.\r\n\t */\r\n\tpublic async publishWithDescendants() {\r\n\t\tnew UmbDeprecation({\r\n\t\t\tdeprecated: 'The PublishWithDescendants method on the UMB_DOCUMENT_WORKSPACE_CONTEXT is deprecated.',\r\n\t\t\tremoveInVersion: '17.0.0',\r\n\t\t\tsolution: 'Use the PublishWithDescendants method on the UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT instead.',\r\n\t\t}).warn();\r\n\t\tif (!this.#publishingContext) throw new Error('Publishing context is missing');\r\n\t\tawait this.#publishingContext.publishWithDescendants();\r\n\t}\r\n\r\n\tpublic createPropertyDatasetContext(\r\n\t\thost: UmbControllerHost,\r\n\t\tvariantId: UmbVariantId,\r\n\t): UmbDocumentPropertyDatasetContext {\r\n\t\treturn new UmbDocumentPropertyDatasetContext(host, this, variantId);\r\n\t}\r\n\r\n\tasync #handleUserPermissionChange(identifier: string, permitted: boolean, message: string) {\r\n\t\tif (permitted) {\r\n\t\t\tthis.readOnlyGuard?.removeRule(identifier);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.readOnlyGuard?.addRule({\r\n\t\t\tunique: identifier,\r\n\t\t\tmessage,\r\n\t\t\t/* This guard is a bit backwards. The rule is permitted to be read-only.\r\n\t\t\tIf the user does not have permission, we set it to true = permitted to be read-only. */\r\n\t\t\tpermitted: true,\r\n\t\t});\r\n\t}\r\n\r\n\t#preventEditInvariantFromNonDefault() {\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.structure.contentTypeProperties, this.variantOptions]),\r\n\t\t\t([properties, variantOptions]) => {\r\n\t\t\t\tif (properties.length === 0) return;\r\n\t\t\t\tif (variantOptions.length === 0) return;\r\n\r\n\t\t\t\tvariantOptions.forEach((variantOption) => {\r\n\t\t\t\t\t// Do not add a rule for the default language. It is always permitted to edit.\r\n\t\t\t\t\tif (variantOption.language.isDefault) return;\r\n\r\n\t\t\t\t\tconst datasetVariantId = UmbVariantId.CreateFromPartial(variantOption);\r\n\t\t\t\t\tconst invariantVariantId = UmbVariantId.CreateInvariant();\r\n\t\t\t\t\tconst unique = `UMB_PREVENT_EDIT_INVARIANT_FROM_NON_DEFAULT_DATASET=${datasetVariantId.toString()}_PROPERTY_${invariantVariantId.toString()}`;\r\n\r\n\t\t\t\t\tconst rule: UmbVariantPropertyGuardRule = {\r\n\t\t\t\t\t\tunique,\r\n\t\t\t\t\t\tmessage: 'Shared properties can only be edited in the default language',\r\n\t\t\t\t\t\tvariantId: invariantVariantId,\r\n\t\t\t\t\t\tdatasetVariantId,\r\n\t\t\t\t\t\tpermitted: false,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.propertyWriteGuard.addRule(rule);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default UmbDocumentWorkspaceContext;\r\n"],"names":["UmbDocumentPropertyDatasetContext","UmbContentPropertyDatasetContext","host","dataOwner","variantId","UmbDocumentValidationServerDataSource","#host","model","parentUnique","body","data","error","tryExecute","DocumentService","variantIds","cultures","id","culture","UmbDocumentValidationRepository","UmbRepositoryBase","#validationDataSource","UmbDocumentWorkspaceContext","UmbContentDetailWorkspaceContextBase","UMB_DOCUMENT_ENTITY_TYPE","UMB_DOCUMENT_WORKSPACE_ALIAS","UMB_DOCUMENT_COLLECTION_ALIAS","UMB_DOCUMENT_DETAIL_REPOSITORY_ALIAS","UmbDocumentTypeDetailRepository","UMB_DOCUMENT_DETAIL_MODEL_VARIANT_SCAFFOLD","UMB_DOCUMENT_SAVE_MODAL","UmbDocumentPublishingRepository","#isTrashedContext","UmbIsTrashedEntityContext","UMB_DOCUMENT_CONFIGURATION_CONTEXT","context","config","allowSegmentCreation","allowEditInvariantFromNonDefault","UmbDeprecation","variantOption","isNotCreatedSegmentVariant","#preventEditInvariantFromNonDefault","unique","UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT","#publishingContext","isNew","#enforceUserPermission","UMB_USER_PERMISSION_DOCUMENT_CREATE","UMB_USER_PERMISSION_DOCUMENT_UPDATE","UMB_CREATE_FROM_BLUEPRINT_DOCUMENT_WORKSPACE_PATH_PATTERN","_component","info","parentEntityType","documentTypeUnique","blueprintUnique","UmbWorkspaceIsNewRedirectController","UMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN","UMB_EDIT_DOCUMENT_WORKSPACE_PATH_PATTERN","UmbWorkspaceIsNewRedirectControllerAlias","verb","message","#handleUserPermissionChange","createExtensionApiByAlias","UMB_DOCUMENT_USER_PERMISSION_CONDITION_ALIAS","permitted","response","parent","blueprintRepository","UmbDocumentBlueprintDetailRepository","templateUnique","elementStyle","#handleSaveAndPreview","firstVariantId","UmbVariantId","selected","saveData","UmbDocumentPreviewRepository","serverContext","UMB_SERVER_CONTEXT","backofficePath","previewUrl","ensurePathEndsWithSlash","identifier","observeMultiple","properties","variantOptions","datasetVariantId","invariantVariantId","rule"],"mappings":"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"}