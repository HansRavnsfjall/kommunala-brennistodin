{"version":3,"file":"input-document-granular-user-permission.element-DTcOaSbr.js","sources":["../../../src/packages/documents/documents/user-permissions/document/input-document-granular-user-permission/input-document-granular-user-permission.element.ts"],"sourcesContent":["import type { UmbDocumentUserPermissionModel } from '../types.js';\r\nimport { UmbDocumentItemRepository } from '../../../item/index.js';\r\nimport type { UmbDocumentItemModel } from '../../../item/types.js';\r\nimport { UMB_DOCUMENT_PICKER_MODAL } from '../../../constants.js';\r\nimport { css, customElement, html, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDeselectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbChangeEvent, UmbSelectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UUIFormControlMixin } from '@umbraco-cms/backoffice/external/uui';\r\nimport {\r\n\tUMB_ENTITY_USER_PERMISSION_MODAL,\r\n\ttype ManifestEntityUserPermission,\r\n} from '@umbraco-cms/backoffice/user-permission';\r\n\r\n@customElement('umb-input-document-granular-user-permission')\r\nexport class UmbInputDocumentGranularUserPermissionElement extends UUIFormControlMixin(UmbLitElement, '') {\r\n\t#permissions: Array<UmbDocumentUserPermissionModel> = [];\r\n\tpublic get permissions(): Array<UmbDocumentUserPermissionModel> {\r\n\t\treturn this.#permissions;\r\n\t}\r\n\tpublic set permissions(value: Array<UmbDocumentUserPermissionModel>) {\r\n\t\tthis.#permissions = value;\r\n\t\tconst uniques = value.map((item) => item.document.id);\r\n\t\tthis.#observePickedDocuments(uniques);\r\n\t}\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tfallbackPermissions: Array<string> = [];\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbDocumentItemModel>;\r\n\r\n\t#documentItemRepository = new UmbDocumentItemRepository(this);\r\n\t#modalManagerContext?: UmbModalManagerContext;\r\n\t#documentPickerModalContext?: any;\r\n\t#entityUserPermissionModalContext?: any;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => (this.#modalManagerContext = instance));\r\n\t}\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tasync #observePickedDocuments(uniques: Array<string>) {\r\n\t\tconst { asObservable } = await this.#documentItemRepository.requestItems(uniques);\r\n\t\tthis.observe(asObservable?.(), (items) => (this._items = items), 'observeItems');\r\n\t}\r\n\r\n\tasync #editGranularPermission(item: UmbDocumentItemModel) {\r\n\t\tconst currentPermissionVerbs = this.#getPermissionForDocument(item.unique)?.verbs ?? [];\r\n\t\tconst result = await this.#selectEntityUserPermissionsForDocument(item, currentPermissionVerbs);\r\n\t\t// don't do anything if the verbs have not been updated\r\n\t\tif (JSON.stringify(result) === JSON.stringify(currentPermissionVerbs)) return;\r\n\r\n\t\t// update permission with new verbs\r\n\t\tthis.permissions = this.#permissions.map((permission) => {\r\n\t\t\tif (permission.document.id === item.unique) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...permission,\r\n\t\t\t\t\tverbs: result,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn permission;\r\n\t\t});\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #addGranularPermission() {\r\n\t\tthis.#documentPickerModalContext = this.#modalManagerContext?.open(this, UMB_DOCUMENT_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\thideTreeRoot: true,\r\n\t\t\t\t// prevent already selected items to be picked again\r\n\t\t\t\t// TODO: this type is wrong. It should be the tree item type\r\n\t\t\t\tpickableFilter: (treeItem: UmbDocumentItemModel) =>\r\n\t\t\t\t\t!this._items?.map((i) => i.unique).includes(treeItem.unique),\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.#documentPickerModalContext?.addEventListener(UmbSelectedEvent.TYPE, async (event: UmbDeselectedEvent) => {\r\n\t\t\tconst selectedEvent = event as UmbSelectedEvent;\r\n\t\t\tconst unique = selectedEvent.unique;\r\n\t\t\tif (!unique) return;\r\n\r\n\t\t\tconst documentItem = await this.#requestDocumentItem(unique);\r\n\r\n\t\t\tthis.#selectEntityUserPermissionsForDocument(documentItem).then(\r\n\t\t\t\t(result) => {\r\n\t\t\t\t\tthis.#documentPickerModalContext?.reject();\r\n\r\n\t\t\t\t\tconst permissionItem: UmbDocumentUserPermissionModel = {\r\n\t\t\t\t\t\t$type: 'DocumentPermissionPresentationModel',\r\n\t\t\t\t\t\tdocument: { id: unique },\r\n\t\t\t\t\t\tverbs: result,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.permissions = [...this.#permissions, permissionItem];\r\n\t\t\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.#documentPickerModalContext?.reject();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestDocumentItem(unique: string) {\r\n\t\tif (!unique) throw new Error('Could not open permissions modal, no unique was provided');\r\n\r\n\t\tconst { data } = await this.#documentItemRepository.requestItems([unique]);\r\n\r\n\t\tconst documentItem = data?.[0];\r\n\t\tif (!documentItem) throw new Error('No document item found');\r\n\t\treturn documentItem;\r\n\t}\r\n\r\n\tasync #selectEntityUserPermissionsForDocument(item: UmbDocumentItemModel, allowedVerbs: Array<string> = []) {\r\n\t\t// TODO: get correct variant name\r\n\t\tconst name = item.variants[0]?.name;\r\n\t\tconst headline = name ? `Permissions for ${name}` : 'Permissions';\r\n\t\tconst fallbackVerbs = this.#getFallbackPermissionVerbsForEntityType(item.entityType);\r\n\t\tconst value = allowedVerbs.length > 0 ? { allowedVerbs } : undefined;\r\n\t\tthis.#entityUserPermissionModalContext = this.#modalManagerContext?.open(this, UMB_ENTITY_USER_PERMISSION_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tunique: item.unique,\r\n\t\t\t\tentityType: item.entityType,\r\n\t\t\t\theadline,\r\n\t\t\t\tpreset: {\r\n\t\t\t\t\tallowedVerbs: fallbackVerbs,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tvalue,\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\t// When the modal is submitted we return the new value from the modal\r\n\t\t\tconst value = await this.#entityUserPermissionModalContext?.onSubmit();\r\n\t\t\treturn value?.allowedVerbs;\r\n\t\t} catch {\r\n\t\t\t// When the modal is rejected we return the current value\r\n\t\t\treturn allowedVerbs;\r\n\t\t}\r\n\t}\r\n\r\n\t#removeGranularPermission(item: UmbDocumentItemModel) {\r\n\t\tconst permission = this.#getPermissionForDocument(item.unique);\r\n\t\tif (!permission) return;\r\n\r\n\t\tthis.permissions = this.#permissions.filter((v) => JSON.stringify(v) !== JSON.stringify(permission));\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderItems()} ${this.#renderAddButton()}`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => this.#renderRef(item),\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\treturn html`<uui-button\r\n\t\t\tid=\"btn-add\"\r\n\t\t\tlook=\"placeholder\"\r\n\t\t\t@click=${this.#addGranularPermission}\r\n\t\t\tlabel=${this.localize.term('general_add')}></uui-button>`;\r\n\t}\r\n\r\n\t#renderRef(item: UmbDocumentItemModel) {\r\n\t\tif (!item.unique) return;\r\n\t\t// TODO: get correct variant name\r\n\t\tconst name = item.variants[0]?.name;\r\n\t\tconst permissionNames = this.#getPermissionNamesForDocument(item.unique);\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-ref-node .name=${name} .detail=${permissionNames || ''}>\r\n\t\t\t\t${this.#renderIcon(item)} ${this.#renderIsTrashed(item)}\r\n\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t${this.#renderEditButton(item)} ${this.#renderRemoveButton(item)}\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</uui-ref-node>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderIcon(item: UmbDocumentItemModel) {\r\n\t\tif (!item.documentType.icon) return;\r\n\t\treturn html`<uui-icon slot=\"icon\" name=${item.documentType.icon}></uui-icon>`;\r\n\t}\r\n\r\n\t#renderIsTrashed(item: UmbDocumentItemModel) {\r\n\t\tif (!item.isTrashed) return;\r\n\t\treturn html`<uui-tag size=\"s\" slot=\"tag\" color=\"danger\">Trashed</uui-tag>`;\r\n\t}\r\n\r\n\t#renderEditButton(item: UmbDocumentItemModel) {\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\t@click=${() => this.#editGranularPermission(item)}\r\n\t\t\t\tlabel=${this.localize.term('general_edit')}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRemoveButton(item: UmbDocumentItemModel) {\r\n\t\treturn html`<uui-button\r\n\t\t\t@click=${() => this.#removeGranularPermission(item)}\r\n\t\t\tlabel=${this.localize.term('general_remove')}></uui-button>`;\r\n\t}\r\n\r\n\t#getPermissionForDocument(unique: string) {\r\n\t\treturn this.#permissions?.find((permission) => permission.document.id === unique);\r\n\t}\r\n\r\n\t#getPermissionNamesForDocument(unique: string) {\r\n\t\tconst permission = this.#getPermissionForDocument(unique);\r\n\t\tif (!permission) return;\r\n\r\n\t\treturn umbExtensionsRegistry\r\n\t\t\t.getByTypeAndFilter('entityUserPermission', (manifest) =>\r\n\t\t\t\tmanifest.meta.verbs.every((verb) => permission.verbs.includes(verb)),\r\n\t\t\t)\r\n\t\t\t.map((m) => {\r\n\t\t\t\tconst manifest = m as ManifestEntityUserPermission;\r\n\t\t\t\treturn manifest.meta.label ? this.localize.string(manifest.meta.label) : manifest.name;\r\n\t\t\t})\r\n\t\t\t.join(', ');\r\n\t}\r\n\r\n\t#getFallbackPermissionVerbsForEntityType(entityType: string) {\r\n\t\t// get all permissions that are allowed for the entity type and have at least one of the fallback permissions\r\n\t\t// this is used to determine the default permissions for a document\r\n\t\tconst verbs = umbExtensionsRegistry\r\n\t\t\t.getByTypeAndFilter(\r\n\t\t\t\t'entityUserPermission',\r\n\t\t\t\t(manifest) =>\r\n\t\t\t\t\tmanifest.forEntityTypes.includes(entityType) &&\r\n\t\t\t\t\tthis.fallbackPermissions.map((verb) => manifest.meta.verbs.includes(verb)).includes(true),\r\n\t\t\t)\r\n\t\t\t.flatMap((permission) => permission.meta.verbs);\r\n\r\n\t\t// ensure that the verbs are unique\r\n\t\treturn [...new Set([...verbs])];\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputDocumentGranularUserPermissionElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-granular-user-permission': UmbInputDocumentGranularUserPermissionElement;\r\n\t}\r\n}\r\n"],"names":["_permissions","_documentItemRepository","_modalManagerContext","_documentPickerModalContext","_entityUserPermissionModalContext","_UmbInputDocumentGranularUserPermissionElement_instances","observePickedDocuments_fn","editGranularPermission_fn","addGranularPermission_fn","requestDocumentItem_fn","selectEntityUserPermissionsForDocument_fn","removeGranularPermission_fn","renderItems_fn","renderAddButton_fn","renderRef_fn","renderIcon_fn","renderIsTrashed_fn","renderEditButton_fn","renderRemoveButton_fn","getPermissionForDocument_fn","getPermissionNamesForDocument_fn","getFallbackPermissionVerbsForEntityType_fn","UmbInputDocumentGranularUserPermissionElement","UUIFormControlMixin","UmbLitElement","__privateAdd","UmbDocumentItemRepository","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","__privateGet","value","uniques","item","__privateMethod","html","asObservable","items","currentPermissionVerbs","result","permission","UmbChangeEvent","UMB_DOCUMENT_PICKER_MODAL","treeItem","i","UmbSelectedEvent","event","unique","documentItem","permissionItem","data","allowedVerbs","name","headline","fallbackVerbs","UMB_ENTITY_USER_PERMISSION_MODAL","v","repeat","permissionNames","umbExtensionsRegistry","manifest","verb","m","entityType","verbs","css","__decorateClass","property","state","customElement","UmbInputDocumentGranularUserPermissionElement$1"],"mappings":";;;;;;;;;;;;;;;;;;;wYAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAkBO,IAAMC,IAAN,cAA4DC,EAAoBC,GAAe,EAAE,EAAE;AAAA,EAsBzG,cAAc;AACb,UAAA,GAvBKC,EAAA,MAAApB,CAAA,GACNoB,EAAA,MAAAzB,GAAsD,EAAC,GAWvD,KAAA,sBAAqC,CAAA,GAKrCyB,EAAA,MAAAxB,GAA0B,IAAIyB,EAA0B,IAAI,CAAA,GAC5DD,EAAA,MAAAvB,CAAA,GACAuB,EAAA,MAAAtB,CAAA,GACAsB,EAAA,MAAArB,CAAA,GAKC,KAAK,eAAeuB,GAA2B,CAACC,MAAcC,EAAA,MAAK3B,GAAuB0B,CAAA,CAAS;AAAA,EACpG;AAAA,EAxBA,IAAW,cAAqD;AAC/D,WAAOE,EAAA,MAAK9B,CAAA;AAAA,EACb;AAAA,EACA,IAAW,YAAY+B,GAA8C;AACpE,IAAAF,EAAA,MAAK7B,GAAe+B,CAAA;AACpB,UAAMC,IAAUD,EAAM,IAAI,CAACE,MAASA,EAAK,SAAS,EAAE;AACpD,IAAAC,EAAA,MAAK7B,MAAL,KAAA,MAA6B2B,CAAA;AAAA,EAC9B;AAAA,EAmBmB,iBAAiB;AAAA,EAEpC;AAAA,EA+GS,SAAS;AACjB,WAAOG,IAAOD,EAAA,MAAK7B,GAAAO,CAAA,EAAL,UAAmB,IAAIsB,EAAA,MAAK7B,MAAL,KAAA,IAAA,CAAuB;AAAA,EAC7D;AAyGD;AAvPCL,IAAA,oBAAA,QAAA;AAgBAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AApBMC,IAAA,oBAAA,QAAA;AAgCAC,IAAuB,eAAC0B,GAAwB;AACrD,QAAM,EAAE,cAAAI,EAAA,IAAiB,MAAMN,EAAA,MAAK7B,CAAA,EAAwB,aAAa+B,CAAO;AAChF,OAAK,QAAQI,OAAkB,CAACC,MAAW,KAAK,SAASA,GAAQ,cAAc;AAChF;AAEM9B,IAAuB,eAAC0B,GAA4B;AACzD,QAAMK,IAAyBJ,EAAA,MAAK7B,GAAAc,CAAA,EAAL,WAA+Bc,EAAK,MAAA,GAAS,SAAS,CAAA,GAC/EM,IAAS,MAAML,EAAA,MAAK7B,GAAAK,CAAA,EAAL,WAA6CuB,GAAMK,CAAA;AAExE,EAAI,KAAK,UAAUC,CAAM,MAAM,KAAK,UAAUD,CAAsB,MAGpE,KAAK,cAAcR,EAAA,MAAK9B,CAAA,EAAa,IAAI,CAACwC,MACrCA,EAAW,SAAS,OAAOP,EAAK,SAC5B;AAAA,IACN,GAAGO;AAAA,IACH,OAAOD;AAAA,EAAA,IAGFC,CACP,GAED,KAAK,cAAc,IAAIC,GAAgB;AACxC;AAEMjC,IAAsB,iBAAG;AAC9B,EAAAqB,EAAA,MAAK1B,GAA8B2B,EAAA,MAAK5B,CAAA,GAAsB,KAAK,MAAMwC,GAA2B;AAAA,IACnG,MAAM;AAAA,MACL,cAAc;AAAA;AAAA;AAAA,MAGd,gBAAgB,CAACC,MAChB,CAAC,KAAK,QAAQ,IAAI,CAACC,MAAMA,EAAE,MAAM,EAAE,SAASD,EAAS,MAAM;AAAA,IAAA;AAAA,EAC7D,CACA,CAAA,GAEDb,EAAA,MAAK3B,CAAA,GAA6B,iBAAiB0C,EAAiB,MAAM,OAAOC,MAA8B;AAE9G,UAAMC,IADgBD,EACO;AAC7B,QAAI,CAACC,EAAQ;AAEb,UAAMC,IAAe,MAAMd,EAAA,MAAK7B,GAAAI,CAAA,EAAL,KAAA,MAA0BsC,CAAA;AAErD,IAAAb,EAAA,MAAK7B,GAAAK,CAAA,EAAL,WAA6CsC,CAAA,EAAc;AAAA,MAC1D,CAACT,MAAW;AACX,QAAAT,EAAA,MAAK3B,IAA6B,OAAA;AAElC,cAAM8C,IAAiD;AAAA,UACtD,OAAO;AAAA,UACP,UAAU,EAAE,IAAIF,EAAA;AAAA,UAChB,OAAOR;AAAA,QAAA;AAGR,aAAK,cAAc,CAAC,GAAGT,EAAA,MAAK9B,IAAciD,CAAc,GACxD,KAAK,cAAc,IAAIR,GAAgB;AAAA,MACxC;AAAA,MACA,MAAM;AACL,QAAAX,EAAA,MAAK3B,IAA6B,OAAA;AAAA,MACnC;AAAA,IAAA;AAAA,EAEF,CAAC;AACF;AAEMM,IAAoB,eAACsC,GAAgB;AAC1C,MAAI,CAACA,EAAQ,OAAM,IAAI,MAAM,0DAA0D;AAEvF,QAAM,EAAE,MAAAG,MAAS,MAAMpB,QAAK7B,CAAA,EAAwB,aAAa,CAAC8C,CAAM,CAAC,GAEnEC,IAAeE,IAAO,CAAC;AAC7B,MAAI,CAACF,EAAc,OAAM,IAAI,MAAM,wBAAwB;AAC3D,SAAOA;AACR;AAEMtC,IAAuC,eAACuB,GAA4BkB,IAA8B,IAAI;AAE3G,QAAMC,IAAOnB,EAAK,SAAS,CAAC,GAAG,MACzBoB,IAAWD,IAAO,mBAAmBA,CAAI,KAAK,eAC9CE,IAAgBpB,EAAA,MAAK7B,GAAAgB,CAAA,EAAL,KAAA,MAA8CY,EAAK,UAAA,GACnEF,IAAQoB,EAAa,SAAS,IAAI,EAAE,cAAAA,MAAiB;AAC3D,EAAAtB,EAAA,MAAKzB,GAAoC0B,EAAA,MAAK5B,CAAA,GAAsB,KAAK,MAAMqD,GAAkC;AAAA,IAChH,MAAM;AAAA,MACL,QAAQtB,EAAK;AAAA,MACb,YAAYA,EAAK;AAAA,MACjB,UAAAoB;AAAA,MACA,QAAQ;AAAA,QACP,cAAcC;AAAA,MAAA;AAAA,IACf;AAAA,IAED,OAAAvB;AAAA,EAAA,CACA,CAAA;AAED,MAAI;AAGH,YADc,MAAMD,EAAA,MAAK1B,CAAA,GAAmC,SAAA,IAC9C;AAAA,EACf,QAAQ;AAEP,WAAO+C;AAAA,EACR;AACD;AAEAxC,IAAyB,SAACsB,GAA4B;AACrD,QAAMO,IAAaN,EAAA,MAAK7B,GAAAc,CAAA,EAAL,KAAA,MAA+Bc,EAAK,MAAA;AACvD,EAAKO,MAEL,KAAK,cAAcV,EAAA,MAAK9B,CAAA,EAAa,OAAO,CAACwD,MAAM,KAAK,UAAUA,CAAC,MAAM,KAAK,UAAUhB,CAAU,CAAC,GACnG,KAAK,cAAc,IAAIC,GAAgB;AACxC;AAMA7B,IAAY,WAAG;AACd,MAAK,KAAK;AACV,WAAOuB;AAAA;AAAA,MAEHsB;AAAA,MACD,KAAK;AAAA,MACL,CAACxB,MAASA,EAAK;AAAA,MACf,CAACA,MAASC,EAAA,MAAK7B,GAAAS,CAAA,EAAL,KAAA,MAAgBmB,CAAA;AAAA,IAAA,CAC1B;AAAA;AAAA;AAGJ;AAEApB,IAAgB,WAAG;AAClB,SAAOsB;AAAA;AAAA;AAAA,YAGGD,QAAK7B,GAAAG,CAAA,CAAsB;AAAA,WAC5B,KAAK,SAAS,KAAK,aAAa,CAAC;AAC3C;AAEAM,IAAU,SAACmB,GAA4B;AACtC,MAAI,CAACA,EAAK,OAAQ;AAElB,QAAMmB,IAAOnB,EAAK,SAAS,CAAC,GAAG,MACzByB,IAAkBxB,EAAA,MAAK7B,GAAAe,CAAA,EAAL,KAAA,MAAoCa,EAAK,MAAA;AAEjE,SAAOE;AAAA,yBACgBiB,CAAI,YAAYM,KAAmB,EAAE;AAAA,MACxDxB,EAAA,MAAK7B,MAAL,KAAA,MAAiB4B,CAAA,CAAK,IAAIC,EAAA,MAAK7B,GAAAW,CAAA,EAAL,WAAsBiB,CAAA,CAAK;AAAA;AAAA,OAEpDC,EAAA,MAAK7B,MAAL,KAAA,MAAuB4B,CAAA,CAAK,IAAIC,EAAA,MAAK7B,GAAAa,CAAA,EAAL,WAAyBe,CAAA,CAAK;AAAA;AAAA;AAAA;AAIpE;AAEAlB,IAAW,SAACkB,GAA4B;AACvC,MAAKA,EAAK,aAAa;AACvB,WAAOE,+BAAkCF,EAAK,aAAa,IAAI;AAChE;AAEAjB,IAAgB,SAACiB,GAA4B;AAC5C,MAAKA,EAAK;AACV,WAAOE;AACR;AAEAlB,IAAiB,SAACgB,GAA4B;AAC7C,SAAOE;AAAA;AAAA,aAEI,MAAMD,EAAA,MAAK7B,GAAAE,CAAA,EAAL,KAAA,MAA6B0B,CAAA,CAAK;AAAA,YACzC,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA;AAE7C;AAEAf,IAAmB,SAACe,GAA4B;AAC/C,SAAOE;AAAA,YACG,MAAMD,EAAA,MAAK7B,GAAAM,CAAA,EAAL,KAAA,MAA+BsB,CAAA,CAAK;AAAA,WAC3C,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAC9C;AAEAd,IAAyB,SAAC4B,GAAgB;AACzC,SAAOjB,EAAA,MAAK9B,IAAc,KAAK,CAACwC,MAAeA,EAAW,SAAS,OAAOO,CAAM;AACjF;AAEA3B,IAA8B,SAAC2B,GAAgB;AAC9C,QAAMP,IAAaN,EAAA,MAAK7B,GAAAc,CAAA,EAAL,KAAA,MAA+B4B,CAAA;AAClD,MAAKP;AAEL,WAAOmB,EACL;AAAA,MAAmB;AAAA,MAAwB,CAACC,MAC5CA,EAAS,KAAK,MAAM,MAAM,CAACC,MAASrB,EAAW,MAAM,SAASqB,CAAI,CAAC;AAAA,IAAA,EAEnE,IAAI,CAACC,MAAM;AACX,YAAMF,IAAWE;AACjB,aAAOF,EAAS,KAAK,QAAQ,KAAK,SAAS,OAAOA,EAAS,KAAK,KAAK,IAAIA,EAAS;AAAA,IACnF,CAAC,EACA,KAAK,IAAI;AACZ;AAEAvC,IAAwC,SAAC0C,GAAoB;AAG5D,QAAMC,IAAQL,EACZ;AAAA,IACA;AAAA,IACA,CAACC,MACAA,EAAS,eAAe,SAASG,CAAU,KAC3C,KAAK,oBAAoB,IAAI,CAACF,MAASD,EAAS,KAAK,MAAM,SAASC,CAAI,CAAC,EAAE,SAAS,EAAI;AAAA,EAAA,EAEzF,QAAQ,CAACrB,MAAeA,EAAW,KAAK,KAAK;AAG/C,SAAO,CAAC,GAAG,oBAAI,IAAI,CAAC,GAAGwB,CAAK,CAAC,CAAC;AAC/B;AA/OY1C,EAiPI,SAAS;AAAA,EACxB2C;AAAA;AAAA;AAAA;AAAA;AAKD;AA3OAC,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAO,WAAW,IAAO;AAAA,GAX/B7C,EAYZ,WAAA,uBAAA,CAAA;AAGQ4C,EAAA;AAAA,EADPE,EAAA;AAAM,GAdK9C,EAeJ,WAAA,UAAA,CAAA;AAfIA,IAAN4C,EAAA;AAAA,EADNG,EAAc,6CAA6C;AAAA,GAC/C/C,CAAA;AA0Pb,MAAAgD,KAAehD;"}