{"version":3,"file":"property-type-modal.element-eMOjRR3_.js","sources":["../../../src/packages/documents/documents/user-permissions/document-property-value/document-property-value-permission-flow-modal/property-type-modal/property-type-modal.element.ts"],"sourcesContent":["import { UMB_DOCUMENT_PROPERTY_VALUE_ENTITY_TYPE } from '../../../../entity.js';\r\nimport type {\r\n\tUmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalData,\r\n\tUmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalValue,\r\n} from './property-type-modal.token.js';\r\nimport { html, customElement, state, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UMB_MODAL_MANAGER_CONTEXT, UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbPropertyTypeModel } from '@umbraco-cms/backoffice/content-type';\r\nimport { UmbDocumentTypeDetailRepository } from '@umbraco-cms/backoffice/document-type';\r\nimport { UMB_ENTITY_USER_PERMISSION_MODAL } from '@umbraco-cms/backoffice/user-permission';\r\n\r\n@customElement('umb-document-property-value-user-permission-flow-property-type-modal')\r\nexport class UmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalElement extends UmbModalBaseElement<\r\n\tUmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalData,\r\n\tUmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalValue\r\n> {\r\n\t@state()\r\n\tprivate _documentTypeProperties: Array<UmbPropertyTypeModel> = [];\r\n\r\n\t@state()\r\n\tprivate _documentTypeName?: string;\r\n\r\n\t@state()\r\n\tprivate _selectedItem: UmbPropertyTypeModel | null = null;\r\n\r\n\t@state()\r\n\tprivate _pickableFilter: (propertyType: UmbPropertyTypeModel) => boolean = () => true;\r\n\r\n\t#detailRepository = new UmbDocumentTypeDetailRepository(this);\r\n\r\n\t#onItemSelected(event: CustomEvent, item: UmbPropertyTypeModel) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis._selectedItem = item;\r\n\t}\r\n\r\n\t#onItemDeselected(event: CustomEvent) {\r\n\t\tevent.stopPropagation();\r\n\t\tthis._selectedItem = null;\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tif (!this.data?.documentType?.unique) {\r\n\t\t\tthrow new Error('Document type unique is required');\r\n\t\t}\r\n\r\n\t\tthis._pickableFilter = this.data.pickableFilter ?? this._pickableFilter;\r\n\r\n\t\tconst { data } = await this.#detailRepository.requestByUnique(this.data.documentType.unique);\r\n\t\tthis._documentTypeProperties = data?.properties ?? [];\r\n\t\tthis._documentTypeName = data?.name;\r\n\t}\r\n\r\n\t#getItemDetail(item: UmbPropertyTypeModel): string {\r\n\t\tconst isMandatory = item.validation?.mandatory ? ' - Mandatory' : '';\r\n\t\tconst variesByCulture = item.variesByCulture ? ' - Varies by culture' : '';\r\n\t\tconst variesBySegment = item.variesBySegment ? ' - Varies by segment' : '';\r\n\t\treturn `${item.alias} ${isMandatory} ${variesByCulture} ${variesBySegment}`;\r\n\t}\r\n\r\n\t#next() {\r\n\t\tif (!this._selectedItem) {\r\n\t\t\tthrow new Error('Could not proceed, no property was selected');\r\n\t\t}\r\n\r\n\t\tthis.#selectEntityUserPermissionsForProperty();\r\n\t}\r\n\r\n\tasync #selectEntityUserPermissionsForProperty() {\r\n\t\tif (!this._selectedItem) {\r\n\t\t\tthrow new Error('Could not open permissions modal, no property was provided');\r\n\t\t}\r\n\r\n\t\tconst headline = `Permissions for ${this._documentTypeName}: ${this._selectedItem.name}`;\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalManager) {\r\n\t\t\tthrow new Error('Could not open permissions modal, modal manager is not available');\r\n\t\t}\r\n\r\n\t\tconst modal = modalManager.open(this, UMB_ENTITY_USER_PERMISSION_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tentityType: UMB_DOCUMENT_PROPERTY_VALUE_ENTITY_TYPE,\r\n\t\t\t\theadline,\r\n\t\t\t\tpreset: {\r\n\t\t\t\t\tallowedVerbs: this.data?.preset?.verbs ?? [],\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst value = await modal.onSubmit();\r\n\t\t\tthis.updateValue({\r\n\t\t\t\tpropertyType: { unique: this._selectedItem.unique },\r\n\t\t\t\tverbs: value.allowedVerbs,\r\n\t\t\t});\r\n\t\t\tthis._submitModal();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<umb-body-layout headline=\"Choose Property\">\r\n\t\t\t<uui-box>\r\n\t\t\t\t${this._documentTypeProperties.length > 0\r\n\t\t\t\t\t? repeat(\r\n\t\t\t\t\t\t\tthis._documentTypeProperties,\r\n\t\t\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t\t<uui-ref-node\r\n\t\t\t\t\t\t\t\t\tname=${item.name ?? ''}\r\n\t\t\t\t\t\t\t\t\tdetail=${this.#getItemDetail(item)}\r\n\t\t\t\t\t\t\t\t\t?selectable=${this._pickableFilter(item)}\r\n\t\t\t\t\t\t\t\t\tselect-only\r\n\t\t\t\t\t\t\t\t\t@selected=${(event: CustomEvent) => this.#onItemSelected(event, item)}\r\n\t\t\t\t\t\t\t\t\t@deselected=${(event: CustomEvent) => this.#onItemDeselected(event)}\r\n\t\t\t\t\t\t\t\t\t?selected=${this._selectedItem?.unique === item.unique}\r\n\t\t\t\t\t\t\t\t\t?disabled=${!this._pickableFilter(item)}>\r\n\t\t\t\t\t\t\t\t\t<uui-icon slot=\"icon\" name=\"icon-settings\"></uui-icon>\r\n\t\t\t\t\t\t\t\t</uui-ref-node>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t: html`There are no properties to choose from.`}\r\n\t\t\t</uui-box>\r\n\t\t\t<div slot=\"actions\">\r\n\t\t\t\t<uui-button label=\"Close\" @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlabel=\"${this.localize.term('general_next')}\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t@click=${this.#next}\r\n\t\t\t\t\t?disabled=${!this._selectedItem}></uui-button>\r\n\t\t\t</div>\r\n\t\t</umb-body-layout> `;\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-property-value-user-permission-flow-property-type-modal': UmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalElement;\r\n\t}\r\n}\r\n"],"names":["_detailRepository","_UmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalElement_instances","onItemSelected_fn","onItemDeselected_fn","getItemDetail_fn","next_fn","selectEntityUserPermissionsForProperty_fn","UmbDocumentPropertyValueUserPermissionFlowPropertyTypeModalElement","UmbModalBaseElement","__privateAdd","UmbDocumentTypeDetailRepository","data","__privateGet","html","repeat","item","__privateMethod","event","isMandatory","variesByCulture","variesBySegment","headline","modalManager","UMB_MODAL_MANAGER_CONTEXT","modal","UMB_ENTITY_USER_PERMISSION_MODAL","UMB_DOCUMENT_PROPERTY_VALUE_ENTITY_TYPE","value","error","__decorateClass","state","customElement"],"mappings":"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"}