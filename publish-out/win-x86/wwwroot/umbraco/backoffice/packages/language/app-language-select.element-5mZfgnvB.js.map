{"version":3,"file":"app-language-select.element-5mZfgnvB.js","sources":["../../../src/packages/language/app-language-select/app-language-select.element.ts"],"sourcesContent":["import { UmbLanguageCollectionRepository } from '../collection/index.js';\r\nimport type { UmbLanguageDetailModel } from '../types.js';\r\nimport type { UmbAppLanguageContext } from '../global-contexts/index.js';\r\nimport { UMB_APP_LANGUAGE_CONTEXT } from '../constants.js';\r\nimport type {\r\n\tUUIComboboxListElement,\r\n\tUUIComboboxListEvent,\r\n\tUUIPopoverContainerElement,\r\n} from '@umbraco-cms/backoffice/external/uui';\r\nimport { css, html, customElement, state, repeat, query, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_CURRENT_USER_CONTEXT } from '@umbraco-cms/backoffice/current-user';\r\n\r\n@customElement('umb-app-language-select')\r\nexport class UmbAppLanguageSelectElement extends UmbLitElement {\r\n\t@query('#dropdown-popover')\r\n\tprivate _popoverElement?: UUIPopoverContainerElement;\r\n\r\n\t@state()\r\n\tprivate _languages: Array<UmbLanguageDetailModel> = [];\r\n\r\n\t@state()\r\n\tprivate _appLanguage?: UmbLanguageDetailModel;\r\n\r\n\t@state()\r\n\tprivate _appLanguageIsReadOnly = false;\r\n\r\n\t@state()\r\n\tprivate _isOpen = false;\r\n\r\n\t@state()\r\n\tprivate _disallowedLanguages: Array<UmbLanguageDetailModel> = [];\r\n\r\n\t#collectionRepository = new UmbLanguageCollectionRepository(this);\r\n\t#appLanguageContext?: UmbAppLanguageContext;\r\n\t#languagesObserver?: any;\r\n\r\n\t// TODO: Here we have some read only state logic and then we have it again in the context. We should align this otherwise it will become a nightmare to maintain. [NL]\r\n\t#currentUserAllowedLanguages?: Array<string>;\r\n\t#currentUserHasAccessToAllLanguages?: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_APP_LANGUAGE_CONTEXT, (instance) => {\r\n\t\t\tthis.#appLanguageContext = instance;\r\n\t\t\tthis.#observeAppLanguage();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_CURRENT_USER_CONTEXT, (context) => {\r\n\t\t\tthis.observe(context?.languages, (languages) => {\r\n\t\t\t\tthis.#currentUserAllowedLanguages = languages;\r\n\t\t\t\tthis.#checkForLanguageAccess();\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(context?.hasAccessToAllLanguages, (hasAccessToAllLanguages) => {\r\n\t\t\t\tthis.#currentUserHasAccessToAllLanguages = hasAccessToAllLanguages;\r\n\t\t\t\tthis.#checkForLanguageAccess();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#checkForLanguageAccess() {\r\n\t\t// find all disallowed languages\r\n\t\tthis._disallowedLanguages = this._languages?.filter((language) => {\r\n\t\t\tif (this.#currentUserHasAccessToAllLanguages) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn !this.#currentUserAllowedLanguages?.includes(language.unique);\r\n\t\t});\r\n\t}\r\n\r\n\tasync #observeAppLanguage() {\r\n\t\tif (!this.#appLanguageContext) return;\r\n\r\n\t\tthis.observe(this.#appLanguageContext.appLanguage, (language) => {\r\n\t\t\tthis._appLanguage = language;\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#appLanguageContext.appLanguageReadOnlyState.isReadOnly, (isReadOnly) => {\r\n\t\t\tthis._appLanguageIsReadOnly = isReadOnly;\r\n\t\t});\r\n\t}\r\n\r\n\tasync #observeLanguages() {\r\n\t\tconst { data } = await this.#collectionRepository.requestCollection({});\r\n\r\n\t\t// TODO: listen to changes\r\n\t\tif (data) {\r\n\t\t\tthis._languages = data.items;\r\n\t\t\tthis.#checkForLanguageAccess();\r\n\t\t}\r\n\t}\r\n\r\n\t#onBeforePopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just neede for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tif (event.newState === 'open' && !this.#languagesObserver) {\r\n\t\t\tif (this._popoverElement) {\r\n\t\t\t\tconst host = this.getBoundingClientRect();\r\n\t\t\t\tthis._popoverElement.style.width = `${host.width}px`;\r\n\t\t\t}\r\n\r\n\t\t\tthis.#observeLanguages();\r\n\t\t}\r\n\t}\r\n\r\n\t#onPopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just neede for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._isOpen = event.newState === 'open';\r\n\t}\r\n\r\n\t#onTriggerClick() {\r\n\t\tif (this._isOpen) {\r\n\t\t\tthis._popoverElement?.hidePopover();\r\n\t\t} else {\r\n\t\t\tthis._popoverElement?.showPopover();\r\n\t\t}\r\n\t\tthis.requestUpdate();\r\n\t}\r\n\r\n\t#onTriggerKeydown = (e: KeyboardEvent) => {\r\n\t\tif (e.key === 'ArrowDown' || e.key === 'ArrowUp') {\r\n\t\t\tthis._popoverElement?.showPopover();\r\n\t\t}\r\n\t\tif (e.key === ' ') {\r\n\t\t\tthis._popoverElement?.togglePopover();\r\n\t\t}\r\n\t};\r\n\r\n\t#chooseLanguage(unique: string) {\r\n\t\tthis.#appLanguageContext?.setLanguage(unique);\r\n\t\tthis._popoverElement?.hidePopover();\r\n\t}\r\n\r\n\t#onLanguageSelectionChange(event: UUIComboboxListEvent) {\r\n\t\tif (!this._isOpen) return;\r\n\r\n\t\tconst target = event.target as UUIComboboxListElement;\r\n\t\tconst value = target?.value as string;\r\n\t\tif (value) {\r\n\t\t\tthis.#chooseLanguage(value);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderTrigger()} ${this.#renderContent()}`;\r\n\t}\r\n\r\n\t#renderTrigger() {\r\n\t\treturn html` <div\r\n\t\t\tid=\"toggle\"\r\n\t\t\tdata-mark=\"action:open\"\r\n\t\t\tpopovertarget=\"dropdown-popover\"\r\n\t\t\ttabindex=\"0\"\r\n\t\t\t@click=${this.#onTriggerClick}\r\n\t\t\t@keydown=${this.#onTriggerKeydown}>\r\n\t\t\t<span>\r\n\t\t\t\t${this._appLanguage?.name}\r\n\t\t\t\t${this._appLanguageIsReadOnly ? this.#renderReadOnlyTag(this._appLanguage?.unique) : nothing}\r\n\t\t\t</span>\r\n\t\t\t<uui-symbol-expand .open=${this._isOpen}></uui-symbol-expand>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\t#renderContent() {\r\n\t\treturn html` <uui-popover-container\r\n\t\t\tid=\"dropdown-popover\"\r\n\t\t\tdata-mark=\"app-language-menu\"\r\n\t\t\t@beforetoggle=${this.#onBeforePopoverToggle}\r\n\t\t\t@toggle=${this.#onPopoverToggle}>\r\n\t\t\t<umb-popover-layout>\r\n\t\t\t\t<uui-scroll-container style=\"max-height:calc(100vh - (var(--umb-header-layout-height) + 60px));\">\r\n\t\t\t\t\t${this.#renderOptions()}\r\n\t\t\t\t</uui-scroll-container>\r\n\t\t\t</umb-popover-layout>\r\n\t\t</uui-popover-container>`;\r\n\t}\r\n\r\n\t#renderOptions() {\r\n\t\tif (!this._isOpen) return nothing;\r\n\r\n\t\treturn html`<uui-combobox-list\r\n\t\t\taria-label=\"App language\"\r\n\t\t\t.for=${this}\r\n\t\t\t.value=${this._appLanguage?.unique || ''}\r\n\t\t\t@change=${this.#onLanguageSelectionChange}>\r\n\t\t\t${repeat(\r\n\t\t\t\tthis._languages,\r\n\t\t\t\t(language) => language.unique,\r\n\t\t\t\t(language) => html`\r\n\t\t\t\t\t<uui-combobox-list-option tabindex=\"0\" value=${language.unique}>\r\n\t\t\t\t\t\t${language.name}\r\n\t\t\t\t\t\t${this.#isLanguageReadOnly(language.unique) ? this.#renderReadOnlyTag(language.unique) : nothing}\r\n\t\t\t\t\t</uui-combobox-list-option>\r\n\t\t\t\t`,\r\n\t\t\t)}\r\n\t\t</uui-combobox-list>`;\r\n\t}\r\n\r\n\t#isLanguageReadOnly(culture?: string) {\r\n\t\tif (!culture) return false;\r\n\t\treturn this._disallowedLanguages.find((language) => language.unique === culture) ? true : false;\r\n\t}\r\n\r\n\t#renderReadOnlyTag(culture?: string) {\r\n\t\tif (!culture) return nothing;\r\n\t\treturn html`<uui-tag slot=\"badge\" look=\"secondary\">${this.localize.term('general_readOnly')}</uui-tag>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tz-index: 10;\r\n\t\t\t}\r\n\r\n\t\t\t#toggle {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\tbackground: none;\r\n\t\t\t\tborder: none;\r\n\t\t\t\theight: var(--umb-header-layout-height);\r\n\t\t\t\tpadding: 0 var(--uui-size-8);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tfont-family: inherit;\r\n\t\t\t}\r\n\r\n\t\t\t#toggle:hover {\r\n\t\t\t\tbackground-color: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\tuui-menu-item {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\r\n\t\t\t\twidth: auto;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbAppLanguageSelectElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-app-language-select': UmbAppLanguageSelectElement;\r\n\t}\r\n}\r\n"],"names":["_collectionRepository","_appLanguageContext","_languagesObserver","_currentUserAllowedLanguages","_currentUserHasAccessToAllLanguages","_UmbAppLanguageSelectElement_instances","checkForLanguageAccess_fn","observeAppLanguage_fn","observeLanguages_fn","onBeforePopoverToggle_fn","onPopoverToggle_fn","onTriggerClick_fn","_onTriggerKeydown","chooseLanguage_fn","onLanguageSelectionChange_fn","renderTrigger_fn","renderContent_fn","renderOptions_fn","isLanguageReadOnly_fn","renderReadOnlyTag_fn","UmbAppLanguageSelectElement","UmbLitElement","__privateAdd","UmbLanguageCollectionRepository","UMB_APP_LANGUAGE_CONTEXT","instance","__privateSet","__privateMethod","UMB_CURRENT_USER_CONTEXT","context","languages","hasAccessToAllLanguages","html","language","__privateGet","isReadOnly","data","event","host","unique","value","nothing","repeat","culture","css","__decorateClass","query","state","customElement","UmbAppLanguageSelectElement$1"],"mappings":"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"}