{"version":3,"file":"logviewer-workspace.context-B0AVbsWh.js","sources":["../../../src/packages/log-viewer/workspace/logviewer-workspace.context.ts"],"sourcesContent":["import { UmbLogViewerRepository } from '../repository/log-viewer.repository.js';\r\nimport { UMB_APP_LOG_VIEWER_CONTEXT } from './logviewer-workspace.context-token.js';\r\nimport { UmbBasicState, UmbArrayState, UmbObjectState, UmbStringState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type {\r\n\tLogLevelCountsReponseModel,\r\n\tPagedLoggerResponseModel,\r\n\tPagedLogMessageResponseModel,\r\n\tPagedLogTemplateResponseModel,\r\n\tPagedSavedLogSearchResponseModel,\r\n\tSavedLogSearchResponseModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { DirectionModel, LogLevelModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { query } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport { UMB_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbViewContext } from '@umbraco-cms/backoffice/view';\r\n\r\nexport type UmbPoolingInterval = 0 | 2000 | 5000 | 10000 | 20000 | 30000;\r\nexport interface UmbPoolingConfig {\r\n\tenabled: boolean;\r\n\tinterval: UmbPoolingInterval;\r\n}\r\nexport interface UmbLogViewerDateRange {\r\n\tstartDate: string;\r\n\tendDate: string;\r\n}\r\n\r\n// TODO: Revisit usage of workspace for this case...\r\nexport class UmbLogViewerWorkspaceContext extends UmbContextBase implements UmbWorkspaceContext {\r\n\tpublic readonly workspaceAlias: string = 'Umb.Workspace.LogViewer';\r\n\t#repository: UmbLogViewerRepository;\r\n\r\n\tpublic readonly view = new UmbViewContext(this, null);\r\n\r\n\tgetEntityType() {\r\n\t\treturn 'log-viewer';\r\n\t}\r\n\r\n\tgetEntityName() {\r\n\t\treturn 'Log Viewer';\r\n\t}\r\n\r\n\tget today() {\r\n\t\tconst today = new Date();\r\n\t\tconst dd = String(today.getDate()).padStart(2, '0');\r\n\t\tconst mm = String(today.getMonth() + 1).padStart(2, '0');\r\n\t\tconst yyyy = today.getFullYear();\r\n\r\n\t\treturn yyyy + '-' + mm + '-' + dd;\r\n\t}\r\n\r\n\tget yesterday() {\r\n\t\tconst yesterday = new Date(new Date().setDate(new Date().getDate() - 1));\r\n\t\tconst dd = String(yesterday.getDate()).padStart(2, '0');\r\n\t\tconst mm = String(yesterday.getMonth() + 1).padStart(2, '0');\r\n\t\tconst yyyy = yesterday.getFullYear();\r\n\r\n\t\treturn yyyy + '-' + mm + '-' + dd;\r\n\t}\r\n\r\n\tdefaultDateRange: UmbLogViewerDateRange = {\r\n\t\tstartDate: this.yesterday,\r\n\t\tendDate: this.today,\r\n\t};\r\n\r\n\t#savedSearches = new UmbObjectState<PagedSavedLogSearchResponseModel | undefined>(undefined);\r\n\tsavedSearches = this.#savedSearches.asObservablePart((data) => data);\r\n\r\n\t#logCount = new UmbObjectState<LogLevelCountsReponseModel | null>(null);\r\n\tlogCount = this.#logCount.asObservable();\r\n\r\n\t#dateRange = new UmbObjectState<UmbLogViewerDateRange>(this.defaultDateRange);\r\n\tdateRange = this.#dateRange.asObservable();\r\n\r\n\t#loggers = new UmbObjectState<PagedLoggerResponseModel | null>(null);\r\n\tloggers = this.#loggers.asObservablePart((data) => data?.items);\r\n\r\n\t#canShowLogs = new UmbBasicState<boolean | null>(null);\r\n\tcanShowLogs = this.#canShowLogs.asObservable();\r\n\r\n\t#isLoadingLogs = new UmbBasicState<boolean | null>(null);\r\n\tisLoadingLogs = this.#isLoadingLogs.asObservable();\r\n\r\n\t#filterExpression = new UmbStringState<string>('');\r\n\tfilterExpression = this.#filterExpression.asObservable();\r\n\r\n\t#messageTemplates = new UmbObjectState<PagedLogTemplateResponseModel | null>(null);\r\n\tmessageTemplates = this.#messageTemplates.asObservable();\r\n\r\n\t#logLevelsFilter = new UmbArrayState<LogLevelModel>([], (x) => x);\r\n\tlogLevelsFilter = this.#logLevelsFilter.asObservable();\r\n\r\n\t#logs = new UmbObjectState<PagedLogMessageResponseModel | null>(null);\r\n\tlogs = this.#logs.asObservablePart((data) => data?.items);\r\n\tlogsTotal = this.#logs.asObservablePart((data) => data?.total);\r\n\r\n\t#polling = new UmbObjectState<UmbPoolingConfig>({ enabled: false, interval: 2000 });\r\n\tpolling = this.#polling.asObservable();\r\n\r\n\t#sortingDirection = new UmbBasicState<DirectionModel>(DirectionModel.DESCENDING);\r\n\tsortingDirection = this.#sortingDirection.asObservable();\r\n\r\n\t#intervalID: number | null = null;\r\n\r\n\tcurrentPage = 1;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_APP_LOG_VIEWER_CONTEXT);\r\n\t\t// TODO: Revisit usage of workspace for this case... currently no other workspace context provides them self with their own token, we need to update UMB_APP_LOG_VIEWER_CONTEXT to become a workspace context. [NL]\r\n\t\tthis.provideContext(UMB_WORKSPACE_CONTEXT, this);\r\n\t\tthis.#repository = new UmbLogViewerRepository(host);\r\n\r\n\t\tthis.view.setTitle('#treeHeaders_logViewer');\r\n\t}\r\n\r\n\toverride hostConnected() {\r\n\t\tsuper.hostConnected();\r\n\t\twindow.addEventListener('changestate', this.onChangeState);\r\n\t\tthis.onChangeState();\r\n\t}\r\n\r\n\toverride hostDisconnected(): void {\r\n\t\tsuper.hostDisconnected();\r\n\t\twindow.removeEventListener('changestate', this.onChangeState);\r\n\t\tthis.stopPolling();\r\n\t}\r\n\r\n\tonChangeState = () => {\r\n\t\tconst searchQuery = query();\r\n\t\tthis.setFilterExpression(searchQuery.lq ?? '');\r\n\r\n\t\tlet validLogLevels: LogLevelModel[] = [];\r\n\t\tif (searchQuery.loglevels) {\r\n\t\t\tconst loglevels = searchQuery.loglevels.split(',') as LogLevelModel[];\r\n\r\n\t\t\t// Filter out invalid log levels that do not exist in LogLevelModel\r\n\t\t\tvalidLogLevels = loglevels.filter((loglevel) => {\r\n\t\t\t\treturn Object.values(LogLevelModel).includes(loglevel);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.setLogLevelsFilter(validLogLevels);\r\n\r\n\t\tconst dateRange: UmbLogViewerDateRange = this.getDateRange() as UmbLogViewerDateRange;\r\n\r\n\t\tthis.setDateRange({\r\n\t\t\tstartDate: searchQuery.startDate || dateRange.startDate,\r\n\t\t\tendDate: searchQuery.endDate || dateRange.endDate,\r\n\t\t});\r\n\r\n\t\tthis.setCurrentPage(searchQuery.page ? Number(searchQuery.page) : 1);\r\n\r\n\t\tthis.getLogs();\r\n\t};\r\n\r\n\tsetDateRange(dateRange: Partial<UmbLogViewerDateRange>) {\r\n\t\tlet { startDate, endDate } = dateRange;\r\n\r\n\t\tif (!startDate) startDate = this.defaultDateRange.startDate;\r\n\t\tif (!endDate) endDate = this.defaultDateRange.endDate;\r\n\r\n\t\tconst isAnyDateInTheFuture = new Date(startDate) > new Date() || new Date(endDate) > new Date();\r\n\t\tconst isStartDateBiggerThenEndDate = new Date(startDate) > new Date(endDate);\r\n\t\tif (isAnyDateInTheFuture || isStartDateBiggerThenEndDate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#dateRange.setValue({ startDate, endDate });\r\n\t\tthis.validateLogSize();\r\n\t\tthis.getLogCount();\r\n\t\tthis.getMessageTemplates(0, 10);\r\n\t}\r\n\r\n\tgetDateRange() {\r\n\t\treturn this.#dateRange.getValue();\r\n\t}\r\n\r\n\tasync getSavedSearches({ skip = 0, take = 999 }: { skip?: number; take?: number } = {}) {\r\n\t\tconst { data } = await this.#repository.getSavedSearches({ skip, take });\r\n\t\tif (data) {\r\n\t\t\tthis.#savedSearches.setValue(data);\r\n\t\t} else {\r\n\t\t\t//fallback to some default searches resembling Umbraco <= 13\r\n\t\t\tthis.#savedSearches.setValue({\r\n\t\t\t\titems: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'Find all logs where the Level is NOT Verbose and NOT Debug',\r\n\t\t\t\t\t\tquery: \"Not(@Level='Verbose') and Not(@Level='Debug')\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'Find all logs that has an exception property (Warning, Error & Fatal with Exceptions)',\r\n\t\t\t\t\t\tquery: 'Has(@Exception)',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Find all logs that have the property 'Duration'\",\r\n\t\t\t\t\t\tquery: 'Has(Duration)',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Find all logs that have the property 'Duration' and the duration is greater than 1000ms\",\r\n\t\t\t\t\t\tquery: 'Has(Duration) and Duration > 1000',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Find all logs that are from the namespace 'Umbraco.Core'\",\r\n\t\t\t\t\t\tquery: \"StartsWith(SourceContext, 'Umbraco.Core')\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'Find all logs that use a specific log message template',\r\n\t\t\t\t\t\tquery: \"@MessageTemplate = '[Timing {TimingId}] {EndMessage} ({TimingDuration}ms)'\",\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\ttotal: 6,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync saveSearch({ name, query }: SavedLogSearchResponseModel) {\r\n\t\tconst previousSavedSearches = this.#savedSearches.getValue()?.items ?? [];\r\n\t\ttry {\r\n\t\t\tthis.#savedSearches.update({ items: [...previousSavedSearches, { name, query }] });\r\n\t\t\tawait this.#repository.saveSearch({ name, query });\r\n\t\t} catch {\r\n\t\t\tthis.#savedSearches.update({ items: previousSavedSearches });\r\n\t\t}\r\n\t}\r\n\r\n\tasync removeSearch({ name }: { name: string }) {\r\n\t\tconst previousSavedSearches = this.#savedSearches.getValue()?.items ?? [];\r\n\t\ttry {\r\n\t\t\tthis.#savedSearches.update({ items: previousSavedSearches.filter((search) => search.name !== name) });\r\n\t\t\tawait this.#repository.removeSearch({ name });\r\n\t\t} catch {\r\n\t\t\tthis.#savedSearches.update({ items: previousSavedSearches });\r\n\t\t}\r\n\t}\r\n\r\n\tasync getLogCount() {\r\n\t\tconst { data } = await this.#repository.getLogCount({ ...this.#dateRange.getValue() });\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#logCount.setValue(data);\r\n\t\t}\r\n\t}\r\n\r\n\tasync getMessageTemplates(skip: number, take: number) {\r\n\t\tconst { data } = await this.#repository.getMessageTemplates({ skip, take, ...this.#dateRange.getValue() });\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#messageTemplates.setValue(data);\r\n\t\t}\r\n\t}\r\n\r\n\tasync getLogLevels(skip: number, take: number) {\r\n\t\tconst { data } = await this.#repository.getLogLevels({ skip, take });\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#loggers.setValue(data);\r\n\t\t}\r\n\t}\r\n\r\n\tasync validateLogSize() {\r\n\t\tconst { error } = await this.#repository.getLogViewerValidateLogsSize({ ...this.#dateRange.getValue() });\r\n\t\tif (error) {\r\n\t\t\tthis.#canShowLogs.setValue(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.#canShowLogs.setValue(true);\r\n\t}\r\n\r\n\tsetCurrentPage(page: number) {\r\n\t\tthis.currentPage = page;\r\n\t}\r\n\r\n\tgetLogs = async () => {\r\n\t\tif (this.#canShowLogs.getValue() === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst isPollingEnabled = this.#polling.getValue().enabled;\r\n\r\n\t\tif (!isPollingEnabled) this.#isLoadingLogs.setValue(true);\r\n\r\n\t\tconst skip = (this.currentPage - 1) * 100;\r\n\t\tconst take = 100;\r\n\r\n\t\tconst options = {\r\n\t\t\tskip,\r\n\t\t\ttake,\r\n\t\t\torderDirection: this.#sortingDirection.getValue(),\r\n\t\t\tfilterExpression: this.#filterExpression.getValue(),\r\n\t\t\tlogLevel: this.#logLevelsFilter.getValue(),\r\n\t\t\t...this.#dateRange.getValue(),\r\n\t\t};\r\n\r\n\t\tconst { data } = await this.#repository.getLogs(options);\r\n\t\tthis.#isLoadingLogs.setValue(false);\r\n\t\tif (data) {\r\n\t\t\tthis.#logs.setValue(data);\r\n\t\t}\r\n\t};\r\n\r\n\tsetFilterExpression(query: string) {\r\n\t\tthis.#filterExpression.setValue(query);\r\n\t}\r\n\r\n\tsetLogLevelsFilter(logLevels: LogLevelModel[]) {\r\n\t\tthis.#logLevelsFilter.setValue(logLevels);\r\n\t}\r\n\r\n\ttogglePolling() {\r\n\t\tconst isEnabled = !this.#polling.getValue().enabled;\r\n\t\tthis.#polling.update({\r\n\t\t\tenabled: isEnabled,\r\n\t\t});\r\n\r\n\t\tif (isEnabled) {\r\n\t\t\tthis.#intervalID = setInterval(() => {\r\n\t\t\t\tthis.currentPage = 1;\r\n\t\t\t\tthis.getLogs();\r\n\t\t\t}, this.#polling.getValue().interval) as unknown as number;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.stopPolling();\r\n\t}\r\n\r\n\tsetPollingInterval(interval: UmbPoolingInterval) {\r\n\t\tthis.#polling.update({ interval });\r\n\t}\r\n\r\n\ttoggleSortOrder() {\r\n\t\tconst direction = this.#sortingDirection.getValue();\r\n\t\tconst newDirection = direction === DirectionModel.ASCENDING ? DirectionModel.DESCENDING : DirectionModel.ASCENDING;\r\n\t\tthis.#sortingDirection.setValue(newDirection);\r\n\t}\r\n\r\n\tstopPolling() {\r\n\t\tif (this.#intervalID) {\r\n\t\t\tclearInterval(this.#intervalID);\r\n\t\t\tthis.#intervalID = null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport { UmbLogViewerWorkspaceContext as api };\r\n"],"names":["UmbLogViewerWorkspaceContext","UmbContextBase","host","UMB_APP_LOG_VIEWER_CONTEXT","UmbViewContext","#savedSearches","UmbObjectState","data","#logCount","#dateRange","#loggers","#canShowLogs","UmbBasicState","#isLoadingLogs","#filterExpression","UmbStringState","#messageTemplates","#logLevelsFilter","UmbArrayState","x","#logs","#polling","#sortingDirection","DirectionModel","#intervalID","searchQuery","query","validLogLevels","loglevel","LogLevelModel","dateRange","options","#repository","UMB_WORKSPACE_CONTEXT","UmbLogViewerRepository","today","dd","mm","yesterday","startDate","endDate","isAnyDateInTheFuture","isStartDateBiggerThenEndDate","skip","take","name","previousSavedSearches","search","error","page","logLevels","isEnabled","interval","newDirection"],"mappings":";;;;;;;;AA8BO,MAAMA,UAAqCC,EAA8C;AAAA,EA8E/F,YAAYC,GAAyB;AACpC,UAAMA,GAAMC,CAA0B,GA9EvC,KAAgB,iBAAyB,2BAGzC,KAAgB,OAAO,IAAIC,EAAe,MAAM,IAAI,GA4BpD,KAAA,mBAA0C;AAAA,MACzC,WAAW,KAAK;AAAA,MAChB,SAAS,KAAK;AAAA,IAAA,GAGf,KAAAC,KAAiB,IAAIC,EAA6D,MAAS,GAC3F,KAAA,gBAAgB,KAAKD,GAAe,iBAAiB,CAACE,MAASA,CAAI,GAEnE,KAAAC,KAAY,IAAIF,EAAkD,IAAI,GACtE,KAAA,WAAW,KAAKE,GAAU,aAAA,GAE1B,KAAAC,KAAa,IAAIH,EAAsC,KAAK,gBAAgB,GAC5E,KAAA,YAAY,KAAKG,GAAW,aAAA,GAE5B,KAAAC,KAAW,IAAIJ,EAAgD,IAAI,GACnE,KAAA,UAAU,KAAKI,GAAS,iBAAiB,CAACH,MAASA,GAAM,KAAK,GAE9D,KAAAI,KAAe,IAAIC,EAA8B,IAAI,GACrD,KAAA,cAAc,KAAKD,GAAa,aAAA,GAEhC,KAAAE,KAAiB,IAAID,EAA8B,IAAI,GACvD,KAAA,gBAAgB,KAAKC,GAAe,aAAA,GAEpC,KAAAC,KAAoB,IAAIC,EAAuB,EAAE,GACjD,KAAA,mBAAmB,KAAKD,GAAkB,aAAA,GAE1C,KAAAE,KAAoB,IAAIV,EAAqD,IAAI,GACjF,KAAA,mBAAmB,KAAKU,GAAkB,aAAA,GAE1C,KAAAC,KAAmB,IAAIC,EAA6B,CAAA,GAAI,CAACC,MAAMA,CAAC,GAChE,KAAA,kBAAkB,KAAKF,GAAiB,aAAA,GAExC,KAAAG,KAAQ,IAAId,EAAoD,IAAI,GACpE,KAAA,OAAO,KAAKc,GAAM,iBAAiB,CAACb,MAASA,GAAM,KAAK,GACxD,KAAA,YAAY,KAAKa,GAAM,iBAAiB,CAACb,MAASA,GAAM,KAAK,GAE7D,KAAAc,KAAW,IAAIf,EAAiC,EAAE,SAAS,IAAO,UAAU,KAAM,GAClF,KAAA,UAAU,KAAKe,GAAS,aAAA,GAExB,KAAAC,KAAoB,IAAIV,EAA8BW,EAAe,UAAU,GAC/E,KAAA,mBAAmB,KAAKD,GAAkB,aAAA,GAE1C,KAAAE,KAA6B,MAE7B,KAAA,cAAc,GAuBd,KAAA,gBAAgB,MAAM;AACrB,YAAMC,IAAcC,EAAA;AACpB,WAAK,oBAAoBD,EAAY,MAAM,EAAE;AAE7C,UAAIE,IAAkC,CAAA;AACtC,MAAIF,EAAY,cAIfE,IAHkBF,EAAY,UAAU,MAAM,GAAG,EAGtB,OAAO,CAACG,MAC3B,OAAO,OAAOC,CAAa,EAAE,SAASD,CAAQ,CACrD,IAEF,KAAK,mBAAmBD,CAAc;AAEtC,YAAMG,IAAmC,KAAK,aAAA;AAE9C,WAAK,aAAa;AAAA,QACjB,WAAWL,EAAY,aAAaK,EAAU;AAAA,QAC9C,SAASL,EAAY,WAAWK,EAAU;AAAA,MAAA,CAC1C,GAED,KAAK,eAAeL,EAAY,OAAO,OAAOA,EAAY,IAAI,IAAI,CAAC,GAEnE,KAAK,QAAA;AAAA,IACN,GAuHA,KAAA,UAAU,YAAY;AACrB,UAAI,KAAKd,GAAa,SAAA,MAAe;AACpC;AAKD,MAFyB,KAAKU,GAAS,SAAA,EAAW,WAE3B,KAAKR,GAAe,SAAS,EAAI;AAKxD,YAAMkB,IAAU;AAAA,QACf,OAJa,KAAK,cAAc,KAAK;AAAA,QAKrC,MAJY;AAAA,QAKZ,gBAAgB,KAAKT,GAAkB,SAAA;AAAA,QACvC,kBAAkB,KAAKR,GAAkB,SAAA;AAAA,QACzC,UAAU,KAAKG,GAAiB,SAAA;AAAA,QAChC,GAAG,KAAKR,GAAW,SAAA;AAAA,MAAS,GAGvB,EAAE,MAAAF,EAAA,IAAS,MAAM,KAAKyB,GAAY,QAAQD,CAAO;AACvD,WAAKlB,GAAe,SAAS,EAAK,GAC9BN,KACH,KAAKa,GAAM,SAASb,CAAI;AAAA,IAE1B,GA5LC,KAAK,eAAe0B,GAAuB,IAAI,GAC/C,KAAKD,KAAc,IAAIE,EAAuBhC,CAAI,GAElD,KAAK,KAAK,SAAS,wBAAwB;AAAA,EAC5C;AAAA,EAnFA8B;AAAA,EAIA,gBAAgB;AACf,WAAO;AAAA,EACR;AAAA,EAEA,gBAAgB;AACf,WAAO;AAAA,EACR;AAAA,EAEA,IAAI,QAAQ;AACX,UAAMG,wBAAY,KAAA,GACZC,IAAK,OAAOD,EAAM,QAAA,CAAS,EAAE,SAAS,GAAG,GAAG,GAC5CE,IAAK,OAAOF,EAAM,SAAA,IAAa,CAAC,EAAE,SAAS,GAAG,GAAG;AAGvD,WAFaA,EAAM,YAAA,IAEL,MAAME,IAAK,MAAMD;AAAA,EAChC;AAAA,EAEA,IAAI,YAAY;AACf,UAAME,IAAY,IAAI,MAAK,oBAAI,KAAA,GAAO,SAAQ,oBAAI,KAAA,GAAO,QAAA,IAAY,CAAC,CAAC,GACjEF,IAAK,OAAOE,EAAU,QAAA,CAAS,EAAE,SAAS,GAAG,GAAG,GAChDD,IAAK,OAAOC,EAAU,SAAA,IAAa,CAAC,EAAE,SAAS,GAAG,GAAG;AAG3D,WAFaA,EAAU,YAAA,IAET,MAAMD,IAAK,MAAMD;AAAA,EAChC;AAAA,EAOA/B;AAAA,EAGAG;AAAA,EAGAC;AAAA,EAGAC;AAAA,EAGAC;AAAA,EAGAE;AAAA,EAGAC;AAAA,EAGAE;AAAA,EAGAC;AAAA,EAGAG;AAAA,EAIAC;AAAA,EAGAC;AAAA,EAGAE;AAAA,EAaS,gBAAgB;AACxB,UAAM,cAAA,GACN,OAAO,iBAAiB,eAAe,KAAK,aAAa,GACzD,KAAK,cAAA;AAAA,EACN;AAAA,EAES,mBAAyB;AACjC,UAAM,iBAAA,GACN,OAAO,oBAAoB,eAAe,KAAK,aAAa,GAC5D,KAAK,YAAA;AAAA,EACN;AAAA,EA6BA,aAAaM,GAA2C;AACvD,QAAI,EAAE,WAAAS,GAAW,SAAAC,EAAA,IAAYV;AAE7B,IAAKS,MAAWA,IAAY,KAAK,iBAAiB,YAC7CC,MAASA,IAAU,KAAK,iBAAiB;AAE9C,UAAMC,IAAuB,IAAI,KAAKF,CAAS,IAAI,oBAAI,KAAA,KAAU,IAAI,KAAKC,CAAO,wBAAQ,KAAA,GACnFE,IAA+B,IAAI,KAAKH,CAAS,IAAI,IAAI,KAAKC,CAAO;AAC3E,IAAIC,KAAwBC,MAI5B,KAAKjC,GAAW,SAAS,EAAE,WAAA8B,GAAW,SAAAC,GAAS,GAC/C,KAAK,gBAAA,GACL,KAAK,YAAA,GACL,KAAK,oBAAoB,GAAG,EAAE;AAAA,EAC/B;AAAA,EAEA,eAAe;AACd,WAAO,KAAK/B,GAAW,SAAA;AAAA,EACxB;AAAA,EAEA,MAAM,iBAAiB,EAAE,MAAAkC,IAAO,GAAG,MAAAC,IAAO,IAAA,IAA0C,IAAI;AACvF,UAAM,EAAE,MAAArC,EAAA,IAAS,MAAM,KAAKyB,GAAY,iBAAiB,EAAE,MAAAW,GAAM,MAAAC,GAAM;AACvE,IAAIrC,IACH,KAAKF,GAAe,SAASE,CAAI,IAGjC,KAAKF,GAAe,SAAS;AAAA,MAC5B,OAAO;AAAA,QACN;AAAA,UACC,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,QAER;AAAA,UACC,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,QAER;AAAA,UACC,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,QAER;AAAA,UACC,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,QAER;AAAA,UACC,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,QAER;AAAA,UACC,MAAM;AAAA,UACN,OAAO;AAAA,QAAA;AAAA,MACR;AAAA,MAED,OAAO;AAAA,IAAA,CACP;AAAA,EAEH;AAAA,EAEA,MAAM,WAAW,EAAE,MAAAwC,GAAM,OAAAnB,KAAsC;AAC9D,UAAMoB,IAAwB,KAAKzC,GAAe,SAAA,GAAY,SAAS,CAAA;AACvE,QAAI;AACH,WAAKA,GAAe,OAAO,EAAE,OAAO,CAAC,GAAGyC,GAAuB,EAAE,MAAAD,GAAM,OAAAnB,EAAAA,CAAO,GAAG,GACjF,MAAM,KAAKM,GAAY,WAAW,EAAE,MAAAa,GAAM,OAAAnB,GAAO;AAAA,IAClD,QAAQ;AACP,WAAKrB,GAAe,OAAO,EAAE,OAAOyC,GAAuB;AAAA,IAC5D;AAAA,EACD;AAAA,EAEA,MAAM,aAAa,EAAE,MAAAD,KAA0B;AAC9C,UAAMC,IAAwB,KAAKzC,GAAe,SAAA,GAAY,SAAS,CAAA;AACvE,QAAI;AACH,WAAKA,GAAe,OAAO,EAAE,OAAOyC,EAAsB,OAAO,CAACC,MAAWA,EAAO,SAASF,CAAI,EAAA,CAAG,GACpG,MAAM,KAAKb,GAAY,aAAa,EAAE,MAAAa,GAAM;AAAA,IAC7C,QAAQ;AACP,WAAKxC,GAAe,OAAO,EAAE,OAAOyC,GAAuB;AAAA,IAC5D;AAAA,EACD;AAAA,EAEA,MAAM,cAAc;AACnB,UAAM,EAAE,MAAAvC,EAAA,IAAS,MAAM,KAAKyB,GAAY,YAAY,EAAE,GAAG,KAAKvB,GAAW,SAAA,GAAY;AAErF,IAAIF,KACH,KAAKC,GAAU,SAASD,CAAI;AAAA,EAE9B;AAAA,EAEA,MAAM,oBAAoBoC,GAAcC,GAAc;AACrD,UAAM,EAAE,MAAArC,EAAA,IAAS,MAAM,KAAKyB,GAAY,oBAAoB,EAAE,MAAAW,GAAM,MAAAC,GAAM,GAAG,KAAKnC,GAAW,SAAA,GAAY;AAEzG,IAAIF,KACH,KAAKS,GAAkB,SAAST,CAAI;AAAA,EAEtC;AAAA,EAEA,MAAM,aAAaoC,GAAcC,GAAc;AAC9C,UAAM,EAAE,MAAArC,EAAA,IAAS,MAAM,KAAKyB,GAAY,aAAa,EAAE,MAAAW,GAAM,MAAAC,GAAM;AAEnE,IAAIrC,KACH,KAAKG,GAAS,SAASH,CAAI;AAAA,EAE7B;AAAA,EAEA,MAAM,kBAAkB;AACvB,UAAM,EAAE,OAAAyC,EAAA,IAAU,MAAM,KAAKhB,GAAY,6BAA6B,EAAE,GAAG,KAAKvB,GAAW,SAAA,GAAY;AACvG,QAAIuC,GAAO;AACV,WAAKrC,GAAa,SAAS,EAAK;AAChC;AAAA,IACD;AACA,SAAKA,GAAa,SAAS,EAAI;AAAA,EAChC;AAAA,EAEA,eAAesC,GAAc;AAC5B,SAAK,cAAcA;AAAA,EACpB;AAAA,EA8BA,oBAAoBvB,GAAe;AAClC,SAAKZ,GAAkB,SAASY,CAAK;AAAA,EACtC;AAAA,EAEA,mBAAmBwB,GAA4B;AAC9C,SAAKjC,GAAiB,SAASiC,CAAS;AAAA,EACzC;AAAA,EAEA,gBAAgB;AACf,UAAMC,IAAY,CAAC,KAAK9B,GAAS,WAAW;AAK5C,QAJA,KAAKA,GAAS,OAAO;AAAA,MACpB,SAAS8B;AAAA,IAAA,CACT,GAEGA,GAAW;AACd,WAAK3B,KAAc,YAAY,MAAM;AACpC,aAAK,cAAc,GACnB,KAAK,QAAA;AAAA,MACN,GAAG,KAAKH,GAAS,SAAA,EAAW,QAAQ;AACpC;AAAA,IACD;AAEA,SAAK,YAAA;AAAA,EACN;AAAA,EAEA,mBAAmB+B,GAA8B;AAChD,SAAK/B,GAAS,OAAO,EAAE,UAAA+B,EAAA,CAAU;AAAA,EAClC;AAAA,EAEA,kBAAkB;AAEjB,UAAMC,IADY,KAAK/B,GAAkB,SAAA,MACNC,EAAe,YAAYA,EAAe,aAAaA,EAAe;AACzG,SAAKD,GAAkB,SAAS+B,CAAY;AAAA,EAC7C;AAAA,EAEA,cAAc;AACb,IAAI,KAAK7B,OACR,cAAc,KAAKA,EAAW,GAC9B,KAAKA,KAAc;AAAA,EAErB;AACD;"}