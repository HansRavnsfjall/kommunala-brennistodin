{"version":3,"file":"create-media-collection-action.element-Y4fWR9zl.js","sources":["../../../src/packages/media/media/collection/action/create-media-collection-action.element.ts"],"sourcesContent":["import { UMB_MEDIA_COLLECTION_CONTEXT } from '../media-collection.context-token.js';\r\nimport { UMB_MEDIA_WORKSPACE_CONTEXT } from '../../constants.js';\r\nimport { UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN } from '../../paths.js';\r\nimport { UMB_MEDIA_ENTITY_TYPE, UMB_MEDIA_ROOT_ENTITY_TYPE } from '../../entity.js';\r\nimport { html, customElement, property, state, map } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbMediaTypeStructureRepository } from '@umbraco-cms/backoffice/media-type';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { ManifestCollectionAction } from '@umbraco-cms/backoffice/collection';\r\nimport type { UmbAllowedMediaTypeModel } from '@umbraco-cms/backoffice/media-type';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbModalRouteBuilder } from '@umbraco-cms/backoffice/router';\r\n\r\n@customElement('umb-create-media-collection-action')\r\nexport class UmbCreateMediaCollectionActionElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _allowedMediaTypes: Array<UmbAllowedMediaTypeModel> = [];\r\n\r\n\t@state()\r\n\tprivate _workspacePathBuilder?: UmbModalRouteBuilder;\r\n\r\n\t@state()\r\n\tprivate _mediaUnique?: UmbEntityUnique;\r\n\r\n\t@state()\r\n\tprivate _mediaTypeUnique?: string;\r\n\r\n\t@state()\r\n\tprivate _popoverOpen = false;\r\n\r\n\t@property({ attribute: false })\r\n\tmanifest?: ManifestCollectionAction;\r\n\r\n\t#mediaTypeStructureRepository = new UmbMediaTypeStructureRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MEDIA_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.observe(workspaceContext?.unique, (unique) => {\r\n\t\t\t\tthis._mediaUnique = unique;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(workspaceContext?.contentTypeUnique, (mediaTypeUnique) => {\r\n\t\t\t\tthis._mediaTypeUnique = mediaTypeUnique;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_MEDIA_COLLECTION_CONTEXT, (collectionContext) => {\r\n\t\t\tthis.observe(collectionContext?.workspacePathBuilder, (builder) => {\r\n\t\t\t\tthis._workspacePathBuilder = builder;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tthis.#retrieveAllowedMediaTypesOf(this._mediaTypeUnique ?? '', this._mediaUnique || null);\r\n\t}\r\n\r\n\tasync #retrieveAllowedMediaTypesOf(unique: string | null, parentContentUnique: string | null) {\r\n\t\tconst { data } = await this.#mediaTypeStructureRepository.requestAllowedChildrenOf(unique, parentContentUnique);\r\n\t\tif (data && data.items) {\r\n\t\t\tthis._allowedMediaTypes = data.items;\r\n\t\t}\r\n\t}\r\n\r\n\t#onPopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just neede for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._popoverOpen = event.newState === 'open';\r\n\t}\r\n\r\n\t#getCreateUrl(item: UmbAllowedMediaTypeModel) {\r\n\t\treturn item.unique && this._workspacePathBuilder\r\n\t\t\t? this._workspacePathBuilder({ entityType: UMB_MEDIA_ENTITY_TYPE }) +\r\n\t\t\t\t\tUMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN.generateLocal({\r\n\t\t\t\t\t\tparentEntityType: this._mediaUnique ? UMB_MEDIA_ENTITY_TYPE : UMB_MEDIA_ROOT_ENTITY_TYPE,\r\n\t\t\t\t\t\tparentUnique: this._mediaUnique ?? 'null',\r\n\t\t\t\t\t\tmediaTypeUnique: item.unique,\r\n\t\t\t\t\t})\r\n\t\t\t: '';\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._allowedMediaTypes.length !== 1 ? this.#renderDropdown() : this.#renderCreateButton();\r\n\t}\r\n\r\n\t#renderCreateButton() {\r\n\t\tif (this._allowedMediaTypes.length !== 1) return;\r\n\r\n\t\tconst item = this._allowedMediaTypes[0];\r\n\t\tconst label =\r\n\t\t\t(this.manifest?.meta.label\r\n\t\t\t\t? this.localize.string(this.manifest?.meta.label)\r\n\t\t\t\t: this.localize.term('general_create')) +\r\n\t\t\t' ' +\r\n\t\t\titem.name;\r\n\r\n\t\treturn html`<uui-button\r\n\t\t\tcolor=\"default\"\r\n\t\t\thref=${this.#getCreateUrl(item)}\r\n\t\t\tlabel=${label}\r\n\t\t\tlook=\"outline\"></uui-button>`;\r\n\t}\r\n\r\n\t#renderDropdown() {\r\n\t\tif (!this._allowedMediaTypes.length) return;\r\n\r\n\t\tconst label = this.manifest?.meta.label\r\n\t\t\t? this.localize.string(this.manifest?.meta.label)\r\n\t\t\t: this.localize.term('general_create');\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button popovertarget=\"collection-action-menu-popover\" label=${label} color=\"default\" look=\"outline\">\r\n\t\t\t\t${label}\r\n\t\t\t\t<uui-symbol-expand .open=${this._popoverOpen}></uui-symbol-expand>\r\n\t\t\t</uui-button>\r\n\t\t\t<uui-popover-container\r\n\t\t\t\tid=\"collection-action-menu-popover\"\r\n\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t@toggle=${this.#onPopoverToggle}>\r\n\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t<uui-scroll-container>\r\n\t\t\t\t\t\t${map(\r\n\t\t\t\t\t\t\tthis._allowedMediaTypes,\r\n\t\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t\t<uui-menu-item label=${item.name} href=${this.#getCreateUrl(item)}>\r\n\t\t\t\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${item.icon ?? 'icon-picture'}></umb-icon>\r\n\t\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</uui-scroll-container>\r\n\t\t\t\t</umb-popover-layout>\r\n\t\t\t</uui-popover-container>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport default UmbCreateMediaCollectionActionElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-create-media-collection-action': UmbCreateMediaCollectionActionElement;\r\n\t}\r\n}\r\n"],"names":["_mediaTypeStructureRepository","_UmbCreateMediaCollectionActionElement_instances","retrieveAllowedMediaTypesOf_fn","onPopoverToggle_fn","getCreateUrl_fn","renderCreateButton_fn","renderDropdown_fn","UmbCreateMediaCollectionActionElement","UmbLitElement","__privateAdd","UmbMediaTypeStructureRepository","UMB_MEDIA_WORKSPACE_CONTEXT","workspaceContext","unique","mediaTypeUnique","UMB_MEDIA_COLLECTION_CONTEXT","collectionContext","builder","__privateMethod","parentContentUnique","data","__privateGet","event","item","UMB_MEDIA_ENTITY_TYPE","UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN","UMB_MEDIA_ROOT_ENTITY_TYPE","label","html","map","__decorateClass","state","property","customElement","UmbCreateMediaCollectionActionElement$1"],"mappings":"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"}