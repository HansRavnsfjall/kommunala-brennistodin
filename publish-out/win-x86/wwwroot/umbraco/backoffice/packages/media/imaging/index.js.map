{"version":3,"file":"index.js","sources":["../../../../src/packages/media/imaging/components/imaging-thumbnail.element.ts","../../../../src/packages/media/imaging/components/media-image.element.ts"],"sourcesContent":["import { UmbImagingCropMode } from '../types.js';\r\nimport { UmbImagingRepository } from '../imaging.repository.js';\r\nimport { css, customElement, html, property, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport { UmbEntityUpdatedEvent } from '@umbraco-cms/backoffice/entity-action';\r\n\r\n@customElement('umb-imaging-thumbnail')\r\nexport class UmbImagingThumbnailElement extends UmbLitElement {\r\n\t/**\r\n\t * The unique identifier for the media item.\r\n\t * @description This is also known as the media key and is used to fetch the resource.\r\n\t */\r\n\t@property()\r\n\tunique = '';\r\n\r\n\t/**\r\n\t * The width of the thumbnail in pixels.\r\n\t * @default 300\r\n\t */\r\n\t@property({ type: Number })\r\n\twidth = 300;\r\n\r\n\t/**\r\n\t * The height of the thumbnail in pixels.\r\n\t * @default 300\r\n\t */\r\n\t@property({ type: Number })\r\n\theight = 300;\r\n\r\n\t/**\r\n\t * The mode of the thumbnail.\r\n\t * @description The mode determines how the image is cropped.\r\n\t * @enum {UmbImagingCropMode}\r\n\t */\r\n\t@property()\r\n\tmode: UmbImagingCropMode = UmbImagingCropMode.MIN;\r\n\r\n\t/**\r\n\t * The alt text for the thumbnail.\r\n\t */\r\n\t@property()\r\n\talt = '';\r\n\r\n\t/**\r\n\t * The fallback icon for the thumbnail.\r\n\t */\r\n\t@property()\r\n\ticon = 'icon-picture';\r\n\r\n\t/**\r\n\t * The `loading` state of the thumbnail.\r\n\t * @enum {'lazy' | 'eager'}\r\n\t * @default 'lazy'\r\n\t */\r\n\t@property()\r\n\tloading: (typeof HTMLImageElement)['prototype']['loading'] = 'lazy';\r\n\r\n\t@state()\r\n\tprivate _isLoading = true;\r\n\r\n\t@state()\r\n\tprivate _thumbnailUrl = '';\r\n\r\n\t#imagingRepository = new UmbImagingRepository(this);\r\n\r\n\t#intersectionObserver?: IntersectionObserver;\r\n\r\n\toverride render() {\r\n\t\treturn when(\r\n\t\t\tthis._isLoading,\r\n\t\t\t() => this.#renderLoading(),\r\n\t\t\t() => this.#renderThumbnail(),\r\n\t\t);\r\n\t}\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tif (this.loading === 'lazy') {\r\n\t\t\tthis.#intersectionObserver = new IntersectionObserver((entries) => {\r\n\t\t\t\tif (entries[0].isIntersecting) {\r\n\t\t\t\t\tthis.#generateThumbnailUrl();\r\n\t\t\t\t\tthis.#intersectionObserver?.disconnect();\r\n\t\t\t\t\tthis.#observeActionEvent();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.#intersectionObserver.observe(this);\r\n\t\t} else {\r\n\t\t\tthis.#generateThumbnailUrl();\r\n\t\t\tthis.#observeActionEvent();\r\n\t\t}\r\n\t}\r\n\r\n\toverride disconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tthis.#intersectionObserver?.disconnect();\r\n\t}\r\n\r\n\t/**\r\n\t * Observes the action events for the current media item.\r\n\t * Reloads the thumbnail when the media item is updated.\r\n\t * Note: Call this only when the media item is in view or otherwise is supposed to be loaded already.\r\n\t */\r\n\t#observeActionEvent() {\r\n\t\tthis.consumeContext(UMB_ACTION_EVENT_CONTEXT, (actionEventContext) => {\r\n\t\t\tactionEventContext?.addEventListener(UmbEntityUpdatedEvent.TYPE, (event) => {\r\n\t\t\t\tif (event instanceof UmbEntityUpdatedEvent && event.getUnique() === this.unique) {\r\n\t\t\t\t\tthis.#generateThumbnailUrl();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#renderLoading() {\r\n\t\treturn html`<div id=\"loader\"><uui-loader></uui-loader></div>`;\r\n\t}\r\n\r\n\t#renderThumbnail() {\r\n\t\treturn when(\r\n\t\t\tthis._thumbnailUrl,\r\n\t\t\t(url) => html`<img id=\"figure\" src=${url} alt=${this.alt} loading=${this.loading} draggable=\"false\" />`,\r\n\t\t\t() => html`<umb-icon id=\"icon\" name=${this.icon}></umb-icon>`,\r\n\t\t);\r\n\t}\r\n\r\n\tasync #generateThumbnailUrl() {\r\n\t\tif (!this.unique) return;\r\n\t\tthis._isLoading = true;\r\n\r\n\t\tconst { data } = await this.#imagingRepository.requestResizedItems([this.unique], {\r\n\t\t\theight: this.height,\r\n\t\t\twidth: this.width,\r\n\t\t\tmode: this.mode,\r\n\t\t});\r\n\r\n\t\tthis._thumbnailUrl = data?.[0]?.url ?? '';\r\n\t\tthis._isLoading = false;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#loader {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#figure {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tobject-fit: cover;\r\n\r\n\t\t\t\tbackground-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" fill-opacity=\".1\"><path d=\"M50 0h50v50H50zM0 50h50v50H0z\"/></svg>');\r\n\t\t\t\tbackground-size: 10px 10px;\r\n\t\t\t\tbackground-repeat: repeat;\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tfont-size: var(--uui-size-8);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-imaging-thumbnail': UmbImagingThumbnailElement;\r\n\t}\r\n}\r\n","import { UmbMediaUrlRepository } from '../../media/url/index.js';\r\nimport { css, customElement, html, nothing, property, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n@customElement('umb-media-image')\r\nexport class UmbMediaImageElement extends UmbLitElement {\r\n\t/**\r\n\t * The unique identifier for the media item.\r\n\t * @description This is also known as the media key and is used to fetch the resource.\r\n\t */\r\n\t@property()\r\n\tunique?: string;\r\n\r\n\t/**\r\n\t * The alt text for the thumbnail.\r\n\t */\r\n\t@property()\r\n\talt?: string;\r\n\r\n\t/**\r\n\t * The fallback icon for the thumbnail.\r\n\t */\r\n\t@property()\r\n\ticon = 'icon-picture';\r\n\r\n\t/**\r\n\t * The `loading` state of the thumbnail.\r\n\t * @enum {'lazy' | 'eager'}\r\n\t * @default 'lazy'\r\n\t */\r\n\t@property()\r\n\tloading: (typeof HTMLImageElement)['prototype']['loading'] = 'lazy';\r\n\r\n\t@state()\r\n\tprivate _isLoading = true;\r\n\r\n\t@state()\r\n\tprivate _imageUrl = '';\r\n\r\n\t#mediaRepository = new UmbMediaUrlRepository(this);\r\n\r\n\t#intersectionObserver?: IntersectionObserver;\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tif (this.loading === 'lazy') {\r\n\t\t\tthis.#intersectionObserver = new IntersectionObserver((entries) => {\r\n\t\t\t\tif (entries[0].isIntersecting) {\r\n\t\t\t\t\tthis.#generateThumbnailUrl();\r\n\t\t\t\t\tthis.#intersectionObserver?.disconnect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.#intersectionObserver.observe(this);\r\n\t\t} else {\r\n\t\t\tthis.#generateThumbnailUrl();\r\n\t\t}\r\n\t}\r\n\r\n\toverride disconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tthis.#intersectionObserver?.disconnect();\r\n\t}\r\n\r\n\tasync #generateThumbnailUrl() {\r\n\t\tif (!this.unique) throw new Error('Unique is missing');\r\n\t\tconst { data } = await this.#mediaRepository.requestItems([this.unique]);\r\n\r\n\t\tthis._imageUrl = data?.[0]?.url ?? '';\r\n\t\tthis._isLoading = false;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html` ${this.#renderThumbnail()} ${when(this._isLoading, () => this.#renderLoading())} `;\r\n\t}\r\n\r\n\t#renderLoading() {\r\n\t\treturn html`<div id=\"loader\"><uui-loader></uui-loader></div>`;\r\n\t}\r\n\r\n\t#renderThumbnail() {\r\n\t\tif (this._isLoading) return nothing;\r\n\r\n\t\treturn when(\r\n\t\t\tthis._imageUrl,\r\n\t\t\t() =>\r\n\t\t\t\thtml`<img\r\n\t\t\t\t\tpart=\"img\"\r\n\t\t\t\t\tsrc=\"${this._imageUrl}\"\r\n\t\t\t\t\talt=\"${this.alt ?? ''}\"\r\n\t\t\t\t\tloading=\"${this.loading}\"\r\n\t\t\t\t\tdraggable=\"false\" />`,\r\n\t\t\t() => html`<umb-icon id=\"icon\" name=\"${this.icon}\"></umb-icon>`,\r\n\t\t);\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: contents;\r\n\t\t\t}\r\n\r\n\t\t\t#loader {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tfont-size: var(--uui-size-8);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-image': UmbMediaImageElement;\r\n\t}\r\n}\r\n"],"names":["_imagingRepository","_intersectionObserver","_UmbImagingThumbnailElement_instances","observeActionEvent_fn","renderLoading_fn","renderThumbnail_fn","generateThumbnailUrl_fn","UmbImagingThumbnailElement","UmbLitElement","__privateAdd","UmbImagingCropMode","UmbImagingRepository","when","__privateMethod","__privateSet","entries","__privateGet","UMB_ACTION_EVENT_CONTEXT","actionEventContext","UmbEntityUpdatedEvent","event","html","url","data","UmbTextStyles","css","__decorateClass","property","state","customElement","_mediaRepository","_UmbMediaImageElement_instances","UmbMediaImageElement","UmbMediaUrlRepository","nothing"],"mappings":"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"}