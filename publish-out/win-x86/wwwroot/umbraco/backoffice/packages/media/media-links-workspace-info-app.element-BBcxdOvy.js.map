{"version":3,"file":"media-links-workspace-info-app.element-BBcxdOvy.js","sources":["../../../src/packages/media/media/url/info-app/media-links-workspace-info-app.element.ts"],"sourcesContent":["import { UmbMediaUrlRepository } from '../repository/index.js';\r\nimport { UMB_MEDIA_WORKSPACE_CONTEXT } from '../../workspace/constants.js';\r\nimport type { UmbMediaUrlModel } from '../repository/types.js';\r\nimport { css, customElement, html, nothing, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbRequestReloadStructureForEntityEvent } from '@umbraco-cms/backoffice/entity-action';\r\nimport type { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport { observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\nimport { debounce, sanitizeHTML } from '@umbraco-cms/backoffice/utils';\r\n\r\ninterface UmbMediaInfoViewLink {\r\n\turl: string | undefined;\r\n}\r\n\r\n@customElement('umb-media-links-workspace-info-app')\r\nexport class UmbMediaLinksWorkspaceInfoAppElement extends UmbLitElement {\r\n\t#mediaUrlRepository = new UmbMediaUrlRepository(this);\r\n\r\n\t@state()\r\n\tprivate _isNew = false;\r\n\r\n\t@state()\r\n\tprivate _unique?: string;\r\n\r\n\t@state()\r\n\tprivate _loading = false;\r\n\r\n\t@state()\r\n\tprivate _links: Array<UmbMediaInfoViewLink> = [];\r\n\r\n\t#urls: Array<UmbMediaUrlModel> = [];\r\n\r\n\t#eventContext?: typeof UMB_ACTION_EVENT_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MEDIA_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (context) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tobserveMultiple([context.isNew, context.unique]),\r\n\t\t\t\t\t([isNew, unique]) => {\r\n\t\t\t\t\t\tif (!unique) return;\r\n\t\t\t\t\t\tthis._isNew = isNew === true;\r\n\r\n\t\t\t\t\t\tif (unique !== this._unique) {\r\n\t\t\t\t\t\t\tthis._unique = unique;\r\n\t\t\t\t\t\t\tthis.#requestUrls();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeWorkspaceState',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.removeUmbControllerByAlias('observeWorkspaceState');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t#setLinks() {\r\n\t\tconst links: Array<UmbMediaInfoViewLink> = this.#urls.map((u) => {\r\n\t\t\tconst url = u.url;\r\n\t\t\treturn { url };\r\n\t\t});\r\n\r\n\t\tthis._links = links;\r\n\t}\r\n\r\n\tasync #requestUrls() {\r\n\t\tif (this._isNew) return;\r\n\t\tif (!this._unique) return;\r\n\r\n\t\tthis._loading = true;\r\n\t\tthis.#urls = [];\r\n\r\n\t\tconst { data } = await this.#mediaUrlRepository.requestItems([this._unique]);\r\n\r\n\t\tif (data?.length) {\r\n\t\t\tthis.#urls = data;\r\n\t\t\tthis.#setLinks();\r\n\t\t}\r\n\r\n\t\tthis._loading = false;\r\n\t}\r\n\r\n\t#debounceRequestUrls = debounce(() => this.#requestUrls(), 50);\r\n\r\n\t#onReloadRequest = () => {\r\n\t\tthis.#debounceRequestUrls();\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-workspace-info-app-layout headline=\"#general_links\">\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis._loading,\r\n\t\t\t\t\t() => this.#renderLoading(),\r\n\t\t\t\t\t() => this.#renderContent(),\r\n\t\t\t\t)}\r\n\t\t\t</umb-workspace-info-app-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderLoading() {\r\n\t\treturn html`<div id=\"loader-container\"><uui-loader></uui-loader></div>`;\r\n\t}\r\n\r\n\t#openSvg(imagePath: string) {\r\n\t\tconst popup = window.open('', '_blank');\r\n\t\tif (!popup) return;\r\n\r\n\t\tconst html = `<!doctype html>\r\n<body style=\"background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(135deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(135deg, transparent 75%, #ccc 75%); background-size:30px 30px; background-position:0 0, 15px 0, 15px -15px, 0px 15px;\">\r\n\t<img src=\"${imagePath}\"/>\r\n\t<script>history.pushState(null, null, \"${sanitizeHTML(window.location.href)}\");</script>\r\n</body>`;\r\n\r\n\t\tpopup.document.open();\r\n\t\tpopup.document.write(html);\r\n\t\tpopup.document.close();\r\n\t}\r\n\r\n\t#renderContent() {\r\n\t\tif (this._links.length) {\r\n\t\t\treturn html`\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._links,\r\n\t\t\t\t\t(item) => item.url,\r\n\t\t\t\t\t(item) => this.#renderLinkItem(item),\r\n\t\t\t\t)}\r\n\t\t\t`;\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<div class=\"link-item\">\r\n\t\t\t\t\t<span class=\"link-content italic\"><umb-localize key=\"content_noMediaLink\"></umb-localize></span>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderLinkItem(item: UmbMediaInfoViewLink) {\r\n\t\tif (!item.url) return nothing;\r\n\t\tconst ext = item.url.split(/[#?]/)[0].split('.').pop()?.trim();\r\n\t\tif (ext === 'svg') {\r\n\t\t\treturn html`\r\n\t\t\t\t<a href=\"#\" target=\"_blank\" class=\"link-item with-href\" @click=${() => this.#openSvg(item.url!)}>\r\n\t\t\t\t\t<span class=\"link-content\">${item.url}</span>\r\n\t\t\t\t\t<uui-icon name=\"icon-out\"></uui-icon>\r\n\t\t\t\t</a>\r\n\t\t\t`;\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<a href=${item.url} target=\"_blank\" class=\"link-item with-href\">\r\n\t\t\t\t\t<span class=\"link-content\">${item.url}</span>\r\n\t\t\t\t\t<uui-icon name=\"icon-out\"></uui-icon>\r\n\t\t\t\t</a>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\toverride disconnectedCallback(): void {\r\n\t\tsuper.disconnectedCallback();\r\n\r\n\t\tthis.#eventContext?.removeEventListener(\r\n\t\t\tUmbRequestReloadStructureForEntityEvent.TYPE,\r\n\t\t\tthis.#onReloadRequest as unknown as EventListener,\r\n\t\t);\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tuui-box {\r\n\t\t\t\t--uui-box-default-padding: 0;\r\n\t\t\t}\r\n\r\n\t\t\t#link-section {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t}\r\n\r\n\t\t\t.link-item {\r\n\t\t\t\tpadding: var(--uui-size-space-4) var(--uui-size-space-5);\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: 1fr auto;\r\n\t\t\t\tgap: var(--uui-size-6);\r\n\t\t\t\tcolor: inherit;\r\n\t\t\t\ttext-decoration: none;\r\n\t\t\t\tword-break: break-all;\r\n\t\t\t}\r\n\r\n\t\t\t.link-language {\r\n\t\t\t\tcolor: var(--uui-color-divider-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t.link-content.italic {\r\n\t\t\t\tfont-style: italic;\r\n\t\t\t}\r\n\r\n\t\t\t.link-item uui-icon {\r\n\t\t\t\tmargin-right: var(--uui-size-space-2);\r\n\t\t\t\tvertical-align: middle;\r\n\t\t\t}\r\n\r\n\t\t\t.link-item.with-href {\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\r\n\t\t\t.link-item.with-href:hover {\r\n\t\t\t\tbackground: var(--uui-color-divider);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaLinksWorkspaceInfoAppElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-links-workspace-info-app': UmbMediaLinksWorkspaceInfoAppElement;\r\n\t}\r\n}\r\n"],"names":["_mediaUrlRepository","_urls","_eventContext","_UmbMediaLinksWorkspaceInfoAppElement_instances","setLinks_fn","requestUrls_fn","_debounceRequestUrls","_onReloadRequest","renderLoading_fn","openSvg_fn","renderContent_fn","renderLinkItem_fn","UmbMediaLinksWorkspaceInfoAppElement","UmbLitElement","__privateAdd","UmbMediaUrlRepository","debounce","__privateMethod","__privateGet","UMB_MEDIA_WORKSPACE_CONTEXT","context","observeMultiple","isNew","unique","html","when","UmbRequestReloadStructureForEntityEvent","links","u","__privateSet","data","imagePath","popup","sanitizeHTML","repeat","item","nothing","css","__decorateClass","state","customElement","UmbMediaLinksWorkspaceInfoAppElement$1"],"mappings":"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"}