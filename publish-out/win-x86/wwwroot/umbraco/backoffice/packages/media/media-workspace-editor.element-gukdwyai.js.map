{"version":3,"file":"media-workspace-editor.element-gukdwyai.js","sources":["../../../src/packages/media/media/workspace/media-workspace-split-view.element.ts","../../../src/packages/media/media/workspace/media-workspace-editor.element.ts"],"sourcesContent":["import { UMB_MEDIA_WORKSPACE_CONTEXT } from './media-workspace.context-token.js';\r\nimport { css, customElement, html, ifDefined, nothing, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { ManifestWorkspaceView, UmbActiveVariant } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbDeepPartialObject } from '@umbraco-cms/backoffice/utils';\r\n\r\n@customElement('umb-media-workspace-split-view')\r\nexport class UmbMediaWorkspaceSplitViewElement extends UmbLitElement {\r\n\t// TODO: Refactor: use the split view context token:\r\n\tprivate _workspaceContext?: typeof UMB_MEDIA_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\t@state()\r\n\tprivate _variants?: Array<UmbActiveVariant>;\r\n\r\n\t@state()\r\n\tprivate _icon?: string;\r\n\r\n\t@state()\r\n\tprivate _overrides?: Array<UmbDeepPartialObject<ManifestWorkspaceView>>;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t// TODO: Refactor: use a split view workspace context token:\r\n\t\tthis.consumeContext(UMB_MEDIA_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis._workspaceContext = context;\r\n\t\t\tthis.#observeActiveVariantInfo();\r\n\t\t\tthis.#observeIcon();\r\n\t\t\tthis.#observeCollectionOverrides();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeActiveVariantInfo() {\r\n\t\tif (!this._workspaceContext) return;\r\n\t\tthis.observe(\r\n\t\t\tthis._workspaceContext.splitView.activeVariantsInfo,\r\n\t\t\t(variants) => {\r\n\t\t\t\tthis._variants = variants;\r\n\t\t\t},\r\n\t\t\t'_observeActiveVariantsInfo',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeIcon() {\r\n\t\tif (!this._workspaceContext) return;\r\n\t\tthis.observe(this._workspaceContext.contentTypeIcon, (icon) => {\r\n\t\t\tthis._icon = icon ?? undefined;\r\n\t\t});\r\n\t}\r\n\r\n\t#observeCollectionOverrides() {\r\n\t\tthis.observe(this._workspaceContext?.collection.manifestOverrides, (overrides) => {\r\n\t\t\tthis._overrides = overrides ? [overrides] : undefined;\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._variants\r\n\t\t\t? html`<div id=\"splitViews\">\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis._variants,\r\n\t\t\t\t\t\t\t(view) =>\r\n\t\t\t\t\t\t\t\tview.index + '_' + (view.culture ?? '') + '_' + (view.segment ?? '') + '_' + this._variants!.length,\r\n\t\t\t\t\t\t\t(view) => html`\r\n\t\t\t\t\t\t\t\t<umb-workspace-split-view\r\n\t\t\t\t\t\t\t\t\t.displayNavigation=${view.index === this._variants!.length - 1}\r\n\t\t\t\t\t\t\t\t\t.overrides=${this._overrides}\r\n\t\t\t\t\t\t\t\t\t.splitViewIndex=${view.index}>\r\n\t\t\t\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${ifDefined(this._icon)}></umb-icon>\r\n\t\t\t\t\t\t\t\t</umb-workspace-split-view>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<umb-workspace-footer alias=\"Umb.Workspace.Media\"></umb-workspace-footer>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t#splitViews {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: calc(100% - var(--umb-footer-layout-height));\r\n\t\t\t}\r\n\r\n\t\t\t#breadcrumbs {\r\n\t\t\t\tmargin: 0 var(--uui-size-layout-1);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaWorkspaceSplitViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-workspace-split-view': UmbMediaWorkspaceSplitViewElement;\r\n\t}\r\n}\r\n","import type { UmbMediaVariantOptionModel } from '../types.js';\r\nimport { UmbMediaWorkspaceSplitViewElement } from './media-workspace-split-view.element.js';\r\nimport { UMB_MEDIA_WORKSPACE_CONTEXT } from './media-workspace.context-token.js';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { customElement, state, css, html } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbRoute, UmbRouterSlotInitEvent } from '@umbraco-cms/backoffice/router';\r\n\r\n@customElement('umb-media-workspace-editor')\r\nexport class UmbMediaWorkspaceEditorElement extends UmbLitElement {\r\n\t//\r\n\t// TODO: Refactor: when having a split view/variants context token, we can rename the split view/variants component to a generic and make this component generic as well. [NL]\r\n\tprivate _splitViewElement = new UmbMediaWorkspaceSplitViewElement();\r\n\r\n\t#workspaceContext?: typeof UMB_MEDIA_WORKSPACE_CONTEXT.TYPE;\r\n\t#variants?: Array<UmbMediaVariantOptionModel>;\r\n\t#isForbidden = false;\r\n\r\n\t@state()\r\n\tprivate _routes?: Array<UmbRoute>;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MEDIA_WORKSPACE_CONTEXT, (instance) => {\r\n\t\t\tthis.#workspaceContext = instance;\r\n\t\t\tthis.#observeVariants();\r\n\t\t\tthis.#observeForbidden();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeVariants() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.variantOptions,\r\n\t\t\t(options) => {\r\n\t\t\t\tthis.#variants = options;\r\n\t\t\t\tthis._generateRoutes();\r\n\t\t\t},\r\n\t\t\t'_observeVariants',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeForbidden() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.forbidden.isOn,\r\n\t\t\t(forbidden) => {\r\n\t\t\t\tthis.#isForbidden = forbidden ?? false;\r\n\t\t\t\tthis._generateRoutes();\r\n\t\t\t},\r\n\t\t\t'_observeForbidden',\r\n\t\t);\r\n\t}\r\n\r\n\tprivate async _generateRoutes() {\r\n\t\t// Generate split view routes for all available routes\r\n\t\tconst routes: Array<UmbRoute> = [];\r\n\r\n\t\t// Split view routes:\r\n\t\tthis.#variants?.forEach((variantA) => {\r\n\t\t\tthis.#variants?.forEach((variantB) => {\r\n\t\t\t\troutes.push({\r\n\t\t\t\t\t// TODO: When implementing Segments, be aware if using the unique is URL Safe... [NL]\r\n\t\t\t\t\tpath: variantA.unique + '_&_' + variantB.unique,\r\n\t\t\t\t\tcomponent: this._splitViewElement,\r\n\t\t\t\t\tsetup: (_component, info) => {\r\n\t\t\t\t\t\t// Set split view/active info..\r\n\t\t\t\t\t\tthis.#workspaceContext?.splitView.setVariantParts(info.match.fragments.consumed);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Single view:\r\n\t\tthis.#variants?.forEach((variant) => {\r\n\t\t\troutes.push({\r\n\t\t\t\t// TODO: When implementing Segments, be aware if using the unique is URL Safe... [NL]\r\n\t\t\t\tpath: variant.unique,\r\n\t\t\t\tcomponent: this._splitViewElement,\r\n\t\t\t\tsetup: (_component, info) => {\r\n\t\t\t\t\t// cause we might come from a split-view, we need to reset index 1.\r\n\t\t\t\t\tthis.#workspaceContext?.splitView.removeActiveVariant(1);\r\n\t\t\t\t\tthis.#workspaceContext?.splitView.handleVariantFolderPart(0, info.match.fragments.consumed);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (routes.length !== 0 && this.#variants?.length) {\r\n\t\t\t// Using first single view as the default route for now (hence the math below):\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: '',\r\n\t\t\t\tpathMatch: 'full',\r\n\t\t\t\tredirectTo: routes[this.#variants.length * this.#variants.length]?.path,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\troutes.push({\r\n\t\t\tpath: `**`,\r\n\t\t\tcomponent: async () => {\r\n\t\t\t\tconst router = await import('@umbraco-cms/backoffice/router');\r\n\t\t\t\treturn this.#isForbidden ? router.UmbRouteForbiddenElement : router.UmbRouteNotFoundElement;\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis._routes = routes;\r\n\t}\r\n\r\n\tprivate _gotWorkspaceRoute = (e: UmbRouterSlotInitEvent) => {\r\n\t\tthis.#workspaceContext?.splitView.setWorkspaceRoute(e.target.absoluteRouterPath);\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn this._routes && this._routes.length > 0\r\n\t\t\t? html`<umb-router-slot .routes=${this._routes} @init=${this._gotWorkspaceRoute}></umb-router-slot>`\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-workspace-editor': UmbMediaWorkspaceEditorElement;\r\n\t}\r\n}\r\n"],"names":["_UmbMediaWorkspaceSplitViewElement_instances","observeActiveVariantInfo_fn","observeIcon_fn","observeCollectionOverrides_fn","UmbMediaWorkspaceSplitViewElement","UmbLitElement","__privateAdd","UMB_MEDIA_WORKSPACE_CONTEXT","context","__privateMethod","html","repeat","view","ifDefined","nothing","variants","icon","overrides","UmbTextStyles","css","__decorateClass","state","customElement","_workspaceContext","_variants","_isForbidden","_UmbMediaWorkspaceEditorElement_instances","observeVariants_fn","observeForbidden_fn","UmbMediaWorkspaceEditorElement","e","__privateGet","instance","__privateSet","routes","variantA","variantB","_component","info","variant","router","options","forbidden","UmbMediaWorkspaceEditorElement$1"],"mappings":"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"}