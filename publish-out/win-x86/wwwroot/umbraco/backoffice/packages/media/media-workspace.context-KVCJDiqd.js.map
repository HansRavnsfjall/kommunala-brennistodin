{"version":3,"file":"media-workspace.context-KVCJDiqd.js","sources":["../../../src/packages/media/media/property-dataset-context/media-property-dataset-context.ts","../../../src/packages/media/media/workspace/media-workspace.context.ts"],"sourcesContent":["import type { UmbMediaDetailModel, UmbMediaVariantModel } from '../types.js';\r\nimport { UmbContentPropertyDatasetContext } from '@umbraco-cms/backoffice/content';\r\nimport type { UmbMediaTypeDetailModel } from '@umbraco-cms/backoffice/media-type';\r\n\r\nexport class UmbMediaPropertyDatasetContext extends UmbContentPropertyDatasetContext<\r\n\tUmbMediaDetailModel,\r\n\tUmbMediaTypeDetailModel,\r\n\tUmbMediaVariantModel\r\n> {}\r\n","import { UmbMediaTypeDetailRepository } from '../../media-types/repository/detail/media-type-detail.repository.js';\r\nimport { UmbMediaPropertyDatasetContext } from '../property-dataset-context/media-property-dataset-context.js';\r\nimport { UMB_MEDIA_ENTITY_TYPE } from '../entity.js';\r\nimport { UMB_MEDIA_DETAIL_REPOSITORY_ALIAS } from '../constants.js';\r\nimport type { UmbMediaDetailModel, UmbMediaVariantModel } from '../types.js';\r\nimport { UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN, UMB_EDIT_MEDIA_WORKSPACE_PATH_PATTERN } from '../paths.js';\r\nimport { UmbMediaValidationRepository } from '../repository/validation/media-validation.repository.js';\r\nimport { UMB_MEDIA_COLLECTION_ALIAS } from '../collection/constants.js';\r\nimport type { UmbMediaDetailRepository } from '../repository/index.js';\r\nimport { UMB_MEDIA_WORKSPACE_ALIAS, UMB_MEMBER_DETAIL_MODEL_VARIANT_SCAFFOLD } from './constants.js';\r\nimport { UmbContentDetailWorkspaceContextBase, type UmbContentWorkspaceContext } from '@umbraco-cms/backoffice/content';\r\nimport { UmbIsTrashedEntityContext } from '@umbraco-cms/backoffice/recycle-bin';\r\nimport {\r\n\tUmbWorkspaceIsNewRedirectController,\r\n\tUmbWorkspaceIsNewRedirectControllerAlias,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbMediaTypeDetailModel } from '@umbraco-cms/backoffice/media-type';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\ntype ContentModel = UmbMediaDetailModel;\r\ntype ContentTypeModel = UmbMediaTypeDetailModel;\r\n\r\nexport class UmbMediaWorkspaceContext\r\n\textends UmbContentDetailWorkspaceContextBase<\r\n\t\tContentModel,\r\n\t\tUmbMediaDetailRepository,\r\n\t\tContentTypeModel,\r\n\t\tUmbMediaVariantModel\r\n\t>\r\n\timplements UmbContentWorkspaceContext<ContentModel, ContentTypeModel, UmbMediaVariantModel>\r\n{\r\n\treadonly contentTypeUnique = this._data.createObservablePartOfCurrent((data) => data?.mediaType.unique);\r\n\t/*\r\n\t * @deprecated Use `collection.hasCollection` instead, will be removed in v.18\r\n\t */\r\n\treadonly contentTypeHasCollection = this._data.createObservablePartOfCurrent((data) => !!data?.mediaType.collection);\r\n\treadonly contentTypeIcon = this._data.createObservablePartOfCurrent((data) => data?.mediaType.icon);\r\n\r\n\t#isTrashedContext = new UmbIsTrashedEntityContext(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n\t\t\tworkspaceAlias: UMB_MEDIA_WORKSPACE_ALIAS,\r\n\t\t\tdetailRepositoryAlias: UMB_MEDIA_DETAIL_REPOSITORY_ALIAS,\r\n\t\t\tcontentTypeDetailRepository: UmbMediaTypeDetailRepository,\r\n\t\t\tcontentValidationRepository: UmbMediaValidationRepository,\r\n\t\t\tcontentVariantScaffold: UMB_MEMBER_DETAIL_MODEL_VARIANT_SCAFFOLD,\r\n\t\t\tcontentTypePropertyName: 'mediaType',\r\n\t\t\tcollectionAlias: UMB_MEDIA_COLLECTION_ALIAS,\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.contentTypeUnique,\r\n\t\t\t(unique) => {\r\n\t\t\t\tif (unique) {\r\n\t\t\t\t\tthis.structure.loadType(unique);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.propertyViewGuard.fallbackToPermitted();\r\n\t\tthis.propertyWriteGuard.fallbackToPermitted();\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN.toString(),\r\n\t\t\t\tcomponent: () => import('./media-workspace-editor.element.js'),\r\n\t\t\t\tsetup: async (_component, info) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.parentEntityType;\r\n\t\t\t\t\tconst parentUnique = info.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tconst mediaTypeUnique = info.match.params.mediaTypeUnique;\r\n\t\t\t\t\tawait this.createScaffold({\r\n\t\t\t\t\t\tparent: { entityType: parentEntityType, unique: parentUnique },\r\n\t\t\t\t\t\tpreset: { mediaType: { unique: mediaTypeUnique } },\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: UMB_EDIT_MEDIA_WORKSPACE_PATH_PATTERN.toString(),\r\n\t\t\t\tcomponent: () => import('./media-workspace-editor.element.js'),\r\n\t\t\t\tsetup: (_component, info) => {\r\n\t\t\t\t\tthis.removeUmbControllerByAlias(UmbWorkspaceIsNewRedirectControllerAlias);\r\n\t\t\t\t\tconst unique = info.match.params.unique;\r\n\t\t\t\t\tthis.load(unique);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\tpublic override resetState() {\r\n\t\tsuper.resetState();\r\n\t\tthis.#isTrashedContext.setIsTrashed(false);\r\n\t\tthis.removeUmbControllerByAlias(UmbWorkspaceIsNewRedirectControllerAlias);\r\n\t}\r\n\r\n\tpublic override async load(unique: string) {\r\n\t\tconst response = await super.load(unique);\r\n\r\n\t\tif (response?.data) {\r\n\t\t\tthis.#isTrashedContext.setIsTrashed(response.data.isTrashed);\r\n\t\t}\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\t/*\r\n\t * @deprecated Use `createScaffold` instead.\r\n\t */\r\n\tpublic async create(parent: { entityType: string; unique: string | null }, mediaTypeUnique: string) {\r\n\t\treturn this.createScaffold({\r\n\t\t\tparent,\r\n\t\t\tpreset: { mediaType: { unique: mediaTypeUnique } },\r\n\t\t});\r\n\t}\r\n\r\n\t/*\r\n\t * @deprecated Use `collection.getCollectionAlias()` instead. Will be removed in v.18\r\n\t */\r\n\tpublic getCollectionAlias() {\r\n\t\treturn UMB_MEDIA_COLLECTION_ALIAS;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the unique identifier of the content type.\r\n\t * @deprecated Use `getContentTypeUnique` instead.\r\n\t * @returns { string | undefined} The unique identifier of the content type.\r\n\t * @memberof UmbMediaWorkspaceContext\r\n\t */\r\n\tgetContentTypeId(): string | undefined {\r\n\t\treturn this.getContentTypeUnique();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the unique identifier of the content type.\r\n\t * @returns { string | undefined} The unique identifier of the content type.\r\n\t * @memberof UmbMediaWorkspaceContext\r\n\t */\r\n\tgetContentTypeUnique(): string | undefined {\r\n\t\treturn this.getData()?.mediaType.unique;\r\n\t}\r\n\r\n\tpublic createPropertyDatasetContext(\r\n\t\thost: UmbControllerHost,\r\n\t\tvariantId: UmbVariantId,\r\n\t): UmbMediaPropertyDatasetContext {\r\n\t\treturn new UmbMediaPropertyDatasetContext(host, this, variantId);\r\n\t}\r\n}\r\n\r\nexport { UmbMediaWorkspaceContext as api };\r\n"],"names":["UmbMediaPropertyDatasetContext","UmbContentPropertyDatasetContext","UmbMediaWorkspaceContext","UmbContentDetailWorkspaceContextBase","host","UMB_MEDIA_ENTITY_TYPE","UMB_MEDIA_WORKSPACE_ALIAS","UMB_MEDIA_DETAIL_REPOSITORY_ALIAS","UmbMediaTypeDetailRepository","UmbMediaValidationRepository","UMB_MEMBER_DETAIL_MODEL_VARIANT_SCAFFOLD","UMB_MEDIA_COLLECTION_ALIAS","data","#isTrashedContext","UmbIsTrashedEntityContext","unique","UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN","_component","info","parentEntityType","parentUnique","mediaTypeUnique","UmbWorkspaceIsNewRedirectController","UMB_EDIT_MEDIA_WORKSPACE_PATH_PATTERN","UmbWorkspaceIsNewRedirectControllerAlias","response","parent","variantId"],"mappings":"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"}