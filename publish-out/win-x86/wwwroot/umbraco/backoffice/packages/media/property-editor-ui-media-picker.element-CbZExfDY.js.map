{"version":3,"file":"property-editor-ui-media-picker.element-CbZExfDY.js","sources":["../../../src/packages/media/media/property-editors/media-picker/property-editor-ui-media-picker.element.ts"],"sourcesContent":["import type { UmbInputRichMediaElement } from '../../components/input-rich-media/input-rich-media.element.js';\r\nimport type { UmbCropModel, UmbMediaPickerValueModel } from '../types.js';\r\nimport { UMB_MEDIA_ENTITY_TYPE } from '../../entity.js';\r\nimport { customElement, html, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbPropertyEditorUiInteractionMemoryManager } from '@umbraco-cms/backoffice/property-editor';\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport { UMB_VALIDATION_EMPTY_LOCALIZATION_KEY, UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport type { UmbInteractionMemoryModel } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport type {\r\n\tUmbPropertyEditorConfigCollection,\r\n\tUmbPropertyEditorUiElement,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\nimport type { UmbNumberRangeValueType } from '@umbraco-cms/backoffice/models';\r\nimport type { UmbTreeStartNode } from '@umbraco-cms/backoffice/tree';\r\n\r\nimport '../../components/input-rich-media/input-rich-media.element.js';\r\n/**\r\n * @element umb-property-editor-ui-media-picker\r\n */\r\n@customElement('umb-property-editor-ui-media-picker')\r\nexport class UmbPropertyEditorUIMediaPickerElement\r\n\textends UmbFormControlMixin<UmbMediaPickerValueModel | undefined, typeof UmbLitElement, undefined>(UmbLitElement)\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tthis.#interactionMemoryManager.setPropertyEditorConfig(config);\r\n\r\n\t\tif (!config) return;\r\n\r\n\t\tthis._allowedMediaTypes = config.getValueByAlias<string>('filter')?.split(',') ?? [];\r\n\t\tthis._focalPointEnabled = Boolean(config.getValueByAlias('enableLocalFocalPoint'));\r\n\t\tthis._multiple = Boolean(config.getValueByAlias('multiple'));\r\n\t\tthis._preselectedCrops = config?.getValueByAlias<Array<UmbCropModel>>('crops') ?? [];\r\n\r\n\t\tconst startNodeId = config.getValueByAlias<string>('startNodeId') ?? '';\r\n\t\tthis._startNode = startNodeId ? { unique: startNodeId, entityType: UMB_MEDIA_ENTITY_TYPE } : undefined;\r\n\r\n\t\tconst minMax = config.getValueByAlias<UmbNumberRangeValueType>('validationLimit');\r\n\t\tthis._min = minMax?.min ?? 0;\r\n\t\tthis._max = minMax?.max ?? Infinity;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to mandatory, meaning validation will fail if the value is empty.\r\n\t * @type {boolean}\r\n\t */\r\n\t@property({ type: Boolean })\r\n\tmandatory?: boolean;\r\n\r\n\t@property({ type: String })\r\n\tmandatoryMessage = UMB_VALIDATION_EMPTY_LOCALIZATION_KEY;\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default false\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\treadonly = false;\r\n\r\n\t@state()\r\n\tprivate _startNode?: UmbTreeStartNode;\r\n\r\n\t@state()\r\n\tprivate _focalPointEnabled: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _preselectedCrops: Array<UmbCropModel> = [];\r\n\r\n\t@state()\r\n\tprivate _allowedMediaTypes: Array<string> = [];\r\n\r\n\t@state()\r\n\tprivate _multiple: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _min: number = 0;\r\n\r\n\t@state()\r\n\tprivate _max: number = Infinity;\r\n\r\n\t@state()\r\n\tprivate _alias?: string;\r\n\r\n\t@state()\r\n\tprivate _variantId?: string;\r\n\r\n\t@state()\r\n\tprivate _interactionMemories: Array<UmbInteractionMemoryModel> = [];\r\n\r\n\t#interactionMemoryManager = new UmbPropertyEditorUiInteractionMemoryManager(this, {\r\n\t\tmemoryUniquePrefix: 'UmbMediaPicker',\r\n\t});\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(context?.alias, (alias) => (this._alias = alias));\r\n\t\t\tthis.observe(context?.variantId, (variantId) => (this._variantId = variantId?.toString() || 'invariant'));\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#interactionMemoryManager.memoriesForPropertyEditor, (interactionMemories) => {\r\n\t\t\tthis._interactionMemories = interactionMemories ?? [];\r\n\t\t});\r\n\t}\r\n\r\n\toverride firstUpdated() {\r\n\t\tthis.addFormControlElement(this.shadowRoot!.querySelector('umb-input-rich-media')!);\r\n\t}\r\n\r\n\toverride focus() {\r\n\t\treturn this.shadowRoot?.querySelector<UmbInputRichMediaElement>('umb-input-rich-media')?.focus();\r\n\t}\r\n\r\n\t#onChange(event: CustomEvent & { target: UmbInputRichMediaElement }) {\r\n\t\tconst isEmpty = event.target.value?.length === 0;\r\n\t\tthis.value = isEmpty ? undefined : event.target.value;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #onInputInteractionMemoriesChange(event: UmbChangeEvent) {\r\n\t\tconst target = event.target as UmbInputRichMediaElement;\r\n\t\tconst interactionMemories = target.interactionMemories;\r\n\r\n\t\tif (interactionMemories && interactionMemories.length > 0) {\r\n\t\t\tawait this.#interactionMemoryManager.saveMemoriesForPropertyEditor(interactionMemories);\r\n\t\t} else {\r\n\t\t\tawait this.#interactionMemoryManager.deleteMemoriesForPropertyEditor();\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-rich-media\r\n\t\t\t\t.alias=${this._alias}\r\n\t\t\t\t.allowedContentTypeIds=${this._allowedMediaTypes}\r\n\t\t\t\t.focalPointEnabled=${this._focalPointEnabled}\r\n\t\t\t\t.value=${this.value ?? []}\r\n\t\t\t\t.max=${this._max}\r\n\t\t\t\t.min=${this._min}\r\n\t\t\t\t.preselectedCrops=${this._preselectedCrops}\r\n\t\t\t\t.startNode=${this._startNode}\r\n\t\t\t\t.variantId=${this._variantId}\r\n\t\t\t\t.required=${this.mandatory}\r\n\t\t\t\t.requiredMessage=${this.mandatoryMessage}\r\n\t\t\t\t?multiple=${this._multiple}\r\n\t\t\t\t@change=${this.#onChange}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t.interactionMemories=${this._interactionMemories}\r\n\t\t\t\t@interaction-memories-change=${this.#onInputInteractionMemoriesChange}>\r\n\t\t\t</umb-input-rich-media>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport { UmbPropertyEditorUIMediaPickerElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t['umb-property-editor-ui-media-picker']: UmbPropertyEditorUIMediaPickerElement;\r\n\t}\r\n}\r\n"],"names":["_interactionMemoryManager","_UmbPropertyEditorUIMediaPickerElement_instances","onChange_fn","onInputInteractionMemoriesChange_fn","UmbPropertyEditorUIMediaPickerElement","UmbFormControlMixin","UmbLitElement","__privateAdd","UMB_VALIDATION_EMPTY_LOCALIZATION_KEY","UmbPropertyEditorUiInteractionMemoryManager","UMB_PROPERTY_CONTEXT","context","alias","variantId","__privateGet","interactionMemories","config","startNodeId","UMB_MEDIA_ENTITY_TYPE","minMax","html","__privateMethod","event","isEmpty","UmbChangeEvent","__decorateClass","property","state","customElement"],"mappings":"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"}