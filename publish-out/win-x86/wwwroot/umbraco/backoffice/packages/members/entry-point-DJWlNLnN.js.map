{"version":3,"file":"entry-point-DJWlNLnN.js","sources":["../../../src/packages/members/member/item/repository/member-item.server.cache-invalidation.manager.ts","../../../src/packages/members/member/entry-point.ts"],"sourcesContent":["import { memberItemCache } from './member-item.server.cache.js';\r\nimport {\r\n\tUmbManagementApiItemDataCacheInvalidationManager,\r\n\ttype UmbManagementApiServerEventModel,\r\n} from '@umbraco-cms/backoffice/management-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { MemberItemResponseModel } from '@umbraco-cms/backoffice/external/backend-api';\r\n\r\nexport class UmbManagementApiMemberItemDataCacheInvalidationManager extends UmbManagementApiItemDataCacheInvalidationManager<MemberItemResponseModel> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tdataCache: memberItemCache,\r\n\t\t\t/* The Member item model includes info about the Member Type. \r\n\t\t\tWe need to invalidate the cache for both Member and MemberType events. */\r\n\t\t\teventSources: ['Umbraco:CMS:Member', 'Umbraco:CMS:MemberType'],\r\n\t\t});\r\n\t}\r\n\r\n\tprotected override _onServerEvent(event: UmbManagementApiServerEventModel) {\r\n\t\tif (event.eventSource === 'Umbraco:CMS:MemberType') {\r\n\t\t\tthis.#onMemberTypeChange(event);\r\n\t\t} else {\r\n\t\t\tthis.#onMemberChange(event);\r\n\t\t}\r\n\t}\r\n\r\n\t#onMemberChange(event: UmbManagementApiServerEventModel) {\r\n\t\t// Invalidate the specific member\r\n\t\tconst memberId = event.key;\r\n\t\tthis._dataCache.delete(memberId);\r\n\t}\r\n\r\n\t#onMemberTypeChange(event: UmbManagementApiServerEventModel) {\r\n\t\t// Invalidate all members of the specified Member Type\r\n\t\tconst memberTypeId = event.key;\r\n\t\tconst memberIds = this._dataCache\r\n\t\t\t.getAll()\r\n\t\t\t.filter((cachedItem) => cachedItem.memberType.id === memberTypeId)\r\n\t\t\t.map((item) => item.id);\r\n\r\n\t\tmemberIds.forEach((id) => this._dataCache.delete(id));\r\n\t}\r\n}\r\n","import { UmbManagementApiMemberItemDataCacheInvalidationManager } from './item/repository/member-item.server.cache-invalidation.manager.js';\r\nimport type { UmbEntryPointOnInit, UmbEntryPointOnUnload } from '@umbraco-cms/backoffice/extension-api';\r\n\r\nlet itemDataCacheInvalidationManager: UmbManagementApiMemberItemDataCacheInvalidationManager | undefined;\r\n\r\nexport const onInit: UmbEntryPointOnInit = (host) => {\r\n\titemDataCacheInvalidationManager = new UmbManagementApiMemberItemDataCacheInvalidationManager(host);\r\n};\r\n\r\nexport const onUnload: UmbEntryPointOnUnload = () => {\r\n\titemDataCacheInvalidationManager?.destroy();\r\n};\r\n"],"names":["UmbManagementApiMemberItemDataCacheInvalidationManager","UmbManagementApiItemDataCacheInvalidationManager","host","memberItemCache","event","#onMemberTypeChange","#onMemberChange","memberId","memberTypeId","cachedItem","item","id","itemDataCacheInvalidationManager","onInit","onUnload"],"mappings":";;AAQO,MAAMA,UAA+DC,EAA0E;AAAA,EACrJ,YAAYC,GAAyB;AACpC,UAAMA,GAAM;AAAA,MACX,WAAWC;AAAA;AAAA;AAAA,MAGX,cAAc,CAAC,sBAAsB,wBAAwB;AAAA,IAAA,CAC7D;AAAA,EACF;AAAA,EAEmB,eAAeC,GAAyC;AAC1E,IAAIA,EAAM,gBAAgB,2BACzB,KAAKC,GAAoBD,CAAK,IAE9B,KAAKE,GAAgBF,CAAK;AAAA,EAE5B;AAAA,EAEAE,GAAgBF,GAAyC;AAExD,UAAMG,IAAWH,EAAM;AACvB,SAAK,WAAW,OAAOG,CAAQ;AAAA,EAChC;AAAA,EAEAF,GAAoBD,GAAyC;AAE5D,UAAMI,IAAeJ,EAAM;AAM3B,IALkB,KAAK,WACrB,OAAA,EACA,OAAO,CAACK,MAAeA,EAAW,WAAW,OAAOD,CAAY,EAChE,IAAI,CAACE,MAASA,EAAK,EAAE,EAEb,QAAQ,CAACC,MAAO,KAAK,WAAW,OAAOA,CAAE,CAAC;AAAA,EACrD;AACD;ACvCA,IAAIC;AAEG,MAAMC,IAA8B,CAACX,MAAS;AACpD,EAAAU,IAAmC,IAAIZ,EAAuDE,CAAI;AACnG,GAEaY,IAAkC,MAAM;AACpD,EAAAF,GAAkC,QAAA;AACnC;"}