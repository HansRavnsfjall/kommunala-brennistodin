{"version":3,"file":"package.store-BoQ5HfpI.js","sources":["../../../src/packages/packages/package/repository/package.store.ts"],"sourcesContent":["import type { UmbPackage } from '../../types.js';\r\nimport { UMB_PACKAGE_STORE_TOKEN } from './package.store.context-token.js';\r\nimport { ReplaySubject } from '@umbraco-cms/backoffice/external/rxjs';\r\nimport { UmbArrayState, UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbStoreBase } from '@umbraco-cms/backoffice/store';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { ManifestBase } from '@umbraco-cms/backoffice/extension-api';\r\nimport type {\r\n\tPackageConfigurationResponseModel,\r\n\tPackageMigrationStatusResponseModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\n\r\n/**\r\n * Store for Packages\r\n * @augments {UmbStoreBase}\r\n */\r\nexport class UmbPackageStore extends UmbStoreBase {\r\n\t#configuration = new UmbObjectState<PackageConfigurationResponseModel>({ marketplaceUrl: '' });\r\n\r\n\t/**\r\n\t * Array of packages with extensions\r\n\t * @private\r\n\t */\r\n\t// TODO: Revisit this code, to not use RxJS directly:\r\n\t#packages = new ReplaySubject<Array<UmbPackage>>(1);\r\n\r\n\t#extensions = new UmbArrayState<ManifestBase>([], (e) => e.alias);\r\n\r\n\t#migrations = new UmbArrayState<PackageMigrationStatusResponseModel>([], (e) => e.packageName);\r\n\r\n\tconfiguration = this.#configuration.asObservable();\r\n\r\n\t/**\r\n\t * Observable of packages with extensions\r\n\t */\r\n\trootItems = this.#packages.asObservable();\r\n\r\n\textensions = this.#extensions.asObservable();\r\n\r\n\tmigrations = this.#migrations.asObservable();\r\n\r\n\tisPackagesLoaded = false;\r\n\r\n\t/**\r\n\t * Creates an instance of PackageStore.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof PackageStore\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\t// TODO: revisit this store. Is it ok to have multiple data sets?\r\n\t\t// temp hack to satisfy the base class\r\n\t\tsuper(host, UMB_PACKAGE_STORE_TOKEN.toString(), new UmbArrayState<UmbPackage>([], (x) => x.name));\r\n\t}\r\n\r\n\t/**\r\n\t * Append items to the store\r\n\t * @param packages\r\n\t */\r\n\toverride appendItems(packages: Array<UmbPackage>) {\r\n\t\tthis.#packages.next(packages);\r\n\t\tthis.isPackagesLoaded = true;\r\n\t}\r\n\r\n\tappendExtensions(extensions: ManifestBase[]) {\r\n\t\tthis.#extensions.append(extensions);\r\n\t}\r\n\r\n\tappendMigrations(migrations: PackageMigrationStatusResponseModel[]) {\r\n\t\tthis.#migrations.append(migrations);\r\n\t}\r\n\r\n\tsetConfiguration(configuration: PackageConfigurationResponseModel) {\r\n\t\tthis.#configuration.setValue(configuration);\r\n\t}\r\n}\r\n\r\nexport default UmbPackageStore;\r\n"],"names":["UmbPackageStore","UmbStoreBase","host","UMB_PACKAGE_STORE_TOKEN","UmbArrayState","x","#configuration","UmbObjectState","#packages","ReplaySubject","#extensions","e","#migrations","packages","extensions","migrations","configuration"],"mappings":";;;;AAgBO,MAAMA,UAAwBC,EAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgCjD,YAAYC,GAAyB;AAGpC,UAAMA,GAAMC,EAAwB,YAAY,IAAIC,EAA0B,CAAA,GAAI,CAACC,MAAMA,EAAE,IAAI,CAAC,GAlCjG,KAAAC,KAAiB,IAAIC,EAAkD,EAAE,gBAAgB,IAAI,GAO7F,KAAAC,KAAY,IAAIC,EAAiC,CAAC,GAElD,KAAAC,KAAc,IAAIN,EAA4B,CAAA,GAAI,CAACO,MAAMA,EAAE,KAAK,GAEhE,KAAAC,KAAc,IAAIR,EAAmD,CAAA,GAAI,CAACO,MAAMA,EAAE,WAAW,GAE7F,KAAA,gBAAgB,KAAKL,GAAe,aAAA,GAKpC,KAAA,YAAY,KAAKE,GAAU,aAAA,GAE3B,KAAA,aAAa,KAAKE,GAAY,aAAA,GAE9B,KAAA,aAAa,KAAKE,GAAY,aAAA,GAE9B,KAAA,mBAAmB;AAAA,EAWnB;AAAA,EAnCAN;AAAA,EAOAE;AAAA,EAEAE;AAAA,EAEAE;AAAA;AAAA;AAAA;AAAA;AAAA,EA8BS,YAAYC,GAA6B;AACjD,SAAKL,GAAU,KAAKK,CAAQ,GAC5B,KAAK,mBAAmB;AAAA,EACzB;AAAA,EAEA,iBAAiBC,GAA4B;AAC5C,SAAKJ,GAAY,OAAOI,CAAU;AAAA,EACnC;AAAA,EAEA,iBAAiBC,GAAmD;AACnE,SAAKH,GAAY,OAAOG,CAAU;AAAA,EACnC;AAAA,EAEA,iBAAiBC,GAAkD;AAClE,SAAKV,GAAe,SAASU,CAAa;AAAA,EAC3C;AACD;"}