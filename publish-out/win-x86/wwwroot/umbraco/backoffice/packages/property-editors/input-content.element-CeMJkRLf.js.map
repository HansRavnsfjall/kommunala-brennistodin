{"version":3,"file":"input-content.element-CeMJkRLf.js","sources":["../../../src/packages/property-editors/content-picker/components/input-content/input-content.element.ts"],"sourcesContent":["import type { UmbContentPickerSource } from '../../types.js';\r\nimport { css, customElement, html, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { splitStringToArray } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbInteractionMemoriesChangeEvent } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbInteractionMemoryModel } from '@umbraco-cms/backoffice/interaction-memory';\r\nimport type { UmbReferenceByUniqueAndType } from '@umbraco-cms/backoffice/models';\r\nimport type { UmbTreeStartNode } from '@umbraco-cms/backoffice/tree';\r\n\r\n@customElement('umb-input-content')\r\nexport class UmbInputContentElement extends UmbFormControlMixin<string | undefined, typeof UmbLitElement>(\r\n\tUmbLitElement,\r\n) {\r\n\t@property()\r\n\tpublic set type(newType: UmbContentPickerSource['type']) {\r\n\t\tconst oldType = this.#type;\r\n\t\tif (newType?.toLowerCase() !== this.#type) {\r\n\t\t\tthis.#type = newType?.toLowerCase() as UmbContentPickerSource['type'];\r\n\t\t\tthis.requestUpdate('type', oldType);\r\n\t\t}\r\n\t}\r\n\tpublic get type(): UmbContentPickerSource['type'] {\r\n\t\treturn this.#type;\r\n\t}\r\n\t#type: UmbContentPickerSource['type'] = 'content';\r\n\r\n\t@property({ type: Number })\r\n\tmin = 0;\r\n\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tminMessage = 'This field need more items';\r\n\r\n\t@property({ type: Number })\r\n\tmax = 0;\r\n\r\n\t@property({ type: String, attribute: 'max-message' })\r\n\tmaxMessage = 'This field exceeds the allowed amount of items';\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tstartNode?: UmbTreeStartNode;\r\n\r\n\t@property()\r\n\tpublic set allowedContentTypeIds(value: string) {\r\n\t\tthis.#allowedContentTypeIds = value ? value.split(',') : [];\r\n\t}\r\n\tpublic get allowedContentTypeIds(): string {\r\n\t\treturn this.#allowedContentTypeIds.join(',');\r\n\t}\r\n\t#allowedContentTypeIds: Array<string> = [];\r\n\r\n\t@property({ type: Array })\r\n\tpublic set selection(values: Array<UmbReferenceByUniqueAndType>) {\r\n\t\tthis.#selection = values?.map((item) => item.unique) ?? [];\r\n\t}\r\n\tpublic get selection(): Array<UmbReferenceByUniqueAndType> {\r\n\t\treturn this.#selection.map((id) => ({ type: this.#entityTypeLookup[this.#type], unique: id }));\r\n\t}\r\n\r\n\t@property({ type: String })\r\n\tpublic override set value(selectionString: string | undefined) {\r\n\t\tthis.#selection = splitStringToArray(selectionString);\r\n\t\tsuper.value = selectionString; // Call the parent setter to ensure the value change is triggered in the FormControlMixin. [NL]\r\n\t}\r\n\tpublic override get value(): string | undefined {\r\n\t\treturn this.#selection.length > 0 ? this.#selection.join(',') : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default false\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\tpublic readonly = false;\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tpublic get interactionMemories(): Array<UmbInteractionMemoryModel> | undefined {\r\n\t\treturn this.#interactionMemories;\r\n\t}\r\n\tpublic set interactionMemories(value: Array<UmbInteractionMemoryModel> | undefined) {\r\n\t\tthis.#interactionMemories = value;\r\n\t}\r\n\r\n\t#interactionMemories: Array<UmbInteractionMemoryModel> | undefined;\r\n\r\n\t#entityTypeLookup = { content: 'document', media: 'media', member: 'member' };\r\n\r\n\t#selection: Array<string> = [];\r\n\r\n\toverride firstUpdated() {\r\n\t\tthis.addFormControlElement(this.shadowRoot!.querySelector(`umb-input-${this.#entityTypeLookup[this.#type]}`)!);\r\n\t}\r\n\r\n\t#onChange(event: CustomEvent & { target: { selection: string[] | undefined } }) {\r\n\t\tthis.#selection = event.target.selection ?? [];\r\n\t\tthis.value = this.#selection.join(',');\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#onInteractionMemoriesChange(event: UmbInteractionMemoriesChangeEvent) {\r\n\t\tevent.stopPropagation();\r\n\t\tconst target = event.target as UmbInputContentElement;\r\n\t\tconst interactionMemories = target.interactionMemories;\r\n\t\tthis.#interactionMemories = interactionMemories;\r\n\t\t// The event is not composed so we need to re-dispatch it from this component.\r\n\t\tthis.dispatchEvent(new UmbInteractionMemoriesChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tswitch (this.#type) {\r\n\t\t\tcase 'content':\r\n\t\t\t\treturn this.#renderDocumentPicker();\r\n\t\t\tcase 'media':\r\n\t\t\t\treturn this.#renderMediaPicker();\r\n\t\t\tcase 'member':\r\n\t\t\t\treturn this.#renderMemberPicker();\r\n\t\t\tdefault:\r\n\t\t\t\treturn html`<p>Type could not be found.</p>`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderDocumentPicker() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-document\r\n\t\t\t\t.selection=${this.#selection}\r\n\t\t\t\t.startNode=${this.startNode}\r\n\t\t\t\t.allowedContentTypeIds=${this.#allowedContentTypeIds}\r\n\t\t\t\t.min=${this.min}\r\n\t\t\t\t.minMessage=${this.minMessage}\r\n\t\t\t\t.max=${this.max}\r\n\t\t\t\t.maxMessage=${this.maxMessage}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t@change=${this.#onChange}\r\n\t\t\t\t.interactionMemories=${this.#interactionMemories}\r\n\t\t\t\t@interaction-memories-change=${this.#onInteractionMemoriesChange}></umb-input-document>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMediaPicker() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-media\r\n\t\t\t\t.selection=${this.#selection}\r\n\t\t\t\t.allowedContentTypeIds=${this.#allowedContentTypeIds}\r\n\t\t\t\t.min=${this.min}\r\n\t\t\t\t.minMessage=${this.minMessage}\r\n\t\t\t\t.max=${this.max}\r\n\t\t\t\t.maxMessage=${this.maxMessage}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t@change=${this.#onChange}\r\n\t\t\t\t.interactionMemories=${this.#interactionMemories}\r\n\t\t\t\t@interaction-memories-change=${this.#onInteractionMemoriesChange}></umb-input-media>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMemberPicker() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-member\r\n\t\t\t\t.selection=${this.#selection}\r\n\t\t\t\t.allowedContentTypeIds=${this.#allowedContentTypeIds}\r\n\t\t\t\t.min=${this.min}\r\n\t\t\t\t.minMessage=${this.minMessage}\r\n\t\t\t\t.max=${this.max}\r\n\t\t\t\t.maxMessage=${this.maxMessage}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t@change=${this.#onChange}></umb-input-member>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tp {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tcolor: var(--uui-color-border-emphasis);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbInputContentElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-content': UmbInputContentElement;\r\n\t}\r\n}\r\n"],"names":["_type","_allowedContentTypeIds","_interactionMemories","_entityTypeLookup","_selection","_UmbInputContentElement_instances","onChange_fn","onInteractionMemoriesChange_fn","renderDocumentPicker_fn","renderMediaPicker_fn","renderMemberPicker_fn","UmbInputContentElement","UmbFormControlMixin","UmbLitElement","__privateAdd","newType","oldType","__privateGet","__privateSet","value","values","item","id","selectionString","splitStringToArray","__privateMethod","html","event","UmbChangeEvent","interactionMemories","UmbInteractionMemoriesChangeEvent","css","__decorateClass","property","customElement"],"mappings":"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"}