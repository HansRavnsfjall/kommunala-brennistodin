{"version":3,"file":"property-editor-ui-checkbox-list.element-DedWJKlk.js","sources":["../../../src/packages/property-editors/checkbox-list/property-editor-ui-checkbox-list.element.ts"],"sourcesContent":["import { ensureArray, updateItemsSelectedState } from '../utils/property-editor-ui-state-manager.js';\r\nimport './components/input-checkbox-list/input-checkbox-list.element.js';\r\nimport type {\r\n\tUmbCheckboxListItem,\r\n\tUmbInputCheckboxListElement,\r\n} from './components/input-checkbox-list/input-checkbox-list.element.js';\r\nimport { customElement, html, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_VALIDATION_EMPTY_LOCALIZATION_KEY, UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport type {\r\n\tUmbPropertyEditorConfigCollection,\r\n\tUmbPropertyEditorUiElement,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\n\r\n/**\r\n * @element umb-property-editor-ui-checkbox-list\r\n */\r\n@customElement('umb-property-editor-ui-checkbox-list')\r\nexport class UmbPropertyEditorUICheckboxListElement\r\n\textends UmbFormControlMixin<Array<string> | string | undefined, typeof UmbLitElement, undefined>(\r\n\t\tUmbLitElement,\r\n\t\tundefined,\r\n\t)\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#selection: Array<string> = [];\r\n\r\n\t@property({ type: Array })\r\n\tpublic override set value(value: Array<string> | string | undefined) {\r\n\t\tthis.#selection = ensureArray(value);\r\n\t\t// Update the checked state of existing list items when value changes\r\n\t\tthis.#updateCheckedState();\r\n\t}\r\n\r\n\tpublic override get value(): Array<string> | undefined {\r\n\t\treturn this.#selection;\r\n\t}\r\n\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tif (!config) return;\r\n\r\n\t\tconst items = config.getValueByAlias('items');\r\n\r\n\t\tif (Array.isArray(items) && items.length) {\r\n\t\t\tthis._list =\r\n\t\t\t\ttypeof items[0] === 'string'\r\n\t\t\t\t\t? items.map((item) => ({ label: item, value: item, checked: this.#selection.includes(item) }))\r\n\t\t\t\t\t: items.map((item) => ({\r\n\t\t\t\t\t\t\tlabel: item.name,\r\n\t\t\t\t\t\t\tvalue: item.value,\r\n\t\t\t\t\t\t\tchecked: this.#selection.includes(item.value),\r\n\t\t\t\t\t\t}));\r\n\r\n\t\t\t// If selection includes a value that is not in the list, add it to the list\r\n\t\t\tthis.#selection.forEach((value) => {\r\n\t\t\t\tif (!this._list.find((item) => item.value === value)) {\r\n\t\t\t\t\tthis._list.push({ label: value, value, checked: true, invalid: true });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default false\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\treadonly = false;\r\n\r\n\t/**\r\n\t * Sets the input to mandatory, meaning validation will fail if the value is empty.\r\n\t * @type {boolean}\r\n\t */\r\n\t@property({ type: Boolean })\r\n\tmandatory?: boolean;\r\n\r\n\t@property({ type: String })\r\n\tmandatoryMessage = UMB_VALIDATION_EMPTY_LOCALIZATION_KEY;\r\n\r\n\t@state()\r\n\tprivate _list: Array<UmbCheckboxListItem> = [];\r\n\r\n\tprotected override firstUpdated() {\r\n\t\tthis.addFormControlElement(this.shadowRoot!.querySelector('umb-input-checkbox-list')!);\r\n\t}\r\n\r\n\t#onChange(event: CustomEvent & { target: UmbInputCheckboxListElement }) {\r\n\t\tthis.value = event.target.selection;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the checked state of all list items based on current selection.\r\n\t * This fixes the issue where UI doesn't update when values are set programmatically.\r\n\t */\r\n\t#updateCheckedState() {\r\n\t\t// Only update if we have list items loaded\r\n\t\tif (this._list.length > 0) {\r\n\t\t\t// Update state only if changes are needed\r\n\t\t\tconst updatedList = updateItemsSelectedState(this._list, this.#selection, 'checked');\r\n\t\t\tif (updatedList !== this._list) {\r\n\t\t\t\tthis._list = updatedList;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-checkbox-list\r\n\t\t\t\t.list=${this._list}\r\n\t\t\t\t.required=${this.mandatory}\r\n\t\t\t\t.requiredMessage=${this.mandatoryMessage}\r\n\t\t\t\t.selection=${this.#selection}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t@change=${this.#onChange}>\r\n\t\t\t</umb-input-checkbox-list>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport default UmbPropertyEditorUICheckboxListElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-checkbox-list': UmbPropertyEditorUICheckboxListElement;\r\n\t}\r\n}\r\n"],"names":["_selection","_UmbPropertyEditorUICheckboxListElement_instances","onChange_fn","updateCheckedState_fn","UmbPropertyEditorUICheckboxListElement","UmbFormControlMixin","UmbLitElement","__privateAdd","UMB_VALIDATION_EMPTY_LOCALIZATION_KEY","value","__privateSet","ensureArray","__privateMethod","__privateGet","config","items","item","html","event","UmbChangeEvent","updatedList","updateItemsSelectedState","__decorateClass","property","state","customElement","UmbPropertyEditorUICheckboxListElement$1"],"mappings":"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"}