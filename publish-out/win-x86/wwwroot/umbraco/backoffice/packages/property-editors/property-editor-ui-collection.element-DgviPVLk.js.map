{"version":3,"file":"property-editor-ui-collection.element-DgviPVLk.js","sources":["../../../src/packages/property-editors/collection/property-editor-ui-collection.element.ts"],"sourcesContent":["import type {\r\n\tUmbPropertyEditorConfigCollection,\r\n\tUmbPropertyEditorUiElement,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\nimport { customElement, html, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_DOCUMENT_COLLECTION_ALIAS } from '@umbraco-cms/backoffice/document';\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport { UMB_CONTENT_COLLECTION_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport type { UmbCollectionConfiguration } from '@umbraco-cms/backoffice/collection';\r\n\r\n/**\r\n * @element umb-property-editor-ui-collection\r\n */\r\n@customElement('umb-property-editor-ui-collection')\r\nexport class UmbPropertyEditorUICollectionElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t#workspaceContext?: typeof UMB_CONTENT_COLLECTION_WORKSPACE_CONTEXT.TYPE;\r\n\t#propertyContext?: typeof UMB_PROPERTY_CONTEXT.TYPE;\r\n\r\n\t@property()\r\n\tvalue?: string;\r\n\r\n\t@state()\r\n\tprivate _collectionAlias: string = UMB_DOCUMENT_COLLECTION_ALIAS;\r\n\r\n\t@state()\r\n\tprivate _config?: UmbCollectionConfiguration;\r\n\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tthis._config = this.#mapDataTypeConfigToCollectionConfig(config);\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_COLLECTION_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.#workspaceContext = workspaceContext;\r\n\t\t\tthis._collectionAlias = workspaceContext?.collection.getCollectionAlias() ?? UMB_DOCUMENT_COLLECTION_ALIAS;\r\n\t\t\tthis.#gotContexts();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (propertyContext) => {\r\n\t\t\tthis.#propertyContext = propertyContext;\r\n\t\t\tthis.#gotContexts();\r\n\t\t});\r\n\t}\r\n\r\n\t#gotContexts() {\r\n\t\tif (!this.#workspaceContext || !this.#propertyContext) return;\r\n\r\n\t\tthis.observe(this.#propertyContext?.alias, async (propertyAlias) => {\r\n\t\t\tif (this.#workspaceContext && propertyAlias) {\r\n\t\t\t\t// Gets the Data Type ID for the current property.\r\n\t\t\t\tconst property = await this.#workspaceContext.structure.getPropertyStructureByAlias(propertyAlias);\r\n\t\t\t\tif (!this.#workspaceContext) {\r\n\t\t\t\t\t// We got destroyed in the meantime.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst unique = this.#workspaceContext.getUnique();\r\n\t\t\t\tif (unique && property && this._config) {\r\n\t\t\t\t\t// TODO: Handle case where config might not be set when this executes during initialization, its not likely but it is fragile to assume this. [NL]\r\n\t\t\t\t\tthis._config.unique = unique;\r\n\t\t\t\t\tthis._config.dataTypeId = property.dataType.unique;\r\n\t\t\t\t\tthis.requestUpdate('_config');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t#mapDataTypeConfigToCollectionConfig(\r\n\t\tconfig: UmbPropertyEditorConfigCollection | undefined,\r\n\t): UmbCollectionConfiguration {\r\n\t\tconst pageSize = Number(config?.getValueByAlias('pageSize'));\r\n\t\treturn {\r\n\t\t\tlayouts: config?.getValueByAlias('layouts'),\r\n\t\t\torderBy: config?.getValueByAlias('orderBy') ?? 'updateDate',\r\n\t\t\torderDirection: config?.getValueByAlias('orderDirection') ?? 'asc',\r\n\t\t\tpageSize: isNaN(pageSize) ? 50 : pageSize,\r\n\t\t\tuserDefinedProperties: config?.getValueByAlias('includeProperties'),\r\n\t\t};\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._config?.unique || !this._config?.dataTypeId) return html`<uui-loader></uui-loader>`;\r\n\t\treturn html`<umb-collection .alias=${this._collectionAlias} .config=${this._config}></umb-collection>`;\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tsuper.destroy();\r\n\t\tthis.#workspaceContext = undefined;\r\n\t\tthis.#propertyContext = undefined;\r\n\t}\r\n}\r\n\r\nexport default UmbPropertyEditorUICollectionElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-collection': UmbPropertyEditorUICollectionElement;\r\n\t}\r\n}\r\n"],"names":["_workspaceContext","_propertyContext","_UmbPropertyEditorUICollectionElement_instances","gotContexts_fn","mapDataTypeConfigToCollectionConfig_fn","UmbPropertyEditorUICollectionElement","UmbLitElement","__privateAdd","UMB_DOCUMENT_COLLECTION_ALIAS","UMB_CONTENT_COLLECTION_WORKSPACE_CONTEXT","workspaceContext","__privateSet","__privateMethod","UMB_PROPERTY_CONTEXT","propertyContext","config","html","__privateGet","propertyAlias","property","unique","pageSize","__decorateClass","state","customElement","UmbPropertyEditorUICollectionElement$1"],"mappings":";;;;;;;;;;;wXAAAA,GAAAC,GAAAC,GAAAC,GAAAC;AAeO,IAAMC,IAAN,cAAmDC,EAAoD;AAAA,EAiB7G,cAAc;AACb,UAAA,GAlBKC,EAAA,MAAAL,CAAA,GACNK,EAAA,MAAAP,CAAA,GACAO,EAAA,MAAAN,CAAA,GAMA,KAAQ,mBAA2BO,GAYlC,KAAK,eAAeC,GAA0C,CAACC,MAAqB;AACnF,MAAAC,EAAA,MAAKX,GAAoBU,CAAA,GACzB,KAAK,mBAAmBA,GAAkB,WAAW,mBAAA,KAAwBF,GAC7EI,EAAA,MAAKV,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,IACD,CAAC,GAED,KAAK,eAAeU,GAAsB,CAACC,MAAoB;AAC9D,MAAAH,EAAA,MAAKV,GAAmBa,CAAA,GACxBF,EAAA,MAAKV,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAjBA,IAAW,OAAOY,GAAuD;AACxE,SAAK,UAAUH,EAAA,MAAKV,GAAAE,CAAA,EAAL,KAAA,MAA0CW,CAAA;AAAA,EAC1D;AAAA,EAqDS,SAAS;AACjB,WAAI,CAAC,KAAK,SAAS,UAAU,CAAC,KAAK,SAAS,aAAmBC,+BACxDA,2BAA8B,KAAK,gBAAgB,YAAY,KAAK,OAAO;AAAA,EACnF;AAAA,EAES,UAAgB;AACxB,UAAM,QAAA,GACNL,EAAA,MAAKX,GAAoB,MAAA,GACzBW,EAAA,MAAKV,GAAmB,MAAA;AAAA,EACzB;AACD;AA7ECD,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAFMC,IAAA,oBAAA,QAAA;AAgCNC,IAAY,WAAG;AACd,EAAI,CAACc,EAAA,MAAKjB,CAAA,KAAqB,CAACiB,QAAKhB,CAAA,KAErC,KAAK,QAAQgB,EAAA,MAAKhB,CAAA,GAAkB,OAAO,OAAOiB,MAAkB;AACnE,QAAID,EAAA,MAAKjB,MAAqBkB,GAAe;AAE5C,YAAMC,IAAW,MAAMF,EAAA,MAAKjB,CAAA,EAAkB,UAAU,4BAA4BkB,CAAa;AACjG,UAAI,CAACD,QAAKjB,CAAA;AAET;AAGD,YAAMoB,IAASH,EAAA,MAAKjB,CAAA,EAAkB,UAAA;AACtC,MAAIoB,KAAUD,KAAY,KAAK,YAE9B,KAAK,QAAQ,SAASC,GACtB,KAAK,QAAQ,aAAaD,EAAS,SAAS,QAC5C,KAAK,cAAc,SAAS;AAAA,IAE9B;AAAA,EACD,CAAC;AACF;AAEAf,IAAoC,SACnCW,GAC6B;AAC7B,QAAMM,IAAW,OAAON,GAAQ,gBAAgB,UAAU,CAAC;AAC3D,SAAO;AAAA,IACN,SAASA,GAAQ,gBAAgB,SAAS;AAAA,IAC1C,SAASA,GAAQ,gBAAgB,SAAS,KAAK;AAAA,IAC/C,gBAAgBA,GAAQ,gBAAgB,gBAAgB,KAAK;AAAA,IAC7D,UAAU,MAAMM,CAAQ,IAAI,KAAKA;AAAA,IACjC,uBAAuBN,GAAQ,gBAAgB,mBAAmB;AAAA,EAAA;AAEpE;AA7DAO,EAAA;AAAA,EADCH,EAAA;AAAS,GAJEd,EAKZ,WAAA,SAAA,CAAA;AAGQiB,EAAA;AAAA,EADPC,EAAA;AAAM,GAPKlB,EAQJ,WAAA,oBAAA,CAAA;AAGAiB,EAAA;AAAA,EADPC,EAAA;AAAM,GAVKlB,EAWJ,WAAA,WAAA,CAAA;AAXIA,IAANiB,EAAA;AAAA,EADNE,EAAc,mCAAmC;AAAA,GACrCnB,CAAA;AAgFb,MAAAoB,IAAepB;"}