{"version":3,"file":"property-editor-ui-dropdown.element-h4INXq3a.js","sources":["../../../src/packages/property-editors/dropdown/property-editor-ui-dropdown.element.ts"],"sourcesContent":["import { ensureArray, updateItemsSelectedState } from '../utils/property-editor-ui-state-manager.js';\r\nimport { css, customElement, html, map, nothing, property, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_VALIDATION_EMPTY_LOCALIZATION_KEY, UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport { UUISelectElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport type {\r\n\tUmbPropertyEditorConfigCollection,\r\n\tUmbPropertyEditorUiElement,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\nimport type { UmbInputDropdownListElement } from '@umbraco-cms/backoffice/components';\r\n\r\n/**\r\n * @element umb-property-editor-ui-dropdown\r\n */\r\n@customElement('umb-property-editor-ui-dropdown')\r\nexport class UmbPropertyEditorUIDropdownElement\r\n\textends UmbFormControlMixin<Array<string> | string | undefined, typeof UmbLitElement, undefined>(\r\n\t\tUmbLitElement,\r\n\t\tundefined,\r\n\t)\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#selection: Array<string> = [];\r\n\r\n\t@state()\r\n\tprivate _multiple: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _options: Array<Option & { invalid?: boolean }> = [];\r\n\r\n\t@property({ type: Array })\r\n\tpublic override set value(value: Array<string> | string | undefined) {\r\n\t\tthis.#selection = ensureArray(value);\r\n\t\t// Update the selected state of existing options when value changes\r\n\t\tthis.#updateSelectedState();\r\n\t}\r\n\tpublic override get value(): Array<string> | undefined {\r\n\t\treturn this.#selection;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default false\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\treadonly = false;\r\n\r\n\t/**\r\n\t * Sets the input to mandatory, meaning validation will fail if the value is empty.\r\n\t * @type {boolean}\r\n\t */\r\n\t@property({ type: Boolean })\r\n\tmandatory?: boolean;\r\n\r\n\t@property({ type: String })\r\n\tmandatoryMessage = UMB_VALIDATION_EMPTY_LOCALIZATION_KEY;\r\n\r\n\t@property({ type: String })\r\n\tname?: string;\r\n\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tif (!config) return;\r\n\r\n\t\tconst items = config.getValueByAlias('items');\r\n\r\n\t\tif (Array.isArray(items) && items.length > 0) {\r\n\t\t\tthis._options =\r\n\t\t\t\ttypeof items[0] === 'string'\r\n\t\t\t\t\t? items.map((item) => ({ name: item, value: item, selected: this.#selection.includes(item) }))\r\n\t\t\t\t\t: items.map((item) => ({\r\n\t\t\t\t\t\t\tname: item.name,\r\n\t\t\t\t\t\t\tvalue: item.value,\r\n\t\t\t\t\t\t\tselected: this.#selection.includes(item.value),\r\n\t\t\t\t\t\t}));\r\n\r\n\t\t\t// If selection includes a value that is not in the list, add it to the list\r\n\t\t\tthis.#selection.forEach((value) => {\r\n\t\t\t\tif (value !== '' && !this._options.find((item) => item.value === value)) {\r\n\t\t\t\t\tthis._options.push({\r\n\t\t\t\t\t\tname: `${value} (${this.localize.term('validation_legacyOption')})`,\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\tselected: true,\r\n\t\t\t\t\t\tinvalid: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._multiple = config.getValueByAlias<boolean>('multiple') ?? false;\r\n\t}\r\n\r\n\tprotected override firstUpdated() {\r\n\t\tif (this._multiple) {\r\n\t\t\tthis.addFormControlElement(this.shadowRoot!.querySelector('select')!);\r\n\t\t} else {\r\n\t\t\tthis.addFormControlElement(this.shadowRoot!.querySelector('umb-input-dropdown-list')!);\r\n\t\t}\r\n\r\n\t\tif (!this.mandatory && !this._multiple) {\r\n\t\t\tthis._options.unshift({ name: '', value: '', selected: false, invalid: false });\r\n\t\t}\r\n\t}\r\n\r\n\t#onChange(event: CustomEvent & { target: UmbInputDropdownListElement }) {\r\n\t\tconst value = event.target.value as string;\r\n\t\tthis.#setValue(value ? [value] : []);\r\n\t}\r\n\r\n\t#onChangeMultiple(event: Event & { target: HTMLSelectElement }) {\r\n\t\tconst selected = event.target.selectedOptions;\r\n\t\tconst value = selected ? Array.from(selected).map((option) => option.value) : [];\r\n\t\tthis.#setValue(value);\r\n\t}\r\n\r\n\t#setValue(value: Array<string> | string | null | undefined) {\r\n\t\tif (!value) return;\r\n\t\tconst selection = ensureArray(value);\r\n\t\tthis._options.forEach((item) => (item.selected = selection.includes(item.value)));\r\n\t\tthis.value = value;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the selected state of all options based on current selection.\r\n\t * This fixes the issue where UI doesn't update when values are set programmatically.\r\n\t */\r\n\t#updateSelectedState() {\r\n\t\t// Only update if we have options loaded\r\n\t\tif (this._options.length > 0) {\r\n\t\t\t// Update state only if changes are needed\r\n\t\t\tconst updatedOptions = updateItemsSelectedState(this._options, this.#selection, 'selected');\r\n\t\t\tif (updatedOptions !== this._options) {\r\n\t\t\t\tthis._options = updatedOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis._multiple,\r\n\t\t\t\t() => this.#renderDropdownMultiple(),\r\n\t\t\t\t() => this.#renderDropdownSingle(),\r\n\t\t\t)}\r\n\t\t\t${this.#renderDropdownValidation()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdownMultiple() {\r\n\t\tif (this.readonly) {\r\n\t\t\treturn html`<div>${this.value?.join(', ')}</div>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<select id=\"native\" multiple ?required=${this.mandatory} @change=${this.#onChangeMultiple}>\r\n\t\t\t\t${map(\r\n\t\t\t\t\tthis._options,\r\n\t\t\t\t\t(item) => html`<option value=${item.value} ?selected=${item.selected}>${item.name}</option>`,\r\n\t\t\t\t)}\r\n\t\t\t</select>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdownSingle() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-dropdown-list\r\n\t\t\t\t.name=${this.name}\r\n\t\t\t\t.options=${this._options}\r\n\t\t\t\t.required=${this.mandatory}\r\n\t\t\t\t.requiredMessage=${this.mandatoryMessage}\r\n\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t@change=${this.#onChange}>\r\n\t\t\t</umb-input-dropdown-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdownValidation() {\r\n\t\tconst selectionHasInvalids = this.#selection.some((value) => {\r\n\t\t\tconst option = this._options.find((item) => item.value === value);\r\n\t\t\treturn option ? option.invalid : false;\r\n\t\t});\r\n\r\n\t\tif (selectionHasInvalids) {\r\n\t\t\treturn html`<div class=\"error\"><umb-localize key=\"validation_legacyOptionDescription\"></umb-localize></div>`;\r\n\t\t}\r\n\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUUISelectElement.styles,\r\n\t\tcss`\r\n\t\t\t#native {\r\n\t\t\t\theight: auto;\r\n\t\t\t}\r\n\r\n\t\t\t.error {\r\n\t\t\t\tcolor: var(--uui-color-invalid);\r\n\t\t\t\tfont-size: var(--uui-font-size-small);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbPropertyEditorUIDropdownElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-dropdown': UmbPropertyEditorUIDropdownElement;\r\n\t}\r\n}\r\n"],"names":["_selection","_UmbPropertyEditorUIDropdownElement_instances","onChange_fn","onChangeMultiple_fn","setValue_fn","updateSelectedState_fn","renderDropdownMultiple_fn","renderDropdownSingle_fn","renderDropdownValidation_fn","UmbPropertyEditorUIDropdownElement","UmbFormControlMixin","UmbLitElement","__privateAdd","UMB_VALIDATION_EMPTY_LOCALIZATION_KEY","value","__privateSet","ensureArray","__privateMethod","__privateGet","config","items","item","html","when","event","selected","option","selection","UmbChangeEvent","updatedOptions","updateItemsSelectedState","map","nothing","UUISelectElement","css","__decorateClass","state","property","customElement","UmbPropertyEditorUIDropdownElement$1"],"mappings":"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"}