{"version":3,"file":"entity-references-workspace-view-info.element-DQnUvFuy.js","sources":["../../../src/packages/relations/relations/reference/workspace-info-app/entity-references-workspace-view-info.element.ts"],"sourcesContent":["import type { UmbEntityReferenceRepository, UmbReferenceItemModel } from '../types.js';\r\nimport type { ManifestWorkspaceInfoAppEntityReferencesKind } from './types.js';\r\nimport { css, customElement, html, nothing, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UUIPaginationEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport { UMB_ENTITY_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/workspace';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\n\r\n@customElement('umb-entity-references-workspace-info-app')\r\nexport class UmbEntityReferencesWorkspaceInfoAppElement extends UmbLitElement {\r\n\t@property({ type: Object })\r\n\tprivate _manifest?: ManifestWorkspaceInfoAppEntityReferencesKind | undefined;\r\n\tpublic get manifest(): ManifestWorkspaceInfoAppEntityReferencesKind | undefined {\r\n\t\treturn this._manifest;\r\n\t}\r\n\tpublic set manifest(value: ManifestWorkspaceInfoAppEntityReferencesKind | undefined) {\r\n\t\tthis._manifest = value;\r\n\t\tthis.#init();\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _currentPage = 1;\r\n\r\n\t@state()\r\n\tprivate _total = 0;\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbReferenceItemModel> = [];\r\n\r\n\t#itemsPerPage = 10;\r\n\t#referenceRepository?: UmbEntityReferenceRepository;\r\n\t#unique?: UmbEntityUnique;\r\n\t#workspaceContext?: typeof UMB_ENTITY_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_ENTITY_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#workspaceContext = context;\r\n\t\t\tthis.#observeUnique();\r\n\t\t});\r\n\t}\r\n\r\n\tasync #init() {\r\n\t\tif (!this._manifest) return;\r\n\t\tconst referenceRepositoryAlias = this._manifest.meta.referenceRepositoryAlias;\r\n\r\n\t\tif (!referenceRepositoryAlias) {\r\n\t\t\tthrow new Error('Reference repository alias is required');\r\n\t\t}\r\n\r\n\t\tthis.#referenceRepository = await createExtensionApiByAlias<UmbEntityReferenceRepository>(\r\n\t\t\tthis,\r\n\t\t\treferenceRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tthis.#getReferences();\r\n\t}\r\n\r\n\t#observeUnique() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.unique,\r\n\t\t\t(unique) => {\r\n\t\t\t\tif (!unique) {\r\n\t\t\t\t\tthis.#unique = undefined;\r\n\t\t\t\t\tthis._items = [];\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.#unique === unique) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.#unique = unique;\r\n\t\t\t\tthis.#getReferences();\r\n\t\t\t},\r\n\t\t\t'umbEntityReferencesUniqueObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #getReferences() {\r\n\t\tif (!this.#unique) return;\r\n\t\tif (!this.#referenceRepository) return;\r\n\r\n\t\tconst { data } = await this.#referenceRepository.requestReferencedBy(\r\n\t\t\tthis.#unique,\r\n\t\t\t(this._currentPage - 1) * this.#itemsPerPage,\r\n\t\t\tthis.#itemsPerPage,\r\n\t\t);\r\n\t\tif (!data) return;\r\n\r\n\t\tthis._total = data.total;\r\n\t\tthis._items = data.items;\r\n\t}\r\n\r\n\t#onPageChange(event: UUIPaginationEvent) {\r\n\t\tif (this._currentPage === event.target.current) return;\r\n\t\tthis._currentPage = event.target.current;\r\n\r\n\t\tthis.#getReferences();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._items?.length) return nothing;\r\n\t\treturn html`\r\n\t\t\t<umb-workspace-info-app-layout headline=\"#references_labelUsedByItems\">\r\n\t\t\t\t<div id=\"content\">${this.#renderItems()} ${this.#renderReferencePagination()}</div>\r\n\t\t\t</umb-workspace-info-app-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => html`<umb-entity-item-ref .item=${item}></umb-entity-item-ref>`,\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderReferencePagination() {\r\n\t\tif (!this._total) return nothing;\r\n\r\n\t\tconst totalPages = Math.ceil(this._total / this.#itemsPerPage);\r\n\t\tif (totalPages <= 1) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"pagination-container\">\r\n\t\t\t\t<uui-pagination\r\n\t\t\t\t\t.total=${totalPages}\r\n\t\t\t\t\tfirstlabel=${this.localize.term('general_first')}\r\n\t\t\t\t\tpreviouslabel=${this.localize.term('general_previous')}\r\n\t\t\t\t\tnextlabel=${this.localize.term('general_next')}\r\n\t\t\t\t\tlastlabel=${this.localize.term('general_last')}\r\n\t\t\t\t\t@change=\"${this.#onPageChange}\"></uui-pagination>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: contents;\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-space-3) var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.pagination-container {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tmargin-top: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\tuui-pagination {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbEntityReferencesWorkspaceInfoAppElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-entity-references-workspace-info-app': UmbEntityReferencesWorkspaceInfoAppElement;\r\n\t}\r\n}\r\n"],"names":["_itemsPerPage","_referenceRepository","_unique","_workspaceContext","_UmbEntityReferencesWorkspaceInfoAppElement_instances","init_fn","observeUnique_fn","getReferences_fn","onPageChange_fn","renderItems_fn","renderReferencePagination_fn","UmbEntityReferencesWorkspaceInfoAppElement","UmbLitElement","__privateAdd","UMB_ENTITY_WORKSPACE_CONTEXT","context","__privateSet","__privateMethod","value","html","nothing","referenceRepositoryAlias","createExtensionApiByAlias","__privateGet","unique","data","event","repeat","item","totalPages","UmbTextStyles","css","__decorateClass","property","state","customElement"],"mappings":";;;;;;;;;;;wXAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAWO,IAAMC,IAAN,cAAyDC,EAAc;AAAA,EAyB7E,cAAc;AACb,UAAA,GA1BKC,EAAA,MAAAT,CAAA,GAYN,KAAQ,eAAe,GAGvB,KAAQ,SAAS,GAGjB,KAAQ,SAAwC,CAAA,GAEhDS,EAAA,MAAAb,GAAgB,EAAA,GAChBa,EAAA,MAAAZ,CAAA,GACAY,EAAA,MAAAX,CAAA,GACAW,EAAA,MAAAV,CAAA,GAKC,KAAK,eAAeW,GAA8B,CAACC,MAAY;AAC9D,MAAAC,EAAA,MAAKb,GAAoBY,CAAA,GACzBE,EAAA,MAAKb,GAAAE,CAAA,EAAL,KAAA,IAAA;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EA7BA,IAAW,WAAqE;AAC/E,WAAO,KAAK;AAAA,EACb;AAAA,EACA,IAAW,SAASY,GAAiE;AACpF,SAAK,YAAYA,GACjBD,EAAA,MAAKb,GAAAC,CAAA,EAAL,KAAA,IAAA;AAAA,EACD;AAAA,EAoFS,SAAS;AACjB,WAAK,KAAK,QAAQ,SACXc;AAAA;AAAA,wBAEeF,QAAKb,GAAAK,CAAA,EAAL,KAAA,IAAA,CAAmB,IAAIQ,EAAA,MAAKb,MAAL,KAAA,IAAA,CAAiC;AAAA;AAAA,MAH7CgB;AAAA,EAMlC;AA0DD;AA1ICpB,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAvBMC,IAAA,oBAAA,QAAA;AAkCAC,IAAK,iBAAG;AACb,MAAI,CAAC,KAAK,UAAW;AACrB,QAAMgB,IAA2B,KAAK,UAAU,KAAK;AAErD,MAAI,CAACA;AACJ,UAAM,IAAI,MAAM,wCAAwC;AAGzD,EAAAL,EAAA,MAAKf,GAAuB,MAAMqB;AAAA,IACjC;AAAA,IACAD;AAAA,EAAA,CACD,GAEAJ,EAAA,MAAKb,GAAAG,CAAA,EAAL,KAAA,IAAA;AACD;AAEAD,IAAc,WAAG;AAChB,OAAK;AAAA,IACJiB,QAAKpB,CAAA,GAAmB;AAAA,IACxB,CAACqB,MAAW;AACX,UAAI,CAACA,GAAQ;AACZ,QAAAR,EAAA,MAAKd,GAAU,MAAA,GACf,KAAK,SAAS,CAAA;AACd;AAAA,MACD;AAEA,MAAIqB,EAAA,MAAKrB,OAAYsB,MAIrBR,EAAA,MAAKd,GAAUsB,CAAA,GACfP,EAAA,MAAKb,GAAAG,CAAA,EAAL,KAAA,IAAA;AAAA,IACD;AAAA,IACA;AAAA,EAAA;AAEF;AAEMA,IAAc,iBAAG;AAEtB,MADI,CAACgB,QAAKrB,CAAA,KACN,CAACqB,QAAKtB,CAAA,EAAsB;AAEhC,QAAM,EAAE,MAAAwB,EAAA,IAAS,MAAMF,QAAKtB,CAAA,EAAqB;AAAA,IAChDsB,EAAA,MAAKrB,CAAA;AAAA,KACJ,KAAK,eAAe,KAAKqB,EAAA,MAAKvB,CAAA;AAAA,IAC/BuB,EAAA,MAAKvB,CAAA;AAAA,EAAA;AAEN,EAAKyB,MAEL,KAAK,SAASA,EAAK,OACnB,KAAK,SAASA,EAAK;AACpB;AAEAjB,IAAa,SAACkB,GAA2B;AACxC,EAAI,KAAK,iBAAiBA,EAAM,OAAO,YACvC,KAAK,eAAeA,EAAM,OAAO,SAEjCT,EAAA,MAAKb,GAAAG,CAAA,EAAL,KAAA,IAAA;AACD;AAWAE,IAAY,WAAG;AACd,MAAK,KAAK;AACV,WAAOU;AAAA;AAAA,MAEHQ;AAAA,MACD,KAAK;AAAA,MACL,CAACC,MAASA,EAAK;AAAA,MACf,CAACA,MAAST,+BAAkCS,CAAI;AAAA,IAAA,CAChD;AAAA;AAAA;AAGJ;AAEAlB,IAA0B,WAAG;AAC5B,MAAI,CAAC,KAAK,OAAQ,QAAOU;AAEzB,QAAMS,IAAa,KAAK,KAAK,KAAK,SAASN,QAAKvB,CAAA,CAAa;AAC7D,SAAI6B,KAAc,IAAUT,IAErBD;AAAA;AAAA;AAAA,cAGKU,CAAU;AAAA,kBACN,KAAK,SAAS,KAAK,eAAe,CAAC;AAAA,qBAChC,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA,iBAC1C,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA,iBAClC,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA,gBACnCZ,QAAKb,GAAAI,CAAA,CAAa;AAAA;AAAA;AAGjC;AApIYG,EAsII,SAAS;AAAA,EACxBmB;AAAA,EACAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBD;AA3JQC,EAAA;AAAA,EADPC,EAAS,EAAE,MAAM,OAAA,CAAQ;AAAA,GADdtB,EAEJ,WAAA,aAAA,CAAA;AAUAqB,EAAA;AAAA,EADPE,EAAA;AAAM,GAXKvB,EAYJ,WAAA,gBAAA,CAAA;AAGAqB,EAAA;AAAA,EADPE,EAAA;AAAM,GAdKvB,EAeJ,WAAA,UAAA,CAAA;AAGAqB,EAAA;AAAA,EADPE,EAAA;AAAM,GAjBKvB,EAkBJ,WAAA,UAAA,CAAA;AAlBIA,IAANqB,EAAA;AAAA,EADNG,EAAc,0CAA0C;AAAA,GAC5CxB,CAAA;"}