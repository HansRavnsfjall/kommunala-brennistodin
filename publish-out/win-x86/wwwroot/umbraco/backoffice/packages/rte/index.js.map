{"version":3,"file":"index.js","sources":["../../../src/packages/rte/components/rte-base.element.ts"],"sourcesContent":["import type { UmbPropertyEditorRteValueType } from '../types.js';\r\nimport { UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS } from '../constants.js';\r\nimport { jsonStringComparison, observeMultiple } from '@umbraco-cms/backoffice/observable-api';\r\nimport { property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbBlockRteEntriesContext, UmbBlockRteManagerContext } from '@umbraco-cms/backoffice/block-rte';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport {\r\n\tUmbFormControlMixin,\r\n\tUmbValidationContext,\r\n\tUMB_VALIDATION_EMPTY_LOCALIZATION_KEY,\r\n} from '@umbraco-cms/backoffice/validation';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport { UMB_PROPERTY_CONTEXT, UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { StyleInfo } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbBlockDataModel } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockRteLayoutModel, UmbBlockRteTypeModel } from '@umbraco-cms/backoffice/block-rte';\r\nimport type {\r\n\tUmbPropertyEditorUiElement,\r\n\tUmbPropertyEditorConfigCollection,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\n\r\n/**\r\n * The abstract base class that is used as a base for the rich-text-editor component.\r\n * @cssprop --umb-rte-width - The width of the rich-text-editor (default: unset)\r\n * @cssprop --umb-rte-min-width - The minimum width of the rich-text-editor (default: unset)\r\n * @cssprop --umb-rte-max-width - The maximum width of the rich-text-editor (default: 100%)\r\n * @cssprop --umb-rte-height - The height of the rich-text-editor (default: 100%)\r\n * @cssprop --umb-rte-min-height - The minimum height of the rich-text-editor (default: 100%)\r\n * @cssprop --umb-rte-max-height - The maximum height of the rich-text-editor (default: 100%)\r\n */\r\nexport abstract class UmbPropertyEditorUiRteElementBase\r\n\textends UmbFormControlMixin<UmbPropertyEditorRteValueType | undefined, typeof UmbLitElement, undefined>(UmbLitElement)\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\tpublic name?: string;\r\n\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tif (!config) return;\r\n\r\n\t\tthis._config = config;\r\n\r\n\t\tconst blocks = config.getValueByAlias<Array<UmbBlockRteTypeModel>>('blocks') ?? [];\r\n\t\tthis.#managerContext.setBlockTypes(blocks);\r\n\r\n\t\tthis.#managerContext.setEditorConfiguration(config);\r\n\r\n\t\tconst dimensions = config.getValueByAlias<{ width?: number; height?: number }>('dimensions');\r\n\t\tthis._css = {\r\n\t\t\t'--umb-rte-max-width': dimensions?.width ? `${dimensions.width}px` : '100%',\r\n\t\t\t'--umb-rte-height': dimensions?.height ? `${dimensions.height}px` : 'unset',\r\n\t\t};\r\n\t}\r\n\r\n\t@property({\r\n\t\tattribute: false,\r\n\t\ttype: Object,\r\n\t\thasChanged(value?: UmbPropertyEditorRteValueType, oldValue?: UmbPropertyEditorRteValueType) {\r\n\t\t\treturn value?.markup !== oldValue?.markup;\r\n\t\t},\r\n\t})\r\n\tpublic override set value(value: UmbPropertyEditorRteValueType | undefined) {\r\n\t\tif (!value) {\r\n\t\t\tsuper.value = undefined;\r\n\t\t\tthis._markup = '';\r\n\t\t\tthis.#managerContext.setLayouts([]);\r\n\t\t\tthis.#managerContext.setContents([]);\r\n\t\t\tthis.#managerContext.setSettings([]);\r\n\t\t\tthis.#managerContext.setExposes([]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst buildUpValue: Partial<UmbPropertyEditorRteValueType> = value ? { ...value } : {};\r\n\t\tbuildUpValue.markup ??= '';\r\n\t\tif (buildUpValue.blocks) {\r\n\t\t\tbuildUpValue.blocks = { ...buildUpValue.blocks };\r\n\t\t} else {\r\n\t\t\tbuildUpValue.blocks ??= { layout: {}, contentData: [], settingsData: [], expose: [] };\r\n\t\t}\r\n\t\tbuildUpValue.blocks.layout ??= {};\r\n\t\tbuildUpValue.blocks.contentData ??= [];\r\n\t\tbuildUpValue.blocks.settingsData ??= [];\r\n\t\tbuildUpValue.blocks.expose ??= [];\r\n\t\tsuper.value = buildUpValue as UmbPropertyEditorRteValueType;\r\n\r\n\t\t// Only update the actual editor markup if it is not the same as the value.\r\n\t\tif (this._markup !== super.value.markup) {\r\n\t\t\tthis._markup = super.value.markup;\r\n\t\t}\r\n\r\n\t\tthis.#managerContext.setLayouts(buildUpValue.blocks.layout[UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS] ?? []);\r\n\t\tthis.#managerContext.setContents(buildUpValue.blocks.contentData);\r\n\t\tthis.#managerContext.setSettings(buildUpValue.blocks.settingsData);\r\n\t\tthis.#managerContext.setExposes(buildUpValue.blocks.expose);\r\n\t}\r\n\tpublic override get value(): UmbPropertyEditorRteValueType | undefined {\r\n\t\treturn super.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @default false\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\treadonly = false;\r\n\r\n\t@property({ type: Boolean })\r\n\tmandatory?: boolean;\r\n\r\n\t@property({ type: String })\r\n\tmandatoryMessage?: string | undefined;\r\n\r\n\t@state()\r\n\tprotected _config?: UmbPropertyEditorConfigCollection;\r\n\r\n\t@state()\r\n\tprotected _css: StyleInfo = {};\r\n\r\n\t/**\r\n\t * @deprecated _value is depreacated, use `super.value` instead.\r\n\t * @returns {UmbPropertyEditorRteValueType | undefined} The value of the property editor.\r\n\t */\r\n\t@state()\r\n\tprotected get _value(): UmbPropertyEditorRteValueType | undefined {\r\n\t\treturn super.value;\r\n\t}\r\n\tprotected set _value(value: UmbPropertyEditorRteValueType | undefined) {\r\n\t\tsuper.value = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Separate state for markup, to avoid re-rendering/re-setting the value of the Tiptap editor when the value does not really change.\r\n\t */\r\n\t@state()\r\n\tprotected _markup = '';\r\n\r\n\treadonly #managerContext = new UmbBlockRteManagerContext(this);\r\n\treadonly #entriesContext = new UmbBlockRteEntriesContext(this);\r\n\r\n\treadonly #validationContext = new UmbValidationContext(this);\r\n\r\n\treadonly #unusedLayoutLookup: Map<string, UmbBlockRteLayoutModel> = new Map();\r\n\treadonly #unusedContentLookup: Map<string, UmbBlockDataModel> = new Map();\r\n\treadonly #unusedSettingsLookup: Map<string, UmbBlockDataModel> = new Map();\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tif (context) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tobserveMultiple([\r\n\t\t\t\t\t\tthis.#managerContext.blockTypes,\r\n\t\t\t\t\t\tcontext.structure.variesByCulture,\r\n\t\t\t\t\t\tcontext.structure.variesBySegment,\r\n\t\t\t\t\t]),\r\n\t\t\t\t\tasync ([blockTypes, variesByCulture, variesBySegment]) => {\r\n\t\t\t\t\t\tif (blockTypes.length > 0 && (variesByCulture === false || variesBySegment === false)) {\r\n\t\t\t\t\t\t\t// check if any of the Blocks varyByCulture or Segment and then display a warning.\r\n\t\t\t\t\t\t\tconst promises = await Promise.all(\r\n\t\t\t\t\t\t\t\tblockTypes.map(async (blockType) => {\r\n\t\t\t\t\t\t\t\t\tconst elementType = blockType.contentElementTypeKey;\r\n\t\t\t\t\t\t\t\t\tawait this.#managerContext.contentTypesLoaded;\r\n\t\t\t\t\t\t\t\t\tconst structure = await this.#managerContext.getStructure(elementType);\r\n\t\t\t\t\t\t\t\t\tif (variesByCulture === false && structure?.getVariesByCulture() === true) {\r\n\t\t\t\t\t\t\t\t\t\t// If block varies by culture but document does not.\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t} else if (variesBySegment === false && structure?.getVariesBySegment() === true) {\r\n\t\t\t\t\t\t\t\t\t\t// If block varies by segment but document does not.\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconst notSupportedVariantSetting = promises.filter((x) => x === true).length > 0;\r\n\r\n\t\t\t\t\t\t\tif (notSupportedVariantSetting) {\r\n\t\t\t\t\t\t\t\tthis.setCustomValidity('#blockEditor_blockVariantConfigurationNotSupported');\r\n\t\t\t\t\t\t\t\tthis.checkValidity();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'blockTypeConfigurationCheck',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.removeUmbControllerByAlias('blockTypeConfigurationCheck');\r\n\t\t\t}\r\n\t\t}).passContextAliasMatches();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (context) => {\r\n\t\t\tthis.#gotPropertyContext(context);\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, (context) => {\r\n\t\t\tthis.#managerContext.setVariantId(context?.getVariantId());\r\n\t\t});\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#entriesContext.layoutEntries,\r\n\t\t\t(layouts) => {\r\n\t\t\t\t// Update manager:\r\n\t\t\t\tthis.#managerContext.setLayouts(layouts);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'valueMissing',\r\n\t\t\t() => this.mandatoryMessage ?? UMB_VALIDATION_EMPTY_LOCALIZATION_KEY,\r\n\t\t\t() => !!this.mandatory && this.value === undefined,\r\n\t\t);\r\n\t}\r\n\r\n\t#gotPropertyContext(context: typeof UMB_PROPERTY_CONTEXT.TYPE | undefined) {\r\n\t\tthis.observe(\r\n\t\t\tcontext?.dataPath,\r\n\t\t\t(dataPath) => {\r\n\t\t\t\tif (dataPath) {\r\n\t\t\t\t\t// Set the data path for the local validation context:\r\n\t\t\t\t\tthis.#validationContext.setDataPath(dataPath + '.blocks');\r\n\t\t\t\t\tthis.#validationContext.autoReport();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeDataPath',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tcontext?.alias,\r\n\t\t\t(alias) => {\r\n\t\t\t\tthis.#managerContext.setPropertyAlias(alias);\r\n\t\t\t},\r\n\t\t\t'observePropertyAlias',\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([\r\n\t\t\t\tthis.#managerContext.layouts,\r\n\t\t\t\tthis.#managerContext.contents,\r\n\t\t\t\tthis.#managerContext.settings,\r\n\t\t\t\tthis.#managerContext.exposes,\r\n\t\t\t]),\r\n\t\t\t([layouts, contents, settings, exposes]) => {\r\n\t\t\t\tif (layouts.length === 0) {\r\n\t\t\t\t\tif (super.value?.markup === undefined) {\r\n\t\t\t\t\t\tif (this.value === undefined) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsuper.value = undefined;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst newValue = {\r\n\t\t\t\t\t\t\t...super.value,\r\n\t\t\t\t\t\t\tblocks: {\r\n\t\t\t\t\t\t\t\tlayout: {},\r\n\t\t\t\t\t\t\t\tcontentData: [],\r\n\t\t\t\t\t\t\t\tsettingsData: [],\r\n\t\t\t\t\t\t\t\texpose: [],\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (jsonStringComparison(this.value, newValue)) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsuper.value = newValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst newValue = {\r\n\t\t\t\t\t\tmarkup: this._markup,\r\n\t\t\t\t\t\tblocks: {\r\n\t\t\t\t\t\t\tlayout: { [UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS]: layouts },\r\n\t\t\t\t\t\t\tcontentData: contents,\r\n\t\t\t\t\t\t\tsettingsData: settings,\r\n\t\t\t\t\t\t\texpose: exposes,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (jsonStringComparison(this.value, newValue)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsuper.value = newValue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If we don't have a value set from the outside or an internal value, we don't want to set the value.\r\n\t\t\t\t// This is added to prevent the block list from setting an empty value on startup.\r\n\t\t\t\tif (super.value?.markup === undefined) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontext?.setValue(super.value);\r\n\t\t\t},\r\n\t\t\t'blockManagerObserver',\r\n\t\t);\r\n\t}\r\n\r\n\t#setUnusedBlockLookups(unusedLayouts: Array<UmbBlockRteLayoutModel>) {\r\n\t\tif (unusedLayouts.length) {\r\n\t\t\tunusedLayouts.forEach((layout) => {\r\n\t\t\t\tif (layout.contentKey) {\r\n\t\t\t\t\tthis.#unusedLayoutLookup.set(layout.contentKey, layout);\r\n\r\n\t\t\t\t\tconst contentBlock = this.#managerContext.getContentOf(layout.contentKey);\r\n\t\t\t\t\tif (contentBlock) {\r\n\t\t\t\t\t\tthis.#unusedContentLookup.set(layout.contentKey, contentBlock);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t`Expected content block for '${layout.contentKey}' was not found. This may indicate a data consistency issue.`,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (layout.settingsKey) {\r\n\t\t\t\t\t\tconst settingsBlock = this.#managerContext.getSettingsOf(layout.settingsKey);\r\n\t\t\t\t\t\tif (settingsBlock) {\r\n\t\t\t\t\t\t\tthis.#unusedSettingsLookup.set(layout.settingsKey, settingsBlock);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t`Expected settings block for '${layout.settingsKey}' was not found. This may indicate a data consistency issue.`,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t#restoreUnusedBlocks(usedContentKeys: Array<string | null>) {\r\n\t\tif (usedContentKeys.length) {\r\n\t\t\tusedContentKeys.forEach((contentKey) => {\r\n\t\t\t\tif (contentKey && this.#unusedLayoutLookup.has(contentKey)) {\r\n\t\t\t\t\tconst layout = this.#unusedLayoutLookup.get(contentKey);\r\n\t\t\t\t\tif (layout) {\r\n\t\t\t\t\t\tthis.#managerContext.setOneLayout(layout);\r\n\t\t\t\t\t\tthis.#unusedLayoutLookup.delete(contentKey);\r\n\r\n\t\t\t\t\t\tconst contentBlock = this.#unusedContentLookup.get(contentKey);\r\n\t\t\t\t\t\tif (contentBlock) {\r\n\t\t\t\t\t\t\tthis.#managerContext.setOneContent(contentBlock);\r\n\t\t\t\t\t\t\tthis.#managerContext.setOneExpose(contentKey, UmbVariantId.CreateInvariant());\r\n\t\t\t\t\t\t\tthis.#unusedContentLookup.delete(contentKey);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (layout.settingsKey && this.#unusedSettingsLookup.has(layout.settingsKey)) {\r\n\t\t\t\t\t\t\tconst settingsBlock = this.#unusedSettingsLookup.get(layout.settingsKey);\r\n\t\t\t\t\t\t\tif (settingsBlock) {\r\n\t\t\t\t\t\t\t\tthis.#managerContext.setOneSettings(settingsBlock);\r\n\t\t\t\t\t\t\t\tthis.#unusedSettingsLookup.delete(layout.settingsKey);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _filterUnusedBlocks(usedContentKeys: (string | null)[]) {\r\n\t\tconst unusedLayouts = this.#managerContext.getLayouts().filter((x) => usedContentKeys.indexOf(x.contentKey) === -1);\r\n\r\n\t\t// Temporarily set the unused layouts to the lookup, as they could be restored later, e.g. via an RTE undo action. [LK]\r\n\t\tthis.#restoreUnusedBlocks(usedContentKeys);\r\n\t\tthis.#setUnusedBlockLookups(unusedLayouts);\r\n\r\n\t\tconst unusedContentKeys = unusedLayouts.map((x) => x.contentKey);\r\n\r\n\t\tconst unusedSettingsKeys = unusedLayouts\r\n\t\t\t.map((x) => x.settingsKey)\r\n\t\t\t.filter((x) => typeof x === 'string') as Array<string>;\r\n\r\n\t\tthis.#managerContext.removeManyContent(unusedContentKeys);\r\n\t\tthis.#managerContext.removeManySettings(unusedSettingsKeys);\r\n\t\tthis.#managerContext.removeManyLayouts(unusedContentKeys);\r\n\t}\r\n\r\n\tprotected _fireChangeEvent() {\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride destroy() {\r\n\t\tsuper.destroy();\r\n\t\tthis.#unusedLayoutLookup.clear();\r\n\t\tthis.#unusedContentLookup.clear();\r\n\t\tthis.#unusedSettingsLookup.clear();\r\n\t}\r\n}\r\n"],"names":["UmbPropertyEditorUiRteElementBase","UmbFormControlMixin","UmbLitElement","#managerContext","UmbBlockRteManagerContext","#entriesContext","UmbBlockRteEntriesContext","#validationContext","UmbValidationContext","#unusedLayoutLookup","#unusedContentLookup","#unusedSettingsLookup","UMB_CONTENT_WORKSPACE_CONTEXT","context","observeMultiple","blockTypes","variesByCulture","variesBySegment","blockType","elementType","structure","x","UMB_PROPERTY_CONTEXT","#gotPropertyContext","UMB_PROPERTY_DATASET_CONTEXT","layouts","UMB_VALIDATION_EMPTY_LOCALIZATION_KEY","config","blocks","dimensions","value","buildUpValue","UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS","dataPath","alias","contents","settings","exposes","newValue","jsonStringComparison","#setUnusedBlockLookups","unusedLayouts","layout","contentBlock","settingsBlock","#restoreUnusedBlocks","usedContentKeys","contentKey","UmbVariantId","unusedContentKeys","unusedSettingsKeys","UmbChangeEvent","__decorateClass","property","oldValue","state"],"mappings":"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"}