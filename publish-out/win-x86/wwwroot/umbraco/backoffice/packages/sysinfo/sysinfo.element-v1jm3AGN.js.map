{"version":3,"file":"sysinfo.element-v1jm3AGN.js","sources":["../../../src/packages/sysinfo/components/sysinfo.element.ts"],"sourcesContent":["import { UmbSysinfoRepository } from '../repository/index.js';\r\nimport { css, customElement, html, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbCurrentUserRepository } from '@umbraco-cms/backoffice/current-user';\r\nimport { UmbTemporaryFileConfigRepository } from '@umbraco-cms/backoffice/temporary-file';\r\n\r\ntype ServerKeyValue = {\r\n\tname?: string;\r\n\tdata?: string;\r\n};\r\n\r\n@customElement('umb-sysinfo')\r\nexport class UmbSysinfoElement extends UmbModalBaseElement {\r\n\t@state()\r\n\tprivate _systemInformation = '';\r\n\r\n\t@state()\r\n\tprivate _loading = false;\r\n\r\n\t@state()\r\n\tprivate _buttonState?: UUIButtonState;\r\n\r\n\treadonly #serverKeyValues: Array<ServerKeyValue> = [];\r\n\treadonly #sysinfoRepository = new UmbSysinfoRepository(this);\r\n\treadonly #currentUserRepository = new UmbCurrentUserRepository(this);\r\n\treadonly #temporaryFileConfigRepository = new UmbTemporaryFileConfigRepository(this);\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#populate();\r\n\t}\r\n\r\n\tasync #populate() {\r\n\t\tthis._loading = true;\r\n\t\tthis.#serverKeyValues.length = 0;\r\n\r\n\t\tconst [serverTroubleshooting, serverInformation, clientInformation, { data: currentUser }, temporaryFileConfig] =\r\n\t\t\tawait Promise.all([\r\n\t\t\t\tthis.#sysinfoRepository.requestTroubleShooting(),\r\n\t\t\t\tthis.#sysinfoRepository.requestServerInformation(),\r\n\t\t\t\tthis.#sysinfoRepository.requestClientInformation(),\r\n\t\t\t\tthis.#currentUserRepository.requestCurrentUser(),\r\n\t\t\t\tthis.#temporaryFileConfigRepository.requestTemporaryFileConfiguration(),\r\n\t\t\t]);\r\n\r\n\t\tthis.#serverKeyValues.push({ name: 'Server Troubleshooting' });\r\n\t\tif (serverTroubleshooting) {\r\n\t\t\tthis.#serverKeyValues.push(...serverTroubleshooting.items);\r\n\t\t}\r\n\r\n\t\tthis.#serverKeyValues.push({});\r\n\t\tthis.#serverKeyValues.push({ name: 'Server Information' });\r\n\t\tif (serverInformation) {\r\n\t\t\tthis.#serverKeyValues.push({ name: 'Umbraco build version', data: serverInformation.version });\r\n\t\t\tthis.#serverKeyValues.push({ name: 'Umbraco assembly version', data: serverInformation.assemblyVersion });\r\n\t\t\tthis.#serverKeyValues.push({ name: 'Server time offset', data: serverInformation.baseUtcOffset });\r\n\t\t\tthis.#serverKeyValues.push({ name: 'Runtime mode', data: serverInformation.runtimeMode });\r\n\t\t}\r\n\r\n\t\tthis.#serverKeyValues.push({});\r\n\t\tthis.#serverKeyValues.push({ name: 'Client Information' });\r\n\t\tif (clientInformation) {\r\n\t\t\tthis.#serverKeyValues.push({ name: 'Umbraco client version', data: clientInformation.version });\r\n\t\t}\r\n\r\n\t\t// User information\r\n\t\tthis.#serverKeyValues.push({});\r\n\t\tthis.#serverKeyValues.push({ name: 'Current user' });\r\n\t\tif (currentUser) {\r\n\t\t\tthis.#serverKeyValues.push({ name: 'User is admin', data: currentUser.isAdmin ? 'Yes' : 'No' });\r\n\t\t\tthis.#serverKeyValues.push({ name: 'User sections', data: currentUser.allowedSections.join(', ') });\r\n\t\t\tthis.#serverKeyValues.push({ name: 'User culture', data: currentUser.languageIsoCode });\r\n\t\t\tthis.#serverKeyValues.push({\r\n\t\t\t\tname: 'User languages',\r\n\t\t\t\tdata: currentUser.hasAccessToAllLanguages ? 'All' : currentUser.languages.join(', '),\r\n\t\t\t});\r\n\t\t\tthis.#serverKeyValues.push({\r\n\t\t\t\tname: 'User document start nodes',\r\n\t\t\t\tdata: currentUser.documentStartNodeUniques.join(', '),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.#serverKeyValues.push({});\r\n\t\tthis.#serverKeyValues.push({ name: 'Temporary file configuration' });\r\n\t\t// Temporary file configuration\r\n\t\tif (temporaryFileConfig) {\r\n\t\t\tthis.#serverKeyValues.push({\r\n\t\t\t\tname: 'Max allowed file size',\r\n\t\t\t\tdata: temporaryFileConfig.maxFileSize?.toString() ?? 'Not set (unlimited)',\r\n\t\t\t});\r\n\t\t\tthis.#serverKeyValues.push({\r\n\t\t\t\tname: 'Allowed file types',\r\n\t\t\t\tdata: temporaryFileConfig.allowedUploadedFileExtensions.join(', '),\r\n\t\t\t});\r\n\t\t\tthis.#serverKeyValues.push({\r\n\t\t\t\tname: 'Disallowed file types',\r\n\t\t\t\tdata: temporaryFileConfig.disallowedUploadedFilesExtensions?.join(', '),\r\n\t\t\t});\r\n\t\t\tthis.#serverKeyValues.push({\r\n\t\t\t\tname: 'Image file types',\r\n\t\t\t\tdata: temporaryFileConfig.imageFileTypes?.join(', '),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Browser information\r\n\t\tthis.#serverKeyValues.push({});\r\n\t\tthis.#serverKeyValues.push({ name: 'Browser Troubleshooting' });\r\n\t\tthis.#serverKeyValues.push({ name: 'Browser (user agent)', data: navigator.userAgent });\r\n\t\tthis.#serverKeyValues.push({ name: 'Browser language', data: navigator.language });\r\n\t\tthis.#serverKeyValues.push({ name: 'Browser location', data: location.href });\r\n\r\n\t\tthis._systemInformation = this.#renderServerKeyValues();\r\n\t\tthis._loading = false;\r\n\t}\r\n\r\n\t#renderServerKeyValues() {\r\n\t\treturn this.#serverKeyValues\r\n\t\t\t.map((serverKeyValue) => {\r\n\t\t\t\treturn serverKeyValue.name ? `${serverKeyValue.name}: ${serverKeyValue.data ?? ''}` : '';\r\n\t\t\t})\r\n\t\t\t.join('\\n');\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-dialog>\r\n\t\t\t\t<uui-dialog-layout headline=\"System information\">\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis._loading,\r\n\t\t\t\t\t\t() => html`<uui-loader-bar></uui-loader-bar>`,\r\n\t\t\t\t\t\t() => html` <umb-code-block id=\"codeblock\">${this._systemInformation}</umb-code-block> `,\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t@click=${this._submitModal}\r\n\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_close')}></uui-button>\r\n\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t@click=${this.#copyToClipboard}\r\n\t\t\t\t\t\t.state=${this._buttonState}\r\n\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('clipboard_labelForCopyToClipboard')}></uui-button>\r\n\t\t\t\t</uui-dialog-layout>\r\n\t\t\t</uui-dialog>\r\n\t\t`;\r\n\t}\r\n\r\n\tasync #copyToClipboard() {\r\n\t\tconst notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n\r\n\t\ttry {\r\n\t\t\tthis._buttonState = 'waiting';\r\n\t\t\tconst text = `Umbraco system information\r\n--------------------------------\r\n${this._systemInformation}`;\r\n\t\t\tconst textAsCode = `\\`\\`\\`\\n${text}\\n\\`\\`\\`\\n`;\r\n\t\t\tawait navigator.clipboard.writeText(textAsCode);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tnotificationContext?.peek('positive', {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\theadline: 'System information',\r\n\t\t\t\t\t\tmessage: this.localize.term('speechBubbles_copySuccessMessage'),\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t\tthis._buttonState = 'success';\r\n\t\t\t}, 250);\r\n\t\t} catch {\r\n\t\t\tthis._buttonState = 'failed';\r\n\t\t\tnotificationContext?.peek('danger', {\r\n\t\t\t\tdata: {\r\n\t\t\t\t\theadline: 'System information',\r\n\t\t\t\t\tmessage: this.localize.term('speechBubbles_cannotCopyInformation'),\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#codeblock {\r\n\t\t\t\tmax-height: 300px;\r\n\t\t\t\toverflow: auto;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbSysinfoElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-sysinfo': UmbSysinfoElement;\r\n\t}\r\n}\r\n"],"names":["_serverKeyValues","_sysinfoRepository","_currentUserRepository","_temporaryFileConfigRepository","_UmbSysinfoElement_instances","populate_fn","renderServerKeyValues_fn","copyToClipboard_fn","UmbSysinfoElement","UmbModalBaseElement","__privateAdd","UmbSysinfoRepository","UmbCurrentUserRepository","UmbTemporaryFileConfigRepository","__privateMethod","html","when","__privateGet","serverTroubleshooting","serverInformation","clientInformation","currentUser","temporaryFileConfig","serverKeyValue","notificationContext","UMB_NOTIFICATION_CONTEXT","textAsCode","UmbTextStyles","css","__decorateClass","state","customElement","UmbSysinfoElement$1"],"mappings":"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"}