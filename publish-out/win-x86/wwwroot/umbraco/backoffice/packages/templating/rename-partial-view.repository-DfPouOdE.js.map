{"version":3,"file":"rename-partial-view.repository-DfPouOdE.js","sources":["../../../src/packages/templating/partial-views/entity-actions/rename/rename-partial-view.server.data-source.ts","../../../src/packages/templating/partial-views/entity-actions/rename/rename-partial-view.repository.ts"],"sourcesContent":["import { UmbPartialViewDetailServerDataSource } from '../../repository/partial-view-detail.server.data-source.js';\r\nimport {\r\n\tUmbServerFilePathUniqueSerializer,\r\n\tappendFileExtensionIfNeeded,\r\n} from '@umbraco-cms/backoffice/server-file-system';\r\nimport type { RenameStylesheetRequestModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { PartialViewService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\nexport class UmbRenamePartialViewServerDataSource {\r\n\t#host: UmbControllerHost;\r\n\t#detailDataSource: UmbPartialViewDetailServerDataSource;\r\n\t#serverFilePathUniqueSerializer = new UmbServerFilePathUniqueSerializer();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t\tthis.#detailDataSource = new UmbPartialViewDetailServerDataSource(this.#host);\r\n\t}\r\n\r\n\t/**\r\n\t * Rename Partial View\r\n\t * @param {string} unique\r\n\t * @param {string} name\r\n\t * @returns {*}\r\n\t * @memberof UmbRenamePartialViewServerDataSource\r\n\t */\r\n\tasync rename(unique: string, name: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\t\tif (!name) throw new Error('Name is missing');\r\n\r\n\t\tconst path = this.#serverFilePathUniqueSerializer.toServerPath(unique);\r\n\t\tif (!path) throw new Error('Path is missing');\r\n\r\n\t\tconst body: RenameStylesheetRequestModel = {\r\n\t\t\tname: appendFileExtensionIfNeeded(name, '.cshtml'),\r\n\t\t};\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tPartialViewService.putPartialViewByPathRename({\r\n\t\t\t\tpath: { path },\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\tconst newPath = decodeURIComponent(data);\r\n\t\t\tconst newPathUnique = this.#serverFilePathUniqueSerializer.toUnique(newPath);\r\n\t\t\treturn this.#detailDataSource.read(newPathUnique);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n}\r\n","import { UMB_PARTIAL_VIEW_DETAIL_STORE_CONTEXT } from '../../repository/constants.js';\r\nimport type { UmbPartialViewDetailModel } from '../../types.js';\r\nimport { UmbRenamePartialViewServerDataSource } from './rename-partial-view.server.data-source.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRenameServerFileRepositoryBase } from '@umbraco-cms/backoffice/server-file-system';\r\n\r\nexport class UmbRenamePartialViewRepository extends UmbRenameServerFileRepositoryBase<UmbPartialViewDetailModel> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tsuper(host, UmbRenamePartialViewServerDataSource, UMB_PARTIAL_VIEW_DETAIL_STORE_CONTEXT);\r\n\t}\r\n}\r\n\r\nexport default UmbRenamePartialViewRepository;\r\n"],"names":["UmbRenamePartialViewServerDataSource","#host","#detailDataSource","#serverFilePathUniqueSerializer","UmbServerFilePathUniqueSerializer","host","UmbPartialViewDetailServerDataSource","unique","name","path","body","appendFileExtensionIfNeeded","data","error","tryExecute","PartialViewService","newPath","newPathUnique","UmbRenamePartialViewRepository","UmbRenameServerFileRepositoryBase","UMB_PARTIAL_VIEW_DETAIL_STORE_CONTEXT"],"mappings":";;;;;AAUO,MAAMA,EAAqC;AAAA,EACjDC;AAAA,EACAC;AAAA,EACAC,KAAkC,IAAIC,EAAA;AAAA,EAEtC,YAAYC,GAAyB;AACpC,SAAKJ,KAAQI,GACb,KAAKH,KAAoB,IAAII,EAAqC,KAAKL,EAAK;AAAA,EAC7E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,OAAOM,GAAgBC,GAAc;AAC1C,QAAI,CAACD,EAAQ,OAAM,IAAI,MAAM,mBAAmB;AAChD,QAAI,CAACC,EAAM,OAAM,IAAI,MAAM,iBAAiB;AAE5C,UAAMC,IAAO,KAAKN,GAAgC,aAAaI,CAAM;AACrE,QAAI,CAACE,EAAM,OAAM,IAAI,MAAM,iBAAiB;AAE5C,UAAMC,IAAqC;AAAA,MAC1C,MAAMC,EAA4BH,GAAM,SAAS;AAAA,IAAA,GAG5C,EAAE,MAAAI,GAAM,OAAAC,EAAA,IAAU,MAAMC;AAAA,MAC7B,KAAKb;AAAA,MACLc,EAAmB,2BAA2B;AAAA,QAC7C,MAAM,EAAE,MAAAN,EAAA;AAAA,QACR,MAAAC;AAAA,MAAA,CACA;AAAA,IAAA;AAGF,QAAIE,KAAQ,OAAOA,KAAS,UAAU;AACrC,YAAMI,IAAU,mBAAmBJ,CAAI,GACjCK,IAAgB,KAAKd,GAAgC,SAASa,CAAO;AAC3E,aAAO,KAAKd,GAAkB,KAAKe,CAAa;AAAA,IACjD;AAEA,WAAO,EAAE,OAAAJ,EAAA;AAAA,EACV;AACD;AChDO,MAAMK,UAAuCC,EAA6D;AAAA,EAChH,YAAYd,GAAyB;AAGpC,UAAMA,GAAML,GAAsCoB,CAAqC;AAAA,EACxF;AACD;"}