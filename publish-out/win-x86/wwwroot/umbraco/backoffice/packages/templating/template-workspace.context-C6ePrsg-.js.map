{"version":3,"file":"template-workspace.context-C6ePrsg-.js","sources":["../../../src/packages/templating/modals/templating-section-picker/templating-section-picker-modal.token.ts","../../../src/packages/templating/templates/workspace/template-workspace-editor.element.ts","../../../src/packages/templating/templates/workspace/template-workspace.context.ts"],"sourcesContent":["import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface UmbTemplatingSectionPickerModalData {}\r\n\r\nexport type UmbTemplatingSectionPickerModalValue = {\r\n\tvalue: string;\r\n};\r\n\r\nexport const UMB_TEMPLATING_SECTION_PICKER_MODAL = new UmbModalToken<\r\n\tUmbTemplatingSectionPickerModalData,\r\n\tUmbTemplatingSectionPickerModalValue\r\n>('Umb.Modal.TemplatingSectionPicker', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import { getQuerySnippet } from '../../utils/index.js';\r\nimport { UMB_TEMPLATE_QUERY_BUILDER_MODAL } from '../modals/query-builder/index.js';\r\nimport { UMB_TEMPLATING_SECTION_PICKER_MODAL } from '../../modals/templating-section-picker/templating-section-picker-modal.token.js';\r\nimport type { UmbTemplatingInsertMenuElement } from '../../local-components/insert-menu/insert-menu.element.js';\r\nimport { UMB_TEMPLATE_PICKER_MODAL } from '../modals/index.js';\r\nimport { UMB_TEMPLATE_WORKSPACE_CONTEXT } from './template-workspace.context-token.js';\r\nimport { css, customElement, html, nothing, query, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement, umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbCodeEditorElement } from '@umbraco-cms/backoffice/code-editor';\r\nimport type { UmbInputWithAliasElement } from '@umbraco-cms/backoffice/components';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\nimport { umbBindToValidation } from '@umbraco-cms/backoffice/validation';\r\n\r\nimport '@umbraco-cms/backoffice/code-editor';\r\nimport '../../local-components/insert-menu/index.js';\r\n\r\n@customElement('umb-template-workspace-editor')\r\nexport class UmbTemplateWorkspaceEditorElement extends UmbLitElement {\r\n\t#modalContext?: UmbModalManagerContext;\r\n\r\n\t@state()\r\n\tprivate _name?: string = '';\r\n\r\n\t@state()\r\n\tprivate _content?: string | null = '';\r\n\r\n\t@state()\r\n\tprivate _alias?: string = '';\r\n\r\n\t@state()\r\n\tprivate _masterTemplateName?: string | null = null;\r\n\r\n\t@query('umb-code-editor')\r\n\tprivate _codeEditor?: UmbCodeEditorElement;\r\n\r\n\t#templateWorkspaceContext?: typeof UMB_TEMPLATE_WORKSPACE_CONTEXT.TYPE;\r\n\t#isNew = false;\r\n\r\n\t#masterTemplateUnique: string | null = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n\t\t\tthis.#modalContext = instance;\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_TEMPLATE_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.#templateWorkspaceContext = workspaceContext;\r\n\t\t\tthis.observe(this.#templateWorkspaceContext?.name, (name) => {\r\n\t\t\t\tthis._name = name;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#templateWorkspaceContext?.alias, (alias) => {\r\n\t\t\t\tthis._alias = alias;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#templateWorkspaceContext?.content, (content) => {\r\n\t\t\t\tthis._content = content;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#templateWorkspaceContext?.masterTemplate, (masterTemplate) => {\r\n\t\t\t\tthis.#masterTemplateUnique = masterTemplate?.unique ?? null;\r\n\t\t\t\tthis._masterTemplateName = masterTemplate?.name ?? null;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#templateWorkspaceContext?.isNew, (isNew) => {\r\n\t\t\t\tthis.#isNew = !!isNew;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#onNameAndAliasChange(event: InputEvent & { target: UmbInputWithAliasElement }) {\r\n\t\tthis.#templateWorkspaceContext?.setName(event.target.value ?? '');\r\n\t\tthis.#templateWorkspaceContext?.setAlias(event.target.alias ?? '');\r\n\t}\r\n\r\n\t#onCodeEditorInput(event: Event) {\r\n\t\tconst target = event.target as UmbCodeEditorElement;\r\n\t\tconst value = target.code as string;\r\n\t\tthis.#templateWorkspaceContext?.setContent(value);\r\n\t}\r\n\r\n\t#insertSnippet(event: Event) {\r\n\t\tconst target = event.target as UmbTemplatingInsertMenuElement;\r\n\t\tconst value = target.value as string;\r\n\t\tthis._codeEditor?.insert(value);\r\n\t}\r\n\r\n\t#openInsertSectionModal() {\r\n\t\tconst sectionModal = this.#modalContext?.open(this, UMB_TEMPLATING_SECTION_PICKER_MODAL);\r\n\r\n\t\tsectionModal\r\n\t\t\t?.onSubmit()\r\n\t\t\t.then((insertSectionModalValue) => {\r\n\t\t\t\tif (insertSectionModalValue?.value) {\r\n\t\t\t\t\tthis._codeEditor?.insert(insertSectionModalValue.value);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(() => undefined);\r\n\t}\r\n\r\n\t#resetMasterTemplate() {\r\n\t\tthis.#templateWorkspaceContext?.setMasterTemplate(null, true);\r\n\t}\r\n\r\n\t#openMasterTemplatePicker() {\r\n\t\tconst modalContext = this.#modalContext?.open(this, UMB_TEMPLATE_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tpickableFilter: (item) => {\r\n\t\t\t\t\treturn item.unique !== null && item.unique !== this.#templateWorkspaceContext?.getUnique();\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tvalue: {\r\n\t\t\t\tselection: [this.#masterTemplateUnique],\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tmodalContext\r\n\t\t\t?.onSubmit()\r\n\t\t\t.then((value) => {\r\n\t\t\t\tif (!value?.selection) return;\r\n\t\t\t\tthis.#templateWorkspaceContext?.setMasterTemplate(value.selection[0] ?? null, true);\r\n\t\t\t})\r\n\t\t\t.catch(() => undefined);\r\n\t}\r\n\r\n\t#openQueryBuilder() {\r\n\t\tconst queryBuilderModal = this.#modalContext?.open(this, UMB_TEMPLATE_QUERY_BUILDER_MODAL);\r\n\r\n\t\tqueryBuilderModal\r\n\t\t\t?.onSubmit()\r\n\t\t\t.then((queryBuilderModalValue) => {\r\n\t\t\t\tif (queryBuilderModalValue?.value) {\r\n\t\t\t\t\tthis._codeEditor?.insert(getQuerySnippet(queryBuilderModalValue.value));\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(() => undefined);\r\n\t}\r\n\r\n\t#renderMasterTemplatePicker() {\r\n\t\treturn html`\r\n\t\t\t<uui-button-group>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\t@click=${this.#openMasterTemplatePicker}\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tid=\"master-template-button\"\r\n\t\t\t\t\tlabel=\"${this.localize.term('template_mastertemplate')}: ${this._masterTemplateName\r\n\t\t\t\t\t\t? this._masterTemplateName\r\n\t\t\t\t\t\t: this.localize.term('template_noMaster')}\"></uui-button>\r\n\t\t\t\t${this._masterTemplateName\r\n\t\t\t\t\t? html`<uui-button look=\"secondary\" label=${this.localize.term('actions_remove')} compact>\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-delete\" @click=${this.#resetMasterTemplate}></uui-icon>\r\n\t\t\t\t\t\t</uui-button>`\r\n\t\t\t\t\t: nothing}\r\n\t\t\t</uui-button-group>\r\n\t\t`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\t// TODO: add correct UI elements\r\n\t\treturn html`\r\n\t\t\t<umb-entity-detail-workspace-editor>\r\n\t\t\t\t<umb-input-with-alias\r\n\t\t\t\t\tslot=\"header\"\r\n\t\t\t\t\tid=\"name\"\r\n\t\t\t\t\tlabel=${this.localize.term('placeholders_entername')}\r\n\t\t\t\t\tplaceholder=${this.localize.term('placeholders_entername')}\r\n\t\t\t\t\t.value=${this._name}\r\n\t\t\t\t\t.alias=${this._alias}\r\n\t\t\t\t\t?auto-generate-alias=${this.#isNew}\r\n\t\t\t\t\t@change=${this.#onNameAndAliasChange}\r\n\t\t\t\t\trequired\r\n\t\t\t\t\t${umbBindToValidation(this)}\r\n\t\t\t\t\t${umbFocus()}>\r\n\t\t\t\t</umb-input-with-alias>\r\n\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<div slot=\"header\" id=\"code-editor-menu-container\">${this.#renderMasterTemplatePicker()}</div>\r\n\t\t\t\t\t<div slot=\"header-actions\">\r\n\t\t\t\t\t\t<umb-templating-insert-menu @insert=${this.#insertSnippet}></umb-templating-insert-menu>\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t\tid=\"query-builder-button\"\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('template_queryBuilder')}\r\n\t\t\t\t\t\t\t@click=${this.#openQueryBuilder}>\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-wand\"></uui-icon> ${this.localize.term('template_queryBuilder')}\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t\tid=\"sections-button\"\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('template_insertSections')}\r\n\t\t\t\t\t\t\t@click=${this.#openInsertSectionModal}>\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-indent\"></uui-icon> ${this.localize.term('template_insertSections')}\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t${this.#renderCodeEditor()}\r\n\t\t\t\t</uui-box>\r\n\t\t\t</umb-entity-detail-workspace-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCodeEditor() {\r\n\t\treturn html`\r\n\t\t\t<umb-code-editor\r\n\t\t\t\tid=\"content\"\r\n\t\t\t\tlanguage=\"razor\"\r\n\t\t\t\t.code=${this._content ?? ''}\r\n\t\t\t\t@input=${this.#onCodeEditorInput}></umb-code-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#loader-container {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tplace-items: center;\r\n\t\t\t\tmin-height: calc(100dvh - 360px);\r\n\t\t\t}\r\n\r\n\t\t\tumb-code-editor {\r\n\t\t\t\t--editor-height: calc(100dvh - 300px);\r\n\t\t\t}\r\n\r\n\t\t\tuui-box {\r\n\t\t\t\tmin-height: calc(100dvh - 300px);\r\n\t\t\t\tmargin: var(--uui-size-layout-1);\r\n\t\t\t\t--uui-box-default-padding: 0;\r\n\t\t\t\t/* remove header border bottom as code editor looks better in this box */\r\n\t\t\t\t--uui-color-divider-standalone: transparent;\r\n\t\t\t}\r\n\r\n\t\t\tumb-input-with-alias {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#code-editor-menu-container uui-icon:not([name='icon-delete']) {\r\n\t\t\t\tmargin-right: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t#insert-menu {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tmargin-top: var(--uui-size-space-3);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\tbox-shadow: var(--uui-shadow-depth-3);\r\n\t\t\t\tmin-width: calc(100% + var(--uui-size-8, 24px));\r\n\t\t\t}\r\n\r\n\t\t\t#insert-menu > li,\r\n\t\t\tul {\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tlist-style: none;\r\n\t\t\t}\r\n\r\n\t\t\t.insert-menu-item {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#code-editor-menu-container {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbTemplateWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-template-workspace-editor': UmbTemplateWorkspaceEditorElement;\r\n\t}\r\n}\r\n","import type { UmbTemplateDetailModel } from '../types.js';\r\nimport type { UmbTemplateItemModel, UmbTemplateDetailRepository } from '../repository/index.js';\r\nimport { UMB_TEMPLATE_DETAIL_REPOSITORY_ALIAS, UmbTemplateItemRepository } from '../repository/index.js';\r\nimport { UMB_TEMPLATE_ENTITY_TYPE } from '../entity.js';\r\nimport { UMB_TEMPLATE_WORKSPACE_ALIAS } from './manifests.js';\r\nimport { UmbTemplateWorkspaceEditorElement } from './template-workspace-editor.element.js';\r\nimport type { UmbRoutableWorkspaceContext, UmbSubmittableWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\nimport {\r\n\tUmbEntityNamedDetailWorkspaceContextBase,\r\n\tUmbWorkspaceIsNewRedirectController,\r\n\tUmbWorkspaceIsNewRedirectControllerAlias,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbObjectState } from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { IRoutingInfo, PageComponent } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\n\r\nexport class UmbTemplateWorkspaceContext\r\n\textends UmbEntityNamedDetailWorkspaceContextBase<UmbTemplateDetailModel, UmbTemplateDetailRepository>\r\n\timplements UmbSubmittableWorkspaceContext, UmbRoutableWorkspaceContext\r\n{\r\n\tpublic readonly itemRepository = new UmbTemplateItemRepository(this);\r\n\r\n\t#masterTemplate = new UmbObjectState<UmbTemplateItemModel | null>(null);\r\n\tmasterTemplate = this.#masterTemplate.asObservable();\r\n\r\n\tpublic readonly alias = this._data.createObservablePartOfCurrent((data) => data?.alias);\r\n\tpublic readonly content = this._data.createObservablePartOfCurrent((data) => data?.content);\r\n\tpublic readonly masterTemplateUnique = this._data.createObservablePartOfCurrent(\r\n\t\t(data) => data?.masterTemplate?.unique,\r\n\t);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tworkspaceAlias: UMB_TEMPLATE_WORKSPACE_ALIAS,\r\n\t\t\tentityType: UMB_TEMPLATE_ENTITY_TYPE,\r\n\t\t\tdetailRepositoryAlias: UMB_TEMPLATE_DETAIL_REPOSITORY_ALIAS,\r\n\t\t});\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: 'create/parent/:entityType/:parentUnique',\r\n\t\t\t\tcomponent: UmbTemplateWorkspaceEditorElement,\r\n\t\t\t\tsetup: async (component: PageComponent, info: IRoutingInfo) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.entityType;\r\n\t\t\t\t\tconst parentUnique = info.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tawait this.create({ entityType: parentEntityType, unique: parentUnique });\r\n\r\n\t\t\t\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: 'edit/:unique',\r\n\t\t\t\tcomponent: UmbTemplateWorkspaceEditorElement,\r\n\t\t\t\tsetup: (component: PageComponent, info: IRoutingInfo): void => {\r\n\t\t\t\t\tthis.removeUmbControllerByAlias(UmbWorkspaceIsNewRedirectControllerAlias);\r\n\t\t\t\t\tconst unique = info.match.params.unique;\r\n\t\t\t\t\tthis.load(unique);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\toverride async load(unique: string) {\r\n\t\tconst response = await super.load(unique);\r\n\r\n\t\t// On load we want to set the master template details but not update the layout block in the Razor file.\r\n\t\t// This is because you can still set a layout in code by setting `Layout = \"_Layout.cshtml\";` in the template file.\r\n\t\t// This gets set automatically if you create a template under a parent, but you don't have to do that, you can\r\n\t\t// just set  the `Layout` property in the Razor template file itself.\r\n\t\t// So even if there's no master template set by there being a parent, there may still be one set in the Razor\r\n\t\t// code, and we shouldn't overwrite it.\r\n\t\tawait this.setMasterTemplate(response.data?.masterTemplate?.unique ?? null, false);\r\n\r\n\t\treturn response;\r\n\t}\r\n\r\n\tasync create(parent: UmbEntityModel) {\r\n\t\tconst data = await this.createScaffold({\r\n\t\t\tparent,\r\n\t\t\tpreset: {\r\n\t\t\t\tmasterTemplate: parent.unique ? { unique: parent.unique } : null,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t// On create set or reset the master template depending on whether the template is being created under a parent.\r\n\t\t// This is important to reset when a new template is created so the UI reflects the correct state.\r\n\t\tawait this.setMasterTemplate(parent.unique, true);\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tsetAlias(value: string) {\r\n\t\tthis._data.updateCurrent({ alias: value });\r\n\t}\r\n\r\n\tsetContent(value: string) {\r\n\t\tthis._data.updateCurrent({ content: value });\r\n\t}\r\n\r\n\tgetLayoutBlockRegexPattern() {\r\n\t\treturn new RegExp('(@{[\\\\s\\\\S][^if]*?Layout\\\\s*?=\\\\s*?)(\"[^\"]*?\"|null)(;[\\\\s\\\\S]*?})', 'gi');\r\n\t}\r\n\r\n\tgetHasLayoutBlock() {\r\n\t\treturn this.getData()?.content ? this.getLayoutBlockRegexPattern().test(this.getData()?.content as string) : false;\r\n\t}\r\n\r\n\tasync setMasterTemplate(unique: string | null, updateLayoutBlock: boolean) {\r\n\t\tif (unique === null) {\r\n\t\t\tthis.#masterTemplate.setValue(null);\r\n\t\t} else {\r\n\t\t\t// We need the whole template model if the unique id is provided\r\n\t\t\tconst { data } = await this.itemRepository.requestItems([unique]);\r\n\t\t\tif (data) {\r\n\t\t\t\tthis.#masterTemplate.setValue(data[0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (updateLayoutBlock) {\r\n\t\t\tthis.#updateMasterTemplateLayoutBlock();\r\n\t\t}\r\n\r\n\t\tthis._data.updateCurrent({ masterTemplate: unique ? { unique } : null });\r\n\r\n\t\treturn unique;\r\n\t}\r\n\r\n\t#updateMasterTemplateLayoutBlock = () => {\r\n\t\tconst currentContent = this._data.getCurrent()?.content;\r\n\t\tconst newMasterTemplateAlias = this.#masterTemplate?.getValue()?.alias;\r\n\t\tconst hasLayoutBlock = this.getHasLayoutBlock();\r\n\r\n\t\tif (this.#masterTemplate.getValue() === null && hasLayoutBlock && currentContent) {\r\n\t\t\tconst newString = currentContent.replace(this.getLayoutBlockRegexPattern(), `$1null$3`);\r\n\t\t\tthis.setContent(newString);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if has layout block in the content\r\n\t\tif (hasLayoutBlock && currentContent) {\r\n\t\t\tconst string = currentContent.replace(\r\n\t\t\t\tthis.getLayoutBlockRegexPattern(),\r\n\t\t\t\t`$1\"${newMasterTemplateAlias}.cshtml\"$3`,\r\n\t\t\t);\r\n\t\t\tthis.setContent(string);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if no layout block in the content insert it at the beginning\r\n\t\tconst string = `@{\r\n\tLayout = \"${newMasterTemplateAlias}.cshtml\";\r\n}\r\n${currentContent}`;\r\n\t\tthis.setContent(string);\r\n\t};\r\n}\r\n\r\nexport { UmbTemplateWorkspaceContext as api };\r\n"],"names":["UMB_TEMPLATING_SECTION_PICKER_MODAL","UmbModalToken","_modalContext","_templateWorkspaceContext","_isNew","_masterTemplateUnique","_UmbTemplateWorkspaceEditorElement_instances","onNameAndAliasChange_fn","onCodeEditorInput_fn","insertSnippet_fn","openInsertSectionModal_fn","resetMasterTemplate_fn","openMasterTemplatePicker_fn","openQueryBuilder_fn","renderMasterTemplatePicker_fn","renderCodeEditor_fn","UmbTemplateWorkspaceEditorElement","UmbLitElement","__privateAdd","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","UMB_TEMPLATE_WORKSPACE_CONTEXT","workspaceContext","__privateGet","name","alias","content","masterTemplate","isNew","html","__privateMethod","umbBindToValidation","umbFocus","event","value","insertSectionModalValue","UMB_TEMPLATE_PICKER_MODAL","item","UMB_TEMPLATE_QUERY_BUILDER_MODAL","queryBuilderModalValue","getQuerySnippet","nothing","css","__decorateClass","state","query","customElement","UmbTemplateWorkspaceContext","UmbEntityNamedDetailWorkspaceContextBase","host","UMB_TEMPLATE_WORKSPACE_ALIAS","UMB_TEMPLATE_ENTITY_TYPE","UMB_TEMPLATE_DETAIL_REPOSITORY_ALIAS","UmbTemplateItemRepository","#masterTemplate","UmbObjectState","data","#updateMasterTemplateLayoutBlock","currentContent","newMasterTemplateAlias","hasLayoutBlock","newString","string","component","info","parentEntityType","parentUnique","UmbWorkspaceIsNewRedirectController","UmbWorkspaceIsNewRedirectControllerAlias","unique","response","parent","updateLayoutBlock"],"mappings":"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"}