{"version":3,"file":"property-editor-ui-tiptap-toolbar-configuration.element-CDXo_UNS.js","sources":["../../../src/packages/tiptap/property-editors/toolbar-configuration/tiptap-toolbar-configuration.context.ts","../../../src/packages/tiptap/property-editors/toolbar-configuration/tiptap-toolbar-group-configuration.element.ts","../../../src/packages/tiptap/property-editors/toolbar-configuration/property-editor-ui-tiptap-toolbar-configuration.element.ts"],"sourcesContent":["import type { UmbTiptapToolbarValue } from '../../components/types.js';\r\nimport type {\r\n\tUmbTiptapToolbarExtension,\r\n\tUmbTiptapToolbarGroupViewModel,\r\n\tUmbTiptapToolbarRowViewModel,\r\n} from '../types.js';\r\nimport { UMB_TIPTAP_TOOLBAR_CONFIGURATION_CONTEXT } from './tiptap-toolbar-configuration.context-token.js';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbArrayState, UmbBooleanState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport { UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbTiptapToolbarConfigurationContext extends UmbContextBase {\r\n\t#extensions = new UmbArrayState<UmbTiptapToolbarExtension>([], (x) => x.alias);\r\n\tpublic readonly extensions = this.#extensions.asObservable();\r\n\r\n\t#reload = new UmbBooleanState(false);\r\n\tpublic readonly reload = this.#reload.asObservable();\r\n\r\n\t#extensionsEnabled = new Set<string>();\r\n\r\n\t#extensionsInUse = new Set<string>();\r\n\r\n\t#lookup?: Map<string, UmbTiptapToolbarExtension>;\r\n\r\n\t#toolbar = new UmbArrayState<UmbTiptapToolbarRowViewModel>([], (x) => x.unique);\r\n\tpublic readonly toolbar = this.#toolbar.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_TIPTAP_TOOLBAR_CONFIGURATION_CONTEXT);\r\n\r\n\t\tthis.observe(umbExtensionsRegistry.byType('tiptapToolbarExtension'), (extensions) => {\r\n\t\t\tconst _extensions = extensions\r\n\t\t\t\t.sort((a, b) => a.alias.localeCompare(b.alias))\r\n\t\t\t\t.map((ext) => ({\r\n\t\t\t\t\tkind: (ext.kind as string) ?? 'button',\r\n\t\t\t\t\talias: ext.alias,\r\n\t\t\t\t\tlabel: ext.meta.label,\r\n\t\t\t\t\ticon: ext.meta.icon,\r\n\t\t\t\t\tdependencies: ext.forExtensions,\r\n\t\t\t\t}));\r\n\r\n\t\t\tthis.#extensions.setValue(_extensions);\r\n\r\n\t\t\tthis.#lookup = new Map(_extensions.map((ext) => [ext.alias, ext]));\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, async (dataset) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tawait dataset?.propertyValueByAlias<Array<string>>('extensions'),\r\n\t\t\t\t(extensions) => {\r\n\t\t\t\t\tif (extensions) {\r\n\t\t\t\t\t\tthis.#extensionsEnabled.clear();\r\n\t\t\t\t\t\tthis.#reload.setValue(false);\r\n\r\n\t\t\t\t\t\tthis.#extensions\r\n\t\t\t\t\t\t\t.getValue()\r\n\t\t\t\t\t\t\t.filter((x) => !x.dependencies || x.dependencies.every((z) => extensions.includes(z)))\r\n\t\t\t\t\t\t\t.map((x) => x.alias)\r\n\t\t\t\t\t\t\t.forEach((alias) => this.#extensionsEnabled.add(alias));\r\n\r\n\t\t\t\t\t\tthis.#reload.setValue(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'_observeExtensions',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic cloneToolbarValue(value?: UmbTiptapToolbarValue | null): UmbTiptapToolbarValue {\r\n\t\tif (!this.isValidToolbarValue(value)) return [[[]]];\r\n\t\treturn value.map((row) => row.map((group) => [...group]));\r\n\t}\r\n\r\n\tpublic filterExtensions(query: string): Array<UmbTiptapToolbarExtension> {\r\n\t\treturn this.#extensions\r\n\t\t\t.getValue()\r\n\t\t\t.filter((ext) => ext.alias?.toLowerCase().includes(query) || ext.label?.toLowerCase().includes(query));\r\n\t}\r\n\r\n\tpublic getExtensionByAlias(alias: string): UmbTiptapToolbarExtension {\r\n\t\treturn this.#lookup?.get(alias) ?? { label: '', alias, icon: '', kind: 'unknown' };\r\n\t}\r\n\r\n\tpublic isExtensionEnabled(alias: string): boolean {\r\n\t\treturn this.#extensionsEnabled.has(alias);\r\n\t}\r\n\r\n\tpublic isExtensionInUse(alias: string): boolean {\r\n\t\treturn this.#extensionsInUse.has(alias);\r\n\t}\r\n\r\n\tpublic isValidToolbarValue(value: unknown): value is UmbTiptapToolbarValue {\r\n\t\tif (!Array.isArray(value)) return false;\r\n\t\tfor (const row of value) {\r\n\t\t\tif (!Array.isArray(row)) return false;\r\n\t\t\tfor (const group of row) {\r\n\t\t\t\tif (!Array.isArray(group)) return false;\r\n\t\t\t\tfor (const alias of group) {\r\n\t\t\t\t\tif (typeof alias !== 'string') return false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic insertToolbarItem(alias: string, to: [number, number, number]) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\r\n\t\tconst [rowIndex, groupIndex, itemIndex] = to;\r\n\r\n\t\tconst row = toolbar[rowIndex];\r\n\t\tconst rowData = [...row.data];\r\n\t\tconst group = rowData[groupIndex];\r\n\t\tconst items = [...group.data];\r\n\r\n\t\titems.splice(itemIndex, 0, alias);\r\n\t\tthis.#extensionsInUse.add(alias);\r\n\r\n\t\trowData[groupIndex] = { unique: group.unique, data: items };\r\n\t\ttoolbar[rowIndex] = { unique: row.unique, data: rowData };\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic insertToolbarGroup(rowIndex: number, groupIndex: number) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\t\tconst row = toolbar[rowIndex];\r\n\t\tconst groups = [...row.data];\r\n\t\tgroups.splice(groupIndex, 0, { unique: UmbId.new(), data: [] });\r\n\t\ttoolbar[rowIndex] = { unique: row.unique, data: groups };\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic insertToolbarRow(rowIndex: number) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\t\ttoolbar.splice(rowIndex, 0, { unique: UmbId.new(), data: [{ unique: UmbId.new(), data: [] }] });\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic moveToolbarItem(from: [number, number, number], to: [number, number, number]) {\r\n\t\tconst [fromRowIndex, fromGroupIndex, fromItemIndex] = from;\r\n\t\tconst [toRowIndex, toGroupIndex, toItemIndex] = to;\r\n\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\r\n\t\tconst fromRow = toolbar[fromRowIndex];\r\n\t\tconst fromRowData = [...fromRow.data];\r\n\t\tconst fromGroup = fromRowData[fromGroupIndex];\r\n\t\tconst fromItems = [...fromGroup.data];\r\n\r\n\t\tconst toBeMoved = fromItems.splice(fromItemIndex, 1);\r\n\r\n\t\tfromRowData[fromGroupIndex] = { unique: fromGroup.unique, data: fromItems };\r\n\t\ttoolbar[fromRowIndex] = { unique: fromRow.unique, data: fromRowData };\r\n\r\n\t\tconst toRow = toolbar[toRowIndex];\r\n\t\tconst toRowData = [...toRow.data];\r\n\t\tconst toGroup = toRowData[toGroupIndex];\r\n\t\tconst toItems = [...toGroup.data];\r\n\r\n\t\ttoItems.splice(toItemIndex, 0, toBeMoved[0]);\r\n\r\n\t\ttoRowData[toGroupIndex] = { unique: toGroup.unique, data: toItems };\r\n\t\ttoolbar[toRowIndex] = { unique: toRow.unique, data: toRowData };\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic removeToolbarItem(from: [number, number, number]) {\r\n\t\tconst [rowIndex, groupIndex, itemIndex] = from;\r\n\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\t\tconst row = toolbar[rowIndex];\r\n\t\tconst rowData = [...row.data];\r\n\t\tconst group = rowData[groupIndex];\r\n\t\tconst items = [...group.data];\r\n\r\n\t\tconst removed = items.splice(itemIndex, 1);\r\n\t\tremoved.forEach((alias) => this.#extensionsInUse.delete(alias));\r\n\r\n\t\trowData[groupIndex] = { unique: group.unique, data: items };\r\n\t\ttoolbar[rowIndex] = { unique: row.unique, data: rowData };\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic removeToolbarGroup(rowIndex: number, groupIndex: number) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\r\n\t\tif (toolbar[rowIndex].data.length > groupIndex) {\r\n\t\t\tconst row = toolbar[rowIndex];\r\n\t\t\tconst groups = [...row.data];\r\n\t\t\tconst removed = groups.splice(groupIndex, 1);\r\n\t\t\tremoved.forEach((group) => group.data.forEach((alias) => this.#extensionsInUse.delete(alias)));\r\n\t\t\ttoolbar[rowIndex] = { unique: row.unique, data: groups };\r\n\t\t}\r\n\r\n\t\t// Prevent leaving an empty group\r\n\t\tif (toolbar[rowIndex].data.length === 0) {\r\n\t\t\ttoolbar[rowIndex].data[0] = { unique: UmbId.new(), data: [] };\r\n\t\t}\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic removeToolbarRow(rowIndex: number) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\r\n\t\tif (toolbar.length > rowIndex) {\r\n\t\t\tconst removed = toolbar.splice(rowIndex, 1);\r\n\t\t\tremoved.forEach((row) =>\r\n\t\t\t\trow.data.forEach((group) => group.data.forEach((alias) => this.#extensionsInUse.delete(alias))),\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Prevent leaving an empty row\r\n\t\tif (toolbar.length === 0) {\r\n\t\t\ttoolbar[0] = { unique: UmbId.new(), data: [{ unique: UmbId.new(), data: [] }] };\r\n\t\t}\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic setToolbar(value?: UmbTiptapToolbarValue | null) {\r\n\t\tif (!this.isValidToolbarValue(value)) {\r\n\t\t\tvalue = [[[]]];\r\n\t\t}\r\n\r\n\t\tthis.#extensionsInUse.clear();\r\n\t\tvalue.forEach((row) => row.forEach((group) => group.forEach((alias) => this.#extensionsInUse.add(alias))));\r\n\r\n\t\tconst toolbar = value.map((row) => ({\r\n\t\t\tunique: UmbId.new(),\r\n\t\t\tdata: row.map((group) => ({ unique: UmbId.new(), data: group })),\r\n\t\t}));\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n\r\n\tpublic updateToolbarItem(aliases: Array<string>, to: [number, number]) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\t\tconst [rowIndex, groupIndex] = to;\r\n\r\n\t\tconst newToolbar = toolbar.map((row, rIdx) => {\r\n\t\t\tif (rIdx !== rowIndex) return row;\r\n\t\t\treturn {\r\n\t\t\t\t...row,\r\n\t\t\t\tdata: row.data.map((group, gIdx) => {\r\n\t\t\t\t\tif (gIdx !== groupIndex) return group;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...group,\r\n\t\t\t\t\t\tdata: [...aliases],\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tthis.#toolbar.setValue(newToolbar);\r\n\t}\r\n\r\n\tpublic updateToolbarRow(rowIndex: number, groups: Array<UmbTiptapToolbarGroupViewModel>) {\r\n\t\tconst toolbar = [...this.#toolbar.getValue()];\r\n\r\n\t\tconst row = toolbar[rowIndex];\r\n\t\ttoolbar[rowIndex] = { unique: row.unique, data: groups };\r\n\r\n\t\tthis.#toolbar.setValue(toolbar);\r\n\t}\r\n}\r\n","import type { UmbTiptapToolbarExtension } from '../types.js';\r\nimport { UmbTiptapToolbarConfigurationContext } from './tiptap-toolbar-configuration.context.js';\r\nimport { css, customElement, html, property, repeat, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbSorterController, UmbSorterResolvePlacementAsGrid } from '@umbraco-cms/backoffice/sorter';\r\n\r\n@customElement('umb-tiptap-toolbar-group-configuration')\r\nexport class UmbTiptapToolbarGroupConfigurationElement<\r\n\tTiptapToolbarItem extends UmbTiptapToolbarExtension = UmbTiptapToolbarExtension,\r\n> extends UmbLitElement {\r\n\t#sorter = new UmbSorterController<TiptapToolbarItem, HTMLElement>(this, {\r\n\t\tgetUniqueOfElement: (element) => element.dataset.mark,\r\n\t\tgetUniqueOfModel: (modelEntry) => `tiptap-toolbar-item:${modelEntry.alias}`,\r\n\t\titemSelector: '.draggable',\r\n\t\tidentifier: 'umb-tiptap-toolbar-sorter',\r\n\t\tcontainerSelector: '.items',\r\n\t\tresolvePlacement: UmbSorterResolvePlacementAsGrid,\r\n\t\tonContainerChange: ({ item, model }) => {\r\n\t\t\tthis.dispatchEvent(new CustomEvent('container-change', { detail: { item, model } }));\r\n\t\t},\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.#items = model;\r\n\t\t\tthis.requestUpdate();\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t},\r\n\t});\r\n\r\n\t#context = new UmbTiptapToolbarConfigurationContext(this);\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tpublic set items(value: Array<TiptapToolbarItem> | undefined) {\r\n\t\tthis.#items = (value ?? []).filter((item, index, self) => self.findIndex((x) => x.alias === item.alias) === index);\r\n\t\tthis.#sorter.setModel(this.#items);\r\n\t}\r\n\tpublic get items(): Array<TiptapToolbarItem> {\r\n\t\treturn this.#items;\r\n\t}\r\n\t#items: Array<TiptapToolbarItem> = [];\r\n\r\n\t@property({ type: Number })\r\n\trowIndex = 0;\r\n\r\n\t@property({ type: Number })\r\n\tgroupIndex = 0;\r\n\r\n\t#onRequestRemove(item: TiptapToolbarItem, index = 0) {\r\n\t\tthis.items = this.items.filter((x) => x.alias !== item.alias);\r\n\t\tconst rowIndex = this.rowIndex;\r\n\t\tconst groupIndex = this.groupIndex;\r\n\t\tthis.dispatchEvent(\r\n\t\t\tnew CustomEvent('remove', { detail: { rowIndex, groupIndex, index }, bubbles: true, composed: true }),\r\n\t\t);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"items\">\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis.items?.length === 0,\r\n\t\t\t\t\t() => html`<em><umb-localize key=\"tiptap_toolbar_emptyGroup\">Empty</umb-localize></em>`,\r\n\t\t\t\t\t() =>\r\n\t\t\t\t\t\trepeat(\r\n\t\t\t\t\t\t\tthis.items,\r\n\t\t\t\t\t\t\t(item) => item.alias,\r\n\t\t\t\t\t\t\t(item, index) => this.#renderItem(item, index),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItem(item: TiptapToolbarItem, index = 0) {\r\n\t\tconst label = this.localize.string(item.label) || item.alias;\r\n\t\tconst forbidden = !this.#context?.isExtensionEnabled(item.alias);\r\n\r\n\t\tswitch (item.kind) {\r\n\t\t\tcase 'styleMenu':\r\n\t\t\tcase 'menu':\r\n\t\t\t\treturn html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tclass=\"draggable ${forbidden ? 'forbidden' : ''}\"\r\n\t\t\t\t\t\tdata-mark=\"tiptap-toolbar-item:${item.alias}\"\r\n\t\t\t\t\t\tlook=${forbidden ? 'placeholder' : 'outline'}\r\n\t\t\t\t\t\tlabel=${label}\r\n\t\t\t\t\t\ttitle=${label}\r\n\t\t\t\t\t\t@click=${() => this.#onRequestRemove(item, index)}>\r\n\t\t\t\t\t\t<div class=\"inner\">\r\n\t\t\t\t\t\t\t<span>${label}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<uui-symbol-expand slot=\"extra\" open></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`;\r\n\r\n\t\t\tcase 'unknown':\r\n\t\t\t\treturn html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tdata-mark=\"tiptap-toolbar-item:${item.alias}\"\r\n\t\t\t\t\t\tcolor=\"danger\"\r\n\t\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t\tlabel=\"Missing extension\"\r\n\t\t\t\t\t\ttitle=\"Missing extension: ${item.alias}\"\r\n\t\t\t\t\t\t@click=${() => this.#onRequestRemove(item, index)}></uui-button>\r\n\t\t\t\t`;\r\n\r\n\t\t\tcase 'button':\r\n\t\t\tcase 'colorPickerButton':\r\n\t\t\tdefault:\r\n\t\t\t\treturn html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tclass=\"draggable ${forbidden ? 'forbidden' : ''}\"\r\n\t\t\t\t\t\tdata-mark=\"tiptap-toolbar-item:${item.alias}\"\r\n\t\t\t\t\t\tlook=${forbidden ? 'placeholder' : 'outline'}\r\n\t\t\t\t\t\tlabel=${label}\r\n\t\t\t\t\t\ttitle=${label}\r\n\t\t\t\t\t\t@click=${() => this.#onRequestRemove(item, index)}>\r\n\t\t\t\t\t\t<div class=\"inner\">\r\n\t\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\t\titem.icon,\r\n\t\t\t\t\t\t\t\t() => html`<umb-icon .name=${item.icon}></umb-icon>`,\r\n\t\t\t\t\t\t\t\t() => html`<span>${label}</span>`,\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t.items {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: row;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-1);\r\n\r\n\t\t\t\tuui-button {\r\n\t\t\t\t\t--uui-button-font-weight: normal;\r\n\r\n\t\t\t\t\t&.draggable,\r\n\t\t\t\t\t&.draggable > .inner {\r\n\t\t\t\t\t\tcursor: move;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&.forbidden {\r\n\t\t\t\t\t\t--color: var(--uui-color-danger);\r\n\t\t\t\t\t\t--color-standalone: var(--uui-color-danger-standalone);\r\n\t\t\t\t\t\t--color-emphasis: var(--uui-color-danger-emphasis);\r\n\t\t\t\t\t\t--color-contrast: var(--uui-color-danger);\r\n\t\t\t\t\t\t--uui-button-contrast: var(--uui-color-danger);\r\n\t\t\t\t\t\t--uui-button-border-color: var(--uui-color-danger);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdiv {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tgap: var(--uui-size-1);\r\n\t\t\t\t\t\talign-items: flex-end;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tuui-symbol-expand {\r\n\t\t\t\t\t\tmargin-left: var(--uui-size-space-2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tuui-button[look='outline'] {\r\n\t\t\t\t--uui-button-background-color-hover: var(--uui-color-surface);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbTiptapToolbarGroupConfigurationElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-tiptap-toolbar-group-configuration': UmbTiptapToolbarGroupConfigurationElement;\r\n\t}\r\n}\r\n","import type {\r\n\tUmbTiptapToolbarExtension,\r\n\tUmbTiptapToolbarGroupViewModel,\r\n\tUmbTiptapToolbarRowViewModel,\r\n} from '../types.js';\r\nimport type { UmbTiptapToolbarValue } from '../../components/types.js';\r\nimport { UmbTiptapToolbarConfigurationContext } from './tiptap-toolbar-configuration.context.js';\r\nimport type { UmbTiptapToolbarGroupConfigurationElement } from './tiptap-toolbar-group-configuration.element.js';\r\nimport { customElement, css, html, property, repeat, state, when, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { debounce } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\nimport './tiptap-toolbar-group-configuration.element.js';\r\n\r\n@customElement('umb-property-editor-ui-tiptap-toolbar-configuration')\r\nexport class UmbPropertyEditorUiTiptapToolbarConfigurationElement\r\n\textends UmbLitElement\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#context = new UmbTiptapToolbarConfigurationContext(this);\r\n\r\n\t#currentDragItem?: { alias: string; fromPos?: [number, number, number] };\r\n\r\n\t#debouncedFilter = debounce((query: string) => {\r\n\t\tthis._availableExtensions = this.#context.filterExtensions(query);\r\n\t}, 250);\r\n\r\n\t#initialized = false;\r\n\r\n\t@state()\r\n\tprivate _availableExtensions: Array<UmbTiptapToolbarExtension> = [];\r\n\r\n\t@state()\r\n\tprivate _toolbar: Array<UmbTiptapToolbarRowViewModel> = [];\r\n\r\n\t@property({ attribute: false })\r\n\tset value(value: UmbTiptapToolbarValue | undefined) {\r\n\t\tif (!value) value = [[[]]];\r\n\t\tif (value === this.#value) return;\r\n\t\tthis.#value = this.#context.isValidToolbarValue(value) ? value : [[[]]];\r\n\t}\r\n\tget value(): UmbTiptapToolbarValue | undefined {\r\n\t\tif (this.#value === undefined) return undefined;\r\n\t\treturn this.#context.cloneToolbarValue(this.#value);\r\n\t}\r\n\t#value?: UmbTiptapToolbarValue;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_CONTEXT, (propertyContext) => {\r\n\t\t\tthis.observe(this.#context.extensions, (extensions) => {\r\n\t\t\t\tthis._availableExtensions = extensions;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#context.reload, (reload) => {\r\n\t\t\t\tif (reload) this.requestUpdate();\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#context.toolbar, (toolbar) => {\r\n\t\t\t\tif (!toolbar.length) return;\r\n\t\t\t\tthis._toolbar = toolbar;\r\n\t\t\t\tif (this.#initialized) {\r\n\t\t\t\t\tthis.#value = toolbar.map((rows) => rows.data.map((groups) => [...groups.data]));\r\n\t\t\t\t\tpropertyContext?.setValue(this.#value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprotected override firstUpdated() {\r\n\t\tthis.#context.setToolbar(this.value);\r\n\t\tthis.#initialized = true;\r\n\t}\r\n\r\n\t#onChangeToolbarGroup(event: CustomEvent & { target: UmbTiptapToolbarGroupConfigurationElement }) {\r\n\t\tevent.stopPropagation();\r\n\t\tconst element = event.target;\r\n\t\tconst aliases = element.items.map((item) => item.alias);\r\n\t\tthis.#context.updateToolbarItem(aliases, [element.rowIndex, element.groupIndex]);\r\n\t}\r\n\r\n\t#onClickAvailableItem(item: UmbTiptapToolbarExtension) {\r\n\t\tconst lastRow = (this.#value?.length ?? 1) - 1;\r\n\t\tconst lastGroup = (this.#value?.[lastRow].length ?? 1) - 1;\r\n\t\tconst lastItem = this.#value?.[lastRow][lastGroup].length ?? 0;\r\n\t\tthis.#context.insertToolbarItem(item.alias, [lastRow, lastGroup, lastItem]);\r\n\t}\r\n\r\n\t#onDragStart(event: DragEvent, alias: string, fromPos?: [number, number, number]) {\r\n\t\tevent.dataTransfer!.effectAllowed = 'move';\r\n\t\tthis.#currentDragItem = { alias, fromPos };\r\n\t}\r\n\r\n\t#onDragOver(event: DragEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tevent.dataTransfer!.dropEffect = 'move';\r\n\t}\r\n\r\n\t#onDragEnd(event: DragEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tif (event.dataTransfer?.dropEffect === 'none') {\r\n\t\t\tconst { fromPos } = this.#currentDragItem ?? {};\r\n\t\t\tif (!fromPos) return;\r\n\r\n\t\t\tthis.#context.removeToolbarItem(fromPos);\r\n\t\t}\r\n\t}\r\n\r\n\t#onDrop(event: DragEvent, toPos?: [number, number, number]) {\r\n\t\tevent.preventDefault();\r\n\t\tconst { alias, fromPos } = this.#currentDragItem ?? {};\r\n\r\n\t\t// Remove item if no destination position is provided\r\n\t\tif (fromPos && !toPos) {\r\n\t\t\tthis.#context.removeToolbarItem(fromPos);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Move item if both source and destination positions are available\r\n\t\tif (fromPos && toPos) {\r\n\t\t\tthis.#context.moveToolbarItem(fromPos, toPos);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Insert item if an alias and a destination position are provided\r\n\t\tif (alias && toPos) {\r\n\t\t\tthis.#context.insertToolbarItem(alias, toPos);\r\n\t\t}\r\n\t}\r\n\r\n\t#onFilterInput(event: InputEvent & { target: HTMLInputElement }) {\r\n\t\tconst query = (event.target.value ?? '').toLocaleLowerCase();\r\n\t\tthis.#debouncedFilter(query);\r\n\t}\r\n\r\n\t#onRemoveToolbarItem(event: CustomEvent) {\r\n\t\tconst { groupIndex, index, rowIndex } = event.detail;\r\n\t\tthis.#context?.removeToolbarItem([rowIndex, groupIndex, index]);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderDesigner()} ${this.#renderAvailableItems()}`;\r\n\t}\r\n\r\n\t#renderAvailableItems() {\r\n\t\tconst label = this.localize.term('placeholders_filter');\r\n\t\treturn html`\r\n\t\t\t<uui-box id=\"toolbox\" headline=${this.localize.term('tiptap_toobar_availableItems')}>\r\n\t\t\t\t<div slot=\"header-actions\">\r\n\t\t\t\t\t<uui-input type=\"search\" autocomplete=\"off\" label=${label} placeholder=${label} @input=${this.#onFilterInput}>\r\n\t\t\t\t\t\t<div slot=\"prepend\">\r\n\t\t\t\t\t\t\t<uui-icon name=\"search\"></uui-icon>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</uui-input>\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-scroll-container>\r\n\t\t\t\t\t<div class=\"available-items\" dropzone=\"move\" @drop=${this.#onDrop} @dragover=${this.#onDragOver}>\r\n\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\tthis._availableExtensions.length === 0,\r\n\t\t\t\t\t\t\t() =>\r\n\t\t\t\t\t\t\t\thtml`<umb-localize key=\"tiptap_toobar_availableItemsEmpty\"\r\n\t\t\t\t\t\t\t\t\t>There are no toolbar extensions to show</umb-localize\r\n\t\t\t\t\t\t\t\t>`,\r\n\t\t\t\t\t\t\t() => repeat(this._availableExtensions, (item) => this.#renderAvailableItem(item)),\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-scroll-container>\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAvailableItem(item: UmbTiptapToolbarExtension) {\r\n\t\tconst forbidden = !this.#context.isExtensionEnabled(item.alias);\r\n\t\tconst inUse = this.#context.isExtensionInUse(item.alias);\r\n\t\tif (inUse || forbidden) return nothing;\r\n\t\tconst label = this.localize.string(item.label);\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tcompact\r\n\t\t\t\tclass=${forbidden ? 'forbidden' : ''}\r\n\t\t\t\tdata-mark=\"tiptap-toolbar-item:${item.alias}\"\r\n\t\t\t\tdraggable=\"true\"\r\n\t\t\t\tlabel=${label}\r\n\t\t\t\tlook=${forbidden ? 'placeholder' : 'outline'}\r\n\t\t\t\t?disabled=${forbidden || inUse}\r\n\t\t\t\t@click=${() => this.#onClickAvailableItem(item)}\r\n\t\t\t\t@dragstart=${(e: DragEvent) => this.#onDragStart(e, item.alias)}\r\n\t\t\t\t@dragend=${this.#onDragEnd}>\r\n\t\t\t\t<div class=\"inner\">\r\n\t\t\t\t\t${when(item.icon, () => html`<umb-icon .name=${item.icon}></umb-icon>`)}\r\n\t\t\t\t\t<span>${label}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDesigner() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"toolbar\">\r\n\t\t\t\t<div id=\"rows\">\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._toolbar,\r\n\t\t\t\t\t\t(row) => row.unique,\r\n\t\t\t\t\t\t(row, idx) => this.#renderRow(row, idx),\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tid=\"btnAddRow\"\r\n\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\tlabel=${this.localize.term('tiptap_toolbar_addRow')}\r\n\t\t\t\t\t@click=${() => this.#context.insertToolbarRow(this._toolbar.length)}></uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRow(row?: UmbTiptapToolbarRowViewModel, rowIndex = 0) {\r\n\t\tif (!row) return nothing;\r\n\t\tconst hideActionBar = this._toolbar.length === 1;\r\n\t\treturn html`\r\n\t\t\t<uui-button-inline-create\r\n\t\t\t\tlabel=${this.localize.term('tiptap_toolbar_addRow')}\r\n\t\t\t\t@click=${() => this.#context?.insertToolbarRow(rowIndex)}></uui-button-inline-create>\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"groups\">\r\n\t\t\t\t\t<uui-button-inline-create\r\n\t\t\t\t\t\tvertical\r\n\t\t\t\t\t\tlabel=${this.localize.term('tiptap_toolbar_addGroup')}\r\n\t\t\t\t\t\t@click=${() => this.#context?.insertToolbarGroup(rowIndex, 0)}></uui-button-inline-create>\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\trow.data,\r\n\t\t\t\t\t\t(group) => group.unique,\r\n\t\t\t\t\t\t(group, idx) => this.#renderGroup(group, rowIndex, idx),\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t${when(\r\n\t\t\t\t\t!hideActionBar,\r\n\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t<uui-action-bar>\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t\t\tlabel=${this.localize.term('tiptap_toolbar_removeRow')}\r\n\t\t\t\t\t\t\t\t@click=${() => this.#context?.removeToolbarRow(rowIndex)}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</uui-action-bar>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderGroup(group?: UmbTiptapToolbarGroupViewModel, rowIndex = 0, groupIndex = 0) {\r\n\t\tif (!group) return nothing;\r\n\t\tconst showActionBar = this._toolbar[rowIndex].data.length > 1 && group.data.length === 0;\r\n\t\tconst items = group.data.map((alias) => this.#context?.getExtensionByAlias(alias));\r\n\t\treturn html`\r\n\t\t\t<div\r\n\t\t\t\tclass=\"group\"\r\n\t\t\t\tdropzone=\"move\"\r\n\t\t\t\t@dragover=${this.#onDragOver}\r\n\t\t\t\t@drop=${(e: DragEvent) => this.#onDrop(e, [rowIndex, groupIndex, group.data.length - 1])}>\r\n\t\t\t\t<umb-tiptap-toolbar-group-configuration\r\n\t\t\t\t\t.items=${items}\r\n\t\t\t\t\t.rowIndex=${rowIndex}\r\n\t\t\t\t\t.groupIndex=${groupIndex}\r\n\t\t\t\t\t@change=${this.#onChangeToolbarGroup}\r\n\t\t\t\t\t@remove=${this.#onRemoveToolbarItem}>\r\n\t\t\t\t</umb-tiptap-toolbar-group-configuration>\r\n\t\t\t\t${when(\r\n\t\t\t\t\tshowActionBar,\r\n\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t<uui-action-bar>\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t\t\tlabel=${this.localize.term('tiptap_toolbar_removeGroup')}\r\n\t\t\t\t\t\t\t\t@click=${() => this.#context?.removeToolbarGroup(rowIndex, groupIndex)}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</uui-action-bar>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t\t<uui-button-inline-create\r\n\t\t\t\tvertical\r\n\t\t\t\tlabel=${this.localize.term('tiptap_toolbar_addGroup')}\r\n\t\t\t\t@click=${() => this.#context?.insertToolbarGroup(rowIndex, groupIndex + 1)}></uui-button-inline-create>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t\tflex-grow: 1;\r\n\t\t\t}\r\n\r\n\t\t\t@media (min-width: 1400px) {\r\n\t\t\t\t:host {\r\n\t\t\t\t\tflex-direction: row;\r\n\t\t\t\t}\r\n\t\t\t\t#toolbox {\r\n\t\t\t\t\twidth: 500px;\r\n\t\t\t\t\tmax-width: 33%;\r\n\t\t\t\t\tflex-grow: 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t#toolbar {\r\n\t\t\t\t\tflex-grow: 100;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t#toolbox {\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\tuui-box {\r\n\t\t\t\t[slot='header-actions'] {\r\n\t\t\t\t\tmargin-bottom: var(--uui-size-2);\r\n\r\n\t\t\t\t\tuui-icon {\r\n\t\t\t\t\t\tcolor: var(--uui-color-border);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tuui-scroll-container {\r\n\t\t\t\tmax-height: 350px;\r\n\t\t\t}\r\n\r\n\t\t\t.available-items {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\tgap: var(--uui-size-3);\r\n\r\n\t\t\t\tuui-button {\r\n\t\t\t\t\t--uui-button-font-weight: normal;\r\n\r\n\t\t\t\t\t&[draggable='true'],\r\n\t\t\t\t\t&[draggable='true'] > .inner {\r\n\t\t\t\t\t\tcursor: move;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&[disabled],\r\n\t\t\t\t\t&[disabled] > .inner {\r\n\t\t\t\t\t\tcursor: not-allowed;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&.forbidden {\r\n\t\t\t\t\t\t--color: var(--uui-color-danger);\r\n\t\t\t\t\t\t--color-standalone: var(--uui-color-danger-standalone);\r\n\t\t\t\t\t\t--color-emphasis: var(--uui-color-danger-emphasis);\r\n\t\t\t\t\t\t--color-contrast: var(--uui-color-danger);\r\n\t\t\t\t\t\t--uui-button-contrast-disabled: var(--uui-color-danger);\r\n\t\t\t\t\t\t--uui-button-border-color-disabled: var(--uui-color-danger);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdiv {\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tgap: var(--uui-size-1);\r\n\t\t\t\t\t\talign-items: flex-end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tuui-button-inline-create:not([vertical]) {\r\n\t\t\t\tmargin-bottom: -4px;\r\n\t\t\t}\r\n\r\n\t\t\t#rows {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-1);\r\n\r\n\t\t\t\t.row {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: flex-start;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\tgap: var(--uui-size-3);\r\n\r\n\t\t\t\t\t&:not(:last-child) {\r\n\t\t\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&:focus-within,\r\n\t\t\t\t\t&:hover {\r\n\t\t\t\t\t\tborder-color: var(--uui-color-border-standalone);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.groups {\r\n\t\t\t\t\t\tflex: 1;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tflex-direction: row;\r\n\t\t\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tjustify-content: flex-start;\r\n\t\t\t\t\t\tgap: var(--uui-size-1);\r\n\r\n\t\t\t\t\t\tuui-button-inline-create {\r\n\t\t\t\t\t\t\theight: 50px;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.group {\r\n\t\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\t\tflex-direction: row;\r\n\t\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\t\t\tgap: var(--uui-size-3);\r\n\r\n\t\t\t\t\t\t\tborder: 1px dashed transparent;\r\n\t\t\t\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\t\t\t\tpadding: var(--uui-size-3);\r\n\r\n\t\t\t\t\t\t\t> uui-action-bar {\r\n\t\t\t\t\t\t\t\topacity: 0;\r\n\t\t\t\t\t\t\t\ttransition: opacity 120ms;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t&:focus-within,\r\n\t\t\t\t\t\t\t&:hover {\r\n\t\t\t\t\t\t\t\tborder-color: var(--uui-color-border-standalone);\r\n\t\t\t\t\t\t\t\t> uui-action-bar {\r\n\t\t\t\t\t\t\t\t\topacity: 1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t#btnAddRow {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmargin-top: var(--uui-size-1);\r\n\t\t\t}\r\n\r\n\t\t\t.handle {\r\n\t\t\t\tcursor: move;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbPropertyEditorUiTiptapToolbarConfigurationElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-tiptap-toolbar-configuration': UmbPropertyEditorUiTiptapToolbarConfigurationElement;\r\n\t}\r\n}\r\n"],"names":["UmbTiptapToolbarConfigurationContext","UmbContextBase","host","UMB_TIPTAP_TOOLBAR_CONFIGURATION_CONTEXT","#extensions","UmbArrayState","x","#reload","UmbBooleanState","#extensionsEnabled","#extensionsInUse","#toolbar","umbExtensionsRegistry","extensions","_extensions","a","b","ext","#lookup","UMB_PROPERTY_DATASET_CONTEXT","dataset","z","alias","value","row","group","query","to","toolbar","rowIndex","groupIndex","itemIndex","rowData","items","groups","UmbId","from","fromRowIndex","fromGroupIndex","fromItemIndex","toRowIndex","toGroupIndex","toItemIndex","fromRow","fromRowData","fromGroup","fromItems","toBeMoved","toRow","toRowData","toGroup","toItems","aliases","newToolbar","rIdx","gIdx","_sorter","_context","_items","_UmbTiptapToolbarGroupConfigurationElement_instances","onRequestRemove_fn","renderItem_fn","UmbTiptapToolbarGroupConfigurationElement","UmbLitElement","__privateAdd","UmbSorterController","element","modelEntry","UmbSorterResolvePlacementAsGrid","item","model","__privateSet","UmbChangeEvent","index","self","__privateGet","html","when","repeat","__privateMethod","label","forbidden","css","__decorateClass","property","customElement","_currentDragItem","_debouncedFilter","_initialized","_value","_UmbPropertyEditorUiTiptapToolbarConfigurationElement_instances","onChangeToolbarGroup_fn","onClickAvailableItem_fn","onDragStart_fn","onDragOver_fn","onDragEnd_fn","onDrop_fn","onFilterInput_fn","onRemoveToolbarItem_fn","renderAvailableItems_fn","renderAvailableItem_fn","renderDesigner_fn","renderRow_fn","renderGroup_fn","UmbPropertyEditorUiTiptapToolbarConfigurationElement","debounce","UMB_PROPERTY_CONTEXT","propertyContext","reload","rows","event","lastRow","lastGroup","lastItem","fromPos","toPos","inUse","nothing","e","idx","hideActionBar","showActionBar","state"],"mappings":"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"}