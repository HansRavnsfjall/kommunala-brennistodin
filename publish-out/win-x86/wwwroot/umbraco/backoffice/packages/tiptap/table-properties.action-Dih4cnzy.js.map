{"version":3,"file":"table-properties.action-Dih4cnzy.js","sources":["../../../src/packages/tiptap/extensions/table/actions/table-properties.action.ts"],"sourcesContent":["import { UmbTiptapMenuItemActionApi } from '../../../components/menu/tiptap-menu-item-api-base.js';\r\nimport { UMB_TIPTAP_RTE_CONTEXT } from '../../../contexts/tiptap-rte.context-token.js';\r\nimport { UMB_TIPTAP_TABLE_PROPERTIES_MODAL } from '../modals/table-properties-modal.token.js';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { Editor } from '@umbraco-cms/backoffice/external/tiptap';\r\n\r\nexport default class UmbTablePropertiesAction extends UmbTiptapMenuItemActionApi {\r\n\tasync #tableProperties(editor?: Editor) {\r\n\t\tif (!editor || !editor.isActive('table')) return;\r\n\r\n\t\tconst modalData = this.#getModalData(editor);\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager?.open(this, UMB_TIPTAP_TABLE_PROPERTIES_MODAL, modalData);\r\n\r\n\t\tif (!modal) return;\r\n\r\n\t\tconst data = await modal.onSubmit().catch(() => undefined);\r\n\t\tif (!data) return;\r\n\r\n\t\tconst style = this.#getStyles(data);\r\n\t\tif (!style) return;\r\n\r\n\t\teditor?.chain().focus().updateAttributes('table', { style }).run();\r\n\t}\r\n\r\n\t#getModalData(editor?: Editor) {\r\n\t\tconst tableStyles = (editor?.getAttributes('table').style as string) ?? '';\r\n\t\tconst table = document.createElement('table');\r\n\t\ttable.style.cssText = tableStyles;\r\n\r\n\t\tconst data: Record<string, unknown> = {};\r\n\r\n\t\tdata.alignment = this.#getAlignment(table.style);\r\n\t\tif (table.style.backgroundColor) data.backgroundColor = table.style.backgroundColor;\r\n\t\tif (table.style.borderColor) data.borderColor = table.style.borderColor;\r\n\t\tif (table.style.borderStyle) data.borderStyle = table.style.borderStyle;\r\n\t\tif (table.style.borderWidth) data.borderWidth = table.style.borderWidth;\r\n\t\tif (table.style.height) data.height = table.style.height;\r\n\t\tif (table.style.width) data.width = table.style.width;\r\n\r\n\t\treturn { data };\r\n\t}\r\n\r\n\t#getAlignment(style: CSSStyleDeclaration) {\r\n\t\tif (style.marginLeft === 'auto' && style.marginRight === 'auto') {\r\n\t\t\treturn 'center';\r\n\t\t} else if (style.marginRight === 'auto') {\r\n\t\t\treturn 'left';\r\n\t\t} else if (style.marginLeft === 'auto') {\r\n\t\t\treturn 'right';\r\n\t\t}\r\n\t\treturn 'none';\r\n\t}\r\n\r\n\t#getStyles(data: typeof UMB_TIPTAP_TABLE_PROPERTIES_MODAL.VALUE) {\r\n\t\tconst styles: Record<string, unknown> = {};\r\n\r\n\t\t// TODO: Move this to a shared utility function. [LK]\r\n\t\tconst camelCaseToKebabCase = (str: string): string => {\r\n\t\t\treturn str.replace(/[A-Z]+(?![a-z])|[A-Z]/g, ($, ofs) => (ofs ? '-' : '') + $.toLowerCase());\r\n\t\t};\r\n\r\n\t\tfor (const item of data) {\r\n\t\t\tif (!item.value) continue;\r\n\r\n\t\t\tswitch (item.alias) {\r\n\t\t\t\tcase 'alignment': {\r\n\t\t\t\t\tconst alignment =\r\n\t\t\t\t\t\tArray.isArray(item.value) && item.value.length ? (item.value[0] as string) : ((item.value as string) ?? '');\r\n\t\t\t\t\tswitch (alignment) {\r\n\t\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\t\tstyles['margin-right'] = 'auto';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'center':\r\n\t\t\t\t\t\t\tstyles['margin-left'] = 'auto';\r\n\t\t\t\t\t\t\tstyles['margin-right'] = 'auto';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\t\tstyles['margin-left'] = 'auto';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tstyles['margin-left'] = 'none';\r\n\t\t\t\t\t\t\tstyles['margin-right'] = 'none';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase 'borderStyle': {\r\n\t\t\t\t\tconst borderStyle =\r\n\t\t\t\t\t\tArray.isArray(item.value) && item.value.length ? (item.value[0] as string) : ((item.value as string) ?? '');\r\n\t\t\t\t\tif (borderStyle) styles['border-style'] = borderStyle;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcase 'backgroundColor':\r\n\t\t\t\tcase 'borderColor':\r\n\t\t\t\tcase 'borderWidth':\r\n\t\t\t\tcase 'height':\r\n\t\t\t\tcase 'width': {\r\n\t\t\t\t\tconst propertyName = camelCaseToKebabCase(item.alias);\r\n\t\t\t\t\tstyles[propertyName] = item.value;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Object.entries(styles)\r\n\t\t\t.map(([key, value]) => `${key}: ${value}`)\r\n\t\t\t.join(';');\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tconst ctx = await this.getContext(UMB_TIPTAP_RTE_CONTEXT);\r\n\t\tthis.#tableProperties(ctx?.getEditor());\r\n\t}\r\n}\r\n"],"names":["UmbTablePropertiesAction","UmbTiptapMenuItemActionApi","#tableProperties","editor","modalData","#getModalData","modal","UMB_MODAL_MANAGER_CONTEXT","UMB_TIPTAP_TABLE_PROPERTIES_MODAL","data","style","#getStyles","tableStyles","table","#getAlignment","styles","camelCaseToKebabCase","str","$","ofs","item","borderStyle","propertyName","key","value","ctx","UMB_TIPTAP_RTE_CONTEXT"],"mappings":"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"}