{"version":3,"file":"tiptap-toolbar-menu.element-9SMGzmQW.js","sources":["../../../src/packages/tiptap/components/toolbar/tiptap-toolbar-menu.element.ts"],"sourcesContent":["import type {\r\n\tManifestTiptapToolbarExtensionMenuKind,\r\n\tMetaTiptapToolbarMenuItem,\r\n\tUmbTiptapToolbarElementApi,\r\n} from '../../extensions/index.js';\r\nimport type { UmbCascadingMenuItem } from '../cascading-menu-popover/cascading-menu-popover.element.js';\r\nimport { css, customElement, html, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { Editor } from '@umbraco-cms/backoffice/external/tiptap';\r\nimport type { ManifestMenu } from '@umbraco-cms/backoffice/menu';\r\n\r\nimport '../cascading-menu-popover/cascading-menu-popover.element.js';\r\n\r\n@customElement('umb-tiptap-toolbar-menu')\r\nexport class UmbTiptapToolbarMenuElement extends UmbLitElement {\r\n\t#menu: Array<UmbCascadingMenuItem> = [];\r\n\r\n\t@state()\r\n\tprotected isActive = false;\r\n\r\n\tpublic api?: UmbTiptapToolbarElementApi;\r\n\r\n\tpublic editor?: Editor;\r\n\r\n\tpublic set manifest(value: ManifestTiptapToolbarExtensionMenuKind | undefined) {\r\n\t\tthis.#manifest = value;\r\n\t\tthis.#setMenu();\r\n\t}\r\n\tpublic get manifest(): ManifestTiptapToolbarExtensionMenuKind | undefined {\r\n\t\treturn this.#manifest;\r\n\t}\r\n\t#manifest?: ManifestTiptapToolbarExtensionMenuKind | undefined;\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tif (this.editor) {\r\n\t\t\tthis.editor.on('selectionUpdate', this.#onEditorUpdate);\r\n\t\t\tthis.editor.on('update', this.#onEditorUpdate);\r\n\t\t}\r\n\t}\r\n\r\n\toverride disconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\r\n\t\tif (this.editor) {\r\n\t\t\tthis.editor.off('selectionUpdate', this.#onEditorUpdate);\r\n\t\t\tthis.editor.off('update', this.#onEditorUpdate);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #setMenu() {\r\n\t\tconst items = this.#manifest?.items ?? this.#manifest?.meta.items;\r\n\t\tif (!items) return;\r\n\t\tthis.#menu = await this.#getMenuItems(items);\r\n\t}\r\n\r\n\tasync #getMenuItems(items: Array<MetaTiptapToolbarMenuItem>): Promise<Array<UmbCascadingMenuItem>> {\r\n\t\tconst menu = [];\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tconst menuItem = await this.#getMenuItem(item);\r\n\t\t\tmenu.push(menuItem);\r\n\t\t}\r\n\r\n\t\treturn menu;\r\n\t}\r\n\r\n\tasync #getMenuItem(item: MetaTiptapToolbarMenuItem): Promise<UmbCascadingMenuItem> {\r\n\t\tlet element;\r\n\r\n\t\t// TODO: Commented out as needs review of how async/await is being handled here. [LK]\r\n\t\t// if (item.element) {\r\n\t\t// \tconst elementConstructor = await loadManifestElement(item.element);\r\n\t\t// \tif (elementConstructor) {\r\n\t\t// \t\telement = new elementConstructor();\r\n\t\t// \t}\r\n\t\t// }\r\n\r\n\t\tif (!element && item.elementName) {\r\n\t\t\telement = document.createElement(item.elementName);\r\n\t\t}\r\n\r\n\t\tif (element) {\r\n\t\t\t// TODO: Enforce a type for the element, that has an `editor` property. [LK]\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t\t// @ts-ignore\r\n\t\t\telement.editor = this.editor;\r\n\t\t}\r\n\r\n\t\tlet items;\r\n\t\tif (item.items) {\r\n\t\t\titems = await this.#getMenuItems(item.items);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ticon: item.appearance?.icon ?? item.icon,\r\n\t\t\titems,\r\n\t\t\tlabel: item.label,\r\n\t\t\tmenu: item.menu,\r\n\t\t\tstyle: item.appearance?.style ?? item.style,\r\n\t\t\tseparatorAfter: item.separatorAfter,\r\n\t\t\telement,\r\n\t\t\tisActive: () => this.api?.isActive(this.editor, item),\r\n\t\t\texecute: () => this.api?.execute(this.editor, item),\r\n\t\t};\r\n\t}\r\n\r\n\t#isMenuActive(items?: UmbCascadingMenuItem[]): boolean {\r\n\t\treturn !!items?.some((item) => item.isActive?.() || this.#isMenuActive(item.items));\r\n\t}\r\n\r\n\treadonly #onEditorUpdate = () => {\r\n\t\tif (this.api && this.editor && this.manifest) {\r\n\t\t\tthis.isActive = this.api.isActive(this.editor) || this.#isMenuActive(this.#menu) || false;\r\n\t\t}\r\n\t};\r\n\r\n\toverride render() {\r\n\t\tconst label = this.localize.string(this.manifest?.meta.label);\r\n\t\tconst disabled = this.api?.isDisabled(this.editor);\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis.manifest?.meta.look === 'icon',\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlabel=${label}\r\n\t\t\t\t\t\tlook=${this.isActive ? 'outline' : 'default'}\r\n\t\t\t\t\t\ttitle=${label}\r\n\t\t\t\t\t\tpopovertarget=\"popover-menu\"\r\n\t\t\t\t\t\t?disabled=${disabled}>\r\n\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\tthis.manifest?.meta.icon,\r\n\t\t\t\t\t\t\t(icon) => html`<umb-icon name=${icon}></umb-icon>`,\r\n\t\t\t\t\t\t\t() => html`<span>${label}</span>`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<uui-symbol-expand slot=\"extra\" open></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`,\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlabel=${label}\r\n\t\t\t\t\t\tlook=${this.isActive ? 'outline' : 'default'}\r\n\t\t\t\t\t\tpopovertarget=\"popover-menu\"\r\n\t\t\t\t\t\t?disabled=${disabled}>\r\n\t\t\t\t\t\t<span>${label}</span>\r\n\t\t\t\t\t\t<uui-symbol-expand slot=\"extra\" open></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`,\r\n\t\t\t)}\r\n\t\t\t${this.renderMenu()}\r\n\t\t`;\r\n\t}\r\n\r\n\tprotected renderMenu() {\r\n\t\treturn html`\r\n\t\t\t<umb-cascading-menu-popover id=\"popover-menu\" placement=\"bottom-start\" .items=${this.#menu}>\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis.#manifest?.menu,\r\n\t\t\t\t\t(menuAlias) => html`\r\n\t\t\t\t\t\t<umb-extension-slot\r\n\t\t\t\t\t\t\ttype=\"menu\"\r\n\t\t\t\t\t\t\tdefault-element=\"umb-tiptap-menu\"\r\n\t\t\t\t\t\t\tsingle\r\n\t\t\t\t\t\t\t.filter=${(menu: ManifestMenu) => menu.alias === menuAlias}></umb-extension-slot>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t</umb-cascading-menu-popover>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\t--uui-button-font-weight: normal;\r\n\t\t\t\t--uui-menu-item-flat-structure: 1;\r\n\r\n\t\t\t\tmargin-left: var(--uui-size-space-1);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\tuui-button > uui-symbol-expand {\r\n\t\t\t\tmargin-left: var(--uui-size-space-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbTiptapToolbarMenuElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-tiptap-toolbar-menu': UmbTiptapToolbarMenuElement;\r\n\t}\r\n}\r\n"],"names":["_menu","_manifest","_UmbTiptapToolbarMenuElement_instances","setMenu_fn","getMenuItems_fn","getMenuItem_fn","isMenuActive_fn","_onEditorUpdate","UmbTiptapToolbarMenuElement","UmbLitElement","__privateAdd","__privateMethod","__privateGet","value","__privateSet","label","disabled","html","when","icon","menuAlias","menu","items","item","menuItem","element","css","__decorateClass","state","customElement"],"mappings":"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"}