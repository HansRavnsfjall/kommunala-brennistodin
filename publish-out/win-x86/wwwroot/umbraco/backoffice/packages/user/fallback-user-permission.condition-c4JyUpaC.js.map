{"version":3,"file":"fallback-user-permission.condition-c4JyUpaC.js","sources":["../../../src/packages/user/user-permission/fallback-permission-condition/fallback-user-permission.condition.ts"],"sourcesContent":["import type { UmbFallbackUserPermissionConditionConfig } from './types.js';\r\nimport { UMB_CURRENT_USER_CONTEXT } from '@umbraco-cms/backoffice/current-user';\r\nimport type { UmbConditionControllerArguments, UmbExtensionCondition } from '@umbraco-cms/backoffice/extension-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbConditionBase } from '@umbraco-cms/backoffice/extension-registry';\r\n\r\nexport class UmbFallbackUserPermissionCondition\r\n\textends UmbConditionBase<UmbFallbackUserPermissionConditionConfig>\r\n\timplements UmbExtensionCondition\r\n{\r\n\tconstructor(\r\n\t\thost: UmbControllerHost,\r\n\t\targs: UmbConditionControllerArguments<UmbFallbackUserPermissionConditionConfig>,\r\n\t) {\r\n\t\tsuper(host, args);\r\n\r\n\t\tthis.consumeContext(UMB_CURRENT_USER_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext?.currentUser,\r\n\t\t\t\t(currentUser) => {\r\n\t\t\t\t\tconst fallbackPermissions = currentUser?.fallbackPermissions || [];\r\n\t\t\t\t\tthis.#check(fallbackPermissions);\r\n\t\t\t\t},\r\n\t\t\t\t'umbUserFallbackPermissionConditionObserver',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\t#check(verbs: Array<string>) {\r\n\t\t/* we default to true se we don't require both allOf and oneOf to be defined\r\n\t\t but they can be combined for more complex scenarios */\r\n\t\tlet allOfPermitted = true;\r\n\t\tlet oneOfPermitted = true;\r\n\r\n\t\t// check if all of the verbs are present\r\n\t\tif (this.config.allOf?.length) {\r\n\t\t\tallOfPermitted = this.config.allOf.every((verb) => verbs.includes(verb));\r\n\t\t}\r\n\r\n\t\t// check if at least one of the verbs is present\r\n\t\tif (this.config.oneOf?.length) {\r\n\t\t\toneOfPermitted = this.config.oneOf.some((verb) => verbs.includes(verb));\r\n\t\t}\r\n\r\n\t\t// if neither allOf or oneOf is defined we default to false\r\n\t\tif (!allOfPermitted && !oneOfPermitted) {\r\n\t\t\tallOfPermitted = false;\r\n\t\t\toneOfPermitted = false;\r\n\t\t}\r\n\r\n\t\tthis.permitted = allOfPermitted && oneOfPermitted;\r\n\t}\r\n}\r\n\r\nexport { UmbFallbackUserPermissionCondition as api };\r\n"],"names":["UmbFallbackUserPermissionCondition","UmbConditionBase","host","args","UMB_CURRENT_USER_CONTEXT","context","currentUser","fallbackPermissions","#check","verbs","allOfPermitted","oneOfPermitted","verb"],"mappings":";;AAMO,MAAMA,UACJC,EAET;AAAA,EACC,YACCC,GACAC,GACC;AACD,UAAMD,GAAMC,CAAI,GAEhB,KAAK,eAAeC,GAA0B,CAACC,MAAY;AAC1D,WAAK;AAAA,QACJA,GAAS;AAAA,QACT,CAACC,MAAgB;AAChB,gBAAMC,IAAsBD,GAAa,uBAAuB,CAAA;AAChE,eAAKE,GAAOD,CAAmB;AAAA,QAChC;AAAA,QACA;AAAA,MAAA;AAAA,IAEF,CAAC;AAAA,EACF;AAAA,EAEAC,GAAOC,GAAsB;AAG5B,QAAIC,IAAiB,IACjBC,IAAiB;AAGrB,IAAI,KAAK,OAAO,OAAO,WACtBD,IAAiB,KAAK,OAAO,MAAM,MAAM,CAACE,MAASH,EAAM,SAASG,CAAI,CAAC,IAIpE,KAAK,OAAO,OAAO,WACtBD,IAAiB,KAAK,OAAO,MAAM,KAAK,CAACC,MAASH,EAAM,SAASG,CAAI,CAAC,IAInE,CAACF,KAAkB,CAACC,MACvBD,IAAiB,IACjBC,IAAiB,KAGlB,KAAK,YAAYD,KAAkBC;AAAA,EACpC;AACD;"}