{"version":3,"file":"user-config.repository-C37bO5BY.js","sources":["../../../src/packages/user/user/repository/config/user-config.server.data-source.ts","../../../src/packages/user/user/repository/config/user-config.repository.ts"],"sourcesContent":["import type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UserService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\nexport class UmbUserConfigServerDataSource {\r\n\t#host;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the user configuration.\r\n\t * @memberof UmbUserConfigServerDataSource\r\n\t */\r\n\tgetUserConfig() {\r\n\t\treturn tryExecute(this.#host, UserService.getUserConfiguration());\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current user configuration.\r\n\t * @memberof UmbUserConfigServerDataSource\r\n\t */\r\n\tgetCurrentUserConfig() {\r\n\t\treturn tryExecute(this.#host, UserService.getUserCurrentConfiguration());\r\n\t}\r\n}\r\n","import type { UmbUserConfigurationModel } from '../../types.js';\r\nimport { UmbUserConfigServerDataSource } from './user-config.server.data-source.js';\r\nimport { UMB_USER_CONFIG_STORE_CONTEXT } from './user-config.store.token.js';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { Observable } from '@umbraco-cms/backoffice/observable-api';\r\n\r\nexport class UmbUserConfigRepository extends UmbRepositoryBase implements UmbApi {\r\n\t/**\r\n\t * Promise that resolves when the repository has been initialized, i.e. when the user configuration has been fetched from the server.\r\n\t * @memberof UmbUserConfigRepository\r\n\t */\r\n\tinitialized: Promise<void>;\r\n\r\n\t#dataStore?: typeof UMB_USER_CONFIG_STORE_CONTEXT.TYPE;\r\n\t#dataSource = new UmbUserConfigServerDataSource(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.initialized = new Promise<void>((resolve) => {\r\n\t\t\tthis.consumeContext(UMB_USER_CONFIG_STORE_CONTEXT, async (store) => {\r\n\t\t\t\tif (store) {\r\n\t\t\t\t\tthis.#dataStore = store;\r\n\t\t\t\t\tawait this.#init();\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #init() {\r\n\t\t// Check if the store already has data\r\n\t\tif (this.#dataStore?.getState()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { data } = await this.#dataSource.getUserConfig();\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#dataStore?.update(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Subscribe to the entire user configuration.\r\n\t */\r\n\tall() {\r\n\t\tif (!this.#dataStore) {\r\n\t\t\tthrow new Error('Data store not initialized');\r\n\t\t}\r\n\r\n\t\treturn this.#dataStore.all();\r\n\t}\r\n\r\n\t/**\r\n\t * Subscribe to a part of the user configuration.\r\n\t * @param part\r\n\t */\r\n\tpart<Part extends keyof UmbUserConfigurationModel>(part: Part): Observable<UmbUserConfigurationModel[Part]> {\r\n\t\tif (!this.#dataStore) {\r\n\t\t\tthrow new Error('Data store not initialized');\r\n\t\t}\r\n\r\n\t\treturn this.#dataStore.part(part);\r\n\t}\r\n}\r\n\r\nexport default UmbUserConfigRepository;\r\n"],"names":["UmbUserConfigServerDataSource","#host","host","tryExecute","UserService","UmbUserConfigRepository","UmbRepositoryBase","#dataStore","#dataSource","resolve","UMB_USER_CONFIG_STORE_CONTEXT","store","#init","data","part"],"mappings":";;;;AAIO,MAAMA,EAA8B;AAAA,EAC1CC;AAAA,EAEA,YAAYC,GAAyB;AACpC,SAAKD,KAAQC;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,gBAAgB;AACf,WAAOC,EAAW,KAAKF,IAAOG,EAAY,sBAAsB;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,uBAAuB;AACtB,WAAOD,EAAW,KAAKF,IAAOG,EAAY,6BAA6B;AAAA,EACxE;AACD;AClBO,MAAMC,UAAgCC,EAAoC;AAAA,EAOhFC;AAAA,EACAC,KAAc,IAAIR,EAA8B,IAAI;AAAA,EAEpD,YAAYE,GAAyB;AACpC,UAAMA,CAAI,GACV,KAAK,cAAc,IAAI,QAAc,CAACO,MAAY;AACjD,WAAK,eAAeC,GAA+B,OAAOC,MAAU;AACnE,QAAIA,MACH,KAAKJ,KAAaI,GAClB,MAAM,KAAKC,GAAA,GACXH,EAAA;AAAA,MAEF,CAAC;AAAA,IACF,CAAC;AAAA,EACF;AAAA,EAEA,MAAMG,KAAQ;AAEb,QAAI,KAAKL,IAAY;AACpB;AAGD,UAAM,EAAE,MAAAM,EAAA,IAAS,MAAM,KAAKL,GAAY,cAAA;AAExC,IAAIK,KACH,KAAKN,IAAY,OAAOM,CAAI;AAAA,EAE9B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM;AACL,QAAI,CAAC,KAAKN;AACT,YAAM,IAAI,MAAM,4BAA4B;AAG7C,WAAO,KAAKA,GAAW,IAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAmDO,GAAyD;AAC3G,QAAI,CAAC,KAAKP;AACT,YAAM,IAAI,MAAM,4BAA4B;AAG7C,WAAO,KAAKA,GAAW,KAAKO,CAAI;AAAA,EACjC;AACD;"}