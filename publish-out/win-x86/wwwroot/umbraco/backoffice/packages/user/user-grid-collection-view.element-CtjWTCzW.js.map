{"version":3,"file":"user-grid-collection-view.element-CtjWTCzW.js","sources":["../../../src/packages/user/user/collection/views/grid/user-grid-collection-view.element.ts"],"sourcesContent":["import { getDisplayStateFromUserStatus, TimeFormatOptions } from '../../../utils.js';\r\nimport { UmbUserKind } from '../../../utils/index.js';\r\nimport { UMB_USER_COLLECTION_CONTEXT } from '../../user-collection.context-token.js';\r\nimport { UMB_USER_WORKSPACE_PATH } from '../../../paths.js';\r\nimport type { UmbUserCollectionContext } from '../../user-collection.context.js';\r\nimport type { UmbUserDetailModel } from '../../../types.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tnothing,\r\n\trepeat,\r\n\tstate,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbUserGroupCollectionRepository } from '@umbraco-cms/backoffice/user-group';\r\nimport { UserStateModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbUserGroupDetailModel } from '@umbraco-cms/backoffice/user-group';\r\n\r\n@customElement('umb-user-grid-collection-view')\r\nexport class UmbUserGridCollectionViewElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _users: Array<UmbUserDetailModel> = [];\r\n\r\n\t@state()\r\n\tprivate _selection: Array<string | null> = [];\r\n\r\n\t@state()\r\n\tprivate _loading = false;\r\n\r\n\t#userGroups: Array<UmbUserGroupDetailModel> = [];\r\n\r\n\t#collectionContext?: UmbUserCollectionContext;\r\n\r\n\t// TODO: we need to use the item repository here\r\n\t#userGroupCollectionRepository = new UmbUserGroupCollectionRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_USER_COLLECTION_CONTEXT, (instance) => {\r\n\t\t\tthis.#collectionContext = instance;\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#collectionContext?.selection.selection,\r\n\t\t\t\t(selection) => (this._selection = selection ?? []),\r\n\t\t\t\t'umbCollectionSelectionObserver',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#collectionContext?.items,\r\n\t\t\t\t(items) => (this._users = items ?? []),\r\n\t\t\t\t'umbCollectionItemsObserver',\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\tthis.#requestUserGroups();\r\n\t}\r\n\r\n\tasync #requestUserGroups() {\r\n\t\tthis._loading = true;\r\n\r\n\t\tconst { data } = await this.#userGroupCollectionRepository.requestCollection();\r\n\r\n\t\tthis.#userGroups = data?.items ?? [];\r\n\r\n\t\tthis._loading = false;\r\n\t}\r\n\r\n\t#onSelect(user: UmbUserDetailModel) {\r\n\t\tthis.#collectionContext?.selection.select(user.unique ?? '');\r\n\t}\r\n\r\n\t#onDeselect(user: UmbUserDetailModel) {\r\n\t\tthis.#collectionContext?.selection.deselect(user.unique ?? '');\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) return nothing;\r\n\t\treturn html`\r\n\t\t\t<div id=\"user-grid\">\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._users,\r\n\t\t\t\t\t(user) => user.unique,\r\n\t\t\t\t\t(user) => this.#renderUserCard(user),\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUserCard(user: UmbUserDetailModel) {\r\n\t\treturn html`\r\n\t\t\t<uui-card-user\r\n\t\t\t\t.name=${user.name ?? this.localize.term('general_unnamed')}\r\n\t\t\t\thref=\"${UMB_USER_WORKSPACE_PATH}/edit/${user.unique}\"\r\n\t\t\t\tselectable\r\n\t\t\t\t?select-only=${this._selection.length > 0}\r\n\t\t\t\t?selected=${this.#collectionContext?.selection.isSelected(user.unique)}\r\n\t\t\t\t@selected=${() => this.#onSelect(user)}\r\n\t\t\t\t@deselected=${() => this.#onDeselect(user)}>\r\n\t\t\t\t${this.#renderUserTag(user)} ${this.#renderUserGroupNames(user)} ${this.#renderUserLoginDate(user)}\r\n\t\t\t\t<umb-user-avatar\r\n\t\t\t\t\tslot=\"avatar\"\r\n\t\t\t\t\t.name=${user.name}\r\n\t\t\t\t\t.kind=${user.kind}\r\n\t\t\t\t\t.imgUrls=${user.avatarUrls}></umb-user-avatar>\r\n\t\t\t</uui-card-user>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUserTag(user: UmbUserDetailModel) {\r\n\t\tif (user.state && user.state === UserStateModel.ACTIVE) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\tconst statusLook = user.state ? getDisplayStateFromUserStatus(user.state) : undefined;\r\n\t\treturn html`\r\n\t\t\t<uui-tag slot=\"tag\" look=${ifDefined(statusLook?.look)} color=${ifDefined(statusLook?.color)}>\r\n\t\t\t\t<umb-localize key=${'user_' + statusLook?.key}></umb-localize>\r\n\t\t\t</uui-tag>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUserGroupNames(user: UmbUserDetailModel) {\r\n\t\tconst userGroupNames = this.#userGroups\r\n\t\t\t.filter((userGroup) => user.userGroupUniques?.map((reference) => reference.unique).includes(userGroup.unique))\r\n\t\t\t.map((userGroup) => userGroup.name)\r\n\t\t\t.join(', ');\r\n\r\n\t\treturn html`<div>${userGroupNames}</div>`;\r\n\t}\r\n\r\n\t#renderUserLoginDate(user: UmbUserDetailModel) {\r\n\t\tif (user.kind === UmbUserKind.API) return nothing;\r\n\t\treturn html`\r\n\t\t\t<div class=\"user-login-time\">\r\n\t\t\t\t${when(\r\n\t\t\t\t\tuser.lastLoginDate,\r\n\t\t\t\t\t(lastLoginDate) => html`\r\n\t\t\t\t\t\t<umb-localize key=\"user_lastLogin\">Last login</umb-localize>\r\n\t\t\t\t\t\t<span>${this.localize.date(lastLoginDate, TimeFormatOptions)}</span>\r\n\t\t\t\t\t`,\r\n\t\t\t\t\t() => html`<umb-localize key=\"user_noLogin\">has not logged in yet</umb-localize>`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t#user-grid {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\tuui-card-user {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tjustify-content: normal;\r\n\t\t\t\tpadding-top: var(--uui-size-space-5);\r\n\t\t\t\tflex-direction: column;\r\n\r\n\t\t\t\tumb-user-avatar {\r\n\t\t\t\t\tfont-size: 1.6rem;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.user-login-time {\r\n\t\t\t\tmargin-top: var(--uui-size-1);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbUserGridCollectionViewElement;\r\n\r\nexport { UmbUserGridCollectionViewElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-user-grid-collection-view': UmbUserGridCollectionViewElement;\r\n\t}\r\n}\r\n"],"names":["_userGroups","_collectionContext","_userGroupCollectionRepository","_UmbUserGridCollectionViewElement_instances","requestUserGroups_fn","onSelect_fn","onDeselect_fn","renderUserCard_fn","renderUserTag_fn","renderUserGroupNames_fn","renderUserLoginDate_fn","UmbUserGridCollectionViewElement","UmbLitElement","__privateAdd","UmbUserGroupCollectionRepository","UMB_USER_COLLECTION_CONTEXT","instance","__privateSet","__privateGet","selection","items","__privateMethod","nothing","html","repeat","user","data","UMB_USER_WORKSPACE_PATH","UserStateModel","statusLook","getDisplayStateFromUserStatus","ifDefined","userGroupNames","userGroup","reference","UmbUserKind","when","lastLoginDate","TimeFormatOptions","UmbTextStyles","css","__decorateClass","state","customElement","UmbUserGridCollectionViewElement$1"],"mappings":"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"}