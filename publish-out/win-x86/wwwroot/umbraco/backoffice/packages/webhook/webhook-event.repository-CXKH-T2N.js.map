{"version":3,"file":"webhook-event.repository-CXKH-T2N.js","sources":["../../../src/packages/webhook/webhook-event/repository/webhook-event.server.data-source.ts","../../../src/packages/webhook/webhook-event/repository/webhook-event.repository.ts"],"sourcesContent":["import { WebhookService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\n/**\r\n * A data source for the Webhook that fetches data from the server\r\n * @class UmbWebhookEventServerDataSource\r\n * @implements {RepositoryEventDataSource}\r\n */\r\nexport class UmbWebhookEventServerDataSource {\r\n\t#host: UmbControllerHost;\r\n\r\n\t/**\r\n\t * Creates an instance of UmbWebhookEventServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbWebhookEventServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\tasync getAll() {\r\n\t\tconst { data, error } = await tryExecute(this.#host, WebhookService.getWebhookEvents());\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\tconst items = data.items.map((item) => {\r\n\t\t\treturn {\r\n\t\t\t\teventName: item.eventName,\r\n\t\t\t\teventType: item.eventType,\r\n\t\t\t\talias: item.alias,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tdata: {\r\n\t\t\t\titems,\r\n\t\t\t\ttotal: items.length,\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n}\r\n","import { UmbWebhookEventServerDataSource } from './webhook-event.server.data-source.js';\r\nimport type { UmbWebhookEventStore } from './webhook-event.store.js';\r\nimport { UMB_WEBHOOK_EVENT_STORE_CONTEXT } from './webhook-event.store.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\r\n\r\nexport class UmbWebhookEventRepository extends UmbRepositoryBase implements UmbApi {\r\n\t#init: Promise<unknown>;\r\n\r\n\t#store?: UmbWebhookEventStore;\r\n\t#source: UmbWebhookEventServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#source = new UmbWebhookEventServerDataSource(host);\r\n\r\n\t\tthis.#init = this.consumeContext(UMB_WEBHOOK_EVENT_STORE_CONTEXT, (instance) => {\r\n\t\t\tif (instance) {\r\n\t\t\t\tthis.#store = instance;\r\n\t\t\t}\r\n\t\t})\r\n\t\t\t.asPromise({ preventTimeout: true })\r\n\t\t\t// Ignore the error, we can assume that the flow was stopped (asPromise failed), but it does not mean that the consumption was not successful.\r\n\t\t\t.catch(() => undefined);\r\n\t}\r\n\r\n\tasync requestEvents() {\r\n\t\tawait this.#init;\r\n\r\n\t\tconst { data, error } = await this.#source.getAll();\r\n\r\n\t\tif (!this.#store) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#store.appendItems(data.items);\r\n\t\t}\r\n\r\n\t\treturn { data, error, asObservable: () => this.#store!.all() };\r\n\t}\r\n}\r\n\r\nexport default UmbWebhookEventRepository;\r\n"],"names":["UmbWebhookEventServerDataSource","#host","host","data","error","tryExecute","WebhookService","items","item","UmbWebhookEventRepository","UmbRepositoryBase","#init","#store","#source","UMB_WEBHOOK_EVENT_STORE_CONTEXT","instance"],"mappings":";;;;AASO,MAAMA,EAAgC;AAAA,EAC5CC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAYC,GAAyB;AACpC,SAAKD,KAAQC;AAAA,EACd;AAAA,EAEA,MAAM,SAAS;AACd,UAAM,EAAE,MAAAC,GAAM,OAAAC,EAAA,IAAU,MAAMC,EAAW,KAAKJ,IAAOK,EAAe,kBAAkB;AAEtF,QAAIF,KAAS,CAACD;AACb,aAAO,EAAE,OAAAC,EAAA;AAGV,UAAMG,IAAQJ,EAAK,MAAM,IAAI,CAACK,OACtB;AAAA,MACN,WAAWA,EAAK;AAAA,MAChB,WAAWA,EAAK;AAAA,MAChB,OAAOA,EAAK;AAAA,IAAA,EAEb;AAED,WAAO;AAAA,MACN,MAAM;AAAA,QACL,OAAAD;AAAA,QACA,OAAOA,EAAM;AAAA,MAAA;AAAA,IACd;AAAA,EAEF;AACD;ACpCO,MAAME,UAAkCC,EAAoC;AAAA,EAClFC;AAAA,EAEAC;AAAA,EACAC;AAAA,EAEA,YAAYX,GAAyB;AACpC,UAAMA,CAAI,GAEV,KAAKW,KAAU,IAAIb,EAAgCE,CAAI,GAEvD,KAAKS,KAAQ,KAAK,eAAeG,GAAiC,CAACC,MAAa;AAC/E,MAAIA,MACH,KAAKH,KAASG;AAAA,IAEhB,CAAC,EACC,UAAU,EAAE,gBAAgB,IAAM,EAElC,MAAM,MAAA;AAAA,KAAe;AAAA,EACxB;AAAA,EAEA,MAAM,gBAAgB;AACrB,UAAM,KAAKJ;AAEX,UAAM,EAAE,MAAAR,GAAM,OAAAC,EAAA,IAAU,MAAM,KAAKS,GAAQ,OAAA;AAE3C,WAAK,KAAKD,MAINT,KACH,KAAKS,GAAO,YAAYT,EAAK,KAAK,GAG5B,EAAE,MAAAA,GAAM,OAAAC,GAAO,cAAc,MAAM,KAAKQ,GAAQ,MAAI,KAPnD,CAAA;AAAA,EAQT;AACD;"}