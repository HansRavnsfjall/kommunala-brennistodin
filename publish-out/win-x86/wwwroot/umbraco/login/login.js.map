{"version":3,"file":"login.js","sources":["../../../../Umbraco.Web.UI.Login/src/api/core/bodySerializer.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/core/serverSentEvents.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/core/pathSerializer.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/core/utils.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/core/auth.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/client/utils.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/client/client.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/client.gen.ts","../../../../Umbraco.Web.UI.Login/src/api/sdk.gen.ts","../../../../Umbraco.Web.UI.Login/src/contexts/auth.repository.ts","../../../../Umbraco.Web.UI.Login/src/contexts/auth.context.ts","../../../../Umbraco.Web.UI.Login/src/controllers/slim-backoffice-initializer.ts","../../../../Umbraco.Web.UI.Login/src/umbraco-package.ts","../../../../Umbraco.Web.UI.Login/src/auth.element.ts","../../../../Umbraco.Web.UI.Login/src/components/layouts/auth-layout.element.ts","../../../../Umbraco.Web.UI.Login/src/components/layouts/confirmation-layout.element.ts","../../../../Umbraco.Web.UI.Login/src/components/layouts/error-layout.element.ts","../../../../Umbraco.Web.UI.Login/src/components/layouts/new-password-layout.element.ts","../../../../Umbraco.Web.UI.Login/src/components/pages/invite.page.element.ts","../../../../Umbraco.Web.UI.Login/src/components/pages/login.page.element.ts","../../../../Umbraco.Web.UI.Login/src/utils/load-custom-view.function.ts","../../../../Umbraco.Web.UI.Login/src/components/pages/mfa.page.element.ts","../../../../Umbraco.Web.UI.Login/src/components/pages/new-password.page.element.ts","../../../../Umbraco.Web.UI.Login/src/components/pages/reset-password.page.element.ts","../../../../Umbraco.Web.UI.Login/src/components/back-to-login-button.element.ts"],"sourcesContent":["// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport type {\r\n  ArrayStyle,\r\n  ObjectStyle,\r\n  SerializerOptions,\r\n} from './pathSerializer.gen';\r\n\r\nexport type QuerySerializer = (query: Record<string, unknown>) => string;\r\n\r\nexport type BodySerializer = (body: any) => any;\r\n\r\nexport interface QuerySerializerOptions {\r\n  allowReserved?: boolean;\r\n  array?: SerializerOptions<ArrayStyle>;\r\n  object?: SerializerOptions<ObjectStyle>;\r\n}\r\n\r\nconst serializeFormDataPair = (\r\n  data: FormData,\r\n  key: string,\r\n  value: unknown,\r\n): void => {\r\n  if (typeof value === 'string' || value instanceof Blob) {\r\n    data.append(key, value);\r\n  } else if (value instanceof Date) {\r\n    data.append(key, value.toISOString());\r\n  } else {\r\n    data.append(key, JSON.stringify(value));\r\n  }\r\n};\r\n\r\nconst serializeUrlSearchParamsPair = (\r\n  data: URLSearchParams,\r\n  key: string,\r\n  value: unknown,\r\n): void => {\r\n  if (typeof value === 'string') {\r\n    data.append(key, value);\r\n  } else {\r\n    data.append(key, JSON.stringify(value));\r\n  }\r\n};\r\n\r\nexport const formDataBodySerializer = {\r\n  bodySerializer: <T extends Record<string, any> | Array<Record<string, any>>>(\r\n    body: T,\r\n  ): FormData => {\r\n    const data = new FormData();\r\n\r\n    Object.entries(body).forEach(([key, value]) => {\r\n      if (value === undefined || value === null) {\r\n        return;\r\n      }\r\n      if (Array.isArray(value)) {\r\n        value.forEach((v) => serializeFormDataPair(data, key, v));\r\n      } else {\r\n        serializeFormDataPair(data, key, value);\r\n      }\r\n    });\r\n\r\n    return data;\r\n  },\r\n};\r\n\r\nexport const jsonBodySerializer = {\r\n  bodySerializer: <T>(body: T): string =>\r\n    JSON.stringify(body, (_key, value) =>\r\n      typeof value === 'bigint' ? value.toString() : value,\r\n    ),\r\n};\r\n\r\nexport const urlSearchParamsBodySerializer = {\r\n  bodySerializer: <T extends Record<string, any> | Array<Record<string, any>>>(\r\n    body: T,\r\n  ): string => {\r\n    const data = new URLSearchParams();\r\n\r\n    Object.entries(body).forEach(([key, value]) => {\r\n      if (value === undefined || value === null) {\r\n        return;\r\n      }\r\n      if (Array.isArray(value)) {\r\n        value.forEach((v) => serializeUrlSearchParamsPair(data, key, v));\r\n      } else {\r\n        serializeUrlSearchParamsPair(data, key, value);\r\n      }\r\n    });\r\n\r\n    return data.toString();\r\n  },\r\n};\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport type { Config } from './types.gen';\r\n\r\nexport type ServerSentEventsOptions<TData = unknown> = Omit<\r\n  RequestInit,\r\n  'method'\r\n> &\r\n  Pick<Config, 'method' | 'responseTransformer' | 'responseValidator'> & {\r\n    /**\r\n     * Fetch API implementation. You can use this option to provide a custom\r\n     * fetch instance.\r\n     *\r\n     * @default globalThis.fetch\r\n     */\r\n    fetch?: typeof fetch;\r\n    /**\r\n     * Implementing clients can call request interceptors inside this hook.\r\n     */\r\n    onRequest?: (url: string, init: RequestInit) => Promise<Request>;\r\n    /**\r\n     * Callback invoked when a network or parsing error occurs during streaming.\r\n     *\r\n     * This option applies only if the endpoint returns a stream of events.\r\n     *\r\n     * @param error The error that occurred.\r\n     */\r\n    onSseError?: (error: unknown) => void;\r\n    /**\r\n     * Callback invoked when an event is streamed from the server.\r\n     *\r\n     * This option applies only if the endpoint returns a stream of events.\r\n     *\r\n     * @param event Event streamed from the server.\r\n     * @returns Nothing (void).\r\n     */\r\n    onSseEvent?: (event: StreamEvent<TData>) => void;\r\n    serializedBody?: RequestInit['body'];\r\n    /**\r\n     * Default retry delay in milliseconds.\r\n     *\r\n     * This option applies only if the endpoint returns a stream of events.\r\n     *\r\n     * @default 3000\r\n     */\r\n    sseDefaultRetryDelay?: number;\r\n    /**\r\n     * Maximum number of retry attempts before giving up.\r\n     */\r\n    sseMaxRetryAttempts?: number;\r\n    /**\r\n     * Maximum retry delay in milliseconds.\r\n     *\r\n     * Applies only when exponential backoff is used.\r\n     *\r\n     * This option applies only if the endpoint returns a stream of events.\r\n     *\r\n     * @default 30000\r\n     */\r\n    sseMaxRetryDelay?: number;\r\n    /**\r\n     * Optional sleep function for retry backoff.\r\n     *\r\n     * Defaults to using `setTimeout`.\r\n     */\r\n    sseSleepFn?: (ms: number) => Promise<void>;\r\n    url: string;\r\n  };\r\n\r\nexport interface StreamEvent<TData = unknown> {\r\n  data: TData;\r\n  event?: string;\r\n  id?: string;\r\n  retry?: number;\r\n}\r\n\r\nexport type ServerSentEventsResult<\r\n  TData = unknown,\r\n  TReturn = void,\r\n  TNext = unknown,\r\n> = {\r\n  stream: AsyncGenerator<\r\n    TData extends Record<string, unknown> ? TData[keyof TData] : TData,\r\n    TReturn,\r\n    TNext\r\n  >;\r\n};\r\n\r\nexport const createSseClient = <TData = unknown>({\r\n  onRequest,\r\n  onSseError,\r\n  onSseEvent,\r\n  responseTransformer,\r\n  responseValidator,\r\n  sseDefaultRetryDelay,\r\n  sseMaxRetryAttempts,\r\n  sseMaxRetryDelay,\r\n  sseSleepFn,\r\n  url,\r\n  ...options\r\n}: ServerSentEventsOptions): ServerSentEventsResult<TData> => {\r\n  let lastEventId: string | undefined;\r\n\r\n  const sleep =\r\n    sseSleepFn ??\r\n    ((ms: number) => new Promise((resolve) => setTimeout(resolve, ms)));\r\n\r\n  const createStream = async function* () {\r\n    let retryDelay: number = sseDefaultRetryDelay ?? 3000;\r\n    let attempt = 0;\r\n    const signal = options.signal ?? new AbortController().signal;\r\n\r\n    while (true) {\r\n      if (signal.aborted) break;\r\n\r\n      attempt++;\r\n\r\n      const headers =\r\n        options.headers instanceof Headers\r\n          ? options.headers\r\n          : new Headers(options.headers as Record<string, string> | undefined);\r\n\r\n      if (lastEventId !== undefined) {\r\n        headers.set('Last-Event-ID', lastEventId);\r\n      }\r\n\r\n      try {\r\n        const requestInit: RequestInit = {\r\n          redirect: 'follow',\r\n          ...options,\r\n          body: options.serializedBody,\r\n          headers,\r\n          signal,\r\n        };\r\n        let request = new Request(url, requestInit);\r\n        if (onRequest) {\r\n          request = await onRequest(url, requestInit);\r\n        }\r\n        // fetch must be assigned here, otherwise it would throw the error:\r\n        // TypeError: Failed to execute 'fetch' on 'Window': Illegal invocation\r\n        const _fetch = options.fetch ?? globalThis.fetch;\r\n        const response = await _fetch(request);\r\n\r\n        if (!response.ok)\r\n          throw new Error(\r\n            `SSE failed: ${response.status} ${response.statusText}`,\r\n          );\r\n\r\n        if (!response.body) throw new Error('No body in SSE response');\r\n\r\n        const reader = response.body\r\n          .pipeThrough(new TextDecoderStream())\r\n          .getReader();\r\n\r\n        let buffer = '';\r\n\r\n        const abortHandler = () => {\r\n          try {\r\n            reader.cancel();\r\n          } catch {\r\n            // noop\r\n          }\r\n        };\r\n\r\n        signal.addEventListener('abort', abortHandler);\r\n\r\n        try {\r\n          while (true) {\r\n            const { done, value } = await reader.read();\r\n            if (done) break;\r\n            buffer += value;\r\n\r\n            const chunks = buffer.split('\\n\\n');\r\n            buffer = chunks.pop() ?? '';\r\n\r\n            for (const chunk of chunks) {\r\n              const lines = chunk.split('\\n');\r\n              const dataLines: Array<string> = [];\r\n              let eventName: string | undefined;\r\n\r\n              for (const line of lines) {\r\n                if (line.startsWith('data:')) {\r\n                  dataLines.push(line.replace(/^data:\\s*/, ''));\r\n                } else if (line.startsWith('event:')) {\r\n                  eventName = line.replace(/^event:\\s*/, '');\r\n                } else if (line.startsWith('id:')) {\r\n                  lastEventId = line.replace(/^id:\\s*/, '');\r\n                } else if (line.startsWith('retry:')) {\r\n                  const parsed = Number.parseInt(\r\n                    line.replace(/^retry:\\s*/, ''),\r\n                    10,\r\n                  );\r\n                  if (!Number.isNaN(parsed)) {\r\n                    retryDelay = parsed;\r\n                  }\r\n                }\r\n              }\r\n\r\n              let data: unknown;\r\n              let parsedJson = false;\r\n\r\n              if (dataLines.length) {\r\n                const rawData = dataLines.join('\\n');\r\n                try {\r\n                  data = JSON.parse(rawData);\r\n                  parsedJson = true;\r\n                } catch {\r\n                  data = rawData;\r\n                }\r\n              }\r\n\r\n              if (parsedJson) {\r\n                if (responseValidator) {\r\n                  await responseValidator(data);\r\n                }\r\n\r\n                if (responseTransformer) {\r\n                  data = await responseTransformer(data);\r\n                }\r\n              }\r\n\r\n              onSseEvent?.({\r\n                data,\r\n                event: eventName,\r\n                id: lastEventId,\r\n                retry: retryDelay,\r\n              });\r\n\r\n              if (dataLines.length) {\r\n                yield data as any;\r\n              }\r\n            }\r\n          }\r\n        } finally {\r\n          signal.removeEventListener('abort', abortHandler);\r\n          reader.releaseLock();\r\n        }\r\n\r\n        break; // exit loop on normal completion\r\n      } catch (error) {\r\n        // connection failed or aborted; retry after delay\r\n        onSseError?.(error);\r\n\r\n        if (\r\n          sseMaxRetryAttempts !== undefined &&\r\n          attempt >= sseMaxRetryAttempts\r\n        ) {\r\n          break; // stop after firing error\r\n        }\r\n\r\n        // exponential backoff: double retry each attempt, cap at 30s\r\n        const backoff = Math.min(\r\n          retryDelay * 2 ** (attempt - 1),\r\n          sseMaxRetryDelay ?? 30000,\r\n        );\r\n        await sleep(backoff);\r\n      }\r\n    }\r\n  };\r\n\r\n  const stream = createStream();\r\n\r\n  return { stream };\r\n};\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\ninterface SerializeOptions<T>\r\n  extends SerializePrimitiveOptions,\r\n    SerializerOptions<T> {}\r\n\r\ninterface SerializePrimitiveOptions {\r\n  allowReserved?: boolean;\r\n  name: string;\r\n}\r\n\r\nexport interface SerializerOptions<T> {\r\n  /**\r\n   * @default true\r\n   */\r\n  explode: boolean;\r\n  style: T;\r\n}\r\n\r\nexport type ArrayStyle = 'form' | 'spaceDelimited' | 'pipeDelimited';\r\nexport type ArraySeparatorStyle = ArrayStyle | MatrixStyle;\r\ntype MatrixStyle = 'label' | 'matrix' | 'simple';\r\nexport type ObjectStyle = 'form' | 'deepObject';\r\ntype ObjectSeparatorStyle = ObjectStyle | MatrixStyle;\r\n\r\ninterface SerializePrimitiveParam extends SerializePrimitiveOptions {\r\n  value: string;\r\n}\r\n\r\nexport const separatorArrayExplode = (style: ArraySeparatorStyle) => {\r\n  switch (style) {\r\n    case 'label':\r\n      return '.';\r\n    case 'matrix':\r\n      return ';';\r\n    case 'simple':\r\n      return ',';\r\n    default:\r\n      return '&';\r\n  }\r\n};\r\n\r\nexport const separatorArrayNoExplode = (style: ArraySeparatorStyle) => {\r\n  switch (style) {\r\n    case 'form':\r\n      return ',';\r\n    case 'pipeDelimited':\r\n      return '|';\r\n    case 'spaceDelimited':\r\n      return '%20';\r\n    default:\r\n      return ',';\r\n  }\r\n};\r\n\r\nexport const separatorObjectExplode = (style: ObjectSeparatorStyle) => {\r\n  switch (style) {\r\n    case 'label':\r\n      return '.';\r\n    case 'matrix':\r\n      return ';';\r\n    case 'simple':\r\n      return ',';\r\n    default:\r\n      return '&';\r\n  }\r\n};\r\n\r\nexport const serializeArrayParam = ({\r\n  allowReserved,\r\n  explode,\r\n  name,\r\n  style,\r\n  value,\r\n}: SerializeOptions<ArraySeparatorStyle> & {\r\n  value: unknown[];\r\n}) => {\r\n  if (!explode) {\r\n    const joinedValues = (\r\n      allowReserved ? value : value.map((v) => encodeURIComponent(v as string))\r\n    ).join(separatorArrayNoExplode(style));\r\n    switch (style) {\r\n      case 'label':\r\n        return `.${joinedValues}`;\r\n      case 'matrix':\r\n        return `;${name}=${joinedValues}`;\r\n      case 'simple':\r\n        return joinedValues;\r\n      default:\r\n        return `${name}=${joinedValues}`;\r\n    }\r\n  }\r\n\r\n  const separator = separatorArrayExplode(style);\r\n  const joinedValues = value\r\n    .map((v) => {\r\n      if (style === 'label' || style === 'simple') {\r\n        return allowReserved ? v : encodeURIComponent(v as string);\r\n      }\r\n\r\n      return serializePrimitiveParam({\r\n        allowReserved,\r\n        name,\r\n        value: v as string,\r\n      });\r\n    })\r\n    .join(separator);\r\n  return style === 'label' || style === 'matrix'\r\n    ? separator + joinedValues\r\n    : joinedValues;\r\n};\r\n\r\nexport const serializePrimitiveParam = ({\r\n  allowReserved,\r\n  name,\r\n  value,\r\n}: SerializePrimitiveParam) => {\r\n  if (value === undefined || value === null) {\r\n    return '';\r\n  }\r\n\r\n  if (typeof value === 'object') {\r\n    throw new Error(\r\n      'Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.',\r\n    );\r\n  }\r\n\r\n  return `${name}=${allowReserved ? value : encodeURIComponent(value)}`;\r\n};\r\n\r\nexport const serializeObjectParam = ({\r\n  allowReserved,\r\n  explode,\r\n  name,\r\n  style,\r\n  value,\r\n  valueOnly,\r\n}: SerializeOptions<ObjectSeparatorStyle> & {\r\n  value: Record<string, unknown> | Date;\r\n  valueOnly?: boolean;\r\n}) => {\r\n  if (value instanceof Date) {\r\n    return valueOnly ? value.toISOString() : `${name}=${value.toISOString()}`;\r\n  }\r\n\r\n  if (style !== 'deepObject' && !explode) {\r\n    let values: string[] = [];\r\n    Object.entries(value).forEach(([key, v]) => {\r\n      values = [\r\n        ...values,\r\n        key,\r\n        allowReserved ? (v as string) : encodeURIComponent(v as string),\r\n      ];\r\n    });\r\n    const joinedValues = values.join(',');\r\n    switch (style) {\r\n      case 'form':\r\n        return `${name}=${joinedValues}`;\r\n      case 'label':\r\n        return `.${joinedValues}`;\r\n      case 'matrix':\r\n        return `;${name}=${joinedValues}`;\r\n      default:\r\n        return joinedValues;\r\n    }\r\n  }\r\n\r\n  const separator = separatorObjectExplode(style);\r\n  const joinedValues = Object.entries(value)\r\n    .map(([key, v]) =>\r\n      serializePrimitiveParam({\r\n        allowReserved,\r\n        name: style === 'deepObject' ? `${name}[${key}]` : key,\r\n        value: v as string,\r\n      }),\r\n    )\r\n    .join(separator);\r\n  return style === 'label' || style === 'matrix'\r\n    ? separator + joinedValues\r\n    : joinedValues;\r\n};\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport type { BodySerializer, QuerySerializer } from './bodySerializer.gen';\r\nimport {\r\n  type ArraySeparatorStyle,\r\n  serializeArrayParam,\r\n  serializeObjectParam,\r\n  serializePrimitiveParam,\r\n} from './pathSerializer.gen';\r\n\r\nexport interface PathSerializer {\r\n  path: Record<string, unknown>;\r\n  url: string;\r\n}\r\n\r\nexport const PATH_PARAM_RE = /\\{[^{}]+\\}/g;\r\n\r\nexport const defaultPathSerializer = ({ path, url: _url }: PathSerializer) => {\r\n  let url = _url;\r\n  const matches = _url.match(PATH_PARAM_RE);\r\n  if (matches) {\r\n    for (const match of matches) {\r\n      let explode = false;\r\n      let name = match.substring(1, match.length - 1);\r\n      let style: ArraySeparatorStyle = 'simple';\r\n\r\n      if (name.endsWith('*')) {\r\n        explode = true;\r\n        name = name.substring(0, name.length - 1);\r\n      }\r\n\r\n      if (name.startsWith('.')) {\r\n        name = name.substring(1);\r\n        style = 'label';\r\n      } else if (name.startsWith(';')) {\r\n        name = name.substring(1);\r\n        style = 'matrix';\r\n      }\r\n\r\n      const value = path[name];\r\n\r\n      if (value === undefined || value === null) {\r\n        continue;\r\n      }\r\n\r\n      if (Array.isArray(value)) {\r\n        url = url.replace(\r\n          match,\r\n          serializeArrayParam({ explode, name, style, value }),\r\n        );\r\n        continue;\r\n      }\r\n\r\n      if (typeof value === 'object') {\r\n        url = url.replace(\r\n          match,\r\n          serializeObjectParam({\r\n            explode,\r\n            name,\r\n            style,\r\n            value: value as Record<string, unknown>,\r\n            valueOnly: true,\r\n          }),\r\n        );\r\n        continue;\r\n      }\r\n\r\n      if (style === 'matrix') {\r\n        url = url.replace(\r\n          match,\r\n          `;${serializePrimitiveParam({\r\n            name,\r\n            value: value as string,\r\n          })}`,\r\n        );\r\n        continue;\r\n      }\r\n\r\n      const replaceValue = encodeURIComponent(\r\n        style === 'label' ? `.${value as string}` : (value as string),\r\n      );\r\n      url = url.replace(match, replaceValue);\r\n    }\r\n  }\r\n  return url;\r\n};\r\n\r\nexport const getUrl = ({\r\n  baseUrl,\r\n  path,\r\n  query,\r\n  querySerializer,\r\n  url: _url,\r\n}: {\r\n  baseUrl?: string;\r\n  path?: Record<string, unknown>;\r\n  query?: Record<string, unknown>;\r\n  querySerializer: QuerySerializer;\r\n  url: string;\r\n}) => {\r\n  const pathUrl = _url.startsWith('/') ? _url : `/${_url}`;\r\n  let url = (baseUrl ?? '') + pathUrl;\r\n  if (path) {\r\n    url = defaultPathSerializer({ path, url });\r\n  }\r\n  let search = query ? querySerializer(query) : '';\r\n  if (search.startsWith('?')) {\r\n    search = search.substring(1);\r\n  }\r\n  if (search) {\r\n    url += `?${search}`;\r\n  }\r\n  return url;\r\n};\r\n\r\nexport function getValidRequestBody(options: {\r\n  body?: unknown;\r\n  bodySerializer?: BodySerializer | null;\r\n  serializedBody?: unknown;\r\n}) {\r\n  const hasBody = options.body !== undefined;\r\n  const isSerializedBody = hasBody && options.bodySerializer;\r\n\r\n  if (isSerializedBody) {\r\n    if ('serializedBody' in options) {\r\n      const hasSerializedBody =\r\n        options.serializedBody !== undefined && options.serializedBody !== '';\r\n\r\n      return hasSerializedBody ? options.serializedBody : null;\r\n    }\r\n\r\n    // not all clients implement a serializedBody property (i.e. client-axios)\r\n    return options.body !== '' ? options.body : null;\r\n  }\r\n\r\n  // plain/text body\r\n  if (hasBody) {\r\n    return options.body;\r\n  }\r\n\r\n  // no body was provided\r\n  return undefined;\r\n}\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nexport type AuthToken = string | undefined;\r\n\r\nexport interface Auth {\r\n  /**\r\n   * Which part of the request do we use to send the auth?\r\n   *\r\n   * @default 'header'\r\n   */\r\n  in?: 'header' | 'query' | 'cookie';\r\n  /**\r\n   * Header or query parameter name.\r\n   *\r\n   * @default 'Authorization'\r\n   */\r\n  name?: string;\r\n  scheme?: 'basic' | 'bearer';\r\n  type: 'apiKey' | 'http';\r\n}\r\n\r\nexport const getAuthToken = async (\r\n  auth: Auth,\r\n  callback: ((auth: Auth) => Promise<AuthToken> | AuthToken) | AuthToken,\r\n): Promise<string | undefined> => {\r\n  const token =\r\n    typeof callback === 'function' ? await callback(auth) : callback;\r\n\r\n  if (!token) {\r\n    return;\r\n  }\r\n\r\n  if (auth.scheme === 'bearer') {\r\n    return `Bearer ${token}`;\r\n  }\r\n\r\n  if (auth.scheme === 'basic') {\r\n    return `Basic ${btoa(token)}`;\r\n  }\r\n\r\n  return token;\r\n};\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport { getAuthToken } from '../core/auth.gen';\r\nimport type { QuerySerializerOptions } from '../core/bodySerializer.gen';\r\nimport { jsonBodySerializer } from '../core/bodySerializer.gen';\r\nimport {\r\n  serializeArrayParam,\r\n  serializeObjectParam,\r\n  serializePrimitiveParam,\r\n} from '../core/pathSerializer.gen';\r\nimport { getUrl } from '../core/utils.gen';\r\nimport type { Client, ClientOptions, Config, RequestOptions } from './types.gen';\r\n\r\nexport const createQuerySerializer = <T = unknown>({\r\n  allowReserved,\r\n  array,\r\n  object,\r\n}: QuerySerializerOptions = {}) => {\r\n  const querySerializer = (queryParams: T) => {\r\n    const search: string[] = [];\r\n    if (queryParams && typeof queryParams === 'object') {\r\n      for (const name in queryParams) {\r\n        const value = queryParams[name];\r\n\r\n        if (value === undefined || value === null) {\r\n          continue;\r\n        }\r\n\r\n        if (Array.isArray(value)) {\r\n          const serializedArray = serializeArrayParam({\r\n            allowReserved,\r\n            explode: true,\r\n            name,\r\n            style: 'form',\r\n            value,\r\n            ...array,\r\n          });\r\n          if (serializedArray) search.push(serializedArray);\r\n        } else if (typeof value === 'object') {\r\n          const serializedObject = serializeObjectParam({\r\n            allowReserved,\r\n            explode: true,\r\n            name,\r\n            style: 'deepObject',\r\n            value: value as Record<string, unknown>,\r\n            ...object,\r\n          });\r\n          if (serializedObject) search.push(serializedObject);\r\n        } else {\r\n          const serializedPrimitive = serializePrimitiveParam({\r\n            allowReserved,\r\n            name,\r\n            value: value as string,\r\n          });\r\n          if (serializedPrimitive) search.push(serializedPrimitive);\r\n        }\r\n      }\r\n    }\r\n    return search.join('&');\r\n  };\r\n  return querySerializer;\r\n};\r\n\r\n/**\r\n * Infers parseAs value from provided Content-Type header.\r\n */\r\nexport const getParseAs = (\r\n  contentType: string | null,\r\n): Exclude<Config['parseAs'], 'auto'> => {\r\n  if (!contentType) {\r\n    // If no Content-Type header is provided, the best we can do is return the raw response body,\r\n    // which is effectively the same as the 'stream' option.\r\n    return 'stream';\r\n  }\r\n\r\n  const cleanContent = contentType.split(';')[0]?.trim();\r\n\r\n  if (!cleanContent) {\r\n    return;\r\n  }\r\n\r\n  if (\r\n    cleanContent.startsWith('application/json') ||\r\n    cleanContent.endsWith('+json')\r\n  ) {\r\n    return 'json';\r\n  }\r\n\r\n  if (cleanContent === 'multipart/form-data') {\r\n    return 'formData';\r\n  }\r\n\r\n  if (\r\n    ['application/', 'audio/', 'image/', 'video/'].some((type) =>\r\n      cleanContent.startsWith(type),\r\n    )\r\n  ) {\r\n    return 'blob';\r\n  }\r\n\r\n  if (cleanContent.startsWith('text/')) {\r\n    return 'text';\r\n  }\r\n\r\n  return;\r\n};\r\n\r\nconst checkForExistence = (\r\n  options: Pick<RequestOptions, 'auth' | 'query'> & {\r\n    headers: Headers;\r\n  },\r\n  name?: string,\r\n): boolean => {\r\n  if (!name) {\r\n    return false;\r\n  }\r\n  if (\r\n    options.headers.has(name) ||\r\n    options.query?.[name] ||\r\n    options.headers.get('Cookie')?.includes(`${name}=`)\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport const setAuthParams = async ({\r\n  security,\r\n  ...options\r\n}: Pick<Required<RequestOptions>, 'security'> &\r\n  Pick<RequestOptions, 'auth' | 'query'> & {\r\n    headers: Headers;\r\n  }) => {\r\n  for (const auth of security) {\r\n    if (checkForExistence(options, auth.name)) {\r\n      continue;\r\n    }\r\n\r\n    const token = await getAuthToken(auth, options.auth);\r\n\r\n    if (!token) {\r\n      continue;\r\n    }\r\n\r\n    const name = auth.name ?? 'Authorization';\r\n\r\n    switch (auth.in) {\r\n      case 'query':\r\n        if (!options.query) {\r\n          options.query = {};\r\n        }\r\n        options.query[name] = token;\r\n        break;\r\n      case 'cookie':\r\n        options.headers.append('Cookie', `${name}=${token}`);\r\n        break;\r\n      case 'header':\r\n      default:\r\n        options.headers.set(name, token);\r\n        break;\r\n    }\r\n  }\r\n};\r\n\r\nexport const buildUrl: Client['buildUrl'] = (options) =>\r\n  getUrl({\r\n    baseUrl: options.baseUrl as string,\r\n    path: options.path,\r\n    query: options.query,\r\n    querySerializer:\r\n      typeof options.querySerializer === 'function'\r\n        ? options.querySerializer\r\n        : createQuerySerializer(options.querySerializer),\r\n    url: options.url,\r\n  });\r\n\r\nexport const mergeConfigs = (a: Config, b: Config): Config => {\r\n  const config = { ...a, ...b };\r\n  if (config.baseUrl?.endsWith('/')) {\r\n    config.baseUrl = config.baseUrl.substring(0, config.baseUrl.length - 1);\r\n  }\r\n  config.headers = mergeHeaders(a.headers, b.headers);\r\n  return config;\r\n};\r\n\r\nconst headersEntries = (headers: Headers): Array<[string, string]> => {\r\n  const entries: Array<[string, string]> = [];\r\n  headers.forEach((value, key) => {\r\n    entries.push([key, value]);\r\n  });\r\n  return entries;\r\n};\r\n\r\nexport const mergeHeaders = (\r\n  ...headers: Array<Required<Config>['headers'] | undefined>\r\n): Headers => {\r\n  const mergedHeaders = new Headers();\r\n  for (const header of headers) {\r\n    if (!header) {\r\n      continue;\r\n    }\r\n\r\n    const iterator =\r\n      header instanceof Headers\r\n        ? headersEntries(header)\r\n        : Object.entries(header);\r\n\r\n    for (const [key, value] of iterator) {\r\n      if (value === null) {\r\n        mergedHeaders.delete(key);\r\n      } else if (Array.isArray(value)) {\r\n        for (const v of value) {\r\n          mergedHeaders.append(key, v as string);\r\n        }\r\n      } else if (value !== undefined) {\r\n        // assume object headers are meant to be JSON stringified, i.e. their\r\n        // content value in OpenAPI specification is 'application/json'\r\n        mergedHeaders.set(\r\n          key,\r\n          typeof value === 'object' ? JSON.stringify(value) : (value as string),\r\n        );\r\n      }\r\n    }\r\n  }\r\n  return mergedHeaders;\r\n};\r\n\r\ntype ErrInterceptor<Err, Res, Req, Options> = (\r\n  error: Err,\r\n  response: Res,\r\n  request: Req,\r\n  options: Options,\r\n) => Err | Promise<Err>;\r\n\r\ntype ReqInterceptor<Req, Options> = (\r\n  request: Req,\r\n  options: Options,\r\n) => Req | Promise<Req>;\r\n\r\ntype ResInterceptor<Res, Req, Options> = (\r\n  response: Res,\r\n  request: Req,\r\n  options: Options,\r\n) => Res | Promise<Res>;\r\n\r\nclass Interceptors<Interceptor> {\r\n  fns: Array<Interceptor | null> = [];\r\n\r\n  clear(): void {\r\n    this.fns = [];\r\n  }\r\n\r\n  eject(id: number | Interceptor): void {\r\n    const index = this.getInterceptorIndex(id);\r\n    if (this.fns[index]) {\r\n      this.fns[index] = null;\r\n    }\r\n  }\r\n\r\n  exists(id: number | Interceptor): boolean {\r\n    const index = this.getInterceptorIndex(id);\r\n    return Boolean(this.fns[index]);\r\n  }\r\n\r\n  getInterceptorIndex(id: number | Interceptor): number {\r\n    if (typeof id === 'number') {\r\n      return this.fns[id] ? id : -1;\r\n    }\r\n    return this.fns.indexOf(id);\r\n  }\r\n\r\n  update(\r\n    id: number | Interceptor,\r\n    fn: Interceptor,\r\n  ): number | Interceptor | false {\r\n    const index = this.getInterceptorIndex(id);\r\n    if (this.fns[index]) {\r\n      this.fns[index] = fn;\r\n      return id;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  use(fn: Interceptor): number {\r\n    this.fns.push(fn);\r\n    return this.fns.length - 1;\r\n  }\r\n}\r\n\r\nexport interface Middleware<Req, Res, Err, Options> {\r\n  error: Interceptors<ErrInterceptor<Err, Res, Req, Options>>;\r\n  request: Interceptors<ReqInterceptor<Req, Options>>;\r\n  response: Interceptors<ResInterceptor<Res, Req, Options>>;\r\n}\r\n\r\nexport const createInterceptors = <Req, Res, Err, Options>(): Middleware<\r\n  Req,\r\n  Res,\r\n  Err,\r\n  Options\r\n> => ({\r\n  error: new Interceptors<ErrInterceptor<Err, Res, Req, Options>>(),\r\n  request: new Interceptors<ReqInterceptor<Req, Options>>(),\r\n  response: new Interceptors<ResInterceptor<Res, Req, Options>>(),\r\n});\r\n\r\nconst defaultQuerySerializer = createQuerySerializer({\r\n  allowReserved: false,\r\n  array: {\r\n    explode: true,\r\n    style: 'form',\r\n  },\r\n  object: {\r\n    explode: true,\r\n    style: 'deepObject',\r\n  },\r\n});\r\n\r\nconst defaultHeaders = {\r\n  'Content-Type': 'application/json',\r\n};\r\n\r\nexport const createConfig = <T extends ClientOptions = ClientOptions>(\r\n  override: Config<Omit<ClientOptions, keyof T> & T> = {},\r\n): Config<Omit<ClientOptions, keyof T> & T> => ({\r\n  ...jsonBodySerializer,\r\n  headers: defaultHeaders,\r\n  parseAs: 'auto',\r\n  querySerializer: defaultQuerySerializer,\r\n  ...override,\r\n});\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport { createSseClient } from '../core/serverSentEvents.gen';\r\nimport type { HttpMethod } from '../core/types.gen';\r\nimport { getValidRequestBody } from '../core/utils.gen';\r\nimport type {\r\n  Client,\r\n  Config,\r\n  RequestOptions,\r\n  ResolvedRequestOptions,\r\n} from './types.gen';\r\nimport {\r\n  buildUrl,\r\n  createConfig,\r\n  createInterceptors,\r\n  getParseAs,\r\n  mergeConfigs,\r\n  mergeHeaders,\r\n  setAuthParams,\r\n} from './utils.gen';\r\n\r\ntype ReqInit = Omit<RequestInit, 'body' | 'headers'> & {\r\n  body?: any;\r\n  headers: ReturnType<typeof mergeHeaders>;\r\n};\r\n\r\nexport const createClient = (config: Config = {}): Client => {\r\n  let _config = mergeConfigs(createConfig(), config);\r\n\r\n  const getConfig = (): Config => ({ ..._config });\r\n\r\n  const setConfig = (config: Config): Config => {\r\n    _config = mergeConfigs(_config, config);\r\n    return getConfig();\r\n  };\r\n\r\n  const interceptors = createInterceptors<\r\n    Request,\r\n    Response,\r\n    unknown,\r\n    ResolvedRequestOptions\r\n  >();\r\n\r\n  const beforeRequest = async (options: RequestOptions) => {\r\n    const opts = {\r\n      ..._config,\r\n      ...options,\r\n      fetch: options.fetch ?? _config.fetch ?? globalThis.fetch,\r\n      headers: mergeHeaders(_config.headers, options.headers),\r\n      serializedBody: undefined,\r\n    };\r\n\r\n    if (opts.security) {\r\n      await setAuthParams({\r\n        ...opts,\r\n        security: opts.security,\r\n      });\r\n    }\r\n\r\n    if (opts.requestValidator) {\r\n      await opts.requestValidator(opts);\r\n    }\r\n\r\n    if (opts.body !== undefined && opts.bodySerializer) {\r\n      opts.serializedBody = opts.bodySerializer(opts.body);\r\n    }\r\n\r\n    // remove Content-Type header if body is empty to avoid sending invalid requests\r\n    if (opts.body === undefined || opts.serializedBody === '') {\r\n      opts.headers.delete('Content-Type');\r\n    }\r\n\r\n    const url = buildUrl(opts);\r\n\r\n    return { opts, url };\r\n  };\r\n\r\n  const request: Client['request'] = async (options) => {\r\n    // @ts-expect-error\r\n    const { opts, url } = await beforeRequest(options);\r\n    const requestInit: ReqInit = {\r\n      redirect: 'follow',\r\n      ...opts,\r\n      body: getValidRequestBody(opts),\r\n    };\r\n\r\n    let request = new Request(url, requestInit);\r\n\r\n    for (const fn of interceptors.request.fns) {\r\n      if (fn) {\r\n        request = await fn(request, opts);\r\n      }\r\n    }\r\n\r\n    // fetch must be assigned here, otherwise it would throw the error:\r\n    // TypeError: Failed to execute 'fetch' on 'Window': Illegal invocation\r\n    const _fetch = opts.fetch!;\r\n    let response = await _fetch(request);\r\n\r\n    for (const fn of interceptors.response.fns) {\r\n      if (fn) {\r\n        response = await fn(response, request, opts);\r\n      }\r\n    }\r\n\r\n    const result = {\r\n      request,\r\n      response,\r\n    };\r\n\r\n    if (response.ok) {\r\n      const parseAs =\r\n        (opts.parseAs === 'auto'\r\n          ? getParseAs(response.headers.get('Content-Type'))\r\n          : opts.parseAs) ?? 'json';\r\n\r\n      if (\r\n        response.status === 204 ||\r\n        response.headers.get('Content-Length') === '0'\r\n      ) {\r\n        let emptyData: any;\r\n        switch (parseAs) {\r\n          case 'arrayBuffer':\r\n          case 'blob':\r\n          case 'text':\r\n            emptyData = await response[parseAs]();\r\n            break;\r\n          case 'formData':\r\n            emptyData = new FormData();\r\n            break;\r\n          case 'stream':\r\n            emptyData = response.body;\r\n            break;\r\n          case 'json':\r\n          default:\r\n            emptyData = {};\r\n            break;\r\n        }\r\n        return opts.responseStyle === 'data'\r\n          ? emptyData\r\n          : {\r\n              data: emptyData,\r\n              ...result,\r\n            };\r\n      }\r\n\r\n      let data: any;\r\n      switch (parseAs) {\r\n        case 'arrayBuffer':\r\n        case 'blob':\r\n        case 'formData':\r\n        case 'json':\r\n        case 'text':\r\n          data = await response[parseAs]();\r\n          break;\r\n        case 'stream':\r\n          return opts.responseStyle === 'data'\r\n            ? response.body\r\n            : {\r\n                data: response.body,\r\n                ...result,\r\n              };\r\n      }\r\n\r\n      if (parseAs === 'json') {\r\n        if (opts.responseValidator) {\r\n          await opts.responseValidator(data);\r\n        }\r\n\r\n        if (opts.responseTransformer) {\r\n          data = await opts.responseTransformer(data);\r\n        }\r\n      }\r\n\r\n      return opts.responseStyle === 'data'\r\n        ? data\r\n        : {\r\n            data,\r\n            ...result,\r\n          };\r\n    }\r\n\r\n    const textError = await response.text();\r\n    let jsonError: unknown;\r\n\r\n    try {\r\n      jsonError = JSON.parse(textError);\r\n    } catch {\r\n      // noop\r\n    }\r\n\r\n    const error = jsonError ?? textError;\r\n    let finalError = error;\r\n\r\n    for (const fn of interceptors.error.fns) {\r\n      if (fn) {\r\n        finalError = (await fn(error, response, request, opts)) as string;\r\n      }\r\n    }\r\n\r\n    finalError = finalError || ({} as string);\r\n\r\n    if (opts.throwOnError) {\r\n      throw finalError;\r\n    }\r\n\r\n    // TODO: we probably want to return error and improve types\r\n    return opts.responseStyle === 'data'\r\n      ? undefined\r\n      : {\r\n          error: finalError,\r\n          ...result,\r\n        };\r\n  };\r\n\r\n  const makeMethodFn =\r\n    (method: Uppercase<HttpMethod>) => (options: RequestOptions) =>\r\n      request({ ...options, method });\r\n\r\n  const makeSseFn =\r\n    (method: Uppercase<HttpMethod>) => async (options: RequestOptions) => {\r\n      const { opts, url } = await beforeRequest(options);\r\n      return createSseClient({\r\n        ...opts,\r\n        body: opts.body as BodyInit | null | undefined,\r\n        headers: opts.headers as unknown as Record<string, string>,\r\n        method,\r\n        onRequest: async (url, init) => {\r\n          let request = new Request(url, init);\r\n          for (const fn of interceptors.request.fns) {\r\n            if (fn) {\r\n              request = await fn(request, opts);\r\n            }\r\n          }\r\n          return request;\r\n        },\r\n        url,\r\n      });\r\n    };\r\n\r\n  return {\r\n    buildUrl,\r\n    connect: makeMethodFn('CONNECT'),\r\n    delete: makeMethodFn('DELETE'),\r\n    get: makeMethodFn('GET'),\r\n    getConfig,\r\n    head: makeMethodFn('HEAD'),\r\n    interceptors,\r\n    options: makeMethodFn('OPTIONS'),\r\n    patch: makeMethodFn('PATCH'),\r\n    post: makeMethodFn('POST'),\r\n    put: makeMethodFn('PUT'),\r\n    request,\r\n    setConfig,\r\n    sse: {\r\n      connect: makeSseFn('CONNECT'),\r\n      delete: makeSseFn('DELETE'),\r\n      get: makeSseFn('GET'),\r\n      head: makeSseFn('HEAD'),\r\n      options: makeSseFn('OPTIONS'),\r\n      patch: makeSseFn('PATCH'),\r\n      post: makeSseFn('POST'),\r\n      put: makeSseFn('PUT'),\r\n      trace: makeSseFn('TRACE'),\r\n    },\r\n    trace: makeMethodFn('TRACE'),\r\n  } as Client;\r\n};\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport { type ClientOptions, type Config, createClient, createConfig } from './client';\r\nimport type { ClientOptions as ClientOptions2 } from './types.gen';\r\n\r\n/**\r\n * The `createClientConfig()` function will be called on client initialization\r\n * and the returned object will become the client's initial configuration.\r\n *\r\n * You may want to initialize your client this way instead of calling\r\n * `setConfig()`. This is useful for example if you're using Next.js\r\n * to ensure your client always has the correct values.\r\n */\r\nexport type CreateClientConfig<T extends ClientOptions = ClientOptions2> = (override?: Config<ClientOptions & T>) => Config<Required<ClientOptions> & T>;\r\n\r\nexport const client = createClient(createConfig<ClientOptions2>());\r\n","// This file is auto-generated by @hey-api/openapi-ts\r\n\r\nimport type { Client, Options as Options2, TDataShape } from './client';\r\nimport { client } from './client.gen';\r\nimport type { PostSecurityForgotPasswordData, PostSecurityForgotPasswordErrors, PostSecurityForgotPasswordResetData, PostSecurityForgotPasswordResetErrors, PostSecurityForgotPasswordResetResponses, PostSecurityForgotPasswordResponses, PostSecurityForgotPasswordVerifyData, PostSecurityForgotPasswordVerifyErrors, PostSecurityForgotPasswordVerifyResponses, PostUserInviteCreatePasswordData, PostUserInviteCreatePasswordErrors, PostUserInviteCreatePasswordResponses, PostUserInviteVerifyData, PostUserInviteVerifyErrors, PostUserInviteVerifyResponses } from './types.gen';\r\n\r\nexport type Options<TData extends TDataShape = TDataShape, ThrowOnError extends boolean = boolean> = Options2<TData, ThrowOnError> & {\r\n    /**\r\n     * You can provide a client instance returned by `createClient()` instead of\r\n     * individual options. This might be also useful if you want to implement a\r\n     * custom client.\r\n     */\r\n    client?: Client;\r\n    /**\r\n     * You can pass arbitrary values through the `meta` object. This can be\r\n     * used to access values that aren't defined as part of the SDK function.\r\n     */\r\n    meta?: Record<string, unknown>;\r\n};\r\n\r\nexport const postSecurityForgotPassword = <ThrowOnError extends boolean = false>(options?: Options<PostSecurityForgotPasswordData, ThrowOnError>) => {\r\n    return (options?.client ?? client).post<PostSecurityForgotPasswordResponses, PostSecurityForgotPasswordErrors, ThrowOnError>({\r\n        security: [\r\n            {\r\n                scheme: 'bearer',\r\n                type: 'http'\r\n            }\r\n        ],\r\n        url: '/umbraco/management/api/v1/security/forgot-password',\r\n        ...options,\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            ...options?.headers\r\n        }\r\n    });\r\n};\r\n\r\nexport const postSecurityForgotPasswordReset = <ThrowOnError extends boolean = false>(options?: Options<PostSecurityForgotPasswordResetData, ThrowOnError>) => {\r\n    return (options?.client ?? client).post<PostSecurityForgotPasswordResetResponses, PostSecurityForgotPasswordResetErrors, ThrowOnError>({\r\n        security: [\r\n            {\r\n                scheme: 'bearer',\r\n                type: 'http'\r\n            }\r\n        ],\r\n        url: '/umbraco/management/api/v1/security/forgot-password/reset',\r\n        ...options,\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            ...options?.headers\r\n        }\r\n    });\r\n};\r\n\r\nexport const postSecurityForgotPasswordVerify = <ThrowOnError extends boolean = false>(options?: Options<PostSecurityForgotPasswordVerifyData, ThrowOnError>) => {\r\n    return (options?.client ?? client).post<PostSecurityForgotPasswordVerifyResponses, PostSecurityForgotPasswordVerifyErrors, ThrowOnError>({\r\n        url: '/umbraco/management/api/v1/security/forgot-password/verify',\r\n        ...options,\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            ...options?.headers\r\n        }\r\n    });\r\n};\r\n\r\nexport const postUserInviteCreatePassword = <ThrowOnError extends boolean = false>(options?: Options<PostUserInviteCreatePasswordData, ThrowOnError>) => {\r\n    return (options?.client ?? client).post<PostUserInviteCreatePasswordResponses, PostUserInviteCreatePasswordErrors, ThrowOnError>({\r\n        url: '/umbraco/management/api/v1/user/invite/create-password',\r\n        ...options,\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            ...options?.headers\r\n        }\r\n    });\r\n};\r\n\r\nexport const postUserInviteVerify = <ThrowOnError extends boolean = false>(options?: Options<PostUserInviteVerifyData, ThrowOnError>) => {\r\n    return (options?.client ?? client).post<PostUserInviteVerifyResponses, PostUserInviteVerifyErrors, ThrowOnError>({\r\n        url: '/umbraco/management/api/v1/user/invite/verify',\r\n        ...options,\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            ...options?.headers\r\n        }\r\n    });\r\n};\r\n","import {\r\n\tLoginRequestModel,\r\n\tLoginResponse,\r\n\tMfaCodeResponse,\r\n\tNewPasswordResponse,\r\n\tResetPasswordResponse,\r\n\tValidateInviteCodeResponse,\r\n\tValidatePasswordResetCodeResponse,\r\n} from '../types.js';\r\nimport {\r\n\tpostSecurityForgotPassword,\r\n\tpostSecurityForgotPasswordReset,\r\n\tpostSecurityForgotPasswordVerify,\r\n\tpostUserInviteCreatePassword,\r\n\tpostUserInviteVerify,\r\n} from '../api/index.js';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\nimport { isProblemDetailsLike } from '@umbraco-cms/backoffice/resources';\r\n\r\nexport class UmbAuthRepository extends UmbRepositoryBase {\r\n\t#localize = new UmbLocalizationController(this);\r\n\r\n\tpublic async login(data: LoginRequestModel): Promise<LoginResponse> {\r\n\t\ttry {\r\n\t\t\tconst request = new Request('/umbraco/management/api/v1/security/back-office/login', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tusername: data.username,\r\n\t\t\t\t\tpassword: data.password,\r\n\t\t\t\t}),\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tconst response = await fetch(request);\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\t// If the response code is 402, it means that the user has enabled 2-factor authentication\r\n\t\t\t\tif (response.status === 402) {\r\n\t\t\t\t\tconst responseData = await response.json();\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tstatus: response.status,\r\n\t\t\t\t\t\ttwoFactorView: responseData.twoFactorLoginView ?? '',\r\n\t\t\t\t\t\ttwoFactorProviders: responseData.enabledTwoFactorProviderNames ?? [],\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstatus: response.status,\r\n\t\t\t\t\terror: await this.#getErrorText(response),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tstatus: response.status,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tusername: data.username,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t} catch (error) {\r\n\t\t\treturn {\r\n\t\t\t\tstatus: 500,\r\n\t\t\t\terror: error instanceof Error ? error.message : this.#localize.term('auth_receivedErrorFromServer'),\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async validateMfaCode(code: string, provider: string): Promise<MfaCodeResponse> {\r\n\t\ttry {\r\n\t\t\tconst requestData = new Request('/umbraco/management/api/v1/security/back-office/verify-2fa', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\tcode,\r\n\t\t\t\t\tprovider,\r\n\t\t\t\t}),\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tconst response = await fetch(requestData);\r\n\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\terror:\r\n\t\t\t\t\t\tresponse.status === 400 ? this.#localize.term('auth_mfaInvalidCode') : await this.#getErrorText(response),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn {};\r\n\t\t} catch (error) {\r\n\t\t\treturn {\r\n\t\t\t\terror: error instanceof Error ? error.message : this.#localize.term('auth_receivedErrorFromServer'),\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async resetPassword(email: string): Promise<ResetPasswordResponse> {\r\n\t\tconst { error } = await postSecurityForgotPassword({\r\n\t\t\tbody: {\r\n\t\t\t\temail,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (error) {\r\n\t\t\treturn {\r\n\t\t\t\terror: this.#getApiErrorDetailText(error, 'Could not reset the password'),\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {};\r\n\t}\r\n\r\n\tpublic async validatePasswordResetCode(\r\n\t\tuserId: string,\r\n\t\tresetCode: string\r\n\t): Promise<ValidatePasswordResetCodeResponse> {\r\n\t\tconst { data, error } = await postSecurityForgotPasswordVerify({\r\n\t\t\tbody: {\r\n\t\t\t\tuser: {\r\n\t\t\t\t\tid: userId,\r\n\t\t\t\t},\r\n\t\t\t\tresetCode,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn {\r\n\t\t\t\terror: this.#getApiErrorDetailText(error, 'Could not validate the password reset code'),\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tpublic async newPassword(password: string, resetCode: string, userId: string): Promise<NewPasswordResponse> {\r\n\t\tconst { error } = await postSecurityForgotPasswordReset({\r\n\t\t\tbody: {\r\n\t\t\t\tpassword,\r\n\t\t\t\tresetCode,\r\n\t\t\t\tuser: {\r\n\t\t\t\t\tid: userId,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (error) {\r\n\t\t\treturn {\r\n\t\t\t\terror: this.#getApiErrorDetailText(error, 'Could not reset the password'),\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {};\r\n\t}\r\n\r\n\tpublic async validateInviteCode(token: string, userId: string): Promise<ValidateInviteCodeResponse> {\r\n\t\tconst { data, error } = await postUserInviteVerify({\r\n\t\t\tbody: {\r\n\t\t\t\ttoken,\r\n\t\t\t\tuser: {\r\n\t\t\t\t\tid: userId,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn {\r\n\t\t\t\terror: this.#getApiErrorDetailText(error, 'Could not validate the invite code'),\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tpublic async newInvitedUserPassword(password: string, token: string, userId: string): Promise<NewPasswordResponse> {\r\n\t\tconst { error } = await postUserInviteCreatePassword({\r\n\t\t\tbody: {\r\n\t\t\t\tpassword,\r\n\t\t\t\ttoken,\r\n\t\t\t\tuser: {\r\n\t\t\t\t\tid: userId,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (error) {\r\n\t\t\treturn {\r\n\t\t\t\terror: this.#getApiErrorDetailText(error, 'Could not create a password for the invited user'),\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {};\r\n\t}\r\n\r\n\t#getApiErrorDetailText(error: unknown, fallbackText?: string): string | undefined {\r\n\t\tif (isProblemDetailsLike(error)) {\r\n\t\t\treturn error.detail ?? error.title ?? undefined;\r\n\t\t}\r\n\r\n\t\tif (false === error instanceof Error) {\r\n\t\t\treturn fallbackText ?? 'An unknown error occurred.';\r\n\t\t}\r\n\r\n\t\t// Ignore cancel errors (user cancelled the request)\r\n\t\tif (error.name === 'CancelError') {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\treturn error.message;\r\n\t}\r\n\r\n\tasync #getErrorText(response: Response): Promise<string> {\r\n\t\tswitch (response.status) {\r\n\t\t\tcase 400:\r\n\t\t\tcase 401:\r\n\t\t\t\treturn this.#localize.term('auth_userFailedLogin');\r\n\r\n\t\t\tcase 402:\r\n\t\t\t\treturn this.#localize.term('auth_mfaText');\r\n\r\n\t\t\tcase 403:\r\n\t\t\t\treturn this.#localize.term('auth_userLockedOut');\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.#localize.term('auth_receivedErrorFromServer');\r\n\t\t}\r\n\t}\r\n}\r\n","import {\r\n\tLoginRequestModel,\r\n\tLoginResponse,\r\n\tResetPasswordResponse,\r\n\tValidatePasswordResetCodeResponse,\r\n\tNewPasswordResponse,\r\n\tPasswordConfigurationModel,\r\n\tValidateInviteCodeResponse,\r\n\tMfaCodeResponse,\r\n} from '../types.js';\r\nimport { UmbAuthRepository } from './auth.repository.js';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport class UmbAuthContext extends UmbContextBase {\r\n\treadonly supportsPersistLogin = false;\r\n\ttwoFactorView = '';\r\n\tisMfaEnabled = false;\r\n\tmfaProviders: string[] = [];\r\n\tpasswordConfiguration?: PasswordConfigurationModel;\r\n\r\n\t#authRepository = new UmbAuthRepository(this);\r\n\r\n\t#returnPath = '';\r\n\r\n\tset returnPath(value: string) {\r\n\t\tthis.#returnPath = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the return path from the query string.\r\n\t *\r\n\t * It will first look for a `ReturnUrl` parameter, then a `returnPath` parameter, and finally the `returnPath` property.\r\n\t *\r\n\t * @returns The return path from the query string.\r\n\t */\r\n\tget returnPath(): string {\r\n\t\tconst params = new URLSearchParams(window.location.search);\r\n\t\tlet returnPath = params.get('ReturnUrl') ?? params.get('returnPath') ?? this.#returnPath;\r\n\r\n\t\t// If return path is empty, return an empty string.\r\n\t\tif (!returnPath) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\t// Safely check that the return path is valid and doesn't link to an external site.\r\n\t\tconst url = new URL(returnPath, window.location.origin);\r\n\r\n\t\tif (url.origin !== window.location.origin) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\treturn url.toString();\r\n\t}\r\n\r\n\tlogin(data: LoginRequestModel): Promise<LoginResponse> {\r\n\t\treturn this.#authRepository.login(data);\r\n\t}\r\n\r\n\tresetPassword(username: string): Promise<ResetPasswordResponse> {\r\n\t\treturn this.#authRepository.resetPassword(username);\r\n\t}\r\n\r\n\tvalidatePasswordResetCode(userId: string, resetCode: string): Promise<ValidatePasswordResetCodeResponse> {\r\n\t\treturn this.#authRepository.validatePasswordResetCode(userId, resetCode);\r\n\t}\r\n\r\n\tnewPassword(password: string, resetCode: string, userId: string): Promise<NewPasswordResponse> {\r\n\t\treturn this.#authRepository.newPassword(password, resetCode, userId);\r\n\t}\r\n\r\n\tnewInvitedUserPassword(password: string, token: string, userId: string): Promise<NewPasswordResponse> {\r\n\t\treturn this.#authRepository.newInvitedUserPassword(password, token, userId);\r\n\t}\r\n\r\n\tvalidateInviteCode(token: string, userId: string): Promise<ValidateInviteCodeResponse> {\r\n\t\treturn this.#authRepository.validateInviteCode(token, userId);\r\n\t}\r\n\r\n\tvalidateMfaCode(code: string, provider: string): Promise<MfaCodeResponse> {\r\n\t\treturn this.#authRepository.validateMfaCode(code, provider);\r\n\t}\r\n}\r\n\r\nexport const UMB_AUTH_CONTEXT = new UmbContextToken<UmbAuthContext>('UmbAuthContext');\r\n","import { UmbBundleExtensionInitializer, UmbServerExtensionRegistrator } from '@umbraco-cms/backoffice/extension-api';\r\nimport {\r\n\tUmbAppEntryPointExtensionInitializer,\r\n\tumbExtensionsRegistry,\r\n} from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { UmbElement } from '@umbraco-cms/backoffice/element-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UUIIconRegistryEssential } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbServerConnection, UmbServerContext } from '@umbraco-cms/backoffice/server';\r\nimport { firstValueFrom } from '@umbraco-cms/backoffice/external/rxjs';\r\n\r\n// We import what we need from the Backoffice app.\r\n// In the future the login screen app will be a part of the Backoffice app, and we will not need to import these.\r\nimport '@umbraco-cms/backoffice/localization';\r\n\r\n/**\r\n * This is the initializer for the slim backoffice.\r\n * It is responsible for initializing the backoffice and only the extensions that is needed to run the login screen.\r\n */\r\nexport class UmbSlimBackofficeController extends UmbControllerBase {\r\n\tconstructor(host: UmbElement) {\r\n\t\tsuper(host);\r\n\r\n\t\tnew UmbBundleExtensionInitializer(host, umbExtensionsRegistry);\r\n\r\n\t\t// Attach the UUIIconRegistry to the host so that it can be used in the login screen.\r\n\t\tnew UUIIconRegistryEssential().attach(host);\r\n\r\n\t\t// Add the essential styles to the host so that it can be used in the login screen.\r\n\t\thost.classList.add('uui-text');\r\n\t\thost.classList.add('uui-font');\r\n\t}\r\n\r\n\tasync register(host: UmbElement) {\r\n\t\t// Get the server URL and backoffice path from the host.\r\n\t\tconst serverUrl = window.location.origin;\r\n\t\tconst serverConnection = new UmbServerConnection(host, serverUrl);\r\n\r\n\t\t// Create the server context for the slim backoffice.\r\n\t\t// This is needed by the UmbServerExtensionRegistrator to register the extensions.\r\n\t\tnew UmbServerContext(this, {\r\n\t\t\tbackofficePath: '/umbraco',\r\n\t\t\tserverUrl,\r\n\t\t\tserverConnection: serverConnection,\r\n\t\t});\r\n\r\n\t\t// Register the public extensions for the slim backoffice.\r\n\t\tawait new UmbServerExtensionRegistrator(this, umbExtensionsRegistry).registerPublicExtensions().catch((error) => {\r\n\t\t\tconsole.error(`Failed to register public extensions for the slim backoffice.`, error);\r\n\t\t});\r\n\r\n\t\tconst initializer = new UmbAppEntryPointExtensionInitializer(host, umbExtensionsRegistry);\r\n\t\tawait firstValueFrom(initializer.loaded);\r\n\t}\r\n}\r\n","import type { ManifestBundle } from \"@umbraco-cms/backoffice/extension-api\";\r\n\r\nexport const name = 'Umbraco.Auth';\r\nexport const version = '1.0.0';\r\nexport const extensions: Array<ManifestBundle> = [\r\n  {\r\n    name: 'Auth Bundle',\r\n    alias: 'Umb.Auth.Bundle',\r\n    type: 'bundle',\r\n    js: () => import('./manifests.js'),\r\n  },\r\n];\r\n","import { html, customElement, property, ifDefined } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { InputType, UUIFormLayoutItemElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\n\r\nimport { UMB_AUTH_CONTEXT, UmbAuthContext } from './contexts';\r\nimport { UmbSlimBackofficeController } from './controllers';\r\n\r\n// We import the authStyles here so that we can inline it in the shadow DOM that is created outside of the UmbAuthElement.\r\nimport authStyles from './auth-styles.css?inline';\r\n\r\n// Import the main bundle\r\nimport { extensions } from './umbraco-package.js';\r\n\r\nconst createInput = (opts: {\r\n\tid: string;\r\n\ttype: InputType;\r\n\tname: string;\r\n\tautocomplete: AutoFill;\r\n\tinputmode: string;\r\n\tautofocus?: boolean;\r\n}) => {\r\n\tconst input = document.createElement('input');\r\n\tinput.type = opts.type;\r\n\tinput.name = opts.name;\r\n\tinput.autocomplete = opts.autocomplete;\r\n\tinput.id = opts.id;\r\n\tinput.required = true;\r\n\tinput.inputMode = opts.inputmode;\r\n\tinput.autofocus = opts.autofocus || false;\r\n\treturn input;\r\n};\r\n\r\nconst createLabel = (opts: { forId: string; localizeAlias: string; localizeFallback: string }) => {\r\n\tconst label = document.createElement('label');\r\n\tconst umbLocalize: any = document.createElement('umb-localize');\r\n\tumbLocalize.key = opts.localizeAlias;\r\n\tumbLocalize.innerHTML = opts.localizeFallback;\r\n\tlabel.htmlFor = opts.forId;\r\n\tlabel.appendChild(umbLocalize);\r\n\r\n\treturn label;\r\n};\r\n\r\nconst createFormLayoutItem = (label: HTMLLabelElement, input: HTMLInputElement) => {\r\n\tconst formLayoutItem = document.createElement('uui-form-layout-item') as UUIFormLayoutItemElement;\r\n\tformLayoutItem.appendChild(label);\r\n\tformLayoutItem.appendChild(input);\r\n\r\n\treturn formLayoutItem;\r\n};\r\n\r\nconst createForm = (elements: HTMLElement[]) => {\r\n\tconst styles = document.createElement('style');\r\n\tstyles.innerHTML = authStyles;\r\n\tconst form = document.createElement('form');\r\n\tform.id = 'umb-login-form';\r\n\tform.name = 'login-form';\r\n\tform.spellcheck = false;\r\n\r\n\telements.push(styles);\r\n\telements.forEach((element) => form.appendChild(element));\r\n\r\n\treturn form;\r\n};\r\n\r\n@customElement('umb-auth')\r\nexport default class UmbAuthElement extends UmbLitElement {\r\n\t/**\r\n\t * Disables the local login form and only allows external login providers.\r\n\t *\r\n\t * @attr disable-local-login\r\n\t */\r\n\t@property({ type: Boolean, attribute: 'disable-local-login' })\r\n\tdisableLocalLogin = false;\r\n\r\n\t@property({ attribute: 'background-image' })\r\n\tbackgroundImage?: string;\r\n\r\n\t@property({ attribute: 'logo-image' })\r\n\tlogoImage?: string;\r\n\r\n\t@property({ attribute: 'logo-image-alternative' })\r\n\tlogoImageAlternative?: string;\r\n\r\n\t@property({ type: Boolean, attribute: 'username-is-email' })\r\n\tusernameIsEmail = false;\r\n\r\n\t@property({ type: Boolean, attribute: 'allow-password-reset' })\r\n\tallowPasswordReset = false;\r\n\r\n\t@property({ type: Boolean, attribute: 'allow-user-invite' })\r\n\tallowUserInvite = false;\r\n\r\n\t@property({ attribute: 'return-url' })\r\n\tset returnPath(value: string) {\r\n\t\tthis.#authContext.returnPath = value;\r\n\t}\r\n\tget returnPath() {\r\n\t\treturn this.#authContext.returnPath;\r\n\t}\r\n\r\n\t/**\r\n\t * Override the default flow.\r\n\t */\r\n\tprotected flow?: 'mfa' | 'reset-password' | 'invite-user';\r\n\r\n\t_form?: HTMLFormElement;\r\n\t_usernameLayoutItem?: UUIFormLayoutItemElement;\r\n\t_passwordLayoutItem?: UUIFormLayoutItemElement;\r\n\t_usernameInput?: HTMLInputElement;\r\n\t_passwordInput?: HTMLInputElement;\r\n\t_usernameLabel?: HTMLLabelElement;\r\n\t_passwordLabel?: HTMLLabelElement;\r\n\r\n\t#authContext = new UmbAuthContext(this, UMB_AUTH_CONTEXT);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t(this as unknown as EventTarget).addEventListener('umb-login-flow', (e) => {\r\n\t\t\tif (e instanceof CustomEvent) {\r\n\t\t\t\tthis.flow = e.detail.flow || undefined;\r\n\t\t\t}\r\n\t\t\tthis.requestUpdate();\r\n\t\t});\r\n\t}\r\n\r\n\tasync firstUpdated() {\r\n\t\t// Bind the (slim) Backoffice controller to this element so that we can use utilities from the Backoffice app.\r\n\t\tawait new UmbSlimBackofficeController(this).register(this);\r\n\r\n\t\t// Register the main package for Umbraco.Auth\r\n\t\tumbExtensionsRegistry.registerMany(extensions);\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\tthis.#initializeForm();\r\n\t\t\t});\r\n\t\t}, 100);\r\n\t}\r\n\r\n\tdisconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tthis._usernameLayoutItem?.remove();\r\n\t\tthis._passwordLayoutItem?.remove();\r\n\t\tthis._usernameLabel?.remove();\r\n\t\tthis._usernameInput?.remove();\r\n\t\tthis._passwordLabel?.remove();\r\n\t\tthis._passwordInput?.remove();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the login form and adds it to the DOM in the default slot.\r\n\t * This is done to avoid having to deal with the shadow DOM, which is not supported in Google Chrome for autocomplete/autofill.\r\n\t *\r\n\t * @see Track this intent-to-ship for Chrome https://groups.google.com/a/chromium.org/g/blink-dev/c/RY9leYMu5hI?pli=1\r\n\t * @private\r\n\t */\r\n\t#initializeForm() {\r\n\t\tthis._usernameInput = createInput({\r\n\t\t\tid: 'username-input',\r\n\t\t\ttype: 'text',\r\n\t\t\tname: 'username',\r\n\t\t\tautocomplete: 'username',\r\n\t\t\tinputmode: this.usernameIsEmail ? 'email' : '',\r\n\t\t\tautofocus: true,\r\n\t\t});\r\n\t\tthis._passwordInput = createInput({\r\n\t\t\tid: 'password-input',\r\n\t\t\ttype: 'password',\r\n\t\t\tname: 'password',\r\n\t\t\tautocomplete: 'current-password',\r\n\t\t\tinputmode: '',\r\n\t\t});\r\n\t\tthis._usernameLabel = createLabel({\r\n\t\t\tforId: 'username-input',\r\n\t\t\tlocalizeAlias: this.usernameIsEmail ? 'auth_email' : 'auth_username',\r\n\t\t\tlocalizeFallback: this.usernameIsEmail ? 'Email' : 'Username',\r\n\t\t});\r\n\t\tthis._passwordLabel = createLabel({\r\n\t\t\tforId: 'password-input',\r\n\t\t\tlocalizeAlias: 'auth_password',\r\n\t\t\tlocalizeFallback: 'Password',\r\n\t\t});\r\n\r\n\t\tthis._usernameLayoutItem = createFormLayoutItem(this._usernameLabel, this._usernameInput);\r\n\t\tthis._passwordLayoutItem = createFormLayoutItem(this._passwordLabel, this._passwordInput);\r\n\r\n\t\tthis._form = createForm([this._usernameLayoutItem, this._passwordLayoutItem]);\r\n\r\n\t\tthis.insertAdjacentElement('beforeend', this._form);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`\r\n\t\t\t<umb-auth-layout\r\n\t\t\t\tbackground-image=${ifDefined(this.backgroundImage)}\r\n\t\t\t\tlogo-image=${ifDefined(this.logoImage)}\r\n\t\t\t\tlogo-image-alternative=${ifDefined(this.logoImageAlternative)}>\r\n\t\t\t\t${this._renderFlowAndStatus()}\r\n\t\t\t</umb-auth-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tprivate _renderFlowAndStatus() {\r\n\t\tif (this.disableLocalLogin) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-error-layout no-back-link>\r\n\t\t\t\t\t<umb-localize key=\"auth_localLoginDisabled\"\r\n\t\t\t\t\t\t>Unfortunately, it is not possible to log in directly. It has been disabled by a login\r\n\t\t\t\t\t\tprovider.</umb-localize\r\n\t\t\t\t\t>\r\n\t\t\t\t</umb-error-layout>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\tconst searchParams = new URLSearchParams(window.location.search);\r\n\t\tlet flow = this.flow || searchParams.get('flow')?.toLowerCase();\r\n\t\tconst status = searchParams.get('status');\r\n\r\n\t\tif (status === 'resetCodeExpired') {\r\n\t\t\treturn html` <umb-error-layout message=${this.localize.term('auth_resetCodeExpired')}> </umb-error-layout>`;\r\n\t\t}\r\n\r\n\t\tif (flow === 'invite-user' && status === 'false') {\r\n\t\t\treturn html` <umb-error-layout message=${this.localize.term('auth_userInviteExpiredMessage')}>\r\n\t\t\t</umb-error-layout>`;\r\n\t\t}\r\n\r\n\t\t// validate\r\n\t\tif (flow) {\r\n\t\t\tif (flow === 'mfa' && !this.#authContext.isMfaEnabled) {\r\n\t\t\t\tflow = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (flow) {\r\n\t\t\tcase 'mfa':\r\n\t\t\t\treturn html` <umb-mfa-page></umb-mfa-page>`;\r\n\t\t\tcase 'reset':\r\n\t\t\t\treturn html` <umb-reset-password-page></umb-reset-password-page>`;\r\n\t\t\tcase 'reset-password':\r\n\t\t\t\treturn html` <umb-new-password-page></umb-new-password-page>`;\r\n\t\t\tcase 'invite-user':\r\n\t\t\t\treturn html` <umb-invite-page></umb-invite-page>`;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn html` <umb-login-page\r\n\t\t\t\t\t?allow-password-reset=${this.allowPasswordReset}\r\n\t\t\t\t\t?username-is-email=${this.usernameIsEmail}>\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t\t<slot name=\"subheadline\" slot=\"subheadline\"></slot>\r\n\t\t\t\t</umb-login-page>`;\r\n\t\t}\r\n\t}\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-auth': UmbAuthElement;\r\n\t}\r\n}\r\n","import { css, customElement, html, nothing, property, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { CSSResultGroup, PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * The auth layout component.\r\n *\r\n * @element umb-auth-layout\r\n * @slot - The content of the layout\r\n * @cssprop --umb-login-background - The background of the layout (default: #f4f4f4)\r\n * @cssprop --umb-login-primary-color - The color of the headline (default: #283a97)\r\n * @cssprop --umb-login-text-color - The color of the text (default: #000)\r\n * @cssprop --umb-login-header-font-size - The font-size of the headline (default: 3rem)\r\n * @cssprop --umb-login-header-font-size-large - The font-size of the headline on large screens (default: 4rem)\r\n * @cssprop --umb-login-header-secondary-font-size - The font-size of the secondary headline (default: 2.4rem)\r\n * @cssprop --umb-login-image - The background of the image wrapper (default: the value of the backgroundImage property)\r\n * @cssprop --umb-login-image-display - The display of the image wrapper (default: flex)\r\n * @cssprop --umb-login-image-border-radius - The border-radius of the image wrapper (default: 38px)\r\n * @cssprop --umb-login-content-background - The background of the content wrapper (default: none)\r\n * @cssprop --umb-login-content-display - The display of the content wrapper (default: flex)\r\n * @cssprop --umb-login-content-width - The width of the content wrapper (default: 100%)\r\n * @cssprop --umb-login-content-height - The height of the content wrapper (default: 100%)\r\n * @cssprop --umb-login-content-border-radius - The border-radius of the content wrapper (default: 0)\r\n * @cssprop --umb-login-align-items - The align-items of the main wrapper (default: unset)\r\n * @cssprop --umb-login-button-border-radius - The border-radius of the buttons (default: 45px)\r\n * @cssprop --umb-login-curves-color - The color of the curves (default: #f5c1bc)\r\n * @cssprop --umb-login-curves-display - The display of the curves (default: inline)\r\n * @cssprop --umb-logo-width - The width of the logo (default: auto)\r\n * @cssprop --umb-logo-height - The height of the logo (default: 55px)\r\n * @cssprop --umb-logo-top - The top position of the logo (default: 24px)\r\n * @cssprop --umb-logo-left - The left position of the logo (default: 24px)\r\n * @cssprop --umb-logo-display - The display of the logo (default: block)\r\n */\r\n@customElement('umb-auth-layout')\r\nexport class UmbAuthLayoutElement extends UmbLitElement {\r\n\t@property({ attribute: 'background-image' })\r\n\tbackgroundImage?: string;\r\n\r\n\t@property({ attribute: 'logo-image' })\r\n\tlogoImage?: string;\r\n\r\n\t@property({ attribute: 'logo-image-alternative' })\r\n\tlogoImageAlternative?: string;\r\n\r\n\tprotected updated(_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.updated(_changedProperties);\r\n\r\n\t\tif (_changedProperties.has<keyof this>('backgroundImage')) {\r\n\t\t\tthis.style.setProperty('--logo-alternative-display', this.backgroundImage ? 'none' : 'unset');\r\n\t\t\tthis.style.setProperty('--image', `url('${this.backgroundImage}') no-repeat center center/cover`);\r\n\t\t}\r\n\t}\r\n\r\n\t#renderImageContainer() {\r\n\t\tif (!this.backgroundImage) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div id=\"image-container\">\r\n\t\t\t\t<div id=\"image\">\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\tid=\"curve-top\"\r\n\t\t\t\t\t\twidth=\"1746\"\r\n\t\t\t\t\t\theight=\"1374\"\r\n\t\t\t\t\t\tviewBox=\"0 0 1746 1374\"\r\n\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t<path d=\"M8 1C61.5 722.5 206.5 1366.5 1745.5 1366.5\" stroke=\"currentColor\" stroke-width=\"15\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\tid=\"curve-bottom\"\r\n\t\t\t\t\t\twidth=\"1364\"\r\n\t\t\t\t\t\theight=\"552\"\r\n\t\t\t\t\t\tviewBox=\"0 0 1364 552\"\r\n\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t<path d=\"M1 8C387 24 1109 11 1357 548\" stroke=\"currentColor\" stroke-width=\"15\" />\r\n\t\t\t\t\t</svg>\r\n\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis.logoImage,\r\n\t\t\t\t\t\t(logoImage) => html`<img id=\"logo-on-image\" src=${logoImage} alt=\"logo\" aria-hidden=\"true\" />`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderContent() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"content-container\">\r\n\t\t\t\t<div id=\"content\">\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`\r\n\t\t\t<div id=${this.backgroundImage ? 'main' : 'main-no-image'}>\r\n\t\t\t\t${this.#renderImageContainer()} ${this.#renderContent()}\r\n\t\t\t</div>\r\n\t\t\t${when(\r\n\t\t\t\tthis.logoImageAlternative,\r\n\t\t\t\t(logoImageAlternative) =>\r\n\t\t\t\t\thtml`<img id=\"logo-on-background\" src=${logoImageAlternative} alt=\"logo\" aria-hidden=\"true\" />`\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic styles: CSSResultGroup = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\t--uui-color-interactive: var(--umb-login-primary-color, #283a97);\r\n\t\t\t\t--uui-button-border-radius: var(--umb-login-button-border-radius, 45px);\r\n\t\t\t\t--uui-color-default: var(--uui-color-interactive);\r\n\t\t\t\t--uui-button-height: 42px;\r\n\t\t\t\t--uui-select-height: 38px;\r\n\r\n\t\t\t\t--input-height: 40px;\r\n\t\t\t\t--header-font-size: var(--umb-login-header-font-size, 3rem);\r\n\t\t\t\t--header-secondary-font-size: var(--umb-login-header-secondary-font-size, 2.4rem);\r\n\t\t\t\t--curves-color: var(--umb-login-curves-color, #f5c1bc);\r\n\t\t\t\t--curves-display: var(--umb-login-curves-display, inline);\r\n\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tbackground: var(--umb-login-background, #f4f4f4);\r\n\t\t\t\tcolor: var(--umb-login-text-color, #000);\r\n\t\t\t}\r\n\r\n\t\t\t#main-no-image,\r\n\t\t\t#main {\r\n\t\t\t\tmax-width: 1920px;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\theight: 100vh;\r\n\t\t\t\tpadding: 8px;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tmargin: 0 auto;\r\n\t\t\t}\r\n\r\n\t\t\t#image-container {\r\n\t\t\t\tdisplay: var(--umb-login-image-display, none);\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#content-container {\r\n\t\t\t\tbackground: var(--umb-login-content-background, none);\r\n\t\t\t\tdisplay: var(--umb-login-content-display, flex);\r\n\t\t\t\twidth: var(--umb-login-content-width, 100%);\r\n\t\t\t\theight: var(--umb-login-content-height, 100%);\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\toverflow: auto;\r\n\t\t\t\tborder-radius: var(--umb-login-content-border-radius, 0);\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\tmax-width: 360px;\r\n\t\t\t\tmargin: auto;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#image {\r\n\t\t\t\tbackground: var(--umb-login-image, var(--image));\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tborder-radius: var(--umb-login-image-border-radius, 38px);\r\n\t\t\t\tposition: relative;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\tcolor: var(--curves-color);\r\n\t\t\t}\r\n\r\n\t\t\t#image svg {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\twidth: 45%;\r\n\t\t\t\theight: fit-content;\r\n\t\t\t\tdisplay: var(--curves-display);\r\n\t\t\t}\r\n\r\n\t\t\t#curve-top {\r\n\t\t\t\ttop: -9%;\r\n\t\t\t\tright: -9%;\r\n\t\t\t}\r\n\r\n\t\t\t#curve-bottom {\r\n\t\t\t\tbottom: -0.5%;\r\n\t\t\t\tleft: -0.1%;\r\n\t\t\t}\r\n\r\n\t\t\t#logo-on-image,\r\n\t\t\t#logo-on-background {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tdisplay: var(--umb-logo-display, block);\r\n\t\t\t\ttop: var(--umb-logo-top, 24px);\r\n\t\t\t\tleft: var(--umb-logo-left, 24px);\r\n\t\t\t\twidth: var(--umb-logo-width, auto);\r\n\t\t\t\theight: var(--umb-logo-height, 55px);\r\n\t\t\t}\r\n\r\n\t\t\t@media only screen and (min-width: 900px) {\r\n\t\t\t\t:host {\r\n\t\t\t\t\t--header-font-size: var(--umb-login-header-font-size-large, 4rem);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t#main {\r\n\t\t\t\t\tpadding: 32px;\r\n\t\t\t\t\tpadding-right: 0;\r\n\t\t\t\t\talign-items: var(--umb-login-align-items, unset);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t#image-container {\r\n\t\t\t\t\tdisplay: var(--umb-login-image-display, block);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t#content-container {\r\n\t\t\t\t\tdisplay: var(--umb-login-content-display, flex);\r\n\t\t\t\t\tpadding: 16px;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t#logo-on-background {\r\n\t\t\t\t\tdisplay: var(--logo-alternative-display);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-auth-layout': UmbAuthLayoutElement;\r\n\t}\r\n}\r\n","import { CSSResultGroup, css, html, customElement, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\n\r\n@customElement('umb-confirmation-layout')\r\nexport default class UmbConfirmationLayoutElement extends UmbLitElement {\r\n  @property({ type: String })\r\n  header = '';\r\n\r\n  @property({ type: String })\r\n  message = '';\r\n\r\n  render() {\r\n    return html`\r\n      <header id=\"header\">\r\n        <h1>${this.header}</h1>\r\n        <span>${this.message}</span>\r\n      </header>\r\n\r\n      <umb-back-to-login-button></umb-back-to-login-button>\r\n\r\n      <slot></slot>\r\n    `;\r\n  }\r\n\r\n  static styles: CSSResultGroup = [\r\n    css`\r\n      :host {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-layout-1);\r\n      }\r\n\r\n      #header {\r\n        text-align: center;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-space-5);\r\n      }\r\n\r\n      #header span {\r\n        color: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n        font-size: 14px;\r\n      }\r\n\r\n      #header h1 {\r\n        margin: 0;\r\n        font-weight: 400;\r\n        font-size: var(--header-secondary-font-size);\r\n        color: var(--uui-color-interactive);\r\n        line-height: 1.2;\r\n      }\r\n\r\n      uui-button {\r\n        width: 100%;\r\n        margin-top: var(--uui-size-space-5);\r\n        --uui-button-padding-top-factor: 1.5;\r\n        --uui-button-padding-bottom-factor: 1.5;\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-confirmation-layout': UmbConfirmationLayoutElement;\r\n  }\r\n}\r\n","import { CSSResultGroup, css, html, customElement, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\n\r\n@customElement('umb-error-layout')\r\nexport default class UmbErrorLayoutElement extends UmbLitElement {\r\n  @property({ type: String })\r\n  header = '';\r\n\r\n  @property({ type: String })\r\n  message = '';\r\n\r\n  @property({ type: Boolean, attribute: 'no-back-link' })\r\n  noBackLink = false;\r\n\r\n  render() {\r\n    return html`\r\n      <header id=\"header\">\r\n        <h1>${this.header?.length ? this.header : html`<umb-localize key=\"auth_friendlyGreeting\">Hi there</umb-localize>`}</h1>\r\n        <span>${this.message}</span>\r\n      </header>\r\n      <slot></slot>\r\n      ${!this.noBackLink ? html`<umb-back-to-login-button></umb-back-to-login-button>`: ''}\r\n    `;\r\n  }\r\n\r\n  static styles: CSSResultGroup = [\r\n    css`\r\n      :host {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-layout-1);\r\n      }\r\n\r\n      #header {\r\n        text-align: center;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-space-5);\r\n      }\r\n\r\n      #header span {\r\n        color: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n        font-size: 14px;\r\n      }\r\n\r\n      #header h1 {\r\n        margin: 0;\r\n        font-weight: 400;\r\n        font-size: var(--header-secondary-font-size);\r\n        color: var(--uui-color-interactive);\r\n        line-height: 1.2;\r\n      }\r\n\r\n      ::slotted(uui-button) {\r\n        width: 100%;\r\n        margin-top: var(--uui-size-space-5);\r\n        --uui-button-padding-top-factor: 1.5;\r\n        --uui-button-padding-bottom-factor: 1.5;\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-error-layout': UmbErrorLayoutElement;\r\n  }\r\n}\r\n","import type { UUIButtonState, UUIInputPasswordElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { type CSSResultGroup, css, html, nothing, customElement, property, query, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\n\r\nimport { UMB_AUTH_CONTEXT } from '../../contexts';\r\n\r\n@customElement('umb-new-password-layout')\r\nexport default class UmbNewPasswordLayoutElement extends UmbLitElement {\r\n  @query('#password')\r\n  passwordElement!: UUIInputPasswordElement;\r\n\r\n  @query('#confirmPassword')\r\n  confirmPasswordElement!: UUIInputPasswordElement;\r\n\r\n  @property()\r\n  state: UUIButtonState = undefined;\r\n\r\n  @property()\r\n  error: string = '';\r\n\r\n  @property()\r\n  userId: string = '';\r\n\r\n  @property({ type: Boolean, attribute: 'is-invite' })\r\n  isInvite = false;\r\n\r\n  @state()\r\n  _passwordConfiguration?: typeof UMB_AUTH_CONTEXT.TYPE['passwordConfiguration'];\r\n\r\n  @state()\r\n  _passwordPattern = '';\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_AUTH_CONTEXT, (authContext) => {\r\n      // Build a pattern\r\n      let pattern = '';\r\n      this._passwordConfiguration = authContext?.passwordConfiguration;\r\n      if (this._passwordConfiguration?.requireDigit) {\r\n        pattern += '(?=.*\\\\d)';\r\n      }\r\n      if (this._passwordConfiguration?.requireLowercase) {\r\n        pattern += '(?=.*[a-z])';\r\n      }\r\n      if (this._passwordConfiguration?.requireUppercase) {\r\n        pattern += '(?=.*[A-Z])';\r\n      }\r\n      if (this._passwordConfiguration?.requireNonLetterOrDigit) {\r\n        pattern += '(?=.*\\\\W)';\r\n      }\r\n      pattern += `.{${this._passwordConfiguration?.minimumPasswordLength ?? 10},}`;\r\n      this._passwordPattern = pattern;\r\n    });\r\n  }\r\n\r\n  #onSubmit(event: Event) {\r\n    event.preventDefault();\r\n    if (!this._passwordConfiguration) return;\r\n\r\n    const form = event.target as HTMLFormElement;\r\n\r\n    this.passwordElement.setCustomValidity('');\r\n    this.confirmPasswordElement.setCustomValidity('');\r\n\r\n    if (!form) return;\r\n    if (!form.checkValidity()) return;\r\n\r\n    const formData = new FormData(form);\r\n    const password = formData.get('password') as string;\r\n    const passwordConfirm = formData.get('confirmPassword') as string;\r\n\r\n    let passwordIsInvalid = false;\r\n\r\n    if (this._passwordConfiguration.minimumPasswordLength > 0 && password.length < this._passwordConfiguration.minimumPasswordLength) {\r\n      passwordIsInvalid = true;\r\n    }\r\n\r\n    if (this._passwordConfiguration.requireNonLetterOrDigit) {\r\n      const hasNonLetterOrDigit = /\\W/.test(password);\r\n      if (!hasNonLetterOrDigit) {\r\n        passwordIsInvalid = true;\r\n      }\r\n    }\r\n\r\n    if (this._passwordConfiguration.requireDigit) {\r\n      const hasDigit = /\\d/.test(password);\r\n      if (!hasDigit) {\r\n        passwordIsInvalid = true;\r\n      }\r\n    }\r\n\r\n    if (this._passwordConfiguration.requireLowercase) {\r\n      const hasLowercase = /[a-z]/.test(password);\r\n      if (!hasLowercase) {\r\n        passwordIsInvalid = true;\r\n      }\r\n    }\r\n\r\n    if (this._passwordConfiguration.requireUppercase) {\r\n      const hasUppercase = /[A-Z]/.test(password);\r\n      if (!hasUppercase) {\r\n        passwordIsInvalid = true;\r\n      }\r\n    }\r\n\r\n    if (passwordIsInvalid) {\r\n      const passwordValidityText = this.localize.term(\r\n        'auth_errorInPasswordFormat',\r\n        this._passwordConfiguration.minimumPasswordLength,\r\n        this._passwordConfiguration.requireNonLetterOrDigit ? 1 : 0\r\n      ) ?? 'The password does not meet the minimum requirements!';\r\n      this.passwordElement.setCustomValidity(passwordValidityText);\r\n      return;\r\n    }\r\n\r\n    if (password !== passwordConfirm) {\r\n      const passwordValidityText = this.localize.term(\r\n        'auth_passwordMismatch'\r\n      ) ?? \"The confirmed password doesn't match the new password!\";\r\n      this.confirmPasswordElement.setCustomValidity(passwordValidityText);\r\n      return;\r\n    }\r\n\r\n    this.dispatchEvent(new CustomEvent('submit', {detail: {password}}));\r\n  }\r\n\r\n  renderHeader() {\r\n    if (this.isInvite) {\r\n      return html`\r\n        <h1>Hi!</h1>\r\n        <span>\r\n          <umb-localize key=\"auth_userInviteWelcomeMessage\">\r\n            Welcome to Umbraco! Just need to get your password setup and then you're good to go\r\n          </umb-localize>\r\n        </span>\r\n      `;\r\n    } else {\r\n      return html`\r\n        <h1>\r\n          <umb-localize key=\"auth_newPassword\">New password</umb-localize>\r\n        </h1>\r\n        <span>\r\n            <umb-localize key=\"auth_setPasswordInstruction\">Please provide a new password.</umb-localize>\r\n        </span>\r\n      `;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <uui-form>\r\n        <form id=\"LoginForm\" name=\"login\" @submit=${this.#onSubmit}>\r\n          <header id=\"header\">${this.renderHeader()}</header>\r\n          <uui-form-layout-item>\r\n            <uui-label id=\"passwordLabel\" for=\"password\" slot=\"label\" required>\r\n              <umb-localize key=\"auth_newPassword\">New password</umb-localize>\r\n            </uui-label>\r\n            <uui-input-password\r\n              type=\"password\"\r\n              id=\"password\"\r\n              name=\"password\"\r\n              autocomplete=\"new-password\"\r\n              pattern=\"${this._passwordPattern}\"\r\n              .minlength=${this._passwordConfiguration?.minimumPasswordLength}\r\n              .minlengthMessage=${this.localize.term('auth_passwordMinLength', this._passwordConfiguration?.minimumPasswordLength ?? 10)}\r\n              .label=${this.localize.term('auth_newPassword')}\r\n              required\r\n              required-message=${this.localize.term('auth_passwordIsBlank')}>\r\n            </uui-input-password>\r\n          </uui-form-layout-item>\r\n\r\n          <uui-form-layout-item>\r\n            <uui-label id=\"confirmPasswordLabel\" for=\"confirmPassword\" slot=\"label\" required>\r\n              <umb-localize key=\"auth_confirmNewPassword\">Confirm new password</umb-localize>\r\n            </uui-label>\r\n            <uui-input-password\r\n              type=\"password\"\r\n              id=\"confirmPassword\"\r\n              name=\"confirmPassword\"\r\n              autocomplete=\"new-password\"\r\n              pattern=\"${this._passwordPattern}\"\r\n              .minlength=${this._passwordConfiguration?.minimumPasswordLength}\r\n              .minlengthMessage=${this.localize.term('auth_passwordMinLength', this._passwordConfiguration?.minimumPasswordLength ?? 10)}\r\n              .label=${this.localize.term('auth_confirmNewPassword')}\r\n              required\r\n              required-message=${this.localize.term('auth_required')}></uui-input-password>\r\n          </uui-form-layout-item>\r\n\r\n          ${this.#renderErrorMessage()}\r\n\r\n          <uui-button\r\n            type=\"submit\"\r\n            label=${this.localize.term('auth_continue')}\r\n            look=\"primary\"\r\n            color=\"default\"\r\n            .state=${this.state}></uui-button>\r\n        </form>\r\n      </uui-form>\r\n\r\n      <umb-back-to-login-button style=\"margin-top: var(--uui-size-space-6)\"></umb-back-to-login-button>\r\n    `;\r\n  }\r\n\r\n  #renderErrorMessage() {\r\n    if (!this.error || this.state !== 'failed') return nothing;\r\n\r\n    return html`<span class=\"text-danger\">${this.error}</span>`;\r\n  }\r\n\r\n  static styles: CSSResultGroup = [\r\n    css`\r\n      #header {\r\n        text-align: center;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-space-5);\r\n      }\r\n\r\n      #header span {\r\n        color: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n        font-size: 14px;\r\n      }\r\n\r\n      #header h1 {\r\n        margin: 0;\r\n        font-weight: 400;\r\n        font-size: var(--header-secondary-font-size);\r\n        color: var(--uui-color-interactive);\r\n        line-height: 1.2;\r\n      }\r\n\r\n      form {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-space-5);\r\n      }\r\n\r\n      uui-form-layout-item {\r\n        margin: 0;\r\n      }\r\n\r\n      uui-input-password {\r\n        width: 100%;\r\n        height: var(--input-height);\r\n        border-radius: var(--uui-border-radius);\r\n      }\r\n\r\n      uui-button {\r\n        width: 100%;\r\n        margin-top: var(--uui-size-space-5);\r\n        --uui-button-padding-top-factor: 1.5;\r\n        --uui-button-padding-bottom-factor: 1.5;\r\n      }\r\n\r\n      .text-danger {\r\n        color: var(--uui-color-danger-standalone);\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-new-password-layout': UmbNewPasswordLayoutElement;\r\n  }\r\n}\r\n","import type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { html, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_AUTH_CONTEXT } from \"../../contexts\";\r\n\r\n@customElement('umb-invite-page')\r\nexport default class UmbInvitePageElement extends UmbLitElement {\r\n  #token = '';\r\n  #userId = '';\r\n\r\n  @state()\r\n  state: UUIButtonState = undefined;\r\n\r\n  @state()\r\n  error = '';\r\n\r\n  @state()\r\n  loading = true;\r\n\r\n  #authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_AUTH_CONTEXT, (authContext) => {\r\n      this.#authContext = authContext;\r\n      this.#init();\r\n    });\r\n  }\r\n\r\n  async #init() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const token = urlParams.get('inviteCode');\r\n    const userId = urlParams.get('userId');\r\n\r\n    if (!token || !userId) {\r\n      this.error = 'The invite has expired or is invalid';\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    if (!this.#authContext) return;\r\n\r\n    this.#token = token;\r\n    this.#userId = userId;\r\n\r\n    const response = await this.#authContext.validateInviteCode(this.#token, this.#userId);\r\n\r\n    if (response.error) {\r\n      this.error = response.error;\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    if (!response.passwordConfiguration) {\r\n      this.error = 'There is no password configuration for the invite code. Please contact the administrator.';\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    this.#authContext.passwordConfiguration = response.passwordConfiguration;\r\n    this.loading = false;\r\n  }\r\n\r\n  async #onSubmit(event: CustomEvent) {\r\n    event.preventDefault();\r\n    const password = event.detail.password;\r\n\r\n    if (!password) return;\r\n\r\n    if (!this.#authContext) return;\r\n\r\n    this.state = 'waiting';\r\n    const response = await this.#authContext.newInvitedUserPassword(password, this.#token, this.#userId);\r\n\r\n    if (response.error) {\r\n      this.error = response.error;\r\n      this.state = 'failed';\r\n      return;\r\n    }\r\n\r\n    this.state = 'success';\r\n    window.location.href = this.#authContext.returnPath;\r\n  }\r\n\r\n  render() {\r\n    return this.loading ? html`<uui-loader-bar></uui-loader-bar>` : (\r\n      this.error\r\n        ? html`\r\n          <umb-error-layout\r\n            header=${this.localize.term('auth_error')}\r\n            message=${this.error ?? this.localize.term('auth_defaultError')}>\r\n          </umb-error-layout>`\r\n      : html`\r\n        <umb-new-password-layout\r\n          @submit=${this.#onSubmit}\r\n          is-invite\r\n          .userId=${this.#userId}\r\n          .state=${this.state}\r\n          .error=${this.error}></umb-new-password-layout>`\r\n    );\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-invite-page': UmbInvitePageElement;\r\n  }\r\n}\r\n","import type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, type CSSResultGroup, html, nothing, when, customElement, property, queryAssignedElements, state } from '@umbraco-cms/backoffice/external/lit';\r\n\r\nimport { UMB_AUTH_CONTEXT } from '../../contexts';\r\n\r\n@customElement('umb-login-page')\r\nexport default class UmbLoginPageElement extends UmbLitElement {\r\n  @property({type: Boolean, attribute: 'username-is-email'})\r\n  usernameIsEmail = false;\r\n\r\n  @queryAssignedElements({flatten: true})\r\n  protected slottedElements?: HTMLFormElement[];\r\n\r\n  @property({type: Boolean, attribute: 'allow-password-reset'})\r\n  allowPasswordReset = false;\r\n\r\n  @state()\r\n  private _loginState?: UUIButtonState;\r\n\r\n  @state()\r\n  private _loginError = '';\r\n\r\n  @state()\r\n  supportPersistLogin = false;\r\n\r\n  #formElement?: HTMLFormElement;\r\n\r\n  #authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_AUTH_CONTEXT, (authContext) => {\r\n      this.#authContext = authContext;\r\n      this.supportPersistLogin = authContext?.supportsPersistLogin ?? false;\r\n    });\r\n  }\r\n\r\n  async #onSlotChanged() {\r\n    this.#formElement = this.slottedElements?.find((el) => el.id === 'umb-login-form');\r\n\r\n    if (!this.#formElement) return;\r\n\r\n    // We need to listen for the enter key to submit the form, because the uui-button does not support the native input fields submit event\r\n    this.#formElement.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        this.#onSubmitClick();\r\n      }\r\n    });\r\n    this.#formElement.onsubmit = this.#handleSubmit;\r\n  }\r\n\r\n  #handleSubmit = async (e: SubmitEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!this.#authContext) return;\r\n\r\n    const form = e.target as HTMLFormElement;\r\n    if (!form) return;\r\n\r\n    const formData = new FormData(form);\r\n\r\n    const username = formData.get('username') as string;\r\n    const password = formData.get('password') as string;\r\n    const persist = formData.has('persist');\r\n\r\n    if (!username || !password) {\r\n      this._loginError = this.localize.term('auth_userFailedLogin');\r\n      this._loginState = 'failed';\r\n      return;\r\n    }\r\n\r\n    this._loginState = 'waiting';\r\n\r\n    const response = await this.#authContext.login({\r\n      username,\r\n      password,\r\n      persist,\r\n    });\r\n\r\n    this._loginError = response.error || '';\r\n    this._loginState = response.error ? 'failed' : 'success';\r\n\r\n    // Check for 402 status code indicating that MFA is required\r\n    if (response.status === 402) {\r\n      this.#authContext.isMfaEnabled = true;\r\n      if (response.twoFactorView) {\r\n        this.#authContext.twoFactorView = response.twoFactorView;\r\n      }\r\n      if (response.twoFactorProviders) {\r\n        this.#authContext.mfaProviders = response.twoFactorProviders;\r\n      }\r\n\r\n      this.dispatchEvent(new CustomEvent('umb-login-flow', {composed: true, detail: {flow: 'mfa'}}));\r\n      return;\r\n    }\r\n\r\n    if (response.error) {\r\n      return;\r\n    }\r\n\r\n    const returnPath = this.#authContext.returnPath;\r\n\r\n    if (returnPath) {\r\n      location.href = returnPath;\r\n    }\r\n  };\r\n\r\n  get #greetingLocalizationKey() {\r\n    return [\r\n      'auth_greeting0',\r\n      'auth_greeting1',\r\n      'auth_greeting2',\r\n      'auth_greeting3',\r\n      'auth_greeting4',\r\n      'auth_greeting5',\r\n      'auth_greeting6',\r\n    ][new Date().getDay()];\r\n  }\r\n\r\n  #onSubmitClick = () => {\r\n    this.#formElement?.requestSubmit();\r\n  };\r\n\r\n  render() {\r\n    return html`\r\n      <header id=\"header\">\r\n        <h1 id=\"greeting\">\r\n          <umb-localize .key=${this.#greetingLocalizationKey}></umb-localize>\r\n        </h1>\r\n        <slot name=\"subheadline\"></slot>\r\n      </header>\r\n      <slot @slotchange=${this.#onSlotChanged}></slot>\r\n      <div id=\"secondary-actions\">\r\n        ${when(\r\n          this.supportPersistLogin,\r\n          () => html`\r\n            <uui-form-layout-item>\r\n              <uui-checkbox\r\n                name=\"persist\"\r\n                .label=${this.localize.term('auth_rememberMe')}>\r\n                <umb-localize key=\"auth_rememberMe\">Remember me</umb-localize>\r\n              </uui-checkbox>\r\n            </uui-form-layout-item>`\r\n        )}\r\n        ${when(\r\n          this.allowPasswordReset,\r\n          () =>\r\n            html`\r\n              <button type=\"button\" id=\"forgot-password\" @click=${this.#handleForgottenPassword}>\r\n                <umb-localize key=\"auth_forgottenPassword\">Forgotten password?</umb-localize>\r\n              </button>`\r\n        )}\r\n      </div>\r\n      <uui-button\r\n        type=\"submit\"\r\n        id=\"umb-login-button\"\r\n        look=\"primary\"\r\n        @click=${this.#onSubmitClick}\r\n        .label=${this.localize.term('auth_login')}\r\n        color=\"default\"\r\n        .state=${this._loginState}></uui-button>\r\n\r\n      ${this.#renderErrorMessage()}\r\n    `;\r\n  }\r\n\r\n  #renderErrorMessage() {\r\n    if (!this._loginError || this._loginState !== 'failed') return nothing;\r\n\r\n    return html`<span class=\"text-error text-danger\">${this._loginError}</span>`;\r\n  }\r\n\r\n  #handleForgottenPassword() {\r\n    this.dispatchEvent(new CustomEvent('umb-login-flow', {composed: true, detail: {flow: 'reset'}}));\r\n  }\r\n\r\n  static styles: CSSResultGroup = [\r\n    css`\r\n      :host {\r\n        display: flex;\r\n        flex-direction: column;\r\n      }\r\n\r\n      #header {\r\n        text-align: center;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-space-5);\r\n      }\r\n\r\n      #header span {\r\n        color: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n        font-size: 14px;\r\n      }\r\n\r\n      #greeting {\r\n        color: var(--uui-color-interactive);\r\n        text-align: center;\r\n        font-weight: 400;\r\n        font-size: var(--header-font-size);\r\n        margin: 0 0 var(--uui-size-layout-1);\r\n        line-height: 1.2;\r\n      }\r\n\r\n      #umb-login-button {\r\n        margin-top: var(--uui-size-space-4);\r\n        width: 100%;\r\n      }\r\n\r\n      #forgot-password {\r\n        cursor: pointer;\r\n        background: none;\r\n        border: 0;\r\n        height: 1rem;\r\n        color: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n        gap: var(--uui-size-space-1);\r\n        align-self: center;\r\n        text-decoration: none;\r\n        display: inline-flex;\r\n        line-height: 1;\r\n        font-size: 14px;\r\n        font-family: var(--uui-font-family),sans-serif;\r\n        margin-left: auto;\r\n        margin-bottom: var(--uui-size-space-3);\r\n      }\r\n\r\n      #forgot-password:hover {\r\n        color: var(--uui-color-interactive-emphasis);\r\n      }\r\n\r\n      .text-error {\r\n        margin-top: var(--uui-size-space-4);\r\n      }\r\n\r\n      .text-danger {\r\n        color: var(--uui-color-danger-standalone);\r\n      }\r\n\r\n      #secondary-actions {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-login-page': UmbLoginPageElement;\r\n  }\r\n}\r\n","import { html, unsafeHTML } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * Try to load a custom view.\r\n * Supports both HTML and JS files (JS files must have a default export).\r\n *\r\n * @param view The path to the custom view.\r\n * @returns A view part.\r\n */\r\nexport async function loadCustomView<T extends HTMLElement>(view: string): Promise<T | string> {\r\n\tif (view.endsWith('.html')) {\r\n\t\treturn fetch(view).then((response) => response.text());\r\n\t}\r\n\r\n\tconst module = await import(/* @vite-ignore */ view);\r\n\r\n\tif (!module.default) throw new Error('No default export found');\r\n\r\n\treturn new module.default() as T;\r\n}\r\n\r\nexport function renderCustomView<T extends HTMLElement>(view: T | string) {\r\n\tif (typeof view === 'string') {\r\n\t\treturn html`${unsafeHTML(view)}`;\r\n\t}\r\n\r\n\treturn view;\r\n}\r\n","import type {UUIButtonState, UUIInputElement} from '@umbraco-cms/backoffice/external/uui';\r\nimport {css, html, nothing, customElement, state, until} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\n\r\nimport { loadCustomView, renderCustomView } from '../../utils/load-custom-view.function.js';\r\nimport { UMB_AUTH_CONTEXT } from \"../../contexts\";\r\n\r\ntype MfaCustomViewElement = HTMLElement & {\r\n  providers?: string[];\r\n  returnPath?: string;\r\n};\r\n\r\n@customElement('umb-mfa-page')\r\nexport default class UmbMfaPageElement extends UmbLitElement {\r\n  @state()\r\n  protected providers: Array<{ name: string; value: string; selected: boolean }> = [];\r\n\r\n  @state()\r\n  private buttonState?: UUIButtonState;\r\n\r\n  @state()\r\n  private error: string | null = null;\r\n\r\n  #authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n\r\n  constructor() {\r\n    super();\r\n    this.consumeContext(UMB_AUTH_CONTEXT, authContext => {\r\n      this.#authContext = authContext;\r\n      this.#loadProviders();\r\n    });\r\n  }\r\n\r\n  #loadProviders() {\r\n    this.providers = this.#authContext?.mfaProviders.map((provider) => ({name: provider, value: provider, selected: false})) ?? [];\r\n\r\n    if (this.providers.length) {\r\n      this.providers[0].selected = true;\r\n    } else {\r\n      this.error = 'Error: No providers available';\r\n    }\r\n  }\r\n\r\n  async #handleSubmit(e: SubmitEvent) {\r\n    e.preventDefault();\r\n\r\n    if (!this.#authContext) return;\r\n\r\n    this.error = null;\r\n\r\n    const form = e.target as HTMLFormElement;\r\n    if (!form) return;\r\n\r\n    const codeInput = form.elements.namedItem('mfacode') as UUIInputElement;\r\n\r\n    if (codeInput) {\r\n      codeInput.error = false;\r\n      codeInput.errorMessage = '';\r\n      codeInput.setCustomValidity('');\r\n    }\r\n\r\n    if (!form.checkValidity()) return;\r\n\r\n    const formData = new FormData(form);\r\n\r\n    let provider = formData.get('provider') as string;\r\n\r\n    // If no provider given, use the first one (there probably is only one anyway)\r\n    if (!provider) {\r\n      // If there are no providers, we can't continue\r\n      if (!this.providers.length) {\r\n        this.error = 'No providers available';\r\n        return;\r\n      }\r\n\r\n      provider = this.providers[0].value;\r\n    }\r\n\r\n    if (!provider) {\r\n      this.error = 'No provider selected';\r\n      return;\r\n    }\r\n\r\n    const code = formData.get('token') as string;\r\n\r\n    this.buttonState = 'waiting';\r\n\r\n    const response = await this.#authContext.validateMfaCode(code, provider);\r\n    if (response.error) {\r\n      if (codeInput) {\r\n        codeInput.error = true;\r\n        codeInput.errorMessage = response.error;\r\n      } else {\r\n        this.error = response.error;\r\n      }\r\n      this.buttonState = 'failed';\r\n      return;\r\n    }\r\n\r\n    this.buttonState = 'success';\r\n\r\n    const returnPath = this.#authContext.returnPath;\r\n    if (returnPath) {\r\n      location.href = returnPath;\r\n    }\r\n  }\r\n\r\n  protected renderDefaultView() {\r\n    return html`\r\n      <uui-form>\r\n        <form id=\"LoginForm\" @submit=${this.#handleSubmit} novalidate>\r\n          <header id=\"header\">\r\n            <h1>\r\n              <umb-localize key=\"auth_mfaTitle\">One last step</umb-localize>\r\n            </h1>\r\n\r\n            <p>\r\n              <umb-localize key=\"auth_mfaText\">\r\n                You have enabled 2-factor authentication and must verify your identity.\r\n              </umb-localize>\r\n            </p>\r\n          </header>\r\n\r\n          <!-- if there's only one provider active, it will skip this step! -->\r\n          ${this.providers.length > 1\r\n            ? html`\r\n              <uui-form-layout-item>\r\n                <uui-label id=\"providerLabel\" for=\"provider\" slot=\"label\" required>\r\n                  <umb-localize key=\"auth_mfaMultipleText\">Please choose a 2-factor provider</umb-localize>\r\n                </uui-label>\r\n                <uui-select label=${this.localize.term('auth_mfaMultipleText')} id=\"provider\" name=\"provider\" .options=${this.providers} aria-required=\"true\" required></uui-select>\r\n              </uui-form-layout-item>\r\n            `\r\n            : nothing}\r\n\r\n          <uui-form-layout-item>\r\n            <uui-label id=\"mfacodeLabel\" for=\"mfacode\" slot=\"label\" required>\r\n              <umb-localize key=\"auth_mfaCodeInput\">Verification code</umb-localize>\r\n            </uui-label>\r\n\r\n            <uui-input\r\n              autofocus\r\n              id=\"mfacode\"\r\n              type=\"text\"\r\n              name=\"token\"\r\n              inputmode=\"numeric\"\r\n              autocomplete=\"one-time-code\"\r\n              placeholder=${this.localize.term('auth_mfaCodeInputHelp')}\r\n              aria-required=\"true\"\r\n              required\r\n              required-message=${this.localize.term('auth_mfaCodeInputHelp')}\r\n              label=${this.localize.term('auth_mfaCodeInput')}\r\n              style=\"width:100%;\">\r\n            </uui-input>\r\n          </uui-form-layout-item>\r\n\r\n          ${this.error ? html` <span class=\"text-danger\">${this.error}</span> ` : nothing}\r\n\r\n          <uui-button\r\n            .state=${this.buttonState}\r\n            button-style=\"success\"\r\n            look=\"primary\"\r\n            color=\"default\"\r\n            label=${this.localize.term('auth_validate')}\r\n            type=\"submit\"></uui-button>\r\n        </form>\r\n      </uui-form>\r\n\r\n      <umb-back-to-login-button style=\"margin-top: var(--uui-size-space-6)\"></umb-back-to-login-button>\r\n    `;\r\n  }\r\n\r\n  protected async renderCustomView() {\r\n    const view = this.#authContext?.twoFactorView;\r\n    if (!view) return nothing;\r\n\r\n    try {\r\n      const customView = await loadCustomView<MfaCustomViewElement>(view);\r\n      if (typeof customView === 'object') {\r\n        customView.providers = this.providers.map((provider) => provider.value);\r\n        customView.returnPath = this.#authContext?.returnPath ?? '';\r\n      }\r\n      return renderCustomView(customView);\r\n    } catch (e) {\r\n      const error = e instanceof Error ? e.message : 'Unknown error';\r\n      console.group('[MFA login] Failed to load custom view');\r\n      console.log('Element reference', this);\r\n      console.log('Custom view', view);\r\n      console.error('Failed to load custom view:', e);\r\n      console.groupEnd();\r\n      return html`<span class=\"text-danger\">${error}</span>`;\r\n    }\r\n  }\r\n\r\n  protected render() {\r\n    return this.#authContext?.twoFactorView\r\n        ? until(this.renderCustomView(), html`\r\n          <uui-loader-bar></uui-loader-bar>`)\r\n        : this.renderDefaultView();\r\n  }\r\n\r\n  static styles = [\r\n    css`\r\n      #header {\r\n        text-align: center;\r\n      }\r\n\r\n      #header h1 {\r\n        font-weight: 400;\r\n        font-size: var(--header-secondary-font-size);\r\n        color: var(--uui-color-interactive);\r\n        line-height: 1.2;\r\n      }\r\n\r\n      form {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: var(--uui-size-layout-2);\r\n      }\r\n\r\n      #provider {\r\n        width: 100%;\r\n      }\r\n\r\n      uui-form-layout-item {\r\n        margin: 0;\r\n      }\r\n\r\n      uui-input,\r\n      uui-input-password {\r\n        width: 100%;\r\n        height: var(--input-height);\r\n        border-radius: var(--uui-border-radius);\r\n      }\r\n\r\n      uui-input {\r\n        width: 100%;\r\n      }\r\n\r\n      uui-button {\r\n        width: 100%;\r\n        --uui-button-padding-top-factor: 1.5;\r\n        --uui-button-padding-bottom-factor: 1.5;\r\n      }\r\n\r\n      .text-danger {\r\n        color: var(--uui-color-danger-standalone);\r\n      }\r\n    `,\r\n  ];\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-mfa-page': UmbMfaPageElement;\r\n  }\r\n}\r\n","import type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { html, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\nimport { UMB_AUTH_CONTEXT } from \"../../contexts\";\r\n\r\n@customElement('umb-new-password-page')\r\nexport default class UmbNewPasswordPageElement extends UmbLitElement {\r\n  @state()\r\n  state: UUIButtonState = undefined;\r\n\r\n  @state()\r\n  page: 'new' | 'done' | 'error' = 'new';\r\n\r\n  @state()\r\n  error = '';\r\n\r\n  @state()\r\n  userId = '';\r\n\r\n  @state()\r\n  resetCode = '';\r\n\r\n  @state()\r\n  loading = true;\r\n\r\n  #authContext?: typeof UMB_AUTH_CONTEXT.TYPE;\r\n\r\n  constructor() {\r\n    super();\r\n    this.consumeContext(UMB_AUTH_CONTEXT, (authContext) => {\r\n      this.#authContext = authContext;\r\n      this.#init();\r\n    });\r\n  }\r\n\r\n  async #init() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const resetCode = urlParams.get('resetCode');\r\n    const userId = urlParams.get('userId');\r\n\r\n    if (!userId || !resetCode) {\r\n      this.page = 'error';\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    if (!this.#authContext) return;\r\n\r\n    this.resetCode = resetCode;\r\n    this.userId = userId;\r\n\r\n    const verifyResponse = await this.#authContext.validatePasswordResetCode(this.userId, this.resetCode);\r\n\r\n    if (verifyResponse.error) {\r\n      this.page = 'error';\r\n      this.error = verifyResponse.error;\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    if (!verifyResponse.passwordConfiguration) {\r\n      this.page = 'error';\r\n      this.error = 'Password configuration is missing';\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    this.#authContext.passwordConfiguration = verifyResponse.passwordConfiguration;\r\n\r\n    this.loading = false;\r\n  }\r\n\r\n  async #onSubmit(event: CustomEvent) {\r\n    event.preventDefault();\r\n\r\n    this.error = '';\r\n\r\n    if (!this.#authContext) return;\r\n\r\n    const password = event.detail.password;\r\n\r\n    this.state = 'waiting';\r\n    const response = await this.#authContext.newPassword(password, this.resetCode, this.userId);\r\n\r\n    if (response.error) {\r\n      this.state = 'failed';\r\n      this.error = response.error;\r\n      return;\r\n    }\r\n\r\n    this.state = 'success';\r\n    this.page = 'done';\r\n  }\r\n\r\n  #renderRoutes() {\r\n    switch (this.page) {\r\n      case 'new':\r\n        return html`\r\n          <umb-new-password-layout\r\n            @submit=${this.#onSubmit}\r\n            .userId=${this.userId!}\r\n            .state=${this.state}\r\n            .error=${this.error}></umb-new-password-layout>`;\r\n      case 'error':\r\n        return html`\r\n          <umb-error-layout\r\n            header=${this.localize.term('auth_error')}\r\n            message=${this.error ?? this.localize.term('auth_defaultError')}>\r\n          </umb-error-layout>`;\r\n      case 'done':\r\n        return html`\r\n          <umb-confirmation-layout\r\n            header=${this.localize.term('auth_success')}\r\n            message=${this.localize.term('auth_setPasswordConfirmation')}>\r\n          </umb-confirmation-layout>`;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return this.loading ? html`<uui-loader-bar></uui-loader-bar>` : this.#renderRoutes();\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'umb-new-password-page': UmbNewPasswordPageElement;\r\n  }\r\n}\r\n","import type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { type CSSResultGroup, css, html, nothing, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\nimport { UMB_AUTH_CONTEXT } from '../../contexts';\r\n\r\n@customElement('umb-reset-password-page')\r\nexport default class UmbResetPasswordPageElement extends UmbLitElement {\r\n\t@state()\r\n\tresetCallState: UUIButtonState = undefined;\r\n\r\n\t@state()\r\n\terror = '';\r\n\r\n\t#handleResetSubmit = async (e: SubmitEvent) => {\r\n\t\te.preventDefault();\r\n\t\tconst form = e.target as HTMLFormElement;\r\n\r\n\t\tif (!form) return;\r\n\t\tif (!form.checkValidity()) return;\r\n\r\n\t\tconst formData = new FormData(form);\r\n\t\tconst username = formData.get('email') as string;\r\n\r\n\t\tthis.resetCallState = 'waiting';\r\n\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\tif (!authContext) {\r\n\t\t\tthis.resetCallState = 'failed';\r\n\t\t\tthis.error = 'Authentication context not available.';\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst response = await authContext.resetPassword(username);\r\n\t\tthis.resetCallState = response.error ? 'failed' : 'success';\r\n\t\tthis.error = response.error || '';\r\n\t};\r\n\r\n\t#renderResetPage() {\r\n\t\treturn html`\r\n\t\t\t<uui-form>\r\n\t\t\t\t<form id=\"LoginForm\" name=\"login\" @submit=\"${this.#handleResetSubmit}\">\r\n\t\t\t\t\t<header id=\"header\">\r\n\t\t\t\t\t\t<h1>\r\n\t\t\t\t\t\t\t<umb-localize key=\"auth_forgottenPassword\">Forgotten password?</umb-localize>\r\n\t\t\t\t\t\t</h1>\r\n\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t<umb-localize key=\"auth_forgottenPasswordInstruction\">\r\n\t\t\t\t\t\t\t\tAn email will be sent to the address specified with a link to reset your password\r\n\t\t\t\t\t\t\t</umb-localize>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</header>\r\n\r\n\t\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t\t<uui-label for=\"email\" slot=\"label\" required>\r\n\t\t\t\t\t\t\t<umb-localize key=\"auth_email\">Email</umb-localize>\r\n\t\t\t\t\t\t</uui-label>\r\n\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\ttype=\"email\"\r\n\t\t\t\t\t\t\tid=\"email\"\r\n\t\t\t\t\t\t\tname=\"email\"\r\n\t\t\t\t\t\t\t.label=${this.localize.term('auth_email')}\r\n\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\trequired-message=${this.localize.term('auth_required')}>\r\n\t\t\t\t\t\t</uui-input>\r\n\t\t\t\t\t</uui-form-layout-item>\r\n\r\n\t\t\t\t\t${this.#renderErrorMessage()}\r\n\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t.label=${this.localize.term('auth_submit')}\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"default\"\r\n\t\t\t\t\t\t.state=${this.resetCallState}></uui-button>\r\n\t\t\t\t</form>\r\n\t\t\t</uui-form>\r\n\r\n\t\t\t<umb-back-to-login-button style=\"margin-top: var(--uui-size-space-6)\"></umb-back-to-login-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderErrorMessage() {\r\n\t\tif (!this.error || this.resetCallState !== 'failed') return nothing;\r\n\r\n\t\treturn html`<span class=\"text-danger\">${this.error}</span>`;\r\n\t}\r\n\r\n\t#renderConfirmationPage() {\r\n\t\treturn html`\r\n\t\t\t<umb-confirmation-layout\r\n\t\t\t\theader=${this.localize.term('auth_forgottenPassword')}\r\n\t\t\t\tmessage=${this.localize.term('auth_requestPasswordResetConfirmation')}>\r\n\t\t\t</umb-confirmation-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.resetCallState === 'success' ? this.#renderConfirmationPage() : this.#renderResetPage();\r\n\t}\r\n\r\n\tstatic styles: CSSResultGroup = [\r\n\t\tcss`\r\n\t\t\t#header {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t#header span {\r\n\t\t\t\tcolor: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t}\r\n\r\n\t\t\t#header h1 {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tfont-weight: 400;\r\n\t\t\t\tfont-size: var(--header-secondary-font-size);\r\n\t\t\t\tcolor: var(--uui-color-interactive);\r\n\t\t\t\tline-height: 1.2;\r\n\t\t\t}\r\n\r\n\t\t\tform {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-layout-2);\r\n\t\t\t}\r\n\r\n\t\t\tuui-form-layout-item {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t}\r\n\r\n\t\t\tuui-input,\r\n\t\t\tuui-input-password {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: var(--input-height);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\tuui-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-button {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\t--uui-button-padding-top-factor: 1.5;\r\n\t\t\t\t--uui-button-padding-bottom-factor: 1.5;\r\n\t\t\t}\r\n\r\n\t\t\t#resend {\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\talign-self: center;\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\t#resend a {\r\n\t\t\t\tcolor: var(--uui-color-selected);\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\ttext-decoration: none;\r\n\t\t\t}\r\n\r\n\t\t\t#resend a:hover {\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-reset-password-page': UmbResetPasswordPageElement;\r\n\t}\r\n}\r\n","import { CSSResultGroup, css, html, customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-back-to-login-button')\r\nexport default class UmbBackToLoginButtonElement extends UmbLitElement {\r\n\trender() {\r\n\t\treturn html`\r\n\t\t\t<button type=\"button\" @click=${this.#handleClick}>\r\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\td=\"M7.82843 10.9999H20V12.9999H7.82843L13.1924 18.3638L11.7782 19.778L4 11.9999L11.7782 4.22168L13.1924 5.63589L7.82843 10.9999Z\"></path>\r\n\t\t\t\t</svg>\r\n\t\t\t\t<span><umb-localize key=\"auth_returnToLogin\">Return to login form</umb-localize></span>\r\n\t\t\t</button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#handleClick() {\r\n\t\tthis.dispatchEvent(new CustomEvent('umb-login-flow', { composed: true, detail: { flow: 'login' } }));\r\n\t}\r\n\r\n\tstatic styles: CSSResultGroup = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t}\r\n\t\t\tbutton {\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tbackground: none;\r\n\t\t\t\tborder: 0;\r\n\t\t\t\theight: 1rem;\r\n\t\t\t\tcolor: var(--uui-color-text-alt); /* TODO Change to uui color when uui gets a muted text variable */\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t\talign-self: center;\r\n\t\t\t\ttext-decoration: none;\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\tline-height: 1;\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\tfont-family: var(--uui-font-family),sans-serif;\r\n\t\t\t}\r\n\t\t\tbutton svg {\r\n\t\t\t\twidth: 1rem;\r\n\t\t\t}\r\n\t\t\tbutton:hover {\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-back-to-login-button': UmbBackToLoginButtonElement;\r\n\t}\r\n}\r\n"],"names":["jsonBodySerializer","body","_key","value","createSseClient","onRequest","onSseError","onSseEvent","responseTransformer","responseValidator","sseDefaultRetryDelay","sseMaxRetryAttempts","sseMaxRetryDelay","sseSleepFn","url","options","lastEventId","sleep","ms","resolve","retryDelay","attempt","signal","headers","requestInit","request","response","reader","buffer","abortHandler","done","chunks","chunk","lines","dataLines","eventName","line","parsed","data","parsedJson","rawData","error","backoff","separatorArrayExplode","style","separatorArrayNoExplode","separatorObjectExplode","serializeArrayParam","allowReserved","explode","name","joinedValues","v","separator","serializePrimitiveParam","serializeObjectParam","valueOnly","values","key","PATH_PARAM_RE","defaultPathSerializer","path","_url","matches","match","replaceValue","getUrl","baseUrl","query","querySerializer","pathUrl","search","getValidRequestBody","hasBody","getAuthToken","auth","callback","token","createQuerySerializer","array","object","queryParams","serializedArray","serializedObject","serializedPrimitive","getParseAs","contentType","cleanContent","type","checkForExistence","setAuthParams","security","buildUrl","mergeConfigs","a","b","config","mergeHeaders","headersEntries","entries","mergedHeaders","header","iterator","Interceptors","id","index","fn","createInterceptors","defaultQuerySerializer","defaultHeaders","createConfig","override","createClient","_config","getConfig","setConfig","interceptors","beforeRequest","opts","_fetch","result","parseAs","emptyData","textError","jsonError","finalError","makeMethodFn","method","makeSseFn","init","client","postSecurityForgotPassword","postSecurityForgotPasswordReset","postSecurityForgotPasswordVerify","postUserInviteCreatePassword","postUserInviteVerify","UmbAuthRepository","UmbRepositoryBase","#localize","UmbLocalizationController","responseData","#getErrorText","code","provider","requestData","email","#getApiErrorDetailText","userId","resetCode","password","fallbackText","isProblemDetailsLike","UmbAuthContext","UmbContextBase","#authRepository","#returnPath","params","returnPath","username","UMB_AUTH_CONTEXT","UmbContextToken","UmbSlimBackofficeController","UmbControllerBase","host","UmbBundleExtensionInitializer","umbExtensionsRegistry","UUIIconRegistryEssential","serverUrl","serverConnection","UmbServerConnection","UmbServerContext","UmbServerExtensionRegistrator","initializer","UmbAppEntryPointExtensionInitializer","firstValueFrom","extensions","_authContext","_UmbAuthElement_instances","initializeForm_fn","createInput","input","createLabel","label","umbLocalize","createFormLayoutItem","formLayoutItem","createForm","elements","styles","authStyles","form","element","UmbAuthElement","UmbLitElement","__privateAdd","e","__privateGet","__privateMethod","html","ifDefined","searchParams","flow","status","__decorateClass","property","customElement","_UmbAuthLayoutElement_instances","renderImageContainer_fn","renderContent_fn","UmbAuthLayoutElement","_changedProperties","when","logoImageAlternative","logoImage","nothing","css","UmbConfirmationLayoutElement","UmbErrorLayoutElement","_UmbNewPasswordLayoutElement_instances","onSubmit_fn","renderErrorMessage_fn","UmbNewPasswordLayoutElement","authContext","pattern","event","formData","passwordConfirm","passwordIsInvalid","passwordValidityText","state","_token","_userId","_UmbInvitePageElement_instances","init_fn","UmbInvitePageElement","__privateSet","urlParams","_formElement","_UmbLoginPageElement_instances","onSlotChanged_fn","_handleSubmit","greetingLocalizationKey_get","_onSubmitClick","handleForgottenPassword_fn","UmbLoginPageElement","persist","el","queryAssignedElements","loadCustomView","view","module","renderCustomView","unsafeHTML","_UmbMfaPageElement_instances","loadProviders_fn","handleSubmit_fn","UmbMfaPageElement","customView","until","codeInput","_UmbNewPasswordPageElement_instances","renderRoutes_fn","UmbNewPasswordPageElement","verifyResponse","_handleResetSubmit","_UmbResetPasswordPageElement_instances","renderResetPage_fn","renderConfirmationPage_fn","UmbResetPasswordPageElement","_UmbBackToLoginButtonElement_instances","handleClick_fn","UmbBackToLoginButtonElement"],"mappings":"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"}